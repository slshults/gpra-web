const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.es-DOG_e_aL.js","js/radix-vendor--xiUtzSD.js","js/rateLimitHandler-qD_g5psz.js","css/rateLimitHandler.css","js/dnd-vendor-CrjKgCyd.js"])))=>i.map(i=>d[i]);
var n0=Object.defineProperty;var s0=(t,r,e)=>r in t?n0(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e;var Sr=(t,r,e)=>s0(t,typeof r!="symbol"?r+"":r,e);import{r as U,j as n,O as Fc,P as mh,C as Oc,b as Dc,T as Rc,D as Bc,c as gh,u as xh,W as a0,d as i0,e as yh,f as o0,g as l0,R as Ui,h as c0,i as d0,k as u0,l as h0,m as bh,I as f0,n as p0,o as wh,V as m0,L as vh,p as Nh,q as g0,s as x0,S as _h,t as y0,v as b0,w as Uo,x as w0}from"./radix-vendor--xiUtzSD.js";import{c as fr,a as qr,A as v0,B as Be,L as Wn,I as Dr,b as Or,C as Mc,d as ln,e as _n,f as cn,g as dn,h as Fs,i as ps,j as ms,E as zo,k as qo,R as N0,l as _0}from"./rateLimitHandler-qD_g5psz.js";import{u as Nl,C as _l,a as Uc,b as Mi,D as cl,c as dl,S as ul,v as hl,d as fl,s as zc,K as qc,P as $c}from"./dnd-vendor-CrjKgCyd.js";let $l={},ea={user_id:null,subscription_tier:null,posthog_distinct_id:null};const j0=t=>{t&&t.authenticated?ea={user_id:t.user,subscription_tier:t.tier,posthog_distinct_id:t.posthog_distinct_id}:ea={user_id:null,subscription_tier:null,posthog_distinct_id:null}},Rd=(t,r={})=>{if(typeof window<"u"&&window.posthog){const e=r.previous_page;if(e&&$l[e]){const s=Date.now()-$l[e];window.posthog.capture("page_time_spent",{page_name:e,time_spent_ms:s,time_spent_seconds:Math.round(s/1e3),next_page:t})}$l[t]=Date.now(),window.posthog.capture("$pageview",{$current_url:`${window.location.origin}${window.location.pathname}#${t}`,$host:window.location.host,$pathname:window.location.pathname,$search:window.location.search,title:`Guitar Practice - ${t}`,page_name:t,spa_navigation:!0,viewport_width:window.innerWidth,viewport_height:window.innerHeight,screen_width:window.screen.width,screen_height:window.screen.height,...ea,...r})}},$o=(t,r,e={})=>{if(typeof window<"u"&&window.posthog){const i={started_timer:"practice_timer_started",marked_done:"practice_item_completed",timer_reset:"practice_timer_reset",timer_stopped:"practice_timer_stopped"}[t]||t;window.posthog.capture(i,{item_name:r,timer_started:t==="started_timer",timer_stopped:t==="timer_stopped",timer_reset:t==="timer_reset",...ea,...e}),fetch("/api/user/practice-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_type:t,item_name:r,duration_seconds:e.duration_seconds,additional_data:e})}).catch(a=>console.error("Failed to log practice event:",a))}},Zs=(t,r,e={})=>{if(typeof window<"u"&&window.posthog){const s={added:"chord_chart_created",edited:"chord_chart_updated",deleted:"chord_chart_deleted",autocreated:"chord_charts_autocreated",copied:"chord_charts_copied",chord_chart_created:"chord_chart_created",chord_chart_updated:"chord_chart_updated",chord_chart_deleted:"chord_chart_deleted",autocreate_completed:"chord_charts_autocreated"};let i={};typeof r=="object"?i={...r,...e}:i={item_name:r,...e},window.posthog.capture(s[t]||t,{...ea,...i})}},fo=(t,r,e,s={})=>{if(typeof window<"u"&&window.posthog){const i=r==="routine"?`routine_${t}`:`practice_item_${t}`;window.posthog.capture(i,{[`${r}_name`]:e,operation_type:t,item_type:r,...ea,...s})}},yc=(t,r,e=null,s={})=>{if(typeof window<"u"&&window.posthog){const i={item_added:"routine_item_added",item_removed:"routine_item_removed",activated:"routine_activated"},a={routine_name:r,operation_type:t,...s};e&&(a.item_name=e),window.posthog.capture(i[t]||t,{...a,...ea})}},Wl=(t,r,e={})=>{if(typeof window<"u"&&window.posthog){const s={notes:"item_notes_updated",tuning:"item_tuning_updated",folder_path:"item_folder_path_updated"};window.posthog.capture(s[t]||`item_${t}_updated`,{item_name:r,update_type:t,...ea,...e})}},Bd=(t,r,e={})=>{typeof window<"u"&&window.posthog&&window.posthog.capture("songbook_folder_link_clicked",{item_name:t,songbook_folder_path:r,...ea,...e})},S0=(t,r={})=>{typeof window<"u"&&window.posthog&&(window.posthog.capture("practice_page_viewed",{active_routine_name:t,...ea,...r}),fetch("/api/user/practice-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_type:"practice_page_visited",routine_name:t,additional_data:r})}).catch(e=>console.error("Failed to log practice event:",e)))},jh=U.createContext(void 0),k0=({children:t})=>{const r=()=>{let a=window.location.hash.slice(1).split("?")[0];const d=["Practice","Routines","Items","Account"];if(!d.includes(a)){const o=sessionStorage.getItem("gpra_login_redirect_hash");if(o){sessionStorage.removeItem("gpra_login_redirect_hash");const c=o.replace("#","").split("?")[0];if(d.includes(c))return window.history.replaceState(null,"",`/${o}`),c}}return d.includes(a)?a:"Practice"},[e,s]=U.useState(r);U.useEffect(()=>{const a=setTimeout(()=>{Rd(e,{initial_page_load:!0,referrer:document.referrer})},100);return()=>clearTimeout(a)},[]);const i=(a,d=!0)=>{const o=e;s(a),Rd(a,{previous_page:o,navigation_type:d?"user_action":"browser_navigation",timestamp:new Date().toISOString()}),d&&window.history.pushState(null,"",`#${a}`)};return U.useEffect(()=>{const a=()=>{const d=r();i(d,!1)};return window.addEventListener("popstate",a),()=>{window.removeEventListener("popstate",a)}},[]),n.jsx(jh.Provider,{value:{activePage:e,setActivePage:i},children:t})},zi=()=>{const t=U.useContext(jh);if(t===void 0)throw new Error("useNavigation must be used within a NavigationProvider");return t},Rn=fr("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),C0=fr("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),Sh=fr("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),Nn=fr("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Xn=fr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),fs=fr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),Hl=fr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),kh=fr("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Js=fr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),Ch=fr("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),Ah=fr("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),jl=fr("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),A0=fr("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),L0=fr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Lh=fr("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),E0=fr("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),po=fr("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Md=fr("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),yo=fr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Eh=fr("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),P0=fr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),T0=fr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),I0=fr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),pl=fr("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),F0=fr("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),Ph=fr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Th=fr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Ti=fr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),O0=fr("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),bc=fr("Wand",[["path",{d:"M15 4V2",key:"z1p9b7"}],["path",{d:"M15 16v-2",key:"px0unx"}],["path",{d:"M8 9h2",key:"1g203m"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M17.8 11.8 19 13",key:"yihg8r"}],["path",{d:"M15 9h0",key:"kg5t1u"}],["path",{d:"M17.8 6.2 19 5",key:"fd4us0"}],["path",{d:"m3 21 9-9",key:"1jfql5"}],["path",{d:"M12.2 6.2 11 5",key:"i3da3b"}]]),D0=fr("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Gr=fr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),R0=fr("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ih=()=>{if(typeof window>"u")return"unknown";const t=window.navigator.userAgent.toLowerCase();return t.includes("android")?"android":t.includes("iphone")||t.includes("ipad")||t.includes("ipod")?"ios":t.includes("mac")?"macos":t.includes("win")?"windows":t.includes("linux")?"linux":"unknown"},Fh=()=>{const t=Ih();return["windows","macos","linux"].includes(t)},_i=()=>{if(typeof window>"u")return!1;const t=window.navigator.userAgent.toLowerCase(),r=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t),e="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerWidth<=768;return r||e&&s},B0=()=>{const t=Ih();return t==="windows"?"Windows Explorer":t==="macos"?"Finder":"File Manager"},M0=t=>{if(!t)return!1;const r=t.trim().toLowerCase();return r.startsWith("http://")||r.startsWith("https://")},Qn=gh,U0=mh,Oh=U.forwardRef(({className:t,...r},e)=>n.jsx(Fc,{ref:e,className:qr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r}));Oh.displayName=Fc.displayName;const Hn=U.forwardRef(({className:t,children:r,...e},s)=>n.jsxs(U0,{children:[n.jsx(Oh,{}),n.jsxs(Oc,{ref:s,className:qr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...e,children:[r,n.jsxs(Dc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[n.jsx(Gr,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Hn.displayName=Oc.displayName;const Gn=({className:t,...r})=>n.jsx("div",{className:qr("flex flex-col space-y-1.5 text-center sm:text-left",t),...r});Gn.displayName="DialogHeader";const wc=({className:t,...r})=>n.jsx("div",{className:qr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r});wc.displayName="DialogFooter";const Vn=U.forwardRef(({className:t,...r},e)=>n.jsx(Rc,{ref:e,className:qr("text-lg font-semibold leading-none tracking-tight",t),...r}));Vn.displayName=Rc.displayName;const es=U.forwardRef(({className:t,...r},e)=>n.jsx(Bc,{ref:e,className:qr("text-sm text-muted-foreground",t),...r}));es.displayName=Bc.displayName;const Ii=U.forwardRef(({className:t,...r},e)=>n.jsx("textarea",{className:qr("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:e,...r}));Ii.displayName="Textarea";const Dh=({isOpen:t,onClose:r,limitType:e,currentTier:s,currentCount:i,limitAmount:a})=>{if(!t)return null;const d=()=>e==="routines"?`Your plan only includes ${a} routine${a!==1?"s":""}, you're at the max. Pick a button:`:`Your plan only includes ${a} item${a!==1?"s":""}, you're at the max. Pick a button:`,o=()=>{r(),window.location.hash="#Account",setTimeout(()=>{const c=document.getElementById("subscription-plans");if(c){const p=c.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:p,behavior:"smooth"})}},100)};return n.jsx(Qn,{open:t,onOpenChange:c=>!c&&r(),children:n.jsxs(Hn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Vn,{className:"flex items-center gap-2 text-xl",children:[n.jsx(v0,{className:"h-6 w-6 text-amber-500"}),"Oops!"]}),n.jsx(es,{className:"text-left space-y-3 text-base mt-4",children:n.jsx("div",{className:"text-gray-700 dark:text-gray-300",children:d()})})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx(Be,{onClick:o,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition-colors",children:"Upgrade"}),n.jsx(Be,{onClick:r,className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded transition-colors dark:bg-gray-600 dark:hover:bg-gray-700 dark:text-gray-200",children:"Nope"})]})]})})},Wc=t=>{if(!t)return"";const r=t.split(`
`),e=[];let s=!1;for(let i of r){let a=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");const d=a.match(/^(#{1,6})\s+(.+)$/);if(d){const h=d[1].length,p=d[2],b={1:"text-2xl font-bold",2:"text-xl font-bold",3:"text-lg font-semibold",4:"text-base font-semibold",5:"text-sm font-semibold",6:"text-sm font-medium"};s&&(e.push("</ul>"),s=!1),e.push(`<h${h} class="${b[h]} mt-2 mb-1">${Wo(p)}</h${h}>`);continue}const o=a.match(/^[-*]\s+(.+)$/);if(o){s||(e.push('<ul class="list-disc list-inside ml-2">'),s=!0),e.push(`<li>${Wo(o[1])}</li>`);continue}const c=a.match(/^\d+\.\s+(.+)$/);if(c){s||(e.push('<ol class="list-decimal list-inside ml-2">'),s=!0),e.push(`<li>${Wo(c[1])}</li>`);continue}if(s&&(e.push(s==="ol"?"</ol>":"</ul>"),s=!1),a.trim()===""){e.push("<br />");continue}e.push(`<p>${Wo(a)}</p>`)}return s&&e.push("</ul>"),e.join("")},Wo=t=>{let r=t;return r=r.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),r=r.replace(/__(.+?)__/g,"<strong>$1</strong>"),r=r.replace(/\*(.+?)\*/g,"<em>$1</em>"),r=r.replace(/_(.+?)_/g,"<em>$1</em>"),r=r.replace(/`(.+?)`/g,'<code class="bg-gray-700 px-1 rounded">$1</code>'),r=r.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" class="text-blue-400 underline" target="_blank" rel="noopener noreferrer">$1</a>'),r},z0=({open:t,onOpenChange:r,itemId:e,currentNote:s="",onNoteSave:i})=>{const[a,d]=U.useState(""),[o,c]=U.useState(null),[h,p]=U.useState(!1),[b,m]=U.useState(!1),u=U.useRef("");U.useEffect(()=>{t&&(d(s),u.current=s,c(null),p(!1),m(!1))},[t,s]);const w=()=>a!==u.current&&a.trim()!=="",g=()=>{w()?p(!0):r(!1)},_=async y=>{y&&y.preventDefault();try{const A=await fetch(`/api/items/${e}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:a})});if(!A.ok)throw new Error("Failed to save note");const L=await A.json();u.current=a,i==null||i(a),p(!1),r(!1)}catch(A){c(A.message),console.error("Save error:",A)}};return n.jsxs(n.Fragment,{children:[n.jsx(Qn,{open:t,onOpenChange:y=>{y?r(!0):g()},children:n.jsxs(Hn,{className:"max-w-2xl bg-gray-800",children:[n.jsxs(Gn,{children:[n.jsx(Vn,{children:"Edit note"}),n.jsx(es,{children:"Add or edit your practice notes (markdown supported)"}),o&&n.jsx("div",{className:"mt-2 text-sm text-red-500",children:o})]}),n.jsxs("form",{onSubmit:_,className:"space-y-4",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{type:"button",variant:b?"outline":"default",size:"sm",onClick:()=>m(!1),children:"Edit"}),n.jsx(Be,{type:"button",variant:b?"default":"outline",size:"sm",onClick:()=>m(!0),children:"Preview"})]}),b?n.jsx("div",{className:"h-48 bg-gray-900 text-white p-3 rounded-md overflow-auto",dangerouslySetInnerHTML:{__html:Wc(a)}}):n.jsx(Ii,{value:a,onChange:y=>d(y.target.value),placeholder:"Enter your notes... (markdown supported)",className:"h-48 bg-gray-900 text-white",autoComplete:"off"}),n.jsxs("div",{className:"flex justify-end space-x-4",children:[n.jsx(Be,{type:"button",variant:"outline",onClick:g,children:"Cancel"}),n.jsx(Be,{type:"submit",variant:"outline",children:"Save note"})]})]})]})}),n.jsx(Qn,{open:h,onOpenChange:p,children:n.jsxs(Hn,{className:"max-w-md bg-gray-800",children:[n.jsxs(Gn,{children:[n.jsx(Vn,{children:"Unsaved changes"}),n.jsx(es,{children:"Are you sure you want to lose what you typed?"})]}),n.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[n.jsx(Be,{variant:"outline",onClick:()=>p(!1),children:"Keep editing"}),n.jsx(Be,{variant:"outline",className:"text-red-400 hover:text-red-300",onClick:()=>{p(!1),r(!1)},children:"Lose it"}),n.jsx(Be,{variant:"default",onClick:_,children:"Save it"})]})]})})]})},q0=({open:t,onOpenChange:r,item:e=null,onItemChange:s})=>{const[i,a]=U.useState({C:"",D:"",E:5,F:"",G:"",H:"",I:""}),[d,o]=U.useState(null),[c,h]=U.useState(!1),[p,b]=U.useState(!1),[m,u]=U.useState(!1),[w,g]=U.useState({limitType:"items",currentTier:"free",currentCount:0,limitAmount:15});U.useEffect(()=>{t&&(e?e.D!==void 0||e.H!==void 0?(a({C:e.C||"",D:e.D||"",E:e.E||5,F:e.F||"",G:e.G||"",H:e.H||"",I:e.I||""}),o(null),h(!1),b(!1)):_(e.A):(a({C:"",D:"",E:5,F:"",G:"",H:"",I:""}),o(null),h(!1),b(!1)))},[t,e]);const _=async L=>{try{const E=await fetch(`/api/items/${L}`);if(!E.ok)throw new Error("Failed to fetch item details");const F=await E.json();a({C:F.C||"",D:F.D||"",E:F.E||5,F:F.F||"",G:F.G||"",H:F.H||"",I:F.I||""}),o(null),h(!1)}catch(E){o(`Failed to load item: ${E.message}`),console.error("Fetch item error:",E)}},y=(L,E)=>{a(F=>({...F,[L]:E})),h(!0)},A=async L=>{L.preventDefault();try{const{G:E,...F}=i,Z="/api/items",Y=e!=null&&e.A?`${Z}/${e.A}`:Z,G=await fetch(Y,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)});if(!G.ok){const k=await G.json().catch(()=>null);if(G.status===403&&(k==null?void 0:k.error)==="Item limit reached"){g({limitType:"items",currentTier:k.tier||"free",currentCount:k.current||0,limitAmount:k.limit||15}),u(!0);return}throw new Error((k==null?void 0:k.error)||"Failed to save item")}const O=await G.json(),Q=!(e!=null&&e.A),I=i.C||"Unnamed Item";if(Q)fo("created","item",I);else{fo("updated","item",I);const k=(e==null?void 0:e.D)||"",D=(e==null?void 0:e.H)||"",v=(e==null?void 0:e.I)||"";i.D&&i.D!==k&&Wl("notes",I),i.H&&i.H!==D&&Wl("tuning",I),i.I&&i.I!==v&&Wl("folder_path",I)}s==null||s(O),r(!1)}catch(E){o(E.message),console.error("Save error:",E)}};return n.jsxs(n.Fragment,{children:[n.jsx(Qn,{open:t,onOpenChange:r,children:n.jsxs(Hn,{className:"max-w-2xl bg-gray-800",children:[n.jsxs(Gn,{children:[n.jsx(Vn,{children:e?`Edit item: ${e.C}`:"Create new item"}),d&&n.jsx("div",{className:"mt-2 text-sm text-red-500",role:"alert",children:d})]}),n.jsxs("form",{onSubmit:A,className:"space-y-6",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"title",children:"Title"}),n.jsx(Dr,{id:"title",value:i.C,onChange:L=>y("C",L.target.value),placeholder:"Enter item title",required:!0,className:"bg-gray-900 text-white",autoComplete:"off"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"duration",children:"Duration"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx(Dr,{id:"duration-minutes",type:"number",min:"0",max:"999",value:Math.floor(i.E),onChange:L=>{const E=parseInt(L.target.value)||0,F=i.E%1*60;y("E",E+F/60)},onInput:L=>{const E=parseInt(L.target.value)||0,F=i.E%1*60;y("E",E+F/60)},className:"bg-gray-900 text-white text-center",autoComplete:"off",placeholder:"0"}),n.jsx("div",{className:"text-xs text-gray-400 text-center mt-1",children:"minutes"})]}),n.jsx("span",{className:"text-xl text-gray-400",children:":"}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{id:"duration-seconds",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:Math.round(i.E%1*60),onChange:L=>{const E=L.target.value.replace(/[^0-9]/g,""),F=Math.min(59,parseInt(E)||0),Z=Math.floor(i.E);y("E",Z+F/60)},className:"bg-gray-900 text-white text-center pr-6",autoComplete:"off",placeholder:"00"}),n.jsxs("div",{className:"absolute right-0 top-0 flex flex-col h-full border-l border-gray-700",children:[n.jsx("button",{type:"button",onClick:()=>{const L=Math.round(i.E%1*60),E=Math.min(59,L+15),F=Math.floor(i.E);y("E",F+E/60)},className:"flex-1 px-1 text-gray-400 hover:text-white hover:bg-gray-700 text-xs leading-none","aria-label":"Increase seconds by 15","data-ph-capture-attribute-button":"duration-seconds-up",children:"â–²"}),n.jsx("button",{type:"button",onClick:()=>{const L=Math.round(i.E%1*60),E=Math.max(0,L-15),F=Math.floor(i.E);y("E",F+E/60)},className:"flex-1 px-1 text-gray-400 hover:text-white hover:bg-gray-700 text-xs leading-none border-t border-gray-700","aria-label":"Decrease seconds by 15","data-ph-capture-attribute-button":"duration-seconds-down",children:"â–¼"})]})]}),n.jsx("div",{className:"text-xs text-gray-400 text-center mt-1",children:"seconds"})]})]}),n.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Total: ",Math.floor(i.E)," min ",Math.round(i.E%1*60)," sec"]})]}),Fh()&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"songbook",children:"Songbook folder or link"}),n.jsx(Dr,{id:"songbook",value:i.I,onChange:L=>y("I",L.target.value),placeholder:'e.g.: "C:\\Users\\...\\SongName" or "https://tabs.ultimate-guitar.com/..."',className:"bg-gray-900 font-mono"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"tuning",children:"Tuning"}),n.jsx(Dr,{id:"tuning",value:i.H,onChange:L=>y("H",L.target.value),placeholder:"e.g. EADGBE",className:"bg-gray-900 text-white",autoComplete:"off"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(Wn,{htmlFor:"notes",children:["Notes ",n.jsx("span",{className:"text-gray-500 font-normal",children:"(markdown supported)"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{type:"button",variant:p?"outline":"default",size:"sm",onClick:()=>b(!1),"data-ph-capture-attribute-button":"notes-edit-mode",children:"Edit"}),n.jsx(Be,{type:"button",variant:p?"default":"outline",size:"sm",onClick:()=>b(!0),"data-ph-capture-attribute-button":"notes-preview-mode",children:"Preview"})]})]}),p?n.jsx("div",{className:"h-24 bg-gray-900 text-white p-3 rounded-md overflow-auto",dangerouslySetInnerHTML:{__html:Wc(i.D)}}):n.jsx(Ii,{id:"notes",value:i.D,onChange:L=>y("D",L.target.value),placeholder:"Enter any notes... (markdown supported)",className:"h-24 bg-gray-900 text-white",autoComplete:"off"})]}),n.jsxs("div",{className:"flex justify-end space-x-4",children:[n.jsx(Be,{type:"button",variant:"outline",onClick:()=>r(!1),className:"text-gray-300 hover:text-white","data-ph-capture-attribute-button":"item-editor-cancel",children:"Cancel"}),n.jsx(Be,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:!c,"data-ph-capture-attribute-button":"item-editor-save",children:"Save"})]})]})]})}),t&&n.jsx(Dh,{isOpen:m,onClose:()=>u(!1),limitType:w.limitType,currentTier:w.currentTier,currentCount:w.currentCount,limitAmount:w.limitAmount})]})},Rh=()=>{const[t,r]=U.useState([]),[e,s]=U.useState(!0),[i,a]=U.useState(null),[d,o]=U.useState(0),c=async()=>{try{const w=await fetch("/api/items");if(!w.ok)throw new Error("Failed to fetch items");const g=await w.json();r(g),a(null)}catch(w){a(w.message),console.error("Fetch error:",w)}finally{s(!1)}},h=async()=>{o(w=>w+1)},p=async w=>{try{if(!(await fetch(`/api/items/${w}`,{method:"DELETE"})).ok)throw new Error("Failed to delete item");r(_=>_.filter(y=>y.A!==w)),await h()}catch(g){throw a(g.message),console.error("Delete error:",g),g}},b=async w=>{try{const g=await fetch("/api/items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(!g.ok)throw new Error("Failed to add item");const _=await g.json();return r([...t,_]),_}catch(g){throw a(g.message),g}},m=async(w,g)=>{try{const _=await fetch(`/api/items/${w}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!_.ok)throw new Error("Failed to update item");const y=await _.json();return r(t.map(A=>A.A===w?y:A)),y}catch(_){throw a(_.message),_}},u=async w=>{try{const g=await fetch("/api/items/order",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(!g.ok)throw new Error("Failed to update items");const _=await g.json();return r(_),await h(),_}catch(g){throw a(g.message),console.error("Update error:",g),g}};return U.useEffect(()=>{c()},[d]),{items:t,loading:e,error:i,addItem:b,updateItem:m,deleteItem:p,updateItems:u,refreshItems:h}},$0={strings:6,frets:5,fretSize:1.2,fingerSize:.75,sidePadding:.2,fontFamily:"Arial",width:128,height:176,color:"#ffffff",backgroundColor:"transparent",strokeColor:"#ffffff",textColor:"#ffffff",fretLabelColor:"#ffffff",fingerTextColor:"#000000",fingerTextSize:28},Gl=async(t,r={},e=3,s=null)=>{for(let i=0;i<e;i++)try{const a=await fetch(t,r);if(a.status===429){const d=Math.pow(2,i)*1e3,o=`Rate limited. Waiting ${d/1e3}s before retry ${i+1}/${e}`;s&&s(o),await new Promise(c=>setTimeout(c,d));continue}return a}catch(a){if(i===e-1)throw a;const d=Math.pow(2,i)*1e3,o=`Request failed. Waiting ${d/1e3}s before retry ${i+1}/${e}`;s&&s(o),await new Promise(c=>setTimeout(c,d))}throw new Error(`Failed after ${e} attempts`)},Bh=({itemId:t,onSave:r,onCancel:e,editingChordId:s=null,insertionContext:i=null,defaultTuning:a="EADGBE"})=>{const[d,o]=U.useState(""),[c,h]=U.useState(1),[p,b]=U.useState(5),[m,u]=U.useState(6),[w,g]=U.useState("dots");U.useEffect(()=>{H.current=w},[w]);const[_,y]=U.useState(a),[A,L]=U.useState(0),[E,F]=U.useState([]),[Z,Y]=U.useState([]);U.useEffect(()=>{},[Z]);const[G,O]=U.useState(new Set),[Q,I]=U.useState(new Set),[k,D]=U.useState(!1),[v,te]=U.useState(!1),[ce,re]=U.useState(null),[se,le]=U.useState(!1),Se=U.useRef(null),ne=U.useRef(null),C=U.useRef(null),H=U.useRef(w),K=U.useRef(null),X=async V=>{if(!(!V.trim()||!t))try{D(!0);const $=await Gl(`/api/items/${t}/chord-charts`,{},3,1e3);if(!$.ok)return;const M=(await $.json()).filter(me=>me.title.toLowerCase()===V.toLowerCase());let he;if(M.length===0)try{await new Promise(de=>setTimeout(de,1e3));const me=await Gl(`/api/chord-charts/common/search?name=${encodeURIComponent(V)}`,{},3,1e3);if(me.ok){const de=await me.json();de.length>0&&(he=de[0])}}catch(me){console.error("Error fetching common chords:",me)}else M.length===1||M.sort((me,de)=>{const Le=parseInt(me.order)||0,Ie=parseInt(de.order)||0;return Le!==Ie?Le-Ie:(parseInt(me.id)||0)-(parseInt(de.id)||0)}),he=M[0];if(he){h(he.startingFret||1),b(he.numFrets||5),u(he.numStrings||6),y(he.tuning||a),L(he.capo||0);const de=(he.fingers||[]).map(Ie=>{if(Array.isArray(Ie)){const[st,ot,yt]=Ie;return[st,ot,yt]}if(Ie&&typeof Ie=="object"&&"string"in Ie&&"fret"in Ie){const st=Ie.fingerNumber||Ie[2];return[Ie.string,Ie.fret,st]}const[Te,Ve,ht]=Array.isArray(Ie)?Ie:[Ie[0],Ie[1],Ie[2]];return[Te,Ve,ht]});F(de);const Le=he.barres||[];Y(Le),O(new Set(he.openStrings||[])),I(new Set(he.mutedStrings||[])),le(!1)}}catch($){console.error("Error during autofill:",$)}finally{D(!1)}};U.useEffect(()=>{s&&t?(async()=>{try{D(!0);const $=await Gl(`/api/items/${t}/chord-charts`);if($.ok){const M=(await $.json()).find(he=>parseInt(he.id)===parseInt(s));if(M){console.log("Loading chord for editing:",{id:M.id,title:M.title,hasLineBreakAfter:M.hasLineBreakAfter,editingChordId:s}),o(M.title||""),h(M.startingFret||1),b(M.numFrets||5),u(M.numStrings||6),y(M.tuning||a),L(M.capo||0);const me=(M.fingers||[]).map(Ie=>{if(Array.isArray(Ie)){const[st,ot,yt]=Ie;return[st,ot,yt]}if(Ie&&typeof Ie=="object"&&"string"in Ie&&"fret"in Ie){const st=Ie.fingerNumber||Ie[2];return[Ie.string,Ie.fret,st]}const[Te,Ve,ht]=Array.isArray(Ie)?Ie:[Ie[0],Ie[1],Ie[2]];return[Te,Ve,ht]});F(me);const de=M.barres||[];Y(de),O(new Set(M.openStrings||[])),I(new Set(M.mutedStrings||[]));const Le=M.hasLineBreakAfter||!1;console.log("Setting addLineBreak to:",Le,"from hasLineBreakAfter:",M.hasLineBreakAfter),le(Le)}}else console.error("Failed to fetch chord charts:",$.status)}catch($){console.error("Error loading chord for editing:",$)}finally{D(!1)}})():s||(o(""),h(1),b(5),u(6),y(a),L(0),F([]),Y([]),O(new Set),I(new Set),te(!1),le(!1))},[s,t,a]),U.useEffect(()=>{if(window.svguitar)pe();else{const V=document.createElement("script");V.src="/static/js/svguitar.es5.js",V.async=!0,V.onload=()=>{pe()},document.body.appendChild(V)}return()=>{ve.current&&ve.current.svg&&(ve.current.svg.removeEventListener("click",ve.current.clickHandler),ve.current.svg.removeEventListener("mousedown",ve.current.mousedownHandler))}},[]);const pe=()=>{try{Se.current=new window.svguitar.SVGuitarChord("#editor-chart"),ne.current=new window.svguitar.SVGuitarChord("#result-chart"),P(),ke()}catch(V){console.error("Error initializing charts:",V)}},ve=U.useRef(null),ke=()=>{if(!C.current)return;const V=C.current.querySelector("svg");if(!V)return;ve.current&&ve.current.svg&&(ve.current.svg.removeEventListener("click",ve.current.clickHandler),ve.current.svg.removeEventListener("mousedown",ve.current.mousedownHandler));const $=M=>{if(M.detail>1)return M.preventDefault(),M.stopPropagation(),!1;M.preventDefault()},z=M=>{M.stopPropagation(),M.preventDefault(),Ae(M)};V.style.userSelect="none",V.style.webkitUserSelect="none",V.style.mozUserSelect="none",V.style.msUserSelect="none",V.addEventListener("mousedown",$),V.addEventListener("click",z),ve.current={svg:V,clickHandler:z,mousedownHandler:$}},Ae=V=>{if(!V||!V.currentTarget){console.error("handleEditorClick called with invalid event");return}const $=H.current;if($!=="dots"&&$!=="fingers"&&$!=="barres")return;const z=V.currentTarget,M=z.getBoundingClientRect(),he=V.clientX-M.left,me=V.clientY-M.top,de=z.viewBox.baseVal;if(!de||de.width===0||de.height===0||M.width===0||M.height===0)return;const Le=de.width/M.width,Ie=de.height/M.height;if(!isFinite(Le)||!isFinite(Ie)){console.error("Invalid scale values:",{scaleX:Le,scaleY:Ie});return}const Te=he*Le,Ve=me*Ie,ht=de.width,st=de.height,ot=ht*.15,yt=st*.08,dt=ht-ot*2,Vt=st-yt*2;if(Te<ot||Te>ht-ot)return;const Lt=(Te-ot)/dt,zt=Math.floor(Lt*m);if(zt<0||zt>=m)return;const Et=m-zt;if(Ve<yt){Me(Et);return}if(Ve>st-yt)return;const wt=Ve-yt,Jt=wt/Vt,Nt=Math.ceil(Jt*p);console.log("Click debug:",{rawX:he,rawY:me,x:Te,y:Ve,svguitarString:Et,fretIndex:Nt,marginX:ot,marginY:yt,fretRatio:Jt,relativeY:wt,fretboardHeight:Vt}),!(Nt<1||Nt>p)&&($==="dots"?Re(Et,Nt):$==="fingers"?je(Et,Nt):$==="barres"&&Ke(Et,Nt))},Re=(V,$)=>{O(z=>{const M=new Set(z);return M.delete(V),M}),I(z=>{const M=new Set(z);return M.delete(V),M}),F(z=>{const M=z.findIndex(he=>{const[me,de]=he;return me===V&&de===$});return M>=0?z.filter((me,de)=>de!==M):[...z,[V,$,void 0]]})},Me=V=>{const $=G.has(V),z=Q.has(V);F(M=>M.filter(([he])=>he!==V)),!$&&!z?O(M=>new Set([...M,V])):$?(O(M=>{const he=new Set(M);return he.delete(V),he}),I(M=>new Set([...M,V]))):z&&I(M=>{const he=new Set(M);return he.delete(V),he})},Ke=(V,$)=>{Y(z=>{const M=z.findIndex(he=>he.fret===$);if(M>=0)return z.filter((me,de)=>de!==M);{const he={fromString:6,toString:1,fret:$,text:"1"};return[...z,he]}})},je=(V,$)=>{E.findIndex(M=>{const[he,me]=M;return he===V&&me===$})===-1?(O(M=>{const he=new Set(M);return he.delete(V),he}),I(M=>{const he=new Set(M);return he.delete(V),he}),F(M=>[...M,[V,$,void 0]]),re([V,$])):re([V,$])},j=(V,$,z)=>{F(M=>M.map(he=>{const[me,de,Le]=he;return me===V&&de===$?[me,de,z]:he.length===3?he:[me,de,Le]}))},P=()=>{if(!Se.current||!ne.current)return;const V=document.querySelector("#editor-chart"),$=document.querySelector("#result-chart");if(!(!V||!$))try{const z={...$0,strings:m,frets:p,position:c,tuning:[]},me={fingers:[...E.map(Ie=>{const[Te,Ve,ht]=Ie;return ht&&ht!=="undefined"?[Te,Ve,ht]:[Te,Ve]}),...Array.from(G).map(Ie=>[Ie,0]),...Array.from(Q).map(Ie=>[Ie,"x"])],barres:Z},de=JSON.stringify({chordData:me,title:d});de!==K.current&&(K.current=de,Se.current.configure(z).chord(me).draw(),ne.current.configure({...z,title:d}).chord(me).draw()),setTimeout(()=>{const Ie=document.querySelector("#editor-chart svg"),Te=document.querySelector("#result-chart svg");Ie&&(Ie.style.width="100%",Ie.style.height="100%",Ie.style.maxWidth="128px",Ie.style.maxHeight="180px"),Te&&(Te.style.width="100%",Te.style.height="100%",Te.style.maxWidth="128px",Te.style.maxHeight="180px"),ke()},100)}catch(z){console.error("Error updating charts:",z)}};return U.useEffect(()=>{P()},[d,c,p,m,E,Z,_,G,Q]),U.useEffect(()=>{const V=$=>{if(w!=="fingers"||!ce)return;const z=$.key;if(["1","2","3","4","5"].includes(z)){const[M,he]=ce;j(M,he,z),re(null),$.preventDefault()}else z==="Escape"&&(re(null),$.preventDefault())};if(w==="fingers")return document.addEventListener("keydown",V),()=>document.removeEventListener("keydown",V)},[w,ce]),n.jsx("div",{className:"bg-gray-800 rounded-lg p-4",children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Chord name"}),n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{value:d,onChange:V=>o(V.target.value),onBlur:()=>X(d),onKeyDown:V=>{V.key==="Enter"&&!V.shiftKey&&(V.preventDefault(),X(d))},placeholder:"Enter chord name (e.g. Am, C7) then hit 'Enter'",className:"bg-gray-900",disabled:k}),k&&n.jsxs("div",{className:"absolute right-2 top-2 text-yellow-400 text-xs",role:"status","aria-live":"polite",children:[n.jsx("span",{className:"sr-only",children:"Loading chord data"}),n.jsx("span",{"aria-hidden":"true",children:"Loading..."})]})]})]}),n.jsx("div",{className:"text-sm text-blue-400 hover:underline cursor-pointer",onClick:()=>te(!v),children:v?"Hide advanced settings...":"Show more settings..."}),v&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Tuning"}),n.jsx(Dr,{value:_,onChange:V=>y(V.target.value),placeholder:"EADGBE",className:"bg-gray-900"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Capo"}),n.jsx(Dr,{type:"number",min:"0",max:"12",value:A,onChange:V=>L(parseInt(V.target.value)||0),className:"bg-gray-900"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Starting fret"}),n.jsx(Dr,{type:"number",min:"1",max:"15",value:c,onChange:V=>h(parseInt(V.target.value)||1),className:"bg-gray-900"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Number of frets"}),n.jsx(Dr,{type:"number",min:"1",max:"10",value:p,onChange:V=>b(parseInt(V.target.value)||5),className:"bg-gray-900"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Number of strings"}),n.jsx(Dr,{type:"number",min:"4",max:"12",value:m,onChange:V=>u(parseInt(V.target.value)||6),className:"bg-gray-900"})]})]})]}),n.jsxs("div",{className:"flex gap-8 justify-center",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-lg text-white mb-2",children:"Editor"}),n.jsx("div",{className:"border border-gray-700 rounded-lg px-1 pt-1 pb-0",children:n.jsx("div",{className:"relative w-32 mx-auto flex items-center justify-center overflow-hidden select-none",style:{height:"184px"},children:n.jsx("div",{id:"editor-chart",ref:C,className:"cursor-pointer select-none"})})})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-lg text-white mb-2",children:"Result"}),n.jsx("div",{className:"border border-gray-700 rounded-lg px-1 pt-1 pb-0",children:n.jsx("div",{className:"relative w-32 mx-auto flex items-center justify-center overflow-hidden select-none",style:{height:"184px"},children:n.jsx("div",{id:"result-chart",className:"select-none"})})})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{variant:w==="dots"?"default":"outline",onClick:()=>g("dots"),className:`flex-1 ${w==="dots"?"bg-blue-700 hover:bg-blue-800 text-white":"bg-black hover:bg-gray-800 text-gray-300 border border-gray-600"}`,"data-ph-capture-attribute-button":"chord-editor-dots-mode",children:"Edit dots"}),n.jsx(Be,{variant:w==="fingers"?"default":"outline",onClick:()=>{g("fingers")},className:`flex-1 ${w==="fingers"?"!bg-blue-800 hover:!bg-blue-900 !text-white !border !border-blue-600":"!bg-black hover:!bg-gray-800 !text-gray-300 !border !border-gray-600"}`,"data-ph-capture-attribute-button":"chord-editor-fingers-mode",children:"Edit fingers"}),n.jsx(Be,{variant:w==="barres"?"default":"outline",onClick:()=>g("barres"),className:`flex-1 ${w==="barres"?"!bg-green-700 hover:!bg-green-800 !text-white !border !border-green-600":"!bg-black hover:!bg-gray-800 !text-gray-300 !border !border-gray-600"}`,"data-ph-capture-attribute-button":"chord-editor-barres-mode",children:"Edit barres"})]}),w==="dots"&&n.jsx("div",{className:"bg-gray-700 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-sm text-gray-200",children:"Click on a string above the fret where you want to add a dot"}),w==="barres"&&n.jsx("div",{className:"bg-green-900 bg-opacity-50 border border-green-600 rounded-lg p-3 text-sm text-green-200",children:"Click on any fret to add/remove a full barre across all strings at that fret. Perfect for chords like F, B, F#m, etc."}),w==="fingers"&&n.jsxs("div",{className:"bg-blue-900 bg-opacity-50 border border-blue-600 rounded-lg p-3 text-sm text-blue-200",children:["Click on a finger position, then press 1-5 keys to assign finger numbers (5 = thumb). Press Escape to cancel selection.",ce&&n.jsxs("div",{className:"mt-2 text-yellow-300",children:["Selected position: String ",ce[0],", Fret ",ce[1]," - Press 1, 2, 3, 4, or 5"]})]}),n.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 rounded-lg p-3",children:[n.jsx("input",{type:"checkbox",id:"addLineBreak",checked:se,onChange:V=>le(V.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-900 border-gray-600 rounded focus:ring-blue-500 focus:ring-2"}),n.jsx("label",{htmlFor:"addLineBreak",className:"text-sm text-gray-300 cursor-pointer",children:"Line break after â†©ï¸"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{onClick:()=>{const V={title:d,startingFret:c,numFrets:p,numStrings:m,tuning:_,capo:A,fingers:E,barres:Z,openStrings:Array.from(G),mutedStrings:Array.from(Q),startOnNewLine:se,editingChordId:s,insertionContext:i};console.log("Saving chord with line break data:",{title:d,addLineBreak:se,startOnNewLine:se,editingChordId:s}),r(V)},className:`flex-1 ${d.trim()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,disabled:!d.trim(),"data-ph-capture-attribute-button":s?"chord-editor-update":"chord-editor-save",children:s?"Update chord chart":"Add chord chart"}),e&&n.jsx(Be,{onClick:e,variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700","data-ph-capture-attribute-button":"chord-editor-cancel",children:"Cancel"})]})]})})},Hc="gpra_rate_limit_backoff",W0=15,H0=120,Mh=()=>{try{const t=localStorage.getItem(Hc);if(t){const r=JSON.parse(t);return Date.now()-r.timestamp>300*1e3?0:r.level||0}}catch(t){console.warn("Error reading backoff level:",t)}return 0},G0=()=>{try{const t=Mh(),r=Math.min(t+1,3);return localStorage.setItem(Hc,JSON.stringify({level:r,timestamp:Date.now()})),r}catch(t){return console.warn("Error saving backoff level:",t),0}},ri=()=>{try{localStorage.removeItem(Hc)}catch(t){console.warn("Error resetting backoff:",t)}},V0=t=>Math.min(W0*Math.pow(2,t),H0),Uh=({isOpen:t,onClose:r,error:e})=>{const[s,i]=U.useState(0),[a,d]=U.useState(!1),[o,c]=U.useState(null),h=u=>{const g=((u==null?void 0:u.message)||u||"").toLowerCase();return g.includes("529")||g.includes("overloaded")?{type:"overload",title:"API Temporarily Overloaded",message:"The AI servers are experiencing high traffic right now.",waitTime:30,icon:n.jsx(Or,{className:"h-6 w-6 text-yellow-500 animate-spin"})}:g.includes("429")||g.includes("rate limit")?{type:"rate_limit",title:"Oops!",message:null,waitTime:null,icon:n.jsx(Hl,{className:"h-6 w-6 text-orange-500"})}:g.includes("500")||g.includes("502")||g.includes("503")?{type:"server_error",title:"Server Error",message:"The server is experiencing issues. Let's try again in a moment.",waitTime:45,icon:n.jsx(Rn,{className:"h-6 w-6 text-red-500"})}:g.includes("timeout")?{type:"timeout",title:"Request Timeout",message:"The analysis took too long. This might work better with smaller files.",waitTime:15,icon:n.jsx(Hl,{className:"h-6 w-6 text-blue-500"})}:{type:"generic",title:"Oops!",message:(u==null?void 0:u.message)||u||"An unexpected error occurred.",waitTime:10,icon:n.jsx(Rn,{className:"h-6 w-6 text-gray-500"})}};U.useEffect(()=>{if(t&&e){const u=h(e);let w=u.waitTime;if(u.type==="rate_limit"){const y=Mh();w=V0(y),G0()}const g={...u,waitTime:w};c(g),i(w),d(!1);const _=setInterval(()=>{i(y=>y<=1?(d(!0),clearInterval(_),0):y-1)},1e3);return()=>clearInterval(_)}},[t,e]);const p=u=>{if(u<60)return`${u}s`;const w=Math.floor(u/60),g=u%60;return`${w}m ${g}s`},b=()=>{d(!1),i(0),r()};return!t||!e||!o?null:(e==null?void 0:e.requiresApiKey)||!1?n.jsx(Qn,{open:t,onOpenChange:u=>!u&&r(),children:n.jsxs(Hn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Vn,{className:"flex items-center gap-2",children:[n.jsx(A0,{className:"h-6 w-6 text-orange-500"}),"API Key Required"]}),n.jsxs(es,{className:"text-left space-y-3",children:[n.jsx("p",{children:e.message}),n.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:n.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Add your Anthropic API key in Account Settings to use the autocreate feature."})})]})]}),n.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n.jsx(Be,{variant:"outline",onClick:r,children:"Cancel"}),n.jsx(Be,{onClick:()=>{r(),window.location.href="#Account"},className:"bg-orange-600 hover:bg-orange-700",children:"Go to Account Settings"})]})]})}):n.jsx(Qn,{open:t,onOpenChange:u=>u||b(),children:n.jsxs(Hn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Vn,{className:"flex items-center gap-2",children:[o.icon,o.title]}),n.jsxs(es,{className:"text-left space-y-3",children:[o.type==="rate_limit"?n.jsxs("p",{children:["We've hit Anthropic's rate limit"," ",n.jsx("a",{href:"/faq?expand=autocreate-limits",onClick:u=>{u.preventDefault(),u.stopPropagation(),window.open("/faq?expand=autocreate-limits","_blank")},className:"text-blue-500 hover:text-blue-400 underline",children:"(more info)"})]}):n.jsx("p",{children:o.message}),s>0?n.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx(Hl,{className:"h-4 w-4 text-gray-500"}),n.jsxs("span",{children:["Please wait ",p(s)," before trying again"]})]}),n.jsx("div",{className:"w-full bg-gray-300 dark:bg-gray-600 rounded-full h-2 mt-2",children:n.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-1000",style:{width:`${(o.waitTime-s)/o.waitTime*100}%`}})})]}):n.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg",children:n.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Ready to try again!"})})]})]}),n.jsx("div",{className:"flex justify-end gap-2 mt-4",children:n.jsx(Be,{onClick:b,disabled:!a,className:"min-w-20",children:a?"OK":`Wait ${p(s)}`})})]})})},vc=({isOpen:t,onClose:r,autocreateData:e})=>{if(!t||!e)return null;const{itemName:s,chordCount:i,contentType:a,uploadedFileNames:d,isVisionAnalysis:o=!1}=e,c=o||a==="chord_charts"||a==="auto-detected",h=()=>c?n.jsx(R0,{className:"h-6 w-6 text-yellow-500"}):n.jsx(Mc,{className:"h-6 w-6 text-green-500"}),p=()=>c?"ðŸŽ¸ Vision Analysis Complete!":"Chord charts created",b=()=>n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"font-medium",children:"Success! Or close to it!"}),n.jsx("p",{children:"We did the best we could. You'll likely need to make a few corrections."}),n.jsx("p",{children:"Click the pencil icon on a chord chart to fix it."}),n.jsxs("p",{children:["Be sure to click the ",n.jsx("code",{className:"px-1 py-0.5 bg-gray-700 text-gray-300 rounded text-sm",children:'"Update chord chart"'})," button after edits"]})]}),m=()=>{const u=[],w={chord_charts:"Chord charts",chord_names:"Lyrics with chord names",tablature:"Guitar tablature",mixed:"Mixed content types","auto-detected":c?"Chord charts":"Mixed content",youtube_transcript:"YouTube transcript"};if(["YouTube transcript","Manual entry"].includes(d))u.push(d);else if(a&&w[a]&&u.push(w[a]),d){const y=d.split(", ").slice(0,3),A=d.split(", ").length-y.length;let L=y.join(", ");A>0&&(L+=` and ${A} more`),u.push(L)}return u};return n.jsx(Qn,{open:t,onOpenChange:u=>!u&&r(),children:n.jsxs(Hn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Vn,{className:"flex items-center gap-2",children:[h(),p()]}),n.jsxs(es,{className:"text-left space-y-1",children:[b(),n.jsxs("div",{className:"bg-gray-800 px-2 py-1 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-1",children:[n.jsx(Ah,{className:"h-4 w-4"}),n.jsx("span",{children:"Details"})]}),n.jsx("ul",{className:"text-sm text-gray-400",children:m().map((u,w)=>n.jsxs("li",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full"}),u]},w))})]})]})]}),n.jsx("div",{className:"flex justify-end gap-2 -mt-2",children:n.jsx(Be,{onClick:r,variant:"outline",className:"min-w-20",children:"Show me"})})]})})};let ni=!1,Gc=0,ma=null;const zh=3e4;let co=[],Ci=null;const Y0=2e3,J0=10,K0=()=>typeof window<"u"&&window.GPRA_DEBUG===!0,Ud=async()=>{if(co.length===0)return;const t=[...co];co=[],Ci=null;try{(await fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t.map(e=>`[${e.level}] ${e.message}`).join(`
`),level:"DEBUG",context:{batched:!0,count:t.length}})})).ok&&ni&&(ni=!1,Vc(),ma&&(clearInterval(ma),ma=null))}catch{ni||(ni=!0,Gc=Date.now(),em(),tm())}},bo=async(t,r="DEBUG",e={})=>{if(K0()&&!(ni&&Date.now()-Gc<zh)){if(co.push({message:t,level:r,context:e}),co.length>=J0){Ci&&(clearTimeout(Ci),Ci=null),Ud();return}Ci||(Ci=setTimeout(Ud,Y0))}},Z0=console.log,X0=console.error,Q0=console.warn;function em(){Vc();const t=document.createElement("div");t.id="connection-status-modal",t.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: #ef4444;
    color: white;
    padding: 16px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 10000;
    max-width: 400px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-size: 14px;
    line-height: 1.4;
  `,t.innerHTML=`
    <div style="font-weight: 600; margin-bottom: 8px;">Broken string</div>
    <div>...metaphorically speaking, anyway.<br><br>Something's wrong with the connection to the server. Could be your connection, could be a server problem, can't tell from here.<br><br>We'll try again in 30 seconds. Or you can try refreshing the page in a minute or two.<br><br>If the problem continues practice your favorite riff for awhile, or go touch grass, then come back later.</div>
  `,document.body.appendChild(t)}function Vc(){const t=document.getElementById("connection-status-modal");t&&t.remove()}function tm(){ma||(ma=setInterval(async()=>{if(!ni){clearInterval(ma),ma=null;return}try{(await fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"reconnection-test",level:"DEBUG",context:{}})})).ok&&(ni=!1,Vc(),clearInterval(ma),ma=null)}catch{Gc=Date.now()}},zh))}console.log=function(...t){Z0.apply(console,t),bo(t.join(" "),"INFO",{}).catch(()=>{})};console.error=function(...t){X0.apply(console,t),bo(t.join(" "),"ERROR",{}).catch(()=>{})};console.warn=function(...t){Q0.apply(console,t),bo(t.join(" "),"WARNING",{}).catch(()=>{})};const Qr=(t,r)=>bo(t,"DEBUG",r),zd=(t,r)=>bo(t,"INFO",r);var rm=Symbol("radix.slottable");function nm(t){const r=({children:e})=>n.jsx(n.Fragment,{children:e});return r.displayName=`${t}.Slottable`,r.__radixId=rm,r}var qh="AlertDialog",[sm]=o0(qh,[yh]),ya=yh(),$h=t=>{const{__scopeAlertDialog:r,...e}=t,s=ya(r);return n.jsx(gh,{...s,...e,modal:!0})};$h.displayName=qh;var am="AlertDialogTrigger",im=U.forwardRef((t,r)=>{const{__scopeAlertDialog:e,...s}=t,i=ya(e);return n.jsx(l0,{...i,...s,ref:r})});im.displayName=am;var om="AlertDialogPortal",Wh=t=>{const{__scopeAlertDialog:r,...e}=t,s=ya(r);return n.jsx(mh,{...s,...e})};Wh.displayName=om;var lm="AlertDialogOverlay",Hh=U.forwardRef((t,r)=>{const{__scopeAlertDialog:e,...s}=t,i=ya(e);return n.jsx(Fc,{...i,...s,ref:r})});Hh.displayName=lm;var Fi="AlertDialogContent",[cm,dm]=sm(Fi),um=nm("AlertDialogContent"),Gh=U.forwardRef((t,r)=>{const{__scopeAlertDialog:e,children:s,...i}=t,a=ya(e),d=U.useRef(null),o=xh(r,d),c=U.useRef(null);return n.jsx(a0,{contentName:Fi,titleName:Vh,docsSlug:"alert-dialog",children:n.jsx(cm,{scope:e,cancelRef:c,children:n.jsxs(Oc,{role:"alertdialog",...a,...i,ref:o,onOpenAutoFocus:i0(i.onOpenAutoFocus,h=>{var p;h.preventDefault(),(p=c.current)==null||p.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[n.jsx(um,{children:s}),n.jsx(fm,{contentRef:d})]})})})});Gh.displayName=Fi;var Vh="AlertDialogTitle",Yh=U.forwardRef((t,r)=>{const{__scopeAlertDialog:e,...s}=t,i=ya(e);return n.jsx(Rc,{...i,...s,ref:r})});Yh.displayName=Vh;var Jh="AlertDialogDescription",Kh=U.forwardRef((t,r)=>{const{__scopeAlertDialog:e,...s}=t,i=ya(e);return n.jsx(Bc,{...i,...s,ref:r})});Kh.displayName=Jh;var hm="AlertDialogAction",Zh=U.forwardRef((t,r)=>{const{__scopeAlertDialog:e,...s}=t,i=ya(e);return n.jsx(Dc,{...i,...s,ref:r})});Zh.displayName=hm;var Xh="AlertDialogCancel",Qh=U.forwardRef((t,r)=>{const{__scopeAlertDialog:e,...s}=t,{cancelRef:i}=dm(Xh,e),a=ya(e),d=xh(r,i);return n.jsx(Dc,{...a,...s,ref:d})});Qh.displayName=Xh;var fm=({contentRef:t})=>{const r=`\`${Fi}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Fi}\` by passing a \`${Jh}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Fi}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return U.useEffect(()=>{var s;document.getElementById((s=t.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(r)},[r,t]),null},pm=$h,mm=Wh,ef=Hh,tf=Gh,rf=Zh,nf=Qh,sf=Yh,af=Kh;const Xs=pm,gm=mm,of=U.forwardRef(({className:t,...r},e)=>n.jsx(ef,{className:qr("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r,ref:e}));of.displayName=ef.displayName;const Os=U.forwardRef(({className:t,...r},e)=>n.jsxs(gm,{children:[n.jsx(of,{}),n.jsx(tf,{ref:e,className:qr("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...r})]}));Os.displayName=tf.displayName;const Ds=({className:t,...r})=>n.jsx("div",{className:qr("flex flex-col space-y-2 text-center sm:text-left",t),...r});Ds.displayName="AlertDialogHeader";const Rs=({className:t,...r})=>n.jsx("div",{className:qr("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...r});Rs.displayName="AlertDialogFooter";const Bs=U.forwardRef(({className:t,...r},e)=>n.jsx(sf,{ref:e,className:qr("text-lg font-semibold",t),...r}));Bs.displayName=sf.displayName;const Ms=U.forwardRef(({className:t,...r},e)=>n.jsx(af,{ref:e,className:qr("text-sm text-muted-foreground",t),...r}));Ms.displayName=af.displayName;const js=U.forwardRef(({className:t,...r},e)=>n.jsx(rf,{ref:e,className:qr("inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",t),...r}));js.displayName=rf.displayName;const xa=U.forwardRef(({className:t,...r},e)=>n.jsx(nf,{ref:e,className:qr("mt-2 inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-semibold ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 sm:mt-0",t),...r}));xa.displayName=nf.displayName;const xm=(t,r)=>{let e;return function(...i){const a=()=>{clearTimeout(e),t(...i)};clearTimeout(e),e=setTimeout(a,r)}},ml=t=>t.replace(/[''`"]/g,"'").replace(/[â€“â€”âˆ’]/g,"-").replace(/\s+/g," ").trim().toLowerCase(),qd=t=>t.replace(/\s*\([^)]*\)\s*/g,"").trim(),$d=(t,r,e)=>{const s=qd(t),i=ml(s);return console.log("DEBUG: findSimilarSongs - sourceTitle:",t,"-> baseName:",s,"-> normalized:",i),r.filter(a=>{if(a.B===e)return!1;const d=a.C||"",o=qd(d),c=ml(o);return i===c||i.length>3&&c.includes(i)||c.length>3&&i.includes(c)})},ym=U.memo(({chart:t,onEdit:r,onDelete:e,onInsertAfter:s})=>{const[i,a]=U.useState(!1),d=U.useRef(null),o=U.useRef(null);U.useEffect(()=>{const u=w=>{d.current&&!d.current.contains(w.target)&&a(!1)};if(i)return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[i]),U.useEffect(()=>{if(!o.current)return;(()=>{if(!(!window.svguitar||!o.current))try{const w=t.chordData||t;o.current.innerHTML="";const g=new window.svguitar.SVGuitarChord(o.current),_={strings:w.numStrings||6,frets:w.numFrets||5,position:w.startingFret||1,tuning:[],width:128,height:176,fretSize:1.2,fingerSize:.75,sidePadding:.2,fontFamily:"Arial",color:"#ffffff",backgroundColor:"transparent",strokeColor:"#ffffff",textColor:"#ffffff",fretLabelColor:"#ffffff",fingerTextColor:"#000000",fingerTextSize:28},L={fingers:[...(w.fingers||[]).map(E=>{const[F,Z,Y]=E;return Y&&Y!=="undefined"?[F,Z,Y]:[F,Z]}),...(w.openStrings||[]).map(E=>[E,0]),...(w.mutedStrings||[]).map(E=>[E,"x"])],barres:w.barres||[]};g.configure(_).chord(L).draw(),setTimeout(()=>{var F;const E=(F=o.current)==null?void 0:F.querySelector("svg");E&&(E.style.width="100%",E.style.height="100%",E.style.maxWidth="128px",E.style.maxHeight="180px",E.style.position="relative",E.style.zIndex="1")},50)}catch(w){console.error("Error rendering memoized chord chart:",w)}})()},[t]);const c=u=>{u.preventDefault(),u.stopPropagation(),a(!1),r(t.id,{title:t.title,...t,sectionId:t.sectionId,sectionLabel:t.sectionLabel,sectionRepeatCount:t.sectionRepeatCount})},h=u=>{u.preventDefault(),u.stopPropagation(),a(!1),e(t.id)},p=u=>{u.preventDefault(),u.stopPropagation(),a(!1),s(t.id,{sectionId:t.sectionId,sectionLabel:t.sectionLabel,sectionRepeatCount:t.sectionRepeatCount})},b=u=>{u.preventDefault(),u.stopPropagation(),a(!1);const w={fingers:t.fingers||[],barres:t.barres||[],tuning:t.tuning||"EADGBE",capo:t.capo||0,startingFret:t.startingFret||1,numFrets:t.numFrets||5,numStrings:t.numStrings||6,openStrings:t.openStrings||[],mutedStrings:t.mutedStrings||[],sectionId:t.sectionId||"",sectionLabel:t.sectionLabel||"",sectionRepeatCount:t.sectionRepeatCount||"",hasLineBreakAfter:!t.hasLineBreakAfter};r(t.id,{title:t.title,chord_data:w,sectionId:t.sectionId,sectionLabel:t.sectionLabel,sectionRepeatCount:t.sectionRepeatCount})},m=u=>{u.preventDefault(),u.stopPropagation(),a(!i)};return n.jsxs("div",{className:"relative mx-auto",style:{maxWidth:"144px"},children:[n.jsxs("div",{className:"bg-gray-800 p-1 rounded-lg cursor-pointer relative group",onClick:m,style:{minWidth:"0",maxWidth:"100%",width:"100%",position:"relative"},children:[n.jsx("button",{className:"absolute top-1 right-1 bg-gray-700 text-gray-300 rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:m,"aria-label":"Chord chart menu","data-ph-capture-attribute-button":"chord-chart-menu",children:"â‹®"}),n.jsx("div",{className:"relative w-32 mx-auto flex items-center justify-center overflow-hidden",style:{height:"184px"},children:n.jsx("div",{ref:o,className:"w-full h-full"})}),n.jsx("div",{className:"text-center text-white text-sm font-semibold mt-2",children:t.title}),t.hasLineBreakAfter&&n.jsx("div",{className:"absolute -bottom-1 -right-1 bg-blue-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs",children:"â†µ"})]}),i&&n.jsxs("div",{ref:d,className:"absolute top-8 right-0 bg-gray-700 border border-gray-600 rounded-lg shadow-lg z-20 min-w-48",children:[n.jsx("button",{onClick:c,className:"w-full text-left px-4 py-2 text-gray-200 hover:bg-gray-600 rounded-t-lg flex items-center","data-ph-capture-attribute-button":"modal-edit-chord",children:"âœï¸ Edit chord"}),n.jsx("button",{onClick:p,className:"w-full text-left px-4 py-2 text-gray-200 hover:bg-gray-600 flex items-center","data-ph-capture-attribute-button":"modal-insert-chord-after",children:"âž• Insert chord after"}),n.jsx("button",{onClick:b,className:"w-full text-left px-4 py-2 text-gray-200 hover:bg-gray-600 flex items-center","data-ph-capture-attribute-button":"modal-toggle-line-break",children:t.hasLineBreakAfter?"â†©ï¸ Remove line break":"â†µ Add line break after"}),n.jsx("button",{onClick:h,className:"w-full text-left px-4 py-2 text-red-400 hover:bg-gray-600 rounded-b-lg flex items-center","data-ph-capture-attribute-button":"modal-delete-chord",children:"ðŸ—‘ï¸ Delete chord"})]})]})});function lf({isOpen:t,onClose:r,itemId:e,itemTitle:s}){var Jr;const{items:i}=Rh(),[a,d]=U.useState({}),[o,c]=U.useState({}),[h,p]=U.useState({}),[b,m]=U.useState(null),[u,w]=U.useState(null),[g,_]=U.useState({}),[y,A]=U.useState(new Set),[L,E]=U.useState(!1),[F,Z]=U.useState(null),[Y,G]=U.useState(""),[O,Q]=U.useState(new Set),[I,k]=U.useState(new Set),[D,v]=U.useState(!1),[te,ce]=U.useState(null),[re,se]=U.useState({}),[le,Se]=U.useState({}),[ne,C]=U.useState({}),[H,K]=U.useState({}),[X,pe]=U.useState({}),[ve,ke]=U.useState({}),[Ae,Re]=U.useState({}),[Me,Ke]=U.useState({}),je=["âœ¨ Claude is making magic happen","âœ¨ Claude is *still* making magic happen","Yeah, we all love instant gratification, but it'll still be quicker than you could do it from scratch","Are you familiar with the phrase 'A watched pot never boils'? It's kinda like that","Chill, I'm working on it.","You could be stretching or something while you wait, couldn't you?","The pyramids weren't built in a day... ","but hey, at least I'm not going to ask you for an email address to send the chord charts to.","Perfect chord charts take time to craft. These will take less time and they won't be perfect.","Yeah, I could show you a progress bar, but we both know it would just lie to you"],[j,P]=U.useState(0),[V,$]=U.useState([]),[z,M]=U.useState(!1),[he,me]=U.useState(null),[de,Le]=U.useState(!1),[Ie,Te]=U.useState(null),[Ve,ht]=U.useState(!1),[st,ot]=U.useState(null),[yt,dt]=U.useState(!1),[Vt,mt]=U.useState(null),Lt=U.useCallback(ye=>ye===e?{C:s,B:e,E:5}:null,[e,s]);U.useEffect(()=>{if(!window.svguitar){const ye=document.createElement("script");ye.src="https://omnibrain.github.io/svguitar/js/svguitar.umd.js",ye.async=!0,document.body.appendChild(ye)}},[]),U.useEffect(()=>{t&&e&&zt(e)},[t,e]),U.useEffect(()=>{if(Object.values(le).filter(at=>at==="processing").length===0){P(0),$([]);return}P(0);const We=Array.from({length:je.length-1},(at,tt)=>tt+1).sort(()=>Math.random()-.5);$(We);const Qe=setInterval(()=>{$(at=>{if(at.length===0){const rt=Array.from({length:je.length},(_t,$t)=>$t).sort(()=>Math.random()-.5),it=rt[0],Ct=rt.slice(1);return P(it),Ct}else{const tt=at[0],rt=at.slice(1);return P(tt),rt}})},1e4);return()=>clearInterval(Qe)},[le,je]),U.useEffect(()=>{if(!L||O.size===0)return;const ye=new Set;O.forEach(ze=>{var at;const We=i==null?void 0:i.find(tt=>tt.A===ze),Qe=We==null?void 0:We.B;Qe&&((at=a[Qe])==null?void 0:at.length)>0&&ye.add(ze)}),k(ye)},[L,O,a,i]);const zt=async ye=>{try{const ze=await fetch(`/api/items/${ye}/chord-charts`);if(ze.ok){const We=await ze.json();d(at=>({...at,[ye]:We}));const Qe=Et(We);c(at=>({...at,[ye]:Qe}))}}catch(ze){console.error("Error loading chord charts:",ze)}},Et=ye=>{const ze=new Map;return ye.forEach(We=>{const Qe=We.sectionId||"default-section",at=We.sectionLabel||"Section",tt=We.sectionRepeatCount||"";ze.has(Qe)||ze.set(Qe,{id:Qe,label:at,repeatCount:tt,chords:[]}),ze.get(Qe).chords.push(We)}),Array.from(ze.values())},wt=ye=>{const ze=a[ye]||[];return Et(ze)},Jt=U.useMemo(()=>{if(!F||!i)return new Set;const ye=i.find(Qe=>Qe.B===F),ze=(ye==null?void 0:ye.C)||"",We=i.filter(Qe=>Qe.B!==F);return new Set($d(ze,We,F).map(Qe=>Qe.A))},[F,i]),Nt=U.useMemo(()=>i?i.filter(ye=>{if(ye.B===F)return!1;if(Y.trim()){const ze=ye.C||"",We=ml(ze),Qe=ml(Y);return Qe?We.includes(Qe):!0}return!0}).sort((ye,ze)=>{if(Y.trim()){const rt=ye.C||"",it=ze.C||"";return rt.localeCompare(it)}const We=Jt.has(ye.A),Qe=Jt.has(ze.A);if(We&&!Qe)return-1;if(!We&&Qe)return 1;const at=ye.C||"",tt=ze.C||"";return at.localeCompare(tt)}):[],[i,F,Y,Jt]),Ft=U.useMemo(()=>xm(async(ye,ze,We)=>{try{console.log("Debounced section update:",{itemId:ye,sectionId:ze,updates:We});const at=(a[ye]||[]).filter(rt=>(rt.sectionId||"default-section")===ze);if(at.length===0){console.warn("No charts found for section:",ze);return}console.log("Updating section charts:",at.length);const tt=at.map(async rt=>{const it={fingers:rt.fingers||[],barres:rt.barres||[],tuning:rt.tuning||"EADGBE",capo:rt.capo||0,startingFret:rt.startingFret||1,numFrets:rt.numFrets||5,numStrings:rt.numStrings||6,openStrings:rt.openStrings||[],mutedStrings:rt.mutedStrings||[],hasLineBreakAfter:rt.hasLineBreakAfter||!1,sectionId:ze,sectionLabel:We.label!==void 0?We.label:rt.sectionLabel||"Section",sectionRepeatCount:We.repeatCount!==void 0?We.repeatCount:rt.sectionRepeatCount||""},Ct=await fetch(`/api/chord-charts/${rt.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:rt.title,chord_data:it})});if(!Ct.ok)throw new Error(`Failed to update chart ${rt.id}: ${Ct.statusText}`);return Ct.json()});await Promise.all(tt),console.log("All section charts updated successfully")}catch(Qe){console.error("Error updating section:",Qe)}},500),[a]),ar=(ye,ze,We)=>{console.log("Local section update:",{itemId:ye,sectionId:ze,updates:We}),c(Qe=>{const tt=(Qe[ye]||[]).map(rt=>rt.id===ze?{...rt,...We}:rt);return{...Qe,[ye]:tt}}),Ft(ye,ze,We)},Ot=async(ye,ze)=>{if(!y.has(ze)){A(We=>new Set(We).add(ze));try{const We=a[ye]||[],at=We.filter(rt=>(rt.sectionId||"default-section")===ze).map(rt=>fetch(`/api/items/${ye}/chord-charts/${rt.id}`,{method:"DELETE"}));await Promise.all(at);const tt=We.filter(rt=>(rt.sectionId||"default-section")!==ze);d(rt=>({...rt,[ye]:tt})),c(rt=>({...rt,[ye]:Et(tt)}))}catch(We){console.error("Error deleting section:",We)}finally{A(We=>{const Qe=new Set(We);return Qe.delete(ze),Qe})}}},xt=ye=>{const ze=`section-${Date.now()}`,We={id:ze,label:"New Section",repeatCount:"",chords:[]};c(Qe=>({...Qe,[ye]:[...Qe[ye]||[],We]})),_({itemId:ye,scrollPosition:window.scrollY}),p(Qe=>({...Qe,[ye]:!0})),w({sectionId:ze,sectionLabel:"New Section",sectionRepeatCount:""})},Xt=(ye,ze,We)=>{m(ze),w(null),_({itemId:ye,chordId:ze,scrollPosition:window.scrollY}),p(Qe=>({...Qe,[ye]:!0})),setTimeout(()=>{const Qe=document.querySelector(`[data-editor-for-item="${ye}"]`);Qe&&Qe.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},er=async(ye,ze)=>{try{if((await fetch(`/api/items/${ye}/chord-charts/${ze}`,{method:"DELETE"})).ok){d(at=>({...at,[ye]:(at[ye]||[]).filter(tt=>tt.id!==ze)}));const Qe=(a[ye]||[]).filter(at=>at.id!==ze);c(at=>({...at,[ye]:Et(Qe)})),Zs("chord_chart_deleted",{itemId:ye})}}catch(We){console.error("Error deleting chord chart:",We)}},Rr=(ye,ze,We)=>{m(null),w({afterChordId:ze,sectionId:We.sectionId,sectionLabel:We.sectionLabel,sectionRepeatCount:We.sectionRepeatCount}),_({itemId:ye,scrollPosition:window.scrollY}),p(Qe=>({...Qe,[ye]:!0}))},bn=async(ye,ze)=>{try{Qr("handleSaveChordChart called",{editingChordId:b,chartData:ze});const We=!!b;Qr("isUpdate check result",{isUpdate:We,editingChordId:b});let Qe={...ze};if(We){const it=(a[ye]||[]).find(Ct=>Ct.id===b);Qe.sectionId=it==null?void 0:it.sectionId,Qe.sectionLabel=it==null?void 0:it.sectionLabel,Qe.sectionRepeatCount=it==null?void 0:it.sectionRepeatCount,Qr("Updating chord, preserving section",{originalSection:{id:it==null?void 0:it.sectionId,label:it==null?void 0:it.sectionLabel,repeatCount:it==null?void 0:it.sectionRepeatCount}})}else{const it=o[ye]||[];let Ct;u?Ct={id:u.sectionId,label:u.sectionLabel,repeatCount:u.sectionRepeatCount}:it.length===0?Ct={id:"section-1",label:"Verse",repeatCount:""}:Ct=it[it.length-1],Qe.sectionId=Ct.id,Qe.sectionLabel=Ct.label,Qe.sectionRepeatCount=Ct.repeatCount}Qe.hasLineBreakAfter=ze.startOnNewLine||!1,Qr("Setting line break after chord",{title:Qe.title,hasLineBreakAfter:Qe.hasLineBreakAfter}),Qr("Chord data with section metadata",{chartDataWithSection:Qe});const at=We?`/api/chord-charts/${b}`:`/api/items/${ye}/chord-charts`,tt=We?"PUT":"POST";Qr(`${We?"Updating":"Creating"} chord chart`,{method:tt,url:at});const rt=await fetch(at,{method:tt,headers:{"Content-Type":"application/json"},body:JSON.stringify(Qe)});if(!rt.ok)throw new Error(`Failed to save chord chart: ${rt.statusText}`);if(We){const it=await rt.json();d(_t=>({..._t,[ye]:(_t[ye]||[]).map($t=>$t.id===b?it:$t)}));const Ct=(a[ye]||[]).map(_t=>_t.id===b?it:_t);c(_t=>({..._t,[ye]:Et(Ct)})),Zs("chord_chart_updated",{itemId:ye})}else{const it=await rt.json();d(_t=>({..._t,[ye]:[..._t[ye]||[],it]}));const Ct=[...a[ye]||[],it];c(_t=>({..._t,[ye]:Et(Ct)})),Zs("chord_chart_created",{itemId:ye})}p(it=>({...it,[ye]:!1})),m(null),w(null)}catch(We){console.error("Error saving chord chart:",We)}},tn=()=>{g.itemId&&g.chordId&&setTimeout(()=>{const ye=document.querySelector(`[data-chord-id="${g.chordId}"]`);ye?ye.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}):g.scrollPosition!==void 0&&window.scrollTo({top:g.scrollPosition,behavior:"smooth"}),_({})},100)},Ut=ye=>{if((a[ye]||[]).length===0)return;const We=window.open("","_blank");We.document.write(`
      <html>
        <head>
          <title>Chord Charts - ${s||ye}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { text-align: center; margin-bottom: 30px; }
            .section { margin-bottom: 40px; }
            .section-header { font-size: 18px; font-weight: bold; margin-bottom: 15px; }
            .chord-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 20px; }
            .chord-item { text-align: center; }
            .chord-svg { margin-bottom: 5px; }
            .chord-title { font-weight: bold; }
            @media print { body { margin: 0; } }
          </style>
        </head>
        <body>
          <h2>Chord Charts - ${s||ye}</h2>
          ${wt(ye).map(Qe=>`
            <div class="section">
              <div class="section-header">${Qe.label} ${Qe.repeatCount}</div>
              <div class="chord-grid">
                ${Qe.chords.map(at=>`
                  <div class="chord-item">
                    <div class="chord-svg">${at.svg_content||""}</div>
                    <div class="chord-title">${at.title}</div>
                  </div>
                `).join("")}
              </div>
            </div>
          `).join("")}
        </body>
      </html>
    `),We.document.close(),We.print()},pn=(ye,ze)=>{if(!ye||ye.trim().length===0)return ke(rt=>({...rt,[ze]:null})),!0;const We=ye.trim();return/^[A-Za-z0-9#bâ™­â™¯/\s,\n\r-]+$/.test(We)?We.split(/[\n\r]+/).some(rt=>{const it=rt.trim();return it.length===0?!1:/^[A-Za-z]+$/.test(it)?!0:it.split(/[,\s]+/).filter($t=>$t.trim().length>0).every($t=>/^[A-Ga-g][A-Za-z0-9#bâ™­â™¯/]*$/.test($t))})?(ke(rt=>({...rt,[ze]:null})),!0):(ke(rt=>({...rt,[ze]:'Please enter chord names separated by commas, spaces, or section names (e.g., "C, G, Am, F" or "D A G D" or "Intro")'})),!1):(ke(rt=>({...rt,[ze]:"Only chord names (A-G), numbers, #, b, â™­, â™¯, /, commas, spaces, and section names are allowed"})),!1)},wn=(ye,ze)=>{if(!(!ze||ze.length===0)){if(ze.length>5){alert("Maximum 5 files allowed. Please select fewer files.");return}C(We=>({...We,[ye]:Array.from(ze)}))}},Vr=async ye=>{var at,tt;const ze=ne[ye]||[],We=(at=H[ye])==null?void 0:at.trim(),Qe=(tt=X[ye])==null?void 0:tt.trim();if(console.log(`[AUTOCREATE] handleProcessFiles called for item ${ye}, files:`,ze.length,"youtubeUrl:",We,"manualChords:",Qe),We){await xr(ye,We);return}if(Qe)if(pn(Qe,ye)){await $r(ye,Qe);return}else return;if(ze.length===0){alert("Please add at least one file, YouTube URL, or manual chord input before processing.");return}await Ar(ye,ze)},$r=async(ye,ze)=>{console.log(`[AUTOCREATE] Processing manual chord input for item ${ye}:`,ze),Se(We=>({...We,[ye]:"processing"}));try{const We=new AbortController;Ke(Yt=>({...Yt,[ye]:We}));const Qe=new Blob([ze],{type:"text/plain"}),at=new File([Qe],"manual-input.txt",{type:"text/plain"}),tt=new FormData;tt.append("file0",at),tt.append("itemId",ye),tt.append("userChoice","chord_names"),console.log("[AUTOCREATE] Sending manual input to autocreate endpoint");const rt=await fetch("/api/autocreate-chord-charts",{method:"POST",body:tt,signal:We.signal});if(!rt.ok){let Yt=`Failed to process manual input: ${rt.statusText}`;try{const gt=await rt.json();if(gt.error&&(Yt=gt.error),gt.requires_api_key){Se(Wt=>{const ir={...Wt};return delete ir[ye],ir}),me({message:Yt,requiresApiKey:!0}),M(!0);return}}catch(gt){console.warn("Could not parse error response:",gt)}throw new Error(Yt)}const it=await rt.json();console.log("[AUTOCREATE] Manual input processed successfully:",it);const _t=await(await fetch(`/api/items/${ye}/chord-charts`)).json();d(Yt=>({...Yt,[ye]:_t})),c(Yt=>({...Yt,[ye]:Et(_t)})),pe(Yt=>({...Yt,[ye]:""})),ri(),Se(Yt=>({...Yt,[ye]:"complete"}));const $t=Lt(ye);Te({itemName:($t==null?void 0:$t.C)||`Item ${ye}`,chordCount:_t.length,contentType:"chord_names",uploadedFileNames:"Manual entry",isVisionAnalysis:!1}),Le(!0),Ke(Yt=>{const gt={...Yt};return delete gt[ye],gt}),setTimeout(()=>{Se(Yt=>({...Yt,[ye]:null})),se(Yt=>({...Yt,[ye]:!1}))},2e3)}catch(We){console.error("Error processing manual chord input:",We),Se(Qe=>({...Qe,[ye]:"error"})),Ke(Qe=>{const at={...Qe};return delete at[ye],at}),setTimeout(()=>{Se(Qe=>({...Qe,[ye]:null}))},3e3)}},xr=async(ye,ze)=>{console.log(`[YOUTUBE] Processing YouTube URL for item ${ye}:`,ze);const We=ze.trim().replace(/[<>"']/g,"");if(!/^https?:\/\/(www\.)?(youtube\.com\/watch\?v=[\w-]+|youtu\.be\/[\w-]+)(\?.*|&.*)?$/.test(We)){console.log(`[YOUTUBE] URL validation failed for: ${We}`),me({message:"Please enter a valid YouTube URL (e.g., https://youtube.com/watch?v=...)"}),M(!0);return}console.log("[YOUTUBE] URL validation passed, setting progress state"),Se(at=>({...at,[ye]:"checking_transcript"}));try{console.log("[YOUTUBE] Fetching transcript from YouTube API");const at=await fetch("/api/youtube/check-transcript",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:We})});if(!at.ok)throw new Error("Failed to fetch YouTube transcript");const tt=await at.json();if(!tt.hasTranscript||!tt.transcript){me({message:"This YouTube video does not have a transcript available. Please try a different video or use file upload instead."}),M(!0);return}console.log(`[YOUTUBE] Transcript fetched successfully, length: ${tt.transcript.length} characters`),Se(ir=>({...ir,[ye]:"processing"}));const rt=new Blob([tt.transcript],{type:"text/plain"}),it=new File([rt],"youtube_transcript.txt",{type:"text/plain"}),Ct=new FormData;Ct.append("file0",it),Ct.append("itemId",ye),Ct.append("userChoice","chord_names"),console.log("[AUTOCREATE] Sending transcript to autocreate endpoint");const _t=await fetch("/api/autocreate-chord-charts",{method:"POST",body:Ct});if(!_t.ok){const ir=await _t.text();let Pn;try{Pn=JSON.parse(ir)}catch{Pn={error:ir}}if(Pn.requires_api_key){Se(ys=>{const Cr={...ys};return delete Cr[ye],Cr}),me({message:Pn.error||"Autocreate requires an API key.",requiresApiKey:!0}),M(!0);return}throw new Error(`Failed to process YouTube transcript: ${_t.status} ${_t.statusText} - ${ir}`)}const $t=await _t.json();console.log("[AUTOCREATE] YouTube transcript processed successfully:",$t);const gt=await(await fetch(`/api/items/${ye}/chord-charts`)).json();d(ir=>({...ir,[ye]:gt})),c(ir=>({...ir,[ye]:Et(gt)})),K(ir=>({...ir,[ye]:""})),ri();const Wt=Lt(ye);Te({itemName:(Wt==null?void 0:Wt.C)||`Item ${ye}`,chordCount:gt.length,contentType:"chord_names",uploadedFileNames:"YouTube transcript",isVisionAnalysis:!1}),Le(!0)}catch(at){console.error("Error processing YouTube URL:",at),me({message:"Failed to process YouTube URL. Please try again."}),M(!0)}finally{Se(at=>{const tt={...at};return delete tt[ye],tt})}},Ar=async(ye,ze)=>{try{Se(Ct=>({...Ct,[ye]:"uploading"}));const We=new AbortController;Ke(Ct=>({...Ct,[ye]:We}));const Qe=new FormData;ze.forEach((Ct,_t)=>{Qe.append(`file${_t}`,Ct)}),Qe.append("itemId",ye);const at=2e3;let tt=!1;const rt=setTimeout(()=>{tt||Se(Ct=>({...Ct,[ye]:"processing"}))},at),it=await fetch("/api/autocreate-chord-charts",{method:"POST",body:Qe,signal:We.signal});if(it.ok){ri(),Se(gt=>({...gt,[ye]:"complete"}));const _t=await(await fetch(`/api/items/${ye}/chord-charts`)).json();d(gt=>({...gt,[ye]:_t})),c(gt=>({...gt,[ye]:Et(_t)})),C(gt=>({...gt,[ye]:[]})),Zs("autocreate_completed",{itemId:ye,fileCount:ze.length});const $t=Lt(ye),Yt=ze.map(gt=>gt.name).join(", ");Te({itemName:($t==null?void 0:$t.C)||`Item ${ye}`,chordCount:_t.length,contentType:"auto-detected",uploadedFileNames:Yt,isVisionAnalysis:!1}),Le(!0),Ke(gt=>{const Wt={...gt};return delete Wt[ye],Wt}),setTimeout(()=>{Se(gt=>({...gt,[ye]:null})),se(gt=>({...gt,[ye]:!1}))},2e3)}else{tt=!0,clearTimeout(rt);let Ct=`Failed to create chord charts: ${it.statusText}`;try{const _t=await it.json();if(_t.error&&(Ct=_t.error),_t.requires_api_key){Se($t=>{const Yt={...$t};return delete Yt[ye],Yt}),me({message:Ct,requiresApiKey:!0}),M(!0),Ke($t=>{const Yt={...$t};return delete Yt[ye],Yt});return}}catch(_t){console.warn("Could not parse error response:",_t)}me({message:Ct}),M(!0),Se(_t=>{const $t={..._t};return delete $t[ye],$t}),Ke(_t=>{const $t={..._t};return delete $t[ye],$t})}}catch(We){hasErrorOccurred=!0,clearTimeout(processingTimer),console.error("Error processing files:",We),Se(Qe=>{const at={...Qe};return delete at[ye],at}),Ke(Qe=>{const at={...Qe};return delete at[ye],at})}},dr=ye=>{(a[ye]||[]).length>0?(mt(ye),dt(!0)):se(We=>({...We,[ye]:!0}))},rs=async()=>{if(Vt)try{const ye=a[Vt]||[];for(const ze of ye)if(!(await fetch(`/api/items/${Vt}/chord-charts/${ze.id}`,{method:"DELETE"})).ok)throw new Error(`Failed to delete chord chart ${ze.id}`);d(ze=>({...ze,[Vt]:[]})),c(ze=>({...ze,[Vt]:[]})),se(ze=>({...ze,[Vt]:!0})),dt(!1),mt(null)}catch(ye){console.error("Error deleting existing chord charts:",ye)}},wr=ye=>{ot(ye),ht(!0)},Sn=ye=>{Me[ye]&&Me[ye].abort(),Se(ze=>{const We={...ze};return delete We[ye],We}),Ke(ze=>{const We={...ze};return delete We[ye],We}),C(ze=>{const We={...ze};return delete We[ye],We}),K(ze=>({...ze,[ye]:""})),pe(ze=>({...ze,[ye]:""})),se(ze=>({...ze,[ye]:!1}))},rn=ye=>{console.log("Open copy from modal for item:",ye)},kn=async ye=>{console.log("Opening copy modal for item:",ye),Z(ye);const ze=i==null?void 0:i.find(tt=>tt.B===ye),We=(ze==null?void 0:ze.C)||"",Qe=$d(We,i,ye);console.log("Source:",We),console.log("Found similar songs:",Qe.map(tt=>tt.C));const at=[ye,...Qe.map(tt=>tt.B)];console.log("Loading chord charts for relevant items:",at.length,"items");for(const tt of at)try{const rt=await fetch(`/api/items/${tt}/chord-charts`);if(rt.ok){const it=await rt.json();d(Ct=>({...Ct,[tt]:it})),console.log(`Loaded ${it.length} charts for item ${tt}`)}}catch(rt){console.error(`Error loading chord charts for item ${tt}:`,rt)}E(!0),G(""),Q(new Set),ce(null)},Wr=()=>{E(!1),Z(null),G(""),Q(new Set),k(new Set),v(!1),ce(null)},Yr=ye=>{Q(ze=>{const We=new Set(ze);if(We.has(ye))We.delete(ye);else{We.add(ye);const Qe=i==null?void 0:i.find(tt=>tt.A===ye),at=Qe==null?void 0:Qe.B;at&&zt(at)}return We})},En=async()=>{if(console.log("handleConfirmCopy called",{copySourceItemId:F,selectedTargetItems:Array.from(O)}),!F||O.size===0){console.log("Early return: missing source or targets");return}if(I.size>0&&!D){console.log("Showing overwrite confirmation, items with existing charts:",I.size),v(!0);return}try{const ye=await fetch("/api/chord-charts/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_item_id:F,target_item_ids:Array.from(O).map(at=>{const tt=i==null?void 0:i.find(rt=>rt.A===at);return tt==null?void 0:tt.B}).filter(Boolean)})});if(!ye.ok)throw new Error(`Failed to copy chord charts: ${ye.statusText}`);const ze=await ye.json();console.log("Chord charts copied successfully:",ze),ce("complete");const We=Array.from(O).map(at=>{const tt=i==null?void 0:i.find(rt=>rt.A===at);return tt==null?void 0:tt.B}).filter(Boolean),Qe=[F,...We];console.log("[DEBUG COPY] About to refresh chord charts for affected items:",Qe);for(const at of Qe)try{const tt=await fetch(`/api/items/${at}/chord-charts`);if(tt.ok){const rt=await tt.json();console.log("[DEBUG COPY] Updating chordCharts state for item",at,"with",rt.length,"charts"),d(it=>({...it,[at]:rt})),c(it=>({...it,[at]:Et(rt)}))}}catch(tt){console.error(`Error refreshing chord charts for item ${at}:`,tt)}}catch(ye){console.error("Error copying chord charts:",ye)}};if(!t)return null;const lt=e;return n.jsxs(n.Fragment,{children:[n.jsx(Qn,{open:t&&!L,onOpenChange:r,children:n.jsxs(Hn,{className:"max-w-[95vw] sm:max-w-2xl md:max-w-3xl lg:max-w-4xl max-h-[90vh] overflow-y-auto",children:[n.jsxs(Gn,{children:[n.jsxs(Vn,{className:"flex items-center gap-2",children:[n.jsx(Lh,{className:"h-5 w-5"}),"Chord Charts - ",s||e]}),n.jsx(es,{className:"sr-only",children:"View and manage chord charts for this practice item"})]}),n.jsx("div",{className:"space-y-4",children:(()=>{var at;const ye=o[lt],ze=ye?null:wt(lt),Qe=(ye||ze||[]).map((tt,rt)=>n.jsxs("div",{className:"mb-6",children:[n.jsxs("div",{className:"flex justify-between items-center mb-3",children:[n.jsx("input",{type:"text",value:tt.label,onChange:it=>{console.log("Updating section label:",tt.id,it.target.value),ar(lt,tt.id,{label:it.target.value})},className:"bg-gray-900 text-white px-2 py-1 rounded text-sm font-semibold border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Section name"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:tt.repeatCount,onChange:it=>ar(lt,tt.id,{repeatCount:it.target.value}),className:"bg-gray-900 text-white px-2 py-1 rounded text-sm w-16 text-center border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"x2",maxLength:"3"}),n.jsx("button",{onClick:()=>Ot(lt,tt.id),disabled:y.size>0,className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold transition-colors ${y.size>0?"bg-gray-500 cursor-not-allowed":"bg-red-600 hover:bg-red-700 cursor-pointer"} text-white`,title:y.size>0?"Deleting...":"Delete section",children:y.size>0?n.jsx(Or,{className:"h-3 w-3 animate-spin"}):"Ã—"})]})]}),rt===0&&(()=>{const it=tt.chords[0];if(!it)return null;const Ct=it.tuning||"EADGBE",_t=it.capo||0;return n.jsx("div",{className:"text-center text-white font-bold text-sm mb-3",children:_t>0?`${Ct} | Capo on ${_t}`:Ct})})(),tt.chords.length>0&&n.jsx("div",{className:"space-y-2",children:(()=>{const it=[];let Ct=[];return tt.chords.forEach((_t,$t)=>{Ct.push(_t),(_t.hasLineBreakAfter||Ct.length>=5||$t===tt.chords.length-1)&&(it.push([...Ct]),Ct=[])}),it.map((_t,$t)=>n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2",children:_t.map(Yt=>n.jsx(ym,{chart:Yt,onEdit:(gt,Wt)=>Xt(lt,gt),onDelete:gt=>er(lt,gt),onInsertAfter:(gt,Wt)=>Rr(lt,gt,Wt)},Yt.id))},$t))})()})]},tt.id));return n.jsxs(n.Fragment,{children:[Qe,(a[lt]||[]).length>0?n.jsx("div",{className:"flex justify-end mb-2",children:n.jsx(Be,{variant:"outline",size:"sm",onClick:rt=>{rt.stopPropagation(),Ut(lt)},className:"p-2 border-gray-600 text-gray-400 hover:text-gray-200 hover:bg-gray-600",title:"Print chord charts",children:n.jsx(Eh,{className:"h-4 w-4"})})}):null,(()=>{var Ct,_t,$t,Yt;const tt=a[lt]||[],rt=le[lt],it=re[lt];return tt.length===0?n.jsxs("div",{className:"mb-4",children:[it?n.jsx(Be,{onClick:()=>se(gt=>({...gt,[lt]:!1})),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-300 mb-2",title:"Collapse autocreate section",children:"â†"}):n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{onClick:()=>se(gt=>({...gt,[lt]:!0})),className:"max-w-md bg-gray-700 text-gray-300 hover:bg-gray-600 mb-2 flex items-center justify-center",children:[n.jsx(Ti,{className:"h-4 w-4 mr-2"}),"Autocreate Chord Charts"]})}),it&&n.jsxs("div",{className:"border border-gray-600/30 rounded-lg p-4 bg-gray-800/10",children:[n.jsxs("div",{className:"text-sm text-gray-400 mb-6",children:[n.jsx("p",{children:"â€¢ Upload lyrics with chord names to create charts"}),n.jsx("p",{children:'â€¢ Upload image or PDF of chord charts to "import"'}),n.jsx("p",{children:"â€¢ One method at a time"})]}),!rt&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 items-start",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"text-center mb-2",children:n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Upload files"})}),n.jsx("div",{className:`flex-1 p-4 border-2 border-dashed rounded-lg transition-colors cursor-pointer ${Ae[lt]?"border-gray-500 bg-gray-800/20":"border-gray-600 hover:border-gray-500 bg-gray-800/10"}`,onDragOver:gt=>{gt.preventDefault(),Re(Wt=>Wt[lt]!==!0?{...Wt,[lt]:!0}:Wt)},onDragLeave:gt=>{gt.preventDefault(),Re(Wt=>Wt[lt]!==!1?{...Wt,[lt]:!1}:Wt)},onDrop:gt=>{gt.preventDefault(),Re(Wt=>({...Wt,[lt]:!1})),wn(lt,gt.dataTransfer.files)},onClick:()=>{const gt=document.createElement("input");gt.type="file",gt.multiple=!0,gt.accept=".pdf,.png,.jpg,.jpeg",gt.onchange=Wt=>wn(lt,Wt.target.files),gt.click()},children:n.jsxs("div",{className:"text-center",children:[n.jsx(Ti,{className:`h-12 w-12 mx-auto mb-2 ${ne[lt]&&ne[lt].length>0?"text-gray-300":"text-gray-400"}`}),n.jsx("p",{className:`text-sm font-medium mb-2 ${ne[lt]&&ne[lt].length>0?"text-gray-200":"text-gray-300"}`,children:"Drop files or click"}),n.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"PDFs, images â€¢ 5mb max"}),ne[lt]&&ne[lt].length>0&&n.jsx("div",{children:n.jsxs("p",{className:"text-gray-300 text-xs font-medium mb-1",children:[ne[lt].length," file(s)"]})})]})})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"text-center mb-2",children:[n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"YouTube guitar lesson"}),n.jsx("p",{className:"text-gray-500 text-xs",children:"(video must have a transcript)"})]}),n.jsx("form",{className:"flex-1 flex flex-col justify-center",onSubmit:gt=>{var Wt;gt.preventDefault(),(Wt=H[lt])!=null&&Wt.trim()&&Vr(lt)},children:n.jsx("input",{type:"url",placeholder:"Paste YouTube URL",value:H[lt]||"",onChange:gt=>{const Wt=gt.target.value.replace(/[<>"']/g,"");K(ir=>({...ir,[lt]:Wt}))},maxLength:500,className:"w-full p-3 bg-gray-700 text-white rounded border-2 border-gray-600 focus:border-gray-500 text-sm"})})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"text-center mb-2",children:n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Manual entry"})}),n.jsxs("div",{className:"flex-1 flex flex-col justify-center relative",children:[n.jsx("textarea",{placeholder:`Enter song section names and chord names, like this:
Intro
Am7 Em/A E7sus
Verse
C G/B Am (space or comma-separated)`,value:X[lt]||"",onChange:gt=>{const Wt=gt.target.value;Wt.length<=500&&(pe(ir=>({...ir,[lt]:Wt})),pn(Wt,lt))},maxLength:500,className:`w-full p-3 text-white rounded border-2 focus:border-gray-500 text-sm resize-none min-h-[160px] ${ve[lt]?"bg-red-900/20 border-red-500":"bg-gray-700 border-gray-600"}`}),n.jsxs("div",{className:"absolute bottom-1 right-2 text-xs text-gray-400",children:[(X[lt]||"").length,"/500"]}),ve[lt]&&n.jsx("div",{className:"mt-1 text-xs text-red-400",children:ve[lt]})]})]})]}),n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{onClick:()=>Vr(lt),disabled:rt||(ne[lt]||[]).length===0&&!((Ct=H[lt])!=null&&Ct.trim())&&!((_t=X[lt])!=null&&_t.trim())||((ne[lt]||[]).length>0?1:0)+(($t=H[lt])!=null&&$t.trim()?1:0)+((Yt=X[lt])!=null&&Yt.trim()?1:0)>1,className:"px-6",children:[n.jsx(bc,{className:"h-4 w-4 mr-2"}),"Create Chord Charts"]})})]}),n.jsx("div",{className:"w-full p-6 border-2 border-dashed rounded-lg mt-4 bg-gray-800/10 border-gray-600/50",children:n.jsxs("div",{className:"text-center",children:[rt==="checking_transcripts"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-500"}),n.jsx("span",{className:"text-yellow-400",children:"Checking for transcripts..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>wr(lt),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),rt==="reading_transcript"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500"}),n.jsx("span",{className:"text-gray-400",children:"Reading transcript..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>wr(lt),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),rt==="uploading"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500"}),n.jsx("span",{className:"text-gray-400",children:"Uploading files..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>wr(lt),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),rt==="processing_transcript"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500"}),n.jsx("span",{className:"text-white",children:"Processing transcript..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>wr(lt),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),rt==="processing"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"text-white",children:je[j]}),n.jsx("div",{className:"ml-2 animate-spin",children:"âš™ï¸"})]})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>wr(lt),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),rt==="complete"&&n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx(Nn,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-green-400",children:"Chord charts created!"})]}),rt==="error"&&n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx(Rn,{className:"h-4 w-4 text-red-500"}),n.jsx("span",{className:"text-red-400",children:"Error processing files. Please try again."})]}),!rt&&n.jsx(n.Fragment,{children:a[lt]&&a[lt].length>0?n.jsxs(n.Fragment,{children:[n.jsx(Rn,{className:"h-8 w-8 text-orange-400 mx-auto mb-2"}),n.jsx("p",{className:"text-orange-300 font-medium mb-1",children:"Chord charts already exist"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Please delete all chord charts from this song before using autocreate"})]}):n.jsx(n.Fragment,{children:(ne[lt]||[]).length>0?n.jsxs(n.Fragment,{children:[n.jsx(pl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-300 font-medium mb-1",children:"Ready to create chord charts"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Click 'Create chord charts'"})]}):n.jsxs(n.Fragment,{children:[n.jsx(pl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-300 font-medium mb-1",children:"Add a file, paste a YouTube URL, or type in the 'Manual entry' box, then click 'Create Chord Charts'"}),n.jsx("p",{className:"text-gray-400 text-xs",children:"(The results will probably contain errors. Use the âœï¸edit icon on a chart to correct it.)"})]})})})]})})]})]}):n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsxs(Be,{variant:"outline",onClick:()=>dr(lt),className:"max-w-md text-orange-300 hover:bg-orange-800 hover:border-orange-600",children:[n.jsx(Ti,{className:"h-4 w-4 mr-2"}),"Replace with autocreated charts"]})})})(),n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsx(Be,{variant:"default",onClick:()=>{_({itemId:lt,scrollPosition:window.scrollY}),p(tt=>({...tt,[lt]:!0})),setTimeout(()=>{const tt=document.querySelector(`[data-editor-for-item="${lt}"]`);tt&&tt.scrollIntoView({behavior:"smooth",block:"start"})},100)},className:"min-w-48",children:"+ Add new chord"})}),n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsx(Be,{variant:"default",onClick:()=>xt(lt),className:"min-w-48",children:"+ Add new section"})}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4 max-w-2xl mx-auto",children:[n.jsx(Be,{variant:"default",onClick:()=>rn(lt),className:"flex-1",children:"Copy chord charts from other song"}),n.jsx(Be,{variant:"default",onClick:()=>kn(lt),disabled:!a[lt]||a[lt].length===0,className:"flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"Copy chord charts to other song"})]}),h[lt]&&n.jsx("div",{"data-editor-for-item":lt,children:n.jsx(Bh,{itemId:lt,defaultTuning:((at=Lt(lt))==null?void 0:at.H)||"EADGBE",editingChordId:b,insertionContext:u,onSave:tt=>bn(lt,tt),onCancel:()=>{p(tt=>({...tt,[lt]:!1})),m(null),w(null),tn()}})})]})})()}),de&&n.jsx(vc,{isOpen:de,onClose:()=>Le(!1)}),Ve&&n.jsx(Xs,{open:Ve,onOpenChange:ht,children:n.jsxs(Os,{children:[n.jsxs(Ds,{children:[n.jsx(Bs,{children:"Cancel processing?"}),n.jsx(Ms,{children:"This will stop the current autocreate operation. Any progress will be lost."})]}),n.jsxs(Rs,{children:[n.jsx(xa,{children:"Continue processing"}),n.jsx(js,{onClick:()=>{st&&Sn(st),ht(!1),ot(null)},children:"Cancel processing"})]})]})}),yt&&n.jsx(Xs,{open:yt,onOpenChange:dt,children:n.jsxs(Os,{children:[n.jsxs(Ds,{children:[n.jsxs(Bs,{className:"flex items-center space-x-2",children:[n.jsx(Rn,{className:"h-5 w-5 text-orange-500"}),n.jsx("span",{children:"Replace Existing Chord Charts"})]}),n.jsx(Ms,{children:"This song already has chord charts. To use autocreate, all existing chord charts must be deleted first. This action cannot be undone."})]}),n.jsxs(Rs,{children:[n.jsx(xa,{onClick:()=>{dt(!1),mt(null)},children:"Cancel"}),n.jsx(js,{onClick:rs,className:"bg-orange-500 hover:bg-orange-600 text-white border-orange-500 shadow-lg font-medium",children:"Delete all & autocreate"})]})]})}),n.jsx(Uh,{isOpen:z,onClose:()=>{M(!1),me(null)},error:he}),n.jsx(vc,{isOpen:de,onClose:()=>{Le(!1),Te(null)},autocreateData:Ie})]})}),L&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]",onClick:Wr,children:n.jsx("div",{className:`bg-gray-700 rounded-lg p-6 ${D||te==="complete"?"max-w-xs":"w-full max-w-md"} max-h-[80vh] flex flex-col`,onClick:ye=>ye.stopPropagation(),onWheel:ye=>ye.stopPropagation(),children:te==="complete"?n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Success!"}),n.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[n.jsx(Nn,{className:"h-6 w-6 text-green-500"}),n.jsx("span",{className:"text-green-400 text-lg",children:"Chord charts copied successfully!"})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(Be,{onClick:Wr,className:"min-w-24 bg-green-600 hover:bg-green-700",children:"Done"})})]}):D?n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"âš ï¸ Confirm Overwrite"}),n.jsxs("p",{className:"text-gray-300 mb-4",children:["This will overwrite existing chord charts on ",I.size," song",I.size!==1?"s":"",". Continue?"]}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx(Be,{variant:"outline",onClick:()=>v(!1),className:"min-w-24",children:"Cancel"}),n.jsx(Be,{onClick:En,className:"min-w-24 bg-red-600 hover:bg-red-700",children:"Overwrite"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Copy Chord Charts"}),n.jsxs("p",{className:"text-gray-300 mb-2",children:['Copy chord charts from "',((Jr=i==null?void 0:i.find(ye=>ye.B===F))==null?void 0:Jr.C)||"Unknown Song",'" to:']}),n.jsx("input",{type:"text",placeholder:"Search songs...",value:Y,onChange:ye=>G(ye.target.value),className:"w-full p-2 mb-4 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500"}),n.jsx("div",{className:"flex-1 overflow-y-auto mb-4 min-h-0 modal-scroll",children:Nt.map(ye=>n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx("input",{type:"checkbox",id:`copy-item-${ye.A}`,checked:O.has(ye.A),onChange:()=>Yr(ye.A),className:"mr-3"}),n.jsxs("label",{htmlFor:`copy-item-${ye.A}`,className:"text-white cursor-pointer flex-1 flex items-center",children:[n.jsx("span",{children:ye.C||"Untitled"}),I.has(ye.A)&&n.jsx("span",{className:"text-yellow-400 ml-2 text-sm",children:" âš ï¸will overwrite"})]})]},ye.A))}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx(Be,{variant:"outline",onClick:Wr,className:"min-w-24",children:"Cancel"}),n.jsx(Be,{onClick:En,disabled:O.size===0,style:O.size===0?{backgroundColor:"#4b5563",color:"#d1d5db",opacity:"1"}:I.size>0?{backgroundColor:"#dc2626",color:"#ffffff",opacity:"1"}:{backgroundColor:"#5b1f1f",color:"#ffffff",opacity:"1"},className:"bg-purple-600 hover:bg-purple-700 disabled:cursor-not-allowed",children:I.size>0?`Copy and Overwrite ${O.size} song${O.size!==1?"s":""}`:`Copy to ${O.size} song${O.size!==1?"s":""}`})]})]})})})]})}const cf=({className:t="h-5 w-5",title:r="Chord chart"})=>n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:t,role:"img","aria-label":r,children:[n.jsx("line",{x1:"4",y1:"6",x2:"20",y2:"6",stroke:"currentColor",strokeWidth:"1.5"}),n.jsx("line",{x1:"4",y1:"10",x2:"20",y2:"10",stroke:"currentColor",strokeWidth:"0.8"}),n.jsx("line",{x1:"4",y1:"14",x2:"20",y2:"14",stroke:"currentColor",strokeWidth:"0.8"}),n.jsx("line",{x1:"4",y1:"18",x2:"20",y2:"18",stroke:"currentColor",strokeWidth:"0.8"}),n.jsx("line",{x1:"7",y1:"6",x2:"7",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"10",y1:"6",x2:"10",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"13",y1:"6",x2:"13",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"16",y1:"6",x2:"16",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"19",y1:"6",x2:"19",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"4",y1:"6",x2:"4",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"3",y1:"3",x2:"5",y2:"5",stroke:"currentColor",strokeWidth:"1"}),n.jsx("line",{x1:"5",y1:"3",x2:"3",y2:"5",stroke:"currentColor",strokeWidth:"1"}),n.jsx("circle",{cx:"7",cy:"14",r:"1.5",fill:"currentColor"}),n.jsx("circle",{cx:"10",cy:"10",r:"1.5",fill:"currentColor"}),n.jsx("circle",{cx:"16",cy:"6",r:"1.5",fill:"currentColor"})]}),bm=Ui.memo(({item:t,onEdit:r,onDelete:e,onOpenChordCharts:s})=>{const{attributes:i,listeners:a,setNodeRef:d,transform:o,transition:c,isDragging:h}=Nl({id:t.B}),p={transform:_l.Transform.toString(o),transition:c,zIndex:h?1:0},b=async m=>{m.preventDefault(),m.stopPropagation(),await e(t.B)};return n.jsxs("div",{ref:d,style:p,className:`flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 sm:p-5 rounded-lg gap-3 ${h?"bg-gray-700":"bg-gray-800"}`,children:[n.jsxs("div",{className:"flex items-center min-w-0 flex-1",children:[n.jsx("div",{...i,...a,className:"flex-shrink-0","aria-label":"Drag to reorder item","data-ph-capture-attribute-drag":"item-drag-handle",children:n.jsx(jl,{className:"h-6 w-6 text-gray-500 mr-2 sm:mr-4 cursor-move","aria-hidden":"true"})}),n.jsx("span",{className:"text-base sm:text-xl",children:t.C})]}),n.jsxs("div",{className:"flex space-x-3 justify-end sm:justify-start flex-shrink-0",children:[n.jsxs(Be,{variant:"ghost",size:"lg",onClick:()=>r(t),className:"hover:bg-gray-700",title:"Edit item","data-ph-capture-attribute-button":"edit-item",children:[n.jsx(po,{className:"h-5 w-5","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Edit item"})]}),n.jsxs(Be,{variant:"ghost",size:"lg",onClick:()=>s(t.B,t.C),className:"text-blue-400 hover:text-blue-300 hover:bg-gray-700",title:"Add or edit chord charts","data-ph-capture-attribute-button":"open-chord-charts-modal",children:[n.jsx(cf,{className:"h-5 w-5","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Chord charts"})]}),n.jsxs(Be,{variant:"ghost",size:"lg",onClick:b,className:"text-red-500 hover:text-red-400 hover:bg-gray-700",title:"Delete this item and remove it from all routines","data-ph-capture-attribute-button":"delete-item",children:[n.jsx(Ph,{className:"h-5 w-5","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Delete item"})]})]})]})}),wm=({items:t=[],onItemsChange:r})=>{const[e,s]=U.useState(""),[i,a]=U.useState(!1),[d,o]=U.useState(!1),[c,h]=U.useState(!1),[p,b]=U.useState(null),[m,u]=U.useState(null),[w,g]=U.useState(!1),[_,y]=U.useState(null),[A,L]=U.useState(""),E=async D=>{d||u(D)},F=async()=>{if(m){a(!0);try{if(!(await fetch(`/api/items/${m}`,{method:"DELETE"})).ok)throw new Error("Failed to delete item");const v=t.find(te=>te.B===m);if(v){const te=v.C||`Item ${m}`;fo("deleted","item",te)}r()}catch(D){console.error("Delete failed:",D)}finally{a(!1),u(null)}}},Z=D=>{b(D),h(!0)},Y=(D,v)=>{y(D),L(v),g(!0)},G=async()=>{r(),b(null),h(!1)},O=()=>{o(!0)},Q=async({active:D,over:v})=>{if(o(!1),i||!D||!v||D.id===v.id)return;const te=t.findIndex(re=>re.B===D.id),ce=t.findIndex(re=>re.B===v.id);try{const se=fl(t,te,ce).map((Se,ne)=>({A:Se.B,G:ne}));if(!(await fetch("/api/items/order",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)})).ok)throw new Error("Failed to update items");r()}catch(re){console.error("Reorder failed:",re)}},I=Uc(Mi($c,{activationConstraint:{delay:100,tolerance:5}}),Mi(qc,{coordinateGetter:zc})),k=t.filter(D=>{if(!e)return!0;const v=(D==null?void 0:D.C)||"",te=se=>se.replace(/[''`]/g,"'"),ce=te(v.toLowerCase()),re=te(e.toLowerCase());return ce.includes(re)});return n.jsxs(n.Fragment,{children:[n.jsxs(ln,{className:"w-full max-w-4xl mx-auto bg-gray-900 text-gray-100",children:[n.jsxs(_n,{className:"flex flex-row items-center justify-between",children:[n.jsx(cn,{className:"text-2xl",children:"Practice items"}),n.jsx("div",{className:"flex items-center space-x-2",children:n.jsxs(Be,{className:"bg-blue-600 hover:bg-blue-700 text-lg px-4 py-6",onClick:()=>{b(null),h(!0)},"data-ph-capture-attribute-button":"add-new-item",children:[n.jsx(yo,{className:"mr-2 h-5 w-5","aria-hidden":"true"}),"Add item"]})})]}),n.jsxs(dn,{children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{htmlFor:"search-items-input",className:"sr-only",children:"Search practice items"}),n.jsx(Dr,{id:"search-items-input",type:"text",placeholder:"Search items...",value:e,onChange:D=>s(D.target.value),className:"w-full text-lg py-6 px-4",autoComplete:"off"})]}),n.jsx(cl,{sensors:I,collisionDetection:dl,onDragStart:O,onDragEnd:Q,children:n.jsx(ul,{items:k.map(D=>D.B),strategy:hl,children:n.jsx("div",{className:"space-y-4",children:k.map(D=>n.jsx(bm,{item:D,onEdit:Z,onDelete:E,onOpenChordCharts:Y},D.B))})})})]})]}),c&&n.jsx(q0,{open:c,onOpenChange:D=>{D||(b(null),h(!1))},item:p,onItemChange:G}),n.jsx(Xs,{open:!!m,onOpenChange:()=>u(null),children:n.jsxs(Os,{children:[n.jsxs(Ds,{children:[n.jsx(Bs,{children:"Are you sure?"}),n.jsx(Ms,{children:"This action cannot be undone. This will permanently delete the practice item and remove it from all routines."})]}),n.jsxs(Rs,{children:[n.jsx(xa,{children:"Cancel"}),n.jsx(js,{onClick:F,children:"Delete"})]})]})}),n.jsx(lf,{isOpen:w,onClose:()=>g(!1),itemId:_,itemTitle:A})]})},vm=()=>{const[t,r]=U.useState(null),[e,s]=U.useState(!0),[i,a]=U.useState(null),[d,o]=U.useState(0),c=async()=>{try{const p=await fetch("/api/practice/active-routine/lightweight");if(!p.ok)throw new Error("Failed to fetch active routine");const b=await p.json();if(!b.active_id){r(null),a(null),s(!1);return}const m=b.items.sort((u,w)=>parseInt(u.routineEntry.C)-parseInt(w.routineEntry.C));r({id:b.active_id,name:b.name,items:m.map(u=>({...u.routineEntry,minimalDetails:u.itemMinimal}))}),a(null)}catch(p){a(p.message),console.error("Fetch error:",p)}finally{s(!1)}},h=async()=>{o(p=>p+1)};return U.useEffect(()=>{c()},[d]),{routine:t,loading:e,error:i,refreshRoutine:h}},Nm=()=>{const[t,r]=U.useState({}),[e,s]=U.useState(new Set),[i,a]=U.useState(null),d=U.useCallback(async p=>{if(t[p])return t[p];if(e.has(p))return null;try{s(u=>new Set([...u,p])),a(null);const b=await fetch(`/api/items/${p}`);if(!b.ok)throw new Error(`Failed to fetch item details: ${b.statusText}`);const m=await b.json();return r(u=>({...u,[p]:m})),m}catch(b){return a(b.message),console.error("Error fetching item details:",b),null}finally{s(b=>{const m=new Set(b);return m.delete(p),m})}},[t,e]),o=U.useCallback(p=>t[p]||null,[t]),c=U.useCallback(p=>e.has(p),[e]),h=U.useCallback(()=>{r({}),s(new Set),a(null)},[]);return{fetchItemDetails:d,getItemDetails:o,isLoadingItem:c,error:i,clearCache:h}},_m=(t,r)=>{let e;return function(...i){const a=()=>{clearTimeout(e),t(...i)};clearTimeout(e),e=setTimeout(a,r)}},jm=({className:t,...r})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,"aria-hidden":"true",...r,children:n.jsx("path",{d:"M8 5v14l11-7z"})}),Sm=({className:t,...r})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,"aria-hidden":"true",...r,children:n.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}),Wd=({className:t,...r})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:t,"aria-hidden":"true",...r,children:n.jsx("path",{d:"M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),Hd=t=>{const r=Math.floor(t/60),e=Math.floor(t%60);return`${r}:${e.toString().padStart(2,"0")}`},Gd=t=>{const r=Math.floor(t/60),e=t%60;return`${r.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`},km=U.memo(({chart:t,onEdit:r,onDelete:e,onInsertAfter:s})=>{const i=U.useRef(null);return U.useEffect(()=>{if(!i.current)return;(()=>{if(!(!window.svguitar||!i.current))try{const d=t.chordData||t;i.current.innerHTML="";const o=new window.svguitar.SVGuitarChord(i.current),c={strings:d.numStrings||6,frets:d.numFrets||5,position:d.startingFret||1,tuning:[],width:176,height:248,fretSize:1.2,fingerSize:.75,sidePadding:.2,fontFamily:"Arial",color:"#ffffff",backgroundColor:"transparent",strokeColor:"#ffffff",textColor:"#ffffff",fretLabelColor:"#ffffff",fingerTextColor:"#000000",fingerTextSize:28},b={fingers:[...(d.fingers||[]).map(m=>{const[u,w,g]=m;return g&&g!=="undefined"?[u,w,g]:[u,w]}),...(d.openStrings||[]).map(m=>[m,0]),...(d.mutedStrings||[]).map(m=>[m,"x"])],barres:d.barres||[]};o.configure(c).chord(b).draw(),setTimeout(()=>{var u;const m=(u=i.current)==null?void 0:u.querySelector("svg");m&&(m.style.width="100%",m.style.height="100%",m.style.maxWidth="144px",m.style.maxHeight="154px",m.style.position="relative",m.style.zIndex="1",m.setAttribute("role","img"),m.setAttribute("aria-label",Cm(t)))},50)}catch(d){console.error("Error rendering memoized chord chart:",d)}})()},[t]),n.jsxs("div",{className:"bg-gray-800 p-1 rounded-lg relative","data-chord-id":t.id,style:{minWidth:"0",maxWidth:"100%",width:"100%",position:"relative"},children:[n.jsx("button",{onClick:a=>{a.stopPropagation(),r(t.id,t)},className:"absolute bottom-1 left-1 w-6 h-6 text-gray-400 hover:text-gray-200 flex items-center justify-center text-sm transition-colors cursor-pointer z-20 bg-gray-900 bg-opacity-75 rounded shadow-lg",title:"Edit chord chart",style:{position:"absolute",bottom:"4px",left:"4px",zIndex:20},"aria-label":"Edit chord chart","data-ph-capture-attribute-button":"edit-chord-chart",children:"âœï¸"}),n.jsx("button",{onClick:a=>{a.stopPropagation(),e(t.id)},className:"absolute bottom-1 right-1 w-6 h-6 text-red-500 hover:text-red-700 flex items-center justify-center text-lg font-black transition-colors cursor-pointer z-20 bg-gray-900 bg-opacity-75 rounded shadow-lg",title:"Delete chord chart",style:{position:"absolute",bottom:"4px",right:"4px",zIndex:20},"aria-label":"Delete chord chart","data-ph-capture-attribute-button":"delete-chord-chart",children:"Ã—"}),s&&n.jsx("button",{onClick:a=>{a.stopPropagation(),s(t.id,t)},className:"absolute bottom-1 right-8 w-6 h-6 bg-blue-500 hover:bg-blue-400 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors cursor-pointer z-20 shadow-lg",title:"Insert chord after this one",style:{position:"absolute",bottom:"4px",right:"32px",zIndex:20},"aria-label":"Insert chord after this one","data-ph-capture-attribute-button":"insert-chord-after",children:"+"}),n.jsx("div",{className:"relative mx-auto flex items-center justify-center overflow-hidden",style:{width:"144px",height:"154px"},children:n.jsx("div",{ref:i,className:"w-full h-full"})}),n.jsx("div",{className:"text-sm font-semibold mt-2 text-center text-gray-300",children:t.title})]})}),Cm=t=>{const r=t.chordData||t,s=[`${t.title||"Chord"} chord diagram.`],i=r.fingers||[];if(i.length>0){const c=i.map(h=>{const[p,b,m]=h,u=7-p,w=m?` with finger ${m}`:"";return`string ${u} fret ${b}${w}`});s.push(`Finger positions: ${c.join(", ")}.`)}const a=r.openStrings||[];if(a.length>0){const c=a.map(h=>7-h).sort((h,p)=>h-p);s.push(`Open strings: ${c.join(", ")}.`)}const d=r.mutedStrings||[];if(d.length>0){const c=d.map(h=>7-h).sort((h,p)=>h-p);s.push(`Muted strings: ${c.join(", ")}.`)}const o=r.barres||[];if(o.length>0){const c=o.map(h=>{const p=7-h.fromString,b=7-h.toString;return`Barre at fret ${h.fret} from string ${p} to ${b}`});s.push(`${c.join(". ")}.`)}return s.join(" ")},Ei=t=>t.replace(/[''`"]/g,"'").replace(/[â€“â€”âˆ’]/g,"-").replace(/\s+/g," ").trim().toLowerCase(),Vd=t=>t.replace(/\s*\([^)]*\)\s*/g,"").trim(),Vl=(t,r,e)=>{const s=Vd(t),i=Ei(s);return console.log("DEBUG: findSimilarSongs - sourceTitle:",t,"-> baseName:",s,"-> normalized:",i),r.filter(a=>{if(a.B===e)return!1;const d=a.C||"",o=Vd(d),c=Ei(o),h=i===c||i.length>3&&c.includes(i)||c.length>3&&i.includes(c);return(d.toLowerCase().includes("feelin")||d.toLowerCase().includes("alright"))&&(console.log("DEBUG: Checking item:",d,"-> itemBaseName:",o,"-> normalized:",c,"-> matches:",h),console.log("  normalizedBaseName:",i),console.log("  normalizedItemBaseName:",c)),h})},Am=()=>{var qt,Kt,or;const{routine:t}=vm(),{fetchItemDetails:r,getItemDetails:e,isLoadingItem:s}=Nm();zi();const{items:i}=Rh(),[a,d]=U.useState(new Set),[o,c]=U.useState(new Set),[h,p]=U.useState(new Set),[b,m]=U.useState({}),[u,w]=U.useState(!1),[g,_]=U.useState(null),[y,A]=U.useState({}),[L,E]=U.useState(new Set),[F,Z]=U.useState({}),[Y,G]=U.useState({}),[O,Q]=U.useState({}),[I,k]=U.useState(new Set),[D,v]=U.useState(null),[te,ce]=U.useState(null),[re,se]=U.useState(null),[le,Se]=U.useState(!1),[ne,C]=U.useState(null),[H,K]=U.useState(""),[X,pe]=U.useState(new Set),[ve,ke]=U.useState(new Set),[Ae,Re]=U.useState(!1),[Me,Ke]=U.useState(!1),[je,j]=U.useState(null),[P,V]=U.useState({}),[$,z]=U.useState(null),[M,he]=U.useState(!1),[me,de]=U.useState(""),[Le,Ie]=U.useState(null),[Te,Ve]=U.useState(null),[ht,st]=U.useState({}),[ot,yt]=U.useState({}),[dt,Vt]=U.useState({}),[mt,Lt]=U.useState(0),[zt,Et]=U.useState([]),[wt,Jt]=U.useState(!1),[Nt,Ft]=U.useState(!1),[ar,Ot]=U.useState(""),[xt,Xt]=U.useState(null),[er,Rr]=U.useState({}),[bn,tn]=U.useState(!1),[Ut,pn]=U.useState(null),[wn,Vr]=U.useState(!1),[$r,xr]=U.useState(null),[Ar,dr]=U.useState(!1),[rs,wr]=U.useState(null),[Sn,rn]=U.useState(!1),[kn,Wr]=U.useState(null),[Yr,En]=U.useState({}),[lt,Jr]=U.useState({}),[ye,ze]=U.useState({}),[We,Qe]=U.useState(!1),[at,tt]=U.useState(null),[rt,it]=U.useState(""),[Ct,_t]=U.useState(!1),[$t,Yt]=U.useState(!1),[gt,Wt]=U.useState(null),ir=["âœ¨ Claude is making magic happen","âœ¨ Claude is *still* making magic happen","Yeah, we all love instant gratification, but it'll still be quicker than you could do it from scratch","Are you familiar with the phrase 'A watched pot never boils'? It's kinda like that","Chill, I'm working on it.","You could be stretching or something while you wait, couldn't you?","The pyramids weren't built in a day... ","but hey, at least I'm not going to ask you for an email address to send the chord charts to.","Perfect chord charts take time to craft. These will take less time and they won't be perfect.","Yeah, I could show you a progress bar, but we both know it would just lie to you","This is taking precisely as long as it needs to take","Meanwhile, your guitar is getting dusty just sitting there...","Quality over speed, as they say in the chord chart business. We'll see which this turns out to be","Calculating the optimal finger placement for maximum laziness...","Teaching AI to read guitar tabs is harder than teaching humans, surprisingly","Processing at the speed of artisanal chord crafting","Your patience is being converted into beautiful chord diagrams","Still faster than drawing the chord charts by hand","Fun fact: I process thousands of tokens per second, but this still takes a while. Go figure.","At least you're not on hold listening to elevator music right now","I'd apologize for the wait, but I'm kinda busy with building your chord charts","Remember when you had to buy chord books? Yeah, this is still better than that","I'm doing math that would make your guitar teacher's head spin. Or maybe just mild geometry.","Analyzing fret positions with the intensity of a guitarist tuning by ear in a loud bar","If you're wondering why this takes so long: perfectionism. Just kidding, it's token processing limits.","Good news: I found all the chords. Bad news: I'm still drawing the little dots","Pro tip: This wait time is perfect for questioning your life choices that led to learning Wonderwall","Yes, I could work faster, but then where would the suspense be?","Translating guitar hieroglyphics into something your fingers can actually use...","Automating what should have been automated decades ago. You're welcome.","The AI is thinking. Or maybe procrastinating. Hard to tell, really.","Breaking news: Local AI still processing, guitarist growing older by the second","This would go faster if you stopped watching. Seriously, go practice your scales or something.","Reminder: You could have practiced barre chords for 2 minutes by now. Just saying.","I promise this is the most interesting thing happening on your screen right now. Probably.","Currently debating whether that's a Cadd9 or just someone's finger slipped on the photo"],Pn=T=>{const ue=F[T]||[];if(console.log(`[DEBUG] getChordSections for item ${T}:`,ue),ue.length===0)return[];const ge=new Map;return ue.forEach(fe=>{const Ne=fe.sectionId||"section-1",Fe=fe.sectionLabel||"Verse",qe=fe.sectionRepeatCount||"";console.log(`[DEBUG] Processing chord ${fe.id} (${fe.title}) for section ${Ne}`,{chordSectionId:fe.sectionId,chordSectionLabel:fe.sectionLabel,fallbackUsed:!fe.sectionId}),ge.has(Ne)||ge.set(Ne,{id:Ne,label:Fe,repeatCount:qe,chords:[]}),ge.get(Ne).chords.push(fe)}),Array.from(ge.values())},ys=T=>{if(T.length===0)return[];const ue=new Map;T.forEach(xe=>{const fe=xe.sectionId||"section-1",Ne=xe.sectionLabel||"Verse",Fe=xe.sectionRepeatCount||"";ue.has(fe)||ue.set(fe,{id:fe,label:Ne,repeatCount:Fe,chords:[]}),ue.get(fe).chords.push(xe)});const ge=Array.from(ue.values()).sort((xe,fe)=>{const Ne=Math.min(...xe.chords.map(qe=>qe.order||0)),Fe=Math.min(...fe.chords.map(qe=>qe.order||0));return Ne-Fe});return ge.forEach(xe=>{xe.chords.sort((fe,Ne)=>(fe.order||0)-(Ne.order||0))}),ge},Cr=(T,ue="New Section")=>{console.log("Adding new section for item:",T,"with label:",ue);const ge={id:`section-${Date.now()}`,label:ue,repeatCount:"",chords:[]};Q(xe=>{const fe={...xe,[T]:[...xe[T]||[],ge]};return console.log("Updated chordSections:",fe),fe})},He=U.useCallback(_m(async(T,ue,ge)=>{console.log("Debounced section update:",ue,ge);try{const xe=await fetch(`/api/items/${T}/chord-charts`);if(!xe.ok)throw new Error(`Failed to fetch chord charts for item ${T}`);const Ne=await xe.json();console.log(`[DEBUG] Fresh charts for item ${T}:`,Ne.map(Je=>({id:Je.id,title:Je.title,sectionId:Je.sectionId||"default-section"})));const Fe=Ne.filter(Je=>(Je.sectionId||"section-1")===ue);if(Fe.length===0){console.log(`No chord charts to update for section: ${ue}. This might be a new section without any chord charts yet.`);return}console.log(`Updating ${Fe.length} chord charts for section ${ue}:`,Fe.map(Je=>Je.id));const qe=Fe.map(Je=>{const ut={};return ge.label!==void 0&&(ut.sectionLabel=ge.label),ge.repeatCount!==void 0&&(ut.sectionRepeatCount=ge.repeatCount),console.log(`Updating chord chart ${Je.id} with:`,ut),fetch(`/api/chord-charts/${Je.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ut)}).then(Xe=>{if(!Xe.ok)throw new Error(`Failed to update chord chart ${Je.id}: ${Xe.status} ${Xe.statusText}`);return Xe.json()})});await Promise.all(qe),console.log(`Successfully persisted ${Fe.length} chord charts for section ${ue}`)}catch(xe){console.error("Error persisting section updates:",xe)}},500),[]),ft=(T,ue,ge)=>{Q(xe=>({...xe,[T]:(xe[T]||[]).map(fe=>fe.id===ue?{...fe,...ge}:fe)})),Z(xe=>({...xe,[T]:(xe[T]||[]).map(fe=>(fe.sectionId||"section-1")===ue?{...fe,sectionLabel:ge.label!==void 0?ge.label:fe.sectionLabel,sectionRepeatCount:ge.repeatCount!==void 0?ge.repeatCount:fe.sectionRepeatCount}:fe)})),He(T,ue,ge)},ur=async(T,ue)=>{if(!T){console.error("ERROR: deleteSection called with empty itemId",{itemId:T,sectionId:ue});return}const ge=`${T}-${ue}`;if(I.has(ge)){console.log(`Delete already in progress for section ${ue}`);return}k(xe=>new Set([...xe,ge]));try{const xe=(F[T]||[]).filter(qe=>(qe.sectionId||"section-1")===ue);if(xe.length===0){console.log(`No chord charts to delete in section ${ue}`),Q(qe=>({...qe,[T]:(qe[T]||[]).filter(Je=>Je.id!==ue)}));return}const fe=xe.map(qe=>qe.id);console.log(`Batch deleting ${xe.length} chord charts from section ${ue}:`,fe),console.log(`DEBUG: Sending item_id=${T} to batch-delete endpoint`);const Ne=await fetch("/api/chord-charts/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chord_ids:fe,item_id:T})});if(!Ne.ok){if(Ne.status===429){const qe=await Ne.json();console.warn("Rate limit exceeded, will retry after delay"),alert(`Rate limit exceeded. Please wait a moment and try again. (${qe.error})`);return}throw new Error(`HTTP ${Ne.status}: Failed to batch delete chord charts`)}const Fe=await Ne.json();if(console.log("Batch delete result:",Fe),Fe.deleted&&Fe.deleted.length>0&&console.log(`Successfully deleted ${Fe.deleted.length} chord charts`),Fe.not_found&&Fe.not_found.length>0&&console.warn(`${Fe.not_found.length} chord charts were already deleted:`,Fe.not_found),Fe.failed&&Fe.failed.length>0&&console.error(`Failed to delete ${Fe.failed.length} chord charts:`,Fe.failed),Z(qe=>({...qe,[T]:(qe[T]||[]).filter(Je=>(Je.sectionId||"section-1")!==ue)})),Q(qe=>({...qe,[T]:(qe[T]||[]).filter(Je=>Je.id!==ue)})),!Fe.success&&Fe.failed&&Fe.failed.length===fe.length)throw new Error(Fe.error||"All chord chart deletions failed")}catch(xe){console.error("Error deleting section:",xe)}finally{k(xe=>{const fe=new Set(xe);return fe.delete(ge),fe})}},Hr=U.useCallback(async()=>{if(console.log("[DEBUG BATCH] loadAllChordCharts called"),!t||!t.items)return;const T=t.items.map(ge=>ge.B),ue=T.filter(ge=>!F[ge]);if(console.log("[DEBUG BATCH] All routine items:",T,"Items needing loading:",ue,"Current chordCharts keys:",Object.keys(F)),ue.length!==0)try{const ge=await fetch("/api/chord-charts/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_ids:ue})});if(ge.ok){const fe=await ge.json();Z(Ne=>({...Ne,...fe})),Object.entries(fe).forEach(([Ne,Fe])=>{if(Fe.length===0)Q(qe=>({...qe,[Ne]:[]}));else{const qe=new Map;Fe.forEach(ut=>{const Xe=ut.sectionId||"section-1",ct=ut.sectionLabel||"Verse",we=ut.sectionRepeatCount||"";qe.has(Xe)||qe.set(Xe,{id:Xe,label:ct,repeatCount:we,chords:[]}),qe.get(Xe).chords.push(ut)});const Je=Array.from(qe.values());Q(ut=>({...ut,[Ne]:Je}))}})}}catch(ge){console.error("Error batch loading chord charts:",ge)}},[t]);U.useEffect(()=>{console.log("[DEBUG EFFECT] useEffect triggered for routine/loadAllChordCharts"),t&&t.items&&(Hr(),S0(t.name))},[t,Hr]),U.useEffect(()=>{if(X.size>0){const T=new Set;X.forEach(ue=>{const ge=i==null?void 0:i.find(Ne=>Ne.A===ue),xe=ge==null?void 0:ge.B;(F[xe]||[]).length>0&&T.add(ue)}),ke(T)}else ke(new Set)},[X,F,i]),U.useEffect(()=>{if(Object.values(P).filter(fe=>fe==="processing").length===0){Lt(0),Et([]);return}Lt(0);const ge=Array.from({length:ir.length-1},(fe,Ne)=>Ne+1).sort(()=>Math.random()-.5);Et(ge);const xe=setInterval(()=>{Et(fe=>{if(fe.length===0){const Fe=Array.from({length:ir.length},(ut,Xe)=>Xe).sort(()=>Math.random()-.5),qe=Fe[0],Je=Fe.slice(1);return Lt(qe),Je}else{const Ne=fe[0],Fe=fe.slice(1);return Lt(Ne),Fe}})},1e4);return()=>clearInterval(xe)},[P,ir.length]);const Ur=async T=>{if(!F[T])try{const ue=await fetch(`/api/items/${T}/chord-charts`);if(ue.ok){const ge=await ue.json(),xe=ge;if(Z(Ne=>({...Ne,[T]:xe})),xe.length===0){Q(Ne=>({...Ne,[T]:[]}));return}const fe=new Map;xe.forEach(Ne=>{const Fe=Ne.sectionId||"section-1",qe=Ne.sectionLabel||"Verse",Je=Ne.sectionRepeatCount||"";fe.has(Fe)||fe.set(Fe,{id:Fe,label:qe,repeatCount:Je,chords:[]}),fe.get(Fe).chords.push(Ne)}),Q(Ne=>({...Ne,[T]:Array.from(fe.values())})),console.log("[DEBUG] Loaded chord charts for item:",T,ge.length)}}catch(ue){console.error("Error loading chord charts for item:",T,ue)}},Lr=U.useMemo(()=>t!=null&&t.items?new Set(t.items.filter(T=>T.D==="TRUE").map(T=>T.A)):new Set,[t]),[Yn,ba]=U.useState(new Set),Kr=U.useRef(null),wa=U.useRef(null),Ir=U.useRef(null),va=U.useRef(null);U.useEffect(()=>{Kr.current=new(window.AudioContext||window.webkitAudioContext),wa.current=Kr.current.createGain();const T=localStorage.getItem("gpra_timer_volume"),ue=T!==null?parseFloat(T):5.5;return wa.current.gain.value=ue/11*3,wa.current.connect(Kr.current.destination),fetch("/static/sound/timesUp.mp3").then(ge=>ge.arrayBuffer()).then(ge=>Kr.current.decodeAudioData(ge)).then(ge=>{va.current=ge}).catch(ge=>console.error("Error loading sound:",ge)),()=>{Kr.current&&Kr.current.close()}},[]),U.useEffect(()=>{const T=setInterval(()=>{A(ue=>{const ge={...ue};let xe=!1;return h.forEach(fe=>{ge[fe]>0&&(ge[fe]=ge[fe]-1,xe=!0,ge[fe]===0&&(Ir.current&&Ir.current.stop(),va.current&&Kr.current&&(Ir.current=Kr.current.createBufferSource(),Ir.current.buffer=va.current,Ir.current.connect(wa.current),Ir.current.start(),console.log("[AUDIO] Timer completion sound played"))))}),xe?ge:ue})},1e3);return console.log("Timer effect: Active timers:",Array.from(h)),()=>{clearInterval(T),Ir.current&&(Ir.current.stop(),Ir.current=null)}},[h]),U.useEffect(()=>{ba(Lr)},[Lr]);const Na=U.useCallback(async T=>{try{const ue=await fetch(`/api/items/${T}/notes`);if(!ue.ok)throw new Error("Failed to fetch notes");const ge=await ue.json();ge.notes&&m(xe=>({...xe,[T]:ge.notes}))}catch(ue){console.error("Error fetching notes:",ue)}},[]),$s=U.useMemo(()=>{if(!ne||!i)return new Set;const T=i.find(xe=>xe.B===ne),ue=(T==null?void 0:T.C)||"",ge=i.filter(xe=>xe.B!==ne);return new Set(Vl(ue,ge,ne).map(xe=>xe.A))},[ne,i]),Ws=U.useMemo(()=>i?i.filter(T=>{if(T.B===ne)return!1;if(H.trim()){const ue=T.C||"",ge=Ei(ue),xe=Ei(H);return xe?(console.log(`DEBUG SEARCH: "${H}" -> "${xe}" searching in "${ue}" -> "${ge}" -> match: ${ge.includes(xe)}`),ge.includes(xe)):!0}return!0}).sort((T,ue)=>{if(H.trim()){const Fe=T.C||"",qe=ue.C||"";return Fe.localeCompare(qe)}const ge=$s.has(T.A),xe=$s.has(ue.A);if(ge&&!xe)return-1;if(!ge&&xe)return 1;const fe=T.C||"",Ne=ue.C||"";return fe.localeCompare(Ne)}):[],[i,ne,H,$s]),$a=U.useMemo(()=>{if(!Te||!i)return new Set;const T=i.find(xe=>xe.B===Te),ue=(T==null?void 0:T.C)||"",ge=i.filter(xe=>xe.B!==Te);return new Set(Vl(ue,ge,Te).map(xe=>xe.A))},[Te,i]),di=U.useMemo(()=>i?i.filter(T=>{if(T.B===Te)return!1;if(me.trim()){const ue=T.C||"",ge=Ei(ue),xe=Ei(me);return xe?ge.includes(xe):!0}return!0}).sort((T,ue)=>{if(me.trim()){const Fe=T.C||"",qe=ue.C||"";return Fe.localeCompare(qe)}const ge=$a.has(T.A),xe=$a.has(ue.A);if(ge&&!xe)return-1;if(!ge&&xe)return 1;const fe=T.C||"",Ne=ue.C||"";return fe.localeCompare(Ne)}):[],[i,Te,me,$a]),[ra,_a]=U.useState({});U.useEffect(()=>{M&&i&&Object.keys(ra).length===0&&(async()=>{const ue={},ge=i.map(xe=>xe.B);try{const xe=await fetch("/api/chord-charts/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_ids:ge})});if(xe.ok){const fe=await xe.json();Object.entries(fe).forEach(([Ne,Fe])=>{ue[Ne]=(Fe||[]).length}),_a(ue)}}catch(xe){console.error("Error loading chord chart counts:",xe)}})()},[M,i,ra]);const ui=U.useMemo(()=>di.filter(T=>{const ue=T.B;return ra[ue]>0}),[di,ra]);U.useEffect(()=>{const T=ue=>{ue.key==="Escape"&&(le?Jn():M?Sa():Me?(Ke(!1),j(null)):bn?tn(!1):wn?Vr(!1):wt?Jt(!1):Ar?dr(!1):We?(Qe(!1),tt(null),it("")):Ct&&_t(!1))};return document.addEventListener("keydown",T),()=>document.removeEventListener("keydown",T)},[le,M,Me,bn,wn,wt,Ar,We,Ct]);const Bn=U.useCallback((T,ue)=>{console.log(`Initializing timer for item ${T} with duration ${ue} minutes`),A(ge=>ge[T]?ge:{...ge,[T]:ue*60})},[]),hi=async T=>{d(ue=>{const ge=new Set(ue);if(ge.has(T))ge.delete(T);else{ge.add(T);const xe=t.items.find(fe=>fe.A===T);if(xe){const fe=xe.B;r(fe).then(Ne=>{Ne&&(Bn(T,Ne.E||5),Na(fe))})}}return ge})},ks=async(T,ue=!0)=>{const ge=t.items.find(xe=>xe.A===T);if(ge){if(ue&&Kr.current&&Kr.current.state==="suspended")try{await Kr.current.resume(),console.log("[AUDIO] AudioContext resumed after user interaction")}catch(xe){console.error("[AUDIO] Failed to resume AudioContext:",xe)}if(Ir.current&&Ir.current.stop(),!y[T]){console.log(`Timer ${T} not found, initializing...`);const xe=e(ge.B),fe=(xe==null?void 0:xe.E)||5;Bn(T,fe)}p(xe=>{const fe=new Set(xe),Ne=e(ge.B),Fe=(Ne==null?void 0:Ne.C)||`Item ${T}`;return console.log(`Activating timer ${T}`),fe.add(T),$o("started_timer",Fe),fe})}},Wa=async()=>{localStorage.setItem("timerSoundModalDismissed","true"),sessionStorage.setItem("timerSoundModalDismissedSession","true"),window.posthog&&window.posthog.capture("timer_sound_modal_dismissed",{action:"got_it",$set:{timer_sound_modal_dismissed:!0}}),Yt(!1),gt&&(await ks(gt,!0),Wt(null))},fi=async()=>{sessionStorage.setItem("timerSoundModalDismissedSession","true"),Yt(!1),gt&&(await ks(gt,!0),Wt(null))},Ht=async(T,ue)=>{ue==null||ue.stopPropagation();const ge=t.items.find(xe=>xe.A===T);if(ge)if(h.has(T))Ir.current&&Ir.current.stop(),p(fe=>{const Ne=new Set(fe),Fe=e(ge.B),qe=(Fe==null?void 0:Fe.C)||`Item ${T}`;console.log(`Deactivating timer ${T}`),Ne.delete(T);const Je=((Fe==null?void 0:Fe.E)||5)*60,ut=y[T]||Je,Xe=Je-ut;return $o("timer_stopped",qe,{time_elapsed_seconds:Math.max(0,Xe),initial_duration_minutes:(Fe==null?void 0:Fe.E)||5}),Ne});else{if(Kr.current&&Kr.current.state==="suspended")try{await Kr.current.resume(),console.log("[AUDIO] AudioContext state after resume:",Kr.current.state)}catch(Fe){console.log("[AUDIO] Resume failed:",Fe)}const fe=localStorage.getItem("timerSoundModalDismissed")==="true",Ne=sessionStorage.getItem("timerSoundModalDismissedSession")==="true";fe||Ne?await ks(T,!0):(console.log("[AUDIO] First timer start this session, showing sound info modal"),Wt(T),Yt(!0))}},pi=async(T,ue)=>{ue==null||ue.stopPropagation();const ge=!Yn.has(T);try{const xe=await fetch(`/api/routines/${t.id}/items/${T}/complete`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:ge})});if(!xe.ok)throw new Error("Failed to update completion state");(await xe.json()).success&&ba(Ne=>{const Fe=new Set(Ne);if(ge){Fe.add(T);const qe=t.items.find(ut=>ut.A===T);if(qe){const ut=e(qe.B),Xe=(ut==null?void 0:ut.C)||`Item ${T}`,ct=((ut==null?void 0:ut.E)||5)*60,we=y[T]||ct,bt=ct-we;$o("marked_done",Xe,{time_elapsed_seconds:Math.max(0,bt),was_timer_active:h.has(T),initial_duration_minutes:(ut==null?void 0:ut.E)||5})}p(ut=>{const Xe=new Set(ut);return Xe.delete(T),Xe});const Je=t.items.findIndex(ut=>ut.A===T);d(ut=>{const Xe=new Set(ut);if(Xe.delete(T),Je<t.items.length-1){const ct=t.items[Je+1];Xe.add(ct.A);const we=ct.B;r(we).then(bt=>{bt&&(Bn(ct.A,bt.E||5),Na(we))})}return Xe})}else Fe.delete(T);return Fe})}catch(xe){console.error("Error updating completion state:",xe)}},mi=async(T,ue)=>{if(ue==null||ue.stopPropagation(),Kr.current&&Kr.current.state==="suspended")try{await Kr.current.resume(),console.log("[AUDIO] AudioContext resumed after user interaction")}catch(xe){console.error("[AUDIO] Failed to resume AudioContext:",xe)}Ir.current&&Ir.current.stop();const ge=t.items.find(xe=>xe.A===T);if(ge){const xe=e(ge.B),fe=(xe==null?void 0:xe.E)||5,Ne=(xe==null?void 0:xe.C)||`Item ${T}`;A(Fe=>({...Fe,[T]:fe*60})),$o("timer_reset",Ne)}},$i=async(T,ue)=>{ue==null||ue.stopPropagation(),_(T),w(!0)},Cs=async()=>{await Na(g),_(null)},bs=(T,ue)=>{ue==null||ue.stopPropagation(),c(ge=>{const xe=new Set(ge);return xe.has(T)?xe.delete(T):xe.add(T),xe})},Wi=async T=>{T==null||T.stopPropagation();try{if(!(await fetch(`/api/routines/${t.id}/reset`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to reset progress");ba(new Set)}catch(ue){console.error("Error resetting progress:",ue)}},{totalMinutes:Hi,completedMinutes:na}=U.useMemo(()=>{if(!(t!=null&&t.items))return{totalMinutes:0,completedMinutes:0};const T=t.items.reduce((ge,xe)=>{const fe=e(xe.B),Ne=parseInt(fe==null?void 0:fe.E)||5;return ge+Ne},0),ue=t.items.filter(ge=>Yn.has(ge.A)).reduce((ge,xe)=>{const fe=e(xe.B),Ne=parseInt(fe==null?void 0:fe.E)||5;return ge+Ne},0);return{totalMinutes:T,completedMinutes:ue}},[t,Yn,e]);U.useEffect(()=>{if(!window.svguitar){const T=document.createElement("script");T.src="https://omnibrain.github.io/svguitar/js/svguitar.umd.js",T.async=!0,document.body.appendChild(T)}},[]);const ja=(T,ue)=>{ue==null||ue.stopPropagation(),E(ge=>{const xe=new Set(ge);if(xe.has(T))xe.delete(T);else{xe.add(T);const fe=t.items.find(Ne=>Ne.A===T);if(fe){const Ne=fe.B;Ur(Ne)}}return xe})},sa=async(T,ue)=>{var ge;try{zd("Saving chord chart for item",{itemId:T,chartData:ue}),Qr("PracticePage handleSaveChordChart called",{editingChordId:D,chartData:ue});const xe=ue.editingChordId;Qr("PracticePage isUpdate check result",{isUpdate:xe,editingChordIdFromState:D,editingChordIdFromChartData:ue.editingChordId});let fe={...ue};if(xe){const Xe=(F[T]||[]).find(ct=>ct.id===ue.editingChordId);fe.sectionId=Xe==null?void 0:Xe.sectionId,fe.sectionLabel=Xe==null?void 0:Xe.sectionLabel,fe.sectionRepeatCount=Xe==null?void 0:Xe.sectionRepeatCount,Qr("Updating chord, preserving section",{originalSection:{id:Xe==null?void 0:Xe.sectionId,label:Xe==null?void 0:Xe.sectionLabel,repeatCount:Xe==null?void 0:Xe.sectionRepeatCount}})}else{const Xe=O[T]||Pn(T);let ct;ue.insertionContext?ct={id:ue.insertionContext.sectionId,label:ue.insertionContext.sectionLabel,repeatCount:ue.insertionContext.sectionRepeatCount}:Xe.length===0?ct={id:"section-1",label:"Verse",repeatCount:""}:ct=Xe[Xe.length-1],fe.sectionId=ct.id,fe.sectionLabel=ct.label,fe.sectionRepeatCount=ct.repeatCount}fe.hasLineBreakAfter=ue.startOnNewLine||!1,Qr("Setting line break after chord",{title:fe.title,hasLineBreakAfter:fe.hasLineBreakAfter}),Qr("Chord data with section metadata",{chartDataWithSection:fe});const Ne=xe?`/api/chord-charts/${ue.editingChordId}`:`/api/items/${T}/chord-charts`,Fe=xe?"PUT":"POST";Qr(`${xe?"Updating":"Creating"} chord chart`,{method:Fe,url:Ne}),console.log("[DEBUG LINE BREAKS] Sending to server:",{title:fe.title,hasLineBreakAfter:fe.hasLineBreakAfter});const qe=await fetch(Ne,{method:Fe,headers:{"Content-Type":"application/json"},body:JSON.stringify(fe)});if(!qe.ok)throw new Error(`Failed to save chord chart: ${qe.statusText}`);const Je=await qe.json();if(zd("Chord chart saved successfully",{savedChart:Je}),console.log("[DEBUG LINE BREAKS] Server returned:",{id:Je.id,title:Je.title,hasLineBreakAfter:Je.hasLineBreakAfter}),console.log("DEBUG: Saved chord detailed breakdown:",{id:Je.id,title:Je.title,fingers:Je.fingers,fingersType:typeof Je.fingers,fingersLength:(ge=Je.fingers)==null?void 0:ge.length,barres:Je.barres,barresType:typeof Je.barres,tuning:Je.tuning,startingFret:Je.startingFret,numFrets:Je.numFrets,numStrings:Je.numStrings,openStrings:Je.openStrings,mutedStrings:Je.mutedStrings}),Z(Xe=>{const ct=Xe[T]||[];if(xe){const we=parseInt(ue.editingChordId);Qr("Updating chordCharts state",{editingId:we,editingChordIdOriginal:ue.editingChordId,existingChartIds:ct.map(jt=>({id:jt.id,type:typeof jt.id}))});let bt=ct.map(jt=>{const tr=parseInt(jt.id)===we;return tr&&(Qr("Found matching chord to update",{chart:jt.id,editingId:we}),console.log("DEBUG: State update - replacing old chart:",{oldChart:jt,newChart:Je,fingersOld:jt.fingers,fingersNew:Je.fingers})),tr?Je:jt});return fe._lineBreakUpdater&&(Qr("Applying stored line break updater to preserve line breaks"),bt=fe._lineBreakUpdater(bt)),Qr("Updated charts result",{originalCount:ct.length,updatedCount:bt.length,foundMatch:bt.some(jt=>parseInt(jt.id)===we),hasLineBreakUpdater:!!fe._lineBreakUpdater}),{...Xe,[T]:bt}}else{let we=[...ct,Je];return fe._lineBreakUpdater&&(Qr("Applying stored line break updater to preserve line breaks for new chord"),we=fe._lineBreakUpdater(we)),{...Xe,[T]:we}}}),Q(Xe=>{const ct=Xe[T]||[];if(xe){const we=parseInt(ue.editingChordId);Qr("Updating chordSections state",{editingId:we,sectionsCount:ct.length});let bt=ct.map(jt=>{const tr=jt.chords.map(vr=>{const Dt=parseInt(vr.id)===we;return Dt&&Qr("Found matching chord in section",{sectionId:jt.id,sectionLabel:jt.label,chordId:vr.id,editingId:we}),Dt?Je:vr});return{...jt,chords:tr}});return fe._lineBreakUpdater&&(Qr("Applying line break updater to sections state"),bt=bt.map(jt=>({...jt,chords:fe._lineBreakUpdater(jt.chords)}))),console.log("[DEBUG LINE BREAKS] setChordSections update:",T,"updated sections with hasLineBreakAfter values:",bt.flatMap(jt=>jt.chords).map(jt=>({id:jt.id,title:jt.title,hasLineBreakAfter:jt.hasLineBreakAfter}))),{...Xe,[T]:bt}}else{if(ct.length===0){const bt=[{id:"section-1",label:"Verse",repeatCount:"",chords:[Je]}];return fe._lineBreakUpdater&&(Qr("Applying line break updater to new section"),bt[0].chords=fe._lineBreakUpdater(bt[0].chords)),{...Xe,[T]:bt}}const we=[...ct];if(ue.insertionContext){const bt=we.findIndex(jt=>jt.id===ue.insertionContext.sectionId);if(bt>=0){const jt={...we[bt]},tr=ue.insertionContext.insertOrder,vr=jt.chords.findIndex(Dt=>parseInt(Dt.order)>=tr);vr>=0?jt.chords=[...jt.chords.slice(0,vr),Je,...jt.chords.slice(vr)]:jt.chords=[...jt.chords,Je],we[bt]=jt}else{const jt={...we[we.length-1]};jt.chords=[...jt.chords,Je],we[we.length-1]=jt}}else{const bt={...we[we.length-1]};bt.chords=[...bt.chords,Je],we[we.length-1]=bt}return fe._lineBreakUpdater&&(Qr("Applying line break updater to updated sections"),we.forEach(bt=>{bt.chords=fe._lineBreakUpdater(bt.chords)})),{...Xe,[T]:we}}}),t.items.find(Xe=>Xe.B===T)){const Xe=e(T),ct=(Xe==null?void 0:Xe.C)||`Item ${T}`;xe?Zs("edited",ct,{chord_name:ue.title||"Unknown Chord",section_id:fe.sectionId,section_label:fe.sectionLabel}):Zs("added",ct,{chord_name:ue.title||"Unknown Chord",section_id:fe.sectionId,section_label:fe.sectionLabel})}G(Xe=>({...Xe,[T]:!1})),v(null),ce(null),ws()}catch(xe){console.error("Error saving chord chart:",xe)}},Gi=async(T,ue)=>{try{console.log("Deleting chord chart:",ue,"for item:",T);const ge=await fetch(`/api/items/${T}/chord-charts/${ue}`,{method:"DELETE"});if(!ge.ok){if(ge.status===429){const fe=await ge.json();console.warn("Rate limit exceeded for individual delete"),alert(`Rate limit exceeded. Please wait a moment and try again. (${fe.error})`);return}throw new Error(`Failed to delete chord chart: ${ge.statusText}`)}if(console.log("Chord chart deleted successfully"),t.items.find(fe=>fe.B===T)){const fe=e(T),Ne=(fe==null?void 0:fe.C)||`Item ${T}`,Fe=(F[T]||[]).find(qe=>qe.id===ue);Zs("deleted",Ne,{chord_name:(Fe==null?void 0:Fe.title)||"Unknown Chord",chord_id:ue})}Z(fe=>{const Ne=fe[T]||[];return{...fe,[T]:Ne.filter(Fe=>Fe.id!==ue)}}),Q(fe=>{const Fe=(fe[T]||[]).map(qe=>({...qe,chords:qe.chords.filter(Je=>Je.id!==ue)}));return{...fe,[T]:Fe}})}catch(ge){console.error("Error deleting chord chart:",ge)}},ws=()=>{re&&(setTimeout(()=>{const T=document.querySelector(`[data-chord-id="${re.chordId}"]`);T?T.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}):window.scrollTo({top:re.scrollPosition,behavior:"smooth"})},100),se(null))},Vi=(T,ue,ge)=>{console.log("Edit chord chart:",ue,"for item:",T,"with data:",ge),se({itemId:T,chordId:ue,scrollPosition:window.scrollY}),G(xe=>({...xe,[T]:!0})),v(ue),setTimeout(()=>{const xe=document.querySelector(`[data-editor-for-item="${T}"]`);xe&&xe.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},Ha=(T,ue,ge)=>{console.log("Insert chord after:",ue,"for item:",T,"with data:",ge),se({itemId:T,chordId:ue,scrollPosition:window.scrollY}),G(xe=>({...xe,[T]:!0})),ce({afterChordId:ue,sectionId:ge.sectionId,sectionLabel:ge.sectionLabel,sectionRepeatCount:ge.sectionRepeatCount,insertOrder:parseInt(ge.order)+1}),v(null),setTimeout(()=>{const xe=document.querySelector(`[data-editor-for-item="${T}"]`);xe&&xe.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},Ga=T=>{console.log("Print button clicked for item:",T);const ue=document.querySelector(`[data-item-id="${T}"].chord-charts-container`);console.log("Found container:",ue),ue?(ue.classList.add("chord-chart-print-area"),window.print(),setTimeout(()=>{ue.classList.remove("chord-chart-print-area")},100)):console.error("Could not find chord charts container for item:",T)},gi=async T=>{console.log("Opening copy modal for item:",T),C(T);const ue=i==null?void 0:i.find(Ne=>Ne.B===T),ge=(ue==null?void 0:ue.C)||"",xe=Vl(ge,i,T);console.log("Source:",ge),console.log("Found similar songs:",xe.map(Ne=>Ne.C));const fe=[T,...xe.map(Ne=>Ne.B)];console.log("Loading chord charts for relevant items:",fe.length,"items");for(const Ne of fe)try{const Fe=await fetch(`/api/items/${Ne}/chord-charts`);if(Fe.ok){const qe=await Fe.json();Z(Je=>({...Je,[Ne]:qe})),console.log(`Loaded ${qe.length} charts for item ${Ne}`)}}catch(Fe){console.error(`Error loading chord charts for item ${Ne}:`,Fe)}Se(!0),K(""),pe(new Set),z(null)},Jn=()=>{Se(!1),C(null),K(""),pe(new Set),ke(new Set),Re(!1),z(null)},Va=T=>{pe(ue=>{const ge=new Set(ue);if(ge.has(T))ge.delete(T);else{ge.add(T);const xe=i==null?void 0:i.find(Ne=>Ne.A===T),fe=xe==null?void 0:xe.B;fe&&Ur(fe)}return ge})},aa=async()=>{if(console.log("handleConfirmCopy called",{copySourceItemId:ne,selectedTargetItems:Array.from(X)}),!ne||X.size===0){console.log("Early return: missing source or targets");return}if(ve.size>0&&!Ae){console.log("Showing overwrite confirmation, items with existing charts:",ve.size),Re(!0);return}try{const T=await fetch("/api/chord-charts/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_item_id:ne,target_item_ids:Array.from(X).map(fe=>{const Ne=i==null?void 0:i.find(Fe=>Fe.A===fe);return Ne==null?void 0:Ne.B}).filter(Boolean)})});if(!T.ok)throw new Error(`Failed to copy chord charts: ${T.statusText}`);const ue=await T.json();console.log("Chord charts copied successfully:",ue),z("complete");const ge=Array.from(X).map(fe=>{const Ne=i==null?void 0:i.find(Fe=>Fe.A===fe);return Ne==null?void 0:Ne.B}).filter(Boolean),xe=[ne,...ge];console.log("[DEBUG COPY] About to refresh chord charts for affected items:",xe);for(const fe of xe)try{const Ne=await fetch(`/api/items/${fe}/chord-charts`);if(Ne.ok){const Fe=await Ne.json();if(console.log("[DEBUG COPY] Updating chordCharts state for item",fe,"with",Fe.length,"charts"),Z(qe=>({...qe,[fe]:Fe})),Fe.length===0)Q(qe=>({...qe,[fe]:[]}));else{const qe=new Map;Fe.forEach(ut=>{const Xe=ut.sectionId||"section-1",ct=ut.sectionLabel||"Verse",we=ut.sectionRepeatCount||"";qe.has(Xe)||qe.set(Xe,{id:Xe,label:ct,repeatCount:we,chords:[]}),qe.get(Xe).chords.push(ut)});const Je=Array.from(qe.values()).sort((ut,Xe)=>{const ct=ut.chords.length>0&&ut.chords[0].order||0,we=Xe.chords.length>0&&Xe.chords[0].order||0;return ct-we});console.log("[DEBUG COPY] Updating chordSections state for item",fe,"with",Je.length,"sections"),Q(ut=>({...ut,[fe]:Je}))}}}catch(Ne){console.error("Error refreshing chord charts for item",fe,Ne)}Jn()}catch(T){console.error("Error copying chord charts:",T)}},Ya=()=>{console.log("Overwrite confirmed, proceeding with copy"),Re(!1),aa()},ia=()=>{console.log("Overwrite cancelled, returning to item selection"),Re(!1)},Ja=T=>{console.log("Opening copy from modal for item:",T),Ve(T),he(!0),de(""),Ie(null)},Sa=()=>{he(!1),Ve(null),de(""),Ie(null),_a({})},xi=async()=>{if(console.log("handleConfirmCopyFrom called",{selectedSourceItem:Le,copyFromTargetItemId:Te}),!Le||!Te){console.log("Early return: missing source or target");return}try{const T=await fetch("/api/chord-charts/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_item_id:Le,target_item_ids:[Te]})});if(!T.ok)throw new Error(`Failed to copy chord charts: ${T.statusText}`);const ue=await T.json();console.log("Chord charts copied successfully:",ue);const ge=await fetch(`/api/items/${Te}/chord-charts`);if(ge.ok){const xe=await ge.json();if(Z(fe=>({...fe,[Te]:xe})),xe.length===0)Q(fe=>({...fe,[Te]:[]}));else{const fe=new Map;xe.forEach(Fe=>{const qe=Fe.sectionId||"section-1",Je=Fe.sectionLabel||"Verse",ut=Fe.sectionRepeatCount||"";fe.has(qe)||fe.set(qe,{id:qe,label:Je,repeatCount:ut,chords:[]}),fe.get(qe).chords.push(Fe)});const Ne=Array.from(fe.values()).sort((Fe,qe)=>{const Je=Fe.chords.length>0&&Fe.chords[0].order||0,ut=qe.chords.length>0&&qe.chords[0].order||0;return Je-ut});Q(Fe=>({...Fe,[Te]:Ne}))}}Sa()}catch(T){console.error("Error copying chord charts:",T)}},As=T=>{(F[T]||[]).length>0&&(j(T),Ke(!0))},Ls=async()=>{if(je)try{const T=F[je]||[];for(const ue of T)if(!(await fetch(`/api/items/${je}/chord-charts/${ue.id}`,{method:"DELETE"})).ok)throw new Error(`Failed to delete chord chart ${ue.id}`);Z(ue=>({...ue,[je]:[]})),Q(ue=>({...ue,[je]:[]})),Ke(!1),j(null)}catch(T){console.error("Error deleting existing chord charts:",T)}},yi=T=>{dt[T]&&dt[T].abort(),V(ue=>{const ge={...ue};return delete ge[T],ge}),Vt(ue=>{const ge={...ue};return delete ge[T],ge}),Rr(ue=>{const ge={...ue};return delete ge[T],ge})},ns=T=>{Xt(T),Jt(!0)},bi=()=>{xt&&yi(xt),Jt(!1),Xt(null)},x=()=>{Jt(!1),Xt(null)},R=(T,ue)=>{if(!(!ue||ue.length===0)){if(ue.length>5){alert("Maximum 5 files allowed. Please select fewer files.");return}Rr(ge=>({...ge,[T]:Array.from(ue)}))}},ae=(T,ue)=>{if(!T||T.trim().length===0)return ze(Fe=>({...Fe,[ue]:null})),!0;const ge=T.trim();return/^[A-Za-z0-9#bâ™­â™¯/\s,\n\r-]+$/.test(ge)?ge.split(/[\n\r]+/).some(Fe=>{const qe=Fe.trim();return qe.length===0?!1:/^[A-Za-z]+$/.test(qe)?!0:qe.split(/[,\s]+/).filter(Xe=>Xe.trim().length>0).every(Xe=>/^[A-Ga-g][A-Za-z0-9#bâ™­â™¯/]*$/.test(Xe))})?(ze(Fe=>({...Fe,[ue]:null})),!0):(ze(Fe=>({...Fe,[ue]:'Please enter chord names separated by commas, spaces, or section names (e.g., "C, G, Am, F" or "D A G D" or "Intro")'})),!1):(ze(Fe=>({...Fe,[ue]:"Only chord names (A-G), numbers, #, b, â™­, â™¯, /, commas, spaces, and section names are allowed"})),!1)},be=async T=>{var fe,Ne;const ue=er[T]||[],ge=(fe=Yr[T])==null?void 0:fe.trim(),xe=(Ne=lt[T])==null?void 0:Ne.trim();if(console.log(`[AUTOCREATE] handleProcessFiles called for item ${T}, files:`,ue.length,"youtubeUrl:",ge,"manualChords:",xe),ge){await Ge(T,ge);return}if(xe)if(ae(xe,T)){await Ee(T,xe);return}else return;if(ue.length===0){alert("Please add at least one file, YouTube URL, or manual chord input before processing.");return}await Pt(T,ue)},Ee=async(T,ue)=>{console.log(`[AUTOCREATE] Processing manual chord input for item ${T}:`,ue),V(ge=>({...ge,[T]:"processing"}));try{const ge=new Blob([ue],{type:"text/plain"}),xe=new File([ge],"manual-input.txt",{type:"text/plain"}),fe=new FormData;fe.append("file0",xe),fe.append("itemId",T),fe.append("userChoice","chord_names"),console.log("[AUTOCREATE] Sending manual input to autocreate endpoint");const Ne=await fetch("/api/autocreate-chord-charts",{method:"POST",body:fe});if(!Ne.ok){let Xe=`Failed to process manual input: ${Ne.statusText}`;try{const ct=await Ne.json();if(ct.error&&(Xe=ct.error),ct.requires_api_key)throw new Error("API_KEY_REQUIRED: "+Xe)}catch(ct){if(!ct.message.startsWith("API_KEY_REQUIRED"))console.warn("Could not parse error response:",ct);else throw ct}throw new Error(Xe)}const Fe=await Ne.json();console.log("[AUTOCREATE] Manual input processed successfully:",Fe),ri();const Je=await(await fetch(`/api/items/${T}/chord-charts`)).json();Z(Xe=>({...Xe,[T]:Je})),Q(Xe=>({...Xe,[T]:ys(Je)})),Jr(Xe=>({...Xe,[T]:""}));const ut=e(T);Wr({itemTitle:(ut==null?void 0:ut.C)||`Item ${T}`,chordsCreated:Je.length,processingMethod:"Manual Entry"}),rn(!0)}catch(ge){if(console.error("Error processing manual chord input:",ge),ge.message&&ge.message.startsWith("API_KEY_REQUIRED: ")){const xe=ge.message.replace("API_KEY_REQUIRED: ","");wr({message:xe,requiresApiKey:!0})}else wr({message:ge.message||"Failed to process manual chord input. Please try again."});dr(!0)}finally{V(ge=>{const xe={...ge};return delete xe[T],xe})}},Ge=async(T,ue)=>{console.log(`[YOUTUBE] Processing YouTube URL for item ${T}:`,ue);const ge=ue.trim().replace(/[<>"']/g,"");if(!/^https?:\/\/(www\.)?(youtube\.com\/watch\?v=[\w-]+|youtu\.be\/[\w-]+)(\?.*|&.*)?$/.test(ge)){wr({message:"Please enter a valid YouTube URL (e.g., https://youtube.com/watch?v=...)"}),dr(!0);return}V(fe=>({...fe,[T]:"checking_transcript"}));try{console.log("[YOUTUBE] Fetching transcript from YouTube API");const fe=await fetch("/api/youtube/check-transcript",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:ge})});if(!fe.ok)throw new Error("Failed to fetch YouTube transcript");const Ne=await fe.json();if(!Ne.hasTranscript||!Ne.transcript){wr({message:"This YouTube video does not have a transcript available. Please try a different video or use file upload instead."}),dr(!0);return}console.log(`[YOUTUBE] Transcript fetched successfully, length: ${Ne.transcript.length} characters`),await Ze(T,Ne.transcript)}catch(fe){console.error("Error processing YouTube URL:",fe),wr({message:"Failed to process YouTube URL. Please try again."}),dr(!0),V(Ne=>{const Fe={...Ne};return delete Fe[T],Fe})}},Ze=async(T,ue)=>{let ge=!1,xe=null;try{V(ct=>({...ct,[T]:"reading_transcript"}));const fe=new FormData;fe.append("itemId",T);const Ne=new Blob([ue],{type:"text/plain"});fe.append("file0",Ne,"youtube_transcript.txt"),xe=setTimeout(()=>{ge||V(ct=>({...ct,[T]:"processing"}))},2e3);const qe=await fetch("/api/autocreate-chord-charts",{method:"POST",headers:{"X-Item-Id":T},body:fe});if(!qe.ok){let ct=`Failed to create chord charts: ${qe.statusText}`;try{const we=await qe.json();if(we.error&&(ct=we.error),we.requires_api_key)throw new Error("API_KEY_REQUIRED: "+ct)}catch(we){if(!we.message.startsWith("API_KEY_REQUIRED"))console.warn("Could not parse error response:",we);else throw we}throw new Error(ct)}const Je=await qe.json();if(console.log("[YOUTUBE] Chord charts created successfully:",Je),ri(),Je.error&&Je.error.includes("No chord names found in this transcript")){_t(!0),V(ct=>{const we={...ct};return delete we[T],we}),En(ct=>({...ct,[T]:""}));return}if(t.items.find(ct=>ct.B===T)){const ct=e(T),we=(ct==null?void 0:ct.C)||`Item ${T}`;Zs("autocreated",we,{content_type:"youtube_transcript",source:"youtube_url"})}const Xe=e(T);Wr({itemName:(Xe==null?void 0:Xe.C)||`Item ${T}`,chordCount:Je.chord_count||0,contentType:"youtube_transcript",uploadedFileNames:"YouTube transcript",isVisionAnalysis:!1}),rn(!0);try{const ct=await fetch(`/api/items/${T}/chord-charts`);if(ct.ok){const bt=await ct.json();if(Z(jt=>({...jt,[T]:bt})),bt.length===0)Q(jt=>({...jt,[T]:[]}));else{const jt=new Map;bt.forEach(vr=>{const Dt=vr.sectionId||"section-1",yr=vr.sectionLabel||"Verse",Nr=vr.sectionRepeatCount||"";jt.has(Dt)||jt.set(Dt,{id:Dt,label:yr,repeatCount:Nr,chords:[]}),jt.get(Dt).chords.push(vr)});const tr=Array.from(jt.values());Q(vr=>({...vr,[T]:tr}))}}}catch(ct){console.error("Error refreshing chord charts:",ct)}En(ct=>({...ct,[T]:""})),V(ct=>{const we={...ct};return delete we[T],we})}catch(fe){if(ge=!0,xe&&clearTimeout(xe),console.error("Error processing YouTube transcript:",fe),fe.message&&fe.message.startsWith("API_KEY_REQUIRED: ")){const Ne=fe.message.replace("API_KEY_REQUIRED: ","");wr({message:Ne,requiresApiKey:!0})}else wr({message:fe.message||"Failed to create chord charts from transcript. Please try again."});dr(!0),V(Ne=>{const Fe={...Ne};return delete Fe[T],Fe})}},vt=async T=>{if(!Ut)return;const{itemId:ue,files:ge}=Ut;console.log(`[AUTOCREATE] handleMixedContentChoice called with contentType: ${T}, itemId: ${ue}, files:`,ge.length);try{V(Fe=>({...Fe,[ue]:"processing"})),tn(!1),console.log(`[AUTOCREATE] Starting processing for ${T} with ${ge.length} files`);const xe=new FormData;ge.forEach((Fe,qe)=>{const Je=atob(Fe.data),ut=Array.from({length:Je.length});for(let we=0;we<Je.length;we++)ut[we]=Je.charCodeAt(we);const Xe=new Uint8Array(ut),ct=new File([Xe],Fe.name,{type:Fe.media_type});xe.append(`file${qe}`,ct)}),xe.append("itemId",ue),xe.append("userChoice",T),console.log("[AUTOCREATE] Sending API request to /api/autocreate-chord-charts");const fe=await fetch("/api/autocreate-chord-charts",{method:"POST",body:xe});if(console.log(`[AUTOCREATE] API response status: ${fe.status} ${fe.statusText}`),!fe.ok){let Fe="Failed to process files";try{const qe=await fe.json();if(qe.error&&(Fe=qe.error),qe.requires_api_key)throw new Error("API_KEY_REQUIRED: "+Fe)}catch(qe){if(!qe.message.startsWith("API_KEY_REQUIRED"))console.warn("Could not parse error response:",qe);else throw qe}throw new Error(Fe)}const Ne=await fe.json();if(console.log("[AUTOCREATE] API response data:",Ne),Ne.success){console.log("[AUTOCREATE] Processing successful, setting state to complete"),ri(),V(ut=>({...ut,[ue]:"complete"}));const Fe=e(ue),qe=(Fe==null?void 0:Fe.C)||`Item ${ue}`;t.items.find(ut=>ut.B===ue)&&Zs("autocreated",qe,{file_count:(ge==null?void 0:ge.length)||0,content_type:T||"mixed",uploaded_file_names:(ge==null?void 0:ge.map(ut=>ut.name).join(", "))||""}),Wr({itemName:qe,chordCount:Ne.chord_count||0,contentType:T||"mixed",uploadedFileNames:(ge==null?void 0:ge.map(ut=>ut.name).join(", "))||"",isVisionAnalysis:T==="chord_charts"||Ne.used_vision_analysis===!0}),rn(!0);try{const ut=await fetch(`/api/items/${ue}/chord-charts`);if(ut.ok){const ct=await ut.json();if(Z(we=>({...we,[ue]:ct})),ct&&ct.length>0){const we=ys(ct);Q(bt=>({...bt,[ue]:we}))}}}catch(ut){console.error("Failed to refresh chord charts after mixed content choice:",ut)}setTimeout(()=>{V(ut=>{const Xe={...ut};return delete Xe[ue],Xe}),Rr(ut=>{const Xe={...ut};return delete Xe[ue],Xe}),pn(null)},2e3)}}catch(xe){if(console.error("[AUTOCREATE] Error processing mixed content choice:",xe),console.error("[AUTOCREATE] Full error details:",{message:xe.message,stack:xe.stack,name:xe.name}),xe.message&&xe.message.startsWith("API_KEY_REQUIRED: ")){const fe=xe.message.replace("API_KEY_REQUIRED: ","");wr({message:fe,requiresApiKey:!0})}else wr({message:xe.message||"Failed to process files. Please try again."});dr(!0),V(fe=>{const Ne={...fe};return delete Ne[ue],Ne}),pn(null)}},Pt=async(T,ue)=>{if(!ue||ue.length===0)return;if(ue.length>5){alert("Maximum 5 files allowed. Please select fewer files.");return}let ge=!1,xe=null;try{V(we=>({...we,[T]:"uploading"}));const fe=new AbortController;Vt(we=>({...we,[T]:fe}));const Ne=new FormData;Array.from(ue).forEach((we,bt)=>{Ne.append(`file${bt}`,we)}),Ne.append("itemId",T),xe=setTimeout(()=>{ge||V(we=>({...we,[T]:"processing"}))},2e3);const qe=await fetch("/api/autocreate-chord-charts",{method:"POST",body:Ne,signal:fe.signal});if(!qe.ok){const we=await qe.json();throw new Error(we.error||"Failed to process files")}const Je=await qe.json();if(Je.needs_user_choice){pn({itemId:T,options:Je.mixed_content_options||[],files:Je.files||[]}),tn(!0),V(we=>{const bt={...we};return delete bt[T],bt});return}if(Je.error==="unsupported_format"){xr({message:Je.message,title:Je.title}),Vr(!0),V(we=>{const bt={...we};return delete bt[T],bt});return}ri(),V(we=>({...we,[T]:"complete"}));const ut=e(T),Xe=(ut==null?void 0:ut.C)||`Item ${T}`;t.items.find(we=>we.B===T)&&Zs("autocreated",Xe,{file_count:Je.file_count||0,content_type:Je.content_type||"auto-detected",uploaded_file_names:Je.uploaded_file_names||""}),Wr({itemName:Xe,chordCount:Je.chord_count||0,contentType:Je.content_type||"auto-detected",uploadedFileNames:Je.uploaded_file_names||"",isVisionAnalysis:Je.content_type==="chord_charts"||Je.used_vision_analysis===!0||!Je.content_type&&Je.used_vision_analysis!==!1}),rn(!0);try{const we=await fetch(`/api/items/${T}/chord-charts`);if(we.ok){const jt=await we.json();if(Z(tr=>({...tr,[T]:jt})),jt.length===0)Q(tr=>({...tr,[T]:[]}));else{const tr=new Map;jt.forEach(Dt=>{const yr=Dt.sectionId||"section-1",Nr=Dt.sectionLabel||"Verse",pr=Dt.sectionRepeatCount||"";tr.has(yr)||tr.set(yr,{id:yr,label:Nr,repeatCount:pr,chords:[]}),tr.get(yr).chords.push(Dt)});const vr=Array.from(tr.values()).sort((Dt,yr)=>{const Nr=Math.min(...Dt.chords.map(mr=>mr.order||0)),pr=Math.min(...yr.chords.map(mr=>mr.order||0));return Nr-pr});vr.forEach(Dt=>{Dt.chords.sort((yr,Nr)=>(yr.order||0)-(Nr.order||0))}),Q(Dt=>({...Dt,[T]:vr}))}}}catch(we){console.error("Failed to refresh chord charts after autocreate:",we)}setTimeout(()=>{V(we=>{const bt={...we};return delete bt[T],bt}),yt(we=>({...we,[T]:!1})),Vt(we=>{const bt={...we};return delete bt[T],bt}),Rr(we=>{const bt={...we};return delete bt[T],bt})},5e3)}catch(fe){if(ge=!0,xe&&clearTimeout(xe),fe.name==="AbortError"){console.log("Autocreate request was cancelled");return}console.error("Error in autocreate:",fe);const Ne=fe.message||fe.toString();if(Ne.startsWith("API_KEY_REQUIRED: ")){const Fe=Ne.replace("API_KEY_REQUIRED: ","");wr({message:Fe,requiresApiKey:!0}),dr(!0),V(qe=>{const Je={...qe};return delete Je[T],Je})}else Ne.includes("529")||Ne.includes("overloaded")||Ne.includes("429")||Ne.includes("rate limit")||Ne.includes("500")||Ne.includes("502")||Ne.includes("503")||Ne.includes("timeout")?(wr(fe),dr(!0),V(Fe=>{const qe={...Fe};return delete qe[T],qe})):V(Fe=>({...Fe,[T]:"error"}));Ne.includes("529")||Ne.includes("overloaded")||Ne.includes("429")||Ne.includes("rate limit")||Ne.includes("500")||Ne.includes("502")||Ne.includes("503")||Ne.includes("timeout")||setTimeout(()=>{V(Fe=>{const qe={...Fe};return delete qe[T],qe}),Vt(Fe=>{const qe={...Fe};return delete qe[T],qe})},5e3)}};return n.jsxs("div",{className:"max-w-1130px mx-auto border border-gray-700 rounded-lg p-6",style:{maxWidth:"1130px"},children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold",children:t==null?void 0:t.name}),n.jsxs("div",{className:"flex flex-col items-end gap-2",children:[n.jsxs("div",{className:"text-xl font-mono",children:[n.jsx("span",{title:"Time practiced so far",children:Gd(na)})," / ",n.jsx("span",{title:"Total time of remaining items",children:Gd(Hi-na)})]}),n.jsx(Be,{variant:"outline",onClick:Wi,className:"text-gray-300 hover:text-white",title:"Reset progress and all timers","data-ph-capture-attribute-button":"reset-routine-progress",children:"Reset progress"})]})]}),n.jsx("div",{className:"space-y-4",children:(qt=t==null?void 0:t.items)==null?void 0:qt.map(T=>{var ct;const ue=a.has(T.A),ge=o.has(T.A),xe=h.has(T.A),fe=Yn.has(T.A),Ne=e(T.B),Fe=y[T.A]!==void 0?y[T.A]:((Ne==null?void 0:Ne.E)||5)*60,qe=b[T.B]||"",Je=L.has(T.A),ut=((ct=T.minimalDetails)==null?void 0:ct.C)||"Loading...",Xe=ue&&!Ne&&s(T.B);return n.jsxs("div",{className:"rounded-lg bg-gray-800 overflow-hidden",children:[n.jsxs("h2",{className:"sr-only",children:["Practice Item: ",ut]}),n.jsxs("div",{className:"flex items-center justify-between p-5 cursor-pointer hover:bg-gray-700",onClick:()=>hi(T.A),role:"button","aria-expanded":ue,"aria-controls":`practice-item-content-${T.A}`,tabIndex:0,"data-item-header":T.A,"data-expanded":ue?"true":"false",onKeyDown:we=>{(we.key==="Enter"||we.key===" ")&&(we.preventDefault(),hi(T.A))},children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("button",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${fe?"bg-green-500 border-green-500 text-white":"border-gray-400 text-transparent hover:border-gray-300"}`,onClick:we=>pi(T.A,we),"aria-label":fe?"Mark as incomplete":"Mark as complete","data-ph-capture-attribute-button":"toggle-item-complete",children:n.jsx(Nn,{className:"h-4 w-4","aria-hidden":"true"})}),ue?n.jsx(Xn,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"}):n.jsx(fs,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"}),n.jsxs("span",{className:`text-xl ${fe?"line-through text-gray-500":""}`,id:`practice-item-title-${T.A}`,children:[ut,Xe&&n.jsx("span",{className:"text-gray-500 ml-2",role:"status","aria-live":"polite",children:"(Loading details...)"})]})]}),n.jsx("div",{className:"flex items-center space-x-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Be,{variant:"ghost",size:"sm",className:"text-gray-400",onClick:we=>mi(T.A,we),title:"Reset timer","data-ph-capture-attribute-button":"reset-timer-header",children:n.jsx(Wd,{className:"h-5 w-5"})}),n.jsx("span",{className:"text-lg font-mono",title:"Time remaining",children:Hd(Fe)})]})})]}),ue&&n.jsxs("div",{className:"px-8 pb-6",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-6","data-tour":"practice-timer",children:[n.jsx("button",{onClick:we=>Ht(T.A,we),className:"w-48 h-48 rounded-full border-4 border-gray-600 flex items-center justify-center hover:border-gray-500 transition-colors",title:xe?"Pause timer":"Start timer","aria-label":xe?"Pause practice timer":"Start practice timer","data-ph-capture-attribute-button":xe?"pause-practice-timer":"start-practice-timer",children:xe?n.jsx(Sm,{className:"h-24 w-24 text-red-500"}):n.jsx(jm,{className:"h-24 w-24 text-green-500"})}),n.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[n.jsx("div",{className:"text-5xl font-mono",children:Hd(Fe)}),!xe&&Fe!==((Ne==null?void 0:Ne.E)||5)*60&&n.jsxs("button",{onClick:we=>mi(T.A,we),className:"flex items-center space-x-2 text-gray-400 hover:text-gray-300 transition-colors","data-ph-capture-attribute-button":"reset-practice-timer",children:[n.jsx(Wd,{className:"h-4 w-4"}),n.jsx("span",{children:"Reset Timer"})]})]}),n.jsx("div",{className:"flex justify-center mt-6",children:n.jsx(Be,{variant:"outline",className:"max-w-md text-gray-300 hover:text-white",onClick:we=>pi(T.A,we),"data-ph-capture-attribute-button":"mark-item-done",children:"Mark done"})})]}),n.jsxs("div",{className:"space-y-2 px-4",children:[n.jsxs("div",{"data-tour":"chord-charts-section",children:[n.jsx("div",{className:"flex items-center justify-between p-2 hover:bg-gray-700 rounded cursor-pointer",onClick:we=>ja(T.A,we),role:"button","aria-expanded":Je,"aria-controls":`chord-charts-content-${T.A}`,tabIndex:0,onKeyDown:we=>{(we.key==="Enter"||we.key===" ")&&(we.preventDefault(),ja(T.A,we))},children:n.jsxs("div",{className:"flex items-center",children:[Je?n.jsx(Xn,{className:"h-5 w-5 text-gray-400 mr-2","aria-hidden":"true"}):n.jsx(fs,{className:"h-5 w-5 text-gray-400 mr-2","aria-hidden":"true"}),n.jsxs("h3",{className:"text-xl text-gray-300 flex items-center",id:`chord-charts-title-${T.A}`,"data-tour":"chord-charts",children:[n.jsx(Lh,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Chord charts"]})]})}),Je&&n.jsx("div",{id:`chord-charts-content-${T.A}`,className:"bg-gray-700 rounded-lg p-4 chord-charts-container relative","data-item-id":T.B,role:"region","aria-labelledby":`chord-charts-title-${T.A}`,children:(()=>{const we=T.B,bt=O[we],jt=bt?null:Pn(we),tr=bt||jt||[];console.log("[DEBUG LINE BREAKS] Rendering sections for item",we,"from state:",!!bt,"chords:",tr.flatMap(Dt=>Dt.chords).map(Dt=>({id:Dt.id,title:Dt.title,hasLineBreakAfter:Dt.hasLineBreakAfter})));const vr=tr.map((Dt,yr)=>n.jsxs("div",{className:"mb-6",children:[n.jsxs("div",{className:"flex justify-between items-center mb-3",children:[n.jsx("input",{type:"text",value:Dt.label,onChange:Nr=>{console.log("Updating section label:",Dt.id,Nr.target.value),ft(we,Dt.id,{label:Nr.target.value})},className:"bg-gray-900 text-white px-2 py-1 rounded text-sm font-semibold border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Section name"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:Dt.repeatCount,onChange:Nr=>ft(we,Dt.id,{repeatCount:Nr.target.value}),className:"bg-gray-900 text-white px-2 py-1 rounded text-sm w-16 text-center border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"x2",maxLength:"3"}),n.jsx("button",{onClick:()=>ur(we,Dt.id),disabled:I.size>0,className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold transition-colors ${I.size>0?"bg-gray-500 cursor-not-allowed":"bg-red-600 hover:bg-red-700 cursor-pointer"} text-white`,title:I.size>0?"Deleting...":"Delete section","aria-label":"Delete chord section","data-ph-capture-attribute-button":"delete-chord-section",children:I.size>0?n.jsx(Or,{className:"h-3 w-3 animate-spin"}):"Ã—"})]})]}),yr===0&&(()=>{const Nr=Dt.chords[0];if(!Nr)return null;const pr=Nr.tuning||"EADGBE",mr=Nr.capo||0;return n.jsx("div",{className:"text-center text-white font-bold text-sm mb-3",children:mr>0?`${pr} | Capo on ${mr}`:pr})})(),Dt.chords.length>0&&n.jsx("div",{className:"space-y-2",children:(()=>{const Nr=[];let pr=[];return console.log("[DEBUG LINE BREAKS] Processing section:",Dt.id,"chords:",Dt.chords.map(mr=>({id:mr.id,title:mr.title,hasLineBreakAfter:mr.hasLineBreakAfter}))),Dt.chords.forEach((mr,Mn)=>{pr.push(mr),(mr.hasLineBreakAfter||pr.length>=5||Mn===Dt.chords.length-1)&&(console.log("[DEBUG LINE BREAKS] Creating row with",pr.length,"chords. Reason:",mr.hasLineBreakAfter?"hasLineBreakAfter":pr.length>=5?"max 5":"last chord"),Nr.push([...pr]),pr=[])}),console.log("[DEBUG LINE BREAKS] Final row structure:",Nr.map((mr,Mn)=>`Row ${Mn}: ${mr.map(Un=>Un.title).join(", ")}`)),Nr.map((mr,Mn)=>n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2",children:mr.map(Un=>n.jsx(km,{chart:Un,onEdit:(rr,gr)=>Vi(we,rr,gr),onDelete:rr=>Gi(we,rr),onInsertAfter:(rr,gr)=>Ha(we,rr,gr)},Un.id))},`row-${Mn}-${mr.map(Un=>Un.id).join("-")}`))})()})]},Dt.id));return n.jsxs(n.Fragment,{children:[vr,(F[we]||[]).length>0?n.jsx("div",{className:"flex justify-end mb-2",children:n.jsx(Be,{variant:"outline",size:"sm",onClick:yr=>{yr.stopPropagation(),Ga(we)},className:"p-2 border-gray-600 text-gray-400 hover:text-gray-200 hover:bg-gray-600",title:"Print chord charts",children:n.jsx(Eh,{className:"h-4 w-4"})})}):null,(()=>{var pr,mr,Mn,Un;const Dt=F[we]||[],yr=P[we],Nr=ot[we];return Dt.length===0?n.jsxs("div",{className:"mb-4",children:[Nr?n.jsx(Be,{onClick:()=>yt(rr=>({...rr,[we]:!1})),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-300 mb-2",title:"Collapse autocreate section",children:"â†"}):n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{onClick:()=>yt(rr=>({...rr,[we]:!0})),className:"max-w-md bg-gray-700 text-gray-300 hover:bg-gray-600 mb-2 flex items-center justify-center",children:[n.jsx(Ti,{className:"h-4 w-4 mr-2"}),"Autocreate chord charts"]})}),Nr&&n.jsxs("div",{className:"border border-gray-600/30 rounded-lg p-4 bg-gray-800/10",children:[n.jsxs("div",{className:"text-sm text-gray-400 mb-6",children:[n.jsx("p",{children:"â€¢ Upload lyrics with chord names to create charts"}),n.jsx("p",{children:'â€¢ Upload image or PDF of chord charts to "import"'}),n.jsx("p",{children:"â€¢ One method at a time"})]}),!yr&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 items-start",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"text-center mb-2",children:n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Upload files"})}),n.jsx("div",{className:`flex-1 p-4 border-2 border-dashed rounded-lg transition-colors cursor-pointer ${ht[we]?"border-gray-500 bg-gray-800/20":"border-gray-600 hover:border-gray-500 bg-gray-800/10"}`,onDragOver:rr=>{rr.preventDefault(),st(gr=>gr[we]!==!0?{...gr,[we]:!0}:gr)},onDragLeave:rr=>{rr.preventDefault(),st(gr=>gr[we]!==!1?{...gr,[we]:!1}:gr)},onDrop:rr=>{rr.preventDefault(),st(gr=>({...gr,[we]:!1})),R(we,rr.dataTransfer.files)},onClick:()=>{const rr=document.createElement("input");rr.type="file",rr.multiple=!0,rr.accept=".pdf,.png,.jpg,.jpeg",rr.onchange=gr=>R(we,gr.target.files),rr.click()},children:n.jsxs("div",{className:"text-center",children:[n.jsx(Ti,{className:`h-12 w-12 mx-auto mb-2 ${er[we]&&er[we].length>0?"text-gray-300":"text-gray-400"}`}),n.jsx("p",{className:`text-sm font-medium mb-2 ${er[we]&&er[we].length>0?"text-gray-200":"text-gray-300"}`,children:"Drop files or click"}),n.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"PDFs, images â€¢ 5mb max"}),er[we]&&er[we].length>0&&n.jsx("div",{children:n.jsxs("p",{className:"text-gray-300 text-xs font-medium mb-1",children:[er[we].length," file(s)"]})})]})})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"text-center mb-2",children:[n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"YouTube guitar lesson"}),n.jsx("p",{className:"text-gray-500 text-xs",children:"(video must have a transcript)"})]}),n.jsx("form",{className:"flex-1 flex flex-col justify-center",onSubmit:rr=>{var gr;rr.preventDefault(),(gr=Yr[we])!=null&&gr.trim()&&be(we)},children:n.jsx("input",{type:"url",placeholder:"Paste YouTube URL",value:Yr[we]||"",onChange:rr=>{const gr=rr.target.value.replace(/[<>"']/g,"");En(oa=>({...oa,[we]:gr}))},maxLength:500,className:"w-full p-3 bg-gray-700 text-white rounded border-2 border-gray-600 focus:border-gray-500 text-sm"})})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"text-center mb-2",children:n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Manual entry"})}),n.jsxs("div",{className:"flex-1 flex flex-col justify-center relative",children:[n.jsx("textarea",{placeholder:`Enter song section names and chord names, like this:
Intro
Am7 Em/A E7sus
Verse
C G/B Am (space or comma-separated)`,value:lt[we]||"",onChange:rr=>{const gr=rr.target.value;gr.length<=500&&(Jr(oa=>({...oa,[we]:gr})),ae(gr,we))},maxLength:500,className:`w-full p-3 text-white rounded border-2 focus:border-gray-500 text-sm resize-none min-h-[160px] ${ye[we]?"bg-red-900/20 border-red-500":"bg-gray-700 border-gray-600"}`}),n.jsxs("div",{className:"absolute bottom-1 right-2 text-xs text-gray-400",children:[(lt[we]||"").length,"/500"]}),ye[we]&&n.jsx("div",{className:"mt-1 text-xs text-red-400",children:ye[we]})]})]})]}),n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{onClick:()=>be(we),disabled:yr||(er[we]||[]).length===0&&!((pr=Yr[we])!=null&&pr.trim())&&!((mr=lt[we])!=null&&mr.trim())||((er[we]||[]).length>0?1:0)+((Mn=Yr[we])!=null&&Mn.trim()?1:0)+((Un=lt[we])!=null&&Un.trim()?1:0)>1,className:"px-6",children:[n.jsx(bc,{className:"h-4 w-4 mr-2"}),"Create chord charts"]})})]}),n.jsx("div",{className:"w-full p-6 border-2 border-dashed rounded-lg mt-4 bg-gray-800/10 border-gray-600/50",children:n.jsxs("div",{className:"text-center",children:[yr==="checking_transcripts"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-500"}),n.jsx("span",{className:"text-yellow-400",children:"Checking for transcripts..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ns(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),yr==="reading_transcript"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500"}),n.jsx("span",{className:"text-gray-400",children:"Reading transcript..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ns(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),yr==="uploading"&&n.jsxs("div",{className:"space-y-3",role:"status","aria-live":"polite",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500","aria-hidden":"true"}),n.jsx("span",{className:"text-gray-400",children:"Uploading files..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ns(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),yr==="processing_transcript"&&n.jsxs("div",{className:"space-y-3",role:"status","aria-live":"polite",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500","aria-hidden":"true"}),n.jsx("span",{className:"text-white",children:"Processing transcript..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ns(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),yr==="processing"&&n.jsxs("div",{className:"space-y-3",role:"status","aria-live":"polite",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500","aria-hidden":"true"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"text-white",children:ir[mt]}),n.jsx("div",{className:"ml-2 animate-spin","aria-hidden":"true",children:"âš™ï¸"})]})]}),n.jsx("br",{}),n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ns(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})})]}),yr==="complete"&&n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx(Nn,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-green-400",children:"Chord charts created!"})]}),yr==="error"&&n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx(Rn,{className:"h-4 w-4 text-red-500"}),n.jsx("span",{className:"text-red-400",children:"Error processing files. Please try again."})]}),!yr&&n.jsx(n.Fragment,{children:F[we]&&F[we].length>0?n.jsxs(n.Fragment,{children:[n.jsx(Rn,{className:"h-8 w-8 text-orange-400 mx-auto mb-2"}),n.jsx("p",{className:"text-orange-300 font-medium mb-1",children:"Chord charts already exist"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Please delete all chord charts from this song before using autocreate"})]}):n.jsx(n.Fragment,{children:(er[we]||[]).length>0?n.jsxs(n.Fragment,{children:[n.jsx(pl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-300 font-medium mb-1",children:"Ready to create chord charts"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Click 'Create chord charts'"})]}):n.jsxs(n.Fragment,{children:[n.jsx(pl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-300 font-medium mb-1",children:"Add a file, paste a YouTube URL, or type in the 'Manual entry' box, then click 'Create Chord Charts'"}),n.jsx("p",{className:"text-gray-400 text-xs",children:"(The results will probably contain errors. Use the âœï¸edit icon on a chart to correct it.)"})]})})})]})})]})]}):n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsxs(Be,{variant:"outline",onClick:()=>As(we),className:"max-w-md text-orange-300 hover:bg-orange-800 hover:border-orange-600",children:[n.jsx(Ti,{className:"h-4 w-4 mr-2"}),"Replace with autocreated charts"]})})})(),n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsx(Be,{variant:"default",onClick:()=>{se({itemId:we,scrollPosition:window.scrollY}),G(Dt=>({...Dt,[we]:!0})),setTimeout(()=>{const Dt=document.querySelector(`[data-editor-for-item="${we}"]`);Dt&&Dt.scrollIntoView({behavior:"smooth",block:"start"})},100)},className:"min-w-48",children:"+ Add new chord"})}),n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsx(Be,{variant:"default",onClick:()=>Cr(we),className:"min-w-48",children:"+ Add new section"})}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4 max-w-2xl mx-auto",children:[n.jsx(Be,{variant:"default",onClick:()=>Ja(we),className:"flex-1",children:"Copy chord charts from other song"}),n.jsx(Be,{variant:"default",onClick:()=>gi(we),disabled:!F[we]||F[we].length===0,className:"flex-1 bg-purple-700 text-purple-300 hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Copy chord charts to other song"})]}),Y[we]&&n.jsx("div",{"data-editor-for-item":we,children:n.jsx(Bh,{itemId:we,defaultTuning:(Ne==null?void 0:Ne.H)||"EADGBE",editingChordId:D,insertionContext:te,onSave:Dt=>sa(we,Dt),onCancel:()=>{G(Dt=>({...Dt,[we]:!1})),v(null),ce(null),ws()}})})]})})()})]}),n.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-700 rounded cursor-pointer",onClick:we=>bs(T.A,we),role:"button","aria-expanded":ge,"aria-controls":`notes-content-${T.A}`,tabIndex:0,onKeyDown:we=>{(we.key==="Enter"||we.key===" ")&&(we.preventDefault(),bs(T.A,we))},children:[n.jsxs("div",{className:"flex items-center",children:[ge?n.jsx(Xn,{className:"h-5 w-5 text-gray-400 mr-2","aria-hidden":"true"}):n.jsx(fs,{className:"h-5 w-5 text-gray-400 mr-2","aria-hidden":"true"}),n.jsxs("h3",{className:"text-xl text-gray-300 flex items-center",id:`notes-title-${T.A}`,children:[n.jsx(Ah,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Notes"]})]}),n.jsxs(Be,{variant:"outline",size:"sm",className:"text-gray-300",onClick:we=>{we.stopPropagation(),$i(T.B,we)},children:[n.jsx(yo,{className:"h-4 w-4 mr-2","aria-hidden":"true"}),qe?"Edit note":"Add note"]})]}),ge&&qe&&n.jsx("div",{id:`notes-content-${T.A}`,className:"px-4",role:"region","aria-labelledby":`notes-title-${T.A}`,children:n.jsx("div",{className:"bg-gray-700 p-3 rounded",children:n.jsx("div",{className:"text-gray-300",dangerouslySetInnerHTML:{__html:Wc(qe)}})})}),n.jsx("div",{className:"mt-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[(()=>{const we=(Ne==null?void 0:Ne.I)||(Ne==null?void 0:Ne.F);if(!we)return null;const bt=M0(we);if(!bt&&!Fh()&&!_i())return null;const jt=(Ne==null?void 0:Ne.C)||`Item ${T.A}`;return bt?n.jsxs("a",{href:we,target:"_blank",rel:"noopener noreferrer",onClick:tr=>{tr.stopPropagation(),Bd(jt,we)},className:"text-gray-400 hover:text-gray-300 hover:underline flex items-center",title:"Open songbook link in new tab",children:[n.jsx(Ch,{className:"h-4 w-4 mr-2"}),"Open Songbook Link"]}):n.jsxs("button",{onClick:tr=>{tr.stopPropagation(),Bd(jt,we),_i()?(Ot(we),Ft(!0)):navigator.clipboard.writeText(we).then(()=>{Ot(we),Ft(!0)}).catch(vr=>{console.error("Failed to copy to clipboard:",vr),Ot(we),Ft(!0)})},className:"text-gray-400 hover:text-gray-300 hover:underline flex items-center",title:_i()?"View folder path":"Copy folder path",children:[n.jsx(C0,{className:"h-4 w-4 mr-2"}),_i()?"View Songbook Folder":"Copy Folder Path"]})})(),(Ne==null?void 0:Ne.H)&&n.jsx("span",{className:"text-sm font-mono font-bold text-gray-400",children:Ne.H})]})})]})]}),a.has(T.A)&&n.jsx("div",{id:`practice-item-content-${T.A}`,className:"px-5 pb-5",role:"region","aria-labelledby":`practice-item-title-${T.A}`,children:n.jsx("div",{className:"text-gray-400"})})]},T.A)})}),n.jsx(z0,{open:u,onOpenChange:w,itemId:g,currentNote:g?b[g]:"",onNoteSave:Cs}),le&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsx("div",{className:`bg-gray-700 rounded-lg p-6 ${Ae||$==="complete"?"max-w-xs":"w-full max-w-md"} max-h-[80vh] flex flex-col`,onWheel:T=>T.stopPropagation(),children:$==="complete"?n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Success!"}),n.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[n.jsx(Nn,{className:"h-6 w-6 text-green-500"}),n.jsx("span",{className:"text-green-400 text-lg",children:"Chord charts copied successfully!"})]}),n.jsx(Be,{onClick:Jn,className:"w-full bg-green-600 hover:bg-green-700",children:"Done"})]}):Ae?n.jsxs(n.Fragment,{children:[n.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Overwrite"}),n.jsxs("p",{className:"text-gray-300 mb-4",children:[ve.size," of the selected songs already have chord charts. Copying will replace all existing chord charts in those songs."]}),n.jsxs("div",{className:"bg-gray-600 rounded p-3 mb-4",children:[n.jsx("p",{className:"text-sm text-gray-200 mb-2 font-medium",children:"Songs that will be overwritten:"}),n.jsx("ul",{className:"text-sm text-gray-300 space-y-1",children:Ws.filter(T=>X.has(T.A)&&ve.has(T.A)).map(T=>n.jsxs("li",{className:"flex items-center",children:[n.jsx("span",{className:"text-yellow-400 mr-2",children:"â€¢"}),T.C||"Unknown Song"]},T.A))})]}),n.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"This action cannot be undone."}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{variant:"outline",onClick:ia,className:"flex-1",children:"Go Back"}),n.jsx(Be,{onClick:Ya,className:"flex-1 bg-red-600 hover:bg-red-700",children:"Yes, Overwrite"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Copy chord charts"}),n.jsxs("p",{className:"text-gray-300 mb-2",children:['Copy chord charts from "',((Kt=i==null?void 0:i.find(T=>T.B===ne))==null?void 0:Kt.C)||"Unknown Song",'" to:']}),n.jsx("input",{type:"text",placeholder:"Search songs...",value:H,onChange:T=>K(T.target.value),className:"w-full p-2 mb-4 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500"}),n.jsx("div",{className:"flex-1 overflow-y-auto mb-4 min-h-0 modal-scroll",children:Ws.map(T=>n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx("input",{type:"checkbox",id:`copy-item-${T.A}`,checked:X.has(T.A),onChange:()=>Va(T.A),className:"mr-3"}),n.jsxs("label",{htmlFor:`copy-item-${T.A}`,className:"text-white cursor-pointer flex-1 flex items-center",children:[n.jsx("span",{children:T.C||"Untitled"}),ve.has(T.A)&&n.jsx("span",{className:"text-yellow-400 ml-2 text-sm",children:" âš ï¸will overwrite"})]})]},T.A))}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{variant:"outline",onClick:Jn,className:"flex-1",children:"Cancel"}),n.jsx(Be,{onClick:aa,disabled:X.size===0,style:X.size===0?{backgroundColor:"#4b5563",color:"#d1d5db",opacity:"1"}:ve.size>0?{backgroundColor:"#dc2626",color:"#ffffff",opacity:"1"}:{backgroundColor:"#5b1f1f",color:"#ffffff",opacity:"1"},className:"flex-1 bg-purple-600 hover:bg-purple-700 disabled:cursor-not-allowed",children:ve.size>0?`Copy and Overwrite ${X.size} song${X.size!==1?"s":""}`:`Copy to ${X.size} song${X.size!==1?"s":""}`})]})]})})}),M&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsxs("div",{className:"bg-gray-700 rounded-lg p-6 w-full max-w-md max-h-[80vh] flex flex-col",onWheel:T=>T.stopPropagation(),children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Copy chord charts from other song"}),n.jsxs("p",{className:"text-gray-300 mb-2",children:['Copy chord charts to "',((or=i==null?void 0:i.find(T=>T.B===Te))==null?void 0:or.C)||"Unknown Song",'" from:']}),n.jsx("input",{type:"text",placeholder:"Search songs with chord charts...",value:me,onChange:T=>de(T.target.value),className:"w-full p-2 mb-4 bg-gray-700 text-white rounded border border-gray-600 focus:border-blue-500"}),n.jsx("div",{className:"flex-1 overflow-y-auto mb-4 min-h-0 modal-scroll",children:ui.map(T=>n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx("input",{type:"radio",id:`copy-from-item-${T.A}`,name:"copyFromSource",checked:Le===T.B,onChange:()=>Ie(T.B),className:"mr-3"}),n.jsxs("label",{htmlFor:`copy-from-item-${T.A}`,className:"flex-1 cursor-pointer text-white hover:text-gray-300",children:[T.C||"Unknown Song",n.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:["(",ra[T.B]||0," charts)"]})]})]},T.A))}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{variant:"outline",onClick:Sa,className:"flex-1",children:"Cancel"}),n.jsx(Be,{onClick:xi,disabled:!Le,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Copy chord charts"})]})]})}),n.jsx(Xs,{open:Me,onOpenChange:Ke,children:n.jsxs(Os,{children:[n.jsxs(Ds,{children:[n.jsxs(Bs,{className:"flex items-center space-x-2",children:[n.jsx(Rn,{className:"h-5 w-5 text-orange-500"}),n.jsx("span",{children:"Replace existing chord charts"})]}),n.jsx(Ms,{children:"This song already has chord charts. To use autocreate, all existing chord charts must be deleted first. This action cannot be undone."})]}),n.jsxs(Rs,{children:[n.jsx(xa,{onClick:()=>{Ke(!1),j(null)},children:"Cancel"}),n.jsx(js,{onClick:Ls,className:"bg-orange-500 hover:bg-orange-600 text-white border-orange-500 shadow-lg font-medium",children:"Delete all & autocreate"})]})]})}),n.jsx(Xs,{open:bn,onOpenChange:tn,children:n.jsxs(Os,{className:"w-80 min-h-[600px]",children:[n.jsxs(Ds,{children:[n.jsxs(Bs,{className:"flex items-center space-x-2",children:[n.jsx(Rn,{className:"h-5 w-5 text-blue-500"}),n.jsx("span",{children:"Mixed Content Detected"})]}),n.jsx(Ms,{children:"Your file contains both chord names and chord charts. How would you like to process it?"})]}),n.jsxs("div",{className:"space-y-4 my-8",children:[n.jsxs(js,{onClick:()=>vt("chord_names"),className:"w-full h-auto p-6 flex flex-col items-center bg-slate-700 hover:bg-slate-600 text-white",children:[n.jsx("div",{className:"font-medium",children:"Process Chord Names"}),n.jsx("div",{className:"text-sm text-slate-300 mt-1",children:"(standard tuning)"})]}),n.jsx(js,{onClick:()=>vt("chord_charts"),className:"w-full p-4 bg-slate-700 hover:bg-slate-600 text-white",children:"Import chord charts"})]}),n.jsx(Rs,{children:n.jsx(xa,{onClick:()=>{tn(!1),pn(null)},children:"Cancel"})})]})}),n.jsx(Xs,{open:wn,onOpenChange:Vr,children:n.jsxs(Os,{children:[n.jsxs(Ds,{children:[n.jsxs(Bs,{className:"flex items-center space-x-2",children:[n.jsx(Rn,{className:"h-5 w-5 text-red-500"}),n.jsx("span",{children:($r==null?void 0:$r.title)||"Format Not Supported"})]}),n.jsx(Ms,{children:($r==null?void 0:$r.message)||"Sorry, we can only build chord charts. This file format is not supported."})]}),n.jsx(Rs,{children:n.jsx(js,{onClick:()=>{Vr(!1),xr(null)},children:"OK"})})]})}),n.jsx(Xs,{open:wt,onOpenChange:Jt,children:n.jsxs(Os,{children:[n.jsxs(Ds,{children:[n.jsx(Bs,{children:"Are you sure you wanna do that?"}),n.jsx(Ms,{children:"You'll have to wait just as long next time if you start over"})]}),n.jsxs(Rs,{children:[n.jsx(xa,{onClick:x,children:"*sigh* Ok, I'll wait..."}),n.jsx(js,{onClick:bi,children:"Yes, damnit, cancel!"})]})]})}),n.jsx(Xs,{open:$t,onOpenChange:T=>{T||fi()},children:n.jsxs(Os,{className:"max-w-md",children:[n.jsxs(Ds,{children:[n.jsxs(Bs,{className:"flex items-center space-x-2",children:[n.jsx("span",{children:"ðŸ””"}),n.jsx("span",{children:"Timer sound"})]}),n.jsx(Ms,{asChild:!0,children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("p",{children:["Since this is your first time with the timer, you're going to want to set a level for it. It should be loud enough for you to hear it over your playing, but not loud enough to give you a jump scare or make your ears ring. ",n.jsx("a",{href:"/#Account",className:"text-blue-400 hover:text-blue-300 underline",children:"Go to settings"})," to set your levels now."]}),n.jsx("p",{children:"A bell will ring when your timer is up. If you don't hear it, click the settings icon in your browser's address bar and enable sound:"}),n.jsx("img",{src:"/static/images/chromiumsoundsettings.png",alt:"Browser sound settings - click the settings icon in the address bar and toggle Sound on",className:"rounded border border-gray-600 mx-auto"})]})})]}),n.jsxs(Rs,{className:"flex-col sm:flex-row gap-2",children:[n.jsx(xa,{onClick:fi,children:"Remind me next time"}),n.jsx(js,{onClick:Wa,className:"bg-blue-600 hover:bg-blue-700",children:"Got it"})]})]})}),n.jsx(Uh,{isOpen:Ar,onClose:()=>{dr(!1),wr(null)},error:rs}),n.jsx(vc,{isOpen:Sn,onClose:()=>{rn(!1),Wr(null)},autocreateData:kn}),n.jsx(Xs,{open:Nt,onOpenChange:Ft,children:n.jsxs(Os,{className:"bg-gray-800 border-gray-700 max-w-2xl",children:[n.jsxs(Ds,{children:[n.jsx(Bs,{className:"text-gray-100",children:_i()?"Songbook Folder Path":"Path Copied to Clipboard"}),n.jsx(Ms,{className:"text-gray-300",children:_i()?n.jsxs(n.Fragment,{children:[n.jsx("p",{className:"mb-2",children:"Here's the folder path for this item:"}),n.jsx("code",{className:"block bg-gray-900 p-2 rounded text-sm break-all text-gray-200",children:ar})]}):n.jsxs(n.Fragment,{children:[n.jsxs("p",{className:"mb-2",children:["The path has been copied to your clipboard. Open ",n.jsx("strong",{children:B0()}),", paste, then hit ",n.jsx("kbd",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:"Enter"})," to open the folder."]}),n.jsx("code",{className:"block bg-gray-900 p-2 rounded text-sm break-all text-gray-200",children:ar})]})})]}),n.jsx(Rs,{children:n.jsx(js,{onClick:()=>Ft(!1),className:"bg-orange-600 hover:bg-orange-700 text-white",children:"OK"})})]})}),We&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsxs("div",{className:"bg-gray-700 rounded-lg p-6 w-full max-w-md max-h-[80vh] flex flex-col",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"No Transcripts Available"}),n.jsx("p",{className:"text-gray-300 mb-4",children:"Oh, drag. This YouTube video doesn't have transcripts on it. So, go find a free tool to generate transcripts from YouTube videos, then copy/paste the transcript below:"}),n.jsx("textarea",{value:rt,onChange:T=>it(T.target.value),placeholder:"Paste the transcript here...",className:"w-full h-32 p-3 bg-gray-800 text-white rounded border border-gray-600 focus:border-red-500 resize-none mb-4",maxLength:25e3}),n.jsxs("p",{className:"text-xs text-gray-400 mb-4",children:[rt.length,"/25,000 characters"]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(Be,{variant:"outline",onClick:()=>{Qe(!1),tt(null),it("")},className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-600",children:"Cancel"}),n.jsxs(Be,{variant:"outline",onClick:async()=>{if(!rt.trim()){alert("Please paste a transcript before proceeding.");return}const{itemId:T}=at;Qe(!1),tt(null),await Ze(T,rt),it("")},disabled:!rt.trim(),className:`flex-1 ${rt.trim()?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-600 text-gray-500 cursor-not-allowed"}`,children:[n.jsx(bc,{className:"h-4 w-4 mr-2"}),"ðŸª„ Create chord charts"]})]})]})}),n.jsx(Qn,{open:Ct,onOpenChange:T=>!T&&_t(!1),children:n.jsxs(Hn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Vn,{className:"flex items-center gap-2",children:[n.jsx(Rn,{className:"h-6 w-6 text-orange-500"}),"No Chord Names Found"]}),n.jsx(es,{className:"text-left space-y-1",children:n.jsx("p",{children:"So, um, we can't find any chord names mentioned in this video. Sorry, we can't create tablature yet, just chord charts."})})]}),n.jsx("div",{className:"flex justify-end gap-2 -mt-2",children:n.jsx(Be,{onClick:()=>_t(!1),className:"min-w-20",children:"Ok"})})]})})]})},df=()=>{const[t,r]=U.useState(!1),[e,s]=U.useState(!1),[i,a]=U.useState(!0),[d,o]=U.useState(null),c=U.useCallback(async()=>{try{const b=await fetch("/api/auth/status");if(!b.ok)throw new Error("Auth check failed");const m=await b.json();r(m.authenticated),s(m.hasSpreadsheetAccess),o(null)}catch(b){console.error("Auth check failed:",b),r(!1),s(!1),o(b.message)}finally{a(!1)}},[]);return U.useEffect(()=>{c();const b=setInterval(c,900*1e3);return()=>clearInterval(b)},[c]),{isAuthenticated:t,hasSpreadsheetAccess:e,checking:i,error:d,handleLogin:()=>{window.location.href="/authorize"},handleLogout:()=>{sessionStorage.removeItem("lapsedModalDismissed"),window.location.href="/logout/"},checkAuth:c}},Lm=d0,Em=u0,Pm=h0,uf=U.forwardRef(({className:t,sideOffset:r=4,...e},s)=>n.jsx(c0,{ref:s,sideOffset:r,className:"z-50 overflow-hidden rounded-md bg-gray-900 px-3 py-1.5 text-sm text-gray-50 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",...e}));uf.displayName="TooltipContent";const Tm=Em,Im=()=>{const{isAuthenticated:t,hasSpreadsheetAccess:r,checking:e,error:s,handleLogin:i,handleLogout:a}=df(),{setActivePage:d}=zi();return n.jsxs("div",{className:"ml-auto flex items-end gap-2",children:[t&&!r&&n.jsx("span",{className:"text-sm text-red-400",children:"Log in with gmail acct instead"}),t?n.jsxs("div",{className:"flex flex-col gap-1 items-end",children:[n.jsx(Lm,{children:n.jsxs(Tm,{children:[n.jsx(Pm,{asChild:!0,children:n.jsx(Be,{onClick:()=>d("Account"),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-200 h-auto py-1","aria-label":"Account settings","data-ph-capture-attribute-button":"account-settings",children:n.jsx(I0,{className:"h-4 w-4"})})}),n.jsx(uf,{children:n.jsx("p",{children:"Account/Settings"})})]})}),n.jsx(Be,{onClick:a,variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-200 h-auto py-1","data-ph-capture-attribute-button":"logout",children:"logout"})]}):e?null:n.jsx(Be,{onClick:i,variant:"default",className:"bg-blue-600 hover:bg-blue-700 text-gray-100","data-ph-capture-attribute-button":"login",children:s?"Auth Error - Click to retry":n.jsxs(n.Fragment,{children:[n.jsx(L0,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Let me in"]})})]})},Fm=({className:t,userStatus:r,onUnpluggedAttempt:e})=>{const{activePage:s,setActivePage:i}=zi(),a=["Practice","Routines","Items"],d=o=>{if(r!=null&&r.unplugged_mode&&(o==="Routines"||o==="Items")){e==null||e(o);return}i(o)};return n.jsxs("nav",{className:qr("flex flex-wrap items-center gap-4",t),"aria-label":"Main navigation",children:[n.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.map(o=>n.jsx(Be,{variant:s===o?"secondary":"ghost",className:qr("text-xl py-6 px-8",s===o?"bg-secondary hover:bg-secondary/90":"hover:bg-accent"),onClick:()=>d(o),"aria-current":s===o?"page":void 0,"data-tour":o==="Practice"?"practice-tab":o==="Routines"?"routines-tab":o==="Items"?"items-tab":void 0,"data-ph-capture-attribute-nav":`nav-${o.toLowerCase()}`,children:o},o)),n.jsx(Be,{variant:s==="Account"?"secondary":"ghost",className:qr("text-xl py-6 px-8",s==="Account"?"bg-secondary hover:bg-secondary/90":"hover:bg-accent","hidden"),onClick:()=>i("Account"),"aria-current":s==="Account"?"page":void 0,"data-tour":"account-tab",children:"Account"})]}),n.jsx(Im,{})]})},Om=(t=null,r=null,e=[])=>{const[s,i]=U.useState([]),[a,d]=U.useState({}),[o,c]=U.useState(""),[h,p]=U.useState(!0),[b,m]=U.useState(null);U.useEffect(()=>{r!=null&&r.items?(i(r.items),p(!1)):t?u():(i([]),p(!1))},[t,r]);const u=async()=>{try{const A=await fetch(`/api/routines/${t}/details`);if(!A.ok)throw new Error("Failed to fetch routine");const E=(await A.json()).items.sort((F,Z)=>parseInt(F.routineEntry.C)-parseInt(Z.routineEntry.C));i(E),m(null)}catch(A){m(A.message),console.error("Fetch error:",A)}finally{p(!1)}};return{availableItems:U.useMemo(()=>{const A=new Set(s.map(E=>{var F,Z;return((F=E.itemDetails)==null?void 0:F.B)||((Z=E.routineEntry)==null?void 0:Z.B)}));return e.filter(E=>{const F=A.has(E.B),Z=I=>I.replace(/[''`]/g,"'"),Y=E.C||"",G=Z(Y.toLowerCase()),O=Z(o.toLowerCase()),Q=G.includes(O);return!F&&Q})},[e,s,o]),selectedItems:s,setSelectedItems:i,searchQuery:o,setSearchQuery:c,loading:h,error:b,addToRoutine:async(A,L)=>{try{if(!(await fetch(`/api/routines/${A}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemId:L})})).ok)throw new Error("Failed to add item to routine");return await u(),!0}catch(E){return console.error("Error adding item:",E),!1}},removeFromRoutine:async(A,L)=>{try{const E=await fetch(`/api/routines/${A}/items/${L}`,{method:"DELETE"});if(!E.ok){const F=await E.json().catch(()=>({}));throw new Error(F.message||"Failed to remove item from routine")}return i(F=>F.filter(Z=>Z.routineEntry.A!==L)),!0}catch(E){return console.error("Error removing item:",E),!1}},updateRoutineOrder:async(A,L)=>{try{const E=L.map(Y=>({A:Y.A,C:Y.C})),F=`/api/routines/${A}/order`,Z=await fetch(F,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!Z.ok){const Y=await Z.json().catch(()=>({}));throw console.error("Order update failed:",Y),new Error(Y.message||"Failed to update routine order")}return await u(),!0}catch(E){return console.error("Error updating routine order:",E),!1}}}},Dm=Ui.memo(({item:t,onAdd:r})=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-800 rounded-lg",children:[n.jsx("span",{className:"text-lg",children:t.C}),n.jsx(Be,{variant:"ghost",size:"sm",onClick:()=>r(t),className:"text-blue-500 hover:text-blue-400","aria-label":"Add item to routine","data-ph-capture-attribute-button":"routine-add-item",children:n.jsx(yo,{className:"h-4 w-4","aria-hidden":"true"})})]})),Rm=Ui.memo(({item:t,onRemove:r})=>{var h,p;const{attributes:e,listeners:s,setNodeRef:i,transform:a,transition:d,isDragging:o}=Nl({id:((h=t.routineEntry)==null?void 0:h.A)||t.A}),c={transform:_l.Transform.toString(a),transition:d,zIndex:o?1:0};return n.jsxs("div",{ref:i,style:c,className:`flex items-center justify-between p-4 ${o?"bg-gray-700":"bg-gray-800"} rounded-lg`,children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{...e,...s,"aria-label":"Drag to reorder item in routine","data-ph-capture-attribute-drag":"routine-editor-drag-handle",children:n.jsx(jl,{className:"h-5 w-5 text-gray-500 mr-4 cursor-move","aria-hidden":"true"})}),n.jsx("span",{className:"text-lg",children:((p=t.itemDetails)==null?void 0:p.C)||"Loading..."})]}),n.jsx(Be,{variant:"ghost",size:"sm",onClick:()=>{var b;return r(((b=t.routineEntry)==null?void 0:b.A)||t.A)},className:"text-red-500 hover:text-red-400","aria-label":"Remove item from routine","data-ph-capture-attribute-button":"routine-remove-item",children:n.jsx(Gr,{className:"h-4 w-4","aria-hidden":"true"})})]})}),Bm=({open:t,onOpenChange:r,routine:e=null,onRoutineChange:s,items:i=[]})=>{const{availableItems:a,selectedItems:d,setSelectedItems:o,searchQuery:c,setSearchQuery:h,loading:p,error:b,addToRoutine:m,removeFromRoutine:u,updateRoutineOrder:w}=Om(e==null?void 0:e.id,e==null?void 0:e.details,i),[g,_]=U.useState((e==null?void 0:e.name)||""),[y,A]=U.useState(null);U.useEffect(()=>{t&&A(null)},[t]),U.useEffect(()=>{},[e]);const L=Uc(Mi($c,{activationConstraint:{delay:100,tolerance:5}}),Mi(qc,{coordinateGetter:zc})),E=async({active:Y,over:G})=>{if(Y.id!==(G==null?void 0:G.id)){const O=d.findIndex(D=>{var v;return(((v=D.routineEntry)==null?void 0:v.A)||D.A)===Y.id}),Q=d.findIndex(D=>{var v;return(((v=D.routineEntry)==null?void 0:v.A)||D.A)===G.id}),I=fl(d,O,Q),k=I.map((D,v)=>{var te;return{A:((te=D.routineEntry)==null?void 0:te.A)||D.A,C:v.toString()}});if(o(I),e!=null&&e.id)try{await w(e.id,k),s&&s()}catch(D){console.error("Failed to update routine order:",D),o(d)}}},F=async Y=>{try{if(A(null),!(e!=null&&e.id))o(G=>[...G,{routineEntry:{A:Y.A,B:Y.B,C:G.length.toString(),D:"FALSE"},itemDetails:Y}]);else{if(!await m(e.id,Y.B))throw new Error("Failed to add item to routine");yc("item_added",e.name,Y.C,{routine_id:e.id,item_id:Y.B}),s==null||s()}}catch(G){A(G.message),console.error("Error adding item:",G)}},Z=async Y=>{var G,O;try{if(A(null),!(e!=null&&e.id))o(Q=>Q.filter(I=>I.routineEntry.A!==Y));else{const Q=d.find(k=>{var D;return(((D=k.routineEntry)==null?void 0:D.A)||k.A)===Y});if(!await u(e.id,Y))throw new Error("Failed to remove item from routine");Q&&yc("item_removed",e.name,(G=Q.itemDetails)==null?void 0:G.C,{routine_id:e.id,item_id:(O=Q.itemDetails)==null?void 0:O.B}),s==null||s()}}catch(Q){A(Q.message),console.error("Error removing item:",Q)}};return p?n.jsx("div",{className:"text-2xl text-center p-8",role:"status","aria-live":"polite",children:"Loading..."}):b?n.jsx("div",{className:"text-2xl text-red-500 text-center p-8",role:"alert",children:b}):n.jsx(Qn,{open:t,onOpenChange:r,children:n.jsxs(Hn,{className:"max-w-4xl max-h-[80vh]",children:[n.jsxs(Gn,{children:[n.jsx(Vn,{children:e?`Edit routine: ${e.name}`:"Create new routine"}),n.jsx(es,{children:"Add or remove items and arrange them in your preferred order"}),y&&n.jsx("div",{className:"mt-2 text-sm text-red-500",role:"alert",children:y})]}),n.jsxs("div",{className:"flex gap-8 h-[60vh]",children:[n.jsxs(ln,{className:"w-1/2 bg-gray-900",children:[n.jsxs(_n,{children:[n.jsx(cn,{children:"Selected items"}),!(e!=null&&e.name)&&n.jsx(Dr,{placeholder:"Enter routine name...",value:g,onChange:Y=>_(Y.target.value),className:"mt-2",autoComplete:"off"})]}),n.jsx(dn,{className:"space-y-4 overflow-y-auto h-[calc(100%-100px)]",children:n.jsx(cl,{sensors:L,collisionDetection:dl,onDragEnd:E,children:n.jsx(ul,{items:d.map(Y=>{var G;return((G=Y.routineEntry)==null?void 0:G.A)||Y.A}).filter(Y=>Y!=null),strategy:hl,children:n.jsx("div",{className:"space-y-4",children:d.filter(Y=>{var G;return(((G=Y.routineEntry)==null?void 0:G.A)||Y.A)!=null}).map(Y=>{var G;return n.jsx(Rm,{item:Y,onRemove:Z},((G=Y.routineEntry)==null?void 0:G.A)||Y.A)})})})})})]}),n.jsxs(ln,{className:"w-1/2 bg-gray-900",children:[n.jsxs(_n,{children:[n.jsx(cn,{children:"Available items"}),n.jsxs("div",{className:"relative",children:[n.jsx(T0,{className:"absolute left-3 top-3 h-4 w-4 text-gray-500"}),n.jsx(Dr,{className:"pl-9",placeholder:"Search items...",value:c,onChange:Y=>h(Y.target.value),autoComplete:"off"})]})]}),n.jsx(dn,{className:"space-y-4 overflow-y-auto h-[calc(100%-100px)]",children:a.map(Y=>n.jsx(Dm,{item:Y,onAdd:F},Y.A))})]})]})]})})},Mm=Ui.memo(({item:t,itemDetails:r,handleOpenChordCharts:e})=>{var p,b,m;const{attributes:s,listeners:i,setNodeRef:a,transform:d,transition:o,isDragging:c}=Nl({id:((p=t.routineEntry)==null?void 0:p.A)||t.A}),h={transform:_l.Transform.toString(d),transition:o,zIndex:c?1:0};return n.jsxs("div",{ref:a,style:h,className:`flex items-center justify-between p-4 rounded-lg ${c?"bg-gray-700":"bg-gray-800"}`,children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{...s,...i,"aria-label":"Drag to reorder item","data-ph-capture-attribute-drag":"routine-item-drag-handle",children:n.jsx(jl,{className:"h-5 w-5 text-gray-500 mr-4 cursor-move","aria-hidden":"true"})}),n.jsx("span",{className:"text-lg",children:(r==null?void 0:r.C)||`Item ${((b=t.routineEntry)==null?void 0:b.B)||t.B}`})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(Be,{variant:"ghost",size:"icon",onClick:()=>{var u,w;return e(((u=t.routineEntry)==null?void 0:u.B)||t.B,(r==null?void 0:r.C)||`Item ${((w=t.routineEntry)==null?void 0:w.B)||t.B}`)},className:"text-blue-400 hover:text-blue-300 hover:bg-gray-700 h-8 w-8",title:"Click to add or edit chord charts","data-ph-capture-attribute-button":"routine-item-chord-charts",children:[n.jsx(cf,{className:"h-5 w-5","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Chord charts"})]}),(((m=t.routineEntry)==null?void 0:m.D)||t.D)==="TRUE"&&n.jsx(Mc,{className:"h-5 w-5 text-green-500","aria-hidden":"true"})]})]})}),Um=Ui.memo(({routine:t,handleActivateRoutine:r,handleEditClick:e,handleDeleteClick:s})=>{const{attributes:i,listeners:a,setNodeRef:d,transform:o,transition:c,isDragging:h}=Nl({id:t.ID}),p={transform:_l.Transform.toString(o),transition:c,zIndex:h?1:0};return n.jsxs("div",{ref:d,style:p,className:`flex items-center justify-between p-3 ${h?"bg-gray-700":"bg-gray-800"} rounded-lg`,children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{...i,...a,"aria-label":"Drag to reorder routine","data-ph-capture-attribute-drag":"routine-drag-handle",children:n.jsx(jl,{className:"h-5 w-5 text-gray-500 mr-4 cursor-move","aria-hidden":"true"})}),n.jsx("span",{children:t.name})]}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsxs(Be,{variant:"ghost",size:"sm",onClick:()=>r(t.ID),className:"text-green-500 hover:text-green-400",title:"Make this the active routine","data-ph-capture-attribute-button":"activate-routine",children:[n.jsx(yo,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Activate routine"})]}),n.jsxs(Be,{variant:"ghost",size:"sm",onClick:()=>e(t),className:"text-blue-500 hover:text-blue-400",title:"Edit routine","data-ph-capture-attribute-button":"edit-routine",children:[n.jsx(po,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Edit routine"})]}),n.jsxs(Be,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400",onClick:()=>s(t.ID),title:"Delete this routine","data-ph-capture-attribute-button":"delete-routine",children:[n.jsx(Gr,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Delete routine"})]})]})]})}),zm=()=>{const{isAuthenticated:t,checking:r}=df(),[e,s]=U.useState([]),[i,a]=U.useState(""),[d,o]=U.useState([]),[c,h]=U.useState(!0),[p,b]=U.useState(null),[m,u]=U.useState(!1),[w,g]=U.useState(null),[_,y]=U.useState(null),[A,L]=U.useState([]),[E,F]=U.useState(!1),[Z,Y]=U.useState(null),[G,O]=U.useState(""),[Q,I]=U.useState(!1),[k,D]=U.useState({limitType:"routines",currentTier:"free",currentCount:0,limitAmount:1}),v=U.useRef(null),te=U.useRef(null),ce=U.useMemo(()=>d.find(je=>je.active),[d]),re=U.useMemo(()=>d.filter(je=>!je.active).sort((je,j)=>Number(je.order)-Number(j.order)),[d]),se=Uc(Mi($c,{activationConstraint:{delay:100,tolerance:5}}),Mi(qc,{coordinateGetter:zc})),le=U.useCallback(async()=>{if(!t){h(!1);return}try{y(null);const je=await fetch("/api/routines");if(!je.ok)throw new Error("Failed to fetch routines");const j=await je.json();o(j)}catch(je){console.error("Error:",je),y(je.message)}finally{h(!1)}},[t]),Se=U.useCallback(async()=>{if(e.length===0)try{const je=await fetch("/api/items");if(!je.ok)throw new Error("Failed to fetch items");const j=await je.json();s(j)}catch(je){console.error("Error fetching items:",je),y(je.message)}},[e.length]),ne=U.useCallback(async je=>{try{if(!(await fetch(`/api/routines/${je}/active`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!0})})).ok)throw new Error("Failed to activate routine");const P=await fetch("/api/routines");if(P.ok){const V=await P.json();o(V);const $=V.find(z=>z.active);if($){yc("activated",$.Name,null,{routine_id:$.ID,item_count:$.ItemCount||0});const z=await fetch(`/api/routines/${$.ID}`);if(z.ok){const he=(await z.json()).items.sort((me,de)=>parseInt(me.routineEntry.C)-parseInt(de.routineEntry.C)).map(me=>({...me,itemDetails:me.itemDetails||me}));L(he)}}}}catch(j){console.error("Error:",j),y(j.message)}},[]),C=U.useCallback(async je=>{try{if(!(await fetch(`/api/routines/${je}/active`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!1})})).ok)throw new Error("Failed to deactivate routine");const P=await fetch("/api/routines");if(P.ok){const V=await P.json();o(V),L([])}}catch(j){console.error("Error:",j),y(j.message)}},[]),H=U.useCallback(je=>{b(d.find(j=>j.ID===je))},[d]),K=U.useCallback((je,j)=>{Y(je),O(j),F(!0)},[]),X=U.useCallback(async()=>{if(p)try{if(!(await fetch(`/api/routines/${p.ID}`,{method:"DELETE"})).ok)throw new Error("Failed to delete routine");fo("deleted","routine",p.Name),await le()}catch(je){console.error("Failed to delete routine:",je),y(je.message)}finally{b(null)}},[p,le]),pe=U.useCallback(async()=>{if(i.trim())try{const je=await fetch("/api/routines",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({routineName:i.trim()})});if(!je.ok){if(je.status===403){const j=await je.json();if(j.error==="Routine limit reached"){D({limitType:"routines",currentTier:j.tier||"free",currentCount:j.current||0,limitAmount:j.limit||1}),I(!0);return}}throw new Error("Failed to create routine")}fo("created","routine",i.trim()),await le(),a("")}catch(je){console.error("Failed to create routine:",je),y(je.message)}},[i,le]),ve=U.useCallback(async je=>{await Se();const j=je.active?{id:je.ID,name:je.name,items:A.map(P=>({routineEntry:P.routineEntry||P,itemDetails:P.itemDetails}))}:null;g({id:je.ID,name:je.name,details:j}),u(!0)},[A,Se]),ke=U.useCallback(async()=>{const je=await fetch("/api/routines");if(!je.ok){console.error("Failed to fetch routines");return}const j=await je.json();o(j);const P=j.find($=>$.active);if(!P){L([]);return}const V=await fetch(`/api/routines/${P.ID}`);if(V.ok){const z=(await V.json()).items.sort((M,he)=>parseInt(M.routineEntry.C)-parseInt(he.routineEntry.C)).map(M=>({...M,itemDetails:M.itemDetails||M}));L(z)}},[]),Ae=U.useCallback(async()=>{try{const je=await fetch("/api/routines");if(!je.ok)throw new Error("Failed to fetch routines");const P=(await je.json()).find(M=>M.active);if(!P){L([]);return}const V=await fetch(`/api/routines/${P.ID}`);if(!V.ok)throw new Error("Failed to fetch routine details");const z=(await V.json()).items.sort((M,he)=>parseInt(M.routineEntry.C)-parseInt(he.routineEntry.C)).map(M=>({...M,itemDetails:M.itemDetails||M}));L(z),fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`LOAD: Active routine items loaded: ${z.length} items`,level:"info"})}),z.length>0&&fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`LOAD: Sortable IDs: ${z.map(M=>{var he;return((he=M.routineEntry)==null?void 0:he.A)||M.A}).join(", ")}`,level:"info"})})}catch(je){console.error("Error fetching routine items:",je),y(je.message)}},[]);U.useEffect(()=>{Ae()},[Ae]);const Re=async({active:je,over:j})=>{if(fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`ACTIVE ROUTINE handleDragEnd called: active=${je==null?void 0:je.id}, over=${j==null?void 0:j.id}`,level:"info"})}),!je||!j||je.id===j.id){fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"ACTIVE ROUTINE Drag end early return - no valid drag",level:"info"})});return}const P=A.findIndex($=>{var z;return(((z=$.routineEntry)==null?void 0:z.A)||$.A)===je.id}),V=A.findIndex($=>{var z;return(((z=$.routineEntry)==null?void 0:z.A)||$.A)===j.id});fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`ACTIVE ROUTINE Indices: old=${P}, new=${V}, activeId=${je.id}, overId=${j.id}`,level:"info"})});try{const $=await fetch("/api/routines/active");if(!$.ok)throw new Error("Failed to fetch active routine");const M=(await $.json()).A;if(!M)throw new Error("No active routine found");const he=fl(A,P,V),me=he.map((Ie,Te)=>{var Ve;return{A:((Ve=Ie.routineEntry)==null?void 0:Ve.A)||Ie.A,C:Te.toString()}});L(he);const de=`/api/routines/${M}/order`,Le=await fetch(de,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(me)});if(!Le.ok){const Ie=await Le.text();throw new Error(`Failed to update routine order: ${Ie}`)}await Ae()}catch($){console.error("Reorder failed:",$),await Ae()}},Me=U.useCallback(async je=>{try{const j=await fetch("/api/routines/order",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(je)});if(!j.ok){const P=await j.text();throw new Error(`Failed to update routine order: ${P}`)}}catch(j){console.error("Failed to save routine order:",j),y("Failed to save routine order. Please refresh the page."),await le()}},[le]),Ke=({active:je,over:j})=>{if(fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`INACTIVE ROUTINES handleDragEnd called: active=${je==null?void 0:je.id}, over=${j==null?void 0:j.id}`,level:"info"})}),!je||!j||je.id===j.id)return;const P=re.findIndex(M=>M.ID===je.id),V=re.findIndex(M=>M.ID===j.id),z=fl(re,P,V).map((M,he)=>({A:M.ID,D:he.toString()}));o(M=>{const he=M.find(de=>de.active),me=z.map(de=>({...M.find(Ie=>Ie.ID===de.A),order:de.D}));return he?[he,...me]:me}),te.current=z,v.current&&clearTimeout(v.current),v.current=setTimeout(()=>{te.current&&(Me(te.current),te.current=null)},500)};return U.useEffect(()=>{r||(h(!0),le())},[r,le]),U.useEffect(()=>()=>{v.current&&(clearTimeout(v.current),te.current&&Me(te.current))},[Me]),r?n.jsx("div",{className:"text-center p-8",role:"status","aria-live":"polite",children:n.jsx("h2",{className:"text-2xl mb-4",children:"Checking authentication..."})}):c?n.jsx("div",{className:"text-center p-8",role:"status","aria-live":"polite",children:n.jsx("h2",{className:"text-2xl mb-4",children:"Loading routines..."})}):_?n.jsxs("div",{className:"text-center p-8",children:[n.jsxs("h2",{className:"text-2xl text-red-500 mb-4",children:["Error: ",_]}),n.jsx(Be,{onClick:le,className:"bg-blue-600 hover:bg-blue-700",children:"Retry"})]}):t?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs(ln,{className:"bg-gray-900 text-gray-100","data-tour":"routines-items",children:[n.jsx(_n,{children:n.jsx(cn,{children:"Current active routine"})}),n.jsx(dn,{children:t?ce?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(Mc,{className:"h-5 w-5 text-green-500 mr-2","aria-hidden":"true"}),ce.name]}),n.jsxs("div",{className:"flex space-x-2","data-tour":"edit-routine-icon",children:[n.jsxs(Be,{variant:"ghost",size:"sm",onClick:()=>ve(ce),className:"text-blue-500 hover:text-blue-400",title:"Edit routine",children:[n.jsx(po,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Edit routine"})]}),n.jsxs(Be,{variant:"ghost",size:"sm",onClick:()=>C(ce.ID),className:"text-gray-400 hover:text-gray-200",title:"Deactivate this routine",children:[n.jsx(Gr,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Deactivate routine"})]})]})]}),n.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"(use drag and drop handles on the left to change order of items)"}),n.jsx(cl,{sensors:se,collisionDetection:dl,onDragStart:je=>{fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`ACTIVE ROUTINE Drag started: ${je.active.id}`,level:"info"})})},onDragEnd:Re,children:n.jsx(ul,{items:A.map(je=>{var j;return((j=je.routineEntry)==null?void 0:j.A)||je.A}),strategy:hl,children:n.jsx("div",{className:"space-y-2 mt-4",children:A.map(je=>{var j;return n.jsx(Mm,{item:je,itemDetails:je.itemDetails,handleOpenChordCharts:K},((j=je.routineEntry)==null?void 0:j.A)||je.A)})})})})]}):n.jsx("div",{className:"text-gray-400",children:"No active routine selected"}):n.jsx("div",{className:"text-gray-400",children:"Please log in to manage routines"})})]}),n.jsxs(ln,{className:"bg-gray-900 text-gray-100",children:[n.jsx(_n,{children:n.jsx(cn,{children:"Routines"})}),n.jsx(dn,{children:t?n.jsx(n.Fragment,{children:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"mb-4 flex space-x-2","data-tour":"new-routine-input",children:[n.jsx("label",{htmlFor:"new-routine-name-input",className:"sr-only",children:"New routine name"}),n.jsx(Dr,{id:"new-routine-name-input",placeholder:"Enter name for new routine, then click '+ Add'",value:i,onChange:je=>a(je.target.value),onKeyPress:je=>je.key==="Enter"&&!je.shiftKey&&pe(),className:"flex-grow"}),n.jsxs(Be,{onClick:pe,className:"bg-blue-600 hover:bg-blue-700",disabled:!i.trim(),"data-ph-capture-attribute-button":"add-new-routine",children:[n.jsx(yo,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Add"]})]}),n.jsx(cl,{sensors:se,collisionDetection:dl,onDragEnd:Ke,children:n.jsx(ul,{items:re.map(je=>je.ID).filter(je=>je!=null),strategy:hl,children:n.jsx("div",{className:"space-y-2",children:re.filter(je=>je.ID!=null).map(je=>n.jsx(Um,{routine:je,handleActivateRoutine:ne,handleEditClick:ve,handleDeleteClick:H},je.ID))})})})]})}):n.jsx("div",{className:"text-gray-400",children:"Please log in to manage routines"})})]}),n.jsx(Xs,{open:!!p,onOpenChange:je=>{je||b(null)},children:n.jsxs(Os,{children:[n.jsxs(Ds,{children:[n.jsx(Bs,{children:"Delete routine"}),n.jsxs(Ms,{children:['Are you sure you want to delete the "',p==null?void 0:p.name,`" routine? You can't undo this deletion. (Items will remain, but the routine will be gone.)`]})]}),n.jsxs(Rs,{children:[n.jsx(xa,{children:"Cancel"}),n.jsx(js,{onClick:X,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})})]}),n.jsx(Bm,{open:m,onOpenChange:u,routine:w,onRoutineChange:ke,items:e}),n.jsx(lf,{isOpen:E,onClose:()=>F(!1),itemId:Z,itemTitle:G}),n.jsx(Dh,{isOpen:Q,onClose:()=>I(!1),limitType:k.limitType,currentTier:k.currentTier,currentCount:k.currentCount,limitAmount:k.limitAmount})]}):n.jsx("div",{className:"text-center p-8",children:n.jsx("h2",{className:"text-2xl mb-4",children:"Please log in to manage routines"})})},qm=()=>{const[t,r]=U.useState([]),[e,s]=U.useState(null),[i,a]=U.useState(!0),[d,o]=U.useState(null),c=async()=>{try{a(!0);const m=await fetch("/api/routines");if(!m.ok)throw new Error("Failed to fetch routines");const u=await m.json();r(u),o(null)}catch(m){console.error("Fetch routines error:",m),o(m.message)}finally{a(!1)}},h=async m=>{try{if(!(await fetch("/api/routines",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({routineName:m})})).ok)throw new Error("Failed to create routine");return await c(),!0}catch(u){return console.error("Create routine error:",u),o(u.message),!1}},p=async m=>{try{if(!(await fetch(`/api/routines/${m}`,{method:"DELETE"})).ok)throw new Error("Failed to delete routine");return await c(),!0}catch(u){return console.error("Delete routine error:",u),o(u.message),!1}},b=async m=>{s(m)};return U.useEffect(()=>{c()},[]),{routines:t,activeRoutine:e,loading:i,error:d,createRoutine:h,deleteRoutine:p,activateRoutine:b,refreshRoutines:c}},$m=y0,Wm=b0,hf=U.forwardRef(({className:t,children:r,...e},s)=>n.jsxs(bh,{ref:s,className:qr("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...e,children:[r,n.jsx(f0,{asChild:!0,children:n.jsx(Xn,{className:"h-4 w-4 opacity-50"})})]}));hf.displayName=bh.displayName;const ff=U.forwardRef(({className:t,children:r,position:e="popper",...s},i)=>n.jsx(p0,{children:n.jsx(wh,{ref:i,className:qr("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:e,...s,children:n.jsx(m0,{className:qr("p-1",e==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r})})}));ff.displayName=wh.displayName;const Hm=U.forwardRef(({className:t,...r},e)=>n.jsx(vh,{ref:e,className:qr("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r}));Hm.displayName=vh.displayName;const pf=U.forwardRef(({className:t,children:r,...e},s)=>n.jsxs(Nh,{ref:s,className:qr("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...e,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(g0,{children:n.jsx(Nn,{className:"h-4 w-4"})})}),n.jsx(x0,{children:r})]}));pf.displayName=Nh.displayName;const Gm=U.forwardRef(({className:t,...r},e)=>n.jsx(_h,{ref:e,className:qr("-mx-1 my-1 h-px bg-muted",t),...r}));Gm.displayName=_h.displayName;function Vm(){const[t,r]=U.useState(""),[e,s]=U.useState(""),[i,a]=U.useState(""),[d,o]=U.useState(""),{routines:c,loading:h}=qm(),p=async()=>{try{const u=JSON.parse(t);if(!(await fetch("/api/items/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).ok)throw new Error("Failed to import items");r("")}catch(u){console.error("Import error:",u)}},b=async()=>{try{const u=JSON.parse(e);if(!(await fetch("/api/routines/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).ok)throw new Error("Failed to import routines");s("")}catch(u){console.error("Import error:",u)}},m=async()=>{try{if(!d)throw new Error("Please select a routine first");const u=JSON.parse(i);if(!(await fetch(`/api/routines/${d}/items/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).ok)throw new Error("Failed to import routine items");a("")}catch(u){console.error("Import error:",u)}};return n.jsx(ln,{className:"w-full max-w-4xl bg-gray-900 text-gray-100",children:n.jsxs(dn,{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx(cn,{className:"text-2xl mb-4",children:"Import Items"}),n.jsx("p",{className:"text-gray-300 mb-4",children:"Import practice items from other sources. Items will be appended to your existing items."}),n.jsx(Ii,{value:t,onChange:u=>r(u.target.value),placeholder:"Paste your JSON data here...",className:"h-48 font-mono bg-gray-800 mb-2"}),n.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Expected format: Array of objects with 'title' and 'duration' fields"}),n.jsx(Be,{onClick:p,className:"bg-blue-600 hover:bg-blue-700",children:"Import Items"})]}),n.jsxs("div",{children:[n.jsx(cn,{className:"text-2xl mb-4",children:"Import Routine Items"}),n.jsx("p",{className:"text-gray-300 mb-4",children:"Import items into an existing routine. Items will be matched by title with existing items."}),n.jsxs("div",{className:"mb-4",children:[n.jsx(Wn,{htmlFor:"routine-select",className:"block mb-2",children:"Select Routine"}),n.jsxs($m,{value:d,onValueChange:o,disabled:h,children:[n.jsx(hf,{className:"w-full bg-gray-800",children:n.jsx(Wm,{placeholder:"Select a routine"})}),n.jsx(ff,{className:"bg-gray-800",children:c.map(u=>n.jsx(pf,{value:u.ID,className:"text-gray-100 hover:bg-gray-700",children:u.name},u.ID))})]})]}),n.jsx(Ii,{value:i,onChange:u=>a(u.target.value),placeholder:"Paste your JSON data here...",className:"h-48 font-mono bg-gray-800 mb-2"}),n.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Expected format: Array of objects with 'title' field"}),n.jsx(Be,{onClick:m,className:"bg-blue-600 hover:bg-blue-700",children:"Import Routine Items"})]}),n.jsxs("div",{children:[n.jsx(cn,{className:"text-2xl mb-4",children:"Import Routines"}),n.jsx("p",{className:"text-gray-300 mb-4",children:"Import practice routines. Each routine will be created as a new routine."}),n.jsx(Ii,{value:e,onChange:u=>s(u.target.value),placeholder:"Paste your JSON data here...",className:"h-48 font-mono bg-gray-800 mb-2"}),n.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Expected format: Array of objects with 'name' field"}),n.jsx(Be,{onClick:b,className:"bg-blue-600 hover:bg-blue-700",children:"Import Routines"})]})]})})}const Ym=({isOpen:t,onClose:r,title:e,message:s,icon:i})=>{if(!t)return null;const a=()=>i||(e!=null&&e.includes("Upgraded")?n.jsx(Th,{className:"h-6 w-6 text-green-500"}):e!=null&&e.includes("Billing Updated")?n.jsx(kh,{className:"h-6 w-6 text-blue-500"}):e!=null&&e.includes("Changed")?n.jsx(P0,{className:"h-6 w-6 text-orange-500"}):n.jsx(Sh,{className:"h-6 w-6 text-green-500"}));return n.jsx(Qn,{open:t,onOpenChange:d=>!d&&r(),children:n.jsxs(Hn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Vn,{className:"flex items-center gap-2 text-xl",children:[a(),e]}),n.jsx(es,{className:"text-left space-y-3 text-base mt-4",children:n.jsx("div",{className:"whitespace-pre-line text-gray-700 dark:text-gray-300",children:s})})]}),n.jsx("div",{className:"flex justify-end mt-6",children:n.jsx(Be,{onClick:r,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6",children:"Got it! ðŸŽ¸"})})]})})},Jm=({isOpen:t,onClose:r,onConfirm:e,targetTier:s,targetTierName:i,billingPeriod:a="monthly",currentTier:d})=>{const[o,c]=U.useState(!0),[h,p]=U.useState(!1),[b,m]=U.useState(null),[u,w]=U.useState(null),[g,_]=U.useState(""),[y,A]=U.useState(!1),[L,E]=U.useState(null),[F,Z]=U.useState(null);U.useEffect(()=>{t&&s&&Y()},[t,s,L==null?void 0:L.promotion_code_id]),U.useEffect(()=>{t||(_(""),E(null),Z(null),w(null),m(null))},[t]);const Y=async()=>{c(!0),m(null);try{const D={tier:s,billing_period:a};L!=null&&L.promotion_code_id&&(D.promotion_code_id=L.promotion_code_id);const v=await fetch("/api/billing/preview-upgrade",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)}),te=await v.json();if(!v.ok){m(te.error||"Failed to preview upgrade"),c(!1);return}w(te)}catch{m("Error connecting to server")}finally{c(!1)}},G=async()=>{if(g.trim()){A(!0),Z(null),E(null);try{const v=await(await fetch("/api/billing/validate-promo-code",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:g.trim()})})).json();v.valid?E(v):Z(v.error||"Invalid promo code")}catch{Z("Error validating promo code")}finally{A(!1)}}},O=()=>{_(""),E(null),Z(null)},Q=async()=>{p(!0);try{if(u!=null&&u.no_existing_subscription){const re=await fetch("/api/billing/create-checkout-session",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({tier:s,billing_period:a})}),se=await re.json();if(!re.ok){m(se.error||"Failed to create checkout session"),p(!1);return}se.url&&(window.location.href=se.url);return}const D={tier:s,billing_period:a};L!=null&&L.promotion_code_id&&(D.promotion_code_id=L.promotion_code_id);const v=await fetch("/api/billing/update-subscription",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(D)}),te=await v.json();if(!v.ok){m(te.error||"Failed to update subscription"),p(!1);return}e(te)}catch{m("Error connecting to server"),p(!1)}},I=D=>{D.key==="Enter"&&g.trim()&&!y&&G()};if(!t)return null;const k=i||s;return n.jsx(Qn,{open:t,onOpenChange:D=>!D&&r(),children:n.jsxs(Hn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Vn,{className:"flex items-center gap-2 text-xl",children:[n.jsx(Th,{className:"h-6 w-6 text-orange-500"}),"Upgrade to ",k]}),n.jsx(es,{className:"text-left mt-4",children:"Review your upgrade details before confirming."})]}),n.jsxs("div",{className:"space-y-4 mt-4",children:[!(u!=null&&u.no_existing_subscription)&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Have a promo code?"}),L?n.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Sh,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),n.jsxs("div",{children:[n.jsx("span",{className:"font-medium text-green-800 dark:text-green-300",children:g.toUpperCase()}),n.jsxs("span",{className:"text-sm text-green-600 dark:text-green-400 ml-2",children:[L.description,L.duration_description&&` ${L.duration_description}`]})]})]}),n.jsx(Be,{variant:"ghost",size:"sm",onClick:O,className:"text-green-600 hover:text-green-700 dark:text-green-400",children:"Remove"})]}):n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Dr,{type:"text",placeholder:"Enter code",value:g,onChange:D=>_(D.target.value.toUpperCase()),onKeyPress:I,disabled:y,className:"flex-1 bg-white dark:bg-gray-800"}),n.jsx(Be,{onClick:G,disabled:!g.trim()||y,className:"bg-gray-600 hover:bg-gray-700",children:y?n.jsx(Or,{className:"h-4 w-4 animate-spin"}):n.jsxs(n.Fragment,{children:[n.jsx(F0,{className:"h-4 w-4 mr-1"}),"Apply"]})})]}),F&&n.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 dark:text-red-400",children:[n.jsx(D0,{className:"h-4 w-4"}),F]})]}),(u==null?void 0:u.no_existing_subscription)&&!o&&n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"You can enter a promo code on the checkout page."}),n.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-3",children:o?n.jsxs("div",{className:"flex items-center justify-center py-4",children:[n.jsx(Or,{className:"h-6 w-6 animate-spin text-orange-500"}),n.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Calculating..."})]}):b?n.jsx("div",{className:"text-red-600 dark:text-red-400 text-center py-2",children:b}):u?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Charged today:"}),n.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:["$",u.proration_amount.toFixed(2)]})]}),n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:u.proration_details}),u.discount&&n.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400",children:[n.jsx("span",{children:"Discount applied:"}),n.jsx("span",{children:u.discount.description})]}),n.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-3",children:n.jsx("div",{className:"flex justify-between items-center text-sm",children:n.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Then $",u.new_price,"/",a==="yearly"?"year":"month"]})})})]}):null}),b&&!o&&n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-3 text-sm text-red-600 dark:text-red-400",children:b})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx(Be,{onClick:r,disabled:h,className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 dark:bg-gray-600 dark:hover:bg-gray-700 dark:text-gray-200",children:"Cancel"}),n.jsx(Be,{onClick:Q,disabled:o||h||!!b,className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white font-semibold",children:h?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"h-4 w-4 mr-2 animate-spin"}),u!=null&&u.no_existing_subscription?"Redirecting...":"Upgrading..."]}):u!=null&&u.no_existing_subscription?"Continue to checkout":"Confirm upgrade"})]})]})})},Km=({currentTier:t="free",onSubscriptionChange:r})=>{const[e,s]=U.useState(null),[i,a]=U.useState(null),[d,o]=U.useState(!1),[c,h]=U.useState({title:"",message:""}),[p,b]=U.useState(!1),[m,u]=U.useState("free"),[w,g]=U.useState(!1),[_,y]=U.useState(null),[A,L]=U.useState(()=>{const ce=sessionStorage.getItem("pricingTiersCollapsed");return ce?JSON.parse(ce):{free:!0,basic:!0,thegoods:!0,moregoods:!0,themost:!0,rollyourown:!0}}),E=ce=>{L(re=>{const se={...re,[ce]:!re[ce]};return sessionStorage.setItem("pricingTiersCollapsed",JSON.stringify(se)),se})};U.useEffect(()=>{(async()=>{try{const re=await fetch("/api/auth/status");if(re.ok){const se=await re.json();b(se.unplugged_mode||!1),u(se.actual_tier||"free")}}catch(re){console.error("Error fetching unplugged status:",re)}})()},[]);const F=[{id:"free",name:"Free",itemsLimit:15,routinesLimit:1,price:0,autocreate:!1,description:"Get started with basic features",byocNote:"BYOClaude (enter your own Anthropic API key) for autocreated chord charts"},{id:"basic",name:"Basic",itemsLimit:80,routinesLimit:5,price:3,autocreate:!1,description:"More items and routines",byocNote:"BYOClaude (enter your own Anthropic API key) for autocreated chord charts"},{id:"thegoods",name:"The Goods",itemsLimit:200,routinesLimit:10,price:6,autocreate:!0,description:"Includes Autocreate for chord charts"},{id:"moregoods",name:"More Goods",itemsLimit:600,routinesLimit:25,price:12,autocreate:!0,description:"Even more items and routines"},{id:"themost",name:"The Most",itemsLimit:1500,routinesLimit:50,price:20,autocreate:!0,description:"Goes to 11"}],Z=ce=>{const{old_tier:re,new_tier:se,tier_changed:le,proration_amount:Se,autocreate_enabled:ne}=ce,H={free:"Free",basic:"Basic",thegoods:"The Goods",moregoods:"More Goods",themost:"The Most"}[se]||se,K=["free","basic","thegoods","moregoods","themost"],X=K.indexOf(re),pe=K.indexOf(se);if(le&&pe<X)return{title:"Plan Changed",message:`You've downgraded to ${H}. Your new limits will take effect immediately. Thanks for sticking with us! ðŸŽ¸`};if(le&&pe>X){const ve=`Right on, you've upgraded to ${H}!`,ke=Se>0?` Your card was charged a prorated amount of $${Se.toFixed(2)} usd.`:"";return ne&&re==="basic"?{title:"ðŸŽ‰ Upgraded!",message:`${ve}${ke} You're ready to add more items, organize more routines, and have your chord charts autocreated! ðŸ¤˜Rock on!`}:{title:"ðŸŽ‰ Upgraded!",message:`${ve}${ke} You're ready to add more items and organize more routines! ðŸ¤˜Rock on!`}}return le?{title:"Plan Updated",message:`You've switched to ${H}. Rock on! ðŸ¤˜`}:{title:"Subscription Updated",message:"Your subscription has been updated successfully. ðŸŽ¸"}},Y=async ce=>{if(ce==="free")return;const re=m!=="free"&&!p,se=["free","basic","thegoods","moregoods","themost"],le=se.indexOf(m),ne=se.indexOf(ce)>le;if(re&&ne){const C=F.find(H=>H.id===ce);y({tierId:ce,tierName:(C==null?void 0:C.name)||ce}),g(!0);return}if(re&&!ne){s(ce),a(null);try{const C=await fetch("/api/billing/update-subscription",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({tier:ce,billing_period:"monthly"})}),H=await C.json();if(!C.ok){a(H.error||"Failed to update subscription"),s(null);return}if(H.details){const K=Z(H.details);h(K),o(!0)}s(null)}catch(C){h({title:"Error",message:`Error: ${C.message||"Error updating subscription"}`}),o(!0),s(null)}return}s(ce),a(null);try{const C=await fetch("/api/billing/create-checkout-session",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({tier:ce,billing_period:"monthly"})}),H=await C.json();if(!C.ok){if(H.use_update_endpoint){console.log("Backend redirecting to upgrade confirmation modal");const K=F.find(X=>X.id===ce);y({tierId:ce,tierName:(K==null?void 0:K.name)||ce}),g(!0),s(null);return}a(H.error||"Failed to process request"),s(null);return}H.url?window.location.href=H.url:(a("Unexpected response from server"),s(null))}catch(C){h({title:"Error",message:`Error: ${C.message||"Error connecting to payment system"}`}),o(!0),s(null)}},G=ce=>{if(g(!1),y(null),ce.details){const re=Z(ce.details);h(re),o(!0)}},O=()=>{g(!1),y(null)},Q=async()=>{o(!1),r&&await r();try{const ce=await fetch("/api/auth/status");if(ce.ok){const re=await ce.json();b(re.unplugged_mode||!1),u(re.actual_tier||"free")}}catch(ce){console.error("Error refreshing subscription status:",ce)}},I=async()=>{s("portal"),a(null);try{const ce=await fetch("/api/billing/create-portal-session",{method:"POST",headers:{"Content-Type":"application/json"}}),re=await ce.json();ce.ok&&re.url?window.location.href=re.url:(a(re.error||"Failed to open subscription portal"),s(null))}catch{a("Error connecting to subscription portal"),s(null)}},k=async()=>{s("unpause"),a(null);try{const ce=await fetch("/api/billing/unpause-subscription",{method:"POST",headers:{"Content-Type":"application/json"}}),re=await ce.json();ce.ok?(h({title:"âœ… Subscription Resumed",message:"Welcome back! Your subscription has been reactivated. You now have access to all your routines and features. ðŸŽ¸"}),o(!0)):(a(re.error||"Failed to unpause subscription"),s(null))}catch{a("Error unpausing subscription"),s(null)}},v=(ce=>F.findIndex(re=>re.id===ce))(t),te=ce=>ce===v?"Current Plan":ce<v?"Downgrade":"Upgrade";return n.jsxs("div",{className:"space-y-4",children:[p&&n.jsx(ln,{className:"bg-orange-900/20 border-orange-700",children:n.jsx(dn,{className:"pt-6",children:n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-orange-300 mb-1",children:"Your subscription is paused"}),n.jsx("p",{className:"text-sm text-gray-300",children:`You're currently in free mode with access to your last active routine. Click "Unpause" to restore full access to all your routines and features.`})]}),n.jsx(Be,{onClick:k,disabled:e==="unpause",className:"bg-green-600 hover:bg-green-700",children:e==="unpause"?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}),"Unpausing..."]}):"Unpause Subscription"})]})})}),i&&n.jsx("div",{className:"bg-red-900/30 border border-red-700 rounded-md p-3 text-sm text-red-300",children:i}),n.jsxs("div",{className:"space-y-4",children:[F.map((ce,re)=>{const se=ce.id===t,le=e===ce.id,Se=A[ce.id];return n.jsxs(ln,{className:`relative bg-gray-800 border-gray-700 ${se?"border-orange-600 border-2":""}`,children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>E(ce.id),"data-ph-capture-attribute-toggle":`pricing-tier-${ce.id}`,children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs(cn,{className:"text-gray-100 text-lg flex items-center gap-2",children:[ce.name,se&&n.jsx("span",{className:"text-xs font-normal text-orange-400 bg-orange-400/10 px-2 py-0.5 rounded",children:"Your current plan"}),Se&&ce.price>0&&n.jsxs("span",{className:"text-sm font-normal text-gray-400",children:["$",ce.price,"/mo"]}),Se&&ce.price===0&&n.jsx("span",{className:"text-sm font-normal text-gray-400",children:"Free"})]}),n.jsx(Fs,{className:"text-gray-400 text-xs",children:ce.description})]}),Se?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!Se&&n.jsxs(dn,{className:"space-y-3",children:[n.jsx("div",{className:"text-center py-2",children:ce.price===0?n.jsx("div",{className:"text-3xl font-bold text-gray-100",children:"Free"}):n.jsxs("div",{className:"text-3xl font-bold text-gray-100",children:["$",ce.price,n.jsx("span",{className:"text-sm text-gray-400 font-normal",children:"usd/mo"})]})}),n.jsxs("ul",{className:"space-y-2 text-sm text-gray-300",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx(Nn,{className:"w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"}),n.jsxs("span",{children:[ce.itemsLimit," items"]})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx(Nn,{className:"w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"}),n.jsxs("span",{children:[ce.routinesLimit," ",ce.routinesLimit===1?"routine":"routines"]})]}),ce.autocreate&&n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx(Nn,{className:"w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"}),n.jsx("span",{className:"font-medium text-orange-400",children:"Includes Autocreate for chord charts"})]})]}),ce.byocNote&&n.jsx("div",{className:"text-xs text-gray-300",children:ce.byocNote}),ce.id!=="free"&&!se&&n.jsx(Be,{onClick:()=>Y(ce.id),disabled:le,className:`w-full ${re>v?"bg-orange-600 hover:bg-orange-700":"bg-gray-700 hover:bg-gray-600 border border-gray-600"}`,"data-ph-capture-attribute-button":re>v?`upgrade-to-${ce.id}`:`downgrade-to-${ce.id}`,children:le?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading..."]}):te(re)})]})]},ce.id)}),n.jsxs(ln,{className:"relative bg-gray-800 border-gray-700",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>E("rollyourown"),"data-ph-capture-attribute-toggle":"pricing-tier-rollyourown",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(cn,{className:"text-gray-100 text-lg",children:"Roll your own"}),n.jsx(Fs,{className:"text-gray-400 text-xs",children:"Local-only, on your laptop or desktop"})]}),A.rollyourown?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!A.rollyourown&&n.jsxs(dn,{className:"space-y-3",children:[n.jsx("div",{className:"text-center py-2",children:n.jsx("div",{className:"text-2xl font-bold text-gray-100",children:"Time and effort"})}),n.jsx("div",{className:"text-xs font-semibold text-gray-400 mb-1",children:"Requirements:"}),n.jsxs("ul",{className:"space-y-2 text-sm text-gray-300",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-gray-500",children:"â€¢"}),n.jsx("span",{children:"Familiarity with Linux CLI"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-gray-500",children:"â€¢"}),n.jsx("span",{children:"Familiarity with GitHub"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-gray-500",children:"â€¢"}),n.jsx("span",{children:"Familiarity with using APIs"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-gray-500",children:"â€¢"}),n.jsx("span",{children:"Familiarity with being a nerd"})]})]}),n.jsx(Be,{onClick:()=>window.open("https://github.com/slshults/guitar-practice-routine-app_postgresql/blob/main/README.md","_blank"),className:"w-full bg-gray-700 hover:bg-gray-600 border border-gray-600","data-ph-capture-attribute-button":"github-roll-your-own",children:"Get it from GitHub"})]})]})]}),m!=="free"&&n.jsx(ln,{className:"bg-gray-800 border-gray-700 mt-6",children:n.jsx(dn,{className:"pt-6",children:n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-1",children:"Manage your subscription"}),n.jsx("p",{className:"text-sm text-gray-400",children:p?"Reactivate your subscription or view billing details":"Log in to your Stripe account to update your payment method, view invoices, view payment history, etc."})]}),n.jsx(Be,{onClick:I,disabled:e==="portal",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"stripe-billing-portal",children:e==="portal"?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin","aria-hidden":"true"}),"Loading..."]}):n.jsxs(n.Fragment,{children:[n.jsx(kh,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Stripe billing portal"]})})]})})}),n.jsx(Ym,{isOpen:d,onClose:Q,title:c.title,message:c.message}),n.jsx(Jm,{isOpen:w,onClose:O,onConfirm:G,targetTier:_==null?void 0:_.tierId,targetTierName:_==null?void 0:_.tierName,billingPeriod:"monthly",currentTier:t})]})},Zm=({userTier:t,unpluggedMode:r})=>{const[e,s]=U.useState("initial"),[i,a]=U.useState(!1),[d,o]=U.useState(null),[c,h]=U.useState(!1),[p,b]=U.useState(!1),[m,u]=U.useState(null),[w,g]=U.useState(""),[_,y]=U.useState(""),[A,L]=U.useState(""),[E,F]=U.useState(!1),[Z,Y]=U.useState(r||!1),G=t==="free";U.useEffect(()=>{G||Q(),O()},[G]),U.useEffect(()=>{Y(r||!1)},[r]);const O=async()=>{try{const se=await fetch("/api/auth/status");if(se.ok){const le=await se.json();F(!!le.deletion_scheduled_for)}}catch(se){console.error("Error checking deletion status:",se)}},Q=async()=>{try{const se=await fetch("/api/user/calculate-deletion-refund");if(se.ok){const le=await se.json();g(le.renewal_date)}}catch(se){console.error("Error fetching refund calculation:",se)}},I=async()=>{a(!0),o(null);try{const se=await fetch("/api/user/delete-account-scheduled",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmation_phrase:_,email:A})}),le=await se.json();se.ok?(o({type:"success",text:`Account deletion scheduled for ${le.deletion_date}. You can cancel this anytime before then.`}),s("initial"),y(""),L(""),F(!0)):o({type:"error",text:le.error||"Failed to schedule deletion"})}catch(se){console.error("Error scheduling deletion:",se),o({type:"error",text:"Error scheduling deletion"})}finally{a(!1)}},k=async()=>{a(!0),o(null);try{const le=await fetch(G?"/api/user/delete-account-free":"/api/user/delete-account-immediate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmation_phrase:_,email:A})}),Se=await le.json();le.ok?(u(Se.redirect_url||"/login"),h(!0),y(""),L("")):o({type:"error",text:Se.error||"Failed to delete account"})}catch(se){console.error("Error deleting account:",se),o({type:"error",text:"Error deleting account"})}finally{a(!1)}},D=()=>{window.location.href=m||"/login"},v=async()=>{try{const se=await fetch("/api/user/export/all");if(!se.ok)throw new Error("Failed to download data");const le=await se.blob(),Se=window.URL.createObjectURL(le),ne=document.createElement("a");ne.href=Se;const C=new Date().toISOString().split("T")[0];ne.download=`gpra-export-${C}.zip`,document.body.appendChild(ne),ne.click(),window.URL.revokeObjectURL(Se),document.body.removeChild(ne)}catch(se){console.error("Error downloading data:",se),o({type:"error",text:"Failed to download your data. Please try again."})}},te=async()=>{a(!0),o(null);try{const se=await fetch("/api/user/cancel-deletion",{method:"POST",headers:{"Content-Type":"application/json"}}),le=await se.json();se.ok?(o({type:"success",text:"Deletion canceled successfully!"}),F(!1)):o({type:"error",text:le.error||"Failed to cancel deletion"})}catch(se){console.error("Error canceling deletion:",se),o({type:"error",text:"Error canceling deletion"})}finally{a(!1)}},ce=async()=>{b(!1),a(!0),o(null);try{const le=await fetch(Z?"/api/billing/unpause-subscription":"/api/billing/set-unplugged",{method:"POST",headers:{"Content-Type":"application/json"}}),Se=await le.json();le.ok?(o({type:"success",text:Z?"Subscription resumed! You now have access to all routines.":"Subscription paused. You can now use your most recently active routine for free."}),Y(!Z),setTimeout(()=>window.location.reload(),1500)):o({type:"error",text:Se.error||`Failed to ${Z?"unpause":"pause"} subscription`})}catch(se){console.error(`Error ${Z?"unpausing":"pausing"} subscription:`,se),o({type:"error",text:`Error ${Z?"unpausing":"pausing"} subscription`})}finally{a(!1)}};let re;if(e==="initial")re=n.jsxs(ln,{className:"bg-red-900/10 border-red-700",children:[n.jsxs(_n,{children:[n.jsxs(cn,{className:"text-gray-100 flex items-center gap-2",children:[n.jsx(Rn,{className:"w-5 h-5 text-red-400"}),"Danger zone"]}),n.jsx(Fs,{className:"text-gray-400",children:"Permanently delete your account and all associated data"})]}),n.jsxs(dn,{className:"space-y-6",children:[n.jsxs(ps,{className:"bg-orange-900/30 border-orange-700",children:[n.jsx(Rn,{className:"h-4 w-4 text-orange-400"}),n.jsxs(ms,{className:"text-gray-300",children:[n.jsx("strong",{children:"Warning:"})," Deleting your account will permanently remove:",n.jsxs("ul",{className:"list-disc pl-5 mt-2 space-y-1",children:[n.jsx("li",{children:"All practice items and routines"}),n.jsx("li",{children:"All chord charts"}),n.jsx("li",{children:"Practice history (last 90 days)"}),n.jsx("li",{children:"Account settings and preferences"})]}),n.jsx("p",{className:"mt-2",children:n.jsx("strong",{children:"This action cannot be undone."})})]})]}),n.jsxs("div",{className:"flex items-center justify-between bg-blue-900/20 border border-blue-700 rounded-md p-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Download your data first"}),n.jsx("p",{className:"text-xs text-gray-400",children:"Your items, routines, chord charts, and practice history"})]}),n.jsxs(Be,{onClick:v,variant:"outline",size:"sm",className:"border-blue-600 text-blue-400 hover:bg-blue-900/40",children:[n.jsx(Js,{className:"w-4 h-4 mr-2"}),"Download all your data"]})]}),n.jsxs("div",{className:"space-y-3",children:[E&&n.jsx(Be,{onClick:te,disabled:i,className:"w-full bg-green-600 hover:bg-green-700",children:i?"Canceling...":"Keep my account"}),!E&&!G&&n.jsx(Be,{onClick:()=>b(!0),disabled:i,variant:"outline",className:`w-full h-auto py-5 px-4 flex flex-col items-center gap-2 ${Z?"border-green-600 text-green-400 hover:bg-green-900/40":"border-orange-600 text-orange-400 hover:bg-orange-900/40"}`,children:i?Z?"Unpausing...":"Pausing...":Z?n.jsx("span",{className:"font-semibold",children:"Unpause"}):n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"font-semibold",children:"Pause subscription when it expires"}),n.jsxs("span",{className:"text-xs font-normal leading-normal text-center whitespace-normal max-w-full",children:["Keep using your most recently active routine for free when your paid subscription ends. ",n.jsx("br",{})," We'll save your other routines for 90 days in case you renew."]})]})}),!G&&n.jsxs(Be,{onClick:()=>s("scheduled"),variant:"outline",className:"w-full border-orange-600 text-orange-400 hover:bg-orange-900/40",children:["Delete account after current paid subscription ends on ",w]}),n.jsxs(Be,{onClick:()=>s("immediate"),variant:"destructive",className:"w-full bg-red-900 hover:bg-red-800",children:["Delete my account now! ",!G&&"(No refund)"]})]}),d&&n.jsx(ps,{className:d.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:n.jsx(ms,{className:"text-gray-300",children:d.text})})]})]});else if(e==="scheduled"){const se="If I delete it I cannot get it back",le=_===se;re=n.jsxs(ln,{className:"bg-orange-900/10 border-orange-700",children:[n.jsxs(_n,{children:[n.jsx(cn,{className:"text-gray-100",children:"Schedule account deletion"}),n.jsx(Fs,{className:"text-gray-400",children:"Delete your account on your next renewal date"})]}),n.jsxs(dn,{className:"space-y-6",children:[n.jsx(ps,{className:"bg-blue-900/30 border-blue-700",children:n.jsxs(ms,{className:"text-gray-300",children:[n.jsx("p",{className:"font-semibold mb-2",children:"Here's what will happen:"}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[n.jsx("li",{children:"Your subscription will be canceled"}),n.jsxs("li",{children:["Your account will stay active until ",n.jsx("strong",{children:w})]}),n.jsxs("li",{children:["On ",w,", all your data will be permanently deleted"]}),n.jsxs("li",{children:["You can cancel this deletion anytime before ",w]})]}),n.jsxs("p",{className:"mt-2 text-sm font-semibold text-orange-300",children:["Note: You're paying to use the service until ",w,", so no refunds."]})]})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"confirm-scheduled",className:"text-gray-200",children:"Type the following phrase to confirm:"}),n.jsx("p",{className:"text-sm font-mono bg-gray-800 border border-gray-700 rounded p-2 text-gray-300",children:se}),n.jsx(Dr,{id:"confirm-scheduled",value:_,onChange:Se=>y(Se.target.value),placeholder:"Type the phrase exactly as shown",className:`bg-gray-900 border-gray-600 text-gray-100 ${_.length>0&&(le?"border-green-500":"border-red-500")}`,disabled:i}),_.length>=se.length&&!le&&n.jsx("p",{className:"text-xs text-red-400",children:"Phrase does not match (case-sensitive)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"email-scheduled",className:"text-gray-200",children:"Enter your email address to confirm:"}),n.jsx(Dr,{id:"email-scheduled",type:"email",value:A,onChange:Se=>L(Se.target.value),placeholder:"your-email@example.com",className:"bg-gray-900 border-gray-600 text-gray-100",disabled:i}),n.jsx("p",{className:"text-xs text-gray-500",children:"Must match your account email"})]}),d&&n.jsx(ps,{className:d.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:n.jsx(ms,{className:"text-gray-300",children:d.text})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(Be,{onClick:()=>{s("initial"),y(""),L(""),o(null)},className:"flex-1 bg-green-600 hover:bg-green-700",disabled:i,children:[n.jsx(Gr,{className:"w-4 h-4 mr-2"}),"Nevermind. I'll stay for now"]}),n.jsx(Be,{onClick:I,disabled:!le||!A||i,className:"flex-1 bg-orange-600 hover:bg-orange-700",children:i?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}),"Scheduling..."]}):"Confirm scheduled deletion"})]})]})]})}else if(e==="immediate"){const se="If I delete now I cannot get my data or money back",le=_===se;re=n.jsxs(ln,{className:"bg-red-900/10 border-red-700",children:[n.jsxs(_n,{children:[n.jsxs(cn,{className:"text-gray-100 flex items-center gap-2",children:[n.jsx(Rn,{className:"w-5 h-5 text-red-400"}),"Delete account immediately"]}),n.jsx(Fs,{className:"text-gray-400",children:"This action is immediate and permanent"})]}),n.jsxs(dn,{className:"space-y-6",children:[n.jsxs(ps,{className:"bg-red-900/40 border-red-700",children:[n.jsx(Rn,{className:"h-4 w-4 text-red-400"}),n.jsxs(ms,{className:"text-gray-300",children:[n.jsx("p",{className:"font-bold mb-2",children:"âš ï¸ FINAL WARNING âš ï¸"}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[n.jsxs("li",{children:[n.jsx("strong",{children:"NO REFUND"})," - You will not receive any money back"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"IMMEDIATE"})," - Your account will be deleted right now"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"PERMANENT"})," - All data will be permanently erased"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"NO RECOVERY"})," - You cannot undo this action"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"CANNOT ACCESS GPRA AGAIN"})," - You'll need to create a new account"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"YOU WILL BE FORGOTTEN"})," - We won't keep your email address or IP address, or anything. Most of it will be deleted immediately, but some anonymous logs which can't be connected to you (without a warrant) will age out of the logs within 90 days"]})]}),n.jsx("p",{className:"mt-2 text-sm font-semibold text-orange-300",children:"In addition to no refunds, the remainder of your prepaid period will not be prorated back to you."})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"confirm-immediate",className:"text-gray-200",children:"Type the following phrase to confirm:"}),n.jsx("p",{className:"text-sm font-mono bg-gray-800 border border-gray-700 rounded p-2 text-gray-300",children:se}),n.jsx(Dr,{id:"confirm-immediate",value:_,onChange:Se=>y(Se.target.value),onPaste:Se=>Se.preventDefault(),autoComplete:"off",placeholder:"Type the phrase exactly as shown (paste disabled)",className:`bg-gray-900 border-gray-600 text-gray-100 ${_.length>0&&(le?"border-green-500":"border-red-500")}`,disabled:i}),_.length>=se.length&&!le&&n.jsx("p",{className:"text-xs text-red-400",children:"Phrase does not match (case-sensitive)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"email-immediate",className:"text-gray-200",children:"Enter your email address to confirm:"}),n.jsx(Dr,{id:"email-immediate",type:"email",value:A,onChange:Se=>L(Se.target.value),placeholder:"your-email@example.com",className:"bg-gray-900 border-gray-600 text-gray-100",disabled:i}),n.jsx("p",{className:"text-xs text-gray-500",children:"Must match your account email. Will also be deleted when you click the red button."})]}),d&&n.jsx(ps,{className:d.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:n.jsx(ms,{className:"text-gray-300",children:d.text})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(Be,{onClick:()=>{s("initial"),y(""),L(""),o(null)},className:"flex-1 bg-green-600 hover:bg-green-700",disabled:i,children:[n.jsx(Gr,{className:"w-4 h-4 mr-2"}),"Nevermind, I'll stay for now."]}),n.jsx(Be,{onClick:k,disabled:!le||!A||i,variant:"destructive",className:"flex-1 bg-red-900 hover:bg-red-800",children:i?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete immediately - No refund"})]})]})]})}return n.jsxs(n.Fragment,{children:[re,n.jsx(Qn,{open:p,onOpenChange:b,children:n.jsxs(Hn,{className:"bg-gray-900 border-gray-700 text-gray-100",children:[n.jsxs(Gn,{children:[n.jsx(Vn,{className:"text-xl text-gray-100",children:Z?"Resume subscription?":"Pause subscription?"}),n.jsx(es,{className:"text-gray-300 space-y-3 pt-4",children:Z?n.jsx("p",{children:"Your subscription will resume and you'll be charged when your next billing period arrives. You'll regain access to all your routines."}):n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"When your paid period ends, you'll only have access to your most recently active routine."}),n.jsx("p",{children:"Your other routines will be saved for 90 days in case you decide to come back."})]})})]}),n.jsxs(wc,{className:"flex gap-3 sm:gap-3",children:[n.jsx(Be,{onClick:()=>b(!1),variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800",children:"Cancel"}),n.jsx(Be,{onClick:ce,className:`flex-1 ${Z?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"}`,children:Z?"Resume":"Pause"})]})]})}),n.jsx(Qn,{open:c,onOpenChange:h,children:n.jsxs(Hn,{className:"bg-gray-900 border-gray-700 text-gray-100",children:[n.jsxs(Gn,{children:[n.jsx(Vn,{className:"text-xl text-gray-100",children:"Account deleted"}),n.jsx(es,{className:"text-gray-300 space-y-3 pt-4",children:G?n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"Ok, done. We've deleted all your stuff."}),n.jsx("p",{children:"Your account has been deleted. Click Ok to return to login."})]}):n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"Ok, done. We've deleted all your stuff, and we've cancelled your subscription on Stripe so it won't charge your card again."}),n.jsx("p",{children:`When you click "Ok", we'll send you to your Stripe portal, which will show you any saved cards and your past invoices. (Sadly, it won't show you confirmation of the cancelled subscription, it will just show you the absence of any subscriptions. ðŸ¤· Please feel free to complain to Stripe about that. I have.)`})]})})]}),n.jsx(wc,{children:n.jsx(Be,{onClick:D,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Ok"})})]})})]})},Xm="modulepreload",Qm=function(t){return"/static/"+t},Yd={},Yl=function(r,e,s){let i=Promise.resolve();if(e&&e.length>0){let d=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=d(e.map(h=>{if(h=Qm(h),h in Yd)return;Yd[h]=!0;const p=h.endsWith(".css"),b=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${b}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":Xm,p||(m.as="script"),m.crossOrigin="",m.href=h,c&&m.setAttribute("nonce",c),document.head.appendChild(m),p)return new Promise((u,w)=>{m.addEventListener("load",u),m.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${h}`)))})}))}function a(d){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=d,window.dispatchEvent(o),!o.defaultPrevented)throw d}return i.then(d=>{for(const o of d||[])o.status==="rejected"&&a(o.reason);return r().catch(a)})};function kr(t){"@babel/helpers - typeof";return kr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},kr(t)}var Us=Uint8Array,xs=Uint16Array,Yc=Int32Array,Jc=new Us([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Kc=new Us([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Jd=new Us([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mf=function(t,r){for(var e=new xs(31),s=0;s<31;++s)e[s]=r+=1<<t[s-1];for(var i=new Yc(e[30]),s=1;s<30;++s)for(var a=e[s];a<e[s+1];++a)i[a]=a-e[s]<<5|s;return{b:e,r:i}},gf=mf(Jc,2),eg=gf.b,Nc=gf.r;eg[28]=258,Nc[258]=28;var tg=mf(Kc,0),Kd=tg.r,_c=new xs(32768);for(var Mr=0;Mr<32768;++Mr){var Ma=(Mr&43690)>>1|(Mr&21845)<<1;Ma=(Ma&52428)>>2|(Ma&13107)<<2,Ma=(Ma&61680)>>4|(Ma&3855)<<4,_c[Mr]=((Ma&65280)>>8|(Ma&255)<<8)>>1}var uo=(function(t,r,e){for(var s=t.length,i=0,a=new xs(r);i<s;++i)t[i]&&++a[t[i]-1];var d=new xs(r);for(i=1;i<r;++i)d[i]=d[i-1]+a[i-1]<<1;var o;if(e){o=new xs(1<<r);var c=15-r;for(i=0;i<s;++i)if(t[i])for(var h=i<<4|t[i],p=r-t[i],b=d[t[i]-1]++<<p,m=b|(1<<p)-1;b<=m;++b)o[_c[b]>>c]=h}else for(o=new xs(s),i=0;i<s;++i)t[i]&&(o[i]=_c[d[t[i]-1]++]>>15-t[i]);return o}),ii=new Us(288);for(var Mr=0;Mr<144;++Mr)ii[Mr]=8;for(var Mr=144;Mr<256;++Mr)ii[Mr]=9;for(var Mr=256;Mr<280;++Mr)ii[Mr]=7;for(var Mr=280;Mr<288;++Mr)ii[Mr]=8;var gl=new Us(32);for(var Mr=0;Mr<32;++Mr)gl[Mr]=5;var rg=uo(ii,9,0),ng=uo(gl,5,0),xf=function(t){return(t+7)/8|0},sg=function(t,r,e){return(e==null||e>t.length)&&(e=t.length),new Us(t.subarray(r,e))},fa=function(t,r,e){e<<=r&7;var s=r/8|0;t[s]|=e,t[s+1]|=e>>8},oo=function(t,r,e){e<<=r&7;var s=r/8|0;t[s]|=e,t[s+1]|=e>>8,t[s+2]|=e>>16},Jl=function(t,r){for(var e=[],s=0;s<t.length;++s)t[s]&&e.push({s,f:t[s]});var i=e.length,a=e.slice();if(!i)return{t:bf,l:0};if(i==1){var d=new Us(e[0].s+1);return d[e[0].s]=1,{t:d,l:1}}e.sort(function(F,Z){return F.f-Z.f}),e.push({s:-1,f:25001});var o=e[0],c=e[1],h=0,p=1,b=2;for(e[0]={s:-1,f:o.f+c.f,l:o,r:c};p!=i-1;)o=e[e[h].f<e[b].f?h++:b++],c=e[h!=p&&e[h].f<e[b].f?h++:b++],e[p++]={s:-1,f:o.f+c.f,l:o,r:c};for(var m=a[0].s,s=1;s<i;++s)a[s].s>m&&(m=a[s].s);var u=new xs(m+1),w=jc(e[p-1],u,0);if(w>r){var s=0,g=0,_=w-r,y=1<<_;for(a.sort(function(Z,Y){return u[Y.s]-u[Z.s]||Z.f-Y.f});s<i;++s){var A=a[s].s;if(u[A]>r)g+=y-(1<<w-u[A]),u[A]=r;else break}for(g>>=_;g>0;){var L=a[s].s;u[L]<r?g-=1<<r-u[L]++-1:++s}for(;s>=0&&g;--s){var E=a[s].s;u[E]==r&&(--u[E],++g)}w=r}return{t:new Us(u),l:w}},jc=function(t,r,e){return t.s==-1?Math.max(jc(t.l,r,e+1),jc(t.r,r,e+1)):r[t.s]=e},Zd=function(t){for(var r=t.length;r&&!t[--r];);for(var e=new xs(++r),s=0,i=t[0],a=1,d=function(c){e[s++]=c},o=1;o<=r;++o)if(t[o]==i&&o!=r)++a;else{if(!i&&a>2){for(;a>138;a-=138)d(32754);a>2&&(d(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(d(i),--a;a>6;a-=6)d(8304);a>2&&(d(a-3<<5|8208),a=0)}for(;a--;)d(i);a=1,i=t[o]}return{c:e.subarray(0,s),n:r}},lo=function(t,r){for(var e=0,s=0;s<r.length;++s)e+=t[s]*r[s];return e},yf=function(t,r,e){var s=e.length,i=xf(r+2);t[i]=s&255,t[i+1]=s>>8,t[i+2]=t[i]^255,t[i+3]=t[i+1]^255;for(var a=0;a<s;++a)t[i+a+4]=e[a];return(i+4+s)*8},Xd=function(t,r,e,s,i,a,d,o,c,h,p){fa(r,p++,e),++i[256];for(var b=Jl(i,15),m=b.t,u=b.l,w=Jl(a,15),g=w.t,_=w.l,y=Zd(m),A=y.c,L=y.n,E=Zd(g),F=E.c,Z=E.n,Y=new xs(19),G=0;G<A.length;++G)++Y[A[G]&31];for(var G=0;G<F.length;++G)++Y[F[G]&31];for(var O=Jl(Y,7),Q=O.t,I=O.l,k=19;k>4&&!Q[Jd[k-1]];--k);var D=h+5<<3,v=lo(i,ii)+lo(a,gl)+d,te=lo(i,m)+lo(a,g)+d+14+3*k+lo(Y,Q)+2*Y[16]+3*Y[17]+7*Y[18];if(c>=0&&D<=v&&D<=te)return yf(r,p,t.subarray(c,c+h));var ce,re,se,le;if(fa(r,p,1+(te<v)),p+=2,te<v){ce=uo(m,u,0),re=m,se=uo(g,_,0),le=g;var Se=uo(Q,I,0);fa(r,p,L-257),fa(r,p+5,Z-1),fa(r,p+10,k-4),p+=14;for(var G=0;G<k;++G)fa(r,p+3*G,Q[Jd[G]]);p+=3*k;for(var ne=[A,F],C=0;C<2;++C)for(var H=ne[C],G=0;G<H.length;++G){var K=H[G]&31;fa(r,p,Se[K]),p+=Q[K],K>15&&(fa(r,p,H[G]>>5&127),p+=H[G]>>12)}}else ce=rg,re=ii,se=ng,le=gl;for(var G=0;G<o;++G){var X=s[G];if(X>255){var K=X>>18&31;oo(r,p,ce[K+257]),p+=re[K+257],K>7&&(fa(r,p,X>>23&31),p+=Jc[K]);var pe=X&31;oo(r,p,se[pe]),p+=le[pe],pe>3&&(oo(r,p,X>>5&8191),p+=Kc[pe])}else oo(r,p,ce[X]),p+=re[X]}return oo(r,p,ce[256]),p+re[256]},ag=new Yc([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),bf=new Us(0),ig=function(t,r,e,s,i,a){var d=a.z||t.length,o=new Us(s+d+5*(1+Math.ceil(d/7e3))+i),c=o.subarray(s,o.length-i),h=a.l,p=(a.r||0)&7;if(r){p&&(c[0]=a.r>>3);for(var b=ag[r-1],m=b>>13,u=b&8191,w=(1<<e)-1,g=a.p||new xs(32768),_=a.h||new xs(w+1),y=Math.ceil(e/3),A=2*y,L=function(j){return(t[j]^t[j+1]<<y^t[j+2]<<A)&w},E=new Yc(25e3),F=new xs(288),Z=new xs(32),Y=0,G=0,O=a.i||0,Q=0,I=a.w||0,k=0;O+2<d;++O){var D=L(O),v=O&32767,te=_[D];if(g[v]=te,_[D]=v,I<=O){var ce=d-O;if((Y>7e3||Q>24576)&&(ce>423||!h)){p=Xd(t,c,0,E,F,Z,G,Q,k,O-k,p),Q=Y=G=0,k=O;for(var re=0;re<286;++re)F[re]=0;for(var re=0;re<30;++re)Z[re]=0}var se=2,le=0,Se=u,ne=v-te&32767;if(ce>2&&D==L(O-ne))for(var C=Math.min(m,ce)-1,H=Math.min(32767,O),K=Math.min(258,ce);ne<=H&&--Se&&v!=te;){if(t[O+se]==t[O+se-ne]){for(var X=0;X<K&&t[O+X]==t[O+X-ne];++X);if(X>se){if(se=X,le=ne,X>C)break;for(var pe=Math.min(ne,X-2),ve=0,re=0;re<pe;++re){var ke=O-ne+re&32767,Ae=g[ke],Re=ke-Ae&32767;Re>ve&&(ve=Re,te=ke)}}}v=te,te=g[v],ne+=v-te&32767}if(le){E[Q++]=268435456|Nc[se]<<18|Kd[le];var Me=Nc[se]&31,Ke=Kd[le]&31;G+=Jc[Me]+Kc[Ke],++F[257+Me],++Z[Ke],I=O+se,++Y}else E[Q++]=t[O],++F[t[O]]}}for(O=Math.max(O,I);O<d;++O)E[Q++]=t[O],++F[t[O]];p=Xd(t,c,h,E,F,Z,G,Q,k,O-k,p),h||(a.r=p&7|c[p/8|0]<<3,p-=7,a.h=_,a.p=g,a.i=O,a.w=I)}else{for(var O=a.w||0;O<d+h;O+=65535){var je=O+65535;je>=d&&(c[p/8|0]=h,je=d),p=yf(c,p+1,t.subarray(O,je))}a.i=d}return sg(o,0,s+xf(p)+i)},wf=function(){var t=1,r=0;return{p:function(e){for(var s=t,i=r,a=e.length|0,d=0;d!=a;){for(var o=Math.min(d+2655,a);d<o;++d)i+=s+=e[d];s=(s&65535)+15*(s>>16),i=(i&65535)+15*(i>>16)}t=s,r=i},d:function(){return t%=65521,r%=65521,(t&255)<<24|(t&65280)<<8|(r&255)<<8|r>>8}}},og=function(t,r,e,s,i){if(!i&&(i={l:1},r.dictionary)){var a=r.dictionary.subarray(-32768),d=new Us(a.length+t.length);d.set(a),d.set(t,a.length),t=d,i.w=a.length}return ig(t,r.level==null?6:r.level,r.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+r.mem,e,s,i)},vf=function(t,r,e){for(;e;++r)t[r]=e,e>>>=8},lg=function(t,r){var e=r.level,s=e==0?0:e<6?1:e==9?3:2;if(t[0]=120,t[1]=s<<6|(r.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,r.dictionary){var i=wf();i.p(r.dictionary),vf(t,2,i.d())}};function Sc(t,r){r||(r={});var e=wf();e.p(t);var s=og(t,r,r.dictionary?6:2,4);return lg(s,r),vf(s,s.length-4,e.d()),s}var cg=typeof TextDecoder<"u"&&new TextDecoder,dg=0;try{cg.decode(bf,{stream:!0}),dg=1}catch{}function ug(t){if(Array.isArray(t))return t}function hg(t,r){var e=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(e!=null){var s,i,a,d,o=[],c=!0,h=!1;try{if(a=(e=e.call(t)).next,r!==0)for(;!(c=(s=a.call(e)).done)&&(o.push(s.value),o.length!==r);c=!0);}catch(p){h=!0,i=p}finally{try{if(!c&&e.return!=null&&(d=e.return(),Object(d)!==d))return}finally{if(h)throw i}}return o}}function Qd(t,r){(r==null||r>t.length)&&(r=t.length);for(var e=0,s=Array(r);e<r;e++)s[e]=t[e];return s}function fg(t,r){if(t){if(typeof t=="string")return Qd(t,r);var e={}.toString.call(t).slice(8,-1);return e==="Object"&&t.constructor&&(e=t.constructor.name),e==="Map"||e==="Set"?Array.from(t):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Qd(t,r):void 0}}function pg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eu(t,r){return ug(t)||hg(t,r)||fg(t,r)||pg()}function tu(t,r="utf8"){return new TextDecoder(r).decode(t)}const mg=new TextEncoder;function gg(t){return mg.encode(t)}const xg=1024*8,yg=(()=>{const t=new Uint8Array(4),r=new Uint32Array(t.buffer);return!((r[0]=1)&t[0])})(),Kl={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Zc{constructor(r=xg,e={}){Sr(this,"buffer");Sr(this,"byteLength");Sr(this,"byteOffset");Sr(this,"length");Sr(this,"offset");Sr(this,"lastWrittenByte");Sr(this,"littleEndian");Sr(this,"_data");Sr(this,"_mark");Sr(this,"_marks");let s=!1;typeof r=="number"?r=new ArrayBuffer(r):(s=!0,this.lastWrittenByte=r.byteLength);const i=e.offset?e.offset>>>0:0,a=r.byteLength-i;let d=i;(ArrayBuffer.isView(r)||r instanceof Zc)&&(r.byteLength!==r.buffer.byteLength&&(d=r.byteOffset+i),r=r.buffer),s?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=r,this.length=a,this.byteLength=a,this.byteOffset=d,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,d,a),this._mark=0,this._marks=[]}available(r=1){return this.offset+r<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(r=1){return this.offset+=r,this}back(r=1){return this.offset-=r,this}seek(r){return this.offset=r,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const r=this._marks.pop();if(r===void 0)throw new Error("Mark stack empty");return this.seek(r),this}rewind(){return this.offset=0,this}ensureAvailable(r=1){if(!this.available(r)){const s=(this.offset+r)*2,i=new Uint8Array(s);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=s,this.byteLength=s,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(r=1){return this.readArray(r,"uint8")}readArray(r,e){const s=Kl[e].BYTES_PER_ELEMENT*r,i=this.byteOffset+this.offset,a=this.buffer.slice(i,i+s);if(this.littleEndian===yg&&e!=="uint8"&&e!=="int8"){const o=new Uint8Array(this.buffer.slice(i,i+s));o.reverse();const c=new Kl[e](o.buffer);return this.offset+=s,c.reverse(),c}const d=new Kl[e](a);return this.offset+=s,d}readInt16(){const r=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,r}readUint16(){const r=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,r}readInt32(){const r=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,r}readUint32(){const r=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat32(){const r=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,r}readFloat64(){const r=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,r}readBigInt64(){const r=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,r}readBigUint64(){const r=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,r}readChar(){return String.fromCharCode(this.readInt8())}readChars(r=1){let e="";for(let s=0;s<r;s++)e+=this.readChar();return e}readUtf8(r=1){return tu(this.readBytes(r))}decodeText(r=1,e="utf8"){return tu(this.readBytes(r),e)}writeBoolean(r){return this.writeUint8(r?255:0),this}writeInt8(r){return this.ensureAvailable(1),this._data.setInt8(this.offset++,r),this._updateLastWrittenByte(),this}writeUint8(r){return this.ensureAvailable(1),this._data.setUint8(this.offset++,r),this._updateLastWrittenByte(),this}writeByte(r){return this.writeUint8(r)}writeBytes(r){this.ensureAvailable(r.length);for(let e=0;e<r.length;e++)this._data.setUint8(this.offset++,r[e]);return this._updateLastWrittenByte(),this}writeInt16(r){return this.ensureAvailable(2),this._data.setInt16(this.offset,r,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(r){return this.ensureAvailable(2),this._data.setUint16(this.offset,r,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(r){return this.ensureAvailable(4),this._data.setInt32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(r){return this.ensureAvailable(4),this._data.setUint32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(r){return this.ensureAvailable(4),this._data.setFloat32(this.offset,r,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(r){return this.ensureAvailable(8),this._data.setFloat64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(r){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(r){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,r,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(r){return this.writeUint8(r.charCodeAt(0))}writeChars(r){for(let e=0;e<r.length;e++)this.writeUint8(r.charCodeAt(e));return this}writeUtf8(r){return this.writeBytes(gg(r))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function qi(t){let r=t.length;for(;--r>=0;)t[r]=0}const bg=3,wg=258,Nf=29,vg=256,Ng=vg+1+Nf,_f=30,_g=512,jg=new Array((Ng+2)*2);qi(jg);const Sg=new Array(_f*2);qi(Sg);const kg=new Array(_g);qi(kg);const Cg=new Array(wg-bg+1);qi(Cg);const Ag=new Array(Nf);qi(Ag);const Lg=new Array(_f);qi(Lg);const Eg=(t,r,e,s)=>{let i=t&65535|0,a=t>>>16&65535|0,d=0;for(;e!==0;){d=e>2e3?2e3:e,e-=d;do i=i+r[s++]|0,a=a+i|0;while(--d);i%=65521,a%=65521}return i|a<<16|0};var kc=Eg;const Pg=()=>{let t,r=[];for(var e=0;e<256;e++){t=e;for(var s=0;s<8;s++)t=t&1?3988292384^t>>>1:t>>>1;r[e]=t}return r},Tg=new Uint32Array(Pg()),Ig=(t,r,e,s)=>{const i=Tg,a=s+e;t^=-1;for(let d=s;d<a;d++)t=t>>>8^i[(t^r[d])&255];return t^-1};var Ys=Ig,Cc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},jf={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const Fg=(t,r)=>Object.prototype.hasOwnProperty.call(t,r);var Og=function(t){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const e=r.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const s in e)Fg(e,s)&&(t[s]=e[s])}}return t},Dg=t=>{let r=0;for(let s=0,i=t.length;s<i;s++)r+=t[s].length;const e=new Uint8Array(r);for(let s=0,i=0,a=t.length;s<a;s++){let d=t[s];e.set(d,i),i+=d.length}return e},Sf={assign:Og,flattenChunks:Dg};let kf=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{kf=!1}const mo=new Uint8Array(256);for(let t=0;t<256;t++)mo[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;mo[254]=mo[254]=1;var Rg=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let r,e,s,i,a,d=t.length,o=0;for(i=0;i<d;i++)e=t.charCodeAt(i),(e&64512)===55296&&i+1<d&&(s=t.charCodeAt(i+1),(s&64512)===56320&&(e=65536+(e-55296<<10)+(s-56320),i++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(r=new Uint8Array(o),a=0,i=0;a<o;i++)e=t.charCodeAt(i),(e&64512)===55296&&i+1<d&&(s=t.charCodeAt(i+1),(s&64512)===56320&&(e=65536+(e-55296<<10)+(s-56320),i++)),e<128?r[a++]=e:e<2048?(r[a++]=192|e>>>6,r[a++]=128|e&63):e<65536?(r[a++]=224|e>>>12,r[a++]=128|e>>>6&63,r[a++]=128|e&63):(r[a++]=240|e>>>18,r[a++]=128|e>>>12&63,r[a++]=128|e>>>6&63,r[a++]=128|e&63);return r};const Bg=(t,r)=>{if(r<65534&&t.subarray&&kf)return String.fromCharCode.apply(null,t.length===r?t:t.subarray(0,r));let e="";for(let s=0;s<r;s++)e+=String.fromCharCode(t[s]);return e};var Mg=(t,r)=>{const e=r||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,r));let s,i;const a=new Array(e*2);for(i=0,s=0;s<e;){let d=t[s++];if(d<128){a[i++]=d;continue}let o=mo[d];if(o>4){a[i++]=65533,s+=o-1;continue}for(d&=o===2?31:o===3?15:7;o>1&&s<e;)d=d<<6|t[s++]&63,o--;if(o>1){a[i++]=65533;continue}d<65536?a[i++]=d:(d-=65536,a[i++]=55296|d>>10&1023,a[i++]=56320|d&1023)}return Bg(a,i)},Ug=(t,r)=>{r=r||t.length,r>t.length&&(r=t.length);let e=r-1;for(;e>=0&&(t[e]&192)===128;)e--;return e<0||e===0?r:e+mo[t[e]]>r?e:r},Ac={string2buf:Rg,buf2string:Mg,utf8border:Ug};function zg(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var qg=zg;const Ho=16209,$g=16191;var Wg=function(r,e){let s,i,a,d,o,c,h,p,b,m,u,w,g,_,y,A,L,E,F,Z,Y,G,O,Q;const I=r.state;s=r.next_in,O=r.input,i=s+(r.avail_in-5),a=r.next_out,Q=r.output,d=a-(e-r.avail_out),o=a+(r.avail_out-257),c=I.dmax,h=I.wsize,p=I.whave,b=I.wnext,m=I.window,u=I.hold,w=I.bits,g=I.lencode,_=I.distcode,y=(1<<I.lenbits)-1,A=(1<<I.distbits)-1;e:do{w<15&&(u+=O[s++]<<w,w+=8,u+=O[s++]<<w,w+=8),L=g[u&y];t:for(;;){if(E=L>>>24,u>>>=E,w-=E,E=L>>>16&255,E===0)Q[a++]=L&65535;else if(E&16){F=L&65535,E&=15,E&&(w<E&&(u+=O[s++]<<w,w+=8),F+=u&(1<<E)-1,u>>>=E,w-=E),w<15&&(u+=O[s++]<<w,w+=8,u+=O[s++]<<w,w+=8),L=_[u&A];r:for(;;){if(E=L>>>24,u>>>=E,w-=E,E=L>>>16&255,E&16){if(Z=L&65535,E&=15,w<E&&(u+=O[s++]<<w,w+=8,w<E&&(u+=O[s++]<<w,w+=8)),Z+=u&(1<<E)-1,Z>c){r.msg="invalid distance too far back",I.mode=Ho;break e}if(u>>>=E,w-=E,E=a-d,Z>E){if(E=Z-E,E>p&&I.sane){r.msg="invalid distance too far back",I.mode=Ho;break e}if(Y=0,G=m,b===0){if(Y+=h-E,E<F){F-=E;do Q[a++]=m[Y++];while(--E);Y=a-Z,G=Q}}else if(b<E){if(Y+=h+b-E,E-=b,E<F){F-=E;do Q[a++]=m[Y++];while(--E);if(Y=0,b<F){E=b,F-=E;do Q[a++]=m[Y++];while(--E);Y=a-Z,G=Q}}}else if(Y+=b-E,E<F){F-=E;do Q[a++]=m[Y++];while(--E);Y=a-Z,G=Q}for(;F>2;)Q[a++]=G[Y++],Q[a++]=G[Y++],Q[a++]=G[Y++],F-=3;F&&(Q[a++]=G[Y++],F>1&&(Q[a++]=G[Y++]))}else{Y=a-Z;do Q[a++]=Q[Y++],Q[a++]=Q[Y++],Q[a++]=Q[Y++],F-=3;while(F>2);F&&(Q[a++]=Q[Y++],F>1&&(Q[a++]=Q[Y++]))}}else if((E&64)===0){L=_[(L&65535)+(u&(1<<E)-1)];continue r}else{r.msg="invalid distance code",I.mode=Ho;break e}break}}else if((E&64)===0){L=g[(L&65535)+(u&(1<<E)-1)];continue t}else if(E&32){I.mode=$g;break e}else{r.msg="invalid literal/length code",I.mode=Ho;break e}break}}while(s<i&&a<o);F=w>>3,s-=F,w-=F<<3,u&=(1<<w)-1,r.next_in=s,r.next_out=a,r.avail_in=s<i?5+(i-s):5-(s-i),r.avail_out=a<o?257+(o-a):257-(a-o),I.hold=u,I.bits=w};const ji=15,ru=852,nu=592,su=0,Zl=1,au=2,Hg=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Gg=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Vg=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Yg=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Jg=(t,r,e,s,i,a,d,o)=>{const c=o.bits;let h=0,p=0,b=0,m=0,u=0,w=0,g=0,_=0,y=0,A=0,L,E,F,Z,Y,G=null,O;const Q=new Uint16Array(ji+1),I=new Uint16Array(ji+1);let k=null,D,v,te;for(h=0;h<=ji;h++)Q[h]=0;for(p=0;p<s;p++)Q[r[e+p]]++;for(u=c,m=ji;m>=1&&Q[m]===0;m--);if(u>m&&(u=m),m===0)return i[a++]=1<<24|64<<16|0,i[a++]=1<<24|64<<16|0,o.bits=1,0;for(b=1;b<m&&Q[b]===0;b++);for(u<b&&(u=b),_=1,h=1;h<=ji;h++)if(_<<=1,_-=Q[h],_<0)return-1;if(_>0&&(t===su||m!==1))return-1;for(I[1]=0,h=1;h<ji;h++)I[h+1]=I[h]+Q[h];for(p=0;p<s;p++)r[e+p]!==0&&(d[I[r[e+p]]++]=p);if(t===su?(G=k=d,O=20):t===Zl?(G=Hg,k=Gg,O=257):(G=Vg,k=Yg,O=0),A=0,p=0,h=b,Y=a,w=u,g=0,F=-1,y=1<<u,Z=y-1,t===Zl&&y>ru||t===au&&y>nu)return 1;for(;;){D=h-g,d[p]+1<O?(v=0,te=d[p]):d[p]>=O?(v=k[d[p]-O],te=G[d[p]-O]):(v=96,te=0),L=1<<h-g,E=1<<w,b=E;do E-=L,i[Y+(A>>g)+E]=D<<24|v<<16|te|0;while(E!==0);for(L=1<<h-1;A&L;)L>>=1;if(L!==0?(A&=L-1,A+=L):A=0,p++,--Q[h]===0){if(h===m)break;h=r[e+d[p]]}if(h>u&&(A&Z)!==F){for(g===0&&(g=u),Y+=b,w=h-g,_=1<<w;w+g<m&&(_-=Q[w+g],!(_<=0));)w++,_<<=1;if(y+=1<<w,t===Zl&&y>ru||t===au&&y>nu)return 1;F=A&Z,i[F]=u<<24|w<<16|Y-a|0}}return A!==0&&(i[Y+A]=h-g<<24|64<<16|0),o.bits=u,0};var ho=Jg;const Kg=0,Cf=1,Af=2,{Z_FINISH:iu,Z_BLOCK:Zg,Z_TREES:Go,Z_OK:oi,Z_STREAM_END:Xg,Z_NEED_DICT:Qg,Z_STREAM_ERROR:Ss,Z_DATA_ERROR:Lf,Z_MEM_ERROR:Ef,Z_BUF_ERROR:e1,Z_DEFLATED:ou}=jf,Sl=16180,lu=16181,cu=16182,du=16183,uu=16184,hu=16185,fu=16186,pu=16187,mu=16188,gu=16189,xl=16190,pa=16191,Xl=16192,xu=16193,Ql=16194,yu=16195,bu=16196,wu=16197,vu=16198,Vo=16199,Yo=16200,Nu=16201,_u=16202,ju=16203,Su=16204,ku=16205,ec=16206,Cu=16207,Au=16208,zr=16209,Pf=16210,Tf=16211,t1=852,r1=592,n1=15,s1=n1,Lu=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function a1(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const li=t=>{if(!t)return 1;const r=t.state;return!r||r.strm!==t||r.mode<Sl||r.mode>Tf?1:0},If=t=>{if(li(t))return Ss;const r=t.state;return t.total_in=t.total_out=r.total=0,t.msg="",r.wrap&&(t.adler=r.wrap&1),r.mode=Sl,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(t1),r.distcode=r.distdyn=new Int32Array(r1),r.sane=1,r.back=-1,oi},Ff=t=>{if(li(t))return Ss;const r=t.state;return r.wsize=0,r.whave=0,r.wnext=0,If(t)},Of=(t,r)=>{let e;if(li(t))return Ss;const s=t.state;return r<0?(e=0,r=-r):(e=(r>>4)+5,r<48&&(r&=15)),r&&(r<8||r>15)?Ss:(s.window!==null&&s.wbits!==r&&(s.window=null),s.wrap=e,s.wbits=r,Ff(t))},Df=(t,r)=>{if(!t)return Ss;const e=new a1;t.state=e,e.strm=t,e.window=null,e.mode=Sl;const s=Of(t,r);return s!==oi&&(t.state=null),s},i1=t=>Df(t,s1);let Eu=!0,tc,rc;const o1=t=>{if(Eu){tc=new Int32Array(512),rc=new Int32Array(32);let r=0;for(;r<144;)t.lens[r++]=8;for(;r<256;)t.lens[r++]=9;for(;r<280;)t.lens[r++]=7;for(;r<288;)t.lens[r++]=8;for(ho(Cf,t.lens,0,288,tc,0,t.work,{bits:9}),r=0;r<32;)t.lens[r++]=5;ho(Af,t.lens,0,32,rc,0,t.work,{bits:5}),Eu=!1}t.lencode=tc,t.lenbits=9,t.distcode=rc,t.distbits=5},Rf=(t,r,e,s)=>{let i;const a=t.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),s>=a.wsize?(a.window.set(r.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>s&&(i=s),a.window.set(r.subarray(e-s,e-s+i),a.wnext),s-=i,s?(a.window.set(r.subarray(e-s,e),0),a.wnext=s,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},l1=(t,r)=>{let e,s,i,a,d,o,c,h,p,b,m,u,w,g,_=0,y,A,L,E,F,Z,Y,G;const O=new Uint8Array(4);let Q,I;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(li(t)||!t.output||!t.input&&t.avail_in!==0)return Ss;e=t.state,e.mode===pa&&(e.mode=Xl),d=t.next_out,i=t.output,c=t.avail_out,a=t.next_in,s=t.input,o=t.avail_in,h=e.hold,p=e.bits,b=o,m=c,G=oi;e:for(;;)switch(e.mode){case Sl:if(e.wrap===0){e.mode=Xl;break}for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.wrap&2&&h===35615){e.wbits===0&&(e.wbits=15),e.check=0,O[0]=h&255,O[1]=h>>>8&255,e.check=Ys(e.check,O,2,0),h=0,p=0,e.mode=lu;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((h&255)<<8)+(h>>8))%31){t.msg="incorrect header check",e.mode=zr;break}if((h&15)!==ou){t.msg="unknown compression method",e.mode=zr;break}if(h>>>=4,p-=4,Y=(h&15)+8,e.wbits===0&&(e.wbits=Y),Y>15||Y>e.wbits){t.msg="invalid window size",e.mode=zr;break}e.dmax=1<<e.wbits,e.flags=0,t.adler=e.check=1,e.mode=h&512?gu:pa,h=0,p=0;break;case lu:for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.flags=h,(e.flags&255)!==ou){t.msg="unknown compression method",e.mode=zr;break}if(e.flags&57344){t.msg="unknown header flags set",e.mode=zr;break}e.head&&(e.head.text=h>>8&1),e.flags&512&&e.wrap&4&&(O[0]=h&255,O[1]=h>>>8&255,e.check=Ys(e.check,O,2,0)),h=0,p=0,e.mode=cu;case cu:for(;p<32;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.head&&(e.head.time=h),e.flags&512&&e.wrap&4&&(O[0]=h&255,O[1]=h>>>8&255,O[2]=h>>>16&255,O[3]=h>>>24&255,e.check=Ys(e.check,O,4,0)),h=0,p=0,e.mode=du;case du:for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.head&&(e.head.xflags=h&255,e.head.os=h>>8),e.flags&512&&e.wrap&4&&(O[0]=h&255,O[1]=h>>>8&255,e.check=Ys(e.check,O,2,0)),h=0,p=0,e.mode=uu;case uu:if(e.flags&1024){for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.length=h,e.head&&(e.head.extra_len=h),e.flags&512&&e.wrap&4&&(O[0]=h&255,O[1]=h>>>8&255,e.check=Ys(e.check,O,2,0)),h=0,p=0}else e.head&&(e.head.extra=null);e.mode=hu;case hu:if(e.flags&1024&&(u=e.length,u>o&&(u=o),u&&(e.head&&(Y=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(s.subarray(a,a+u),Y)),e.flags&512&&e.wrap&4&&(e.check=Ys(e.check,s,u,a)),o-=u,a+=u,e.length-=u),e.length))break e;e.length=0,e.mode=fu;case fu:if(e.flags&2048){if(o===0)break e;u=0;do Y=s[a+u++],e.head&&Y&&e.length<65536&&(e.head.name+=String.fromCharCode(Y));while(Y&&u<o);if(e.flags&512&&e.wrap&4&&(e.check=Ys(e.check,s,u,a)),o-=u,a+=u,Y)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=pu;case pu:if(e.flags&4096){if(o===0)break e;u=0;do Y=s[a+u++],e.head&&Y&&e.length<65536&&(e.head.comment+=String.fromCharCode(Y));while(Y&&u<o);if(e.flags&512&&e.wrap&4&&(e.check=Ys(e.check,s,u,a)),o-=u,a+=u,Y)break e}else e.head&&(e.head.comment=null);e.mode=mu;case mu:if(e.flags&512){for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.wrap&4&&h!==(e.check&65535)){t.msg="header crc mismatch",e.mode=zr;break}h=0,p=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),t.adler=e.check=0,e.mode=pa;break;case gu:for(;p<32;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}t.adler=e.check=Lu(h),h=0,p=0,e.mode=xl;case xl:if(e.havedict===0)return t.next_out=d,t.avail_out=c,t.next_in=a,t.avail_in=o,e.hold=h,e.bits=p,Qg;t.adler=e.check=1,e.mode=pa;case pa:if(r===Zg||r===Go)break e;case Xl:if(e.last){h>>>=p&7,p-=p&7,e.mode=ec;break}for(;p<3;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}switch(e.last=h&1,h>>>=1,p-=1,h&3){case 0:e.mode=xu;break;case 1:if(o1(e),e.mode=Vo,r===Go){h>>>=2,p-=2;break e}break;case 2:e.mode=bu;break;case 3:t.msg="invalid block type",e.mode=zr}h>>>=2,p-=2;break;case xu:for(h>>>=p&7,p-=p&7;p<32;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if((h&65535)!==(h>>>16^65535)){t.msg="invalid stored block lengths",e.mode=zr;break}if(e.length=h&65535,h=0,p=0,e.mode=Ql,r===Go)break e;case Ql:e.mode=yu;case yu:if(u=e.length,u){if(u>o&&(u=o),u>c&&(u=c),u===0)break e;i.set(s.subarray(a,a+u),d),o-=u,a+=u,c-=u,d+=u,e.length-=u;break}e.mode=pa;break;case bu:for(;p<14;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.nlen=(h&31)+257,h>>>=5,p-=5,e.ndist=(h&31)+1,h>>>=5,p-=5,e.ncode=(h&15)+4,h>>>=4,p-=4,e.nlen>286||e.ndist>30){t.msg="too many length or distance symbols",e.mode=zr;break}e.have=0,e.mode=wu;case wu:for(;e.have<e.ncode;){for(;p<3;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.lens[k[e.have++]]=h&7,h>>>=3,p-=3}for(;e.have<19;)e.lens[k[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,Q={bits:e.lenbits},G=ho(Kg,e.lens,0,19,e.lencode,0,e.work,Q),e.lenbits=Q.bits,G){t.msg="invalid code lengths set",e.mode=zr;break}e.have=0,e.mode=vu;case vu:for(;e.have<e.nlen+e.ndist;){for(;_=e.lencode[h&(1<<e.lenbits)-1],y=_>>>24,A=_>>>16&255,L=_&65535,!(y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(L<16)h>>>=y,p-=y,e.lens[e.have++]=L;else{if(L===16){for(I=y+2;p<I;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(h>>>=y,p-=y,e.have===0){t.msg="invalid bit length repeat",e.mode=zr;break}Y=e.lens[e.have-1],u=3+(h&3),h>>>=2,p-=2}else if(L===17){for(I=y+3;p<I;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}h>>>=y,p-=y,Y=0,u=3+(h&7),h>>>=3,p-=3}else{for(I=y+7;p<I;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}h>>>=y,p-=y,Y=0,u=11+(h&127),h>>>=7,p-=7}if(e.have+u>e.nlen+e.ndist){t.msg="invalid bit length repeat",e.mode=zr;break}for(;u--;)e.lens[e.have++]=Y}}if(e.mode===zr)break;if(e.lens[256]===0){t.msg="invalid code -- missing end-of-block",e.mode=zr;break}if(e.lenbits=9,Q={bits:e.lenbits},G=ho(Cf,e.lens,0,e.nlen,e.lencode,0,e.work,Q),e.lenbits=Q.bits,G){t.msg="invalid literal/lengths set",e.mode=zr;break}if(e.distbits=6,e.distcode=e.distdyn,Q={bits:e.distbits},G=ho(Af,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,Q),e.distbits=Q.bits,G){t.msg="invalid distances set",e.mode=zr;break}if(e.mode=Vo,r===Go)break e;case Vo:e.mode=Yo;case Yo:if(o>=6&&c>=258){t.next_out=d,t.avail_out=c,t.next_in=a,t.avail_in=o,e.hold=h,e.bits=p,Wg(t,m),d=t.next_out,i=t.output,c=t.avail_out,a=t.next_in,s=t.input,o=t.avail_in,h=e.hold,p=e.bits,e.mode===pa&&(e.back=-1);break}for(e.back=0;_=e.lencode[h&(1<<e.lenbits)-1],y=_>>>24,A=_>>>16&255,L=_&65535,!(y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(A&&(A&240)===0){for(E=y,F=A,Z=L;_=e.lencode[Z+((h&(1<<E+F)-1)>>E)],y=_>>>24,A=_>>>16&255,L=_&65535,!(E+y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}h>>>=E,p-=E,e.back+=E}if(h>>>=y,p-=y,e.back+=y,e.length=L,A===0){e.mode=ku;break}if(A&32){e.back=-1,e.mode=pa;break}if(A&64){t.msg="invalid literal/length code",e.mode=zr;break}e.extra=A&15,e.mode=Nu;case Nu:if(e.extra){for(I=e.extra;p<I;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.length+=h&(1<<e.extra)-1,h>>>=e.extra,p-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=_u;case _u:for(;_=e.distcode[h&(1<<e.distbits)-1],y=_>>>24,A=_>>>16&255,L=_&65535,!(y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if((A&240)===0){for(E=y,F=A,Z=L;_=e.distcode[Z+((h&(1<<E+F)-1)>>E)],y=_>>>24,A=_>>>16&255,L=_&65535,!(E+y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}h>>>=E,p-=E,e.back+=E}if(h>>>=y,p-=y,e.back+=y,A&64){t.msg="invalid distance code",e.mode=zr;break}e.offset=L,e.extra=A&15,e.mode=ju;case ju:if(e.extra){for(I=e.extra;p<I;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.offset+=h&(1<<e.extra)-1,h>>>=e.extra,p-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){t.msg="invalid distance too far back",e.mode=zr;break}e.mode=Su;case Su:if(c===0)break e;if(u=m-c,e.offset>u){if(u=e.offset-u,u>e.whave&&e.sane){t.msg="invalid distance too far back",e.mode=zr;break}u>e.wnext?(u-=e.wnext,w=e.wsize-u):w=e.wnext-u,u>e.length&&(u=e.length),g=e.window}else g=i,w=d-e.offset,u=e.length;u>c&&(u=c),c-=u,e.length-=u;do i[d++]=g[w++];while(--u);e.length===0&&(e.mode=Yo);break;case ku:if(c===0)break e;i[d++]=e.length,c--,e.mode=Yo;break;case ec:if(e.wrap){for(;p<32;){if(o===0)break e;o--,h|=s[a++]<<p,p+=8}if(m-=c,t.total_out+=m,e.total+=m,e.wrap&4&&m&&(t.adler=e.check=e.flags?Ys(e.check,i,m,d-m):kc(e.check,i,m,d-m)),m=c,e.wrap&4&&(e.flags?h:Lu(h))!==e.check){t.msg="incorrect data check",e.mode=zr;break}h=0,p=0}e.mode=Cu;case Cu:if(e.wrap&&e.flags){for(;p<32;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.wrap&4&&h!==(e.total&4294967295)){t.msg="incorrect length check",e.mode=zr;break}h=0,p=0}e.mode=Au;case Au:G=Xg;break e;case zr:G=Lf;break e;case Pf:return Ef;case Tf:default:return Ss}return t.next_out=d,t.avail_out=c,t.next_in=a,t.avail_in=o,e.hold=h,e.bits=p,(e.wsize||m!==t.avail_out&&e.mode<zr&&(e.mode<ec||r!==iu))&&Rf(t,t.output,t.next_out,m-t.avail_out),b-=t.avail_in,m-=t.avail_out,t.total_in+=b,t.total_out+=m,e.total+=m,e.wrap&4&&m&&(t.adler=e.check=e.flags?Ys(e.check,i,m,t.next_out-m):kc(e.check,i,m,t.next_out-m)),t.data_type=e.bits+(e.last?64:0)+(e.mode===pa?128:0)+(e.mode===Vo||e.mode===Ql?256:0),(b===0&&m===0||r===iu)&&G===oi&&(G=e1),G},c1=t=>{if(li(t))return Ss;let r=t.state;return r.window&&(r.window=null),t.state=null,oi},d1=(t,r)=>{if(li(t))return Ss;const e=t.state;return(e.wrap&2)===0?Ss:(e.head=r,r.done=!1,oi)},u1=(t,r)=>{const e=r.length;let s,i,a;return li(t)||(s=t.state,s.wrap!==0&&s.mode!==xl)?Ss:s.mode===xl&&(i=1,i=kc(i,r,e,0),i!==s.check)?Lf:(a=Rf(t,r,e,e),a?(s.mode=Pf,Ef):(s.havedict=1,oi))};var h1=Ff,f1=Of,p1=If,m1=i1,g1=Df,x1=l1,y1=c1,b1=d1,w1=u1,v1="pako inflate (from Nodeca project)",ga={inflateReset:h1,inflateReset2:f1,inflateResetKeep:p1,inflateInit:m1,inflateInit2:g1,inflate:x1,inflateEnd:y1,inflateGetHeader:b1,inflateSetDictionary:w1,inflateInfo:v1};function N1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var _1=N1;const Bf=Object.prototype.toString,{Z_NO_FLUSH:j1,Z_FINISH:S1,Z_OK:go,Z_STREAM_END:nc,Z_NEED_DICT:sc,Z_STREAM_ERROR:k1,Z_DATA_ERROR:Pu,Z_MEM_ERROR:C1}=jf;function wo(t){this.options=Sf.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),r.windowBits>=0&&r.windowBits<16&&!(t&&t.windowBits)&&(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&(r.windowBits&15)===0&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qg,this.strm.avail_out=0;let e=ga.inflateInit2(this.strm,r.windowBits);if(e!==go)throw new Error(Cc[e]);if(this.header=new _1,ga.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=Ac.string2buf(r.dictionary):Bf.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(e=ga.inflateSetDictionary(this.strm,r.dictionary),e!==go)))throw new Error(Cc[e])}wo.prototype.push=function(t,r){const e=this.strm,s=this.options.chunkSize,i=this.options.dictionary;let a,d,o;if(this.ended)return!1;for(r===~~r?d=r:d=r===!0?S1:j1,Bf.call(t)==="[object ArrayBuffer]"?e.input=new Uint8Array(t):e.input=t,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(s),e.next_out=0,e.avail_out=s),a=ga.inflate(e,d),a===sc&&i&&(a=ga.inflateSetDictionary(e,i),a===go?a=ga.inflate(e,d):a===Pu&&(a=sc));e.avail_in>0&&a===nc&&e.state.wrap>0&&t[e.next_in]!==0;)ga.inflateReset(e),a=ga.inflate(e,d);switch(a){case k1:case Pu:case sc:case C1:return this.onEnd(a),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||a===nc))if(this.options.to==="string"){let c=Ac.utf8border(e.output,e.next_out),h=e.next_out-c,p=Ac.buf2string(e.output,c);e.next_out=h,e.avail_out=s-h,h&&e.output.set(e.output.subarray(c,c+h),0),this.onData(p)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===go&&o===0)){if(a===nc)return a=ga.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};wo.prototype.onData=function(t){this.chunks.push(t)};wo.prototype.onEnd=function(t){t===go&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=Sf.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function A1(t,r){const e=new wo(r);if(e.push(t),e.err)throw e.msg||Cc[e.err];return e.result}var L1=wo,E1=A1,P1={Inflate:L1,inflate:E1};const{Inflate:T1,inflate:I1}=P1;var Tu=T1,F1=I1;const Mf=[];for(let t=0;t<256;t++){let r=t;for(let e=0;e<8;e++)r&1?r=3988292384^r>>>1:r=r>>>1;Mf[t]=r}const Iu=4294967295;function O1(t,r,e){let s=t;for(let i=0;i<e;i++)s=Mf[(s^r[i])&255]^s>>>8;return s}function D1(t,r){return(O1(Iu,t,r)^Iu)>>>0}function Fu(t,r,e){const s=t.readUint32(),i=D1(new Uint8Array(t.buffer,t.byteOffset+t.offset-r-4,r),r);if(i!==s)throw new Error(`CRC mismatch for chunk ${e}. Expected ${s}, found ${i}`)}function Uf(t,r,e){for(let s=0;s<e;s++)r[s]=t[s]}function zf(t,r,e,s){let i=0;for(;i<s;i++)r[i]=t[i];for(;i<e;i++)r[i]=t[i]+r[i-s]&255}function qf(t,r,e,s){let i=0;if(e.length===0)for(;i<s;i++)r[i]=t[i];else for(;i<s;i++)r[i]=t[i]+e[i]&255}function $f(t,r,e,s,i){let a=0;if(e.length===0){for(;a<i;a++)r[a]=t[a];for(;a<s;a++)r[a]=t[a]+(r[a-i]>>1)&255}else{for(;a<i;a++)r[a]=t[a]+(e[a]>>1)&255;for(;a<s;a++)r[a]=t[a]+(r[a-i]+e[a]>>1)&255}}function Wf(t,r,e,s,i){let a=0;if(e.length===0){for(;a<i;a++)r[a]=t[a];for(;a<s;a++)r[a]=t[a]+r[a-i]&255}else{for(;a<i;a++)r[a]=t[a]+e[a]&255;for(;a<s;a++)r[a]=t[a]+R1(r[a-i],e[a],e[a-i])&255}}function R1(t,r,e){const s=t+r-e,i=Math.abs(s-t),a=Math.abs(s-r),d=Math.abs(s-e);return i<=a&&i<=d?t:a<=d?r:e}function B1(t,r,e,s,i,a){switch(t){case 0:Uf(r,e,i);break;case 1:zf(r,e,i,a);break;case 2:qf(r,e,s,i);break;case 3:$f(r,e,s,i,a);break;case 4:Wf(r,e,s,i,a);break;default:throw new Error(`Unsupported filter: ${t}`)}}const M1=new Uint16Array([255]),U1=new Uint8Array(M1.buffer),z1=U1[0]===255;function q1(t){const{data:r,width:e,height:s,channels:i,depth:a}=t,d=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(a/8)*i,c=new Uint8Array(s*e*o);let h=0;for(let p=0;p<7;p++){const b=d[p],m=Math.ceil((e-b.x)/b.xStep),u=Math.ceil((s-b.y)/b.yStep);if(m<=0||u<=0)continue;const w=m*o,g=new Uint8Array(w);for(let _=0;_<u;_++){const y=r[h++],A=r.subarray(h,h+w);h+=w;const L=new Uint8Array(w);B1(y,A,L,g,w,o),g.set(L);for(let E=0;E<m;E++){const F=b.x+E*b.xStep,Z=b.y+_*b.yStep;if(!(F>=e||Z>=s))for(let Y=0;Y<o;Y++)c[(Z*e+F)*o+Y]=L[E*o+Y]}}}if(a===16){const p=new Uint16Array(c.buffer);if(z1)for(let b=0;b<p.length;b++)p[b]=$1(p[b]);return p}else return c}function $1(t){return(t&255)<<8|t>>8&255}const W1=new Uint16Array([255]),H1=new Uint8Array(W1.buffer),G1=H1[0]===255,V1=new Uint8Array(0);function Ou(t){const{data:r,width:e,height:s,channels:i,depth:a}=t,d=Math.ceil(a/8)*i,o=Math.ceil(a/8*i*e),c=new Uint8Array(s*o);let h=V1,p=0,b,m;for(let u=0;u<s;u++){switch(b=r.subarray(p+1,p+1+o),m=c.subarray(u*o,(u+1)*o),r[p]){case 0:Uf(b,m,o);break;case 1:zf(b,m,o,d);break;case 2:qf(b,m,h,o);break;case 3:$f(b,m,h,o,d);break;case 4:Wf(b,m,h,o,d);break;default:throw new Error(`Unsupported filter: ${r[p]}`)}h=m,p+=o+1}if(a===16){const u=new Uint16Array(c.buffer);if(G1)for(let w=0;w<u.length;w++)u[w]=Y1(u[w]);return u}else return c}function Y1(t){return(t&255)<<8|t>>8&255}const nl=Uint8Array.of(137,80,78,71,13,10,26,10);function Du(t){if(!J1(t.readBytes(nl.length)))throw new Error("wrong PNG signature")}function J1(t){if(t.length<nl.length)return!1;for(let r=0;r<nl.length;r++)if(t[r]!==nl[r])return!1;return!0}const K1="tEXt",Z1=0,Hf=new TextDecoder("latin1");function X1(t){if(e2(t),t.length===0||t.length>79)throw new Error("keyword length must be between 1 and 79")}const Q1=/^[\u0000-\u00FF]*$/;function e2(t){if(!Q1.test(t))throw new Error("invalid latin1 text")}function t2(t,r,e){const s=Gf(r);t[s]=r2(r,e-s.length-1)}function Gf(t){for(t.mark();t.readByte()!==Z1;);const r=t.offset;t.reset();const e=Hf.decode(t.readBytes(r-t.offset-1));return t.skip(1),X1(e),e}function r2(t,r){return Hf.decode(t.readBytes(r))}const hs={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},ac={UNKNOWN:-1,DEFLATE:0},Ru={UNKNOWN:-1,ADAPTIVE:0},ic={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Jo={NONE:0,BACKGROUND:1,PREVIOUS:2},oc={SOURCE:0,OVER:1};class n2 extends Zc{constructor(e,s={}){super(e);Sr(this,"_checkCrc");Sr(this,"_inflator");Sr(this,"_png");Sr(this,"_apng");Sr(this,"_end");Sr(this,"_hasPalette");Sr(this,"_palette");Sr(this,"_hasTransparency");Sr(this,"_transparency");Sr(this,"_compressionMethod");Sr(this,"_filterMethod");Sr(this,"_interlaceMethod");Sr(this,"_colorType");Sr(this,"_isAnimated");Sr(this,"_numberOfFrames");Sr(this,"_numberOfPlays");Sr(this,"_frames");Sr(this,"_writingDataChunks");const{checkCrc:i=!1}=s;this._checkCrc=i,this._inflator=new Tu,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=ac.UNKNOWN,this._filterMethod=Ru.UNKNOWN,this._interlaceMethod=ic.UNKNOWN,this._colorType=hs.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(Du(this);!this._end;){const e=this.readUint32(),s=this.readChars(4);this.decodeChunk(e,s)}return this.decodeImage(),this._png}decodeApng(){for(Du(this);!this._end;){const e=this.readUint32(),s=this.readChars(4);this.decodeApngChunk(e,s)}return this.decodeApngImage(),this._apng}decodeChunk(e,s){const i=this.offset;switch(s){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case K1:t2(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${s}`);this._checkCrc?Fu(this,e+4,s):this.skip(4)}decodeApngChunk(e,s){const i=this.offset;switch(s!=="fdAT"&&s!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),s){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,s),this.offset=i+e;break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${s}`);this._checkCrc?Fu(this,e+4,s):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=s2(this.readUint8());const s=this.readUint8();this._colorType=s;let i;switch(s){case hs.GREYSCALE:i=1;break;case hs.TRUECOLOUR:i=3;break;case hs.INDEXED_COLOUR:i=1;break;case hs.GREYSCALE_ALPHA:i=2;break;case hs.TRUECOLOUR_ALPHA:i=4;break;case hs.UNKNOWN:default:throw new Error(`Unknown color type: ${s}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==ac.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const s=e/3;this._hasPalette=!0;const i=[];this._palette=i;for(let a=0;a<s;a++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const s=e,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,s)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let s=e,i=this.offset+this.byteOffset;if(i+=4,s-=4,this._inflator.push(new Uint8Array(this.buffer,i,s)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case hs.GREYSCALE:case hs.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let s=0;s<e/2;s++)this._transparency[s]=this.readUint16();break}case hs.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let s=0;for(;s<e;s++){const i=this.readByte();this._palette[s].push(i)}for(;s<this._palette.length;s++)this._palette[s].push(255);break}case hs.UNKNOWN:case hs.GREYSCALE_ALPHA:case hs.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const s=Gf(this),i=this.readUint8();if(i!==ac.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const a=this.readBytes(e-s.length-2);this._png.iccEmbeddedProfile={name:s,profile:F1(a)}}decodepHYs(){const e=this.readUint32(),s=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:s,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const s={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(e);if(i){if(i.data=Ou({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)s.data=i.data;else{const a=this._apng.frames.at(e-1);this.disposeFrame(i,a,s),this.addFrameDataToCanvas(s,i)}this._apng.frames.push(s)}}return this._apng}disposeFrame(e,s,i){switch(e.disposeOp){case Jo.NONE:break;case Jo.BACKGROUND:for(let a=0;a<this._png.height;a++)for(let d=0;d<this._png.width;d++){const o=(a*e.width+d)*this._png.channels;for(let c=0;c<this._png.channels;c++)i.data[o+c]=0}break;case Jo.PREVIOUS:i.data.set(s.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,s){const i=1<<this._png.depth,a=(d,o)=>{const c=((d+s.yOffset)*this._png.width+s.xOffset+o)*this._png.channels,h=(d*s.width+o)*this._png.channels;return{index:c,frameIndex:h}};switch(s.blendOp){case oc.SOURCE:for(let d=0;d<s.height;d++)for(let o=0;o<s.width;o++){const{index:c,frameIndex:h}=a(d,o);for(let p=0;p<this._png.channels;p++)e.data[c+p]=s.data[h+p]}break;case oc.OVER:for(let d=0;d<s.height;d++)for(let o=0;o<s.width;o++){const{index:c,frameIndex:h}=a(d,o);for(let p=0;p<this._png.channels;p++){const b=s.data[h+this._png.channels-1]/i,m=p%(this._png.channels-1)===0?1:s.data[h+p],u=Math.floor(b*m+(1-b)*e.data[c+p]);e.data[c+p]+=u}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var s;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?((s=this._frames)==null?void 0:s.at(0)).data:this._inflator.result;if(this._filterMethod!==Ru.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===ic.NO_INTERLACE)this._png.data=Ou({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===ic.ADAM7)this._png.data=q1({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,s=this._frames.at(-1);s?s.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Jo.NONE,blendOp:oc.SOURCE,data:e}),this._inflator=new Tu,this._writingDataChunks=!1}}function s2(t){if(t!==1&&t!==2&&t!==4&&t!==8&&t!==16)throw new Error(`invalid bit depth: ${t}`);return t}var Bu;(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.METRE=1]="METRE"})(Bu||(Bu={}));function a2(t,r){return new n2(t,r).decode()}var Gt=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function lc(){Gt.console&&typeof Gt.console.log=="function"&&Gt.console.log.apply(Gt.console,arguments)}var Tr={log:lc,warn:function(t){Gt.console&&(typeof Gt.console.warn=="function"?Gt.console.warn.apply(Gt.console,arguments):lc.call(null,arguments))},error:function(t){Gt.console&&(typeof Gt.console.error=="function"?Gt.console.error.apply(Gt.console,arguments):lc(t))}};function cc(t,r,e){var s=new XMLHttpRequest;s.open("GET",t),s.responseType="blob",s.onload=function(){ei(s.response,r,e)},s.onerror=function(){Tr.error("could not download file")},s.send()}function Mu(t){var r=new XMLHttpRequest;r.open("HEAD",t,!1);try{r.send()}catch{}return r.status>=200&&r.status<=299}function Ko(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}var ei=Gt.saveAs||((typeof window>"u"?"undefined":kr(window))!=="object"||window!==Gt?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(t,r,e){var s=Gt.URL||Gt.webkitURL,i=document.createElement("a");r=r||t.name||"download",i.download=r,i.rel="noopener",typeof t=="string"?(i.href=t,i.origin!==location.origin?Mu(i.href)?cc(t,r,e):Ko(i,i.target="_blank"):Ko(i)):(i.href=s.createObjectURL(t),setTimeout(function(){s.revokeObjectURL(i.href)},4e4),setTimeout(function(){Ko(i)},0))}:"msSaveOrOpenBlob"in navigator?function(t,r,e){if(r=r||t.name||"download",typeof t=="string")if(Mu(t))cc(t,r,e);else{var s=document.createElement("a");s.href=t,s.target="_blank",setTimeout(function(){Ko(s)})}else navigator.msSaveOrOpenBlob((function(i,a){return a===void 0?a={autoBom:!1}:kr(a)!=="object"&&(Tr.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i})(t,e),r)}:function(t,r,e,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),typeof t=="string")return cc(t,r,e);var i=t.type==="application/octet-stream",a=/constructor/i.test(Gt.HTMLElement)||Gt.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||i&&a)&&(typeof FileReader>"u"?"undefined":kr(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var p=o.result;p=d?p:p.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=p:location=p,s=null},o.readAsDataURL(t)}else{var c=Gt.URL||Gt.webkitURL,h=c.createObjectURL(t);s?s.location=h:location.href=h,s=null,setTimeout(function(){c.revokeObjectURL(h)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function Vf(t){var r;t=t||"",this.ok=!1,t.charAt(0)=="#"&&(t=t.substr(1,6)),t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[t=(t=t.replace(/ /g,"")).toLowerCase()]||t;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],s=0;s<e.length;s++){var i=e[s].re,a=e[s].process,d=i.exec(t);d&&(r=a(d),this.r=r[0],this.g=r[1],this.b=r[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),c=this.g.toString(16),h=this.b.toString(16);return o.length==1&&(o="0"+o),c.length==1&&(c="0"+c),h.length==1&&(h="0"+h),"#"+o+c+h}}var sl=Gt.atob.bind(Gt),Uu=Gt.btoa.bind(Gt);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function dc(t,r){var e=t[0],s=t[1],i=t[2],a=t[3];e=In(e,s,i,a,r[0],7,-680876936),a=In(a,e,s,i,r[1],12,-389564586),i=In(i,a,e,s,r[2],17,606105819),s=In(s,i,a,e,r[3],22,-1044525330),e=In(e,s,i,a,r[4],7,-176418897),a=In(a,e,s,i,r[5],12,1200080426),i=In(i,a,e,s,r[6],17,-1473231341),s=In(s,i,a,e,r[7],22,-45705983),e=In(e,s,i,a,r[8],7,1770035416),a=In(a,e,s,i,r[9],12,-1958414417),i=In(i,a,e,s,r[10],17,-42063),s=In(s,i,a,e,r[11],22,-1990404162),e=In(e,s,i,a,r[12],7,1804603682),a=In(a,e,s,i,r[13],12,-40341101),i=In(i,a,e,s,r[14],17,-1502002290),e=Fn(e,s=In(s,i,a,e,r[15],22,1236535329),i,a,r[1],5,-165796510),a=Fn(a,e,s,i,r[6],9,-1069501632),i=Fn(i,a,e,s,r[11],14,643717713),s=Fn(s,i,a,e,r[0],20,-373897302),e=Fn(e,s,i,a,r[5],5,-701558691),a=Fn(a,e,s,i,r[10],9,38016083),i=Fn(i,a,e,s,r[15],14,-660478335),s=Fn(s,i,a,e,r[4],20,-405537848),e=Fn(e,s,i,a,r[9],5,568446438),a=Fn(a,e,s,i,r[14],9,-1019803690),i=Fn(i,a,e,s,r[3],14,-187363961),s=Fn(s,i,a,e,r[8],20,1163531501),e=Fn(e,s,i,a,r[13],5,-1444681467),a=Fn(a,e,s,i,r[2],9,-51403784),i=Fn(i,a,e,s,r[7],14,1735328473),e=On(e,s=Fn(s,i,a,e,r[12],20,-1926607734),i,a,r[5],4,-378558),a=On(a,e,s,i,r[8],11,-2022574463),i=On(i,a,e,s,r[11],16,1839030562),s=On(s,i,a,e,r[14],23,-35309556),e=On(e,s,i,a,r[1],4,-1530992060),a=On(a,e,s,i,r[4],11,1272893353),i=On(i,a,e,s,r[7],16,-155497632),s=On(s,i,a,e,r[10],23,-1094730640),e=On(e,s,i,a,r[13],4,681279174),a=On(a,e,s,i,r[0],11,-358537222),i=On(i,a,e,s,r[3],16,-722521979),s=On(s,i,a,e,r[6],23,76029189),e=On(e,s,i,a,r[9],4,-640364487),a=On(a,e,s,i,r[12],11,-421815835),i=On(i,a,e,s,r[15],16,530742520),e=Dn(e,s=On(s,i,a,e,r[2],23,-995338651),i,a,r[0],6,-198630844),a=Dn(a,e,s,i,r[7],10,1126891415),i=Dn(i,a,e,s,r[14],15,-1416354905),s=Dn(s,i,a,e,r[5],21,-57434055),e=Dn(e,s,i,a,r[12],6,1700485571),a=Dn(a,e,s,i,r[3],10,-1894986606),i=Dn(i,a,e,s,r[10],15,-1051523),s=Dn(s,i,a,e,r[1],21,-2054922799),e=Dn(e,s,i,a,r[8],6,1873313359),a=Dn(a,e,s,i,r[15],10,-30611744),i=Dn(i,a,e,s,r[6],15,-1560198380),s=Dn(s,i,a,e,r[13],21,1309151649),e=Dn(e,s,i,a,r[4],6,-145523070),a=Dn(a,e,s,i,r[11],10,-1120210379),i=Dn(i,a,e,s,r[2],15,718787259),s=Dn(s,i,a,e,r[9],21,-343485551),t[0]=za(e,t[0]),t[1]=za(s,t[1]),t[2]=za(i,t[2]),t[3]=za(a,t[3])}function kl(t,r,e,s,i,a){return r=za(za(r,t),za(s,a)),za(r<<i|r>>>32-i,e)}function In(t,r,e,s,i,a,d){return kl(r&e|~r&s,t,r,i,a,d)}function Fn(t,r,e,s,i,a,d){return kl(r&s|e&~s,t,r,i,a,d)}function On(t,r,e,s,i,a,d){return kl(r^e^s,t,r,i,a,d)}function Dn(t,r,e,s,i,a,d){return kl(e^(r|~s),t,r,i,a,d)}function Yf(t){var r,e=t.length,s=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=t.length;r+=64)dc(s,i2(t.substring(r-64,r)));t=t.substring(r-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(r=0;r<t.length;r++)i[r>>2]|=t.charCodeAt(r)<<(r%4<<3);if(i[r>>2]|=128<<(r%4<<3),r>55)for(dc(s,i),r=0;r<16;r++)i[r]=0;return i[14]=8*e,dc(s,i),s}function i2(t){var r,e=[];for(r=0;r<64;r+=4)e[r>>2]=t.charCodeAt(r)+(t.charCodeAt(r+1)<<8)+(t.charCodeAt(r+2)<<16)+(t.charCodeAt(r+3)<<24);return e}var zu="0123456789abcdef".split("");function o2(t){for(var r="",e=0;e<4;e++)r+=zu[t>>8*e+4&15]+zu[t>>8*e&15];return r}function l2(t){return String.fromCharCode(255&t,(65280&t)>>8,(16711680&t)>>16,(4278190080&t)>>24)}function Lc(t){return Yf(t).map(l2).join("")}var c2=(function(t){for(var r=0;r<t.length;r++)t[r]=o2(t[r]);return t.join("")})(Yf("hello"))!="5d41402abc4b2a76b9719d911017c592";function za(t,r){if(c2){var e=(65535&t)+(65535&r);return(t>>16)+(r>>16)+(e>>16)<<16|65535&e}return t+r&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function Ec(t,r){var e,s,i,a;if(t!==e){for(var d=(i=t,a=1+(256/t.length|0),new Array(a+1).join(i)),o=[],c=0;c<256;c++)o[c]=c;var h=0;for(c=0;c<256;c++){var p=o[c];h=(h+p+d.charCodeAt(c))%256,o[c]=o[h],o[h]=p}e=t,s=o}else o=s;var b=r.length,m=0,u=0,w="";for(c=0;c<b;c++)u=(u+(p=o[m=(m+1)%256]))%256,o[m]=o[u],o[u]=p,d=o[(o[m]+o[u])%256],w+=String.fromCharCode(r.charCodeAt(c)^d);return w}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var qu={print:4,modify:8,copy:16,"annot-forms":32};function Ai(t,r,e,s){this.v=1,this.r=2;var i=192;t.forEach(function(o){if(qu.perm!==void 0)throw new Error("Invalid permission: "+o);i+=qu[o]}),this.padding="(Â¿N^NuÂŠAd\0NVÃ¿Ãº\b..\0Â¶Ãh>Â€/\fÂ©Ã¾dSiz";var a=(r+this.padding).substr(0,32),d=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,d),this.P=-(1+(255^i)),this.encryptionKey=Lc(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(s)).substr(0,5),this.U=Ec(this.encryptionKey,this.padding)}function Li(t){if(/[^\u0000-\u00ff]/.test(t))throw new Error("Invalid PDF Name Object: "+t+", Only accept ASCII characters.");for(var r="",e=t.length,s=0;s<e;s++){var i=t.charCodeAt(s);r+=i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?"#"+("0"+i.toString(16)).slice(-2):t[s]}return r}function $u(t){if(kr(t)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var r={};this.subscribe=function(e,s,i){if(i=i||!1,typeof e!="string"||typeof s!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");r.hasOwnProperty(e)||(r[e]={});var a=Math.random().toString(35);return r[e][a]=[s,!!i],a},this.unsubscribe=function(e){for(var s in r)if(r[s][e])return delete r[s][e],Object.keys(r[s]).length===0&&delete r[s],!0;return!1},this.publish=function(e){if(r.hasOwnProperty(e)){var s=Array.prototype.slice.call(arguments,1),i=[];for(var a in r[e]){var d=r[e][a];try{d[0].apply(t,s)}catch(o){Gt.console&&Tr.error("jsPDF PubSub Error",o.message,o)}d[1]&&i.push(a)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return r}}function yl(t){if(!(this instanceof yl))return new yl(t);var r="opacity,stroke-opacity".split(",");for(var e in t)t.hasOwnProperty(e)&&r.indexOf(e)>=0&&(this[e]=t[e]);this.id="",this.objectNumber=-1}function Jf(t,r){this.gState=t,this.matrix=r,this.id="",this.objectNumber=-1}function ti(t,r,e,s,i){if(!(this instanceof ti))return new ti(t,r,e,s,i);this.type=t==="axial"?2:3,this.coords=r,this.colors=e,Jf.call(this,s,i)}function Pi(t,r,e,s,i){if(!(this instanceof Pi))return new Pi(t,r,e,s,i);this.boundingBox=t,this.xStep=r,this.yStep=e,this.stream="",this.cloneIndex=0,Jf.call(this,s,i)}function Mt(t){var r,e=typeof arguments[0]=="string"?arguments[0]:"p",s=arguments[1],i=arguments[2],a=arguments[3],d=[],o=1,c=16,h="S",p=null;kr(t=t||{})==="object"&&(e=t.orientation,s=t.unit||s,i=t.format||i,a=t.compress||t.compressPdf||a,(p=t.encryption||null)!==null&&(p.userPassword=p.userPassword||"",p.ownerPassword=p.ownerPassword||"",p.userPermissions=p.userPermissions||[]),o=typeof t.userUnit=="number"?Math.abs(t.userUnit):1,t.precision!==void 0&&(r=t.precision),t.floatPrecision!==void 0&&(c=t.floatPrecision),h=t.defaultPathOperation||"S"),d=t.filters||(a===!0?["FlateEncode"]:d),s=s||"mm",e=(""+(e||"P")).toLowerCase();var b=t.putOnlyUsedFonts||!1,m={},u={internal:{},__private__:{}};u.__private__.PubSub=$u;var w="1.3",g=u.__private__.getPdfVersion=function(){return w};u.__private__.setPdfVersion=function(x){w=x};var _={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};u.__private__.getPageFormats=function(){return _};var y=u.__private__.getPageFormat=function(x){return _[x]};i=i||"a4";var A="compat",L="advanced",E=A;function F(){this.saveGraphicsState(),P(new Ut(yt,0,0,-yt,0,ns()*yt).toString()+" cm"),this.setFontSize(this.getFontSize()/yt),h="n",E=L}function Z(){this.restoreGraphicsState(),h="S",E=A}var Y=u.__private__.combineFontStyleAndFontWeight=function(x,R){if(x=="bold"&&R=="normal"||x=="bold"&&R==400||x=="normal"&&R=="italic"||x=="bold"&&R=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return R&&(x=R==400||R==="normal"?x==="italic"?"italic":"normal":R!=700&&R!=="bold"||x!=="normal"?(R==700?"bold":R)+""+x:"bold"),x};u.advancedAPI=function(x){var R=E===A;return R&&F.call(this),typeof x!="function"||(x(this),R&&Z.call(this)),this},u.compatAPI=function(x){var R=E===L;return R&&Z.call(this),typeof x!="function"||(x(this),R&&F.call(this)),this},u.isAdvancedAPI=function(){return E===L};var G,O=function(x){if(E!==L)throw new Error(x+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Q=u.roundToPrecision=u.__private__.roundToPrecision=function(x,R){var ae=r||R;if(isNaN(x)||isNaN(ae))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return x.toFixed(ae).replace(/0+$/,"")};G=u.hpf=u.__private__.hpf=typeof c=="number"?function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.hpf");return Q(x,c)}:c==="smart"?function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.hpf");return Q(x,x>-1&&x<1?16:5)}:function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.hpf");return Q(x,16)};var I=u.f2=u.__private__.f2=function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.f2");return Q(x,2)},k=u.__private__.f3=function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.f3");return Q(x,3)},D=u.scale=u.__private__.scale=function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.scale");return E===A?x*yt:E===L?x:void 0},v=function(x){return D((function(R){return E===A?ns()-R:E===L?R:void 0})(x))};u.__private__.setPrecision=u.setPrecision=function(x){typeof parseInt(x,10)=="number"&&(r=parseInt(x,10))};var te,ce="00000000000000000000000000000000",re=u.__private__.getFileId=function(){return ce},se=u.__private__.setFileId=function(x){return ce=x!==void 0&&/^[a-fA-F0-9]{32}$/.test(x)?x.toUpperCase():ce.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),p!==null&&(Lr=new Ai(p.userPermissions,p.userPassword,p.ownerPassword,ce)),ce};u.setFileId=function(x){return se(x),this},u.getFileId=function(){return re()};var le=u.__private__.convertDateToPDFDate=function(x){var R=x.getTimezoneOffset(),ae=R<0?"+":"-",be=Math.floor(Math.abs(R/60)),Ee=Math.abs(R%60),Ge=[ae,K(be),"'",K(Ee),"'"].join("");return["D:",x.getFullYear(),K(x.getMonth()+1),K(x.getDate()),K(x.getHours()),K(x.getMinutes()),K(x.getSeconds()),Ge].join("")},Se=u.__private__.convertPDFDateToDate=function(x){var R=parseInt(x.substr(2,4),10),ae=parseInt(x.substr(6,2),10)-1,be=parseInt(x.substr(8,2),10),Ee=parseInt(x.substr(10,2),10),Ge=parseInt(x.substr(12,2),10),Ze=parseInt(x.substr(14,2),10);return new Date(R,ae,be,Ee,Ge,Ze,0)},ne=u.__private__.setCreationDate=function(x){var R;if(x===void 0&&(x=new Date),x instanceof Date)R=le(x);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(x))throw new Error("Invalid argument passed to jsPDF.setCreationDate");R=x}return te=R},C=u.__private__.getCreationDate=function(x){var R=te;return x==="jsDate"&&(R=Se(te)),R};u.setCreationDate=function(x){return ne(x),this},u.getCreationDate=function(x){return C(x)};var H,K=u.__private__.padd2=function(x){return("0"+parseInt(x)).slice(-2)},X=u.__private__.padd2Hex=function(x){return("00"+(x=x.toString())).substr(x.length)},pe=0,ve=[],ke=[],Ae=0,Re=[],Me=[],Ke=!1,je=ke;u.__private__.setCustomOutputDestination=function(x){Ke=!0,je=x};var j=function(x){Ke||(je=x)};u.__private__.resetCustomOutputDestination=function(){Ke=!1,je=ke};var P=u.__private__.out=function(x){return x=x.toString(),Ae+=x.length+1,je.push(x),je},V=u.__private__.write=function(x){return P(arguments.length===1?x.toString():Array.prototype.join.call(arguments," "))},$=u.__private__.getArrayBuffer=function(x){for(var R=x.length,ae=new ArrayBuffer(R),be=new Uint8Array(ae);R--;)be[R]=x.charCodeAt(R);return ae},z=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];u.__private__.getStandardFonts=function(){return z};var M=t.fontSize||16;u.__private__.setFontSize=u.setFontSize=function(x){return M=E===L?x/yt:x,this};var he,me=u.__private__.getFontSize=u.getFontSize=function(){return E===A?M:M*yt},de=t.R2L||!1;u.__private__.setR2L=u.setR2L=function(x){return de=x,this},u.__private__.getR2L=u.getR2L=function(){return de};var Le,Ie=u.__private__.setZoomMode=function(x){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(x))he=x;else if(isNaN(x)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(x)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+x+'" is not recognized.');he=x}else he=parseInt(x,10)};u.__private__.getZoomMode=function(){return he};var Te,Ve=u.__private__.setPageMode=function(x){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(x)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+x+'" is not recognized.');Le=x};u.__private__.getPageMode=function(){return Le};var ht=u.__private__.setLayoutMode=function(x){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(x)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+x+'" is not recognized.');Te=x};u.__private__.getLayoutMode=function(){return Te},u.__private__.setDisplayMode=u.setDisplayMode=function(x,R,ae){return Ie(x),ht(R),Ve(ae),this};var st={title:"",subject:"",author:"",keywords:"",creator:""};u.__private__.getDocumentProperty=function(x){if(Object.keys(st).indexOf(x)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return st[x]},u.__private__.getDocumentProperties=function(){return st},u.__private__.setDocumentProperties=u.setProperties=u.setDocumentProperties=function(x){for(var R in st)st.hasOwnProperty(R)&&x[R]&&(st[R]=x[R]);return this},u.__private__.setDocumentProperty=function(x,R){if(Object.keys(st).indexOf(x)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return st[x]=R};var ot,yt,dt,Vt,mt,Lt={},zt={},Et=[],wt={},Jt={},Nt={},Ft={},ar=null,Ot=0,xt=[],Xt=new $u(u),er=t.hotfixes||[],Rr={},bn={},tn=[],Ut=function x(R,ae,be,Ee,Ge,Ze){if(!(this instanceof x))return new x(R,ae,be,Ee,Ge,Ze);isNaN(R)&&(R=1),isNaN(ae)&&(ae=0),isNaN(be)&&(be=0),isNaN(Ee)&&(Ee=1),isNaN(Ge)&&(Ge=0),isNaN(Ze)&&(Ze=0),this._matrix=[R,ae,be,Ee,Ge,Ze]};Object.defineProperty(Ut.prototype,"sx",{get:function(){return this._matrix[0]},set:function(x){this._matrix[0]=x}}),Object.defineProperty(Ut.prototype,"shy",{get:function(){return this._matrix[1]},set:function(x){this._matrix[1]=x}}),Object.defineProperty(Ut.prototype,"shx",{get:function(){return this._matrix[2]},set:function(x){this._matrix[2]=x}}),Object.defineProperty(Ut.prototype,"sy",{get:function(){return this._matrix[3]},set:function(x){this._matrix[3]=x}}),Object.defineProperty(Ut.prototype,"tx",{get:function(){return this._matrix[4]},set:function(x){this._matrix[4]=x}}),Object.defineProperty(Ut.prototype,"ty",{get:function(){return this._matrix[5]},set:function(x){this._matrix[5]=x}}),Object.defineProperty(Ut.prototype,"a",{get:function(){return this._matrix[0]},set:function(x){this._matrix[0]=x}}),Object.defineProperty(Ut.prototype,"b",{get:function(){return this._matrix[1]},set:function(x){this._matrix[1]=x}}),Object.defineProperty(Ut.prototype,"c",{get:function(){return this._matrix[2]},set:function(x){this._matrix[2]=x}}),Object.defineProperty(Ut.prototype,"d",{get:function(){return this._matrix[3]},set:function(x){this._matrix[3]=x}}),Object.defineProperty(Ut.prototype,"e",{get:function(){return this._matrix[4]},set:function(x){this._matrix[4]=x}}),Object.defineProperty(Ut.prototype,"f",{get:function(){return this._matrix[5]},set:function(x){this._matrix[5]=x}}),Object.defineProperty(Ut.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(Ut.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(Ut.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(Ut.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),Ut.prototype.join=function(x){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(G).join(x)},Ut.prototype.multiply=function(x){var R=x.sx*this.sx+x.shy*this.shx,ae=x.sx*this.shy+x.shy*this.sy,be=x.shx*this.sx+x.sy*this.shx,Ee=x.shx*this.shy+x.sy*this.sy,Ge=x.tx*this.sx+x.ty*this.shx+this.tx,Ze=x.tx*this.shy+x.ty*this.sy+this.ty;return new Ut(R,ae,be,Ee,Ge,Ze)},Ut.prototype.decompose=function(){var x=this.sx,R=this.shy,ae=this.shx,be=this.sy,Ee=this.tx,Ge=this.ty,Ze=Math.sqrt(x*x+R*R),vt=(x/=Ze)*ae+(R/=Ze)*be;ae-=x*vt,be-=R*vt;var Pt=Math.sqrt(ae*ae+be*be);return vt/=Pt,x*(be/=Pt)<R*(ae/=Pt)&&(x=-x,R=-R,vt=-vt,Ze=-Ze),{scale:new Ut(Ze,0,0,Pt,0,0),translate:new Ut(1,0,0,1,Ee,Ge),rotate:new Ut(x,R,-R,x,0,0),skew:new Ut(1,0,vt,1,0,0)}},Ut.prototype.toString=function(x){return this.join(" ")},Ut.prototype.inversed=function(){var x=this.sx,R=this.shy,ae=this.shx,be=this.sy,Ee=this.tx,Ge=this.ty,Ze=1/(x*be-R*ae),vt=be*Ze,Pt=-R*Ze,qt=-ae*Ze,Kt=x*Ze;return new Ut(vt,Pt,qt,Kt,-vt*Ee-qt*Ge,-Pt*Ee-Kt*Ge)},Ut.prototype.applyToPoint=function(x){var R=x.x*this.sx+x.y*this.shx+this.tx,ae=x.x*this.shy+x.y*this.sy+this.ty;return new Jn(R,ae)},Ut.prototype.applyToRectangle=function(x){var R=this.applyToPoint(x),ae=this.applyToPoint(new Jn(x.x+x.w,x.y+x.h));return new Va(R.x,R.y,ae.x-R.x,ae.y-R.y)},Ut.prototype.clone=function(){var x=this.sx,R=this.shy,ae=this.shx,be=this.sy,Ee=this.tx,Ge=this.ty;return new Ut(x,R,ae,be,Ee,Ge)},u.Matrix=Ut;var pn=u.matrixMult=function(x,R){return R.multiply(x)},wn=new Ut(1,0,0,1,0,0);u.unitMatrix=u.identityMatrix=wn;var Vr=function(x,R){if(!Jt[x]){var ae=(R instanceof ti?"Sh":"P")+(Object.keys(wt).length+1).toString(10);R.id=ae,Jt[x]=ae,wt[ae]=R,Xt.publish("addPattern",R)}};u.ShadingPattern=ti,u.TilingPattern=Pi,u.addShadingPattern=function(x,R){return O("addShadingPattern()"),Vr(x,R),this},u.beginTilingPattern=function(x){O("beginTilingPattern()"),Ya(x.boundingBox[0],x.boundingBox[1],x.boundingBox[2]-x.boundingBox[0],x.boundingBox[3]-x.boundingBox[1],x.matrix)},u.endTilingPattern=function(x,R){O("endTilingPattern()"),R.stream=Me[H].join(`
`),Vr(x,R),Xt.publish("endTilingPattern",R),tn.pop().restore()};var $r,xr=u.__private__.newObject=function(){var x=Ar();return dr(x,!0),x},Ar=u.__private__.newObjectDeferred=function(){return pe++,ve[pe]=function(){return Ae},pe},dr=function(x,R){return R=typeof R=="boolean"&&R,ve[x]=Ae,R&&P(x+" 0 obj"),x},rs=u.__private__.newAdditionalObject=function(){var x={objId:Ar(),content:""};return Re.push(x),x},wr=Ar(),Sn=Ar(),rn=u.__private__.decodeColorString=function(x){var R=x.split(" ");if(R.length!==2||R[1]!=="g"&&R[1]!=="G")R.length!==5||R[4]!=="k"&&R[4]!=="K"||(R=[(1-R[0])*(1-R[3]),(1-R[1])*(1-R[3]),(1-R[2])*(1-R[3]),"r"]);else{var ae=parseFloat(R[0]);R=[ae,ae,ae,"r"]}for(var be="#",Ee=0;Ee<3;Ee++)be+=("0"+Math.floor(255*parseFloat(R[Ee])).toString(16)).slice(-2);return be},kn=u.__private__.encodeColorString=function(x){var R;typeof x=="string"&&(x={ch1:x});var ae=x.ch1,be=x.ch2,Ee=x.ch3,Ge=x.ch4,Ze=x.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof ae=="string"&&ae.charAt(0)!=="#"){var vt=new Vf(ae);if(vt.ok)ae=vt.toHex();else if(!/^\d*\.?\d*$/.test(ae))throw new Error('Invalid color "'+ae+'" passed to jsPDF.encodeColorString.')}if(typeof ae=="string"&&/^#[0-9A-Fa-f]{3}$/.test(ae)&&(ae="#"+ae[1]+ae[1]+ae[2]+ae[2]+ae[3]+ae[3]),typeof ae=="string"&&/^#[0-9A-Fa-f]{6}$/.test(ae)){var Pt=parseInt(ae.substr(1),16);ae=Pt>>16&255,be=Pt>>8&255,Ee=255&Pt}if(be===void 0||Ge===void 0&&ae===be&&be===Ee)R=typeof ae=="string"?ae+" "+Ze[0]:x.precision===2?I(ae/255)+" "+Ze[0]:k(ae/255)+" "+Ze[0];else if(Ge===void 0||kr(Ge)==="object"){if(Ge&&!isNaN(Ge.a)&&Ge.a===0)return["1.","1.","1.",Ze[1]].join(" ");R=typeof ae=="string"?[ae,be,Ee,Ze[1]].join(" "):x.precision===2?[I(ae/255),I(be/255),I(Ee/255),Ze[1]].join(" "):[k(ae/255),k(be/255),k(Ee/255),Ze[1]].join(" ")}else R=typeof ae=="string"?[ae,be,Ee,Ge,Ze[2]].join(" "):x.precision===2?[I(ae),I(be),I(Ee),I(Ge),Ze[2]].join(" "):[k(ae),k(be),k(Ee),k(Ge),Ze[2]].join(" ");return R},Wr=u.__private__.getFilters=function(){return d},Yr=u.__private__.putStream=function(x){var R=(x=x||{}).data||"",ae=x.filters||Wr(),be=x.alreadyAppliedFilters||[],Ee=x.addLength1||!1,Ge=R.length,Ze=x.objectId,vt=function(xe){return xe};if(p!==null&&Ze===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");p!==null&&(vt=Lr.encryptor(Ze,0));var Pt={};ae===!0&&(ae=["FlateEncode"]);var qt=x.additionalKeyValues||[],Kt=(Pt=Mt.API.processDataByFilters!==void 0?Mt.API.processDataByFilters(R,ae):{data:R,reverseChain:[]}).reverseChain+(Array.isArray(be)?be.join(" "):be.toString());if(Pt.data.length!==0&&(qt.push({key:"Length",value:Pt.data.length}),Ee===!0&&qt.push({key:"Length1",value:Ge})),Kt.length!=0)if(Kt.split("/").length-1==1)qt.push({key:"Filter",value:Kt});else{qt.push({key:"Filter",value:"["+Kt+"]"});for(var or=0;or<qt.length;or+=1)if(qt[or].key==="DecodeParms"){for(var T=[],ue=0;ue<Pt.reverseChain.split("/").length-1;ue+=1)T.push("null");T.push(qt[or].value),qt[or].value="["+T.join(" ")+"]"}}P("<<");for(var ge=0;ge<qt.length;ge++)P("/"+qt[ge].key+" "+qt[ge].value);P(">>"),Pt.data.length!==0&&(P("stream"),P(vt(Pt.data)),P("endstream"))},En=u.__private__.putPage=function(x){var R=x.number,ae=x.data,be=x.objId,Ee=x.contentsObjId;dr(be,!0),P("<</Type /Page"),P("/Parent "+x.rootDictionaryObjId+" 0 R"),P("/Resources "+x.resourceDictionaryObjId+" 0 R"),P("/MediaBox ["+parseFloat(G(x.mediaBox.bottomLeftX))+" "+parseFloat(G(x.mediaBox.bottomLeftY))+" "+G(x.mediaBox.topRightX)+" "+G(x.mediaBox.topRightY)+"]"),x.cropBox!==null&&P("/CropBox ["+G(x.cropBox.bottomLeftX)+" "+G(x.cropBox.bottomLeftY)+" "+G(x.cropBox.topRightX)+" "+G(x.cropBox.topRightY)+"]"),x.bleedBox!==null&&P("/BleedBox ["+G(x.bleedBox.bottomLeftX)+" "+G(x.bleedBox.bottomLeftY)+" "+G(x.bleedBox.topRightX)+" "+G(x.bleedBox.topRightY)+"]"),x.trimBox!==null&&P("/TrimBox ["+G(x.trimBox.bottomLeftX)+" "+G(x.trimBox.bottomLeftY)+" "+G(x.trimBox.topRightX)+" "+G(x.trimBox.topRightY)+"]"),x.artBox!==null&&P("/ArtBox ["+G(x.artBox.bottomLeftX)+" "+G(x.artBox.bottomLeftY)+" "+G(x.artBox.topRightX)+" "+G(x.artBox.topRightY)+"]"),typeof x.userUnit=="number"&&x.userUnit!==1&&P("/UserUnit "+x.userUnit),Xt.publish("putPage",{objId:be,pageContext:xt[R],pageNumber:R,page:ae}),P("/Contents "+Ee+" 0 R"),P(">>"),P("endobj");var Ge=ae.join(`
`);return E===L&&(Ge+=`
Q`),dr(Ee,!0),Yr({data:Ge,filters:Wr(),objectId:Ee}),P("endobj"),be},lt=u.__private__.putPages=function(){var x,R,ae=[];for(x=1;x<=Ot;x++)xt[x].objId=Ar(),xt[x].contentsObjId=Ar();for(x=1;x<=Ot;x++)ae.push(En({number:x,data:Me[x],objId:xt[x].objId,contentsObjId:xt[x].contentsObjId,mediaBox:xt[x].mediaBox,cropBox:xt[x].cropBox,bleedBox:xt[x].bleedBox,trimBox:xt[x].trimBox,artBox:xt[x].artBox,userUnit:xt[x].userUnit,rootDictionaryObjId:wr,resourceDictionaryObjId:Sn}));dr(wr,!0),P("<</Type /Pages");var be="/Kids [";for(R=0;R<Ot;R++)be+=ae[R]+" 0 R ";P(be+"]"),P("/Count "+Ot),P(">>"),P("endobj"),Xt.publish("postPutPages")},Jr=function(x){Xt.publish("putFont",{font:x,out:P,newObject:xr,putStream:Yr}),x.isAlreadyPutted!==!0&&(x.objectNumber=xr(),P("<<"),P("/Type /Font"),P("/BaseFont /"+Li(x.postScriptName)),P("/Subtype /Type1"),typeof x.encoding=="string"&&P("/Encoding /"+x.encoding),P("/FirstChar 32"),P("/LastChar 255"),P(">>"),P("endobj"))},ye=function(x){x.objectNumber=xr();var R=[];R.push({key:"Type",value:"/XObject"}),R.push({key:"Subtype",value:"/Form"}),R.push({key:"BBox",value:"["+[G(x.x),G(x.y),G(x.x+x.width),G(x.y+x.height)].join(" ")+"]"}),R.push({key:"Matrix",value:"["+x.matrix.toString()+"]"});var ae=x.pages[1].join(`
`);Yr({data:ae,additionalKeyValues:R,objectId:x.objectNumber}),P("endobj")},ze=function(x,R){R||(R=21);var ae=xr(),be=(function(Ze,vt){var Pt,qt=[],Kt=1/(vt-1);for(Pt=0;Pt<1;Pt+=Kt)qt.push(Pt);if(qt.push(1),Ze[0].offset!=0){var or={offset:0,color:Ze[0].color};Ze.unshift(or)}if(Ze[Ze.length-1].offset!=1){var T={offset:1,color:Ze[Ze.length-1].color};Ze.push(T)}for(var ue="",ge=0,xe=0;xe<qt.length;xe++){for(Pt=qt[xe];Pt>Ze[ge+1].offset;)ge++;var fe=Ze[ge].offset,Ne=(Pt-fe)/(Ze[ge+1].offset-fe),Fe=Ze[ge].color,qe=Ze[ge+1].color;ue+=X(Math.round((1-Ne)*Fe[0]+Ne*qe[0]).toString(16))+X(Math.round((1-Ne)*Fe[1]+Ne*qe[1]).toString(16))+X(Math.round((1-Ne)*Fe[2]+Ne*qe[2]).toString(16))}return ue.trim()})(x.colors,R),Ee=[];Ee.push({key:"FunctionType",value:"0"}),Ee.push({key:"Domain",value:"[0.0 1.0]"}),Ee.push({key:"Size",value:"["+R+"]"}),Ee.push({key:"BitsPerSample",value:"8"}),Ee.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ee.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Yr({data:be,additionalKeyValues:Ee,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:ae}),P("endobj"),x.objectNumber=xr(),P("<< /ShadingType "+x.type),P("/ColorSpace /DeviceRGB");var Ge="/Coords ["+G(parseFloat(x.coords[0]))+" "+G(parseFloat(x.coords[1]))+" ";x.type===2?Ge+=G(parseFloat(x.coords[2]))+" "+G(parseFloat(x.coords[3])):Ge+=G(parseFloat(x.coords[2]))+" "+G(parseFloat(x.coords[3]))+" "+G(parseFloat(x.coords[4]))+" "+G(parseFloat(x.coords[5])),P(Ge+="]"),x.matrix&&P("/Matrix ["+x.matrix.toString()+"]"),P("/Function "+ae+" 0 R"),P("/Extend [true true]"),P(">>"),P("endobj")},We=function(x,R){var ae=Ar(),be=xr();R.push({resourcesOid:ae,objectOid:be}),x.objectNumber=be;var Ee=[];Ee.push({key:"Type",value:"/Pattern"}),Ee.push({key:"PatternType",value:"1"}),Ee.push({key:"PaintType",value:"1"}),Ee.push({key:"TilingType",value:"1"}),Ee.push({key:"BBox",value:"["+x.boundingBox.map(G).join(" ")+"]"}),Ee.push({key:"XStep",value:G(x.xStep)}),Ee.push({key:"YStep",value:G(x.yStep)}),Ee.push({key:"Resources",value:ae+" 0 R"}),x.matrix&&Ee.push({key:"Matrix",value:"["+x.matrix.toString()+"]"}),Yr({data:x.stream,additionalKeyValues:Ee,objectId:x.objectNumber}),P("endobj")},Qe=function(x){for(var R in x.objectNumber=xr(),P("<<"),x)switch(R){case"opacity":P("/ca "+I(x[R]));break;case"stroke-opacity":P("/CA "+I(x[R]))}P(">>"),P("endobj")},at=function(x){dr(x.resourcesOid,!0),P("<<"),P("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var R in P("/Font <<"),Lt)Lt.hasOwnProperty(R)&&(b===!1||b===!0&&m.hasOwnProperty(R))&&P("/"+R+" "+Lt[R].objectNumber+" 0 R");P(">>")})(),(function(){if(Object.keys(wt).length>0){for(var R in P("/Shading <<"),wt)wt.hasOwnProperty(R)&&wt[R]instanceof ti&&wt[R].objectNumber>=0&&P("/"+R+" "+wt[R].objectNumber+" 0 R");Xt.publish("putShadingPatternDict"),P(">>")}})(),(function(R){if(Object.keys(wt).length>0){for(var ae in P("/Pattern <<"),wt)wt.hasOwnProperty(ae)&&wt[ae]instanceof u.TilingPattern&&wt[ae].objectNumber>=0&&wt[ae].objectNumber<R&&P("/"+ae+" "+wt[ae].objectNumber+" 0 R");Xt.publish("putTilingPatternDict"),P(">>")}})(x.objectOid),(function(){if(Object.keys(Nt).length>0){var R;for(R in P("/ExtGState <<"),Nt)Nt.hasOwnProperty(R)&&Nt[R].objectNumber>=0&&P("/"+R+" "+Nt[R].objectNumber+" 0 R");Xt.publish("putGStateDict"),P(">>")}})(),(function(){for(var R in P("/XObject <<"),Rr)Rr.hasOwnProperty(R)&&Rr[R].objectNumber>=0&&P("/"+R+" "+Rr[R].objectNumber+" 0 R");Xt.publish("putXobjectDict"),P(">>")})(),P(">>"),P("endobj")},tt=function(x){zt[x.fontName]=zt[x.fontName]||{},zt[x.fontName][x.fontStyle]=x.id},rt=function(x,R,ae,be,Ee){var Ge={id:"F"+(Object.keys(Lt).length+1).toString(10),postScriptName:x,fontName:R,fontStyle:ae,encoding:be,isStandardFont:Ee||!1,metadata:{}};return Xt.publish("addFont",{font:Ge,instance:this}),Lt[Ge.id]=Ge,tt(Ge),Ge.id},it=u.__private__.pdfEscape=u.pdfEscape=function(x,R){return(function(ae,be){var Ee,Ge,Ze,vt,Pt,qt,Kt,or,T;if(Ze=(be=be||{}).sourceEncoding||"Unicode",Pt=be.outputEncoding,(be.autoencode||Pt)&&Lt[ot].metadata&&Lt[ot].metadata[Ze]&&Lt[ot].metadata[Ze].encoding&&(vt=Lt[ot].metadata[Ze].encoding,!Pt&&Lt[ot].encoding&&(Pt=Lt[ot].encoding),!Pt&&vt.codePages&&(Pt=vt.codePages[0]),typeof Pt=="string"&&(Pt=vt[Pt]),Pt)){for(Kt=!1,qt=[],Ee=0,Ge=ae.length;Ee<Ge;Ee++)(or=Pt[ae.charCodeAt(Ee)])?qt.push(String.fromCharCode(or)):qt.push(ae[Ee]),qt[Ee].charCodeAt(0)>>8&&(Kt=!0);ae=qt.join("")}for(Ee=ae.length;Kt===void 0&&Ee!==0;)ae.charCodeAt(Ee-1)>>8&&(Kt=!0),Ee--;if(!Kt)return ae;for(qt=be.noBOM?[]:[254,255],Ee=0,Ge=ae.length;Ee<Ge;Ee++){if((T=(or=ae.charCodeAt(Ee))>>8)>>8)throw new Error("Character at position "+Ee+" of string '"+ae+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");qt.push(T),qt.push(or-(T<<8))}return String.fromCharCode.apply(void 0,qt)})(x,R).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Ct=u.__private__.beginPage=function(x){Me[++Ot]=[],xt[Ot]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(x[0]),topRightY:Number(x[1])}},Yt(Ot),j(Me[H])},_t=function(x,R){var ae,be,Ee;switch(e=R||e,typeof x=="string"&&(ae=y(x.toLowerCase()),Array.isArray(ae)&&(be=ae[0],Ee=ae[1])),Array.isArray(x)&&(be=x[0]*yt,Ee=x[1]*yt),isNaN(be)&&(be=i[0],Ee=i[1]),(be>14400||Ee>14400)&&(Tr.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),be=Math.min(14400,be),Ee=Math.min(14400,Ee)),i=[be,Ee],e.substr(0,1)){case"l":Ee>be&&(i=[Ee,be]);break;case"p":be>Ee&&(i=[Ee,be])}Ct(i),Ht(Wa),P(na),Ha!==0&&P(Ha+" J"),Ga!==0&&P(Ga+" j"),Xt.publish("addPage",{pageNumber:Ot})},$t=function(x){x>0&&x<=Ot&&(Me.splice(x,1),xt.splice(x,1),Ot--,H>Ot&&(H=Ot),this.setPage(H))},Yt=function(x){x>0&&x<=Ot&&(H=x)},gt=u.__private__.getNumberOfPages=u.getNumberOfPages=function(){return Me.length-1},Wt=function(x,R,ae){var be,Ee=void 0;return ae=ae||{},x=x!==void 0?x:Lt[ot].fontName,R=R!==void 0?R:Lt[ot].fontStyle,be=x.toLowerCase(),zt[be]!==void 0&&zt[be][R]!==void 0?Ee=zt[be][R]:zt[x]!==void 0&&zt[x][R]!==void 0?Ee=zt[x][R]:ae.disableWarning===!1&&Tr.warn("Unable to look up font label for font '"+x+"', '"+R+"'. Refer to getFontList() for available fonts."),Ee||ae.noFallback||(Ee=zt.times[R])==null&&(Ee=zt.times.normal),Ee},ir=u.__private__.putInfo=function(){var x=xr(),R=function(be){return be};for(var ae in p!==null&&(R=Lr.encryptor(x,0)),P("<<"),P("/Producer ("+it(R("jsPDF "+Mt.version))+")"),st)st.hasOwnProperty(ae)&&st[ae]&&P("/"+ae.substr(0,1).toUpperCase()+ae.substr(1)+" ("+it(R(st[ae]))+")");P("/CreationDate ("+it(R(te))+")"),P(">>"),P("endobj")},Pn=u.__private__.putCatalog=function(x){var R=(x=x||{}).rootDictionaryObjId||wr;switch(xr(),P("<<"),P("/Type /Catalog"),P("/Pages "+R+" 0 R"),he||(he="fullwidth"),he){case"fullwidth":P("/OpenAction [3 0 R /FitH null]");break;case"fullheight":P("/OpenAction [3 0 R /FitV null]");break;case"fullpage":P("/OpenAction [3 0 R /Fit]");break;case"original":P("/OpenAction [3 0 R /XYZ null null 1]");break;default:var ae=""+he;ae.substr(ae.length-1)==="%"&&(he=parseInt(he)/100),typeof he=="number"&&P("/OpenAction [3 0 R /XYZ null null "+I(he)+"]")}switch(Te||(Te="continuous"),Te){case"continuous":P("/PageLayout /OneColumn");break;case"single":P("/PageLayout /SinglePage");break;case"two":case"twoleft":P("/PageLayout /TwoColumnLeft");break;case"tworight":P("/PageLayout /TwoColumnRight")}Le&&P("/PageMode /"+Le),Xt.publish("putCatalog"),P(">>"),P("endobj")},ys=u.__private__.putTrailer=function(){P("trailer"),P("<<"),P("/Size "+(pe+1)),P("/Root "+pe+" 0 R"),P("/Info "+(pe-1)+" 0 R"),p!==null&&P("/Encrypt "+Lr.oid+" 0 R"),P("/ID [ <"+ce+"> <"+ce+"> ]"),P(">>")},Cr=u.__private__.putHeader=function(){P("%PDF-"+w),P("%ÂºÃŸÂ¬Ã ")},He=u.__private__.putXRef=function(){var x="0000000000";P("xref"),P("0 "+(pe+1)),P("0000000000 65535 f ");for(var R=1;R<=pe;R++)typeof ve[R]=="function"?P((x+ve[R]()).slice(-10)+" 00000 n "):ve[R]!==void 0?P((x+ve[R]).slice(-10)+" 00000 n "):P("0000000000 00000 n ")},ft=u.__private__.buildDocument=function(){var x;pe=0,Ae=0,ke=[],ve=[],Re=[],wr=Ar(),Sn=Ar(),j(ke),Xt.publish("buildDocument"),Cr(),lt(),(function(){Xt.publish("putAdditionalObjects");for(var ae=0;ae<Re.length;ae++){var be=Re[ae];dr(be.objId,!0),P(be.content),P("endobj")}Xt.publish("postPutAdditionalObjects")})(),x=[],(function(){for(var ae in Lt)Lt.hasOwnProperty(ae)&&(b===!1||b===!0&&m.hasOwnProperty(ae))&&Jr(Lt[ae])})(),(function(){var ae;for(ae in Nt)Nt.hasOwnProperty(ae)&&Qe(Nt[ae])})(),(function(){for(var ae in Rr)Rr.hasOwnProperty(ae)&&ye(Rr[ae])})(),(function(ae){var be;for(be in wt)wt.hasOwnProperty(be)&&(wt[be]instanceof ti?ze(wt[be]):wt[be]instanceof Pi&&We(wt[be],ae))})(x),Xt.publish("putResources"),x.forEach(at),at({resourcesOid:Sn,objectOid:Number.MAX_SAFE_INTEGER}),Xt.publish("postPutResources"),p!==null&&(Lr.oid=xr(),P("<<"),P("/Filter /Standard"),P("/V "+Lr.v),P("/R "+Lr.r),P("/U <"+Lr.toHexString(Lr.U)+">"),P("/O <"+Lr.toHexString(Lr.O)+">"),P("/P "+Lr.P),P(">>"),P("endobj")),ir(),Pn();var R=Ae;return He(),ys(),P("startxref"),P(""+R),P("%%EOF"),j(Me[H]),ke.join(`
`)},ur=u.__private__.getBlob=function(x){return new Blob([$(x)],{type:"application/pdf"})},Hr=u.output=u.__private__.output=($r=function(x,R){switch(typeof(R=R||{})=="string"?R={filename:R}:R.filename=R.filename||"generated.pdf",x){case void 0:return ft();case"save":u.save(R.filename);break;case"arraybuffer":return $(ft());case"blob":return ur(ft());case"bloburi":case"bloburl":if(Gt.URL!==void 0&&typeof Gt.URL.createObjectURL=="function")return Gt.URL&&Gt.URL.createObjectURL(ur(ft()))||void 0;Tr.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var ae="",be=ft();try{ae=Uu(be)}catch{ae=Uu(unescape(encodeURIComponent(be)))}return"data:application/pdf;filename="+R.filename+";base64,"+ae;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Gt)==="[object Window]"){var Ee="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Ge=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';R.pdfObjectUrl&&(Ee=R.pdfObjectUrl,Ge="");var Ze='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ee+'"'+Ge+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(R)+");<\/script></body></html>",vt=Gt.open();return vt!==null&&vt.document.write(Ze),vt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Gt)==="[object Window]"){var Pt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(R.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+R.filename+'" width="500px" height="400px" /></body></html>',qt=Gt.open();if(qt!==null){qt.document.write(Pt);var Kt=this;qt.document.documentElement.querySelector("#pdfViewer").onload=function(){qt.document.title=R.filename,qt.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Kt.output("bloburl"))}}return qt}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Gt)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var or='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",R)+'"></iframe></body></html>',T=Gt.open();if(T!==null&&(T.document.write(or),T.document.title=R.filename),T||typeof safari>"u")return T;break;case"datauri":case"dataurl":return Gt.document.location.href=this.output("datauristring",R);default:return null}},$r.foo=function(){try{return $r.apply(this,arguments)}catch(ae){var x=ae.stack||"";~x.indexOf(" at ")&&(x=x.split(" at ")[1]);var R="Error in function "+x.split(`
`)[0].split("<")[0]+": "+ae.message;if(!Gt.console)throw new Error(R);Gt.console.error(R,ae),Gt.alert&&alert(R)}},$r.foo.bar=$r,$r.foo),Ur=function(x){return Array.isArray(er)===!0&&er.indexOf(x)>-1};switch(s){case"pt":yt=1;break;case"mm":yt=72/25.4;break;case"cm":yt=72/2.54;break;case"in":yt=72;break;case"px":yt=Ur("px_scaling")==1?.75:96/72;break;case"pc":case"em":yt=12;break;case"ex":yt=6;break;default:if(typeof s!="number")throw new Error("Invalid unit: "+s);yt=s}var Lr=null;ne(),se();var Yn=u.__private__.getPageInfo=u.getPageInfo=function(x){if(isNaN(x)||x%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:xt[x].objId,pageNumber:x,pageContext:xt[x]}},ba=u.__private__.getPageInfoByObjId=function(x){if(isNaN(x)||x%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var R in xt)if(xt[R].objId===x)break;return Yn(R)},Kr=u.__private__.getCurrentPageInfo=u.getCurrentPageInfo=function(){return{objId:xt[H].objId,pageNumber:H,pageContext:xt[H]}};u.addPage=function(){return _t.apply(this,arguments),this},u.setPage=function(){return Yt.apply(this,arguments),j.call(this,Me[H]),this},u.insertPage=function(x){return this.addPage(),this.movePage(H,x),this},u.movePage=function(x,R){var ae,be;if(x>R){ae=Me[x],be=xt[x];for(var Ee=x;Ee>R;Ee--)Me[Ee]=Me[Ee-1],xt[Ee]=xt[Ee-1];Me[R]=ae,xt[R]=be,this.setPage(R)}else if(x<R){ae=Me[x],be=xt[x];for(var Ge=x;Ge<R;Ge++)Me[Ge]=Me[Ge+1],xt[Ge]=xt[Ge+1];Me[R]=ae,xt[R]=be,this.setPage(R)}return this},u.deletePage=function(){return $t.apply(this,arguments),this},u.__private__.text=u.text=function(x,R,ae,be,Ee){var Ge,Ze,vt,Pt,qt,Kt,or,T,ue,ge=(be=be||{}).scope||this;if(typeof x=="number"&&typeof R=="number"&&(typeof ae=="string"||Array.isArray(ae))){var xe=ae;ae=R,R=x,x=xe}if(arguments[3]instanceof Ut==0?(vt=arguments[4],Pt=arguments[5],kr(or=arguments[3])==="object"&&or!==null||(typeof vt=="string"&&(Pt=vt,vt=null),typeof or=="string"&&(Pt=or,or=null),typeof or=="number"&&(vt=or,or=null),be={flags:or,angle:vt,align:Pt})):(O("The transform parameter of text() with a Matrix value"),ue=Ee),isNaN(R)||isNaN(ae)||x==null)throw new Error("Invalid arguments passed to jsPDF.text");if(x.length===0)return ge;var fe,Ne="",Fe=typeof be.lineHeightFactor=="number"?be.lineHeightFactor:ks,qe=ge.internal.scaleFactor;function Je(br){return br=br.split("	").join(Array(be.TabLen||9).join(" ")),it(br,or)}function ut(br){for(var Er,sn=br.concat(),mn=[],ca=sn.length;ca--;)typeof(Er=sn.shift())=="string"?mn.push(Er):Array.isArray(br)&&(Er.length===1||Er[1]===void 0&&Er[2]===void 0)?mn.push(Er[0]):mn.push([Er[0],Er[1],Er[2]]);return mn}function Xe(br,Er){var sn;if(typeof br=="string")sn=Er(br)[0];else if(Array.isArray(br)){for(var mn,ca,eo=br.concat(),vi=[],_o=eo.length;_o--;)typeof(mn=eo.shift())=="string"?vi.push(Er(mn)[0]):Array.isArray(mn)&&typeof mn[0]=="string"&&(ca=Er(mn[0],mn[1],mn[2]),vi.push([ca[0],ca[1],ca[2]]));sn=vi}return sn}var ct=!1,we=!0;if(typeof x=="string")ct=!0;else if(Array.isArray(x)){var bt=x.concat();Ze=[];for(var jt,tr=bt.length;tr--;)(typeof(jt=bt.shift())!="string"||Array.isArray(jt)&&typeof jt[0]!="string")&&(we=!1);ct=we}if(ct===!1)throw new Error('Type of text must be string or Array. "'+x+'" is not recognized.');typeof x=="string"&&(x=x.match(/[\r?\n]/)?x.split(/\r\n|\r|\n/g):[x]);var vr=M/ge.internal.scaleFactor,Dt=vr*(Fe-1);switch(be.baseline){case"bottom":ae-=Dt;break;case"top":ae+=vr-Dt;break;case"hanging":ae+=vr-2*Dt;break;case"middle":ae+=vr/2-Dt}if((Kt=be.maxWidth||0)>0&&(typeof x=="string"?x=ge.splitTextToSize(x,Kt):Object.prototype.toString.call(x)==="[object Array]"&&(x=x.reduce(function(br,Er){return br.concat(ge.splitTextToSize(Er,Kt))},[]))),Ge={text:x,x:R,y:ae,options:be,mutex:{pdfEscape:it,activeFontKey:ot,fonts:Lt,activeFontSize:M}},Xt.publish("preProcessText",Ge),x=Ge.text,vt=(be=Ge.options).angle,ue instanceof Ut==0&&vt&&typeof vt=="number"){vt*=Math.PI/180,be.rotationDirection===0&&(vt=-vt),E===L&&(vt=-vt);var yr=Math.cos(vt),Nr=Math.sin(vt);ue=new Ut(yr,Nr,-Nr,yr,0,0)}else vt&&vt instanceof Ut&&(ue=vt);E!==L||ue||(ue=wn),(qt=be.charSpace||ws)!==void 0&&(Ne+=G(D(qt))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(T=be.horizontalScale)!==void 0&&(Ne+=G(100*T)+` Tz
`),be.lang;var pr=-1,mr=be.renderingMode!==void 0?be.renderingMode:be.stroke,Mn=ge.internal.getCurrentPageInfo().pageContext;switch(mr){case 0:case!1:case"fill":pr=0;break;case 1:case!0:case"stroke":pr=1;break;case 2:case"fillThenStroke":pr=2;break;case 3:case"invisible":pr=3;break;case 4:case"fillAndAddForClipping":pr=4;break;case 5:case"strokeAndAddPathForClipping":pr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":pr=6;break;case 7:case"addToPathForClipping":pr=7}var Un=Mn.usedRenderingMode!==void 0?Mn.usedRenderingMode:-1;pr!==-1?Ne+=pr+` Tr
`:Un!==-1&&(Ne+=`0 Tr
`),pr!==-1&&(Mn.usedRenderingMode=pr),Pt=be.align||"left";var rr,gr=M*Fe,oa=ge.internal.pageSize.getWidth(),Yi=Lt[ot];qt=be.charSpace||ws,Kt=be.maxWidth||0,or=Object.assign({autoencode:!0,noBOM:!0},be.flags);var ka=[],Ka=function(br){return ge.getStringUnitWidth(br,{font:Yi,charSpace:qt,fontSize:M,doKerning:!1})*M/qe};if(Object.prototype.toString.call(x)==="[object Array]"){var ss;Ze=ut(x),Pt!=="left"&&(rr=Ze.map(Ka));var as,Ca=0;if(Pt==="right"){R-=rr[0],x=[],tr=Ze.length;for(var la=0;la<tr;la++)la===0?(as=Cs(R),ss=bs(ae)):(as=D(Ca-rr[la]),ss=-gr),x.push([Ze[la],as,ss]),Ca=rr[la]}else if(Pt==="center"){R-=rr[0]/2,x=[],tr=Ze.length;for(var Aa=0;Aa<tr;Aa++)Aa===0?(as=Cs(R),ss=bs(ae)):(as=D((Ca-rr[Aa])/2),ss=-gr),x.push([Ze[Aa],as,ss]),Ca=rr[Aa]}else if(Pt==="left"){x=[],tr=Ze.length;for(var Ji=0;Ji<tr;Ji++)x.push(Ze[Ji])}else if(Pt==="justify"&&Yi.encoding==="Identity-H"){x=[],tr=Ze.length,Kt=Kt!==0?Kt:oa;for(var wi=0,nn=0;nn<tr;nn++)if(ss=nn===0?bs(ae):-gr,as=nn===0?Cs(R):wi,nn<tr-1){var No=D((Kt-rr[nn])/(Ze[nn].split(" ").length-1)),Hs=Ze[nn].split(" ");x.push([Hs[0]+" ",as,ss]),wi=0;for(var Gs=1;Gs<Hs.length;Gs++){var Ki=(Ka(Hs[Gs-1]+" "+Hs[Gs])-Ka(Hs[Gs]))*qe+No;Gs==Hs.length-1?x.push([Hs[Gs],Ki,0]):x.push([Hs[Gs]+" ",Ki,0]),wi-=Ki}}else x.push([Ze[nn],as,ss]);x.push(["",wi,0])}else{if(Pt!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(x=[],tr=Ze.length,Kt=Kt!==0?Kt:oa,nn=0;nn<tr;nn++){ss=nn===0?bs(ae):-gr,as=nn===0?Cs(R):0;var Zi=Ze[nn].split(" ").length-1,Xi=Zi>0?(Kt-rr[nn])/Zi:0;nn<tr-1?ka.push(G(D(Xi))):ka.push(0),x.push([Ze[nn],as,ss])}}}(typeof be.R2L=="boolean"?be.R2L:de)===!0&&(x=Xe(x,function(br,Er,sn){return[br.split("").reverse().join(""),Er,sn]})),Ge={text:x,x:R,y:ae,options:be,mutex:{pdfEscape:it,activeFontKey:ot,fonts:Lt,activeFontSize:M}},Xt.publish("postProcessText",Ge),x=Ge.text,fe=Ge.mutex.isHex||!1;var Qi=Lt[ot].encoding;Qi!=="WinAnsiEncoding"&&Qi!=="StandardEncoding"||(x=Xe(x,function(br,Er,sn){return[Je(br),Er,sn]})),Ze=ut(x),x=[];for(var La,Ea,Pa,Za=Array.isArray(Ze[0])?1:0,Ta="",Xa=function(br,Er,sn){var mn="";return sn instanceof Ut?(sn=typeof be.angle=="number"?pn(sn,new Ut(1,0,0,1,br,Er)):pn(new Ut(1,0,0,1,br,Er),sn),E===L&&(sn=pn(new Ut(1,0,0,-1,0,0),sn)),mn=sn.join(" ")+` Tm
`):mn=G(br)+" "+G(Er)+` Td
`,mn},vs=0;vs<Ze.length;vs++){switch(Ta="",Za){case 1:Pa=(fe?"<":"(")+Ze[vs][0]+(fe?">":")"),La=parseFloat(Ze[vs][1]),Ea=parseFloat(Ze[vs][2]);break;case 0:Pa=(fe?"<":"(")+Ze[vs]+(fe?">":")"),La=Cs(R),Ea=bs(ae)}ka!==void 0&&ka[vs]!==void 0&&(Ta=ka[vs]+` Tw
`),vs===0?x.push(Ta+Xa(La,Ea,ue)+Pa):Za===0?x.push(Ta+Pa):Za===1&&x.push(Ta+Xa(La,Ea,ue)+Pa)}x=Za===0?x.join(` Tj
T* `):x.join(` Tj
`),x+=` Tj
`;var Vs=`BT
/`;return Vs+=ot+" "+M+` Tf
`,Vs+=G(M*Fe)+` TL
`,Vs+=sa+`
`,Vs+=Ne,Vs+=x,P(Vs+="ET"),m[ot]=!0,ge};var wa=u.__private__.clip=u.clip=function(x){return P(x==="evenodd"?"W*":"W"),this};u.clipEvenOdd=function(){return wa("evenodd")},u.__private__.discardPath=u.discardPath=function(){return P("n"),this};var Ir=u.__private__.isValidStyle=function(x){var R=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(x)!==-1&&(R=!0),R};u.__private__.setDefaultPathOperation=u.setDefaultPathOperation=function(x){return Ir(x)&&(h=x),this};var va=u.__private__.getStyle=u.getStyle=function(x){var R=h;switch(x){case"D":case"S":R="S";break;case"F":R="f";break;case"FD":case"DF":R="B";break;case"f":case"f*":case"B":case"B*":R=x}return R},Na=u.close=function(){return P("h"),this};u.stroke=function(){return P("S"),this},u.fill=function(x){return $s("f",x),this},u.fillEvenOdd=function(x){return $s("f*",x),this},u.fillStroke=function(x){return $s("B",x),this},u.fillStrokeEvenOdd=function(x){return $s("B*",x),this};var $s=function(x,R){kr(R)==="object"?di(R,x):P(x)},Ws=function(x){x===null||E===L&&x===void 0||(x=va(x),P(x))};function $a(x,R,ae,be,Ee){var Ge=new Pi(R||this.boundingBox,ae||this.xStep,be||this.yStep,this.gState,Ee||this.matrix);Ge.stream=this.stream;var Ze=x+"$$"+this.cloneIndex+++"$$";return Vr(Ze,Ge),Ge}var di=function(x,R){var ae=Jt[x.key],be=wt[ae];if(be instanceof ti)P("q"),P(ra(R)),be.gState&&u.setGState(be.gState),P(x.matrix.toString()+" cm"),P("/"+ae+" sh"),P("Q");else if(be instanceof Pi){var Ee=new Ut(1,0,0,-1,0,ns());x.matrix&&(Ee=Ee.multiply(x.matrix||wn),ae=$a.call(be,x.key,x.boundingBox,x.xStep,x.yStep,Ee).id),P("q"),P("/Pattern cs"),P("/"+ae+" scn"),be.gState&&u.setGState(be.gState),P(R),P("Q")}},ra=function(x){switch(x){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},_a=u.moveTo=function(x,R){return P(G(D(x))+" "+G(v(R))+" m"),this},ui=u.lineTo=function(x,R){return P(G(D(x))+" "+G(v(R))+" l"),this},Bn=u.curveTo=function(x,R,ae,be,Ee,Ge){return P([G(D(x)),G(v(R)),G(D(ae)),G(v(be)),G(D(Ee)),G(v(Ge)),"c"].join(" ")),this};u.__private__.line=u.line=function(x,R,ae,be,Ee){if(isNaN(x)||isNaN(R)||isNaN(ae)||isNaN(be)||!Ir(Ee))throw new Error("Invalid arguments passed to jsPDF.line");return E===A?this.lines([[ae-x,be-R]],x,R,[1,1],Ee||"S"):this.lines([[ae-x,be-R]],x,R,[1,1]).stroke()},u.__private__.lines=u.lines=function(x,R,ae,be,Ee,Ge){var Ze,vt,Pt,qt,Kt,or,T,ue,ge,xe,fe,Ne;if(typeof x=="number"&&(Ne=ae,ae=R,R=x,x=Ne),be=be||[1,1],Ge=Ge||!1,isNaN(R)||isNaN(ae)||!Array.isArray(x)||!Array.isArray(be)||!Ir(Ee)||typeof Ge!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(_a(R,ae),Ze=be[0],vt=be[1],qt=x.length,xe=R,fe=ae,Pt=0;Pt<qt;Pt++)(Kt=x[Pt]).length===2?(xe=Kt[0]*Ze+xe,fe=Kt[1]*vt+fe,ui(xe,fe)):(or=Kt[0]*Ze+xe,T=Kt[1]*vt+fe,ue=Kt[2]*Ze+xe,ge=Kt[3]*vt+fe,xe=Kt[4]*Ze+xe,fe=Kt[5]*vt+fe,Bn(or,T,ue,ge,xe,fe));return Ge&&Na(),Ws(Ee),this},u.path=function(x){for(var R=0;R<x.length;R++){var ae=x[R],be=ae.c;switch(ae.op){case"m":_a(be[0],be[1]);break;case"l":ui(be[0],be[1]);break;case"c":Bn.apply(this,be);break;case"h":Na()}}return this},u.__private__.rect=u.rect=function(x,R,ae,be,Ee){if(isNaN(x)||isNaN(R)||isNaN(ae)||isNaN(be)||!Ir(Ee))throw new Error("Invalid arguments passed to jsPDF.rect");return E===A&&(be=-be),P([G(D(x)),G(v(R)),G(D(ae)),G(D(be)),"re"].join(" ")),Ws(Ee),this},u.__private__.triangle=u.triangle=function(x,R,ae,be,Ee,Ge,Ze){if(isNaN(x)||isNaN(R)||isNaN(ae)||isNaN(be)||isNaN(Ee)||isNaN(Ge)||!Ir(Ze))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[ae-x,be-R],[Ee-ae,Ge-be],[x-Ee,R-Ge]],x,R,[1,1],Ze,!0),this},u.__private__.roundedRect=u.roundedRect=function(x,R,ae,be,Ee,Ge,Ze){if(isNaN(x)||isNaN(R)||isNaN(ae)||isNaN(be)||isNaN(Ee)||isNaN(Ge)||!Ir(Ze))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var vt=4/3*(Math.SQRT2-1);return Ee=Math.min(Ee,.5*ae),Ge=Math.min(Ge,.5*be),this.lines([[ae-2*Ee,0],[Ee*vt,0,Ee,Ge-Ge*vt,Ee,Ge],[0,be-2*Ge],[0,Ge*vt,-Ee*vt,Ge,-Ee,Ge],[2*Ee-ae,0],[-Ee*vt,0,-Ee,-Ge*vt,-Ee,-Ge],[0,2*Ge-be],[0,-Ge*vt,Ee*vt,-Ge,Ee,-Ge]],x+Ee,R,[1,1],Ze,!0),this},u.__private__.ellipse=u.ellipse=function(x,R,ae,be,Ee){if(isNaN(x)||isNaN(R)||isNaN(ae)||isNaN(be)||!Ir(Ee))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Ge=4/3*(Math.SQRT2-1)*ae,Ze=4/3*(Math.SQRT2-1)*be;return _a(x+ae,R),Bn(x+ae,R-Ze,x+Ge,R-be,x,R-be),Bn(x-Ge,R-be,x-ae,R-Ze,x-ae,R),Bn(x-ae,R+Ze,x-Ge,R+be,x,R+be),Bn(x+Ge,R+be,x+ae,R+Ze,x+ae,R),Ws(Ee),this},u.__private__.circle=u.circle=function(x,R,ae,be){if(isNaN(x)||isNaN(R)||isNaN(ae)||!Ir(be))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(x,R,ae,ae,be)},u.setFont=function(x,R,ae){return ae&&(R=Y(R,ae)),ot=Wt(x,R,{disableWarning:!1}),this};var hi=u.__private__.getFont=u.getFont=function(){return Lt[Wt.apply(u,arguments)]};u.__private__.getFontList=u.getFontList=function(){var x,R,ae={};for(x in zt)if(zt.hasOwnProperty(x))for(R in ae[x]=[],zt[x])zt[x].hasOwnProperty(R)&&ae[x].push(R);return ae},u.addFont=function(x,R,ae,be,Ee){var Ge=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Ge.indexOf(arguments[3])!==-1?Ee=arguments[3]:arguments[3]&&Ge.indexOf(arguments[3])==-1&&(ae=Y(ae,be)),rt.call(this,x,R,ae,Ee=Ee||"Identity-H")};var ks,Wa=t.lineWidth||.200025,fi=u.__private__.getLineWidth=u.getLineWidth=function(){return Wa},Ht=u.__private__.setLineWidth=u.setLineWidth=function(x){return Wa=x,P(G(D(x))+" w"),this};u.__private__.setLineDash=Mt.API.setLineDash=Mt.API.setLineDashPattern=function(x,R){if(x=x||[],R=R||0,isNaN(R)||!Array.isArray(x))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return x=x.map(function(ae){return G(D(ae))}).join(" "),R=G(D(R)),P("["+x+"] "+R+" d"),this};var pi=u.__private__.getLineHeight=u.getLineHeight=function(){return M*ks};u.__private__.getLineHeight=u.getLineHeight=function(){return M*ks};var mi=u.__private__.setLineHeightFactor=u.setLineHeightFactor=function(x){return typeof(x=x||1.15)=="number"&&(ks=x),this},$i=u.__private__.getLineHeightFactor=u.getLineHeightFactor=function(){return ks};mi(t.lineHeight);var Cs=u.__private__.getHorizontalCoordinate=function(x){return D(x)},bs=u.__private__.getVerticalCoordinate=function(x){return E===L?x:xt[H].mediaBox.topRightY-xt[H].mediaBox.bottomLeftY-D(x)},Wi=u.__private__.getHorizontalCoordinateString=u.getHorizontalCoordinateString=function(x){return G(Cs(x))},Hi=u.__private__.getVerticalCoordinateString=u.getVerticalCoordinateString=function(x){return G(bs(x))},na=t.strokeColor||"0 G";u.__private__.getStrokeColor=u.getDrawColor=function(){return rn(na)},u.__private__.setStrokeColor=u.setDrawColor=function(x,R,ae,be){return na=kn({ch1:x,ch2:R,ch3:ae,ch4:be,pdfColorType:"draw",precision:2}),P(na),this};var ja=t.fillColor||"0 g";u.__private__.getFillColor=u.getFillColor=function(){return rn(ja)},u.__private__.setFillColor=u.setFillColor=function(x,R,ae,be){return ja=kn({ch1:x,ch2:R,ch3:ae,ch4:be,pdfColorType:"fill",precision:2}),P(ja),this};var sa=t.textColor||"0 g",Gi=u.__private__.getTextColor=u.getTextColor=function(){return rn(sa)};u.__private__.setTextColor=u.setTextColor=function(x,R,ae,be){return sa=kn({ch1:x,ch2:R,ch3:ae,ch4:be,pdfColorType:"text",precision:3}),this};var ws=t.charSpace,Vi=u.__private__.getCharSpace=u.getCharSpace=function(){return parseFloat(ws||0)};u.__private__.setCharSpace=u.setCharSpace=function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return ws=x,this};var Ha=0;u.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},u.__private__.setLineCap=u.setLineCap=function(x){var R=u.CapJoinStyles[x];if(R===void 0)throw new Error("Line cap style of '"+x+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ha=R,P(R+" J"),this};var Ga=0;u.__private__.setLineJoin=u.setLineJoin=function(x){var R=u.CapJoinStyles[x];if(R===void 0)throw new Error("Line join style of '"+x+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ga=R,P(R+" j"),this},u.__private__.setLineMiterLimit=u.__private__.setMiterLimit=u.setLineMiterLimit=u.setMiterLimit=function(x){if(x=x||0,isNaN(x))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return P(G(D(x))+" M"),this},u.GState=yl,u.setGState=function(x){(x=typeof x=="string"?Nt[Ft[x]]:gi(null,x)).equals(ar)||(P("/"+x.id+" gs"),ar=x)};var gi=function(x,R){if(!x||!Ft[x]){var ae=!1;for(var be in Nt)if(Nt.hasOwnProperty(be)&&Nt[be].equals(R)){ae=!0;break}if(ae)R=Nt[be];else{var Ee="GS"+(Object.keys(Nt).length+1).toString(10);Nt[Ee]=R,R.id=Ee}return x&&(Ft[x]=R.id),Xt.publish("addGState",R),R}};u.addGState=function(x,R){return gi(x,R),this},u.saveGraphicsState=function(){return P("q"),Et.push({key:ot,size:M,color:sa}),this},u.restoreGraphicsState=function(){P("Q");var x=Et.pop();return ot=x.key,M=x.size,sa=x.color,ar=null,this},u.setCurrentTransformationMatrix=function(x){return P(x.toString()+" cm"),this},u.comment=function(x){return P("#"+x),this};var Jn=function(x,R){var ae=x||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return ae},set:function(Ge){isNaN(Ge)||(ae=parseFloat(Ge))}});var be=R||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return be},set:function(Ge){isNaN(Ge)||(be=parseFloat(Ge))}});var Ee="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ee},set:function(Ge){Ee=Ge.toString()}}),this},Va=function(x,R,ae,be){Jn.call(this,x,R),this.type="rect";var Ee=ae||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ee},set:function(Ze){isNaN(Ze)||(Ee=parseFloat(Ze))}});var Ge=be||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Ge},set:function(Ze){isNaN(Ze)||(Ge=parseFloat(Ze))}}),this},aa=function(){this.page=Ot,this.currentPage=H,this.pages=Me.slice(0),this.pagesContext=xt.slice(0),this.x=dt,this.y=Vt,this.matrix=mt,this.width=Ja(H),this.height=xi(H),this.outputDestination=je,this.id="",this.objectNumber=-1};aa.prototype.restore=function(){Ot=this.page,H=this.currentPage,xt=this.pagesContext,Me=this.pages,dt=this.x,Vt=this.y,mt=this.matrix,Sa(H,this.width),As(H,this.height),je=this.outputDestination};var Ya=function(x,R,ae,be,Ee){tn.push(new aa),Ot=H=0,Me=[],dt=x,Vt=R,mt=Ee,Ct([ae,be])};for(var ia in u.beginFormObject=function(x,R,ae,be,Ee){return Ya(x,R,ae,be,Ee),this},u.endFormObject=function(x){return(function(R){if(bn[R])tn.pop().restore();else{var ae=new aa,be="Xo"+(Object.keys(Rr).length+1).toString(10);ae.id=be,bn[R]=be,Rr[be]=ae,Xt.publish("addFormObject",ae),tn.pop().restore()}})(x),this},u.doFormObject=function(x,R){var ae=Rr[bn[x]];return P("q"),P(R.toString()+" cm"),P("/"+ae.id+" Do"),P("Q"),this},u.getFormObject=function(x){var R=Rr[bn[x]];return{x:R.x,y:R.y,width:R.width,height:R.height,matrix:R.matrix}},u.save=function(x,R){return x=x||"generated.pdf",(R=R||{}).returnPromise=R.returnPromise||!1,R.returnPromise===!1?(ei(ur(ft()),x),typeof ei.unload=="function"&&Gt.setTimeout&&setTimeout(ei.unload,911),this):new Promise(function(ae,be){try{var Ee=ei(ur(ft()),x);typeof ei.unload=="function"&&Gt.setTimeout&&setTimeout(ei.unload,911),ae(Ee)}catch(Ge){be(Ge.message)}})},Mt.API)Mt.API.hasOwnProperty(ia)&&(ia==="events"&&Mt.API.events.length?(function(x,R){var ae,be,Ee;for(Ee=R.length-1;Ee!==-1;Ee--)ae=R[Ee][0],be=R[Ee][1],x.subscribe.apply(x,[ae].concat(typeof be=="function"?[be]:be))})(Xt,Mt.API.events):u[ia]=Mt.API[ia]);function Ja(x){return xt[x].mediaBox.topRightX-xt[x].mediaBox.bottomLeftX}function Sa(x,R){xt[x].mediaBox.topRightX=R+xt[x].mediaBox.bottomLeftX}function xi(x){return xt[x].mediaBox.topRightY-xt[x].mediaBox.bottomLeftY}function As(x,R){xt[x].mediaBox.topRightY=R+xt[x].mediaBox.bottomLeftY}var Ls=u.getPageWidth=function(x){return Ja(x=x||H)/yt},yi=u.setPageWidth=function(x,R){Sa(x,R*yt)},ns=u.getPageHeight=function(x){return xi(x=x||H)/yt},bi=u.setPageHeight=function(x,R){As(x,R*yt)};return u.internal={pdfEscape:it,getStyle:va,getFont:hi,getFontSize:me,getCharSpace:Vi,getTextColor:Gi,getLineHeight:pi,getLineHeightFactor:$i,getLineWidth:fi,write:V,getHorizontalCoordinate:Cs,getVerticalCoordinate:bs,getCoordinateString:Wi,getVerticalCoordinateString:Hi,collections:{},newObject:xr,newAdditionalObject:rs,newObjectDeferred:Ar,newObjectDeferredBegin:dr,getFilters:Wr,putStream:Yr,events:Xt,scaleFactor:yt,pageSize:{getWidth:function(){return Ls(H)},setWidth:function(x){yi(H,x)},getHeight:function(){return ns(H)},setHeight:function(x){bi(H,x)}},encryptionOptions:p,encryption:Lr,getEncryptor:function(x){return p!==null?Lr.encryptor(x,0):function(R){return R}},output:Hr,getNumberOfPages:gt,get pages(){return Me},out:P,f2:I,f3:k,getPageInfo:Yn,getPageInfoByObjId:ba,getCurrentPageInfo:Kr,getPDFVersion:g,Point:Jn,Rectangle:Va,Matrix:Ut,hasHotfix:Ur},Object.defineProperty(u.internal.pageSize,"width",{get:function(){return Ls(H)},set:function(x){yi(H,x)},enumerable:!0,configurable:!0}),Object.defineProperty(u.internal.pageSize,"height",{get:function(){return ns(H)},set:function(x){bi(H,x)},enumerable:!0,configurable:!0}),(function(x){for(var R=0,ae=z.length;R<ae;R++){var be=rt.call(this,x[R][0],x[R][1],x[R][2],z[R][3],!0);b===!1&&(m[be]=!0);var Ee=x[R][0].split("-");tt({id:be,fontName:Ee[0],fontStyle:Ee[1]||""})}Xt.publish("addFonts",{fonts:Lt,dictionary:zt})}).call(u,z),ot="F1",_t(i,e),Xt.publish("initialized"),u}Ai.prototype.lsbFirstWord=function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)},Ai.prototype.toHexString=function(t){return t.split("").map(function(r){return("0"+(255&r.charCodeAt(0)).toString(16)).slice(-2)}).join("")},Ai.prototype.hexToBytes=function(t){for(var r=[],e=0;e<t.length;e+=2)r.push(String.fromCharCode(parseInt(t.substr(e,2),16)));return r.join("")},Ai.prototype.processOwnerPassword=function(t,r){return Ec(Lc(r).substr(0,5),t)},Ai.prototype.encryptor=function(t,r){var e=Lc(this.encryptionKey+String.fromCharCode(255&t,t>>8&255,t>>16&255,255&r,r>>8&255)).substr(0,10);return function(s){return Ec(e,s)}},yl.prototype.equals=function(t){var r,e="id,objectNumber,equals";if(!t||kr(t)!==kr(this))return!1;var s=0;for(r in this)if(!(e.indexOf(r)>=0)){if(this.hasOwnProperty(r)&&!t.hasOwnProperty(r)||this[r]!==t[r])return!1;s++}for(r in t)t.hasOwnProperty(r)&&e.indexOf(r)<0&&s--;return s===0},Mt.API={events:[]},Mt.version="4.0.0";var en=Mt.API,Xc=1,ci=function(t){return t.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},Si=function(t){return t.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Zt=function(t){return t.toFixed(2)},Ua=function(t){return t.toFixed(5)};en.__acroform__={};var ts=function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t},Wu=function(t){return t*Xc},Ks=function(t){var r=new Zf,e=At.internal.getHeight(t)||0,s=At.internal.getWidth(t)||0;return r.BBox=[0,0,Number(Zt(s)),Number(Zt(e))],r},d2=en.__acroform__.setBit=function(t,r){if(t=t||0,r=r||0,isNaN(t)||isNaN(r))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return t|1<<r},u2=en.__acroform__.clearBit=function(t,r){if(t=t||0,r=r||0,isNaN(t)||isNaN(r))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return t&~(1<<r)},h2=en.__acroform__.getBit=function(t,r){if(isNaN(t)||isNaN(r))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return t&1<<r?1:0},un=en.__acroform__.getBitForPdf=function(t,r){if(isNaN(t)||isNaN(r))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return h2(t,r-1)},hn=en.__acroform__.setBitForPdf=function(t,r){if(isNaN(t)||isNaN(r))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return d2(t,r-1)},fn=en.__acroform__.clearBitForPdf=function(t,r){if(isNaN(t)||isNaN(r))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return u2(t,r-1)},f2=en.__acroform__.calculateCoordinates=function(t,r){var e=r.internal.getHorizontalCoordinate,s=r.internal.getVerticalCoordinate,i=t[0],a=t[1],d=t[2],o=t[3],c={};return c.lowerLeft_X=e(i)||0,c.lowerLeft_Y=s(a+o)||0,c.upperRight_X=e(i+d)||0,c.upperRight_Y=s(a)||0,[Number(Zt(c.lowerLeft_X)),Number(Zt(c.lowerLeft_Y)),Number(Zt(c.upperRight_X)),Number(Zt(c.upperRight_Y))]},p2=function(t){if(t.appearanceStreamContent)return t.appearanceStreamContent;if(t.V||t.DV){var r=[],e=t._V||t.DV,s=Pc(t,e),i=t.scope.internal.getFont(t.fontName,t.fontStyle).id;r.push("/Tx BMC"),r.push("q"),r.push("BT"),r.push(t.scope.__private__.encodeColorString(t.color)),r.push("/"+i+" "+Zt(s.fontSize)+" Tf"),r.push("1 0 0 1 0 0 Tm"),r.push(s.text),r.push("ET"),r.push("Q"),r.push("EMC");var a=Ks(t);return a.scope=t.scope,a.stream=r.join(`
`),a}},Pc=function(t,r){var e=t.fontSize===0?t.maxFontSize:t.fontSize,s={text:"",fontSize:""},i=(r=(r=r.substr(0,1)=="("?r.substr(1):r).substr(r.length-1)==")"?r.substr(0,r.length-1):r).split(" ");i=t.multiline?i.map(function(I){return I.split(`
`)}):i.map(function(I){return[I]});var a=e,d=At.internal.getHeight(t)||0;d=d<0?-d:d;var o=At.internal.getWidth(t)||0;o=o<0?-o:o;var c=function(I,k,D){if(I+1<i.length){var v=k+" "+i[I+1][0];return Zo(v,t,D).width<=o-4}return!1};a++;e:for(;a>0;){r="",a--;var h,p,b=Zo("3",t,a).height,m=t.multiline?d-a:(d-b)/2,u=m+=2,w=0,g=0,_=0;if(a<=0){r=`(...) Tj
`,r+="% Width of Text: "+Zo(r,t,a=12).width+", FieldWidth:"+o+`
`;break}for(var y="",A=0,L=0;L<i.length;L++)if(i.hasOwnProperty(L)){var E=!1;if(i[L].length!==1&&_!==i[L].length-1){if((b+2)*(A+2)+2>d)continue e;y+=i[L][_],E=!0,g=L,L--}else{y=(y+=i[L][_]+" ").substr(y.length-1)==" "?y.substr(0,y.length-1):y;var F=parseInt(L),Z=c(F,y,a),Y=L>=i.length-1;if(Z&&!Y){y+=" ",_=0;continue}if(Z||Y){if(Y)g=F;else if(t.multiline&&(b+2)*(A+2)+2>d)continue e}else{if(!t.multiline||(b+2)*(A+2)+2>d)continue e;g=F}}for(var G="",O=w;O<=g;O++){var Q=i[O];if(t.multiline){if(O===g){G+=Q[_]+" ",_=(_+1)%Q.length;continue}if(O===w){G+=Q[Q.length-1]+" ";continue}}G+=Q[0]+" "}switch(G=G.substr(G.length-1)==" "?G.substr(0,G.length-1):G,p=Zo(G,t,a).width,t.textAlign){case"right":h=o-p-2;break;case"center":h=(o-p)/2;break;default:h=2}r+=Zt(h)+" "+Zt(u)+` Td
`,r+="("+ci(G)+`) Tj
`,r+=-Zt(h)+` 0 Td
`,u=-(a+2),p=0,w=E?g:g+1,A++,y=""}break}return s.text=r,s.fontSize=a,s},Zo=function(t,r,e){var s=r.scope.internal.getFont(r.fontName,r.fontStyle),i=r.scope.getStringUnitWidth(t,{font:s,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:r.scope.getStringUnitWidth("3",{font:s,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:i}},m2={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},g2=function(t,r){var e={type:"reference",object:t};r.internal.getPageInfo(t.page).pageContext.annotations.find(function(s){return s.type===e.type&&s.object===e.object})===void 0&&r.internal.getPageInfo(t.page).pageContext.annotations.push(e)},x2=function(t,r){if(r.scope=t,t.internal!==void 0&&(t.internal.acroformPlugin===void 0||t.internal.acroformPlugin.isInitialized===!1)){if(zs.FieldNum=0,t.internal.acroformPlugin=JSON.parse(JSON.stringify(m2)),t.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Xc=t.internal.scaleFactor,t.internal.acroformPlugin.acroFormDictionaryRoot=new Xf,t.internal.acroformPlugin.acroFormDictionaryRoot.scope=t,t.internal.acroformPlugin.acroFormDictionaryRoot._eventID=t.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(t)}),t.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var s=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in s)if(s.hasOwnProperty(i)){var a=s[i];a.objId=void 0,a.hasAnnotation&&g2(a,e)}})(t)}),t.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(t)}),t.internal.events.subscribe("postPutPages",function(e){(function(s,i){var a=!s;for(var d in s||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),s=s||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(s.hasOwnProperty(d)){var o=s[d],c=[],h=o.Rect;if(o.Rect&&(o.Rect=f2(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=At.createDefaultAppearanceStream(o),kr(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(c=o.getKeyValueListForStream()),o.Rect=h,o.hasAppearanceStream&&!o.appearanceStreamContent){var p=p2(o);c.push({key:"AP",value:"<</N "+p+">>"}),i.internal.acroformPlugin.xForms.push(p)}if(o.appearanceStreamContent){var b="";for(var m in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(m)){var u=o.appearanceStreamContent[m];if(b+="/"+m+" ",b+="<<",Object.keys(u).length>=1||Array.isArray(u)){for(var d in u)if(u.hasOwnProperty(d)){var w=u[d];typeof w=="function"&&(w=w.call(i,o)),b+="/"+d+" "+w+" ",i.internal.acroformPlugin.xForms.indexOf(w)>=0||i.internal.acroformPlugin.xForms.push(w)}}else typeof(w=u)=="function"&&(w=w.call(i,o)),b+="/"+d+" "+w,i.internal.acroformPlugin.xForms.indexOf(w)>=0||i.internal.acroformPlugin.xForms.push(w);b+=">>"}c.push({key:"AP",value:`<<
`+b+">>"})}i.internal.putStream({additionalKeyValues:c,objectId:o.objId}),i.internal.out("endobj")}a&&(function(g,_){for(var y in g)if(g.hasOwnProperty(y)){var A=y,L=g[y];_.internal.newObjectDeferredBegin(L.objId,!0),kr(L)==="object"&&typeof L.putStream=="function"&&L.putStream(),delete g[A]}})(i.internal.acroformPlugin.xForms,i)})(e,t)}),t.internal.acroformPlugin.isInitialized=!0}},Kf=en.__acroform__.arrayToPdfArray=function(t,r,e){var s=function(d){return d};if(Array.isArray(t)){for(var i="[",a=0;a<t.length;a++)switch(a!==0&&(i+=" "),kr(t[a])){case"boolean":case"number":case"object":i+=t[a].toString();break;case"string":t[a].substr(0,1)!=="/"?(r!==void 0&&e&&(s=e.internal.getEncryptor(r)),i+="("+ci(s(t[a].toString()))+")"):i+=t[a].toString()}return i+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},uc=function(t,r,e){var s=function(i){return i};return r!==void 0&&e&&(s=e.internal.getEncryptor(r)),(t=t||"").toString(),"("+ci(s(t))+")"},Qs=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(t){this._objId=t}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};Qs.prototype.toString=function(){return this.objId+" 0 R"},Qs.prototype.putStream=function(){var t=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:t,objectId:this.objId}),this.scope.internal.out("endobj")},Qs.prototype.getKeyValueListForStream=function(){var t=[],r=Object.getOwnPropertyNames(this).filter(function(a){return a!="content"&&a!="appearanceStreamContent"&&a!="scope"&&a!="objId"&&a.substring(0,1)!="_"});for(var e in r)if(Object.getOwnPropertyDescriptor(this,r[e]).configurable===!1){var s=r[e],i=this[s];i&&(Array.isArray(i)?t.push({key:s,value:Kf(i,this.objId,this.scope)}):i instanceof Qs?(i.scope=this.scope,t.push({key:s,value:i.objId+" 0 R"})):typeof i!="function"&&t.push({key:s,value:i}))}return t};var Zf=function(){Qs.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var t,r=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){t=e.trim()},get:function(){return t||null}})};ts(Zf,Qs);var Xf=function(){Qs.call(this);var t,r=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return r.length>0?r:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return r}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(t){var e=function(s){return s};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+ci(e(t))+")"}},set:function(e){t=e}})};ts(Xf,Qs);var zs=function t(){Qs.call(this);var r=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return r},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute F supplied.');r=y}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!un(r,3)},set:function(y){y?this.F=hn(r,3):this.F=fn(r,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute Ff supplied.');e=y}});var s=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(s.length!==0)return s},set:function(y){s=y!==void 0?y:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[0])?0:s[0]},set:function(y){s[0]=y}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[1])?0:s[1]},set:function(y){s[1]=y}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[2])?0:s[2]},set:function(y){s[2]=y}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[3])?0:s[3]},set:function(y){s[3]=y}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(y){switch(y){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=y;break;default:throw new Error('Invalid value "'+y+'" for attribute FT supplied.')}}});var a=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!a||a.length<1){if(this instanceof bl)return;a="FieldObject"+t.FieldNum++}var y=function(A){return A};return this.scope&&(y=this.scope.internal.getEncryptor(this.objId)),"("+ci(y(a))+")"},set:function(y){a=y.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return a},set:function(y){a=y}});var d="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return d},set:function(y){d=y}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(y){o=y}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(y){c=y}});var h=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return h===void 0?50/Xc:h},set:function(y){h=y}});var p="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return p},set:function(y){p=y}});var b="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!b||this instanceof bl||this instanceof si))return uc(b,this.objId,this.scope)},set:function(y){y=y.toString(),b=y}});var m=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof jn==0?uc(m,this.objId,this.scope):m},set:function(y){y=y.toString(),m=this instanceof jn==0?y.substr(0,1)==="("?Si(y.substr(1,y.length-2)):Si(y):y}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof jn==1?Si(m.substr(1,m.length-1)):m},set:function(y){y=y.toString(),m=this instanceof jn==1?"/"+y:y}});var u=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(u)return u},set:function(y){this.V=y}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(u)return this instanceof jn==0?uc(u,this.objId,this.scope):u},set:function(y){y=y.toString(),u=this instanceof jn==0?y.substr(0,1)==="("?Si(y.substr(1,y.length-2)):Si(y):y}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof jn==1?Si(u.substr(1,u.length-1)):u},set:function(y){y=y.toString(),u=this instanceof jn==1?"/"+y:y}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var w,g=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return g},set:function(y){y=!!y,g=y}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(w)return w},set:function(y){w=y}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,1)},set:function(y){y?this.Ff=hn(this.Ff,1):this.Ff=fn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,2)},set:function(y){y?this.Ff=hn(this.Ff,2):this.Ff=fn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,3)},set:function(y){y?this.Ff=hn(this.Ff,3):this.Ff=fn(this.Ff,3)}});var _=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(_!==null)return _},set:function(y){if([0,1,2].indexOf(y)===-1)throw new Error('Invalid value "'+y+'" for attribute Q supplied.');_=y}}),Object.defineProperty(this,"textAlign",{get:function(){var y;switch(_){case 0:default:y="left";break;case 1:y="center";break;case 2:y="right"}return y},configurable:!0,enumerable:!0,set:function(y){switch(y){case"right":case 2:_=2;break;case"center":case 1:_=1;break;default:_=0}}})};ts(zs,Qs);var Oi=function(){zs.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var t=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return t},set:function(e){t=e}});var r=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return Kf(r,this.objId,this.scope)},set:function(e){var s,i;i=[],typeof(s=e)=="string"&&(i=(function(a,d,o){o||(o=1);for(var c,h=[];c=d.exec(a);)h.push(c[o]);return h})(s,/\((.*?)\)/g)),r=i}}),this.getOptions=function(){return r},this.setOptions=function(e){r=e,this.sort&&r.sort()},this.addOption=function(e){e=(e=e||"").toString(),r.push(e),this.sort&&r.sort()},this.removeOption=function(e,s){for(s=s||!1,e=(e=e||"").toString();r.indexOf(e)!==-1&&(r.splice(r.indexOf(e),1),s!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,18)},set:function(e){e?this.Ff=hn(this.Ff,18):this.Ff=fn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=hn(this.Ff,19):this.Ff=fn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,20)},set:function(e){e?(this.Ff=hn(this.Ff,20),r.sort()):this.Ff=fn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,22)},set:function(e){e?this.Ff=hn(this.Ff,22):this.Ff=fn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,23)},set:function(e){e?this.Ff=hn(this.Ff,23):this.Ff=fn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,27)},set:function(e){e?this.Ff=hn(this.Ff,27):this.Ff=fn(this.Ff,27)}}),this.hasAppearanceStream=!1};ts(Oi,zs);var Di=function(){Oi.call(this),this.fontName="helvetica",this.combo=!1};ts(Di,Oi);var Ri=function(){Di.call(this),this.combo=!0};ts(Ri,Di);var al=function(){Ri.call(this),this.edit=!0};ts(al,Ri);var jn=function(){zs.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,15)},set:function(e){e?this.Ff=hn(this.Ff,15):this.Ff=fn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,16)},set:function(e){e?this.Ff=hn(this.Ff,16):this.Ff=fn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,17)},set:function(e){e?this.Ff=hn(this.Ff,17):this.Ff=fn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,26)},set:function(e){e?this.Ff=hn(this.Ff,26):this.Ff=fn(this.Ff,26)}});var t,r={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(a){return a};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(r).length!==0){var s,i=[];for(s in i.push("<<"),r)i.push("/"+s+" ("+ci(e(r[s]))+")");return i.push(">>"),i.join(`
`)}},set:function(e){kr(e)==="object"&&(r=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return r.CA||""},set:function(e){typeof e=="string"&&(r.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return t.substr(1,t.length-1)},set:function(e){t="/"+e}})};ts(jn,zs);var il=function(){jn.call(this),this.pushButton=!0};ts(il,jn);var Bi=function(){jn.call(this),this.radio=!0,this.pushButton=!1;var t=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return t},set:function(r){t=r!==void 0?r:[]}})};ts(Bi,jn);var bl=function(){var t,r;zs.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return t},set:function(i){t=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return r},set:function(i){r=i}});var e,s={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var a,d=[];for(a in d.push("<<"),s)d.push("/"+a+" ("+ci(i(s[a]))+")");return d.push(">>"),d.join(`
`)},set:function(i){kr(i)==="object"&&(s=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return s.CA||""},set:function(i){typeof i=="string"&&(s.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(i){e=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(i){e="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=At.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};ts(bl,zs),Bi.prototype.setAppearance=function(t){if(!("createAppearanceStream"in t)||!("getCA"in t))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var r in this.Kids)if(this.Kids.hasOwnProperty(r)){var e=this.Kids[r];e.appearanceStreamContent=t.createAppearanceStream(e.optionName),e.caption=t.getCA()}},Bi.prototype.createOption=function(t){var r=new bl;return r.Parent=this,r.optionName=t,this.Kids.push(r),y2.call(this.scope,r),r};var ol=function(){jn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=At.CheckBox.createAppearanceStream()};ts(ol,jn);var si=function(){zs.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,13)},set:function(r){r?this.Ff=hn(this.Ff,13):this.Ff=fn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,21)},set:function(r){r?this.Ff=hn(this.Ff,21):this.Ff=fn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,23)},set:function(r){r?this.Ff=hn(this.Ff,23):this.Ff=fn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,24)},set:function(r){r?this.Ff=hn(this.Ff,24):this.Ff=fn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,25)},set:function(r){r?this.Ff=hn(this.Ff,25):this.Ff=fn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,26)},set:function(r){r?this.Ff=hn(this.Ff,26):this.Ff=fn(this.Ff,26)}});var t=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return t},set:function(r){t=r}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return t},set:function(r){Number.isInteger(r)&&(t=r)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};ts(si,zs);var ll=function(){si.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!un(this.Ff,14)},set:function(t){t?this.Ff=hn(this.Ff,14):this.Ff=fn(this.Ff,14)}}),this.password=!0};ts(ll,si);var At={CheckBox:{createAppearanceStream:function(){return{N:{On:At.CheckBox.YesNormal},D:{On:At.CheckBox.YesPushDown,Off:At.CheckBox.OffPushDown}}},YesPushDown:function(t){var r=Ks(t);r.scope=t.scope;var e=[],s=t.scope.internal.getFont(t.fontName,t.fontStyle).id,i=t.scope.__private__.encodeColorString(t.color),a=Pc(t,t.caption);return e.push("0.749023 g"),e.push("0 0 "+Zt(At.internal.getWidth(t))+" "+Zt(At.internal.getHeight(t))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+s+" "+Zt(a.fontSize)+" Tf "+i),e.push("BT"),e.push(a.text),e.push("ET"),e.push("Q"),e.push("EMC"),r.stream=e.join(`
`),r},YesNormal:function(t){var r=Ks(t);r.scope=t.scope;var e=t.scope.internal.getFont(t.fontName,t.fontStyle).id,s=t.scope.__private__.encodeColorString(t.color),i=[],a=At.internal.getHeight(t),d=At.internal.getWidth(t),o=Pc(t,t.caption);return i.push("1 g"),i.push("0 0 "+Zt(d)+" "+Zt(a)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+Zt(d-1)+" "+Zt(a-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+e+" "+Zt(o.fontSize)+" Tf "+s),i.push(o.text),i.push("ET"),i.push("Q"),r.stream=i.join(`
`),r},OffPushDown:function(t){var r=Ks(t);r.scope=t.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Zt(At.internal.getWidth(t))+" "+Zt(At.internal.getHeight(t))+" re"),e.push("f"),r.stream=e.join(`
`),r}},RadioButton:{Circle:{createAppearanceStream:function(t){var r={D:{Off:At.RadioButton.Circle.OffPushDown},N:{}};return r.N[t]=At.RadioButton.Circle.YesNormal,r.D[t]=At.RadioButton.Circle.YesPushDown,r},getCA:function(){return"l"},YesNormal:function(t){var r=Ks(t);r.scope=t.scope;var e=[],s=At.internal.getWidth(t)<=At.internal.getHeight(t)?At.internal.getWidth(t)/4:At.internal.getHeight(t)/4;s=Number((.9*s).toFixed(5));var i=At.internal.Bezier_C,a=Number((s*i).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+Ua(At.internal.getWidth(t)/2)+" "+Ua(At.internal.getHeight(t)/2)+" cm"),e.push(s+" 0 m"),e.push(s+" "+a+" "+a+" "+s+" 0 "+s+" c"),e.push("-"+a+" "+s+" -"+s+" "+a+" -"+s+" 0 c"),e.push("-"+s+" -"+a+" -"+a+" -"+s+" 0 -"+s+" c"),e.push(a+" -"+s+" "+s+" -"+a+" "+s+" 0 c"),e.push("f"),e.push("Q"),r.stream=e.join(`
`),r},YesPushDown:function(t){var r=Ks(t);r.scope=t.scope;var e=[],s=At.internal.getWidth(t)<=At.internal.getHeight(t)?At.internal.getWidth(t)/4:At.internal.getHeight(t)/4;s=Number((.9*s).toFixed(5));var i=Number((2*s).toFixed(5)),a=Number((i*At.internal.Bezier_C).toFixed(5)),d=Number((s*At.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Ua(At.internal.getWidth(t)/2)+" "+Ua(At.internal.getHeight(t)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),e.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),e.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),e.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+Ua(At.internal.getWidth(t)/2)+" "+Ua(At.internal.getHeight(t)/2)+" cm"),e.push(s+" 0 m"),e.push(s+" "+d+" "+d+" "+s+" 0 "+s+" c"),e.push("-"+d+" "+s+" -"+s+" "+d+" -"+s+" 0 c"),e.push("-"+s+" -"+d+" -"+d+" -"+s+" 0 -"+s+" c"),e.push(d+" -"+s+" "+s+" -"+d+" "+s+" 0 c"),e.push("f"),e.push("Q"),r.stream=e.join(`
`),r},OffPushDown:function(t){var r=Ks(t);r.scope=t.scope;var e=[],s=At.internal.getWidth(t)<=At.internal.getHeight(t)?At.internal.getWidth(t)/4:At.internal.getHeight(t)/4;s=Number((.9*s).toFixed(5));var i=Number((2*s).toFixed(5)),a=Number((i*At.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Ua(At.internal.getWidth(t)/2)+" "+Ua(At.internal.getHeight(t)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),e.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),e.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),e.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),e.push("f"),e.push("Q"),r.stream=e.join(`
`),r}},Cross:{createAppearanceStream:function(t){var r={D:{Off:At.RadioButton.Cross.OffPushDown},N:{}};return r.N[t]=At.RadioButton.Cross.YesNormal,r.D[t]=At.RadioButton.Cross.YesPushDown,r},getCA:function(){return"8"},YesNormal:function(t){var r=Ks(t);r.scope=t.scope;var e=[],s=At.internal.calculateCross(t);return e.push("q"),e.push("1 1 "+Zt(At.internal.getWidth(t)-2)+" "+Zt(At.internal.getHeight(t)-2)+" re"),e.push("W"),e.push("n"),e.push(Zt(s.x1.x)+" "+Zt(s.x1.y)+" m"),e.push(Zt(s.x2.x)+" "+Zt(s.x2.y)+" l"),e.push(Zt(s.x4.x)+" "+Zt(s.x4.y)+" m"),e.push(Zt(s.x3.x)+" "+Zt(s.x3.y)+" l"),e.push("s"),e.push("Q"),r.stream=e.join(`
`),r},YesPushDown:function(t){var r=Ks(t);r.scope=t.scope;var e=At.internal.calculateCross(t),s=[];return s.push("0.749023 g"),s.push("0 0 "+Zt(At.internal.getWidth(t))+" "+Zt(At.internal.getHeight(t))+" re"),s.push("f"),s.push("q"),s.push("1 1 "+Zt(At.internal.getWidth(t)-2)+" "+Zt(At.internal.getHeight(t)-2)+" re"),s.push("W"),s.push("n"),s.push(Zt(e.x1.x)+" "+Zt(e.x1.y)+" m"),s.push(Zt(e.x2.x)+" "+Zt(e.x2.y)+" l"),s.push(Zt(e.x4.x)+" "+Zt(e.x4.y)+" m"),s.push(Zt(e.x3.x)+" "+Zt(e.x3.y)+" l"),s.push("s"),s.push("Q"),r.stream=s.join(`
`),r},OffPushDown:function(t){var r=Ks(t);r.scope=t.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Zt(At.internal.getWidth(t))+" "+Zt(At.internal.getHeight(t))+" re"),e.push("f"),r.stream=e.join(`
`),r}}},createDefaultAppearanceStream:function(t){var r=t.scope.internal.getFont(t.fontName,t.fontStyle).id,e=t.scope.__private__.encodeColorString(t.color);return"/"+r+" "+t.fontSize+" Tf "+e}};At.internal={Bezier_C:.551915024494,calculateCross:function(t){var r=At.internal.getWidth(t),e=At.internal.getHeight(t),s=Math.min(r,e);return{x1:{x:(r-s)/2,y:(e-s)/2+s},x2:{x:(r-s)/2+s,y:(e-s)/2},x3:{x:(r-s)/2,y:(e-s)/2},x4:{x:(r-s)/2+s,y:(e-s)/2+s}}}},At.internal.getWidth=function(t){var r=0;return kr(t)==="object"&&(r=Wu(t.Rect[2])),r},At.internal.getHeight=function(t){var r=0;return kr(t)==="object"&&(r=Wu(t.Rect[3])),r};var y2=en.addField=function(t){if(x2(this,t),!(t instanceof zs))throw new Error("Invalid argument passed to jsPDF.addField.");var r;return(r=t).scope.internal.acroformPlugin.printedOut&&(r.scope.internal.acroformPlugin.printedOut=!1,r.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),r.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(r),t.page=t.scope.internal.getCurrentPageInfo().pageNumber,this};en.AcroFormChoiceField=Oi,en.AcroFormListBox=Di,en.AcroFormComboBox=Ri,en.AcroFormEditBox=al,en.AcroFormButton=jn,en.AcroFormPushButton=il,en.AcroFormRadioButton=Bi,en.AcroFormCheckBox=ol,en.AcroFormTextField=si,en.AcroFormPasswordField=ll,en.AcroFormAppearance=At,en.AcroForm={ChoiceField:Oi,ListBox:Di,ComboBox:Ri,EditBox:al,Button:jn,PushButton:il,RadioButton:Bi,CheckBox:ol,TextField:si,PasswordField:ll,Appearance:At},Mt.AcroForm={ChoiceField:Oi,ListBox:Di,ComboBox:Ri,EditBox:al,Button:jn,PushButton:il,RadioButton:Bi,CheckBox:ol,TextField:si,PasswordField:ll,Appearance:At};Mt.AcroForm;function Qf(t){return t.reduce(function(r,e,s){return r[e]=s,r},{})}(function(t){var r="addImage_";t.__addimage__={};var e="UNKNOWN",s={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=t.__addimage__.getImageFileTypeByImageData=function(I,k){var D,v,te,ce,re,se=e;if((k=k||e)==="RGBA"||I.data!==void 0&&I.data instanceof Uint8ClampedArray&&"height"in I&&"width"in I)return"RGBA";if(Z(I))for(re in s)for(te=s[re],D=0;D<te.length;D+=1){for(ce=!0,v=0;v<te[D].length;v+=1)if(te[D][v]!==void 0&&te[D][v]!==I[v]){ce=!1;break}if(ce===!0){se=re;break}}else for(re in s)for(te=s[re],D=0;D<te.length;D+=1){for(ce=!0,v=0;v<te[D].length;v+=1)if(te[D][v]!==void 0&&te[D][v]!==I.charCodeAt(v)){ce=!1;break}if(ce===!0){se=re;break}}return se===e&&k!==e&&(se=k),se},a=function I(k){for(var D=this.internal.write,v=this.internal.putStream,te=(0,this.internal.getFilters)();te.indexOf("FlateEncode")!==-1;)te.splice(te.indexOf("FlateEncode"),1);k.objectId=this.internal.newObject();var ce=[];if(ce.push({key:"Type",value:"/XObject"}),ce.push({key:"Subtype",value:"/Image"}),ce.push({key:"Width",value:k.width}),ce.push({key:"Height",value:k.height}),k.colorSpace===y.INDEXED?ce.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(k.palette.length/3-1)+" "+("sMask"in k&&k.sMask!==void 0?k.objectId+2:k.objectId+1)+" 0 R]"}):(ce.push({key:"ColorSpace",value:"/"+k.colorSpace}),k.colorSpace===y.DEVICE_CMYK&&ce.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ce.push({key:"BitsPerComponent",value:k.bitsPerComponent}),"decodeParameters"in k&&k.decodeParameters!==void 0&&ce.push({key:"DecodeParms",value:"<<"+k.decodeParameters+">>"}),"transparency"in k&&Array.isArray(k.transparency)&&k.transparency.length>0){for(var re="",se=0,le=k.transparency.length;se<le;se++)re+=k.transparency[se]+" "+k.transparency[se]+" ";ce.push({key:"Mask",value:"["+re+"]"})}k.sMask!==void 0&&ce.push({key:"SMask",value:k.objectId+1+" 0 R"});var Se=k.filter!==void 0?["/"+k.filter]:void 0;if(v({data:k.data,additionalKeyValues:ce,alreadyAppliedFilters:Se,objectId:k.objectId}),D("endobj"),"sMask"in k&&k.sMask!==void 0){var ne,C=(ne=k.sMaskBitsPerComponent)!==null&&ne!==void 0?ne:k.bitsPerComponent,H={width:k.width,height:k.height,colorSpace:"DeviceGray",bitsPerComponent:C,data:k.sMask};"filter"in k&&(H.decodeParameters="/Predictor ".concat(k.predictor," /Colors 1 /BitsPerComponent ").concat(C," /Columns ").concat(k.width),H.filter=k.filter),I.call(this,H)}if(k.colorSpace===y.INDEXED){var K=this.internal.newObject();v({data:G(new Uint8Array(k.palette)),objectId:K}),D("endobj")}},d=function(){var I=this.internal.collections[r+"images"];for(var k in I)a.call(this,I[k])},o=function(){var I,k=this.internal.collections[r+"images"],D=this.internal.write;for(var v in k)D("/I"+(I=k[v]).index,I.objectId,"0","R")},c=function(){this.internal.collections[r+"images"]||(this.internal.collections[r+"images"]={},this.internal.events.subscribe("putResources",d),this.internal.events.subscribe("putXobjectDict",o))},h=function(){var I=this.internal.collections[r+"images"];return c.call(this),I},p=function(){return Object.keys(this.internal.collections[r+"images"]).length},b=function(I){return typeof t["process"+I.toUpperCase()]=="function"},m=function(I){return kr(I)==="object"&&I.nodeType===1},u=function(I,k){if(I.nodeName==="IMG"&&I.hasAttribute("src")){var D=""+I.getAttribute("src");if(D.indexOf("data:image/")===0)return sl(unescape(D).split("base64,").pop());var v=t.loadFile(D,!0);if(v!==void 0)return v}if(I.nodeName==="CANVAS"){if(I.width===0||I.height===0)throw new Error("Given canvas must have data. Canvas width: "+I.width+", height: "+I.height);var te;switch(k){case"PNG":te="image/png";break;case"WEBP":te="image/webp";break;default:te="image/jpeg"}return sl(I.toDataURL(te,1).split("base64,").pop())}},w=function(I){var k=this.internal.collections[r+"images"];if(k){for(var D in k)if(I===k[D].alias)return k[D]}},g=function(I,k,D){return I||k||(I=-96,k=-96),I<0&&(I=-1*D.width*72/I/this.internal.scaleFactor),k<0&&(k=-1*D.height*72/k/this.internal.scaleFactor),I===0&&(I=k*D.width/D.height),k===0&&(k=I*D.height/D.width),[I,k]},_=function(I,k,D,v,te,ce){var re=g.call(this,D,v,te),se=this.internal.getCoordinateString,le=this.internal.getVerticalCoordinateString,Se=h.call(this);if(D=re[0],v=re[1],Se[te.index]=te,ce){ce*=Math.PI/180;var ne=Math.cos(ce),C=Math.sin(ce),H=function(X){return X.toFixed(4)},K=[H(ne),H(C),H(-1*C),H(ne),0,0,"cm"]}this.internal.write("q"),ce?(this.internal.write([1,"0","0",1,se(I),le(k+v),"cm"].join(" ")),this.internal.write(K.join(" ")),this.internal.write([se(D),"0","0",se(v),"0","0","cm"].join(" "))):this.internal.write([se(D),"0","0",se(v),se(I),le(k+v),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+te.index+" Do"),this.internal.write("Q")},y=t.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};t.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var A=t.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},L=t.__addimage__.sHashCode=function(I){var k,D,v=0;if(typeof I=="string")for(D=I.length,k=0;k<D;k++)v=(v<<5)-v+I.charCodeAt(k),v|=0;else if(Z(I))for(D=I.byteLength/2,k=0;k<D;k++)v=(v<<5)-v+I[k],v|=0;return v},E=t.__addimage__.validateStringAsBase64=function(I){(I=I||"").toString().trim();var k=!0;return I.length===0&&(k=!1),I.length%4!=0&&(k=!1),/^[A-Za-z0-9+/]+$/.test(I.substr(0,I.length-2))===!1&&(k=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(I.substr(-2))===!1&&(k=!1),k},F=t.__addimage__.extractImageFromDataUrl=function(I){if(I==null||!(I=I.trim()).startsWith("data:"))return null;var k=I.indexOf(",");return k<0?null:I.substring(0,k).trim().endsWith("base64")?I.substring(k+1):null};t.__addimage__.isArrayBuffer=function(I){return I instanceof ArrayBuffer};var Z=t.__addimage__.isArrayBufferView=function(I){return I instanceof Int8Array||I instanceof Uint8Array||I instanceof Uint8ClampedArray||I instanceof Int16Array||I instanceof Uint16Array||I instanceof Int32Array||I instanceof Uint32Array||I instanceof Float32Array||I instanceof Float64Array},Y=t.__addimage__.binaryStringToUint8Array=function(I){for(var k=I.length,D=new Uint8Array(k),v=0;v<k;v++)D[v]=I.charCodeAt(v);return D},G=t.__addimage__.arrayBufferToBinaryString=function(I){for(var k="",D=Z(I)?I:new Uint8Array(I),v=0;v<D.length;v+=8192)k+=String.fromCharCode.apply(null,D.subarray(v,v+8192));return k};t.addImage=function(){var I,k,D,v,te,ce,re,se,le;if(typeof arguments[1]=="number"?(k=e,D=arguments[1],v=arguments[2],te=arguments[3],ce=arguments[4],re=arguments[5],se=arguments[6],le=arguments[7]):(k=arguments[1],D=arguments[2],v=arguments[3],te=arguments[4],ce=arguments[5],re=arguments[6],se=arguments[7],le=arguments[8]),kr(I=arguments[0])==="object"&&!m(I)&&"imageData"in I){var Se=I;I=Se.imageData,k=Se.format||k||e,D=Se.x||D||0,v=Se.y||v||0,te=Se.w||Se.width||te,ce=Se.h||Se.height||ce,re=Se.alias||re,se=Se.compression||se,le=Se.rotation||Se.angle||le}var ne=this.internal.getFilters();if(se===void 0&&ne.indexOf("FlateEncode")!==-1&&(se="SLOW"),isNaN(D)||isNaN(v))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var C=O.call(this,I,k,re,se);return _.call(this,D,v,te,ce,C,le),this};var O=function(I,k,D,v){var te,ce,re;if(typeof I=="string"&&i(I)===e){I=unescape(I);var se=Q(I,!1);(se!==""||(se=t.loadFile(I,!0))!==void 0)&&(I=se)}if(m(I)&&(I=u(I,k)),k=i(I,k),!b(k))throw new Error("addImage does not support files of type '"+k+"', please ensure that a plugin for '"+k+"' support is added.");if(((re=D)==null||re.length===0)&&(D=(function(le){return typeof le=="string"||Z(le)?L(le):Z(le.data)?L(le.data):null})(I)),(te=w.call(this,D))||(I instanceof Uint8Array||k==="RGBA"||(ce=I,I=Y(I)),te=this["process"+k.toUpperCase()](I,p.call(this),D,(function(le){return le&&typeof le=="string"&&(le=le.toUpperCase()),le in t.image_compression?le:A.NONE})(v),ce)),!te)throw new Error("An unknown error occurred whilst processing the image.");return te},Q=t.__addimage__.convertBase64ToBinaryString=function(I,k){k=typeof k!="boolean"||k;var D,v="";if(typeof I=="string"){var te;D=(te=F(I))!==null&&te!==void 0?te:I;try{v=sl(D)}catch(ce){if(k)throw E(D)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ce.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return v};t.getImageProperties=function(I){var k,D,v="";if(m(I)&&(I=u(I)),typeof I=="string"&&i(I)===e&&((v=Q(I,!1))===""&&(v=t.loadFile(I)||""),I=v),D=i(I),!b(D))throw new Error("addImage does not support files of type '"+D+"', please ensure that a plugin for '"+D+"' support is added.");if(I instanceof Uint8Array||(I=Y(I)),!(k=this["process"+D.toUpperCase()](I)))throw new Error("An unknown error occurred whilst processing the image");return k.fileType=D,k}})(Mt.API),(function(t){var r=function(e){if(e!==void 0&&e!="")return!0};Mt.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),t.events.push(["putPage",function(e){for(var s,i,a,d=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(e.objId),h=e.pageContext.annotations,p=!1,b=0;b<h.length&&!p;b++)switch((s=h[b]).type){case"link":(r(s.options.url)||r(s.options.pageNumber))&&(p=!0);break;case"reference":case"text":case"freetext":p=!0}if(p!=0){this.internal.write("/Annots [");for(var m=0;m<h.length;m++){s=h[m];var u=this.internal.pdfEscape,w=this.internal.getEncryptor(e.objId);switch(s.type){case"reference":this.internal.write(" "+s.object.objId+" 0 R ");break;case"text":var g=this.internal.newAdditionalObject(),_=this.internal.newAdditionalObject(),y=this.internal.getEncryptor(g.objId),A=s.title||"Note";a="<</Type /Annot /Subtype /Text "+(i="/Rect ["+d(s.bounds.x)+" "+o(s.bounds.y+s.bounds.h)+" "+d(s.bounds.x+s.bounds.w)+" "+o(s.bounds.y)+"] ")+"/Contents ("+u(y(s.contents))+")",a+=" /Popup "+_.objId+" 0 R",a+=" /P "+c.objId+" 0 R",a+=" /T ("+u(y(A))+") >>",g.content=a;var L=g.objId+" 0 R";a="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+d(s.bounds.x+30)+" "+o(s.bounds.y+s.bounds.h)+" "+d(s.bounds.x+s.bounds.w+30)+" "+o(s.bounds.y)+"] ")+" /Parent "+L,s.open&&(a+=" /Open true"),a+=" >>",_.content=a,this.internal.write(g.objId,"0 R",_.objId,"0 R");break;case"freetext":i="/Rect ["+d(s.bounds.x)+" "+o(s.bounds.y)+" "+d(s.bounds.x+s.bounds.w)+" "+o(s.bounds.y+s.bounds.h)+"] ";var E=s.color||"#000000";a="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+u(w(s.contents))+")",a+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+E+")",a+=" /Border [0 0 0]",a+=" >>",this.internal.write(a);break;case"link":if(s.options.name){var F=this.annotations._nameMap[s.options.name];s.options.pageNumber=F.page,s.options.top=F.y}else s.options.top||(s.options.top=0);if(i="/Rect ["+s.finalBounds.x+" "+s.finalBounds.y+" "+s.finalBounds.w+" "+s.finalBounds.h+"] ",a="",s.options.url)a="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+u(w(s.options.url))+") >>";else if(s.options.pageNumber)switch(a="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(s.options.pageNumber).objId+" 0 R",s.options.magFactor=s.options.magFactor||"XYZ",s.options.magFactor){case"Fit":a+=" /Fit]";break;case"FitH":a+=" /FitH "+s.options.top+"]";break;case"FitV":s.options.left=s.options.left||0,a+=" /FitV "+s.options.left+"]";break;default:var Z=o(s.options.top);s.options.left=s.options.left||0,s.options.zoom===void 0&&(s.options.zoom=0),a+=" /XYZ "+s.options.left+" "+Z+" "+s.options.zoom+"]"}a!=""&&(a+=" >>",this.internal.write(a))}}this.internal.write("]")}}]),t.createAnnotation=function(e){var s=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":s.pageContext.annotations.push(e)}},t.link=function(e,s,i,a,d){var o=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,h=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:c(e),y:h(s),w:c(e+i),h:h(s+a)},options:d,type:"link"})},t.textWithLink=function(e,s,i,a){var d,o,c=this.getTextWidth(e),h=this.internal.getLineHeight()/this.internal.scaleFactor;if(a.maxWidth!==void 0){o=a.maxWidth;var p=this.splitTextToSize(e,o).length;d=Math.ceil(h*p)}else o=c,d=h;return this.text(e,s,i,a),i+=.2*h,a.align==="center"&&(s-=c/2),a.align==="right"&&(s-=c),this.link(s,i-h,o,d,a),c},t.getTextWidth=function(e){var s=this.internal.getFontSize();return this.getStringUnitWidth(e)*s/this.internal.scaleFactor}})(Mt.API),(function(t){var r={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},s={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];t.__arabicParser__={};var a=t.__arabicParser__.isInArabicSubstitutionA=function(g){return r[g.charCodeAt(0)]!==void 0},d=t.__arabicParser__.isArabicLetter=function(g){return typeof g=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(g)},o=t.__arabicParser__.isArabicEndLetter=function(g){return d(g)&&a(g)&&r[g.charCodeAt(0)].length<=2},c=t.__arabicParser__.isArabicAlfLetter=function(g){return d(g)&&i.indexOf(g.charCodeAt(0))>=0};t.__arabicParser__.arabicLetterHasIsolatedForm=function(g){return d(g)&&a(g)&&r[g.charCodeAt(0)].length>=1};var h=t.__arabicParser__.arabicLetterHasFinalForm=function(g){return d(g)&&a(g)&&r[g.charCodeAt(0)].length>=2};t.__arabicParser__.arabicLetterHasInitialForm=function(g){return d(g)&&a(g)&&r[g.charCodeAt(0)].length>=3};var p=t.__arabicParser__.arabicLetterHasMedialForm=function(g){return d(g)&&a(g)&&r[g.charCodeAt(0)].length==4},b=t.__arabicParser__.resolveLigatures=function(g){var _=0,y=e,A="",L=0;for(_=0;_<g.length;_+=1)y[g.charCodeAt(_)]!==void 0?(L++,typeof(y=y[g.charCodeAt(_)])=="number"&&(A+=String.fromCharCode(y),y=e,L=0),_===g.length-1&&(y=e,A+=g.charAt(_-(L-1)),_-=L-1,L=0)):(y=e,A+=g.charAt(_-L),_-=L,L=0);return A};t.__arabicParser__.isArabicDiacritic=function(g){return g!==void 0&&s[g.charCodeAt(0)]!==void 0};var m=t.__arabicParser__.getCorrectForm=function(g,_,y){return d(g)?a(g)===!1?-1:!h(g)||!d(_)&&!d(y)||!d(y)&&o(_)||o(g)&&!d(_)||o(g)&&c(_)||o(g)&&o(_)?0:p(g)&&d(_)&&!o(_)&&d(y)&&h(y)?3:o(g)||!d(y)?1:2:-1},u=function(g){var _=0,y=0,A=0,L="",E="",F="",Z=(g=g||"").split("\\s+"),Y=[];for(_=0;_<Z.length;_+=1){for(Y.push(""),y=0;y<Z[_].length;y+=1)L=Z[_][y],E=Z[_][y-1],F=Z[_][y+1],d(L)?(A=m(L,E,F),Y[_]+=A!==-1?String.fromCharCode(r[L.charCodeAt(0)][A]):L):Y[_]+=L;Y[_]=b(Y[_])}return Y.join(" ")},w=t.__arabicParser__.processArabic=t.processArabic=function(){var g,_=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,y=[];if(Array.isArray(_)){var A=0;for(y=[],A=0;A<_.length;A+=1)Array.isArray(_[A])?y.push([u(_[A][0]),_[A][1],_[A][2]]):y.push([u(_[A])]);g=y}else g=u(_);return typeof arguments[0]=="string"?g:(arguments[0].text=g,arguments[0])};t.events.push(["preProcessText",w])})(Mt.API),Mt.API.autoPrint=function(t){var r;return(t=t||{}).variant=t.variant||"non-conform",t.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){r=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+r+" 0 R")})),this},(function(t){var r=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(o){e=o}});var s=150;Object.defineProperty(this,"width",{get:function(){return s},set:function(o){s=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=s+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var a=[];Object.defineProperty(this,"childNodes",{get:function(){return a},set:function(o){a=o}});var d={};Object.defineProperty(this,"style",{get:function(){return d},set:function(o){d=o}}),Object.defineProperty(this,"parentNode",{})};r.prototype.getContext=function(e,s){var i;if((e=e||"2d")!=="2d")return null;for(i in s)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=s[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},r.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},t.events.push(["initialized",function(){this.canvas=new r,this.canvas.pdf=this}])})(Mt.API),(function(t){var r={left:0,top:0,bottom:0,right:0},e=!1,s=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},r),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new a,this.internal.__cell__.pages=1},a=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(g){c=g}});var h=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return h},set:function(g){h=g}});var p=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return p},set:function(g){p=g}});var b=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return b},set:function(g){b=g}});var m=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return m},set:function(g){m=g}});var u=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return u},set:function(g){u=g}});var w=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return w},set:function(g){w=g}}),this};a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},a.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},t.setHeaderFunction=function(c){return s.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},t.getTextDimensions=function(c,h){s.call(this);var p=(h=h||{}).fontSize||this.getFontSize(),b=h.font||this.getFont(),m=h.scaleFactor||this.internal.scaleFactor,u=0,w=0,g=0,_=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var y=h.maxWidth;y>0?typeof c=="string"?c=this.splitTextToSize(c,y):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(L,E){return L.concat(_.splitTextToSize(E,y))},[])):c=Array.isArray(c)?c:[c];for(var A=0;A<c.length;A++)u<(g=this.getStringUnitWidth(c[A],{font:b})*p)&&(u=g);return u!==0&&(w=c.length),{w:u/=m,h:Math.max((w*p*this.getLineHeightFactor()-p*(this.getLineHeightFactor()-1))/m,0)}},t.cellAddPage=function(){s.call(this),this.addPage();var c=this.internal.__cell__.margins||r;return this.internal.__cell__.lastCell=new a(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var d=t.cell=function(){var c;c=arguments[0]instanceof a?arguments[0]:new a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),s.call(this);var h=this.internal.__cell__.lastCell,p=this.internal.__cell__.padding,b=this.internal.__cell__.margins||r,m=this.internal.__cell__.tableHeaderRow,u=this.internal.__cell__.printHeaders;return h.lineNumber!==void 0&&(h.lineNumber===c.lineNumber?(c.x=(h.x||0)+(h.width||0),c.y=h.y||0):h.y+h.height+c.height+b.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=b.top,u&&m&&(this.printHeaderRow(c.lineNumber,!0),c.y+=m[0].height)):c.y=h.y+h.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,e===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-p,c.y+p,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+p,{align:"center",baseline:"top",maxWidth:c.width-p-p}):this.text(c.text,c.x+p,c.y+p,{align:"left",baseline:"top",maxWidth:c.width-p-p})),this.internal.__cell__.lastCell=c,this};t.table=function(c,h,p,b,m){if(s.call(this),!p)throw new Error("No data for PDF table.");var u,w,g,_,y=[],A=[],L=[],E={},F={},Z=[],Y=[],G=(m=m||{}).autoSize||!1,O=m.printHeaders!==!1,Q=m.css&&m.css["font-size"]!==void 0?16*m.css["font-size"]:m.fontSize||12,I=m.margins||Object.assign({width:this.getPageWidth()},r),k=typeof m.padding=="number"?m.padding:3,D=m.headerBackgroundColor||"#c8c8c8",v=m.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=O,this.internal.__cell__.margins=I,this.internal.__cell__.table_font_size=Q,this.internal.__cell__.padding=k,this.internal.__cell__.headerBackgroundColor=D,this.internal.__cell__.headerTextColor=v,this.setFontSize(Q),b==null)A=y=Object.keys(p[0]),L=y.map(function(){return"left"});else if(Array.isArray(b)&&kr(b[0])==="object")for(y=b.map(function(Se){return Se.name}),A=b.map(function(Se){return Se.prompt||Se.name||""}),L=b.map(function(Se){return Se.align||"left"}),u=0;u<b.length;u+=1)F[b[u].name]=.7499990551181103*b[u].width;else Array.isArray(b)&&typeof b[0]=="string"&&(A=y=b,L=y.map(function(){return"left"}));if(G||Array.isArray(b)&&typeof b[0]=="string")for(u=0;u<y.length;u+=1){for(E[_=y[u]]=p.map(function(Se){return Se[_]}),this.setFont(void 0,"bold"),Z.push(this.getTextDimensions(A[u],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),w=E[_],this.setFont(void 0,"normal"),g=0;g<w.length;g+=1)Z.push(this.getTextDimensions(w[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);F[_]=Math.max.apply(null,Z)+k+k,Z=[]}if(O){var te={};for(u=0;u<y.length;u+=1)te[y[u]]={},te[y[u]].text=A[u],te[y[u]].align=L[u];var ce=o.call(this,te,F);Y=y.map(function(Se){return new a(c,h,F[Se],ce,te[Se].text,void 0,te[Se].align)}),this.setTableHeaderRow(Y),this.printHeaderRow(1,!1)}var re=b.reduce(function(Se,ne){return Se[ne.name]=ne.align,Se},{});for(u=0;u<p.length;u+=1){"rowStart"in m&&m.rowStart instanceof Function&&m.rowStart({row:u,data:p[u]},this);var se=o.call(this,p[u],F);for(g=0;g<y.length;g+=1){var le=p[u][y[g]];"cellStart"in m&&m.cellStart instanceof Function&&m.cellStart({row:u,col:g,data:le},this),d.call(this,new a(c,h,F[y[g]],se,le,u+2,re[y[g]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=h,this};var o=function(c,h){var p=this.internal.__cell__.padding,b=this.internal.__cell__.table_font_size,m=this.internal.scaleFactor;return Object.keys(c).map(function(u){var w=c[u];return this.splitTextToSize(w.hasOwnProperty("text")?w.text:w,h[u]-p-p)},this).map(function(u){return this.getLineHeightFactor()*u.length*b/m+p+p},this).reduce(function(u,w){return Math.max(u,w)},0)};t.setTableHeaderRow=function(c){s.call(this),this.internal.__cell__.tableHeaderRow=c},t.printHeaderRow=function(c,h){if(s.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var p;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var b=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new a(b[0],b[1],b[2],b[3],void 0,-1)}this.setFont(void 0,"bold");for(var m=[],u=0;u<this.internal.__cell__.tableHeaderRow.length;u+=1){p=this.internal.__cell__.tableHeaderRow[u].clone(),h&&(p.y=this.internal.__cell__.margins.top||0,m.push(p)),p.lineNumber=c;var w=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),d.call(this,p),this.setTextColor(w)}m.length>0&&this.setTableHeaderRow(m),this.setFont(void 0,"normal"),e=!1}})(Mt.API);var ep={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},tp=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Tc=Qf(tp),rp=[100,200,300,400,500,600,700,800,900],b2=Qf(rp);function hc(t){var r=t.family.replace(/"|'/g,"").toLowerCase(),e=(function(a){return ep[a=a||"normal"]?a:"normal"})(t.style),s=(function(a){return a?typeof a=="number"?a>=100&&a<=900&&a%100==0?a:400:/^\d00$/.test(a)?parseInt(a):a==="bold"?700:400:400})(t.weight),i=(function(a){return typeof Tc[a=a||"normal"]=="number"?a:"normal"})(t.stretch);return{family:r,style:e,weight:s,stretch:i,src:t.src||[],ref:t.ref||{name:r,style:[i,e,s].join(" ")}}}function Hu(t,r,e,s){var i;for(i=e;i>=0&&i<r.length;i+=s)if(t[r[i]])return t[r[i]];for(i=e;i>=0&&i<r.length;i-=s)if(t[r[i]])return t[r[i]]}var w2={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Gu={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function Vu(t){return[t.stretch,t.style,t.weight,t.family].join(" ")}function Yu(t){return t.trimLeft()}function v2(t,r){for(var e=0;e<t.length;){if(t.charAt(e)===r)return[t.substring(0,e),t.substring(e+1)];e+=1}return null}function N2(t){var r=t.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return r===null?null:[r[0],t.substring(r[0].length)]}var Xo,Ju,Ku,ki,Qo,Zu,Xu,Qu,fc=["times"];function eh(t,r,e,s,i){var a=4,d=rh;switch(i){case Mt.API.image_compression.FAST:a=1,d=th;break;case Mt.API.image_compression.MEDIUM:a=6,d=nh;break;case Mt.API.image_compression.SLOW:a=9,d=sh}t=(function(c,h,p,b){for(var m,u=c.length/h,w=new Uint8Array(c.length+u),g=[_2,th,rh,nh,sh],_=0;_<u;_+=1){var y=_*h,A=c.subarray(y,y+h);if(b)w.set(b(A,p,m),y+_);else{for(var L=g.length,E=[],F=0;F<L;F+=1)E[F]=g[F](A,p,m);var Z=S2(E.concat());w.set(E[Z],y+_)}m=A}return w})(t,r,Math.ceil(e*s/8),d);var o=Sc(t,{level:a});return Mt.API.__addimage__.arrayBufferToBinaryString(o)}function _2(t){var r=Array.apply([],t);return r.unshift(0),r}function th(t,r){var e=t.length,s=[];s[0]=1;for(var i=0;i<e;i+=1){var a=t[i-r]||0;s[i+1]=t[i]-a+256&255}return s}function rh(t,r,e){var s=t.length,i=[];i[0]=2;for(var a=0;a<s;a+=1){var d=e&&e[a]||0;i[a+1]=t[a]-d+256&255}return i}function nh(t,r,e){var s=t.length,i=[];i[0]=3;for(var a=0;a<s;a+=1){var d=t[a-r]||0,o=e&&e[a]||0;i[a+1]=t[a]+256-(d+o>>>1)&255}return i}function sh(t,r,e){var s=t.length,i=[];i[0]=4;for(var a=0;a<s;a+=1){var d=j2(t[a-r]||0,e&&e[a]||0,e&&e[a-r]||0);i[a+1]=t[a]-d+256&255}return i}function j2(t,r,e){if(t===r&&r===e)return t;var s=Math.abs(r-e),i=Math.abs(t-e),a=Math.abs(t+r-e-e);return s<=i&&s<=a?t:i<=a?r:e}function S2(t){var r=t.map(function(e){return e.reduce(function(s,i){return s+Math.abs(i)},0)});return r.indexOf(Math.min.apply(null,r))}function pc(t,r,e){var s=r*e,i=Math.floor(s/8),a=16-(s-8*i+e),d=(1<<e)-1;return np(t,i)>>a&d}function ah(t,r,e,s){var i=e*s,a=Math.floor(i/8),d=16-(i-8*a+s),o=(1<<s)-1,c=(r&o)<<d;(function(h,p,b){if(p+1<h.byteLength)h.setUint16(p,b,!1);else{var m=b>>8&255;h.setUint8(p,m)}})(t,a,np(t,a)&~(o<<d)&65535|c)}function np(t,r){return r+1<t.byteLength?t.getUint16(r,!1):t.getUint8(r)<<8}function k2(t){var r=0;if(t[r++]!==71||t[r++]!==73||t[r++]!==70||t[r++]!==56||(t[r++]+1&253)!=56||t[r++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=t[r++]|t[r++]<<8,s=t[r++]|t[r++]<<8,i=t[r++],a=i>>7,d=1<<1+(7&i);t[r++],t[r++];var o=null,c=null;a&&(o=r,c=d,r+=3*d);var h=!0,p=[],b=0,m=null,u=0,w=null;for(this.width=e,this.height=s;h&&r<t.length;)switch(t[r++]){case 33:switch(t[r++]){case 255:if(t[r]!==11||t[r+1]==78&&t[r+2]==69&&t[r+3]==84&&t[r+4]==83&&t[r+5]==67&&t[r+6]==65&&t[r+7]==80&&t[r+8]==69&&t[r+9]==50&&t[r+10]==46&&t[r+11]==48&&t[r+12]==3&&t[r+13]==1&&t[r+16]==0)r+=14,w=t[r++]|t[r++]<<8,r++;else for(r+=12;;){if(!((I=t[r++])>=0))throw Error("Invalid block size");if(I===0)break;r+=I}break;case 249:if(t[r++]!==4||t[r+4]!==0)throw new Error("Invalid graphics extension block.");var g=t[r++];b=t[r++]|t[r++]<<8,m=t[r++],1&g||(m=null),u=g>>2&7,r++;break;case 254:for(;;){if(!((I=t[r++])>=0))throw Error("Invalid block size");if(I===0)break;r+=I}break;default:throw new Error("Unknown graphic control label: 0x"+t[r-1].toString(16))}break;case 44:var _=t[r++]|t[r++]<<8,y=t[r++]|t[r++]<<8,A=t[r++]|t[r++]<<8,L=t[r++]|t[r++]<<8,E=t[r++],F=E>>6&1,Z=1<<1+(7&E),Y=o,G=c,O=!1;E>>7&&(O=!0,Y=r,G=Z,r+=3*Z);var Q=r;for(r++;;){var I;if(!((I=t[r++])>=0))throw Error("Invalid block size");if(I===0)break;r+=I}p.push({x:_,y,width:A,height:L,has_local_palette:O,palette_offset:Y,palette_size:G,data_offset:Q,data_length:r-Q,transparent_index:m,interlaced:!!F,delay:b,disposal:u});break;case 59:h=!1;break;default:throw new Error("Unknown gif block: 0x"+t[r-1].toString(16))}this.numFrames=function(){return p.length},this.loopCount=function(){return w},this.frameInfo=function(k){if(k<0||k>=p.length)throw new Error("Frame index out of range.");return p[k]},this.decodeAndBlitFrameBGRA=function(k,D){var v=this.frameInfo(k),te=v.width*v.height,ce=new Uint8Array(te);ih(t,v.data_offset,ce,te);var re=v.palette_offset,se=v.transparent_index;se===null&&(se=256);var le=v.width,Se=e-le,ne=le,C=4*(v.y*e+v.x),H=4*((v.y+v.height)*e+v.x),K=C,X=4*Se;v.interlaced===!0&&(X+=4*e*7);for(var pe=8,ve=0,ke=ce.length;ve<ke;++ve){var Ae=ce[ve];if(ne===0&&(ne=le,(K+=X)>=H&&(X=4*Se+4*e*(pe-1),K=C+(le+Se)*(pe<<1),pe>>=1)),Ae===se)K+=4;else{var Re=t[re+3*Ae],Me=t[re+3*Ae+1],Ke=t[re+3*Ae+2];D[K++]=Ke,D[K++]=Me,D[K++]=Re,D[K++]=255}--ne}},this.decodeAndBlitFrameRGBA=function(k,D){var v=this.frameInfo(k),te=v.width*v.height,ce=new Uint8Array(te);ih(t,v.data_offset,ce,te);var re=v.palette_offset,se=v.transparent_index;se===null&&(se=256);var le=v.width,Se=e-le,ne=le,C=4*(v.y*e+v.x),H=4*((v.y+v.height)*e+v.x),K=C,X=4*Se;v.interlaced===!0&&(X+=4*e*7);for(var pe=8,ve=0,ke=ce.length;ve<ke;++ve){var Ae=ce[ve];if(ne===0&&(ne=le,(K+=X)>=H&&(X=4*Se+4*e*(pe-1),K=C+(le+Se)*(pe<<1),pe>>=1)),Ae===se)K+=4;else{var Re=t[re+3*Ae],Me=t[re+3*Ae+1],Ke=t[re+3*Ae+2];D[K++]=Re,D[K++]=Me,D[K++]=Ke,D[K++]=255}--ne}}}function ih(t,r,e,s){for(var i=t[r++],a=1<<i,d=a+1,o=d+1,c=i+1,h=(1<<c)-1,p=0,b=0,m=0,u=t[r++],w=new Int32Array(4096),g=null;;){for(;p<16&&u!==0;)b|=t[r++]<<p,p+=8,u===1?u=t[r++]:--u;if(p<c)break;var _=b&h;if(b>>=c,p-=c,_!==a){if(_===d)break;for(var y=_<o?_:g,A=0,L=y;L>a;)L=w[L]>>8,++A;var E=L;if(m+A+(y!==_?1:0)>s)return void Tr.log("Warning, gif stream longer than expected.");e[m++]=E;var F=m+=A;for(y!==_&&(e[m++]=E),L=y;A--;)L=w[L],e[--F]=255&L,L>>=8;g!==null&&o<4096&&(w[o++]=g<<8|E,o>=h+1&&c<12&&(++c,h=h<<1|1)),g=_}else o=d+1,h=(1<<(c=i+1))-1,g=null}return m!==s&&Tr.log("Warning, gif stream shorter than expected."),e}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function mc(t){var r,e,s,i,a,d=Math.floor,o=new Array(64),c=new Array(64),h=new Array(64),p=new Array(64),b=new Array(65535),m=new Array(65535),u=new Array(64),w=new Array(64),g=[],_=0,y=7,A=new Array(64),L=new Array(64),E=new Array(64),F=new Array(256),Z=new Array(2048),Y=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],G=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],O=[0,1,2,3,4,5,6,7,8,9,10,11],Q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],I=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],k=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],D=[0,1,2,3,4,5,6,7,8,9,10,11],v=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],te=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ce(C,H){for(var K=0,X=0,pe=new Array,ve=1;ve<=16;ve++){for(var ke=1;ke<=C[ve];ke++)pe[H[X]]=[],pe[H[X]][0]=K,pe[H[X]][1]=ve,X++,K++;K*=2}return pe}function re(C){for(var H=C[0],K=C[1]-1;K>=0;)H&1<<K&&(_|=1<<y),K--,--y<0&&(_==255?(se(255),se(0)):se(_),y=7,_=0)}function se(C){g.push(C)}function le(C){se(C>>8&255),se(255&C)}function Se(C,H,K,X,pe){for(var ve,ke=pe[0],Ae=pe[240],Re=(function(M,he){var me,de,Le,Ie,Te,Ve,ht,st,ot,yt,dt=0;for(ot=0;ot<8;++ot){me=M[dt],de=M[dt+1],Le=M[dt+2],Ie=M[dt+3],Te=M[dt+4],Ve=M[dt+5],ht=M[dt+6];var Vt=me+(st=M[dt+7]),mt=me-st,Lt=de+ht,zt=de-ht,Et=Le+Ve,wt=Le-Ve,Jt=Ie+Te,Nt=Ie-Te,Ft=Vt+Jt,ar=Vt-Jt,Ot=Lt+Et,xt=Lt-Et;M[dt]=Ft+Ot,M[dt+4]=Ft-Ot;var Xt=.707106781*(xt+ar);M[dt+2]=ar+Xt,M[dt+6]=ar-Xt;var er=.382683433*((Ft=Nt+wt)-(xt=zt+mt)),Rr=.5411961*Ft+er,bn=1.306562965*xt+er,tn=.707106781*(Ot=wt+zt),Ut=mt+tn,pn=mt-tn;M[dt+5]=pn+Rr,M[dt+3]=pn-Rr,M[dt+1]=Ut+bn,M[dt+7]=Ut-bn,dt+=8}for(dt=0,ot=0;ot<8;++ot){me=M[dt],de=M[dt+8],Le=M[dt+16],Ie=M[dt+24],Te=M[dt+32],Ve=M[dt+40],ht=M[dt+48];var wn=me+(st=M[dt+56]),Vr=me-st,$r=de+ht,xr=de-ht,Ar=Le+Ve,dr=Le-Ve,rs=Ie+Te,wr=Ie-Te,Sn=wn+rs,rn=wn-rs,kn=$r+Ar,Wr=$r-Ar;M[dt]=Sn+kn,M[dt+32]=Sn-kn;var Yr=.707106781*(Wr+rn);M[dt+16]=rn+Yr,M[dt+48]=rn-Yr;var En=.382683433*((Sn=wr+dr)-(Wr=xr+Vr)),lt=.5411961*Sn+En,Jr=1.306562965*Wr+En,ye=.707106781*(kn=dr+xr),ze=Vr+ye,We=Vr-ye;M[dt+40]=We+lt,M[dt+24]=We-lt,M[dt+8]=ze+Jr,M[dt+56]=ze-Jr,dt++}for(ot=0;ot<64;++ot)yt=M[ot]*he[ot],u[ot]=yt>0?yt+.5|0:yt-.5|0;return u})(C,H),Me=0;Me<64;++Me)w[Y[Me]]=Re[Me];var Ke=w[0]-K;K=w[0],Ke==0?re(X[0]):(re(X[m[ve=32767+Ke]]),re(b[ve]));for(var je=63;je>0&&w[je]==0;)je--;if(je==0)return re(ke),K;for(var j,P=1;P<=je;){for(var V=P;w[P]==0&&P<=je;)++P;var $=P-V;if($>=16){j=$>>4;for(var z=1;z<=j;++z)re(Ae);$&=15}ve=32767+w[P],re(pe[($<<4)+m[ve]]),re(b[ve]),P++}return je!=63&&re(ke),K}function ne(C){C=Math.min(Math.max(C,1),100),a!=C&&((function(H){for(var K=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],X=0;X<64;X++){var pe=d((K[X]*H+50)/100);pe=Math.min(Math.max(pe,1),255),o[Y[X]]=pe}for(var ve=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ke=0;ke<64;ke++){var Ae=d((ve[ke]*H+50)/100);Ae=Math.min(Math.max(Ae,1),255),c[Y[ke]]=Ae}for(var Re=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Me=0,Ke=0;Ke<8;Ke++)for(var je=0;je<8;je++)h[Me]=1/(o[Y[Me]]*Re[Ke]*Re[je]*8),p[Me]=1/(c[Y[Me]]*Re[Ke]*Re[je]*8),Me++})(C<50?Math.floor(5e3/C):Math.floor(200-2*C)),a=C)}this.encode=function(C,H){H&&ne(H),g=new Array,_=0,y=7,le(65496),le(65504),le(16),se(74),se(70),se(73),se(70),se(0),se(1),se(1),se(0),le(1),le(1),se(0),se(0),(function(){le(65499),le(132),se(0);for(var de=0;de<64;de++)se(o[de]);se(1);for(var Le=0;Le<64;Le++)se(c[Le])})(),(function(de,Le){le(65472),le(17),se(8),le(Le),le(de),se(3),se(1),se(17),se(0),se(2),se(17),se(1),se(3),se(17),se(1)})(C.width,C.height),(function(){le(65476),le(418),se(0);for(var de=0;de<16;de++)se(G[de+1]);for(var Le=0;Le<=11;Le++)se(O[Le]);se(16);for(var Ie=0;Ie<16;Ie++)se(Q[Ie+1]);for(var Te=0;Te<=161;Te++)se(I[Te]);se(1);for(var Ve=0;Ve<16;Ve++)se(k[Ve+1]);for(var ht=0;ht<=11;ht++)se(D[ht]);se(17);for(var st=0;st<16;st++)se(v[st+1]);for(var ot=0;ot<=161;ot++)se(te[ot])})(),le(65498),le(12),se(3),se(1),se(0),se(2),se(17),se(3),se(17),se(0),se(63),se(0);var K=0,X=0,pe=0;_=0,y=7,this.encode.displayName="_encode_";for(var ve,ke,Ae,Re,Me,Ke,je,j,P,V=C.data,$=C.width,z=C.height,M=4*$,he=0;he<z;){for(ve=0;ve<M;){for(Me=M*he+ve,je=-1,j=0,P=0;P<64;P++)Ke=Me+(j=P>>3)*M+(je=4*(7&P)),he+j>=z&&(Ke-=M*(he+1+j-z)),ve+je>=M&&(Ke-=ve+je-M+4),ke=V[Ke++],Ae=V[Ke++],Re=V[Ke++],A[P]=(Z[ke]+Z[Ae+256|0]+Z[Re+512|0]>>16)-128,L[P]=(Z[ke+768|0]+Z[Ae+1024|0]+Z[Re+1280|0]>>16)-128,E[P]=(Z[ke+1280|0]+Z[Ae+1536|0]+Z[Re+1792|0]>>16)-128;K=Se(A,h,K,r,s),X=Se(L,p,X,e,i),pe=Se(E,p,pe,e,i),ve+=32}he+=8}if(y>=0){var me=[];me[1]=y+1,me[0]=(1<<y+1)-1,re(me)}return le(65497),new Uint8Array(g)},t=t||50,(function(){for(var C=String.fromCharCode,H=0;H<256;H++)F[H]=C(H)})(),r=ce(G,O),e=ce(k,D),s=ce(Q,I),i=ce(v,te),(function(){for(var C=1,H=2,K=1;K<=15;K++){for(var X=C;X<H;X++)m[32767+X]=K,b[32767+X]=[],b[32767+X][1]=K,b[32767+X][0]=X;for(var pe=-(H-1);pe<=-C;pe++)m[32767+pe]=K,b[32767+pe]=[],b[32767+pe][1]=K,b[32767+pe][0]=H-1+pe;C<<=1,H<<=1}})(),(function(){for(var C=0;C<256;C++)Z[C]=19595*C,Z[C+256|0]=38470*C,Z[C+512|0]=7471*C+32768,Z[C+768|0]=-11059*C,Z[C+1024|0]=-21709*C,Z[C+1280|0]=32768*C+8421375,Z[C+1536|0]=-27439*C,Z[C+1792|0]=-5329*C})(),ne(t)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Is(t,r){if(this.pos=0,this.buffer=t,this.datav=new DataView(t.buffer),this.is_with_alpha=!!r,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function oh(t){function r(O){if(!O)throw Error("assert :P")}function e(O,Q,I){for(var k=0;4>k;k++)if(O[Q+k]!=I.charCodeAt(k))return!0;return!1}function s(O,Q,I,k,D){for(var v=0;v<D;v++)O[Q+v]=I[k+v]}function i(O,Q,I,k){for(var D=0;D<k;D++)O[Q+D]=I}function a(O){return new Int32Array(O)}function d(O,Q){for(var I=[],k=0;k<O;k++)I.push(new Q);return I}function o(O,Q){var I=[];return(function k(D,v,te){for(var ce=te[v],re=0;re<ce&&(D.push(te.length>v+1?[]:new Q),!(te.length<v+1));re++)k(D[re],v+1,te)})(I,0,O),I}var c=function(){var O=this;function Q(l,f){for(var N=1<<f-1>>>0;l&N;)N>>>=1;return N?(l&N-1)+N:l}function I(l,f,N,S,B){r(!(S%N));do l[f+(S-=N)]=B;while(0<S)}function k(l,f,N,S,B){if(r(2328>=B),512>=B)var q=a(512);else if((q=a(B))==null)return 0;return(function(W,J,ee,ie,_e,De){var oe,Ce,Pe=J,Ue=1<<ee,Oe=a(16),$e=a(16);for(r(_e!=0),r(ie!=null),r(W!=null),r(0<ee),Ce=0;Ce<_e;++Ce){if(15<ie[Ce])return 0;++Oe[ie[Ce]]}if(Oe[0]==_e)return 0;for($e[1]=0,oe=1;15>oe;++oe){if(Oe[oe]>1<<oe)return 0;$e[oe+1]=$e[oe]+Oe[oe]}for(Ce=0;Ce<_e;++Ce)oe=ie[Ce],0<ie[Ce]&&(De[$e[oe]++]=Ce);if($e[15]==1)return(ie=new D).g=0,ie.value=De[0],I(W,Pe,1,Ue,ie),Ue;var Ye,nt=-1,et=Ue-1,Bt=0,St=1,nr=1,Tt=1<<ee;for(Ce=0,oe=1,_e=2;oe<=ee;++oe,_e<<=1){if(St+=nr<<=1,0>(nr-=Oe[oe]))return 0;for(;0<Oe[oe];--Oe[oe])(ie=new D).g=oe,ie.value=De[Ce++],I(W,Pe+Bt,_e,Tt,ie),Bt=Q(Bt,oe)}for(oe=ee+1,_e=2;15>=oe;++oe,_e<<=1){if(St+=nr<<=1,0>(nr-=Oe[oe]))return 0;for(;0<Oe[oe];--Oe[oe]){if(ie=new D,(Bt&et)!=nt){for(Pe+=Tt,Ye=1<<(nt=oe)-ee;15>nt&&!(0>=(Ye-=Oe[nt]));)++nt,Ye<<=1;Ue+=Tt=1<<(Ye=nt-ee),W[J+(nt=Bt&et)].g=Ye+ee,W[J+nt].value=Pe-J-nt}ie.g=oe-ee,ie.value=De[Ce++],I(W,Pe+(Bt>>ee),_e,Tt,ie),Bt=Q(Bt,oe)}}return St!=2*$e[15]-1?0:Ue})(l,f,N,S,B,q)}function D(){this.value=this.g=0}function v(){this.value=this.g=0}function te(){this.G=d(5,D),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=d(Ka,v)}function ce(l,f,N,S){r(l!=null),r(f!=null),r(2147483648>S),l.Ca=254,l.I=0,l.b=-8,l.Ka=0,l.oa=f,l.pa=N,l.Jd=f,l.Yc=N+S,l.Zc=4<=S?N+S-4+1:N,ke(l)}function re(l,f){for(var N=0;0<f--;)N|=Re(l,128)<<f;return N}function se(l,f){var N=re(l,f);return Ae(l)?-N:N}function le(l,f,N,S){var B,q=0;for(r(l!=null),r(f!=null),r(4294967288>S),l.Sb=S,l.Ra=0,l.u=0,l.h=0,4<S&&(S=4),B=0;B<S;++B)q+=f[N+B]<<8*B;l.Ra=q,l.bb=S,l.oa=f,l.pa=N}function Se(l){for(;8<=l.u&&l.bb<l.Sb;)l.Ra>>>=8,l.Ra+=l.oa[l.pa+l.bb]<<Ca-8>>>0,++l.bb,l.u-=8;X(l)&&(l.h=1,l.u=0)}function ne(l,f){if(r(0<=f),!l.h&&f<=as){var N=K(l)&ss[f];return l.u+=f,Se(l),N}return l.h=1,l.u=0}function C(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function H(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function K(l){return l.Ra>>>(l.u&Ca-1)>>>0}function X(l){return r(l.bb<=l.Sb),l.h||l.bb==l.Sb&&l.u>Ca}function pe(l,f){l.u=f,l.h=X(l)}function ve(l){l.u>=la&&(r(l.u>=la),Se(l))}function ke(l){r(l!=null&&l.oa!=null),l.pa<l.Zc?(l.I=(l.oa[l.pa++]|l.I<<8)>>>0,l.b+=8):(r(l!=null&&l.oa!=null),l.pa<l.Yc?(l.b+=8,l.I=l.oa[l.pa++]|l.I<<8):l.Ka?l.b=0:(l.I<<=8,l.b+=8,l.Ka=1))}function Ae(l){return re(l,1)}function Re(l,f){var N=l.Ca;0>l.b&&ke(l);var S=l.b,B=N*f>>>8,q=(l.I>>>S>B)+0;for(q?(N-=B,l.I-=B+1<<S>>>0):N=B+1,S=N,B=0;256<=S;)B+=8,S>>=8;return S=7^B+Aa[S],l.b-=S,l.Ca=(N<<S)-1,q}function Me(l,f,N){l[f+0]=N>>24&255,l[f+1]=N>>16&255,l[f+2]=N>>8&255,l[f+3]=255&N}function Ke(l,f){return l[f+0]|l[f+1]<<8}function je(l,f){return Ke(l,f)|l[f+2]<<16}function j(l,f){return Ke(l,f)|Ke(l,f+2)<<16}function P(l,f){var N=1<<f;return r(l!=null),r(0<f),l.X=a(N),l.X==null?0:(l.Mb=32-f,l.Xa=f,1)}function V(l,f){r(l!=null),r(f!=null),r(l.Xa==f.Xa),s(f.X,0,l.X,0,1<<f.Xa)}function $(){this.X=[],this.Xa=this.Mb=0}function z(l,f,N,S){r(N!=null),r(S!=null);var B=N[0],q=S[0];return B==0&&(B=(l*q+f/2)/f),q==0&&(q=(f*B+l/2)/l),0>=B||0>=q?0:(N[0]=B,S[0]=q,1)}function M(l,f){return l+(1<<f)-1>>>f}function he(l,f){return((4278255360&l)+(4278255360&f)>>>0&4278255360)+((16711935&l)+(16711935&f)>>>0&16711935)>>>0}function me(l,f){O[f]=function(N,S,B,q,W,J,ee){var ie;for(ie=0;ie<W;++ie){var _e=O[l](J[ee+ie-1],B,q+ie);J[ee+ie]=he(N[S+ie],_e)}}}function de(){this.ud=this.hd=this.jd=0}function Le(l,f){return((4278124286&(l^f))>>>1)+(l&f)>>>0}function Ie(l){return 0<=l&&256>l?l:0>l?0:255<l?255:void 0}function Te(l,f){return Ie(l+(l-f+.5>>1))}function Ve(l,f,N){return Math.abs(f-N)-Math.abs(l-N)}function ht(l,f,N,S,B,q,W){for(S=q[W-1],N=0;N<B;++N)q[W+N]=S=he(l[f+N],S)}function st(l,f,N,S,B){var q;for(q=0;q<N;++q){var W=l[f+q],J=W>>8&255,ee=16711935&(ee=(ee=16711935&W)+((J<<16)+J));S[B+q]=(4278255360&W)+ee>>>0}}function ot(l,f){f.jd=255&l,f.hd=l>>8&255,f.ud=l>>16&255}function yt(l,f,N,S,B,q){var W;for(W=0;W<S;++W){var J=f[N+W],ee=J>>>8,ie=J,_e=255&(_e=(_e=J>>>16)+((l.jd<<24>>24)*(ee<<24>>24)>>>5));ie=255&(ie=(ie+=(l.hd<<24>>24)*(ee<<24>>24)>>>5)+((l.ud<<24>>24)*(_e<<24>>24)>>>5)),B[q+W]=(4278255360&J)+(_e<<16)+ie}}function dt(l,f,N,S,B){O[f]=function(q,W,J,ee,ie,_e,De,oe,Ce){for(ee=De;ee<oe;++ee)for(De=0;De<Ce;++De)ie[_e++]=B(J[S(q[W++])])},O[l]=function(q,W,J,ee,ie,_e,De){var oe=8>>q.b,Ce=q.Ea,Pe=q.K[0],Ue=q.w;if(8>oe)for(q=(1<<q.b)-1,Ue=(1<<oe)-1;W<J;++W){var Oe,$e=0;for(Oe=0;Oe<Ce;++Oe)Oe&q||($e=S(ee[ie++])),_e[De++]=B(Pe[$e&Ue]),$e>>=oe}else O["VP8LMapColor"+N](ee,ie,Pe,Ue,_e,De,W,J,Ce)}}function Vt(l,f,N,S,B){for(N=f+N;f<N;){var q=l[f++];S[B++]=q>>16&255,S[B++]=q>>8&255,S[B++]=255&q}}function mt(l,f,N,S,B){for(N=f+N;f<N;){var q=l[f++];S[B++]=q>>16&255,S[B++]=q>>8&255,S[B++]=255&q,S[B++]=q>>24&255}}function Lt(l,f,N,S,B){for(N=f+N;f<N;){var q=(W=l[f++])>>16&240|W>>12&15,W=240&W|W>>28&15;S[B++]=q,S[B++]=W}}function zt(l,f,N,S,B){for(N=f+N;f<N;){var q=(W=l[f++])>>16&248|W>>13&7,W=W>>5&224|W>>3&31;S[B++]=q,S[B++]=W}}function Et(l,f,N,S,B){for(N=f+N;f<N;){var q=l[f++];S[B++]=255&q,S[B++]=q>>8&255,S[B++]=q>>16&255}}function wt(l,f,N,S,B,q){if(q==0)for(N=f+N;f<N;)Me(S,((q=l[f++])[0]>>24|q[1]>>8&65280|q[2]<<8&16711680|q[3]<<24)>>>0),B+=32;else s(S,B,l,f,N)}function Jt(l,f){O[f][0]=O[l+"0"],O[f][1]=O[l+"1"],O[f][2]=O[l+"2"],O[f][3]=O[l+"3"],O[f][4]=O[l+"4"],O[f][5]=O[l+"5"],O[f][6]=O[l+"6"],O[f][7]=O[l+"7"],O[f][8]=O[l+"8"],O[f][9]=O[l+"9"],O[f][10]=O[l+"10"],O[f][11]=O[l+"11"],O[f][12]=O[l+"12"],O[f][13]=O[l+"13"],O[f][14]=O[l+"0"],O[f][15]=O[l+"0"]}function Nt(l){return l==Ll||l==El||l==Lo||l==Pl}function Ft(){this.eb=[],this.size=this.A=this.fb=0}function ar(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Ot(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Ft,this.f.kb=new ar,this.sd=null}function xt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Xt(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function er(l){return alert("todo:WebPSamplerProcessPlane"),l.T}function Rr(l,f){var N=l.T,S=f.ba.f.RGBA,B=S.eb,q=S.fb+l.ka*S.A,W=_s[f.ba.S],J=l.y,ee=l.O,ie=l.f,_e=l.N,De=l.ea,oe=l.W,Ce=f.cc,Pe=f.dc,Ue=f.Mc,Oe=f.Nc,$e=l.ka,Ye=l.ka+l.T,nt=l.U,et=nt+1>>1;for($e==0?W(J,ee,null,null,ie,_e,De,oe,ie,_e,De,oe,B,q,null,null,nt):(W(f.ec,f.fc,J,ee,Ce,Pe,Ue,Oe,ie,_e,De,oe,B,q-S.A,B,q,nt),++N);$e+2<Ye;$e+=2)Ce=ie,Pe=_e,Ue=De,Oe=oe,_e+=l.Rc,oe+=l.Rc,q+=2*S.A,W(J,(ee+=2*l.fa)-l.fa,J,ee,Ce,Pe,Ue,Oe,ie,_e,De,oe,B,q-S.A,B,q,nt);return ee+=l.fa,l.j+Ye<l.o?(s(f.ec,f.fc,J,ee,nt),s(f.cc,f.dc,ie,_e,et),s(f.Mc,f.Nc,De,oe,et),N--):1&Ye||W(J,ee,null,null,ie,_e,De,oe,ie,_e,De,oe,B,q+S.A,null,null,nt),N}function bn(l,f,N){var S=l.F,B=[l.J];if(S!=null){var q=l.U,W=f.ba.S,J=W==Ao||W==Lo;f=f.ba.f.RGBA;var ee=[0],ie=l.ka;ee[0]=l.T,l.Kb&&(ie==0?--ee[0]:(--ie,B[0]-=l.width),l.j+l.ka+l.T==l.o&&(ee[0]=l.o-l.j-ie));var _e=f.eb;ie=f.fb+ie*f.A,l=od(S,B[0],l.width,q,ee,_e,ie+(J?0:3),f.A),r(N==ee),l&&Nt(W)&&to(_e,ie,J,q,ee,f.A)}return 0}function tn(l){var f=l.ma,N=f.ba.S,S=11>N,B=N==ko||N==Co||N==Ao||N==Al||N==12||Nt(N);if(f.memory=null,f.Ib=null,f.Jb=null,f.Nd=null,!oa(f.Oa,l,B?11:12))return 0;if(B&&Nt(N)&&ut(),l.da)alert("todo:use_scaling");else{if(S){if(f.Ib=er,l.Kb){if(N=l.U+1>>1,f.memory=a(l.U+2*N),f.memory==null)return 0;f.ec=f.memory,f.fc=0,f.cc=f.ec,f.dc=f.fc+l.U,f.Mc=f.cc,f.Nc=f.dc+N,f.Ib=Rr,ut()}}else alert("todo:EmitYUV");B&&(f.Jb=bn,S&&qe())}if(S&&!_d){for(l=0;256>l;++l)Bp[l]=89858*(l-128)+Po>>Eo,zp[l]=-22014*(l-128)+Po,Up[l]=-45773*(l-128),Mp[l]=113618*(l-128)+Po>>Eo;for(l=no;l<Fl;++l)f=76283*(l-16)+Po>>Eo,qp[l-no]=ir(f,255),$p[l-no]=ir(f+8>>4,15);_d=1}return 1}function Ut(l){var f=l.ma,N=l.U,S=l.T;return r(!(1&l.ka)),0>=N||0>=S?0:(N=f.Ib(l,f),f.Jb!=null&&f.Jb(l,f,N),f.Dc+=N,1)}function pn(l){l.ma.memory=null}function wn(l,f,N,S){return ne(l,8)!=47?0:(f[0]=ne(l,14)+1,N[0]=ne(l,14)+1,S[0]=ne(l,1),ne(l,3)!=0?0:!l.h)}function Vr(l,f){if(4>l)return l+1;var N=l-2>>1;return(2+(1&l)<<N)+ne(f,N)+1}function $r(l,f){return 120<f?f-120:1<=(N=((N=jp[f-1])>>4)*l+(8-(15&N)))?N:1;var N}function xr(l,f,N){var S=K(N),B=l[f+=255&S].g-8;return 0<B&&(pe(N,N.u+8),S=K(N),f+=l[f].value,f+=S&(1<<B)-1),pe(N,N.u+l[f].g),l[f].value}function Ar(l,f,N){return N.g+=l.g,N.value+=l.value<<f>>>0,r(8>=N.g),l.g}function dr(l,f,N){var S=l.xc;return r((f=S==0?0:l.vc[l.md*(N>>S)+(f>>S)])<l.Wb),l.Ya[f]}function rs(l,f,N,S){var B=l.ab,q=l.c*f,W=l.C;f=W+f;var J=N,ee=S;for(S=l.Ta,N=l.Ua;0<B--;){var ie=l.gc[B],_e=W,De=f,oe=J,Ce=ee,Pe=(ee=S,J=N,ie.Ea);switch(r(_e<De),r(De<=ie.nc),ie.hc){case 2:nn(oe,Ce,(De-_e)*Pe,ee,J);break;case 0:var Ue=_e,Oe=De,$e=ee,Ye=J,nt=(Tt=ie).Ea;Ue==0&&(Ji(oe,Ce,null,null,1,$e,Ye),ht(oe,Ce+1,0,0,nt-1,$e,Ye+1),Ce+=nt,Ye+=nt,++Ue);for(var et=1<<Tt.b,Bt=et-1,St=M(nt,Tt.b),nr=Tt.K,Tt=Tt.w+(Ue>>Tt.b)*St;Ue<Oe;){var lr=nr,gn=Tt,sr=1;for(wi(oe,Ce,$e,Ye-nt,1,$e,Ye);sr<nt;){var It=(sr&~Bt)+et;It>nt&&(It=nt),(0,Zi[lr[gn++]>>8&15])(oe,Ce+ +sr,$e,Ye+sr-nt,It-sr,$e,Ye+sr),sr=It}Ce+=nt,Ye+=nt,++Ue&Bt||(Tt+=St)}De!=ie.nc&&s(ee,J-Pe,ee,J+(De-_e-1)*Pe,Pe);break;case 1:for(Pe=oe,Oe=Ce,nt=(oe=ie.Ea)-(Ye=oe&~($e=(Ce=1<<ie.b)-1)),Ue=M(oe,ie.b),et=ie.K,ie=ie.w+(_e>>ie.b)*Ue;_e<De;){for(Bt=et,St=ie,nr=new de,Tt=Oe+Ye,lr=Oe+oe;Oe<Tt;)ot(Bt[St++],nr),Xi(nr,Pe,Oe,Ce,ee,J),Oe+=Ce,J+=Ce;Oe<lr&&(ot(Bt[St++],nr),Xi(nr,Pe,Oe,nt,ee,J),Oe+=nt,J+=nt),++_e&$e||(ie+=Ue)}break;case 3:if(oe==ee&&Ce==J&&0<ie.b){for(Oe=ee,oe=Pe=J+(De-_e)*Pe-(Ye=(De-_e)*M(ie.Ea,ie.b)),Ce=ee,$e=J,Ue=[],Ye=(nt=Ye)-1;0<=Ye;--Ye)Ue[Ye]=Ce[$e+Ye];for(Ye=nt-1;0<=Ye;--Ye)Oe[oe+Ye]=Ue[Ye];No(ie,_e,De,ee,Pe,ee,J)}else No(ie,_e,De,oe,Ce,ee,J)}J=S,ee=N}ee!=N&&s(S,N,J,ee,q)}function wr(l,f){var N=l.V,S=l.Ba+l.c*l.C,B=f-l.C;if(r(f<=l.l.o),r(16>=B),0<B){var q=l.l,W=l.Ta,J=l.Ua,ee=q.width;if(rs(l,B,N,S),B=J=[J],r((N=l.C)<(S=f)),r(q.v<q.va),S>q.o&&(S=q.o),N<q.j){var ie=q.j-N;N=q.j,B[0]+=ie*ee}if(N>=S?N=0:(B[0]+=4*q.v,q.ka=N-q.j,q.U=q.va-q.v,q.T=S-N,N=1),N){if(J=J[0],11>(N=l.ca).S){var _e=N.f.RGBA,De=(S=N.S,B=q.U,q=q.T,ie=_e.eb,_e.A),oe=q;for(_e=_e.fb+l.Ma*_e.A;0<oe--;){var Ce=W,Pe=J,Ue=B,Oe=ie,$e=_e;switch(S){case So:Qi(Ce,Pe,Ue,Oe,$e);break;case ko:La(Ce,Pe,Ue,Oe,$e);break;case Ll:La(Ce,Pe,Ue,Oe,$e),to(Oe,$e,0,Ue,1,0);break;case pd:Za(Ce,Pe,Ue,Oe,$e);break;case Co:wt(Ce,Pe,Ue,Oe,$e,1);break;case El:wt(Ce,Pe,Ue,Oe,$e,1),to(Oe,$e,0,Ue,1,0);break;case Ao:wt(Ce,Pe,Ue,Oe,$e,0);break;case Lo:wt(Ce,Pe,Ue,Oe,$e,0),to(Oe,$e,1,Ue,1,0);break;case Al:Ea(Ce,Pe,Ue,Oe,$e);break;case Pl:Ea(Ce,Pe,Ue,Oe,$e),id(Oe,$e,Ue,1,0);break;case md:Pa(Ce,Pe,Ue,Oe,$e);break;default:r(0)}J+=ee,_e+=De}l.Ma+=q}else alert("todo:EmitRescaledRowsYUVA");r(l.Ma<=N.height)}}l.C=f,r(l.C<=l.i)}function Sn(l){var f;if(0<l.ua)return 0;for(f=0;f<l.Wb;++f){var N=l.Ya[f].G,S=l.Ya[f].H;if(0<N[1][S[1]+0].g||0<N[2][S[2]+0].g||0<N[3][S[3]+0].g)return 0}return 1}function rn(l,f,N,S,B,q){if(l.Z!=0){var W=l.qd,J=l.rd;for(r(Fa[l.Z]!=null);f<N;++f)Fa[l.Z](W,J,S,B,S,B,q),W=S,J=B,B+=q;l.qd=W,l.rd=J}}function kn(l,f){var N=l.l.ma,S=N.Z==0||N.Z==1?l.l.j:l.C;if(S=l.C<S?S:l.C,r(f<=l.l.o),f>S){var B=l.l.width,q=N.ca,W=N.tb+B*S,J=l.V,ee=l.Ba+l.c*S,ie=l.gc;r(l.ab==1),r(ie[0].hc==3),Gs(ie[0],S,f,J,ee,q,W),rn(N,S,f,q,W,B)}l.C=l.Ma=f}function Wr(l,f,N,S,B,q,W){var J=l.$/S,ee=l.$%S,ie=l.m,_e=l.s,De=N+l.$,oe=De;B=N+S*B;var Ce=N+S*q,Pe=280+_e.ua,Ue=l.Pb?J:16777216,Oe=0<_e.ua?_e.Wa:null,$e=_e.wc,Ye=De<Ce?dr(_e,ee,J):null;r(l.C<q),r(Ce<=B);var nt=!1;e:for(;;){for(;nt||De<Ce;){var et=0;if(J>=Ue){var Bt=De-N;r((Ue=l).Pb),Ue.wd=Ue.m,Ue.xd=Bt,0<Ue.s.ua&&V(Ue.s.Wa,Ue.s.vb),Ue=J+kp}if(ee&$e||(Ye=dr(_e,ee,J)),r(Ye!=null),Ye.Qb&&(f[De]=Ye.qb,nt=!0),!nt)if(ve(ie),Ye.jc){et=ie,Bt=f;var St=De,nr=Ye.pd[K(et)&Ka-1];r(Ye.jc),256>nr.g?(pe(et,et.u+nr.g),Bt[St]=nr.value,et=0):(pe(et,et.u+nr.g-256),r(256<=nr.value),et=nr.value),et==0&&(nt=!0)}else et=xr(Ye.G[0],Ye.H[0],ie);if(ie.h)break;if(nt||256>et){if(!nt)if(Ye.nd)f[De]=(Ye.qb|et<<8)>>>0;else{if(ve(ie),nt=xr(Ye.G[1],Ye.H[1],ie),ve(ie),Bt=xr(Ye.G[2],Ye.H[2],ie),St=xr(Ye.G[3],Ye.H[3],ie),ie.h)break;f[De]=(St<<24|nt<<16|et<<8|Bt)>>>0}if(nt=!1,++De,++ee>=S&&(ee=0,++J,W!=null&&J<=q&&!(J%16)&&W(l,J),Oe!=null))for(;oe<De;)et=f[oe++],Oe.X[(506832829*et&4294967295)>>>Oe.Mb]=et}else if(280>et){if(et=Vr(et-256,ie),Bt=xr(Ye.G[4],Ye.H[4],ie),ve(ie),Bt=$r(S,Bt=Vr(Bt,ie)),ie.h)break;if(De-N<Bt||B-De<et)break e;for(St=0;St<et;++St)f[De+St]=f[De+St-Bt];for(De+=et,ee+=et;ee>=S;)ee-=S,++J,W!=null&&J<=q&&!(J%16)&&W(l,J);if(r(De<=B),ee&$e&&(Ye=dr(_e,ee,J)),Oe!=null)for(;oe<De;)et=f[oe++],Oe.X[(506832829*et&4294967295)>>>Oe.Mb]=et}else{if(!(et<Pe))break e;for(nt=et-280,r(Oe!=null);oe<De;)et=f[oe++],Oe.X[(506832829*et&4294967295)>>>Oe.Mb]=et;et=De,r(!(nt>>>(Bt=Oe).Xa)),f[et]=Bt.X[nt],nt=!0}nt||r(ie.h==X(ie))}if(l.Pb&&ie.h&&De<B)r(l.m.h),l.a=5,l.m=l.wd,l.$=l.xd,0<l.s.ua&&V(l.s.vb,l.s.Wa);else{if(ie.h)break e;W!=null&&W(l,J>q?q:J),l.a=0,l.$=De-N}return 1}return l.a=3,0}function Yr(l){r(l!=null),l.vc=null,l.yc=null,l.Ya=null;var f=l.Wa;f!=null&&(f.X=null),l.vb=null,r(l!=null)}function En(){var l=new qt;return l==null?null:(l.a=0,l.xb=yd,Jt("Predictor","VP8LPredictors"),Jt("Predictor","VP8LPredictors_C"),Jt("PredictorAdd","VP8LPredictorsAdd"),Jt("PredictorAdd","VP8LPredictorsAdd_C"),nn=st,Xi=yt,Qi=Vt,La=mt,Ea=Lt,Pa=zt,Za=Et,O.VP8LMapColor32b=Hs,O.VP8LMapColor8b=Ki,l)}function lt(l,f,N,S,B){var q=1,W=[l],J=[f],ee=S.m,ie=S.s,_e=null,De=0;e:for(;;){if(N)for(;q&&ne(ee,1);){var oe=W,Ce=J,Pe=S,Ue=1,Oe=Pe.m,$e=Pe.gc[Pe.ab],Ye=ne(Oe,2);if(Pe.Oc&1<<Ye)q=0;else{switch(Pe.Oc|=1<<Ye,$e.hc=Ye,$e.Ea=oe[0],$e.nc=Ce[0],$e.K=[null],++Pe.ab,r(4>=Pe.ab),Ye){case 0:case 1:$e.b=ne(Oe,3)+2,Ue=lt(M($e.Ea,$e.b),M($e.nc,$e.b),0,Pe,$e.K),$e.K=$e.K[0];break;case 3:var nt,et=ne(Oe,8)+1,Bt=16<et?0:4<et?1:2<et?2:3;if(oe[0]=M($e.Ea,Bt),$e.b=Bt,nt=Ue=lt(et,1,0,Pe,$e.K)){var St,nr=et,Tt=$e,lr=1<<(8>>Tt.b),gn=a(lr);if(gn==null)nt=0;else{var sr=Tt.K[0],It=Tt.w;for(gn[0]=Tt.K[0][0],St=1;St<1*nr;++St)gn[St]=he(sr[It+St],gn[St-1]);for(;St<4*lr;++St)gn[St]=0;Tt.K[0]=null,Tt.K[0]=gn,nt=1}}Ue=nt;break;case 2:break;default:r(0)}q=Ue}}if(W=W[0],J=J[0],q&&ne(ee,1)&&!(q=1<=(De=ne(ee,4))&&11>=De)){S.a=3;break e}var pt;if(pt=q)t:{var an,Qt,cr,Br=S,Cn=W,zn=J,Zr=De,Tn=N,qn=Br.m,xn=Br.s,hr=[null],_r=1,Xr=0,jr=Sp[Zr];r:for(;;){if(Tn&&ne(qn,1)){var An=ne(qn,3)+2,Ps=M(Cn,An),on=M(zn,An),Kn=Ps*on;if(!lt(Ps,on,0,Br,hr))break r;for(hr=hr[0],xn.xc=An,an=0;an<Kn;++an){var Pr=hr[an]>>8&65535;hr[an]=Pr,Pr>=_r&&(_r=Pr+1)}}if(qn.h)break r;for(Qt=0;5>Qt;++Qt){var yn=gd[Qt];!Qt&&0<Zr&&(yn+=1<<Zr),Xr<yn&&(Xr=yn)}var os=d(_r*jr,D),$n=_r,ls=d($n,te);if(ls==null)var cs=null;else r(65536>=$n),cs=ls;var Zn=a(Xr);if(cs==null||Zn==null||os==null){Br.a=1;break r}var ds=os;for(an=cr=0;an<_r;++an){var Fr=cs[an],us=Fr.G,Ts=Fr.H,Qa=0,ua=1,Ln=0;for(Qt=0;5>Qt;++Qt){yn=gd[Qt],us[Qt]=ds,Ts[Qt]=cr,!Qt&&0<Zr&&(yn+=1<<Zr);s:{var Io,Ol=yn,Fo=Br,so=Zn,Gp=ds,Vp=cr,Dl=0,Oa=Fo.m,Yp=ne(Oa,1);if(i(so,0,0,Ol),Yp){var Jp=ne(Oa,1)+1,Kp=ne(Oa,1),kd=ne(Oa,Kp==0?1:8);so[kd]=1,Jp==2&&(so[kd=ne(Oa,8)]=1);var Oo=1}else{var Cd=a(19),Ad=ne(Oa,4)+4;if(19<Ad){Fo.a=3;var Do=0;break s}for(Io=0;Io<Ad;++Io)Cd[_p[Io]]=ne(Oa,3);var Rl=void 0,ao=void 0,Ld=Fo,Zp=Cd,Ro=Ol,Ed=so,Bl=0,Da=Ld.m,Pd=8,Td=d(128,D);n:for(;k(Td,0,7,Zp,19);){if(ne(Da,1)){var Xp=2+2*ne(Da,3);if((Rl=2+ne(Da,Xp))>Ro)break n}else Rl=Ro;for(ao=0;ao<Ro&&Rl--;){ve(Da);var Id=Td[0+(127&K(Da))];pe(Da,Da.u+Id.g);var Ni=Id.value;if(16>Ni)Ed[ao++]=Ni,Ni!=0&&(Pd=Ni);else{var Qp=Ni==16,Fd=Ni-16,e0=vp[Fd],Od=ne(Da,wp[Fd])+e0;if(ao+Od>Ro)break n;for(var t0=Qp?Pd:0;0<Od--;)Ed[ao++]=t0}}Bl=1;break n}Bl||(Ld.a=3),Oo=Bl}(Oo=Oo&&!Oa.h)&&(Dl=k(Gp,Vp,8,so,Ol)),Oo&&Dl!=0?Do=Dl:(Fo.a=3,Do=0)}if(Do==0)break r;if(ua&&Np[Qt]==1&&(ua=ds[cr].g==0),Qa+=ds[cr].g,cr+=Do,3>=Qt){var io,Ml=Zn[0];for(io=1;io<yn;++io)Zn[io]>Ml&&(Ml=Zn[io]);Ln+=Ml}}if(Fr.nd=ua,Fr.Qb=0,ua&&(Fr.qb=(us[3][Ts[3]+0].value<<24|us[1][Ts[1]+0].value<<16|us[2][Ts[2]+0].value)>>>0,Qa==0&&256>us[0][Ts[0]+0].value&&(Fr.Qb=1,Fr.qb+=us[0][Ts[0]+0].value<<8)),Fr.jc=!Fr.Qb&&6>Ln,Fr.jc){var Bo,ha=Fr;for(Bo=0;Bo<Ka;++Bo){var Ra=Bo,Ba=ha.pd[Ra],Mo=ha.G[0][ha.H[0]+Ra];256<=Mo.value?(Ba.g=Mo.g+256,Ba.value=Mo.value):(Ba.g=0,Ba.value=0,Ra>>=Ar(Mo,8,Ba),Ra>>=Ar(ha.G[1][ha.H[1]+Ra],16,Ba),Ra>>=Ar(ha.G[2][ha.H[2]+Ra],0,Ba),Ar(ha.G[3][ha.H[3]+Ra],24,Ba))}}}xn.vc=hr,xn.Wb=_r,xn.Ya=cs,xn.yc=os,pt=1;break t}pt=0}if(!(q=pt)){S.a=3;break e}if(0<De){if(ie.ua=1<<De,!P(ie.Wa,De)){S.a=1,q=0;break e}}else ie.ua=0;var Ul=S,Dd=W,r0=J,zl=Ul.s,ql=zl.xc;if(Ul.c=Dd,Ul.i=r0,zl.md=M(Dd,ql),zl.wc=ql==0?-1:(1<<ql)-1,N){S.xb=Ip;break e}if((_e=a(W*J))==null){S.a=1,q=0;break e}q=(q=Wr(S,_e,0,W,J,J,null))&&!ee.h;break e}return q?(B!=null?B[0]=_e:(r(_e==null),r(N)),S.$=0,N||Yr(ie)):Yr(ie),q}function Jr(l,f){var N=l.c*l.i,S=N+f+16*f;return r(l.c<=f),l.V=a(S),l.V==null?(l.Ta=null,l.Ua=0,l.a=1,0):(l.Ta=l.V,l.Ua=l.Ba+N+f,1)}function ye(l,f){var N=l.C,S=f-N,B=l.V,q=l.Ba+l.c*N;for(r(f<=l.l.o);0<S;){var W=16<S?16:S,J=l.l.ma,ee=l.l.width,ie=ee*W,_e=J.ca,De=J.tb+ee*N,oe=l.Ta,Ce=l.Ua;rs(l,W,B,q),ld(oe,Ce,_e,De,ie),rn(J,N,N+W,_e,De,ee),S-=W,B+=W*l.c,N+=W}r(N==f),l.C=l.Ma=f}function ze(){this.ub=this.yd=this.td=this.Rb=0}function We(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function Qe(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function at(){this.Yb=(function(){var l=[];return(function f(N,S,B){for(var q=B[S],W=0;W<q&&(N.push(B.length>S+1?[]:0),!(B.length<S+1));W++)f(N[W],S+1,B)})(l,0,[3,11]),l})()}function tt(){this.jb=a(3),this.Wc=o([4,8],at),this.Xc=o([4,17],at)}function rt(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function it(){this.ld=this.La=this.dd=this.tc=0}function Ct(){this.Na=this.la=0}function _t(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function $t(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Yt(){this.uc=this.M=this.Nb=0,this.wa=Array(new it),this.Y=0,this.ya=Array(new $t),this.aa=0,this.l=new Pn}function gt(){this.y=a(16),this.f=a(8),this.ea=a(8)}function Wt(){this.cb=this.a=0,this.sc="",this.m=new C,this.Od=new ze,this.Kc=new We,this.ed=new rt,this.Qa=new Qe,this.Ic=this.$c=this.Aa=0,this.D=new Yt,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=d(8,C),this.ia=0,this.pb=d(4,_t),this.Pa=new tt,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new gt),this.Hd=0,this.rb=Array(new Ct),this.sb=0,this.wa=Array(new it),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new $t),this.L=this.aa=0,this.gd=o([4,2],it),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function ir(l,f){return 0>l?0:l>f?f:l}function Pn(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function ys(){var l=new Wt;return l!=null&&(l.a=0,l.sc="OK",l.cb=0,l.Xb=0,ro||(ro=ur)),l}function Cr(l,f,N){return l.a==0&&(l.a=f,l.sc=N,l.cb=0),0}function He(l,f,N){return 3<=N&&l[f+0]==157&&l[f+1]==1&&l[f+2]==42}function ft(l,f){if(l==null)return 0;if(l.a=0,l.sc="OK",f==null)return Cr(l,2,"null VP8Io passed to VP8GetHeaders()");var N=f.data,S=f.w,B=f.ha;if(4>B)return Cr(l,7,"Truncated header.");var q=N[S+0]|N[S+1]<<8|N[S+2]<<16,W=l.Od;if(W.Rb=!(1&q),W.td=q>>1&7,W.yd=q>>4&1,W.ub=q>>5,3<W.td)return Cr(l,3,"Incorrect keyframe parameters.");if(!W.yd)return Cr(l,4,"Frame not displayable.");S+=3,B-=3;var J=l.Kc;if(W.Rb){if(7>B)return Cr(l,7,"cannot parse picture header");if(!He(N,S,B))return Cr(l,3,"Bad code word");J.c=16383&(N[S+4]<<8|N[S+3]),J.Td=N[S+4]>>6,J.i=16383&(N[S+6]<<8|N[S+5]),J.Ud=N[S+6]>>6,S+=7,B-=7,l.za=J.c+15>>4,l.Ub=J.i+15>>4,f.width=J.c,f.height=J.i,f.Da=0,f.j=0,f.v=0,f.va=f.width,f.o=f.height,f.da=0,f.ib=f.width,f.hb=f.height,f.U=f.width,f.T=f.height,i((q=l.Pa).jb,0,255,q.jb.length),r((q=l.Qa)!=null),q.Cb=0,q.Bb=0,q.Fb=1,i(q.Zb,0,0,q.Zb.length),i(q.Lb,0,0,q.Lb)}if(W.ub>B)return Cr(l,7,"bad partition length");ce(q=l.m,N,S,W.ub),S+=W.ub,B-=W.ub,W.Rb&&(J.Ld=Ae(q),J.Kd=Ae(q)),J=l.Qa;var ee,ie=l.Pa;if(r(q!=null),r(J!=null),J.Cb=Ae(q),J.Cb){if(J.Bb=Ae(q),Ae(q)){for(J.Fb=Ae(q),ee=0;4>ee;++ee)J.Zb[ee]=Ae(q)?se(q,7):0;for(ee=0;4>ee;++ee)J.Lb[ee]=Ae(q)?se(q,6):0}if(J.Bb)for(ee=0;3>ee;++ee)ie.jb[ee]=Ae(q)?re(q,8):255}else J.Bb=0;if(q.Ka)return Cr(l,3,"cannot parse segment header");if((J=l.ed).zd=Ae(q),J.Tb=re(q,6),J.wb=re(q,3),J.Pc=Ae(q),J.Pc&&Ae(q)){for(ie=0;4>ie;++ie)Ae(q)&&(J.vd[ie]=se(q,6));for(ie=0;4>ie;++ie)Ae(q)&&(J.od[ie]=se(q,6))}if(l.L=J.Tb==0?0:J.zd?1:2,q.Ka)return Cr(l,3,"cannot parse filter header");var _e=B;if(B=ee=S,S=ee+_e,J=_e,l.Xb=(1<<re(l.m,2))-1,_e<3*(ie=l.Xb))N=7;else{for(ee+=3*ie,J-=3*ie,_e=0;_e<ie;++_e){var De=N[B+0]|N[B+1]<<8|N[B+2]<<16;De>J&&(De=J),ce(l.Jc[+_e],N,ee,De),ee+=De,J-=De,B+=3}ce(l.Jc[+ie],N,ee,J),N=ee<S?0:5}if(N!=0)return Cr(l,N,"cannot parse partitions");for(N=re(ee=l.m,7),B=Ae(ee)?se(ee,4):0,S=Ae(ee)?se(ee,4):0,J=Ae(ee)?se(ee,4):0,ie=Ae(ee)?se(ee,4):0,ee=Ae(ee)?se(ee,4):0,_e=l.Qa,De=0;4>De;++De){if(_e.Cb){var oe=_e.Zb[De];_e.Fb||(oe+=N)}else{if(0<De){l.pb[De]=l.pb[0];continue}oe=N}var Ce=l.pb[De];Ce.Sc[0]=Tl[ir(oe+B,127)],Ce.Sc[1]=Il[ir(oe+0,127)],Ce.Eb[0]=2*Tl[ir(oe+S,127)],Ce.Eb[1]=101581*Il[ir(oe+J,127)]>>16,8>Ce.Eb[1]&&(Ce.Eb[1]=8),Ce.Qc[0]=Tl[ir(oe+ie,117)],Ce.Qc[1]=Il[ir(oe+ee,127)],Ce.lc=oe+ee}if(!W.Rb)return Cr(l,4,"Not a key frame.");for(Ae(q),W=l.Pa,N=0;4>N;++N){for(B=0;8>B;++B)for(S=0;3>S;++S)for(J=0;11>J;++J)ie=Re(q,Pp[N][B][S][J])?re(q,8):Lp[N][B][S][J],W.Wc[N][B].Yb[S][J]=ie;for(B=0;17>B;++B)W.Xc[N][B]=W.Wc[N][Tp[B]]}return l.kc=Ae(q),l.kc&&(l.Bd=re(q,8)),l.cb=1}function ur(l,f,N,S,B,q,W){var J=f[B].Yb[N];for(N=0;16>B;++B){if(!Re(l,J[N+0]))return B;for(;!Re(l,J[N+1]);)if(J=f[++B].Yb[0],N=0,B==16)return 16;var ee=f[B+1].Yb;if(Re(l,J[N+2])){var ie=l,_e=0;if(Re(ie,(oe=J)[(De=N)+3]))if(Re(ie,oe[De+6])){for(J=0,De=2*(_e=Re(ie,oe[De+8]))+(oe=Re(ie,oe[De+9+_e])),_e=0,oe=Cp[De];oe[J];++J)_e+=_e+Re(ie,oe[J]);_e+=3+(8<<De)}else Re(ie,oe[De+7])?(_e=7+2*Re(ie,165),_e+=Re(ie,145)):_e=5+Re(ie,159);else _e=Re(ie,oe[De+4])?3+Re(ie,oe[De+5]):2;J=ee[2]}else _e=1,J=ee[1];ee=W+Ap[B],0>(ie=l).b&&ke(ie);var De,oe=ie.b,Ce=(De=ie.Ca>>1)-(ie.I>>oe)>>31;--ie.b,ie.Ca+=Ce,ie.Ca|=1,ie.I-=(De+1&Ce)<<oe,q[ee]=((_e^Ce)-Ce)*S[(0<B)+0]}return 16}function Hr(l){var f=l.rb[l.sb-1];f.la=0,f.Na=0,i(l.zc,0,0,l.zc.length),l.ja=0}function Ur(l,f,N,S,B){B=l[f+N+32*S]+(B>>3),l[f+N+32*S]=-256&B?0>B?0:255:B}function Lr(l,f,N,S,B,q){Ur(l,f,0,N,S+B),Ur(l,f,1,N,S+q),Ur(l,f,2,N,S-q),Ur(l,f,3,N,S-B)}function Yn(l){return(20091*l>>16)+l}function ba(l,f,N,S){var B,q=0,W=a(16);for(B=0;4>B;++B){var J=l[f+0]+l[f+8],ee=l[f+0]-l[f+8],ie=(35468*l[f+4]>>16)-Yn(l[f+12]),_e=Yn(l[f+4])+(35468*l[f+12]>>16);W[q+0]=J+_e,W[q+1]=ee+ie,W[q+2]=ee-ie,W[q+3]=J-_e,q+=4,f++}for(B=q=0;4>B;++B)J=(l=W[q+0]+4)+W[q+8],ee=l-W[q+8],ie=(35468*W[q+4]>>16)-Yn(W[q+12]),Ur(N,S,0,0,J+(_e=Yn(W[q+4])+(35468*W[q+12]>>16))),Ur(N,S,1,0,ee+ie),Ur(N,S,2,0,ee-ie),Ur(N,S,3,0,J-_e),q++,S+=32}function Kr(l,f,N,S){var B=l[f+0]+4,q=35468*l[f+4]>>16,W=Yn(l[f+4]),J=35468*l[f+1]>>16;Lr(N,S,0,B+W,l=Yn(l[f+1]),J),Lr(N,S,1,B+q,l,J),Lr(N,S,2,B-q,l,J),Lr(N,S,3,B-W,l,J)}function wa(l,f,N,S,B){ba(l,f,N,S),B&&ba(l,f+16,N,S+4)}function Ir(l,f,N,S){Xa(l,f+0,N,S,1),Xa(l,f+32,N,S+128,1)}function va(l,f,N,S){var B;for(l=l[f+0]+4,B=0;4>B;++B)for(f=0;4>f;++f)Ur(N,S,f,B,l)}function Na(l,f,N,S){l[f+0]&&br(l,f+0,N,S),l[f+16]&&br(l,f+16,N,S+4),l[f+32]&&br(l,f+32,N,S+128),l[f+48]&&br(l,f+48,N,S+128+4)}function $s(l,f,N,S){var B,q=a(16);for(B=0;4>B;++B){var W=l[f+0+B]+l[f+12+B],J=l[f+4+B]+l[f+8+B],ee=l[f+4+B]-l[f+8+B],ie=l[f+0+B]-l[f+12+B];q[0+B]=W+J,q[8+B]=W-J,q[4+B]=ie+ee,q[12+B]=ie-ee}for(B=0;4>B;++B)W=(l=q[0+4*B]+3)+q[3+4*B],J=q[1+4*B]+q[2+4*B],ee=q[1+4*B]-q[2+4*B],ie=l-q[3+4*B],N[S+0]=W+J>>3,N[S+16]=ie+ee>>3,N[S+32]=W-J>>3,N[S+48]=ie-ee>>3,S+=64}function Ws(l,f,N){var S,B=f-32,q=is,W=255-l[B-1];for(S=0;S<N;++S){var J,ee=q,ie=W+l[f-1];for(J=0;J<N;++J)l[f+J]=ee[ie+l[B+J]];f+=32}}function $a(l,f){Ws(l,f,4)}function di(l,f){Ws(l,f,8)}function ra(l,f){Ws(l,f,16)}function _a(l,f){var N;for(N=0;16>N;++N)s(l,f+32*N,l,f-32,16)}function ui(l,f){var N;for(N=16;0<N;--N)i(l,f,l[f-1],16),f+=32}function Bn(l,f,N){var S;for(S=0;16>S;++S)i(f,N+32*S,l,16)}function hi(l,f){var N,S=16;for(N=0;16>N;++N)S+=l[f-1+32*N]+l[f+N-32];Bn(S>>5,l,f)}function ks(l,f){var N,S=8;for(N=0;16>N;++N)S+=l[f-1+32*N];Bn(S>>4,l,f)}function Wa(l,f){var N,S=8;for(N=0;16>N;++N)S+=l[f+N-32];Bn(S>>4,l,f)}function fi(l,f){Bn(128,l,f)}function Ht(l,f,N){return l+2*f+N+2>>2}function pi(l,f){var N,S=f-32;for(S=new Uint8Array([Ht(l[S-1],l[S+0],l[S+1]),Ht(l[S+0],l[S+1],l[S+2]),Ht(l[S+1],l[S+2],l[S+3]),Ht(l[S+2],l[S+3],l[S+4])]),N=0;4>N;++N)s(l,f+32*N,S,0,S.length)}function mi(l,f){var N=l[f-1],S=l[f-1+32],B=l[f-1+64],q=l[f-1+96];Me(l,f+0,16843009*Ht(l[f-1-32],N,S)),Me(l,f+32,16843009*Ht(N,S,B)),Me(l,f+64,16843009*Ht(S,B,q)),Me(l,f+96,16843009*Ht(B,q,q))}function $i(l,f){var N,S=4;for(N=0;4>N;++N)S+=l[f+N-32]+l[f-1+32*N];for(S>>=3,N=0;4>N;++N)i(l,f+32*N,S,4)}function Cs(l,f){var N=l[f-1+0],S=l[f-1+32],B=l[f-1+64],q=l[f-1-32],W=l[f+0-32],J=l[f+1-32],ee=l[f+2-32],ie=l[f+3-32];l[f+0+96]=Ht(S,B,l[f-1+96]),l[f+1+96]=l[f+0+64]=Ht(N,S,B),l[f+2+96]=l[f+1+64]=l[f+0+32]=Ht(q,N,S),l[f+3+96]=l[f+2+64]=l[f+1+32]=l[f+0+0]=Ht(W,q,N),l[f+3+64]=l[f+2+32]=l[f+1+0]=Ht(J,W,q),l[f+3+32]=l[f+2+0]=Ht(ee,J,W),l[f+3+0]=Ht(ie,ee,J)}function bs(l,f){var N=l[f+1-32],S=l[f+2-32],B=l[f+3-32],q=l[f+4-32],W=l[f+5-32],J=l[f+6-32],ee=l[f+7-32];l[f+0+0]=Ht(l[f+0-32],N,S),l[f+1+0]=l[f+0+32]=Ht(N,S,B),l[f+2+0]=l[f+1+32]=l[f+0+64]=Ht(S,B,q),l[f+3+0]=l[f+2+32]=l[f+1+64]=l[f+0+96]=Ht(B,q,W),l[f+3+32]=l[f+2+64]=l[f+1+96]=Ht(q,W,J),l[f+3+64]=l[f+2+96]=Ht(W,J,ee),l[f+3+96]=Ht(J,ee,ee)}function Wi(l,f){var N=l[f-1+0],S=l[f-1+32],B=l[f-1+64],q=l[f-1-32],W=l[f+0-32],J=l[f+1-32],ee=l[f+2-32],ie=l[f+3-32];l[f+0+0]=l[f+1+64]=q+W+1>>1,l[f+1+0]=l[f+2+64]=W+J+1>>1,l[f+2+0]=l[f+3+64]=J+ee+1>>1,l[f+3+0]=ee+ie+1>>1,l[f+0+96]=Ht(B,S,N),l[f+0+64]=Ht(S,N,q),l[f+0+32]=l[f+1+96]=Ht(N,q,W),l[f+1+32]=l[f+2+96]=Ht(q,W,J),l[f+2+32]=l[f+3+96]=Ht(W,J,ee),l[f+3+32]=Ht(J,ee,ie)}function Hi(l,f){var N=l[f+0-32],S=l[f+1-32],B=l[f+2-32],q=l[f+3-32],W=l[f+4-32],J=l[f+5-32],ee=l[f+6-32],ie=l[f+7-32];l[f+0+0]=N+S+1>>1,l[f+1+0]=l[f+0+64]=S+B+1>>1,l[f+2+0]=l[f+1+64]=B+q+1>>1,l[f+3+0]=l[f+2+64]=q+W+1>>1,l[f+0+32]=Ht(N,S,B),l[f+1+32]=l[f+0+96]=Ht(S,B,q),l[f+2+32]=l[f+1+96]=Ht(B,q,W),l[f+3+32]=l[f+2+96]=Ht(q,W,J),l[f+3+64]=Ht(W,J,ee),l[f+3+96]=Ht(J,ee,ie)}function na(l,f){var N=l[f-1+0],S=l[f-1+32],B=l[f-1+64],q=l[f-1+96];l[f+0+0]=N+S+1>>1,l[f+2+0]=l[f+0+32]=S+B+1>>1,l[f+2+32]=l[f+0+64]=B+q+1>>1,l[f+1+0]=Ht(N,S,B),l[f+3+0]=l[f+1+32]=Ht(S,B,q),l[f+3+32]=l[f+1+64]=Ht(B,q,q),l[f+3+64]=l[f+2+64]=l[f+0+96]=l[f+1+96]=l[f+2+96]=l[f+3+96]=q}function ja(l,f){var N=l[f-1+0],S=l[f-1+32],B=l[f-1+64],q=l[f-1+96],W=l[f-1-32],J=l[f+0-32],ee=l[f+1-32],ie=l[f+2-32];l[f+0+0]=l[f+2+32]=N+W+1>>1,l[f+0+32]=l[f+2+64]=S+N+1>>1,l[f+0+64]=l[f+2+96]=B+S+1>>1,l[f+0+96]=q+B+1>>1,l[f+3+0]=Ht(J,ee,ie),l[f+2+0]=Ht(W,J,ee),l[f+1+0]=l[f+3+32]=Ht(N,W,J),l[f+1+32]=l[f+3+64]=Ht(S,N,W),l[f+1+64]=l[f+3+96]=Ht(B,S,N),l[f+1+96]=Ht(q,B,S)}function sa(l,f){var N;for(N=0;8>N;++N)s(l,f+32*N,l,f-32,8)}function Gi(l,f){var N;for(N=0;8>N;++N)i(l,f,l[f-1],8),f+=32}function ws(l,f,N){var S;for(S=0;8>S;++S)i(f,N+32*S,l,8)}function Vi(l,f){var N,S=8;for(N=0;8>N;++N)S+=l[f+N-32]+l[f-1+32*N];ws(S>>4,l,f)}function Ha(l,f){var N,S=4;for(N=0;8>N;++N)S+=l[f+N-32];ws(S>>3,l,f)}function Ga(l,f){var N,S=4;for(N=0;8>N;++N)S+=l[f-1+32*N];ws(S>>3,l,f)}function gi(l,f){ws(128,l,f)}function Jn(l,f,N){var S=l[f-N],B=l[f+0],q=3*(B-S)+Cl[1020+l[f-2*N]-l[f+N]],W=jo[112+(q+4>>3)];l[f-N]=is[255+S+jo[112+(q+3>>3)]],l[f+0]=is[255+B-W]}function Va(l,f,N,S){var B=l[f+0],q=l[f+N];return Ns[255+l[f-2*N]-l[f-N]]>S||Ns[255+q-B]>S}function aa(l,f,N,S){return 4*Ns[255+l[f-N]-l[f+0]]+Ns[255+l[f-2*N]-l[f+N]]<=S}function Ya(l,f,N,S,B){var q=l[f-3*N],W=l[f-2*N],J=l[f-N],ee=l[f+0],ie=l[f+N],_e=l[f+2*N],De=l[f+3*N];return 4*Ns[255+J-ee]+Ns[255+W-ie]>S?0:Ns[255+l[f-4*N]-q]<=B&&Ns[255+q-W]<=B&&Ns[255+W-J]<=B&&Ns[255+De-_e]<=B&&Ns[255+_e-ie]<=B&&Ns[255+ie-ee]<=B}function ia(l,f,N,S){var B=2*S+1;for(S=0;16>S;++S)aa(l,f+S,N,B)&&Jn(l,f+S,N)}function Ja(l,f,N,S){var B=2*S+1;for(S=0;16>S;++S)aa(l,f+S*N,1,B)&&Jn(l,f+S*N,1)}function Sa(l,f,N,S){var B;for(B=3;0<B;--B)ia(l,f+=4*N,N,S)}function xi(l,f,N,S){var B;for(B=3;0<B;--B)Ja(l,f+=4,N,S)}function As(l,f,N,S,B,q,W,J){for(q=2*q+1;0<B--;){if(Ya(l,f,N,q,W))if(Va(l,f,N,J))Jn(l,f,N);else{var ee=l,ie=f,_e=N,De=ee[ie-2*_e],oe=ee[ie-_e],Ce=ee[ie+0],Pe=ee[ie+_e],Ue=ee[ie+2*_e],Oe=27*(Ye=Cl[1020+3*(Ce-oe)+Cl[1020+De-Pe]])+63>>7,$e=18*Ye+63>>7,Ye=9*Ye+63>>7;ee[ie-3*_e]=is[255+ee[ie-3*_e]+Ye],ee[ie-2*_e]=is[255+De+$e],ee[ie-_e]=is[255+oe+Oe],ee[ie+0]=is[255+Ce-Oe],ee[ie+_e]=is[255+Pe-$e],ee[ie+2*_e]=is[255+Ue-Ye]}f+=S}}function Ls(l,f,N,S,B,q,W,J){for(q=2*q+1;0<B--;){if(Ya(l,f,N,q,W))if(Va(l,f,N,J))Jn(l,f,N);else{var ee=l,ie=f,_e=N,De=ee[ie-_e],oe=ee[ie+0],Ce=ee[ie+_e],Pe=jo[112+(4+(Ue=3*(oe-De))>>3)],Ue=jo[112+(Ue+3>>3)],Oe=Pe+1>>1;ee[ie-2*_e]=is[255+ee[ie-2*_e]+Oe],ee[ie-_e]=is[255+De+Ue],ee[ie+0]=is[255+oe-Pe],ee[ie+_e]=is[255+Ce-Oe]}f+=S}}function yi(l,f,N,S,B,q){As(l,f,N,1,16,S,B,q)}function ns(l,f,N,S,B,q){As(l,f,1,N,16,S,B,q)}function bi(l,f,N,S,B,q){var W;for(W=3;0<W;--W)Ls(l,f+=4*N,N,1,16,S,B,q)}function x(l,f,N,S,B,q){var W;for(W=3;0<W;--W)Ls(l,f+=4,1,N,16,S,B,q)}function R(l,f,N,S,B,q,W,J){As(l,f,B,1,8,q,W,J),As(N,S,B,1,8,q,W,J)}function ae(l,f,N,S,B,q,W,J){As(l,f,1,B,8,q,W,J),As(N,S,1,B,8,q,W,J)}function be(l,f,N,S,B,q,W,J){Ls(l,f+4*B,B,1,8,q,W,J),Ls(N,S+4*B,B,1,8,q,W,J)}function Ee(l,f,N,S,B,q,W,J){Ls(l,f+4,1,B,8,q,W,J),Ls(N,S+4,1,B,8,q,W,J)}function Ge(){this.ba=new Ot,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Xt,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Ze(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function vt(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Pt(){this.ua=0,this.Wa=new $,this.vb=new $,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new te,this.yc=new D}function qt(){this.xb=this.a=0,this.l=new Pn,this.ca=new Ot,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new H,this.Pb=0,this.wd=new H,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Pt,this.ab=0,this.gc=d(4,vt),this.Oc=0}function Kt(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Pn,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function or(l,f,N,S,B,q,W){for(l=l==null?0:l[f+0],f=0;f<W;++f)B[q+f]=l+N[S+f]&255,l=B[q+f]}function T(l,f,N,S,B,q,W){var J;if(l==null)or(null,null,N,S,B,q,W);else for(J=0;J<W;++J)B[q+J]=l[f+J]+N[S+J]&255}function ue(l,f,N,S,B,q,W){if(l==null)or(null,null,N,S,B,q,W);else{var J,ee=l[f+0],ie=ee,_e=ee;for(J=0;J<W;++J)ie=_e+(ee=l[f+J])-ie,_e=N[S+J]+(-256&ie?0>ie?0:255:ie)&255,ie=ee,B[q+J]=_e}}function ge(l,f,N,S){var B=f.width,q=f.o;if(r(l!=null&&f!=null),0>N||0>=S||N+S>q)return null;if(!l.Cc){if(l.ga==null){var W;if(l.ga=new Kt,(W=l.ga==null)||(W=f.width*f.o,r(l.Gb.length==0),l.Gb=a(W),l.Uc=0,l.Gb==null?W=0:(l.mb=l.Gb,l.nb=l.Uc,l.rc=null,W=1),W=!W),!W){W=l.ga;var J=l.Fa,ee=l.P,ie=l.qc,_e=l.mb,De=l.nb,oe=ee+1,Ce=ie-1,Pe=W.l;if(r(J!=null&&_e!=null&&f!=null),Fa[0]=null,Fa[1]=or,Fa[2]=T,Fa[3]=ue,W.ca=_e,W.tb=De,W.c=f.width,W.i=f.height,r(0<W.c&&0<W.i),1>=ie)f=0;else if(W.$a=3&J[ee+0],W.Z=J[ee+0]>>2&3,W.Lc=J[ee+0]>>4&3,ee=J[ee+0]>>6&3,0>W.$a||1<W.$a||4<=W.Z||1<W.Lc||ee)f=0;else if(Pe.put=Ut,Pe.ac=tn,Pe.bc=pn,Pe.ma=W,Pe.width=f.width,Pe.height=f.height,Pe.Da=f.Da,Pe.v=f.v,Pe.va=f.va,Pe.j=f.j,Pe.o=f.o,W.$a)e:{r(W.$a==1),f=En();t:for(;;){if(f==null){f=0;break e}if(r(W!=null),W.mc=f,f.c=W.c,f.i=W.i,f.l=W.l,f.l.ma=W,f.l.width=W.c,f.l.height=W.i,f.a=0,le(f.m,J,oe,Ce),!lt(W.c,W.i,1,f,null)||(f.ab==1&&f.gc[0].hc==3&&Sn(f.s)?(W.ic=1,J=f.c*f.i,f.Ta=null,f.Ua=0,f.V=a(J),f.Ba=0,f.V==null?(f.a=1,f=0):f=1):(W.ic=0,f=Jr(f,W.c)),!f))break t;f=1;break e}W.mc=null,f=0}else f=Ce>=W.c*W.i;W=!f}if(W)return null;l.ga.Lc!=1?l.Ga=0:S=q-N}r(l.ga!=null),r(N+S<=q);e:{if(f=(J=l.ga).c,q=J.l.o,J.$a==0){if(oe=l.rc,Ce=l.Vc,Pe=l.Fa,ee=l.P+1+N*f,ie=l.mb,_e=l.nb+N*f,r(ee<=l.P+l.qc),J.Z!=0)for(r(Fa[J.Z]!=null),W=0;W<S;++W)Fa[J.Z](oe,Ce,Pe,ee,ie,_e,f),oe=ie,Ce=_e,_e+=f,ee+=f;else for(W=0;W<S;++W)s(ie,_e,Pe,ee,f),oe=ie,Ce=_e,_e+=f,ee+=f;l.rc=oe,l.Vc=Ce}else{if(r(J.mc!=null),f=N+S,r((W=J.mc)!=null),r(f<=W.i),W.C>=f)f=1;else if(J.ic||qe(),J.ic){J=W.V,oe=W.Ba,Ce=W.c;var Ue=W.i,Oe=(Pe=1,ee=W.$/Ce,ie=W.$%Ce,_e=W.m,De=W.s,W.$),$e=Ce*Ue,Ye=Ce*f,nt=De.wc,et=Oe<Ye?dr(De,ie,ee):null;r(Oe<=$e),r(f<=Ue),r(Sn(De));t:for(;;){for(;!_e.h&&Oe<Ye;){if(ie&nt||(et=dr(De,ie,ee)),r(et!=null),ve(_e),256>(Ue=xr(et.G[0],et.H[0],_e)))J[oe+Oe]=Ue,++Oe,++ie>=Ce&&(ie=0,++ee<=f&&!(ee%16)&&kn(W,ee));else{if(!(280>Ue)){Pe=0;break t}Ue=Vr(Ue-256,_e);var Bt,St=xr(et.G[4],et.H[4],_e);if(ve(_e),!(Oe>=(St=$r(Ce,St=Vr(St,_e)))&&$e-Oe>=Ue)){Pe=0;break t}for(Bt=0;Bt<Ue;++Bt)J[oe+Oe+Bt]=J[oe+Oe+Bt-St];for(Oe+=Ue,ie+=Ue;ie>=Ce;)ie-=Ce,++ee<=f&&!(ee%16)&&kn(W,ee);Oe<Ye&&ie&nt&&(et=dr(De,ie,ee))}r(_e.h==X(_e))}kn(W,ee>f?f:ee);break t}!Pe||_e.h&&Oe<$e?(Pe=0,W.a=_e.h?5:3):W.$=Oe,f=Pe}else f=Wr(W,W.V,W.Ba,W.c,W.i,f,ye);if(!f){S=0;break e}}N+S>=q&&(l.Cc=1),S=1}if(!S)return null;if(l.Cc&&((S=l.ga)!=null&&(S.mc=null),l.ga=null,0<l.Ga))return alert("todo:WebPDequantizeLevels"),null}return l.nb+N*B}function xe(l,f,N,S,B,q){for(;0<B--;){var W,J=l,ee=f+(N?1:0),ie=l,_e=f+(N?0:3);for(W=0;W<S;++W){var De=ie[_e+4*W];De!=255&&(De*=32897,J[ee+4*W+0]=J[ee+4*W+0]*De>>23,J[ee+4*W+1]=J[ee+4*W+1]*De>>23,J[ee+4*W+2]=J[ee+4*W+2]*De>>23)}f+=q}}function fe(l,f,N,S,B){for(;0<S--;){var q;for(q=0;q<N;++q){var W=l[f+2*q+0],J=15&(ie=l[f+2*q+1]),ee=4369*J,ie=(240&ie|ie>>4)*ee>>16;l[f+2*q+0]=(240&W|W>>4)*ee>>16&240|(15&W|W<<4)*ee>>16>>4&15,l[f+2*q+1]=240&ie|J}f+=B}}function Ne(l,f,N,S,B,q,W,J){var ee,ie,_e=255;for(ie=0;ie<B;++ie){for(ee=0;ee<S;++ee){var De=l[f+ee];q[W+4*ee]=De,_e&=De}f+=N,W+=J}return _e!=255}function Fe(l,f,N,S,B){var q;for(q=0;q<B;++q)N[S+q]=l[f+q]>>8}function qe(){to=xe,id=fe,od=Ne,ld=Fe}function Je(l,f,N){O[l]=function(S,B,q,W,J,ee,ie,_e,De,oe,Ce,Pe,Ue,Oe,$e,Ye,nt){var et,Bt=nt-1>>1,St=J[ee+0]|ie[_e+0]<<16,nr=De[oe+0]|Ce[Pe+0]<<16;r(S!=null);var Tt=3*St+nr+131074>>2;for(f(S[B+0],255&Tt,Tt>>16,Ue,Oe),q!=null&&(Tt=3*nr+St+131074>>2,f(q[W+0],255&Tt,Tt>>16,$e,Ye)),et=1;et<=Bt;++et){var lr=J[ee+et]|ie[_e+et]<<16,gn=De[oe+et]|Ce[Pe+et]<<16,sr=St+lr+nr+gn+524296,It=sr+2*(lr+nr)>>3;Tt=It+St>>1,St=(sr=sr+2*(St+gn)>>3)+lr>>1,f(S[B+2*et-1],255&Tt,Tt>>16,Ue,Oe+(2*et-1)*N),f(S[B+2*et-0],255&St,St>>16,Ue,Oe+(2*et-0)*N),q!=null&&(Tt=sr+nr>>1,St=It+gn>>1,f(q[W+2*et-1],255&Tt,Tt>>16,$e,Ye+(2*et-1)*N),f(q[W+2*et+0],255&St,St>>16,$e,Ye+(2*et+0)*N)),St=lr,nr=gn}1&nt||(Tt=3*St+nr+131074>>2,f(S[B+nt-1],255&Tt,Tt>>16,Ue,Oe+(nt-1)*N),q!=null&&(Tt=3*nr+St+131074>>2,f(q[W+nt-1],255&Tt,Tt>>16,$e,Ye+(nt-1)*N)))}}function ut(){_s[So]=Fp,_s[ko]=bd,_s[pd]=Op,_s[Co]=wd,_s[Ao]=vd,_s[Al]=Nd,_s[md]=Dp,_s[Ll]=bd,_s[El]=wd,_s[Lo]=vd,_s[Pl]=Nd}function Xe(l){return l&-16384?0>l?0:255:l>>Rp}function ct(l,f){return Xe((19077*l>>8)+(26149*f>>8)-14234)}function we(l,f,N){return Xe((19077*l>>8)-(6419*f>>8)-(13320*N>>8)+8708)}function bt(l,f){return Xe((19077*l>>8)+(33050*f>>8)-17685)}function jt(l,f,N,S,B){S[B+0]=ct(l,N),S[B+1]=we(l,f,N),S[B+2]=bt(l,f)}function tr(l,f,N,S,B){S[B+0]=bt(l,f),S[B+1]=we(l,f,N),S[B+2]=ct(l,N)}function vr(l,f,N,S,B){var q=we(l,f,N);f=q<<3&224|bt(l,f)>>3,S[B+0]=248&ct(l,N)|q>>5,S[B+1]=f}function Dt(l,f,N,S,B){var q=240&bt(l,f)|15;S[B+0]=240&ct(l,N)|we(l,f,N)>>4,S[B+1]=q}function yr(l,f,N,S,B){S[B+0]=255,jt(l,f,N,S,B+1)}function Nr(l,f,N,S,B){tr(l,f,N,S,B),S[B+3]=255}function pr(l,f,N,S,B){jt(l,f,N,S,B),S[B+3]=255}function mr(l,f,N){O[l]=function(S,B,q,W,J,ee,ie,_e,De){for(var oe=_e+(-2&De)*N;_e!=oe;)f(S[B+0],q[W+0],J[ee+0],ie,_e),f(S[B+1],q[W+0],J[ee+0],ie,_e+N),B+=2,++W,++ee,_e+=2*N;1&De&&f(S[B+0],q[W+0],J[ee+0],ie,_e)}}function Mn(l,f,N){return N==0?l==0?f==0?6:5:f==0?4:0:N}function Un(l,f,N,S,B){switch(l>>>30){case 3:Xa(f,N,S,B,0);break;case 2:vs(f,N,S,B);break;case 1:br(f,N,S,B)}}function rr(l,f){var N,S,B=f.M,q=f.Nb,W=l.oc,J=l.pc+40,ee=l.oc,ie=l.pc+584,_e=l.oc,De=l.pc+600;for(N=0;16>N;++N)W[J+32*N-1]=129;for(N=0;8>N;++N)ee[ie+32*N-1]=129,_e[De+32*N-1]=129;for(0<B?W[J-1-32]=ee[ie-1-32]=_e[De-1-32]=129:(i(W,J-32-1,127,21),i(ee,ie-32-1,127,9),i(_e,De-32-1,127,9)),S=0;S<l.za;++S){var oe=f.ya[f.aa+S];if(0<S){for(N=-1;16>N;++N)s(W,J+32*N-4,W,J+32*N+12,4);for(N=-1;8>N;++N)s(ee,ie+32*N-4,ee,ie+32*N+4,4),s(_e,De+32*N-4,_e,De+32*N+4,4)}var Ce=l.Gd,Pe=l.Hd+S,Ue=oe.ad,Oe=oe.Hc;if(0<B&&(s(W,J-32,Ce[Pe].y,0,16),s(ee,ie-32,Ce[Pe].f,0,8),s(_e,De-32,Ce[Pe].ea,0,8)),oe.Za){var $e=W,Ye=J-32+16;for(0<B&&(S>=l.za-1?i($e,Ye,Ce[Pe].y[15],4):s($e,Ye,Ce[Pe+1].y,0,4)),N=0;4>N;N++)$e[Ye+128+N]=$e[Ye+256+N]=$e[Ye+384+N]=$e[Ye+0+N];for(N=0;16>N;++N,Oe<<=2)$e=W,Ye=J+jd[N],Es[oe.Ob[N]]($e,Ye),Un(Oe,Ue,16*+N,$e,Ye)}else if($e=Mn(S,B,oe.Ob[0]),Ia[$e](W,J),Oe!=0)for(N=0;16>N;++N,Oe<<=2)Un(Oe,Ue,16*+N,W,J+jd[N]);for(N=oe.Gc,$e=Mn(S,B,oe.Dd),da[$e](ee,ie),da[$e](_e,De),Oe=Ue,$e=ee,Ye=ie,255&(oe=0|N)&&(170&oe?Vs(Oe,256,$e,Ye):Er(Oe,256,$e,Ye)),oe=_e,Oe=De,255&(N>>=8)&&(170&N?Vs(Ue,320,oe,Oe):Er(Ue,320,oe,Oe)),B<l.Ub-1&&(s(Ce[Pe].y,0,W,J+480,16),s(Ce[Pe].f,0,ee,ie+224,8),s(Ce[Pe].ea,0,_e,De+224,8)),N=8*q*l.B,Ce=l.sa,Pe=l.ta+16*S+16*q*l.R,Ue=l.qa,oe=l.ra+8*S+N,Oe=l.Ha,$e=l.Ia+8*S+N,N=0;16>N;++N)s(Ce,Pe+N*l.R,W,J+32*N,16);for(N=0;8>N;++N)s(Ue,oe+N*l.B,ee,ie+32*N,8),s(Oe,$e+N*l.B,_e,De+32*N,8)}}function gr(l,f,N,S,B,q,W,J,ee){var ie=[0],_e=[0],De=0,oe=ee!=null?ee.kd:0,Ce=ee??new Ze;if(l==null||12>N)return 7;Ce.data=l,Ce.w=f,Ce.ha=N,f=[f],N=[N],Ce.gb=[Ce.gb];e:{var Pe=f,Ue=N,Oe=Ce.gb;if(r(l!=null),r(Ue!=null),r(Oe!=null),Oe[0]=0,12<=Ue[0]&&!e(l,Pe[0],"RIFF")){if(e(l,Pe[0]+8,"WEBP")){Oe=3;break e}var $e=j(l,Pe[0]+4);if(12>$e||4294967286<$e){Oe=3;break e}if(oe&&$e>Ue[0]-8){Oe=7;break e}Oe[0]=$e,Pe[0]+=12,Ue[0]-=12}Oe=0}if(Oe!=0)return Oe;for($e=0<Ce.gb[0],N=N[0];;){e:{var Ye=l;Ue=f,Oe=N;var nt=ie,et=_e,Bt=Pe=[0];if((Tt=De=[De])[0]=0,8>Oe[0])Oe=7;else{if(!e(Ye,Ue[0],"VP8X")){if(j(Ye,Ue[0]+4)!=10){Oe=3;break e}if(18>Oe[0]){Oe=7;break e}var St=j(Ye,Ue[0]+8),nr=1+je(Ye,Ue[0]+12);if(2147483648<=nr*(Ye=1+je(Ye,Ue[0]+15))){Oe=3;break e}Bt!=null&&(Bt[0]=St),nt!=null&&(nt[0]=nr),et!=null&&(et[0]=Ye),Ue[0]+=18,Oe[0]-=18,Tt[0]=1}Oe=0}}if(De=De[0],Pe=Pe[0],Oe!=0)return Oe;if(Ue=!!(2&Pe),!$e&&De)return 3;if(q!=null&&(q[0]=!!(16&Pe)),W!=null&&(W[0]=Ue),J!=null&&(J[0]=0),W=ie[0],Pe=_e[0],De&&Ue&&ee==null){Oe=0;break}if(4>N){Oe=7;break}if($e&&De||!$e&&!De&&!e(l,f[0],"ALPH")){N=[N],Ce.na=[Ce.na],Ce.P=[Ce.P],Ce.Sa=[Ce.Sa];e:{St=l,Oe=f,$e=N;var Tt=Ce.gb;nt=Ce.na,et=Ce.P,Bt=Ce.Sa,nr=22,r(St!=null),r($e!=null),Ye=Oe[0];var lr=$e[0];for(r(nt!=null),r(Bt!=null),nt[0]=null,et[0]=null,Bt[0]=0;;){if(Oe[0]=Ye,$e[0]=lr,8>lr){Oe=7;break e}var gn=j(St,Ye+4);if(4294967286<gn){Oe=3;break e}var sr=8+gn+1&-2;if(nr+=sr,0<Tt&&nr>Tt){Oe=3;break e}if(!e(St,Ye,"VP8 ")||!e(St,Ye,"VP8L")){Oe=0;break e}if(lr[0]<sr){Oe=7;break e}e(St,Ye,"ALPH")||(nt[0]=St,et[0]=Ye+8,Bt[0]=gn),Ye+=sr,lr-=sr}}if(N=N[0],Ce.na=Ce.na[0],Ce.P=Ce.P[0],Ce.Sa=Ce.Sa[0],Oe!=0)break}N=[N],Ce.Ja=[Ce.Ja],Ce.xa=[Ce.xa];e:if(Tt=l,Oe=f,$e=N,nt=Ce.gb[0],et=Ce.Ja,Bt=Ce.xa,St=Oe[0],Ye=!e(Tt,St,"VP8 "),nr=!e(Tt,St,"VP8L"),r(Tt!=null),r($e!=null),r(et!=null),r(Bt!=null),8>$e[0])Oe=7;else{if(Ye||nr){if(Tt=j(Tt,St+4),12<=nt&&Tt>nt-12){Oe=3;break e}if(oe&&Tt>$e[0]-8){Oe=7;break e}et[0]=Tt,Oe[0]+=8,$e[0]-=8,Bt[0]=nr}else Bt[0]=5<=$e[0]&&Tt[St+0]==47&&!(Tt[St+4]>>5),et[0]=$e[0];Oe=0}if(N=N[0],Ce.Ja=Ce.Ja[0],Ce.xa=Ce.xa[0],f=f[0],Oe!=0)break;if(4294967286<Ce.Ja)return 3;if(J==null||Ue||(J[0]=Ce.xa?2:1),W=[W],Pe=[Pe],Ce.xa){if(5>N){Oe=7;break}J=W,oe=Pe,Ue=q,l==null||5>N?l=0:5<=N&&l[f+0]==47&&!(l[f+4]>>5)?($e=[0],Tt=[0],nt=[0],le(et=new H,l,f,N),wn(et,$e,Tt,nt)?(J!=null&&(J[0]=$e[0]),oe!=null&&(oe[0]=Tt[0]),Ue!=null&&(Ue[0]=nt[0]),l=1):l=0):l=0}else{if(10>N){Oe=7;break}J=Pe,l==null||10>N||!He(l,f+3,N-3)?l=0:(oe=l[f+0]|l[f+1]<<8|l[f+2]<<16,Ue=16383&(l[f+7]<<8|l[f+6]),l=16383&(l[f+9]<<8|l[f+8]),1&oe||3<(oe>>1&7)||!(oe>>4&1)||oe>>5>=Ce.Ja||!Ue||!l?l=0:(W&&(W[0]=Ue),J&&(J[0]=l),l=1))}if(!l||(W=W[0],Pe=Pe[0],De&&(ie[0]!=W||_e[0]!=Pe)))return 3;ee!=null&&(ee[0]=Ce,ee.offset=f-ee.w,r(4294967286>f-ee.w),r(ee.offset==ee.ha-N));break}return Oe==0||Oe==7&&De&&ee==null?(q!=null&&(q[0]|=Ce.na!=null&&0<Ce.na.length),S!=null&&(S[0]=W),B!=null&&(B[0]=Pe),0):Oe}function oa(l,f,N){var S=f.width,B=f.height,q=0,W=0,J=S,ee=B;if(f.Da=l!=null&&0<l.Da,f.Da&&(J=l.cd,ee=l.bd,q=l.v,W=l.j,11>N||(q&=-2,W&=-2),0>q||0>W||0>=J||0>=ee||q+J>S||W+ee>B))return 0;if(f.v=q,f.j=W,f.va=q+J,f.o=W+ee,f.U=J,f.T=ee,f.da=l!=null&&0<l.da,f.da){if(!z(J,ee,N=[l.ib],q=[l.hb]))return 0;f.ib=N[0],f.hb=q[0]}return f.ob=l!=null&&l.ob,f.Kb=l==null||!l.Sd,f.da&&(f.ob=f.ib<3*S/4&&f.hb<3*B/4,f.Kb=0),1}function Yi(l){if(l==null)return 2;if(11>l.S){var f=l.f.RGBA;f.fb+=(l.height-1)*f.A,f.A=-f.A}else f=l.f.kb,l=l.height,f.O+=(l-1)*f.fa,f.fa=-f.fa,f.N+=(l-1>>1)*f.Ab,f.Ab=-f.Ab,f.W+=(l-1>>1)*f.Db,f.Db=-f.Db,f.F!=null&&(f.J+=(l-1)*f.lb,f.lb=-f.lb);return 0}function ka(l,f,N,S){if(S==null||0>=l||0>=f)return 2;if(N!=null){if(N.Da){var B=N.cd,q=N.bd,W=-2&N.v,J=-2&N.j;if(0>W||0>J||0>=B||0>=q||W+B>l||J+q>f)return 2;l=B,f=q}if(N.da){if(!z(l,f,B=[N.ib],q=[N.hb]))return 2;l=B[0],f=q[0]}}S.width=l,S.height=f;e:{var ee=S.width,ie=S.height;if(l=S.S,0>=ee||0>=ie||!(l>=So&&13>l))l=2;else{if(0>=S.Rd&&S.sd==null){W=q=B=f=0;var _e=(J=ee*Sd[l])*ie;if(11>l||(q=(ie+1)/2*(f=(ee+1)/2),l==12&&(W=(B=ee)*ie)),(ie=a(_e+2*q+W))==null){l=1;break e}S.sd=ie,11>l?((ee=S.f.RGBA).eb=ie,ee.fb=0,ee.A=J,ee.size=_e):((ee=S.f.kb).y=ie,ee.O=0,ee.fa=J,ee.Fd=_e,ee.f=ie,ee.N=0+_e,ee.Ab=f,ee.Cd=q,ee.ea=ie,ee.W=0+_e+q,ee.Db=f,ee.Ed=q,l==12&&(ee.F=ie,ee.J=0+_e+2*q),ee.Tc=W,ee.lb=B)}if(f=1,B=S.S,q=S.width,W=S.height,B>=So&&13>B)if(11>B)l=S.f.RGBA,f&=(J=Math.abs(l.A))*(W-1)+q<=l.size,f&=J>=q*Sd[B],f&=l.eb!=null;else{l=S.f.kb,J=(q+1)/2,_e=(W+1)/2,ee=Math.abs(l.fa),ie=Math.abs(l.Ab);var De=Math.abs(l.Db),oe=Math.abs(l.lb),Ce=oe*(W-1)+q;f&=ee*(W-1)+q<=l.Fd,f&=ie*(_e-1)+J<=l.Cd,f=(f&=De*(_e-1)+J<=l.Ed)&ee>=q&ie>=J&De>=J,f&=l.y!=null,f&=l.f!=null,f&=l.ea!=null,B==12&&(f&=oe>=q,f&=Ce<=l.Tc,f&=l.F!=null)}else f=0;l=f?0:2}}return l!=0||N!=null&&N.fd&&(l=Yi(S)),l}var Ka=64,ss=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],as=24,Ca=32,la=8,Aa=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];me("Predictor0","PredictorAdd0"),O.Predictor0=function(){return 4278190080},O.Predictor1=function(l){return l},O.Predictor2=function(l,f,N){return f[N+0]},O.Predictor3=function(l,f,N){return f[N+1]},O.Predictor4=function(l,f,N){return f[N-1]},O.Predictor5=function(l,f,N){return Le(Le(l,f[N+1]),f[N+0])},O.Predictor6=function(l,f,N){return Le(l,f[N-1])},O.Predictor7=function(l,f,N){return Le(l,f[N+0])},O.Predictor8=function(l,f,N){return Le(f[N-1],f[N+0])},O.Predictor9=function(l,f,N){return Le(f[N+0],f[N+1])},O.Predictor10=function(l,f,N){return Le(Le(l,f[N-1]),Le(f[N+0],f[N+1]))},O.Predictor11=function(l,f,N){var S=f[N+0];return 0>=Ve(S>>24&255,l>>24&255,(f=f[N-1])>>24&255)+Ve(S>>16&255,l>>16&255,f>>16&255)+Ve(S>>8&255,l>>8&255,f>>8&255)+Ve(255&S,255&l,255&f)?S:l},O.Predictor12=function(l,f,N){var S=f[N+0];return(Ie((l>>24&255)+(S>>24&255)-((f=f[N-1])>>24&255))<<24|Ie((l>>16&255)+(S>>16&255)-(f>>16&255))<<16|Ie((l>>8&255)+(S>>8&255)-(f>>8&255))<<8|Ie((255&l)+(255&S)-(255&f)))>>>0},O.Predictor13=function(l,f,N){var S=f[N-1];return(Te((l=Le(l,f[N+0]))>>24&255,S>>24&255)<<24|Te(l>>16&255,S>>16&255)<<16|Te(l>>8&255,S>>8&255)<<8|Te(255&l,255&S))>>>0};var Ji=O.PredictorAdd0;O.PredictorAdd1=ht,me("Predictor2","PredictorAdd2"),me("Predictor3","PredictorAdd3"),me("Predictor4","PredictorAdd4"),me("Predictor5","PredictorAdd5"),me("Predictor6","PredictorAdd6"),me("Predictor7","PredictorAdd7"),me("Predictor8","PredictorAdd8"),me("Predictor9","PredictorAdd9"),me("Predictor10","PredictorAdd10"),me("Predictor11","PredictorAdd11"),me("Predictor12","PredictorAdd12"),me("Predictor13","PredictorAdd13");var wi=O.PredictorAdd2;dt("ColorIndexInverseTransform","MapARGB","32b",function(l){return l>>8&255},function(l){return l}),dt("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(l){return l},function(l){return l>>8&255});var nn,No=O.ColorIndexInverseTransform,Hs=O.MapARGB,Gs=O.VP8LColorIndexInverseTransformAlpha,Ki=O.MapAlpha,Zi=O.VP8LPredictorsAdd=[];Zi.length=16,(O.VP8LPredictors=[]).length=16,(O.VP8LPredictorsAdd_C=[]).length=16,(O.VP8LPredictors_C=[]).length=16;var Xi,Qi,La,Ea,Pa,Za,Ta,Xa,vs,Vs,br,Er,sn,mn,ca,eo,vi,_o,ed,td,rd,nd,sd,ad,to,id,od,ld,cd=a(511),dd=a(2041),ud=a(225),hd=a(767),fd=0,Cl=dd,jo=ud,is=hd,Ns=cd,So=0,ko=1,pd=2,Co=3,Ao=4,Al=5,md=6,Ll=7,El=8,Lo=9,Pl=10,wp=[2,3,7],vp=[3,3,11],gd=[280,256,256,256,40],Np=[0,1,1,1,0],_p=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],jp=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],Sp=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],kp=8,Tl=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Il=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],ro=null,Cp=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Ap=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],xd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],Lp=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],Ep=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Pp=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],Tp=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ia=[],Es=[],da=[],Ip=1,yd=2,Fa=[],_s=[];Je("UpsampleRgbLinePair",jt,3),Je("UpsampleBgrLinePair",tr,3),Je("UpsampleRgbaLinePair",pr,4),Je("UpsampleBgraLinePair",Nr,4),Je("UpsampleArgbLinePair",yr,4),Je("UpsampleRgba4444LinePair",Dt,2),Je("UpsampleRgb565LinePair",vr,2);var Fp=O.UpsampleRgbLinePair,Op=O.UpsampleBgrLinePair,bd=O.UpsampleRgbaLinePair,wd=O.UpsampleBgraLinePair,vd=O.UpsampleArgbLinePair,Nd=O.UpsampleRgba4444LinePair,Dp=O.UpsampleRgb565LinePair,Eo=16,Po=1<<Eo-1,no=-227,Fl=482,Rp=6,_d=0,Bp=a(256),Mp=a(256),Up=a(256),zp=a(256),qp=a(Fl-no),$p=a(Fl-no);mr("YuvToRgbRow",jt,3),mr("YuvToBgrRow",tr,3),mr("YuvToRgbaRow",pr,4),mr("YuvToBgraRow",Nr,4),mr("YuvToArgbRow",yr,4),mr("YuvToRgba4444Row",Dt,2),mr("YuvToRgb565Row",vr,2);var jd=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],To=[0,2,8],Wp=[8,7,6,4,4,2,2,2,1,1,1,1],Hp=1;this.WebPDecodeRGBA=function(l,f,N,S,B){var q=ko,W=new Ge,J=new Ot;W.ba=J,J.S=q,J.width=[J.width],J.height=[J.height];var ee=J.width,ie=J.height,_e=new xt;if(_e==null||l==null)var De=2;else r(_e!=null),De=gr(l,f,N,_e.width,_e.height,_e.Pd,_e.Qd,_e.format,null);if(De!=0?ee=0:(ee!=null&&(ee[0]=_e.width[0]),ie!=null&&(ie[0]=_e.height[0]),ee=1),ee){J.width=J.width[0],J.height=J.height[0],S!=null&&(S[0]=J.width),B!=null&&(B[0]=J.height);e:{if(S=new Pn,(B=new Ze).data=l,B.w=f,B.ha=N,B.kd=1,f=[0],r(B!=null),((l=gr(B.data,B.w,B.ha,null,null,null,f,null,B))==0||l==7)&&f[0]&&(l=4),(f=l)==0){if(r(W!=null),S.data=B.data,S.w=B.w+B.offset,S.ha=B.ha-B.offset,S.put=Ut,S.ac=tn,S.bc=pn,S.ma=W,B.xa){if((l=En())==null){W=1;break e}if((function(oe,Ce){var Pe=[0],Ue=[0],Oe=[0];t:for(;;){if(oe==null)return 0;if(Ce==null)return oe.a=2,0;if(oe.l=Ce,oe.a=0,le(oe.m,Ce.data,Ce.w,Ce.ha),!wn(oe.m,Pe,Ue,Oe)){oe.a=3;break t}if(oe.xb=yd,Ce.width=Pe[0],Ce.height=Ue[0],!lt(Pe[0],Ue[0],1,oe,null))break t;return 1}return r(oe.a!=0),0})(l,S)){if(S=(f=ka(S.width,S.height,W.Oa,W.ba))==0){t:{S=l;r:for(;;){if(S==null){S=0;break t}if(r(S.s.yc!=null),r(S.s.Ya!=null),r(0<S.s.Wb),r((N=S.l)!=null),r((B=N.ma)!=null),S.xb!=0){if(S.ca=B.ba,S.tb=B.tb,r(S.ca!=null),!oa(B.Oa,N,Co)){S.a=2;break r}if(!Jr(S,N.width)||N.da)break r;if((N.da||Nt(S.ca.S))&&qe(),11>S.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),S.ca.f.kb.F!=null&&qe()),S.Pb&&0<S.s.ua&&S.s.vb.X==null&&!P(S.s.vb,S.s.Wa.Xa)){S.a=1;break r}S.xb=0}if(!Wr(S,S.V,S.Ba,S.c,S.i,N.o,wr))break r;B.Dc=S.Ma,S=1;break t}r(S.a!=0),S=0}S=!S}S&&(f=l.a)}else f=l.a}else{if((l=new ys)==null){W=1;break e}if(l.Fa=B.na,l.P=B.P,l.qc=B.Sa,ft(l,S)){if((f=ka(S.width,S.height,W.Oa,W.ba))==0){if(l.Aa=0,N=W.Oa,r((B=l)!=null),N!=null){if(0<(ee=0>(ee=N.Md)?0:100<ee?255:255*ee/100)){for(ie=_e=0;4>ie;++ie)12>(De=B.pb[ie]).lc&&(De.ia=ee*Wp[0>De.lc?0:De.lc]>>3),_e|=De.ia;_e&&(alert("todo:VP8InitRandom"),B.ia=1)}B.Ga=N.Id,100<B.Ga?B.Ga=100:0>B.Ga&&(B.Ga=0)}(function(oe,Ce){if(oe==null)return 0;if(Ce==null)return Cr(oe,2,"NULL VP8Io parameter in VP8Decode().");if(!oe.cb&&!ft(oe,Ce))return 0;if(r(oe.cb),Ce.ac==null||Ce.ac(Ce)){Ce.ob&&(oe.L=0);var Pe=To[oe.L];if(oe.L==2?(oe.yb=0,oe.zb=0):(oe.yb=Ce.v-Pe>>4,oe.zb=Ce.j-Pe>>4,0>oe.yb&&(oe.yb=0),0>oe.zb&&(oe.zb=0)),oe.Va=Ce.o+15+Pe>>4,oe.Hb=Ce.va+15+Pe>>4,oe.Hb>oe.za&&(oe.Hb=oe.za),oe.Va>oe.Ub&&(oe.Va=oe.Ub),0<oe.L){var Ue=oe.ed;for(Pe=0;4>Pe;++Pe){var Oe;if(oe.Qa.Cb){var $e=oe.Qa.Lb[Pe];oe.Qa.Fb||($e+=Ue.Tb)}else $e=Ue.Tb;for(Oe=0;1>=Oe;++Oe){var Ye=oe.gd[Pe][Oe],nt=$e;if(Ue.Pc&&(nt+=Ue.vd[0],Oe&&(nt+=Ue.od[0])),0<(nt=0>nt?0:63<nt?63:nt)){var et=nt;0<Ue.wb&&(et=4<Ue.wb?et>>2:et>>1)>9-Ue.wb&&(et=9-Ue.wb),1>et&&(et=1),Ye.dd=et,Ye.tc=2*nt+et,Ye.ld=40<=nt?2:15<=nt?1:0}else Ye.tc=0;Ye.La=Oe}}}Pe=0}else Cr(oe,6,"Frame setup failed"),Pe=oe.a;if(Pe=Pe==0){if(Pe){oe.$c=0,0<oe.Aa||(oe.Ic=Hp);t:{Pe=oe.Ic,Ue=4*(et=oe.za);var Bt=32*et,St=et+1,nr=0<oe.L?et*(0<oe.Aa?2:1):0,Tt=(oe.Aa==2?2:1)*et;if((Ye=Ue+832+(Oe=3*(16*Pe+To[oe.L])/2*Bt)+($e=oe.Fa!=null&&0<oe.Fa.length?oe.Kc.c*oe.Kc.i:0))!=Ye)Pe=0;else{if(Ye>oe.Vb){if(oe.Vb=0,oe.Ec=a(Ye),oe.Fc=0,oe.Ec==null){Pe=Cr(oe,1,"no memory during frame initialization.");break t}oe.Vb=Ye}Ye=oe.Ec,nt=oe.Fc,oe.Ac=Ye,oe.Bc=nt,nt+=Ue,oe.Gd=d(Bt,gt),oe.Hd=0,oe.rb=d(St+1,Ct),oe.sb=1,oe.wa=nr?d(nr,it):null,oe.Y=0,oe.D.Nb=0,oe.D.wa=oe.wa,oe.D.Y=oe.Y,0<oe.Aa&&(oe.D.Y+=et),r(!0),oe.oc=Ye,oe.pc=nt,nt+=832,oe.ya=d(Tt,$t),oe.aa=0,oe.D.ya=oe.ya,oe.D.aa=oe.aa,oe.Aa==2&&(oe.D.aa+=et),oe.R=16*et,oe.B=8*et,et=(Bt=To[oe.L])*oe.R,Bt=Bt/2*oe.B,oe.sa=Ye,oe.ta=nt+et,oe.qa=oe.sa,oe.ra=oe.ta+16*Pe*oe.R+Bt,oe.Ha=oe.qa,oe.Ia=oe.ra+8*Pe*oe.B+Bt,oe.$c=0,nt+=Oe,oe.mb=$e?Ye:null,oe.nb=$e?nt:null,r(nt+$e<=oe.Fc+oe.Vb),Hr(oe),i(oe.Ac,oe.Bc,0,Ue),Pe=1}}if(Pe){if(Ce.ka=0,Ce.y=oe.sa,Ce.O=oe.ta,Ce.f=oe.qa,Ce.N=oe.ra,Ce.ea=oe.Ha,Ce.Vd=oe.Ia,Ce.fa=oe.R,Ce.Rc=oe.B,Ce.F=null,Ce.J=0,!fd){for(Pe=-255;255>=Pe;++Pe)cd[255+Pe]=0>Pe?-Pe:Pe;for(Pe=-1020;1020>=Pe;++Pe)dd[1020+Pe]=-128>Pe?-128:127<Pe?127:Pe;for(Pe=-112;112>=Pe;++Pe)ud[112+Pe]=-16>Pe?-16:15<Pe?15:Pe;for(Pe=-255;510>=Pe;++Pe)hd[255+Pe]=0>Pe?0:255<Pe?255:Pe;fd=1}Ta=$s,Xa=wa,Vs=Ir,br=va,Er=Na,vs=Kr,sn=yi,mn=ns,ca=R,eo=ae,vi=bi,_o=x,ed=be,td=Ee,rd=ia,nd=Ja,sd=Sa,ad=xi,Es[0]=$i,Es[1]=$a,Es[2]=pi,Es[3]=mi,Es[4]=Cs,Es[5]=Wi,Es[6]=bs,Es[7]=Hi,Es[8]=ja,Es[9]=na,Ia[0]=hi,Ia[1]=ra,Ia[2]=_a,Ia[3]=ui,Ia[4]=ks,Ia[5]=Wa,Ia[6]=fi,da[0]=Vi,da[1]=di,da[2]=sa,da[3]=Gi,da[4]=Ga,da[5]=Ha,da[6]=gi,Pe=1}else Pe=0}Pe&&(Pe=(function(lr,gn){for(lr.M=0;lr.M<lr.Va;++lr.M){var sr,It=lr.Jc[lr.M&lr.Xb],pt=lr.m,an=lr;for(sr=0;sr<an.za;++sr){var Qt=pt,cr=an,Br=cr.Ac,Cn=cr.Bc+4*sr,zn=cr.zc,Zr=cr.ya[cr.aa+sr];if(cr.Qa.Bb?Zr.$b=Re(Qt,cr.Pa.jb[0])?2+Re(Qt,cr.Pa.jb[2]):Re(Qt,cr.Pa.jb[1]):Zr.$b=0,cr.kc&&(Zr.Ad=Re(Qt,cr.Bd)),Zr.Za=!Re(Qt,145)+0,Zr.Za){var Tn=Zr.Ob,qn=0;for(cr=0;4>cr;++cr){var xn,hr=zn[0+cr];for(xn=0;4>xn;++xn){hr=Ep[Br[Cn+xn]][hr];for(var _r=xd[Re(Qt,hr[0])];0<_r;)_r=xd[2*_r+Re(Qt,hr[_r])];hr=-_r,Br[Cn+xn]=hr}s(Tn,qn,Br,Cn,4),qn+=4,zn[0+cr]=hr}}else hr=Re(Qt,156)?Re(Qt,128)?1:3:Re(Qt,163)?2:0,Zr.Ob[0]=hr,i(Br,Cn,hr,4),i(zn,0,hr,4);Zr.Dd=Re(Qt,142)?Re(Qt,114)?Re(Qt,183)?1:3:2:0}if(an.m.Ka)return Cr(lr,7,"Premature end-of-partition0 encountered.");for(;lr.ja<lr.za;++lr.ja){if(an=It,Qt=(pt=lr).rb[pt.sb-1],Br=pt.rb[pt.sb+pt.ja],sr=pt.ya[pt.aa+pt.ja],Cn=pt.kc?sr.Ad:0)Qt.la=Br.la=0,sr.Za||(Qt.Na=Br.Na=0),sr.Hc=0,sr.Gc=0,sr.ia=0;else{var Xr,jr;if(Qt=Br,Br=an,Cn=pt.Pa.Xc,zn=pt.ya[pt.aa+pt.ja],Zr=pt.pb[zn.$b],cr=zn.ad,Tn=0,qn=pt.rb[pt.sb-1],hr=xn=0,i(cr,Tn,0,384),zn.Za)var An=0,Ps=Cn[3];else{_r=a(16);var on=Qt.Na+qn.Na;if(on=ro(Br,Cn[1],on,Zr.Eb,0,_r,0),Qt.Na=qn.Na=(0<on)+0,1<on)Ta(_r,0,cr,Tn);else{var Kn=_r[0]+3>>3;for(_r=0;256>_r;_r+=16)cr[Tn+_r]=Kn}An=1,Ps=Cn[0]}var Pr=15&Qt.la,yn=15&qn.la;for(_r=0;4>_r;++_r){var os=1&yn;for(Kn=jr=0;4>Kn;++Kn)Pr=Pr>>1|(os=(on=ro(Br,Ps,on=os+(1&Pr),Zr.Sc,An,cr,Tn))>An)<<7,jr=jr<<2|(3<on?3:1<on?2:cr[Tn+0]!=0),Tn+=16;Pr>>=4,yn=yn>>1|os<<7,xn=(xn<<8|jr)>>>0}for(Ps=Pr,An=yn>>4,Xr=0;4>Xr;Xr+=2){for(jr=0,Pr=Qt.la>>4+Xr,yn=qn.la>>4+Xr,_r=0;2>_r;++_r){for(os=1&yn,Kn=0;2>Kn;++Kn)on=os+(1&Pr),Pr=Pr>>1|(os=0<(on=ro(Br,Cn[2],on,Zr.Qc,0,cr,Tn)))<<3,jr=jr<<2|(3<on?3:1<on?2:cr[Tn+0]!=0),Tn+=16;Pr>>=2,yn=yn>>1|os<<5}hr|=jr<<4*Xr,Ps|=Pr<<4<<Xr,An|=(240&yn)<<Xr}Qt.la=Ps,qn.la=An,zn.Hc=xn,zn.Gc=hr,zn.ia=43690&hr?0:Zr.ia,Cn=!(xn|hr)}if(0<pt.L&&(pt.wa[pt.Y+pt.ja]=pt.gd[sr.$b][sr.Za],pt.wa[pt.Y+pt.ja].La|=!Cn),an.Ka)return Cr(lr,7,"Premature end-of-file encountered.")}if(Hr(lr),pt=gn,an=1,sr=(It=lr).D,Qt=0<It.L&&It.M>=It.zb&&It.M<=It.Va,It.Aa==0)t:{if(sr.M=It.M,sr.uc=Qt,rr(It,sr),an=1,sr=(jr=It.D).Nb,Qt=(hr=To[It.L])*It.R,Br=hr/2*It.B,_r=16*sr*It.R,Kn=8*sr*It.B,Cn=It.sa,zn=It.ta-Qt+_r,Zr=It.qa,cr=It.ra-Br+Kn,Tn=It.Ha,qn=It.Ia-Br+Kn,yn=(Pr=jr.M)==0,xn=Pr>=It.Va-1,It.Aa==2&&rr(It,jr),jr.uc)for(os=(on=It).D.M,r(on.D.uc),jr=on.yb;jr<on.Hb;++jr){An=jr,Ps=os;var $n=(ls=(Ln=on).D).Nb;Xr=Ln.R;var ls=ls.wa[ls.Y+An],cs=Ln.sa,Zn=Ln.ta+16*$n*Xr+16*An,ds=ls.dd,Fr=ls.tc;if(Fr!=0)if(r(3<=Fr),Ln.L==1)0<An&&nd(cs,Zn,Xr,Fr+4),ls.La&&ad(cs,Zn,Xr,Fr),0<Ps&&rd(cs,Zn,Xr,Fr+4),ls.La&&sd(cs,Zn,Xr,Fr);else{var us=Ln.B,Ts=Ln.qa,Qa=Ln.ra+8*$n*us+8*An,ua=Ln.Ha,Ln=Ln.Ia+8*$n*us+8*An;$n=ls.ld,0<An&&(mn(cs,Zn,Xr,Fr+4,ds,$n),eo(Ts,Qa,ua,Ln,us,Fr+4,ds,$n)),ls.La&&(_o(cs,Zn,Xr,Fr,ds,$n),td(Ts,Qa,ua,Ln,us,Fr,ds,$n)),0<Ps&&(sn(cs,Zn,Xr,Fr+4,ds,$n),ca(Ts,Qa,ua,Ln,us,Fr+4,ds,$n)),ls.La&&(vi(cs,Zn,Xr,Fr,ds,$n),ed(Ts,Qa,ua,Ln,us,Fr,ds,$n))}}if(It.ia&&alert("todo:DitherRow"),pt.put!=null){if(jr=16*Pr,Pr=16*(Pr+1),yn?(pt.y=It.sa,pt.O=It.ta+_r,pt.f=It.qa,pt.N=It.ra+Kn,pt.ea=It.Ha,pt.W=It.Ia+Kn):(jr-=hr,pt.y=Cn,pt.O=zn,pt.f=Zr,pt.N=cr,pt.ea=Tn,pt.W=qn),xn||(Pr-=hr),Pr>pt.o&&(Pr=pt.o),pt.F=null,pt.J=null,It.Fa!=null&&0<It.Fa.length&&jr<Pr&&(pt.J=ge(It,pt,jr,Pr-jr),pt.F=It.mb,pt.F==null&&pt.F.length==0)){an=Cr(It,3,"Could not decode alpha data.");break t}jr<pt.j&&(hr=pt.j-jr,jr=pt.j,r(!(1&hr)),pt.O+=It.R*hr,pt.N+=It.B*(hr>>1),pt.W+=It.B*(hr>>1),pt.F!=null&&(pt.J+=pt.width*hr)),jr<Pr&&(pt.O+=pt.v,pt.N+=pt.v>>1,pt.W+=pt.v>>1,pt.F!=null&&(pt.J+=pt.v),pt.ka=jr-pt.j,pt.U=pt.va-pt.v,pt.T=Pr-jr,an=pt.put(pt))}sr+1!=It.Ic||xn||(s(It.sa,It.ta-Qt,Cn,zn+16*It.R,Qt),s(It.qa,It.ra-Br,Zr,cr+8*It.B,Br),s(It.Ha,It.Ia-Br,Tn,qn+8*It.B,Br))}if(!an)return Cr(lr,6,"Output aborted.")}return 1})(oe,Ce)),Ce.bc!=null&&Ce.bc(Ce),Pe&=1}return Pe?(oe.cb=0,Pe):0})(l,S)||(f=l.a)}}else f=l.a}f==0&&W.Oa!=null&&W.Oa.fd&&(f=Yi(W.ba))}W=f}q=W!=0?null:11>q?J.f.RGBA.eb:J.f.kb.y}else q=null;return q};var Sd=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function h(O,Q){for(var I="",k=0;k<4;k++)I+=String.fromCharCode(O[Q++]);return I}function p(O,Q){return O[Q+0]|O[Q+1]<<8}function b(O,Q){return(O[Q+0]|O[Q+1]<<8|O[Q+2]<<16)>>>0}function m(O,Q){return(O[Q+0]|O[Q+1]<<8|O[Q+2]<<16|O[Q+3]<<24)>>>0}new c;var u=[0],w=[0],g=[],_=new c,y=t,A=(function(O,Q){var I={},k=0,D=!1,v=0,te=0;if(I.frames=[],!(function(C,H){for(var K=0;K<4;K++)if(C[H+K]!="RIFF".charCodeAt(K))return!0;return!1})(O,Q)){for(m(O,Q+=4),Q+=8;Q<O.length;){var ce=h(O,Q),re=m(O,Q+=4);Q+=4;var se=re+(1&re);switch(ce){case"VP8 ":case"VP8L":I.frames[k]===void 0&&(I.frames[k]={}),(ne=I.frames[k]).src_off=D?te:Q-8,ne.src_size=v+re+8,k++,D&&(D=!1,v=0,te=0);break;case"VP8X":(ne=I.header={}).feature_flags=O[Q];var le=Q+4;ne.canvas_width=1+b(O,le),le+=3,ne.canvas_height=1+b(O,le),le+=3;break;case"ALPH":D=!0,v=se+8,te=Q-8;break;case"ANIM":(ne=I.header).bgcolor=m(O,Q),le=Q+4,ne.loop_count=p(O,le),le+=2;break;case"ANMF":var Se,ne;(ne=I.frames[k]={}).offset_x=2*b(O,Q),Q+=3,ne.offset_y=2*b(O,Q),Q+=3,ne.width=1+b(O,Q),Q+=3,ne.height=1+b(O,Q),Q+=3,ne.duration=b(O,Q),Q+=3,Se=O[Q++],ne.dispose=1&Se,ne.blend=Se>>1&1}ce!="ANMF"&&(Q+=se)}return I}})(y,0);A.response=y,A.rgbaoutput=!0,A.dataurl=!1;var L=A.header?A.header:null,E=A.frames?A.frames:null;if(L){L.loop_counter=L.loop_count,u=[L.canvas_height],w=[L.canvas_width];for(var F=0;F<E.length&&E[F].blend!=0;F++);}var Z=E[0],Y=_.WebPDecodeRGBA(y,Z.src_off,Z.src_size,w,u);Z.rgba=Y,Z.imgwidth=w[0],Z.imgheight=u[0];for(var G=0;G<w[0]*u[0]*4;G++)g[G]=Y[G];return this.width=w,this.height=u,this.data=g,this}(function(t){var r,e,s,i,a,d,o,c,h,p=function(C){return C=C||{},this.isStrokeTransparent=C.isStrokeTransparent||!1,this.strokeOpacity=C.strokeOpacity||1,this.strokeStyle=C.strokeStyle||"#000000",this.fillStyle=C.fillStyle||"#000000",this.isFillTransparent=C.isFillTransparent||!1,this.fillOpacity=C.fillOpacity||1,this.font=C.font||"10px sans-serif",this.textBaseline=C.textBaseline||"alphabetic",this.textAlign=C.textAlign||"left",this.lineWidth=C.lineWidth||1,this.lineJoin=C.lineJoin||"miter",this.lineCap=C.lineCap||"butt",this.path=C.path||[],this.transform=C.transform!==void 0?C.transform.clone():new c,this.globalCompositeOperation=C.globalCompositeOperation||"normal",this.globalAlpha=C.globalAlpha||1,this.clip_path=C.clip_path||[],this.currentPoint=C.currentPoint||new d,this.miterLimit=C.miterLimit||10,this.lastPoint=C.lastPoint||new d,this.lineDashOffset=C.lineDashOffset||0,this.lineDash=C.lineDash||[],this.margin=C.margin||[0,0,0,0],this.prevPageLastElemOffset=C.prevPageLastElemOffset||0,this.ignoreClearRect=typeof C.ignoreClearRect!="boolean"||C.ignoreClearRect,this};t.events.push(["initialized",function(){this.context2d=new b(this),r=this.internal.f2,e=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,a=this.internal.getVerticalCoordinate,d=this.internal.Point,o=this.internal.Rectangle,c=this.internal.Matrix,h=new p}]);var b=function(C){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var H=C;Object.defineProperty(this,"pdf",{get:function(){return H}});var K=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return K},set:function(P){K=!!P}});var X=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return X},set:function(P){X=!!P}});var pe=0;Object.defineProperty(this,"posX",{get:function(){return pe},set:function(P){isNaN(P)||(pe=P)}});var ve=0;Object.defineProperty(this,"posY",{get:function(){return ve},set:function(P){isNaN(P)||(ve=P)}}),Object.defineProperty(this,"margin",{get:function(){return h.margin},set:function(P){var V;typeof P=="number"?V=[P,P,P,P]:((V=new Array(4))[0]=P[0],V[1]=P.length>=2?P[1]:V[0],V[2]=P.length>=3?P[2]:V[0],V[3]=P.length>=4?P[3]:V[1]),h.margin=V}});var ke=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ke},set:function(P){ke=P}});var Ae=0;Object.defineProperty(this,"lastBreak",{get:function(){return Ae},set:function(P){Ae=P}});var Re=[];Object.defineProperty(this,"pageBreaks",{get:function(){return Re},set:function(P){Re=P}}),Object.defineProperty(this,"ctx",{get:function(){return h},set:function(P){P instanceof p&&(h=P)}}),Object.defineProperty(this,"path",{get:function(){return h.path},set:function(P){h.path=P}});var Me=[];Object.defineProperty(this,"ctxStack",{get:function(){return Me},set:function(P){Me=P}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(P){var V;V=m(P),this.ctx.fillStyle=V.style,this.ctx.isFillTransparent=V.a===0,this.ctx.fillOpacity=V.a,this.pdf.setFillColor(V.r,V.g,V.b,{a:V.a}),this.pdf.setTextColor(V.r,V.g,V.b,{a:V.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(P){var V=m(P);this.ctx.strokeStyle=V.style,this.ctx.isStrokeTransparent=V.a===0,this.ctx.strokeOpacity=V.a,V.a===0?this.pdf.setDrawColor(255,255,255):(V.a,this.pdf.setDrawColor(V.r,V.g,V.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(P){["butt","round","square"].indexOf(P)!==-1&&(this.ctx.lineCap=P,this.pdf.setLineCap(P))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(P){isNaN(P)||(this.ctx.lineWidth=P,this.pdf.setLineWidth(P))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(P){["bevel","round","miter"].indexOf(P)!==-1&&(this.ctx.lineJoin=P,this.pdf.setLineJoin(P))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(P){isNaN(P)||(this.ctx.miterLimit=P,this.pdf.setMiterLimit(P))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(P){this.ctx.textBaseline=P}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(P){["right","end","center","left","start"].indexOf(P)!==-1&&(this.ctx.textAlign=P)}});var Ke=null,je=null,j=null;Object.defineProperty(this,"fontFaces",{get:function(){return j},set:function(P){Ke=null,je=null,j=P}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(P){var V;if(this.ctx.font=P,(V=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(P))!==null){var $=V[1];V[2];var z=V[3],M=V[4];V[5];var he=V[6],me=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(M)[2];M=Math.floor(me==="px"?parseFloat(M)*this.pdf.internal.scaleFactor:me==="em"?parseFloat(M)*this.pdf.getFontSize():parseFloat(M)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(M);var de=(function(dt){var Vt,mt,Lt=[],zt=dt.trim();if(zt==="")return fc;if(zt in Gu)return[Gu[zt]];for(;zt!=="";){switch(mt=null,Vt=(zt=Yu(zt)).charAt(0)){case'"':case"'":mt=v2(zt.substring(1),Vt);break;default:mt=N2(zt)}if(mt===null||(Lt.push(mt[0]),(zt=Yu(mt[1]))!==""&&zt.charAt(0)!==","))return fc;zt=zt.replace(/^,/,"")}return Lt})(he);if(this.fontFaces){var Le=(function(dt,Vt){var mt=dt.getFontList(),Lt=JSON.stringify(mt);if(Ke===null||je!==Lt){var zt=(function(Et){var wt=[];return Object.keys(Et).forEach(function(Jt){Et[Jt].forEach(function(Nt){var Ft=null;switch(Nt){case"bold":Ft={family:Jt,weight:"bold"};break;case"italic":Ft={family:Jt,style:"italic"};break;case"bolditalic":Ft={family:Jt,weight:"bold",style:"italic"};break;case"":case"normal":Ft={family:Jt}}Ft!==null&&(Ft.ref={name:Jt,style:Nt},wt.push(Ft))})}),wt})(mt);Ke=(function(Et){for(var wt={},Jt=0;Jt<Et.length;++Jt){var Nt=hc(Et[Jt]),Ft=Nt.family,ar=Nt.stretch,Ot=Nt.style,xt=Nt.weight;wt[Ft]=wt[Ft]||{},wt[Ft][ar]=wt[Ft][ar]||{},wt[Ft][ar][Ot]=wt[Ft][ar][Ot]||{},wt[Ft][ar][Ot][xt]=Nt}return wt})(zt.concat(Vt)),je=Lt}return Ke})(this.pdf,this.fontFaces),Ie=de.map(function(dt){return{family:dt,stretch:"normal",weight:z,style:$}}),Te=(function(dt,Vt,mt){for(var Lt=(mt=mt||{}).defaultFontFamily||"times",zt=Object.assign({},w2,mt.genericFontFamilies||{}),Et=null,wt=null,Jt=0;Jt<Vt.length;++Jt)if(zt[(Et=hc(Vt[Jt])).family]&&(Et.family=zt[Et.family]),dt.hasOwnProperty(Et.family)){wt=dt[Et.family];break}if(!(wt=wt||dt[Lt]))throw new Error("Could not find a font-family for the rule '"+Vu(Et)+"' and default family '"+Lt+"'.");if(wt=(function(Nt,Ft){if(Ft[Nt])return Ft[Nt];var ar=Tc[Nt],Ot=ar<=Tc.normal?-1:1,xt=Hu(Ft,tp,ar,Ot);if(!xt)throw new Error("Could not find a matching font-stretch value for "+Nt);return xt})(Et.stretch,wt),wt=(function(Nt,Ft){if(Ft[Nt])return Ft[Nt];for(var ar=ep[Nt],Ot=0;Ot<ar.length;++Ot)if(Ft[ar[Ot]])return Ft[ar[Ot]];throw new Error("Could not find a matching font-style for "+Nt)})(Et.style,wt),!(wt=(function(Nt,Ft){if(Ft[Nt])return Ft[Nt];if(Nt===400&&Ft[500])return Ft[500];if(Nt===500&&Ft[400])return Ft[400];var ar=b2[Nt],Ot=Hu(Ft,rp,ar,Nt<400?-1:1);if(!Ot)throw new Error("Could not find a matching font-weight for value "+Nt);return Ot})(Et.weight,wt)))throw new Error("Failed to resolve a font for the rule '"+Vu(Et)+"'.");return wt})(Le,Ie);this.pdf.setFont(Te.ref.name,Te.ref.style)}else{var Ve="";(z==="bold"||parseInt(z,10)>=700||$==="bold")&&(Ve="bold"),$==="italic"&&(Ve+="italic"),Ve.length===0&&(Ve="normal");for(var ht="",st={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},ot=0;ot<de.length;ot++){if(this.pdf.internal.getFont(de[ot],Ve,{noFallback:!0,disableWarning:!0})!==void 0){ht=de[ot];break}if(Ve==="bolditalic"&&this.pdf.internal.getFont(de[ot],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ht=de[ot],Ve="bold";else if(this.pdf.internal.getFont(de[ot],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ht=de[ot],Ve="normal";break}}if(ht===""){for(var yt=0;yt<de.length;yt++)if(st[de[yt]]){ht=st[de[yt]];break}}ht=ht===""?"Times":ht,this.pdf.setFont(ht,Ve)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(P){this.ctx.globalCompositeOperation=P}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(P){this.ctx.globalAlpha=P}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(P){this.ctx.lineDashOffset=P,ne.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(P){this.ctx.lineDash=P,ne.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(P){this.ctx.ignoreClearRect=!!P}})};b.prototype.setLineDash=function(C){this.lineDash=C},b.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},b.prototype.fill=function(){E.call(this,"fill",!1)},b.prototype.stroke=function(){E.call(this,"stroke",!1)},b.prototype.beginPath=function(){this.path=[{type:"begin"}]},b.prototype.moveTo=function(C,H){if(isNaN(C)||isNaN(H))throw Tr.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var K=this.ctx.transform.applyToPoint(new d(C,H));this.path.push({type:"mt",x:K.x,y:K.y}),this.ctx.lastPoint=new d(C,H)},b.prototype.closePath=function(){var C=new d(0,0),H=0;for(H=this.path.length-1;H!==-1;H--)if(this.path[H].type==="begin"&&kr(this.path[H+1])==="object"&&typeof this.path[H+1].x=="number"){C=new d(this.path[H+1].x,this.path[H+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new d(C.x,C.y)},b.prototype.lineTo=function(C,H){if(isNaN(C)||isNaN(H))throw Tr.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var K=this.ctx.transform.applyToPoint(new d(C,H));this.path.push({type:"lt",x:K.x,y:K.y}),this.ctx.lastPoint=new d(K.x,K.y)},b.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),E.call(this,null,!0)},b.prototype.quadraticCurveTo=function(C,H,K,X){if(isNaN(K)||isNaN(X)||isNaN(C)||isNaN(H))throw Tr.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var pe=this.ctx.transform.applyToPoint(new d(K,X)),ve=this.ctx.transform.applyToPoint(new d(C,H));this.path.push({type:"qct",x1:ve.x,y1:ve.y,x:pe.x,y:pe.y}),this.ctx.lastPoint=new d(pe.x,pe.y)},b.prototype.bezierCurveTo=function(C,H,K,X,pe,ve){if(isNaN(pe)||isNaN(ve)||isNaN(C)||isNaN(H)||isNaN(K)||isNaN(X))throw Tr.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ke=this.ctx.transform.applyToPoint(new d(pe,ve)),Ae=this.ctx.transform.applyToPoint(new d(C,H)),Re=this.ctx.transform.applyToPoint(new d(K,X));this.path.push({type:"bct",x1:Ae.x,y1:Ae.y,x2:Re.x,y2:Re.y,x:ke.x,y:ke.y}),this.ctx.lastPoint=new d(ke.x,ke.y)},b.prototype.arc=function(C,H,K,X,pe,ve){if(isNaN(C)||isNaN(H)||isNaN(K)||isNaN(X)||isNaN(pe))throw Tr.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ve=!!ve,!this.ctx.transform.isIdentity){var ke=this.ctx.transform.applyToPoint(new d(C,H));C=ke.x,H=ke.y;var Ae=this.ctx.transform.applyToPoint(new d(0,K)),Re=this.ctx.transform.applyToPoint(new d(0,0));K=Math.sqrt(Math.pow(Ae.x-Re.x,2)+Math.pow(Ae.y-Re.y,2))}Math.abs(pe-X)>=2*Math.PI&&(X=0,pe=2*Math.PI),this.path.push({type:"arc",x:C,y:H,radius:K,startAngle:X,endAngle:pe,counterclockwise:ve})},b.prototype.arcTo=function(C,H,K,X,pe){throw new Error("arcTo not implemented.")},b.prototype.rect=function(C,H,K,X){if(isNaN(C)||isNaN(H)||isNaN(K)||isNaN(X))throw Tr.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(C,H),this.lineTo(C+K,H),this.lineTo(C+K,H+X),this.lineTo(C,H+X),this.lineTo(C,H),this.lineTo(C+K,H),this.lineTo(C,H)},b.prototype.fillRect=function(C,H,K,X){if(isNaN(C)||isNaN(H)||isNaN(K)||isNaN(X))throw Tr.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!u.call(this)){var pe={};this.lineCap!=="butt"&&(pe.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(pe.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(C,H,K,X),this.fill(),pe.hasOwnProperty("lineCap")&&(this.lineCap=pe.lineCap),pe.hasOwnProperty("lineJoin")&&(this.lineJoin=pe.lineJoin)}},b.prototype.strokeRect=function(C,H,K,X){if(isNaN(C)||isNaN(H)||isNaN(K)||isNaN(X))throw Tr.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");w.call(this)||(this.beginPath(),this.rect(C,H,K,X),this.stroke())},b.prototype.clearRect=function(C,H,K,X){if(isNaN(C)||isNaN(H)||isNaN(K)||isNaN(X))throw Tr.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(C,H,K,X))},b.prototype.save=function(C){C=typeof C!="boolean"||C;for(var H=this.pdf.internal.getCurrentPageInfo().pageNumber,K=0;K<this.pdf.internal.getNumberOfPages();K++)this.pdf.setPage(K+1),this.pdf.internal.out("q");if(this.pdf.setPage(H),C){this.ctx.fontSize=this.pdf.internal.getFontSize();var X=new p(this.ctx);this.ctxStack.push(this.ctx),this.ctx=X}},b.prototype.restore=function(C){C=typeof C!="boolean"||C;for(var H=this.pdf.internal.getCurrentPageInfo().pageNumber,K=0;K<this.pdf.internal.getNumberOfPages();K++)this.pdf.setPage(K+1),this.pdf.internal.out("Q");this.pdf.setPage(H),C&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},b.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var m=function(C){var H,K,X,pe;if(C.isCanvasGradient===!0&&(C=C.getColor()),!C)return{r:0,g:0,b:0,a:0,style:C};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(C))H=0,K=0,X=0,pe=0;else{var ve=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(C);if(ve!==null)H=parseInt(ve[1]),K=parseInt(ve[2]),X=parseInt(ve[3]),pe=1;else if((ve=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(C))!==null)H=parseInt(ve[1]),K=parseInt(ve[2]),X=parseInt(ve[3]),pe=parseFloat(ve[4]);else{if(pe=1,typeof C=="string"&&C.charAt(0)!=="#"){var ke=new Vf(C);C=ke.ok?ke.toHex():"#000000"}C.length===4?(H=C.substring(1,2),H+=H,K=C.substring(2,3),K+=K,X=C.substring(3,4),X+=X):(H=C.substring(1,3),K=C.substring(3,5),X=C.substring(5,7)),H=parseInt(H,16),K=parseInt(K,16),X=parseInt(X,16)}}return{r:H,g:K,b:X,a:pe,style:C}},u=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},w=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};b.prototype.fillText=function(C,H,K,X){if(isNaN(H)||isNaN(K)||typeof C!="string")throw Tr.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(X=isNaN(X)?void 0:X,!u.call(this)){var pe=se(this.ctx.transform.rotation),ve=this.ctx.transform.scaleX;k.call(this,{text:C,x:H,y:K,scale:ve,angle:pe,align:this.textAlign,maxWidth:X})}},b.prototype.strokeText=function(C,H,K,X){if(isNaN(H)||isNaN(K)||typeof C!="string")throw Tr.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!w.call(this)){X=isNaN(X)?void 0:X;var pe=se(this.ctx.transform.rotation),ve=this.ctx.transform.scaleX;k.call(this,{text:C,x:H,y:K,scale:ve,renderingMode:"stroke",angle:pe,align:this.textAlign,maxWidth:X})}},b.prototype.measureText=function(C){if(typeof C!="string")throw Tr.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var H=this.pdf,K=this.pdf.internal.scaleFactor,X=H.internal.getFontSize(),pe=H.getStringUnitWidth(C)*X/H.internal.scaleFactor;return new function(ve){var ke=(ve=ve||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ke}}),this}({width:pe*=Math.round(96*K/72*1e4)/1e4})},b.prototype.scale=function(C,H){if(isNaN(C)||isNaN(H))throw Tr.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var K=new c(C,0,0,H,0,0);this.ctx.transform=this.ctx.transform.multiply(K)},b.prototype.rotate=function(C){if(isNaN(C))throw Tr.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var H=new c(Math.cos(C),Math.sin(C),-Math.sin(C),Math.cos(C),0,0);this.ctx.transform=this.ctx.transform.multiply(H)},b.prototype.translate=function(C,H){if(isNaN(C)||isNaN(H))throw Tr.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var K=new c(1,0,0,1,C,H);this.ctx.transform=this.ctx.transform.multiply(K)},b.prototype.transform=function(C,H,K,X,pe,ve){if(isNaN(C)||isNaN(H)||isNaN(K)||isNaN(X)||isNaN(pe)||isNaN(ve))throw Tr.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ke=new c(C,H,K,X,pe,ve);this.ctx.transform=this.ctx.transform.multiply(ke)},b.prototype.setTransform=function(C,H,K,X,pe,ve){C=isNaN(C)?1:C,H=isNaN(H)?0:H,K=isNaN(K)?0:K,X=isNaN(X)?1:X,pe=isNaN(pe)?0:pe,ve=isNaN(ve)?0:ve,this.ctx.transform=new c(C,H,K,X,pe,ve)};var g=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};b.prototype.drawImage=function(C,H,K,X,pe,ve,ke,Ae,Re){var Me=this.pdf.getImageProperties(C),Ke=1,je=1,j=1,P=1;X!==void 0&&Ae!==void 0&&(j=Ae/X,P=Re/pe,Ke=Me.width/X*Ae/X,je=Me.height/pe*Re/pe),ve===void 0&&(ve=H,ke=K,H=0,K=0),X!==void 0&&Ae===void 0&&(Ae=X,Re=pe),X===void 0&&Ae===void 0&&(Ae=Me.width,Re=Me.height);var V=this.ctx.transform.decompose(),$=se(V.rotate.shx),z=new c,M=(z=(z=(z=z.multiply(V.translate)).multiply(V.skew)).multiply(V.scale)).applyToRectangle(new o(ve-H*j,ke-K*P,X*Ke,pe*je));if(this.autoPaging){for(var he,me=_.call(this,M),de=[],Le=0;Le<me.length;Le+=1)de.indexOf(me[Le])===-1&&de.push(me[Le]);L(de);for(var Ie=de[0],Te=de[de.length-1],Ve=Ie;Ve<Te+1;Ve++){this.pdf.setPage(Ve);var ht=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],st=Ve===1?this.posY+this.margin[0]:this.margin[0],ot=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],yt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],dt=Ve===1?0:ot+(Ve-2)*yt;if(this.ctx.clip_path.length!==0){var Vt=this.path;he=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=A(he,this.posX+this.margin[3],-dt+st+this.ctx.prevPageLastElemOffset),F.call(this,"fill",!0),this.path=Vt}var mt=JSON.parse(JSON.stringify(M));mt=A([mt],this.posX+this.margin[3],-dt+st+this.ctx.prevPageLastElemOffset)[0];var Lt=(Ve>Ie||Ve<Te)&&g.call(this);Lt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ht,yt,null).clip().discardPath()),this.pdf.addImage(C,"JPEG",mt.x,mt.y,mt.w,mt.h,null,null,$),Lt&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(C,"JPEG",M.x,M.y,M.w,M.h,null,null,$)};var _=function(C,H,K){var X=[];H=H||this.pdf.internal.pageSize.width,K=K||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var pe=this.posY+this.ctx.prevPageLastElemOffset;switch(C.type){default:case"mt":case"lt":X.push(Math.floor((C.y+pe)/K)+1);break;case"arc":X.push(Math.floor((C.y+pe-C.radius)/K)+1),X.push(Math.floor((C.y+pe+C.radius)/K)+1);break;case"qct":var ve=le(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x,C.y);X.push(Math.floor((ve.y+pe)/K)+1),X.push(Math.floor((ve.y+ve.h+pe)/K)+1);break;case"bct":var ke=Se(this.ctx.lastPoint.x,this.ctx.lastPoint.y,C.x1,C.y1,C.x2,C.y2,C.x,C.y);X.push(Math.floor((ke.y+pe)/K)+1),X.push(Math.floor((ke.y+ke.h+pe)/K)+1);break;case"rect":X.push(Math.floor((C.y+pe)/K)+1),X.push(Math.floor((C.y+C.h+pe)/K)+1)}for(var Ae=0;Ae<X.length;Ae+=1)for(;this.pdf.internal.getNumberOfPages()<X[Ae];)y.call(this);return X},y=function(){var C=this.fillStyle,H=this.strokeStyle,K=this.font,X=this.lineCap,pe=this.lineWidth,ve=this.lineJoin;this.pdf.addPage(),this.fillStyle=C,this.strokeStyle=H,this.font=K,this.lineCap=X,this.lineWidth=pe,this.lineJoin=ve},A=function(C,H,K){for(var X=0;X<C.length;X++)switch(C[X].type){case"bct":C[X].x2+=H,C[X].y2+=K;case"qct":C[X].x1+=H,C[X].y1+=K;default:C[X].x+=H,C[X].y+=K}return C},L=function(C){return C.sort(function(H,K){return H-K})},E=function(C,H){var K=this.fillStyle,X=this.strokeStyle,pe=this.lineCap,ve=this.lineWidth,ke=Math.abs(ve*this.ctx.transform.scaleX),Ae=this.lineJoin;if(this.autoPaging){for(var Re,Me,Ke=JSON.parse(JSON.stringify(this.path)),je=JSON.parse(JSON.stringify(this.path)),j=[],P=0;P<je.length;P++)if(je[P].x!==void 0)for(var V=_.call(this,je[P]),$=0;$<V.length;$+=1)j.indexOf(V[$])===-1&&j.push(V[$]);for(var z=0;z<j.length;z++)for(;this.pdf.internal.getNumberOfPages()<j[z];)y.call(this);L(j);for(var M=j[0],he=j[j.length-1],me=M;me<he+1;me++){this.pdf.setPage(me),this.fillStyle=K,this.strokeStyle=X,this.lineCap=pe,this.lineWidth=ke,this.lineJoin=Ae;var de=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Le=me===1?this.posY+this.margin[0]:this.margin[0],Ie=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Te=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ve=me===1?0:Ie+(me-2)*Te;if(this.ctx.clip_path.length!==0){var ht=this.path;Re=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=A(Re,this.posX+this.margin[3],-Ve+Le+this.ctx.prevPageLastElemOffset),F.call(this,C,!0),this.path=ht}if(Me=JSON.parse(JSON.stringify(Ke)),this.path=A(Me,this.posX+this.margin[3],-Ve+Le+this.ctx.prevPageLastElemOffset),H===!1||me===0){var st=(me>M||me<he)&&g.call(this);st&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],de,Te,null).clip().discardPath()),F.call(this,C,H),st&&this.pdf.restoreGraphicsState()}this.lineWidth=ve}this.path=Ke}else this.lineWidth=ke,F.call(this,C,H),this.lineWidth=ve},F=function(C,H){if((C!=="stroke"||H||!w.call(this))&&(C==="stroke"||H||!u.call(this))){for(var K,X,pe=[],ve=this.path,ke=0;ke<ve.length;ke++){var Ae=ve[ke];switch(Ae.type){case"begin":pe.push({begin:!0});break;case"close":pe.push({close:!0});break;case"mt":pe.push({start:Ae,deltas:[],abs:[]});break;case"lt":var Re=pe.length;if(ve[ke-1]&&!isNaN(ve[ke-1].x)&&(K=[Ae.x-ve[ke-1].x,Ae.y-ve[ke-1].y],Re>0)){for(;Re>=0;Re--)if(pe[Re-1].close!==!0&&pe[Re-1].begin!==!0){pe[Re-1].deltas.push(K),pe[Re-1].abs.push(Ae);break}}break;case"bct":K=[Ae.x1-ve[ke-1].x,Ae.y1-ve[ke-1].y,Ae.x2-ve[ke-1].x,Ae.y2-ve[ke-1].y,Ae.x-ve[ke-1].x,Ae.y-ve[ke-1].y],pe[pe.length-1].deltas.push(K);break;case"qct":var Me=ve[ke-1].x+2/3*(Ae.x1-ve[ke-1].x),Ke=ve[ke-1].y+2/3*(Ae.y1-ve[ke-1].y),je=Ae.x+2/3*(Ae.x1-Ae.x),j=Ae.y+2/3*(Ae.y1-Ae.y),P=Ae.x,V=Ae.y;K=[Me-ve[ke-1].x,Ke-ve[ke-1].y,je-ve[ke-1].x,j-ve[ke-1].y,P-ve[ke-1].x,V-ve[ke-1].y],pe[pe.length-1].deltas.push(K);break;case"arc":pe.push({deltas:[],abs:[],arc:!0}),Array.isArray(pe[pe.length-1].abs)&&pe[pe.length-1].abs.push(Ae)}}X=H?null:C==="stroke"?"stroke":"fill";for(var $=!1,z=0;z<pe.length;z++)if(pe[z].arc)for(var M=pe[z].abs,he=0;he<M.length;he++){var me=M[he];me.type==="arc"?G.call(this,me.x,me.y,me.radius,me.startAngle,me.endAngle,me.counterclockwise,void 0,H,!$):D.call(this,me.x,me.y),$=!0}else if(pe[z].close===!0)this.pdf.internal.out("h"),$=!1;else if(pe[z].begin!==!0){var de=pe[z].start.x,Le=pe[z].start.y;v.call(this,pe[z].deltas,de,Le),$=!0}X&&O.call(this,X),H&&Q.call(this)}},Z=function(C){var H=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,K=H*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return C-K;case"top":return C+H-K;case"hanging":return C+H-2*K;case"middle":return C+H/2-K;default:return C}},Y=function(C){return C+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};b.prototype.createLinearGradient=function(){var C=function(){};return C.colorStops=[],C.addColorStop=function(H,K){this.colorStops.push([H,K])},C.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},C.isCanvasGradient=!0,C},b.prototype.createPattern=function(){return this.createLinearGradient()},b.prototype.createRadialGradient=function(){return this.createLinearGradient()};var G=function(C,H,K,X,pe,ve,ke,Ae,Re){for(var Me=ce.call(this,K,X,pe,ve),Ke=0;Ke<Me.length;Ke++){var je=Me[Ke];Ke===0&&(Re?I.call(this,je.x1+C,je.y1+H):D.call(this,je.x1+C,je.y1+H)),te.call(this,C,H,je.x2,je.y2,je.x3,je.y3,je.x4,je.y4)}Ae?Q.call(this):O.call(this,ke)},O=function(C){switch(C){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Q=function(){this.pdf.clip(),this.pdf.discardPath()},I=function(C,H){this.pdf.internal.out(e(C)+" "+s(H)+" m")},k=function(C){var H;switch(C.align){case"right":case"end":H="right";break;case"center":H="center";break;default:H="left"}var K,X,pe,ve=this.pdf.getTextDimensions(C.text),ke=Z.call(this,C.y),Ae=Y.call(this,ke)-ve.h,Re=this.ctx.transform.applyToPoint(new d(C.x,ke));if(this.autoPaging){var Me=this.ctx.transform.decompose(),Ke=new c;Ke=(Ke=(Ke=Ke.multiply(Me.translate)).multiply(Me.skew)).multiply(Me.scale);for(var je=this.ctx.transform.applyToRectangle(new o(C.x,ke,ve.w,ve.h)),j=Ke.applyToRectangle(new o(C.x,Ae,ve.w,ve.h)),P=_.call(this,j),V=[],$=0;$<P.length;$+=1)V.indexOf(P[$])===-1&&V.push(P[$]);L(V);for(var z=V[0],M=V[V.length-1],he=z;he<M+1;he++){this.pdf.setPage(he);var me=he===1?this.posY+this.margin[0]:this.margin[0],de=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Le=this.pdf.internal.pageSize.height-this.margin[2],Ie=Le-this.margin[0],Te=this.pdf.internal.pageSize.width-this.margin[1],Ve=Te-this.margin[3],ht=he===1?0:de+(he-2)*Ie;if(this.ctx.clip_path.length!==0){var st=this.path;K=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=A(K,this.posX+this.margin[3],-1*ht+me),F.call(this,"fill",!0),this.path=st}var ot=A([JSON.parse(JSON.stringify(j))],this.posX+this.margin[3],-ht+me+this.ctx.prevPageLastElemOffset)[0];C.scale>=.01&&(X=this.pdf.internal.getFontSize(),this.pdf.setFontSize(X*C.scale),pe=this.lineWidth,this.lineWidth=pe*C.scale);var yt=this.autoPaging!=="text";if(yt||ot.y+ot.h<=Le){if(yt||ot.y>=me&&ot.x<=Te){var dt=yt?C.text:this.pdf.splitTextToSize(C.text,C.maxWidth||Te-ot.x)[0],Vt=A([JSON.parse(JSON.stringify(je))],this.posX+this.margin[3],-ht+me+this.ctx.prevPageLastElemOffset)[0],mt=yt&&(he>z||he<M)&&g.call(this);mt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ve,Ie,null).clip().discardPath()),this.pdf.text(dt,Vt.x,Vt.y,{angle:C.angle,align:H,renderingMode:C.renderingMode}),mt&&this.pdf.restoreGraphicsState()}}else ot.y<Le&&(this.ctx.prevPageLastElemOffset+=Le-ot.y);C.scale>=.01&&(this.pdf.setFontSize(X),this.lineWidth=pe)}}else C.scale>=.01&&(X=this.pdf.internal.getFontSize(),this.pdf.setFontSize(X*C.scale),pe=this.lineWidth,this.lineWidth=pe*C.scale),this.pdf.text(C.text,Re.x+this.posX,Re.y+this.posY,{angle:C.angle,align:H,renderingMode:C.renderingMode,maxWidth:C.maxWidth}),C.scale>=.01&&(this.pdf.setFontSize(X),this.lineWidth=pe)},D=function(C,H,K,X){K=K||0,X=X||0,this.pdf.internal.out(e(C+K)+" "+s(H+X)+" l")},v=function(C,H,K){return this.pdf.lines(C,H,K,null,null)},te=function(C,H,K,X,pe,ve,ke,Ae){this.pdf.internal.out([r(i(K+C)),r(a(X+H)),r(i(pe+C)),r(a(ve+H)),r(i(ke+C)),r(a(Ae+H)),"c"].join(" "))},ce=function(C,H,K,X){for(var pe=2*Math.PI,ve=Math.PI/2;H>K;)H-=pe;var ke=Math.abs(K-H);ke<pe&&X&&(ke=pe-ke);for(var Ae=[],Re=X?-1:1,Me=H;ke>1e-5;){var Ke=Me+Re*Math.min(ke,ve);Ae.push(re.call(this,C,Me,Ke)),ke-=Math.abs(Ke-Me),Me=Ke}return Ae},re=function(C,H,K){var X=(K-H)/2,pe=C*Math.cos(X),ve=C*Math.sin(X),ke=pe,Ae=-ve,Re=ke*ke+Ae*Ae,Me=Re+ke*pe+Ae*ve,Ke=4/3*(Math.sqrt(2*Re*Me)-Me)/(ke*ve-Ae*pe),je=ke-Ke*Ae,j=Ae+Ke*ke,P=je,V=-j,$=X+H,z=Math.cos($),M=Math.sin($);return{x1:C*Math.cos(H),y1:C*Math.sin(H),x2:je*z-j*M,y2:je*M+j*z,x3:P*z-V*M,y3:P*M+V*z,x4:C*Math.cos(K),y4:C*Math.sin(K)}},se=function(C){return 180*C/Math.PI},le=function(C,H,K,X,pe,ve){var ke=C+.5*(K-C),Ae=H+.5*(X-H),Re=pe+.5*(K-pe),Me=ve+.5*(X-ve),Ke=Math.min(C,pe,ke,Re),je=Math.max(C,pe,ke,Re),j=Math.min(H,ve,Ae,Me),P=Math.max(H,ve,Ae,Me);return new o(Ke,j,je-Ke,P-j)},Se=function(C,H,K,X,pe,ve,ke,Ae){var Re,Me,Ke,je,j,P,V,$,z,M,he,me,de,Le,Ie=K-C,Te=X-H,Ve=pe-K,ht=ve-X,st=ke-pe,ot=Ae-ve;for(Me=0;Me<41;Me++)z=(V=(Ke=C+(Re=Me/40)*Ie)+Re*((j=K+Re*Ve)-Ke))+Re*(j+Re*(pe+Re*st-j)-V),M=($=(je=H+Re*Te)+Re*((P=X+Re*ht)-je))+Re*(P+Re*(ve+Re*ot-P)-$),Me==0?(he=z,me=M,de=z,Le=M):(he=Math.min(he,z),me=Math.min(me,M),de=Math.max(de,z),Le=Math.max(Le,M));return new o(Math.round(he),Math.round(me),Math.round(de-he),Math.round(Le-me))},ne=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var C,H,K=(C=this.ctx.lineDash,H=this.ctx.lineDashOffset,JSON.stringify({lineDash:C,lineDashOffset:H}));this.prevLineDash!==K&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=K)}}})(Mt.API),(function(t){var r=function(d){var o,c,h,p,b,m,u,w,g,_;for(c=[],h=0,p=(d+=o="\0\0\0\0".slice(d.length%4||4)).length;p>h;h+=4)(b=(d.charCodeAt(h)<<24)+(d.charCodeAt(h+1)<<16)+(d.charCodeAt(h+2)<<8)+d.charCodeAt(h+3))!==0?(m=(b=((b=((b=((b=(b-(_=b%85))/85)-(g=b%85))/85)-(w=b%85))/85)-(u=b%85))/85)%85,c.push(m+33,u+33,w+33,g+33,_+33)):c.push(122);return(function(y,A){for(var L=A;L>0;L--)y.pop()})(c,o.length),String.fromCharCode.apply(String,c)+"~>"},e=function(d){var o,c,h,p,b,m=String,u="length",w=255,g="charCodeAt",_="slice",y="replace";for(d[_](-2),d=d[_](0,-2)[y](/\s/g,"")[y]("z","!!!!!"),h=[],p=0,b=(d+=o="uuuuu"[_](d[u]%5||5))[u];b>p;p+=5)c=52200625*(d[g](p)-33)+614125*(d[g](p+1)-33)+7225*(d[g](p+2)-33)+85*(d[g](p+3)-33)+(d[g](p+4)-33),h.push(w&c>>24,w&c>>16,w&c>>8,w&c);return(function(A,L){for(var E=L;E>0;E--)A.pop()})(h,o[u]),m.fromCharCode.apply(m,h)},s=function(d){return d.split("").map(function(o){return("0"+o.charCodeAt().toString(16)).slice(-2)}).join("")+">"},i=function(d){var o=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((d=d.replace(/\s/g,"")).indexOf(">")!==-1&&(d=d.substr(0,d.indexOf(">"))),d.length%2&&(d+="0"),o.test(d)===!1)return"";for(var c="",h=0;h<d.length;h+=2)c+=String.fromCharCode("0x"+(d[h]+d[h+1]));return c},a=function(d){for(var o=new Uint8Array(d.length),c=d.length;c--;)o[c]=d.charCodeAt(c);return(o=Sc(o)).reduce(function(h,p){return h+String.fromCharCode(p)},"")};t.processDataByFilters=function(d,o){var c=0,h=d||"",p=[];for(typeof(o=o||[])=="string"&&(o=[o]),c=0;c<o.length;c+=1)switch(o[c]){case"ASCII85Decode":case"/ASCII85Decode":h=e(h),p.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":h=r(h),p.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":h=i(h),p.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":h=s(h),p.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":h=a(h),p.push("/FlateDecode");break;default:throw new Error('The filter: "'+o[c]+'" is not implemented')}return{data:h,reverseChain:p.reverse().join(" ")}}})(Mt.API),(function(t){t.loadFile=function(r,e,s){return(function(i,a,d){a=a!==!1,d=typeof d=="function"?d:function(){};var o=void 0;try{o=(function(c,h,p){var b=new XMLHttpRequest,m=0,u=function(w){var g=w.length,_=[],y=String.fromCharCode;for(m=0;m<g;m+=1)_.push(y(255&w.charCodeAt(m)));return _.join("")};if(b.open("GET",c,!h),b.overrideMimeType("text/plain; charset=x-user-defined"),h===!1&&(b.onload=function(){b.status===200?p(u(this.responseText)):p(void 0)}),b.send(null),h&&b.status===200)return u(b.responseText)})(i,a,d)}catch{}return o})(r,e,s)},t.allowFsRead=void 0,t.loadImageFile=t.loadFile})(Mt.API),(function(t){function r(){return(Gt.html2canvas?Promise.resolve(Gt.html2canvas):Yl(()=>import("./html2canvas.esm-QH1iLAAe.js"),[])).catch(function(o){return Promise.reject(new Error("Could not load html2canvas: "+o))}).then(function(o){return o.default?o.default:o})}function e(){return(Gt.DOMPurify?Promise.resolve(Gt.DOMPurify):Yl(()=>import("./purify.es-B9ZVCkUG.js"),[])).catch(function(o){return Promise.reject(new Error("Could not load dompurify: "+o))}).then(function(o){return o.default?o.default:o})}var s=function(o){var c=kr(o);return c==="undefined"?"undefined":c==="string"||o instanceof String?"string":c==="number"||o instanceof Number?"number":c==="function"||o instanceof Function?"function":o&&o.constructor===Array?"array":o&&o.nodeType===1?"element":c==="object"?"object":"unknown"},i=function(o,c){var h=document.createElement(o);for(var p in c.className&&(h.className=c.className),c.innerHTML&&c.dompurify&&(h.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)h.style[p]=c.style[p];return h},a=function o(c,h){for(var p=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),b=c.firstChild;b;b=b.nextSibling)h!==!0&&b.nodeType===1&&b.nodeName==="SCRIPT"||p.appendChild(o(b,h));return c.nodeType===1&&(c.nodeName==="CANVAS"?(p.width=c.width,p.height=c.height,p.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(p.value=c.value),p.addEventListener("load",function(){p.scrollTop=c.scrollTop,p.scrollLeft=c.scrollLeft},!0)),p},d=function o(c){var h=Object.assign(o.convert(Promise.resolve()),JSON.parse(JSON.stringify(o.template))),p=o.convert(Promise.resolve(),h);return(p=p.setProgress(1,o,1,[o])).set(c)};(d.prototype=Object.create(Promise.prototype)).constructor=d,d.convert=function(o,c){return o.__proto__=c||d.prototype,o},d.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},d.prototype.from=function(o,c){return this.then(function(){switch(c=c||(function(h){switch(s(h)){case"string":return"string";case"element":return h.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(o),c){case"string":return this.then(e).then(function(h){return this.set({src:i("div",{innerHTML:o,dompurify:h})})});case"element":return this.set({src:o});case"canvas":return this.set({canvas:o});case"img":return this.set({img:o});default:return this.error("Unknown source type.")}})},d.prototype.to=function(o){switch(o){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},d.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var o={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=a(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(o.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:o}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},d.prototype.toCanvas=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(r).then(function(c){var h=Object.assign({},this.opt.html2canvas);return delete h.onrendered,c(this.prop.container,h)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},d.prototype.toContext2d=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(r).then(function(c){var h=this.opt.jsPDF,p=this.opt.fontFaces,b=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,m=Object.assign({async:!0,allowTaint:!0,scale:b,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete m.onrendered,h.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,h.context2d.posX=this.opt.x,h.context2d.posY=this.opt.y,h.context2d.margin=this.opt.margin,h.context2d.fontFaces=p,p)for(var u=0;u<p.length;++u){var w=p[u],g=w.src.find(function(_){return _.format==="truetype"});g&&h.addFont(g.url,w.ref.name,w.ref.style)}return m.windowHeight=m.windowHeight||0,m.windowHeight=m.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):m.windowHeight,h.context2d.save(!0),c(this.prop.container,m)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},d.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var o=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=o})},d.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},d.prototype.output=function(o,c,h){return(h=h||"pdf").toLowerCase()==="img"||h.toLowerCase()==="image"?this.outputImg(o,c):this.outputPdf(o,c)},d.prototype.outputPdf=function(o,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(o,c)})},d.prototype.outputImg=function(o){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(o){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+o+'" is not supported.'}})},d.prototype.save=function(o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(o?{filename:o}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},d.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},d.prototype.set=function(o){if(s(o)!=="object")return this;var c=Object.keys(o||{}).map(function(h){if(h in d.template.prop)return function(){this.prop[h]=o[h]};switch(h){case"margin":return this.setMargin.bind(this,o.margin);case"jsPDF":return function(){return this.opt.jsPDF=o.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,o.pageSize);default:return function(){this.opt[h]=o[h]}}},this);return this.then(function(){return this.thenList(c)})},d.prototype.get=function(o,c){return this.then(function(){var h=o in d.template.prop?this.prop[o]:this.opt[o];return c?c(h):h})},d.prototype.setMargin=function(o){return this.then(function(){switch(s(o)){case"number":o=[o,o,o,o];case"array":if(o.length===2&&(o=[o[0],o[1],o[0],o[1]]),o.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=o}).then(this.setPageSize)},d.prototype.setPageSize=function(o){function c(h,p){return Math.floor(h*p/72*96)}return this.then(function(){(o=o||Mt.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(o.inner={width:o.width-this.opt.margin[1]-this.opt.margin[3],height:o.height-this.opt.margin[0]-this.opt.margin[2]},o.inner.px={width:c(o.inner.width,o.k),height:c(o.inner.height,o.k)},o.inner.ratio=o.inner.height/o.inner.width),this.prop.pageSize=o})},d.prototype.setProgress=function(o,c,h,p){return o!=null&&(this.progress.val=o),c!=null&&(this.progress.state=c),h!=null&&(this.progress.n=h),p!=null&&(this.progress.stack=p),this.progress.ratio=this.progress.val/this.progress.state,this},d.prototype.updateProgress=function(o,c,h,p){return this.setProgress(o?this.progress.val+o:null,c||null,h?this.progress.n+h:null,p?this.progress.stack.concat(p):null)},d.prototype.then=function(o,c){var h=this;return this.thenCore(o,c,function(p,b){return h.updateProgress(null,null,1,[p]),Promise.prototype.then.call(this,function(m){return h.updateProgress(null,p),m}).then(p,b).then(function(m){return h.updateProgress(1),m})})},d.prototype.thenCore=function(o,c,h){h=h||Promise.prototype.then;var p=this;o&&(o=o.bind(p)),c&&(c=c.bind(p));var b=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?p:d.convert(Object.assign({},p),Promise.prototype),m=h.call(b,o,c);return d.convert(m,p.__proto__)},d.prototype.thenExternal=function(o,c){return Promise.prototype.then.call(this,o,c)},d.prototype.thenList=function(o){var c=this;return o.forEach(function(h){c=c.thenCore(h)}),c},d.prototype.catch=function(o){o&&(o=o.bind(this));var c=Promise.prototype.catch.call(this,o);return d.convert(c,this)},d.prototype.catchExternal=function(o){return Promise.prototype.catch.call(this,o)},d.prototype.error=function(o){return this.then(function(){throw new Error(o)})},d.prototype.using=d.prototype.set,d.prototype.saveAs=d.prototype.save,d.prototype.export=d.prototype.output,d.prototype.run=d.prototype.then,Mt.getPageSize=function(o,c,h){if(kr(o)==="object"){var p=o;o=p.orientation,c=p.unit||c,h=p.format||h}c=c||"mm",h=h||"a4",o=(""+(o||"P")).toLowerCase();var b,m=(""+h).toLowerCase(),u={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":b=1;break;case"mm":b=72/25.4;break;case"cm":b=72/2.54;break;case"in":b=72;break;case"px":b=.75;break;case"pc":case"em":b=12;break;case"ex":b=6;break;default:throw"Invalid unit: "+c}var w,g=0,_=0;if(u.hasOwnProperty(m))g=u[m][1]/b,_=u[m][0]/b;else try{g=h[1],_=h[0]}catch{throw new Error("Invalid format: "+h)}if(o==="p"||o==="portrait")o="p",_>g&&(w=_,_=g,g=w);else{if(o!=="l"&&o!=="landscape")throw"Invalid orientation: "+o;o="l",g>_&&(w=_,_=g,g=w)}return{width:_,height:g,unit:c,k:b,orientation:o}},t.html=function(o,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(hc):null;var h=new d(c);return c.worker?h:h.from(o).doCallback()}})(Mt.API),Mt.API.addJS=function(t){return Ku=t,this.internal.events.subscribe("postPutResources",function(){Xo=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Xo+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),Ju=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Ku+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Xo!==void 0&&Ju!==void 0&&this.internal.out("/Names <</JavaScript "+Xo+" 0 R>>")}),this},(function(t){var r;t.events.push(["postPutResources",function(){var e=this,s=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=e.outline.render().split(/\r\n/),a=0;a<i.length;a++){var d=i[a],o=s.exec(d);if(o!=null){var c=o[1];e.internal.newObjectDeferredBegin(c,!1)}e.internal.write(d)}if(this.outline.createNamedDestinations){var h=this.internal.pages.length,p=[];for(a=0;a<h;a++){var b=e.internal.newObject();p.push(b);var m=e.internal.getPageInfo(a+1);e.internal.write("<< /D["+m.objId+" 0 R /XYZ null null null]>> endobj")}var u=e.internal.newObject();for(e.internal.write("<< /Names [ "),a=0;a<p.length;a++)e.internal.write("(page_"+(a+1)+")"+p[a]+" 0 R");e.internal.write(" ] >>","endobj"),r=e.internal.newObject(),e.internal.write("<< /Dests "+u+" 0 R"),e.internal.write(">>","endobj")}}]),t.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+r+" 0 R"))}]),t.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(s,i,a){var d={title:i,options:a,children:[]};return s==null&&(s=this.root),s.children.push(d),d},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(s){s.id=e.internal.newObjectDeferred();for(var i=0;i<s.children.length;i++)this.genIds_r(s.children[i])},e.outline.renderRoot=function(s){this.objStart(s),this.line("/Type /Outlines"),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1]))),this.line("/Count "+this.count_r({count:0},s)),this.objEnd()},e.outline.renderItems=function(s){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,a=0;a<s.children.length;a++){var d=s.children[a];this.objStart(d),this.line("/Title "+this.makeString(d.title)),this.line("/Parent "+this.makeRef(s)),a>0&&this.line("/Prev "+this.makeRef(s.children[a-1])),a<s.children.length-1&&this.line("/Next "+this.makeRef(s.children[a+1])),d.children.length>0&&(this.line("/First "+this.makeRef(d.children[0])),this.line("/Last "+this.makeRef(d.children[d.children.length-1])));var o=this.count=this.count_r({count:0},d);if(o>0&&this.line("/Count "+o),d.options&&d.options.pageNumber){var c=e.internal.getPageInfo(d.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var h=0;h<s.children.length;h++)this.renderItems(s.children[h])},e.outline.line=function(s){this.ctx.val+=s+`\r
`},e.outline.makeRef=function(s){return s.id+" 0 R"},e.outline.makeString=function(s){return"("+e.internal.pdfEscape(s)+")"},e.outline.objStart=function(s){this.ctx.val+=`\r
`+s.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(s,i){for(var a=0;a<i.children.length;a++)s.count++,this.count_r(s,i.children[a]);return s.count}}])})(Mt.API),(function(t){var r=[192,193,194,195,196,197,198,199];t.processJPEG=function(e,s,i,a,d,o){var c,h=this.decode.DCT_DECODE,p=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=d||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,c=(function(b){for(var m,u=256*b.charCodeAt(4)+b.charCodeAt(5),w=b.length,g={width:0,height:0,numcomponents:1},_=4;_<w;_+=2){if(_+=u,r.indexOf(b.charCodeAt(_+1))!==-1){m=256*b.charCodeAt(_+5)+b.charCodeAt(_+6),g={width:256*b.charCodeAt(_+7)+b.charCodeAt(_+8),height:m,numcomponents:b.charCodeAt(_+9)};break}u=256*b.charCodeAt(_+2)+b.charCodeAt(_+3)}return g})(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),c.numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}p={data:e,width:c.width,height:c.height,colorSpace:o,bitsPerComponent:8,filter:h,index:s,alias:i}}return p}})(Mt.API),Mt.API.processPNG=function(t,r,e,s){if(this.__addimage__.isArrayBuffer(t)&&(t=new Uint8Array(t)),this.__addimage__.isArrayBufferView(t)){var i,a=a2(t,{checkCrc:!0}),d=a.width,o=a.height,c=a.channels,h=a.palette,p=a.depth;i=h&&c===1?(function(G){for(var O=G.width,Q=G.height,I=G.data,k=G.palette,D=G.depth,v=!1,te=[],ce=[],re=void 0,se=!1,le=0,Se=0;Se<k.length;Se++){var ne=eu(k[Se],4),C=ne[0],H=ne[1],K=ne[2],X=ne[3];te.push(C,H,K),X!=null&&(X===0?(le++,ce.length<1&&ce.push(Se)):X<255&&(se=!0))}if(se||le>1){v=!0,ce=void 0;var pe=O*Q;re=new Uint8Array(pe);for(var ve=new DataView(I.buffer),ke=0;ke<pe;ke++){var Ae=pc(ve,ke,D),Re=eu(k[Ae],4)[3];re[ke]=Re}}else le===0&&(ce=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:v?8:void 0,colorBytes:I,alphaBytes:re,needSMask:v,palette:te,mask:ce}})(a):c===2||c===4?(function(G){for(var O=G.data,Q=G.width,I=G.height,k=G.channels,D=G.depth,v=k===2?"DeviceGray":"DeviceRGB",te=k-1,ce=Q*I,re=te,se=ce*re,le=1*ce,Se=Math.ceil(se*D/8),ne=Math.ceil(le*D/8),C=new Uint8Array(Se),H=new Uint8Array(ne),K=new DataView(O.buffer),X=new DataView(C.buffer),pe=new DataView(H.buffer),ve=!1,ke=0;ke<ce;ke++){for(var Ae=ke*k,Re=0;Re<re;Re++)ah(X,pc(K,Ae+Re,D),ke*re+Re,D);var Me=pc(K,Ae+re,D);Me<(1<<D)-1&&(ve=!0),ah(pe,Me,1*ke,D)}return{colorSpace:v,colorsPerPixel:te,sMaskBitsPerComponent:ve?D:void 0,colorBytes:C,alphaBytes:H,needSMask:ve}})(a):(function(G){var O=G.data,Q=G.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:Q,colorsPerPixel:Q==="DeviceGray"?1:3,colorBytes:O instanceof Uint16Array?(function(I){for(var k=I.length,D=new Uint8Array(2*k),v=new DataView(D.buffer,D.byteOffset,D.byteLength),te=0;te<k;te++)v.setUint16(2*te,I[te],!1);return D})(O):O,needSMask:!1}})(a);var b,m,u,w=i,g=w.colorSpace,_=w.colorsPerPixel,y=w.sMaskBitsPerComponent,A=w.colorBytes,L=w.alphaBytes,E=w.needSMask,F=w.palette,Z=w.mask,Y=null;return s!==Mt.API.image_compression.NONE&&typeof Sc=="function"?(Y=(function(G){var O;switch(G){case Mt.API.image_compression.FAST:O=11;break;case Mt.API.image_compression.MEDIUM:O=13;break;case Mt.API.image_compression.SLOW:O=14;break;default:O=12}return O})(s),b=this.decode.FLATE_DECODE,m="/Predictor ".concat(Y," /Colors ").concat(_," /BitsPerComponent ").concat(p," /Columns ").concat(d),t=eh(A,Math.ceil(d*_*p/8),_,p,s),E&&(u=eh(L,Math.ceil(d*y/8),1,y,s))):(b=void 0,m=void 0,t=A,E&&(u=L)),(this.__addimage__.isArrayBuffer(t)||this.__addimage__.isArrayBufferView(t))&&(t=this.__addimage__.arrayBufferToBinaryString(t)),(u&&this.__addimage__.isArrayBuffer(u)||this.__addimage__.isArrayBufferView(u))&&(u=this.__addimage__.arrayBufferToBinaryString(u)),{alias:e,data:t,index:r,filter:b,decodeParameters:m,transparency:Z,palette:F,sMask:u,predictor:Y,width:d,height:o,bitsPerComponent:p,sMaskBitsPerComponent:y,colorSpace:g}}},(function(t){t.processGIF89A=function(r,e,s,i){var a=new k2(r),d=a.width,o=a.height,c=[];a.decodeAndBlitFrameRGBA(0,c);var h={data:c,width:d,height:o},p=new mc(100).encode(h,100);return t.processJPEG.call(this,p,e,s,i)},t.processGIF87A=t.processGIF89A})(Mt.API),Is.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var t=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(t);for(var r=0;r<t;r++){var e=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[r]={red:i,green:s,blue:e,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Is.prototype.parseBGR=function(){this.pos=this.offset;try{var t="bit"+this.bitPP,r=this.width*this.height*4;this.data=new Uint8Array(r),this[t]()}catch(e){Tr.log("bit decode error:"+e)}},Is.prototype.bit1=function(){var t,r=Math.ceil(this.width/8),e=r%4;for(t=this.height-1;t>=0;t--){for(var s=this.bottom_up?t:this.height-1-t,i=0;i<r;i++)for(var a=this.datav.getUint8(this.pos++,!0),d=s*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var c=this.palette[a>>7-o&1];this.data[d+4*o]=c.blue,this.data[d+4*o+1]=c.green,this.data[d+4*o+2]=c.red,this.data[d+4*o+3]=255}e!==0&&(this.pos+=4-e)}},Is.prototype.bit4=function(){for(var t=Math.ceil(this.width/2),r=t%4,e=this.height-1;e>=0;e--){for(var s=this.bottom_up?e:this.height-1-e,i=0;i<t;i++){var a=this.datav.getUint8(this.pos++,!0),d=s*this.width*4+2*i*4,o=a>>4,c=15&a,h=this.palette[o];if(this.data[d]=h.blue,this.data[d+1]=h.green,this.data[d+2]=h.red,this.data[d+3]=255,2*i+1>=this.width)break;h=this.palette[c],this.data[d+4]=h.blue,this.data[d+4+1]=h.green,this.data[d+4+2]=h.red,this.data[d+4+3]=255}r!==0&&(this.pos+=4-r)}},Is.prototype.bit8=function(){for(var t=this.width%4,r=this.height-1;r>=0;r--){for(var e=this.bottom_up?r:this.height-1-r,s=0;s<this.width;s++){var i=this.datav.getUint8(this.pos++,!0),a=e*this.width*4+4*s;if(i<this.palette.length){var d=this.palette[i];this.data[a]=d.red,this.data[a+1]=d.green,this.data[a+2]=d.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}t!==0&&(this.pos+=4-t)}},Is.prototype.bit15=function(){for(var t=this.width%3,r=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var s=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var d=(a&r)/r*255|0,o=(a>>5&r)/r*255|0,c=(a>>10&r)/r*255|0,h=a>>15?255:0,p=s*this.width*4+4*i;this.data[p]=c,this.data[p+1]=o,this.data[p+2]=d,this.data[p+3]=h}this.pos+=t}},Is.prototype.bit16=function(){for(var t=this.width%3,r=parseInt("11111",2),e=parseInt("111111",2),s=this.height-1;s>=0;s--){for(var i=this.bottom_up?s:this.height-1-s,a=0;a<this.width;a++){var d=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(d&r)/r*255|0,c=(d>>5&e)/e*255|0,h=(d>>11)/r*255|0,p=i*this.width*4+4*a;this.data[p]=h,this.data[p+1]=c,this.data[p+2]=o,this.data[p+3]=255}this.pos+=t}},Is.prototype.bit24=function(){for(var t=this.height-1;t>=0;t--){for(var r=this.bottom_up?t:this.height-1-t,e=0;e<this.width;e++){var s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),d=r*this.width*4+4*e;this.data[d]=a,this.data[d+1]=i,this.data[d+2]=s,this.data[d+3]=255}this.pos+=this.width%4}},Is.prototype.bit32=function(){for(var t=this.height-1;t>=0;t--)for(var r=this.bottom_up?t:this.height-1-t,e=0;e<this.width;e++){var s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),o=r*this.width*4+4*e;this.data[o]=a,this.data[o+1]=i,this.data[o+2]=s,this.data[o+3]=d}},Is.prototype.getData=function(){return this.data},(function(t){t.processBMP=function(r,e,s,i){var a=new Is(r,!1),d=a.width,o=a.height,c={data:a.getData(),width:d,height:o},h=new mc(100).encode(c,100);return t.processJPEG.call(this,h,e,s,i)}})(Mt.API),oh.prototype.getData=function(){return this.data},(function(t){t.processWEBP=function(r,e,s,i){var a=new oh(r),d=a.width,o=a.height,c={data:a.getData(),width:d,height:o},h=new mc(100).encode(c,100);return t.processJPEG.call(this,h,e,s,i)}})(Mt.API),Mt.API.processRGBA=function(t,r,e){for(var s=t.data,i=s.length,a=new Uint8Array(i/4*3),d=new Uint8Array(i/4),o=0,c=0,h=0;h<i;h+=4){var p=s[h],b=s[h+1],m=s[h+2],u=s[h+3];a[o++]=p,a[o++]=b,a[o++]=m,d[c++]=u}var w=this.__addimage__.arrayBufferToBinaryString(a);return{alpha:this.__addimage__.arrayBufferToBinaryString(d),data:w,index:r,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:t.width,height:t.height}},Mt.API.setLanguage=function(t){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[t]!==void 0&&(this.internal.languageSettings.languageCode=t,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},ki=Mt.API,Qo=ki.getCharWidthsArray=function(t,r){var e,s,i=(r=r||{}).font||this.internal.getFont(),a=r.fontSize||this.internal.getFontSize(),d=r.charSpace||this.internal.getCharSpace(),o=r.widths?r.widths:i.metadata.Unicode.widths,c=o.fof?o.fof:1,h=r.kerning?r.kerning:i.metadata.Unicode.kerning,p=h.fof?h.fof:1,b=r.doKerning!==!1,m=0,u=t.length,w=0,g=o[0]||c,_=[];for(e=0;e<u;e++)s=t.charCodeAt(e),typeof i.metadata.widthOfString=="function"?_.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(s))+d*(1e3/a)||0)/1e3):(m=b&&kr(h[s])==="object"&&!isNaN(parseInt(h[s][w],10))?h[s][w]/p:0,_.push((o[s]||g)/c+m)),w=s;return _},Zu=ki.getStringUnitWidth=function(t,r){var e=(r=r||{}).fontSize||this.internal.getFontSize(),s=r.font||this.internal.getFont(),i=r.charSpace||this.internal.getCharSpace();return ki.processArabic&&(t=ki.processArabic(t)),typeof s.metadata.widthOfString=="function"?s.metadata.widthOfString(t,e,i)/e:Qo.apply(this,arguments).reduce(function(a,d){return a+d},0)},Xu=function(t,r,e,s){for(var i=[],a=0,d=t.length,o=0;a!==d&&o+r[a]<e;)o+=r[a],a++;i.push(t.slice(0,a));var c=a;for(o=0;a!==d;)o+r[a]>s&&(i.push(t.slice(c,a)),o=0,c=a),o+=r[a],a++;return c!==a&&i.push(t.slice(c,a)),i},Qu=function(t,r,e){e||(e={});var s,i,a,d,o,c,h,p=[],b=[p],m=e.textIndent||0,u=0,w=0,g=t.split(" "),_=Qo.apply(this,[" ",e])[0];if(c=e.lineIndent===-1?g[0].length+2:e.lineIndent||0){var y=Array(c).join(" "),A=[];g.map(function(E){(E=E.split(/\s*\n/)).length>1?A=A.concat(E.map(function(F,Z){return(Z&&F.length?`
`:"")+F})):A.push(E[0])}),g=A,c=Zu.apply(this,[y,e])}for(a=0,d=g.length;a<d;a++){var L=0;if(s=g[a],c&&s[0]==`
`&&(s=s.substr(1),L=1),m+u+(w=(i=Qo.apply(this,[s,e])).reduce(function(E,F){return E+F},0))>r||L){if(w>r){for(o=Xu.apply(this,[s,i,r-(m+u),r]),p.push(o.shift()),p=[o.pop()];o.length;)b.push([o.shift()]);w=i.slice(s.length-(p[0]?p[0].length:0)).reduce(function(E,F){return E+F},0)}else p=[s];b.push(p),m=w+c,u=_}else p.push(s),m+=u+w,u=_}return h=c?function(E,F){return(F?y:"")+E.join(" ")}:function(E){return E.join(" ")},b.map(h)},ki.splitTextToSize=function(t,r,e){var s,i=(e=e||{}).fontSize||this.internal.getFontSize(),a=(function(p){if(p.widths&&p.kerning)return{widths:p.widths,kerning:p.kerning};var b=this.internal.getFont(p.fontName,p.fontStyle),m="Unicode";return b.metadata[m]?{widths:b.metadata[m].widths||{0:1},kerning:b.metadata[m].kerning||{}}:{font:b.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);s=Array.isArray(t)?t:String(t).split(/\r?\n/);var d=1*this.internal.scaleFactor*r/i;a.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/i:0,a.lineIndent=e.lineIndent;var o,c,h=[];for(o=0,c=s.length;o<c;o++)h=h.concat(Qu.apply(this,[s[o],d,a]));return h},(function(t){t.__fontmetrics__=t.__fontmetrics__||{};for(var r="0123456789abcdef",e="klmnopqrstuvwxyz",s={},i={},a=0;a<16;a++)s[e[a]]=r[a],i[r[a]]=e[a];var d=function(m){return"0x"+parseInt(m,10).toString(16)},o=t.__fontmetrics__.compress=function(m){var u,w,g,_,y=["{"];for(var A in m){if(u=m[A],isNaN(parseInt(A,10))?w="'"+A+"'":(A=parseInt(A,10),w=(w=d(A).slice(2)).slice(0,-1)+i[w.slice(-1)]),typeof u=="number")u<0?(g=d(u).slice(3),_="-"):(g=d(u).slice(2),_=""),g=_+g.slice(0,-1)+i[g.slice(-1)];else{if(kr(u)!=="object")throw new Error("Don't know what to do with value type "+kr(u)+".");g=o(u)}y.push(w+g)}return y.push("}"),y.join("")},c=t.__fontmetrics__.uncompress=function(m){if(typeof m!="string")throw new Error("Invalid argument passed to uncompress.");for(var u,w,g,_,y={},A=1,L=y,E=[],F="",Z="",Y=m.length-1,G=1;G<Y;G+=1)(_=m[G])=="'"?u?(g=u.join(""),u=void 0):u=[]:u?u.push(_):_=="{"?(E.push([L,g]),L={},g=void 0):_=="}"?((w=E.pop())[0][w[1]]=L,g=void 0,L=w[0]):_=="-"?A=-1:g===void 0?s.hasOwnProperty(_)?(F+=s[_],g=parseInt(F,16)*A,A=1,F=""):F+=_:s.hasOwnProperty(_)?(Z+=s[_],L[g]=parseInt(Z,16)*A,A=1,g=void 0,Z=""):Z+=_;return y},h={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},p={Unicode:{Courier:h,"Courier-Bold":h,"Courier-BoldOblique":h,"Courier-Oblique":h,Helvetica:h,"Helvetica-Bold":h,"Helvetica-BoldOblique":h,"Helvetica-Oblique":h,"Times-Roman":h,"Times-Bold":h,"Times-BoldItalic":h,"Times-Italic":h}},b={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};t.events.push(["addFont",function(m){var u=m.font,w=b.Unicode[u.postScriptName];w&&(u.metadata.Unicode={},u.metadata.Unicode.widths=w.widths,u.metadata.Unicode.kerning=w.kerning);var g=p.Unicode[u.postScriptName];g&&(u.metadata.Unicode.encoding=g,u.encoding=g.codePages[0])}])})(Mt.API),(function(t){var r=function(e){for(var s=e.length,i=new Uint8Array(s),a=0;a<s;a++)i[a]=e.charCodeAt(a);return i};t.API.events.push(["addFont",function(e){var s=void 0,i=e.font,a=e.instance;if(!i.isStandardFont){if(a===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(s=a.existsFileInVFS(i.postScriptName)===!1?a.loadFile(i.postScriptName):a.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(d,o){o=/^\x00\x01\x00\x00/.test(o)?r(o):r(sl(o)),d.metadata=t.API.TTFFont.open(o),d.metadata.Unicode=d.metadata.Unicode||{encoding:{},kerning:{},widths:[]},d.metadata.glyIdsUsed=[0]})(i,s)}}])})(Mt),Mt.API.addSvgAsImage=function(t,r,e,s,i,a,d,o){if(isNaN(r)||isNaN(e))throw Tr.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(i))throw Tr.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=s,c.height=i;var h=c.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,c.width,c.height);var p={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},b=this;return(Gt.canvg?Promise.resolve(Gt.canvg):Yl(()=>import("./index.es-DOG_e_aL.js"),__vite__mapDeps([0,1,2,3,4]))).catch(function(m){return Promise.reject(new Error("Could not load canvg: "+m))}).then(function(m){return m.default?m.default:m}).then(function(m){return m.fromString(h,t,p)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(m){return m.render(p)}).then(function(){b.addImage(c.toDataURL("image/jpeg",1),r,e,s,i,d,o)})},Mt.API.putTotalPages=function(t){var r,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(r=new RegExp(t,"g"),e=this.internal.getNumberOfPages()):(r=new RegExp(this.pdfEscape16(t,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var s=1;s<=this.internal.getNumberOfPages();s++)for(var i=0;i<this.internal.pages[s].length;i++)this.internal.pages[s][i]=this.internal.pages[s][i].replace(r,e);return this},Mt.API.viewerPreferences=function(t,r){var e;t=t||{},r=r||!1;var s,i,a,d={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(d),c=[],h=0,p=0,b=0;function m(w,g){var _,y=!1;for(_=0;_<w.length;_+=1)w[_]===g&&(y=!0);return y}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(d)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,t==="reset"||r===!0){var u=o.length;for(b=0;b<u;b+=1)e[o[b]].value=e[o[b]].defaultValue,e[o[b]].explicitSet=!1}if(kr(t)==="object"){for(i in t)if(a=t[i],m(o,i)&&a!==void 0){if(e[i].type==="boolean"&&typeof a=="boolean")e[i].value=a;else if(e[i].type==="name"&&m(e[i].valueSet,a))e[i].value=a;else if(e[i].type==="integer"&&Number.isInteger(a))e[i].value=a;else if(e[i].type==="array"){for(h=0;h<a.length;h+=1)if(s=!0,a[h].length===1&&typeof a[h][0]=="number")c.push(String(a[h]-1));else if(a[h].length>1){for(p=0;p<a[h].length;p+=1)typeof a[h][p]!="number"&&(s=!1);s===!0&&c.push([a[h][0]-1,a[h][1]-1].join(" "))}e[i].value="["+c.join(" ")+"]"}else e[i].value=e[i].defaultValue;e[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var w,g=[];for(w in e)e[w].explicitSet===!0&&(e[w].type==="name"?g.push("/"+w+" /"+e[w].value):g.push("/"+w+" "+e[w].value));g.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+g.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},(function(t){var r=function(){var s='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),a=unescape(encodeURIComponent(s)),d=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),h=a.length+d.length+o.length+i.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+h+" >>"),this.internal.write("stream"),this.internal.write(i+a+d+o+c),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};t.addMetadata=function(s,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:s,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",r)),this}})(Mt.API),(function(t){var r=t.API,e=r.pdfEscape16=function(a,d){for(var o,c=d.metadata.Unicode.widths,h=["","0","00","000","0000"],p=[""],b=0,m=a.length;b<m;++b){if(o=d.metadata.characterToGlyph(a.charCodeAt(b)),d.metadata.glyIdsUsed.push(o),d.metadata.toUnicode[o]=a.charCodeAt(b),c.indexOf(o)==-1&&(c.push(o),c.push([parseInt(d.metadata.widthOfGlyph(o),10)])),o=="0")return p.join("");o=o.toString(16),p.push(h[4-o.length],o)}return p.join("")},s=function(a){var d,o,c,h,p,b,m;for(p=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],b=0,m=(o=Object.keys(a).sort(function(u,w){return u-w})).length;b<m;b++)d=o[b],c.length>=100&&(p+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),a[d]!==void 0&&a[d]!==null&&typeof a[d].toString=="function"&&(h=("0000"+a[d].toString(16)).slice(-4),d=("0000"+(+d).toString(16)).slice(-4),c.push("<"+d+"><"+h+">"));return c.length&&(p+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),p+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};r.events.push(["putFont",function(a){(function(d){var o=d.font,c=d.out,h=d.newObject,p=d.putStream;if(o.metadata instanceof t.API.TTFFont&&o.encoding==="Identity-H"){for(var b=o.metadata.Unicode.widths,m=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),u="",w=0;w<m.length;w++)u+=String.fromCharCode(m[w]);var g=h();p({data:u,addLength1:!0,objectId:g}),c("endobj");var _=h();p({data:s(o.metadata.toUnicode),addLength1:!0,objectId:_}),c("endobj");var y=h();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+Li(o.fontName)),c("/FontFile2 "+g+" 0 R"),c("/FontBBox "+t.API.PDFObject.convert(o.metadata.bbox)),c("/Flags "+o.metadata.flags),c("/StemV "+o.metadata.stemV),c("/ItalicAngle "+o.metadata.italicAngle),c("/Ascent "+o.metadata.ascender),c("/Descent "+o.metadata.decender),c("/CapHeight "+o.metadata.capHeight),c(">>"),c("endobj");var A=h();c("<<"),c("/Type /Font"),c("/BaseFont /"+Li(o.fontName)),c("/FontDescriptor "+y+" 0 R"),c("/W "+t.API.PDFObject.convert(b)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+o.encoding+")"),c(">>"),c(">>"),c("endobj"),o.objectNumber=h(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+_+" 0 R"),c("/BaseFont /"+Li(o.fontName)),c("/Encoding /"+o.encoding),c("/DescendantFonts ["+A+" 0 R]"),c(">>"),c("endobj"),o.isAlreadyPutted=!0}})(a)}]),r.events.push(["putFont",function(a){(function(d){var o=d.font,c=d.out,h=d.newObject,p=d.putStream;if(o.metadata instanceof t.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var b=o.metadata.rawData,m="",u=0;u<b.length;u++)m+=String.fromCharCode(b[u]);var w=h();p({data:m,addLength1:!0,objectId:w}),c("endobj");var g=h();p({data:s(o.metadata.toUnicode),addLength1:!0,objectId:g}),c("endobj");var _=h();c("<<"),c("/Descent "+o.metadata.decender),c("/CapHeight "+o.metadata.capHeight),c("/StemV "+o.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+w+" 0 R"),c("/Flags 96"),c("/FontBBox "+t.API.PDFObject.convert(o.metadata.bbox)),c("/FontName /"+Li(o.fontName)),c("/ItalicAngle "+o.metadata.italicAngle),c("/Ascent "+o.metadata.ascender),c(">>"),c("endobj"),o.objectNumber=h();for(var y=0;y<o.metadata.hmtx.widths.length;y++)o.metadata.hmtx.widths[y]=parseInt(o.metadata.hmtx.widths[y]*(1e3/o.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+g+" 0 R/BaseFont/"+Li(o.fontName)+"/FontDescriptor "+_+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+t.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),c("endobj"),o.isAlreadyPutted=!0}})(a)}]);var i=function(a){var d,o=a.text||"",c=a.x,h=a.y,p=a.options||{},b=a.mutex||{},m=b.pdfEscape,u=b.activeFontKey,w=b.fonts,g=u,_="",y=0,A="",L=w[g].encoding;if(w[g].encoding!=="Identity-H")return{text:o,x:c,y:h,options:p,mutex:b};for(A=o,g=u,Array.isArray(o)&&(A=o[0]),y=0;y<A.length;y+=1)w[g].metadata.hasOwnProperty("cmap")&&(d=w[g].metadata.cmap.unicode.codeMap[A[y].charCodeAt(0)]),d||A[y].charCodeAt(0)<256&&w[g].metadata.hasOwnProperty("Unicode")?_+=A[y]:_+="";var E="";return parseInt(g.slice(1))<14||L==="WinAnsiEncoding"?E=m(_,g).split("").map(function(F){return F.charCodeAt(0).toString(16)}).join(""):L==="Identity-H"&&(E=e(_,w[g])),b.isHex=!0,{text:E,x:c,y:h,options:p,mutex:b}};r.events.push(["postProcessText",function(a){var d=a.text||"",o=[],c={text:d,x:a.x,y:a.y,options:a.options,mutex:a.mutex};if(Array.isArray(d)){var h=0;for(h=0;h<d.length;h+=1)Array.isArray(d[h])&&d[h].length===3?o.push([i(Object.assign({},c,{text:d[h][0]})).text,d[h][1],d[h][2]]):o.push(i(Object.assign({},c,{text:d[h]})).text);a.text=o}else a.text=i(Object.assign({},c,{text:d})).text}])})(Mt),(function(t){var r=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};t.existsFileInVFS=function(e){return r.call(this),this.internal.vFS[e]!==void 0},t.addFileToVFS=function(e,s){return r.call(this),this.internal.vFS[e]=s,this},t.getFileFromVFS=function(e){return r.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}})(Mt.API),(function(t){t.__bidiEngine__=t.prototype.__bidiEngine__=function(s){var i,a,d,o,c,h,p,b=r,m=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],w={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},g={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},_=["(",")","(","<",">","<","[","]","[","{","}","{","Â«","Â»","Â«","â€¹","â€º","â€¹","â…","â†","â…","â½","â¾","â½","â‚","â‚Ž","â‚","â‰¤","â‰¥","â‰¤","âŒ©","âŒª","âŒ©","ï¹™","ï¹š","ï¹™","ï¹›","ï¹œ","ï¹›","ï¹","ï¹ž","ï¹","ï¹¤","ï¹¥","ï¹¤"],y=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),A=!1,L=0;this.__bidiEngine__={};var E=function(I){var k=I.charCodeAt(),D=k>>8,v=g[D];return v!==void 0?b[256*v+(255&k)]:D===252||D===253?"AL":y.test(D)?"L":D===8?"R":"N"},F=function(I){for(var k,D=0;D<I.length;D++){if((k=E(I.charAt(D)))==="L")return!1;if(k==="R")return!0}return!1},Z=function(I,k,D,v){var te,ce,re,se,le=k[v];switch(le){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":A=!1;break;case"N":case"AN":break;case"EN":A&&(le="AN");break;case"AL":A=!0,le="R";break;case"WS":case"BN":le="N";break;case"CS":v<1||v+1>=k.length||(te=D[v-1])!=="EN"&&te!=="AN"||(ce=k[v+1])!=="EN"&&ce!=="AN"?le="N":A&&(ce="AN"),le=ce===te?ce:"N";break;case"ES":le=(te=v>0?D[v-1]:"B")==="EN"&&v+1<k.length&&k[v+1]==="EN"?"EN":"N";break;case"ET":if(v>0&&D[v-1]==="EN"){le="EN";break}if(A){le="N";break}for(re=v+1,se=k.length;re<se&&k[re]==="ET";)re++;le=re<se&&k[re]==="EN"?"EN":"N";break;case"NSM":if(d&&!o){for(se=k.length,re=v+1;re<se&&k[re]==="NSM";)re++;if(re<se){var Se=I[v],ne=Se>=1425&&Se<=2303||Se===64286;if(te=k[re],ne&&(te==="R"||te==="AL")){le="R";break}}}le=v<1||(te=k[v-1])==="B"?"N":D[v-1];break;case"B":A=!1,i=!0,le=L;break;case"S":a=!0,le="N"}return le},Y=function(I,k,D){var v=I.split("");return D&&G(v,D,{hiLevel:L}),v.reverse(),k&&k.reverse(),v.join("")},G=function(I,k,D){var v,te,ce,re,se,le=-1,Se=I.length,ne=0,C=[],H=L?u:m,K=[];for(A=!1,i=!1,a=!1,te=0;te<Se;te++)K[te]=E(I[te]);for(ce=0;ce<Se;ce++){if(se=ne,C[ce]=Z(I,K,C,ce),v=240&(ne=H[se][w[C[ce]]]),ne&=15,k[ce]=re=H[ne][5],v>0)if(v===16){for(te=le;te<ce;te++)k[te]=1;le=-1}else le=-1;if(H[ne][6])le===-1&&(le=ce);else if(le>-1){for(te=le;te<ce;te++)k[te]=re;le=-1}K[ce]==="B"&&(k[ce]=0),D.hiLevel|=re}a&&(function(X,pe,ve){for(var ke=0;ke<ve;ke++)if(X[ke]==="S"){pe[ke]=L;for(var Ae=ke-1;Ae>=0&&X[Ae]==="WS";Ae--)pe[Ae]=L}})(K,k,Se)},O=function(I,k,D,v,te){if(!(te.hiLevel<I)){if(I===1&&L===1&&!i)return k.reverse(),void(D&&D.reverse());for(var ce,re,se,le,Se=k.length,ne=0;ne<Se;){if(v[ne]>=I){for(se=ne+1;se<Se&&v[se]>=I;)se++;for(le=ne,re=se-1;le<re;le++,re--)ce=k[le],k[le]=k[re],k[re]=ce,D&&(ce=D[le],D[le]=D[re],D[re]=ce);ne=se}ne++}}},Q=function(I,k,D){var v=I.split(""),te={hiLevel:L};return D||(D=[]),G(v,D,te),(function(ce,re,se){if(se.hiLevel!==0&&p)for(var le,Se=0;Se<ce.length;Se++)re[Se]===1&&(le=_.indexOf(ce[Se]))>=0&&(ce[Se]=_[le+1])})(v,D,te),O(2,v,k,D,te),O(1,v,k,D,te),v.join("")};return this.__bidiEngine__.doBidiReorder=function(I,k,D){if((function(te,ce){if(ce)for(var re=0;re<te.length;re++)ce[re]=re;o===void 0&&(o=F(te)),h===void 0&&(h=F(te))})(I,k),d||!c||h)if(d&&c&&o^h)L=o?1:0,I=Y(I,k,D);else if(!d&&c&&h)L=o?1:0,I=Q(I,k,D),I=Y(I,k);else if(!d||o||c||h){if(d&&!c&&o^h)I=Y(I,k),o?(L=0,I=Q(I,k,D)):(L=1,I=Q(I,k,D),I=Y(I,k));else if(d&&o&&!c&&h)L=1,I=Q(I,k,D),I=Y(I,k);else if(!d&&!c&&o^h){var v=p;o?(L=1,I=Q(I,k,D),L=0,p=!1,I=Q(I,k,D),p=v):(L=0,I=Q(I,k,D),I=Y(I,k),L=1,p=!1,I=Q(I,k,D),p=v,I=Y(I,k))}}else L=0,I=Q(I,k,D);else L=o?1:0,I=Q(I,k,D);return I},this.__bidiEngine__.setOptions=function(I){I&&(d=I.isInputVisual,c=I.isOutputVisual,o=I.isInputRtl,h=I.isOutputRtl,p=I.isSymmetricSwapping)},this.__bidiEngine__.setOptions(s),this.__bidiEngine__};var r=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new t.__bidiEngine__({isInputVisual:!0});t.API.events.push(["postProcessText",function(s){var i=s.text;s.x,s.y;var a=s.options||{};s.mutex,a.lang;var d=[];if(a.isInputVisual=typeof a.isInputVisual!="boolean"||a.isInputVisual,e.setOptions(a),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(d=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?d.push([e.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):d.push([e.doBidiReorder(i[o])]);s.text=d}else s.text=e.doBidiReorder(i);e.setOptions({isInputVisual:!0})}])})(Mt),Mt.API.TTFFont=(function(){function t(r){var e;if(this.rawData=r,e=this.contents=new qa(r),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new z2(this),this.registerTTF()}return t.open=function(r){return new t(r)},t.prototype.parse=function(){return this.directory=new C2(this.contents),this.head=new L2(this),this.name=new F2(this),this.cmap=new sp(this),this.toUnicode={},this.hhea=new E2(this),this.maxp=new O2(this),this.hmtx=new D2(this),this.post=new T2(this),this.os2=new P2(this),this.loca=new U2(this),this.glyf=new R2(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},t.prototype.registerTTF=function(){var r,e,s,i,a;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var d,o,c,h;for(h=[],d=0,o=(c=this.bbox).length;d<o;d++)r=c[d],h.push(Math.round(r*this.scaleFactor));return h}).call(this),this.stemV=0,this.post.exists?(s=255&(i=this.post.italic_angle),32768&(e=i>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+s)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(a=this.familyClass)===1||a===2||a===3||a===4||a===5||a===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},t.prototype.characterToGlyph=function(r){var e;return((e=this.cmap.unicode)!=null?e.codeMap[r]:void 0)||0},t.prototype.widthOfGlyph=function(r){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(r).advance*e},t.prototype.widthOfString=function(r,e,s){var i,a,d,o;for(d=0,a=0,o=(r=""+r).length;0<=o?a<o:a>o;a=0<=o?++a:--a)i=r.charCodeAt(a),d+=this.widthOfGlyph(this.characterToGlyph(i))+s*(1e3/e)||0;return d*(e/1e3)},t.prototype.lineHeight=function(r,e){var s;return e==null&&(e=!1),s=e?this.lineGap:0,(this.ascender+s-this.decender)/1e3*r},t})();var qs,qa=(function(){function t(r){this.data=r??[],this.pos=0,this.length=this.data.length}return t.prototype.readByte=function(){return this.data[this.pos++]},t.prototype.writeByte=function(r){return this.data[this.pos++]=r},t.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},t.prototype.writeUInt32=function(r){return this.writeByte(r>>>24&255),this.writeByte(r>>16&255),this.writeByte(r>>8&255),this.writeByte(255&r)},t.prototype.readInt32=function(){var r;return(r=this.readUInt32())>=2147483648?r-4294967296:r},t.prototype.writeInt32=function(r){return r<0&&(r+=4294967296),this.writeUInt32(r)},t.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},t.prototype.writeUInt16=function(r){return this.writeByte(r>>8&255),this.writeByte(255&r)},t.prototype.readInt16=function(){var r;return(r=this.readUInt16())>=32768?r-65536:r},t.prototype.writeInt16=function(r){return r<0&&(r+=65536),this.writeUInt16(r)},t.prototype.readString=function(r){var e,s;for(s=[],e=0;0<=r?e<r:e>r;e=0<=r?++e:--e)s[e]=String.fromCharCode(this.readByte());return s.join("")},t.prototype.writeString=function(r){var e,s,i;for(i=[],e=0,s=r.length;0<=s?e<s:e>s;e=0<=s?++e:--e)i.push(this.writeByte(r.charCodeAt(e)));return i},t.prototype.readShort=function(){return this.readInt16()},t.prototype.writeShort=function(r){return this.writeInt16(r)},t.prototype.readLongLong=function(){var r,e,s,i,a,d,o,c;return r=this.readByte(),e=this.readByte(),s=this.readByte(),i=this.readByte(),a=this.readByte(),d=this.readByte(),o=this.readByte(),c=this.readByte(),128&r?-1*(72057594037927940*(255^r)+281474976710656*(255^e)+1099511627776*(255^s)+4294967296*(255^i)+16777216*(255^a)+65536*(255^d)+256*(255^o)+(255^c)+1):72057594037927940*r+281474976710656*e+1099511627776*s+4294967296*i+16777216*a+65536*d+256*o+c},t.prototype.writeLongLong=function(r){var e,s;return e=Math.floor(r/4294967296),s=4294967295&r,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(s>>24&255),this.writeByte(s>>16&255),this.writeByte(s>>8&255),this.writeByte(255&s)},t.prototype.readInt=function(){return this.readInt32()},t.prototype.writeInt=function(r){return this.writeInt32(r)},t.prototype.read=function(r){var e,s;for(e=[],s=0;0<=r?s<r:s>r;s=0<=r?++s:--s)e.push(this.readByte());return e},t.prototype.write=function(r){var e,s,i,a;for(a=[],s=0,i=r.length;s<i;s++)e=r[s],a.push(this.writeByte(e));return a},t})(),C2=(function(){var t;function r(e){var s,i,a;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},i=0,a=this.tableCount;0<=a?i<a:i>a;i=0<=a?++i:--i)s={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[s.tag]=s}return r.prototype.encode=function(e){var s,i,a,d,o,c,h,p,b,m,u,w,g;for(g in u=Object.keys(e).length,c=Math.log(2),b=16*Math.floor(Math.log(u)/c),d=Math.floor(b/c),p=16*u-b,(i=new qa).writeInt(this.scalarType),i.writeShort(u),i.writeShort(b),i.writeShort(d),i.writeShort(p),a=16*u,h=i.pos+a,o=null,w=[],e)for(m=e[g],i.writeString(g),i.writeInt(t(m)),i.writeInt(h),i.writeInt(m.length),w=w.concat(m),g==="head"&&(o=h),h+=m.length;h%4;)w.push(0),h++;return i.write(w),s=2981146554-t(i.data),i.pos=o+8,i.writeUInt32(s),i.data},t=function(e){var s,i,a,d;for(e=ap.call(e);e.length%4;)e.push(0);for(a=new qa(e),i=0,s=0,d=e.length;s<d;s=s+=4)i+=a.readUInt32();return 4294967295&i},r})(),A2={}.hasOwnProperty,ta=function(t,r){for(var e in r)A2.call(r,e)&&(t[e]=r[e]);function s(){this.constructor=t}return s.prototype=r.prototype,t.prototype=new s,t.__super__=r.prototype,t};qs=(function(){function t(r){var e;this.file=r,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return t.prototype.parse=function(){},t.prototype.encode=function(){},t.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},t})();var L2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="head",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.revision=r.readInt(),this.checkSumAdjustment=r.readInt(),this.magicNumber=r.readInt(),this.flags=r.readShort(),this.unitsPerEm=r.readShort(),this.created=r.readLongLong(),this.modified=r.readLongLong(),this.xMin=r.readShort(),this.yMin=r.readShort(),this.xMax=r.readShort(),this.yMax=r.readShort(),this.macStyle=r.readShort(),this.lowestRecPPEM=r.readShort(),this.fontDirectionHint=r.readShort(),this.indexToLocFormat=r.readShort(),this.glyphDataFormat=r.readShort()},t.prototype.encode=function(r){var e;return(e=new qa).writeInt(this.version),e.writeInt(this.revision),e.writeInt(this.checkSumAdjustment),e.writeInt(this.magicNumber),e.writeShort(this.flags),e.writeShort(this.unitsPerEm),e.writeLongLong(this.created),e.writeLongLong(this.modified),e.writeShort(this.xMin),e.writeShort(this.yMin),e.writeShort(this.xMax),e.writeShort(this.yMax),e.writeShort(this.macStyle),e.writeShort(this.lowestRecPPEM),e.writeShort(this.fontDirectionHint),e.writeShort(r),e.writeShort(this.glyphDataFormat),e.data},t})(),lh=(function(){function t(r,e){var s,i,a,d,o,c,h,p,b,m,u,w,g,_,y,A,L;switch(this.platformID=r.readUInt16(),this.encodingID=r.readShort(),this.offset=e+r.readInt(),b=r.pos,r.pos=this.offset,this.format=r.readUInt16(),this.length=r.readUInt16(),this.language=r.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=r.readByte();break;case 4:for(u=r.readUInt16(),m=u/2,r.pos+=6,a=(function(){var E,F;for(F=[],c=E=0;0<=m?E<m:E>m;c=0<=m?++E:--E)F.push(r.readUInt16());return F})(),r.pos+=2,g=(function(){var E,F;for(F=[],c=E=0;0<=m?E<m:E>m;c=0<=m?++E:--E)F.push(r.readUInt16());return F})(),h=(function(){var E,F;for(F=[],c=E=0;0<=m?E<m:E>m;c=0<=m?++E:--E)F.push(r.readUInt16());return F})(),p=(function(){var E,F;for(F=[],c=E=0;0<=m?E<m:E>m;c=0<=m?++E:--E)F.push(r.readUInt16());return F})(),i=(this.length-r.pos+this.offset)/2,o=(function(){var E,F;for(F=[],c=E=0;0<=i?E<i:E>i;c=0<=i?++E:--E)F.push(r.readUInt16());return F})(),c=y=0,L=a.length;y<L;c=++y)for(_=a[c],s=A=w=g[c];w<=_?A<=_:A>=_;s=w<=_?++A:--A)p[c]===0?d=s+h[c]:(d=o[p[c]/2+(s-w)-(m-c)]||0)!==0&&(d+=h[c]),this.codeMap[s]=65535&d}r.pos=b}return t.encode=function(r,e){var s,i,a,d,o,c,h,p,b,m,u,w,g,_,y,A,L,E,F,Z,Y,G,O,Q,I,k,D,v,te,ce,re,se,le,Se,ne,C,H,K,X,pe,ve,ke,Ae,Re,Me,Ke;switch(v=new qa,d=Object.keys(r).sort(function(je,j){return je-j}),e){case"macroman":for(g=0,_=(function(){var je=[];for(w=0;w<256;++w)je.push(0);return je})(),A={0:0},a={},te=0,le=d.length;te<le;te++)A[Ae=r[i=d[te]]]==null&&(A[Ae]=++g),a[i]={old:r[i],new:A[r[i]]},_[i]=A[r[i]];return v.writeUInt16(1),v.writeUInt16(0),v.writeUInt32(12),v.writeUInt16(0),v.writeUInt16(262),v.writeUInt16(0),v.write(_),{charMap:a,subtable:v.data,maxGlyphID:g+1};case"unicode":for(k=[],b=[],L=0,A={},s={},y=h=null,ce=0,Se=d.length;ce<Se;ce++)A[F=r[i=d[ce]]]==null&&(A[F]=++L),s[i]={old:F,new:A[F]},o=A[F]-i,y!=null&&o===h||(y&&b.push(y),k.push(i),h=o),y=i;for(y&&b.push(y),b.push(65535),k.push(65535),Q=2*(O=k.length),G=2*Math.pow(Math.log(O)/Math.LN2,2),m=Math.log(G/2)/Math.LN2,Y=2*O-G,c=[],Z=[],u=[],w=re=0,ne=k.length;re<ne;w=++re){if(I=k[w],p=b[w],I===65535){c.push(0),Z.push(0);break}if(I-(D=s[I].new)>=32768)for(c.push(0),Z.push(2*(u.length+O-w)),i=se=I;I<=p?se<=p:se>=p;i=I<=p?++se:--se)u.push(s[i].new);else c.push(D-I),Z.push(0)}for(v.writeUInt16(3),v.writeUInt16(1),v.writeUInt32(12),v.writeUInt16(4),v.writeUInt16(16+8*O+2*u.length),v.writeUInt16(0),v.writeUInt16(Q),v.writeUInt16(G),v.writeUInt16(m),v.writeUInt16(Y),ve=0,C=b.length;ve<C;ve++)i=b[ve],v.writeUInt16(i);for(v.writeUInt16(0),ke=0,H=k.length;ke<H;ke++)i=k[ke],v.writeUInt16(i);for(Re=0,K=c.length;Re<K;Re++)o=c[Re],v.writeUInt16(o);for(Me=0,X=Z.length;Me<X;Me++)E=Z[Me],v.writeUInt16(E);for(Ke=0,pe=u.length;Ke<pe;Ke++)g=u[Ke],v.writeUInt16(g);return{charMap:s,subtable:v.data,maxGlyphID:L+1}}},t})(),sp=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="cmap",t.prototype.parse=function(r){var e,s,i;for(r.pos=this.offset,this.version=r.readUInt16(),i=r.readUInt16(),this.tables=[],this.unicode=null,s=0;0<=i?s<i:s>i;s=0<=i?++s:--s)e=new lh(r,this.offset),this.tables.push(e),e.isUnicode&&this.unicode==null&&(this.unicode=e);return!0},t.encode=function(r,e){var s,i;return e==null&&(e="macroman"),s=lh.encode(r,e),(i=new qa).writeUInt16(0),i.writeUInt16(1),s.table=i.data.concat(s.subtable),s},t})(),E2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="hhea",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.ascender=r.readShort(),this.decender=r.readShort(),this.lineGap=r.readShort(),this.advanceWidthMax=r.readShort(),this.minLeftSideBearing=r.readShort(),this.minRightSideBearing=r.readShort(),this.xMaxExtent=r.readShort(),this.caretSlopeRise=r.readShort(),this.caretSlopeRun=r.readShort(),this.caretOffset=r.readShort(),r.pos+=8,this.metricDataFormat=r.readShort(),this.numberOfMetrics=r.readUInt16()},t})(),P2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="OS/2",t.prototype.parse=function(r){if(r.pos=this.offset,this.version=r.readUInt16(),this.averageCharWidth=r.readShort(),this.weightClass=r.readUInt16(),this.widthClass=r.readUInt16(),this.type=r.readShort(),this.ySubscriptXSize=r.readShort(),this.ySubscriptYSize=r.readShort(),this.ySubscriptXOffset=r.readShort(),this.ySubscriptYOffset=r.readShort(),this.ySuperscriptXSize=r.readShort(),this.ySuperscriptYSize=r.readShort(),this.ySuperscriptXOffset=r.readShort(),this.ySuperscriptYOffset=r.readShort(),this.yStrikeoutSize=r.readShort(),this.yStrikeoutPosition=r.readShort(),this.familyClass=r.readShort(),this.panose=(function(){var e,s;for(s=[],e=0;e<10;++e)s.push(r.readByte());return s})(),this.charRange=(function(){var e,s;for(s=[],e=0;e<4;++e)s.push(r.readInt());return s})(),this.vendorID=r.readString(4),this.selection=r.readShort(),this.firstCharIndex=r.readShort(),this.lastCharIndex=r.readShort(),this.version>0&&(this.ascent=r.readShort(),this.descent=r.readShort(),this.lineGap=r.readShort(),this.winAscent=r.readShort(),this.winDescent=r.readShort(),this.codePageRange=(function(){var e,s;for(s=[],e=0;e<2;e=++e)s.push(r.readInt());return s})(),this.version>1))return this.xHeight=r.readShort(),this.capHeight=r.readShort(),this.defaultChar=r.readShort(),this.breakChar=r.readShort(),this.maxContext=r.readShort()},t})(),T2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="post",t.prototype.parse=function(r){var e,s,i;switch(r.pos=this.offset,this.format=r.readInt(),this.italicAngle=r.readInt(),this.underlinePosition=r.readShort(),this.underlineThickness=r.readShort(),this.isFixedPitch=r.readInt(),this.minMemType42=r.readInt(),this.maxMemType42=r.readInt(),this.minMemType1=r.readInt(),this.maxMemType1=r.readInt(),this.format){case 65536:case 196608:break;case 131072:var a;for(s=r.readUInt16(),this.glyphNameIndex=[],a=0;0<=s?a<s:a>s;a=0<=s?++a:--a)this.glyphNameIndex.push(r.readUInt16());for(this.names=[],i=[];r.pos<this.offset+this.length;)e=r.readByte(),i.push(this.names.push(r.readString(e)));return i;case 151552:return s=r.readUInt16(),this.offsets=r.read(s);case 262144:return this.map=(function(){var d,o,c;for(c=[],a=d=0,o=this.file.maxp.numGlyphs;0<=o?d<o:d>o;a=0<=o?++d:--d)c.push(r.readUInt32());return c}).call(this)}},t})(),I2=function(t,r){this.raw=t,this.length=t.length,this.platformID=r.platformID,this.encodingID=r.encodingID,this.languageID=r.languageID},F2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="name",t.prototype.parse=function(r){var e,s,i,a,d,o,c,h,p,b,m;for(r.pos=this.offset,r.readShort(),e=r.readShort(),o=r.readShort(),s=[],a=0;0<=e?a<e:a>e;a=0<=e?++a:--a)s.push({platformID:r.readShort(),encodingID:r.readShort(),languageID:r.readShort(),nameID:r.readShort(),length:r.readShort(),offset:this.offset+o+r.readShort()});for(c={},a=p=0,b=s.length;p<b;a=++p)i=s[a],r.pos=i.offset,h=r.readString(i.length),d=new I2(h,i),c[m=i.nameID]==null&&(c[m]=[]),c[i.nameID].push(d);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},t})(),O2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="maxp",t.prototype.parse=function(r){return r.pos=this.offset,this.version=r.readInt(),this.numGlyphs=r.readUInt16(),this.maxPoints=r.readUInt16(),this.maxContours=r.readUInt16(),this.maxCompositePoints=r.readUInt16(),this.maxComponentContours=r.readUInt16(),this.maxZones=r.readUInt16(),this.maxTwilightPoints=r.readUInt16(),this.maxStorage=r.readUInt16(),this.maxFunctionDefs=r.readUInt16(),this.maxInstructionDefs=r.readUInt16(),this.maxStackElements=r.readUInt16(),this.maxSizeOfInstructions=r.readUInt16(),this.maxComponentElements=r.readUInt16(),this.maxComponentDepth=r.readUInt16()},t})(),D2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="hmtx",t.prototype.parse=function(r){var e,s,i,a,d,o,c;for(r.pos=this.offset,this.metrics=[],e=0,o=this.file.hhea.numberOfMetrics;0<=o?e<o:e>o;e=0<=o?++e:--e)this.metrics.push({advance:r.readUInt16(),lsb:r.readInt16()});for(i=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var h,p;for(p=[],e=h=0;0<=i?h<i:h>i;e=0<=i?++h:--h)p.push(r.readInt16());return p})(),this.widths=(function(){var h,p,b,m;for(m=[],h=0,p=(b=this.metrics).length;h<p;h++)a=b[h],m.push(a.advance);return m}).call(this),s=this.widths[this.widths.length-1],c=[],e=d=0;0<=i?d<i:d>i;e=0<=i?++d:--d)c.push(this.widths.push(s));return c},t.prototype.forGlyph=function(r){return r in this.metrics?this.metrics[r]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[r-this.metrics.length]}},t})(),ap=[].slice,R2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="glyf",t.prototype.parse=function(){return this.cache={}},t.prototype.glyphFor=function(r){var e,s,i,a,d,o,c,h,p,b;return r in this.cache?this.cache[r]:(a=this.file.loca,e=this.file.contents,s=a.indexOf(r),(i=a.lengthOf(r))===0?this.cache[r]=null:(e.pos=this.offset+s,d=(o=new qa(e.read(i))).readShort(),h=o.readShort(),b=o.readShort(),c=o.readShort(),p=o.readShort(),this.cache[r]=d===-1?new M2(o,h,b,c,p):new B2(o,d,h,b,c,p),this.cache[r]))},t.prototype.encode=function(r,e,s){var i,a,d,o,c;for(d=[],a=[],o=0,c=e.length;o<c;o++)i=r[e[o]],a.push(d.length),i&&(d=d.concat(i.encode(s)));return a.push(d.length),{table:d,offsets:a}},t})(),B2=(function(){function t(r,e,s,i,a,d){this.raw=r,this.numberOfContours=e,this.xMin=s,this.yMin=i,this.xMax=a,this.yMax=d,this.compound=!1}return t.prototype.encode=function(){return this.raw.data},t})(),M2=(function(){function t(r,e,s,i,a){var d,o;for(this.raw=r,this.xMin=e,this.yMin=s,this.xMax=i,this.yMax=a,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],d=this.raw;o=d.readShort(),this.glyphOffsets.push(d.pos),this.glyphIDs.push(d.readUInt16()),32&o;)d.pos+=1&o?4:2,128&o?d.pos+=8:64&o?d.pos+=4:8&o&&(d.pos+=2)}return t.prototype.encode=function(){var r,e,s;for(e=new qa(ap.call(this.raw.data)),r=0,s=this.glyphIDs.length;r<s;++r)e.pos=this.glyphOffsets[r];return e.data},t})(),U2=(function(){function t(){return t.__super__.constructor.apply(this,arguments)}return ta(t,qs),t.prototype.tag="loca",t.prototype.parse=function(r){var e,s;return r.pos=this.offset,e=this.file.head.indexToLocFormat,this.offsets=e===0?(function(){var i,a;for(a=[],s=0,i=this.length;s<i;s+=2)a.push(2*r.readUInt16());return a}).call(this):(function(){var i,a;for(a=[],s=0,i=this.length;s<i;s+=4)a.push(r.readUInt32());return a}).call(this)},t.prototype.indexOf=function(r){return this.offsets[r]},t.prototype.lengthOf=function(r){return this.offsets[r+1]-this.offsets[r]},t.prototype.encode=function(r,e){for(var s=new Uint32Array(this.offsets.length),i=0,a=0,d=0;d<s.length;++d)if(s[d]=i,a<e.length&&e[a]==d){++a,s[d]=i;var o=this.offsets[d],c=this.offsets[d+1]-o;c>0&&(i+=c)}for(var h=new Array(4*s.length),p=0;p<s.length;++p)h[4*p+3]=255&s[p],h[4*p+2]=(65280&s[p])>>8,h[4*p+1]=(16711680&s[p])>>16,h[4*p]=(4278190080&s[p])>>24;return h},t})(),z2=(function(){function t(r){this.font=r,this.subset={},this.unicodes={},this.next=33}return t.prototype.generateCmap=function(){var r,e,s,i,a;for(e in i=this.font.cmap.tables[0].codeMap,r={},a=this.subset)s=a[e],r[e]=i[s];return r},t.prototype.glyphsFor=function(r){var e,s,i,a,d,o,c;for(i={},d=0,o=r.length;d<o;d++)i[a=r[d]]=this.font.glyf.glyphFor(a);for(a in e=[],i)(s=i[a])!=null&&s.compound&&e.push.apply(e,s.glyphIDs);if(e.length>0)for(a in c=this.glyphsFor(e))s=c[a],i[a]=s;return i},t.prototype.encode=function(r,e){var s,i,a,d,o,c,h,p,b,m,u,w,g,_,y;for(i in s=sp.encode(this.generateCmap(),"unicode"),d=this.glyphsFor(r),u={0:0},y=s.charMap)u[(c=y[i]).old]=c.new;for(w in m=s.maxGlyphID,d)w in u||(u[w]=m++);return p=(function(A){var L,E;for(L in E={},A)E[A[L]]=L;return E})(u),b=Object.keys(p).sort(function(A,L){return A-L}),g=(function(){var A,L,E;for(E=[],A=0,L=b.length;A<L;A++)o=b[A],E.push(p[o]);return E})(),a=this.font.glyf.encode(d,g,u),h=this.font.loca.encode(a.offsets,g),_={cmap:this.font.cmap.raw(),glyf:a.table,loca:h,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(_["OS/2"]=this.font.os2.raw()),this.font.directory.encode(_)},t})();Mt.API.PDFObject=(function(){var t;function r(){}return t=function(e,s){return(Array(s+1).join("0")+e).slice(-s)},r.convert=function(e){var s,i,a,d;if(Array.isArray(e))return"["+(function(){var o,c,h;for(h=[],o=0,c=e.length;o<c;o++)s=e[o],h.push(r.convert(s));return h})().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+t(e.getUTCFullYear(),4)+t(e.getUTCMonth(),2)+t(e.getUTCDate(),2)+t(e.getUTCHours(),2)+t(e.getUTCMinutes(),2)+t(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(i in a=["<<"],e)d=e[i],a.push("/"+i+" "+r.convert(d));return a.push(">>"),a.join(`
`)}return""+e},r})();function el(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var gc={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var ch;function q2(){return ch||(ch=1,(function(t,r){(function(e){t.exports=e()})(function(){return(function e(s,i,a){function d(h,p){if(!i[h]){if(!s[h]){var b=typeof el=="function"&&el;if(!p&&b)return b(h,!0);if(o)return o(h,!0);var m=new Error("Cannot find module '"+h+"'");throw m.code="MODULE_NOT_FOUND",m}var u=i[h]={exports:{}};s[h][0].call(u.exports,function(w){var g=s[h][1][w];return d(g||w)},u,u.exports,e,s,i,a)}return i[h].exports}for(var o=typeof el=="function"&&el,c=0;c<a.length;c++)d(a[c]);return d})({1:[function(e,s,i){var a=e("./utils"),d=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var h,p,b,m,u,w,g,_=[],y=0,A=c.length,L=A,E=a.getTypeOf(c)!=="string";y<c.length;)L=A-y,b=E?(h=c[y++],p=y<A?c[y++]:0,y<A?c[y++]:0):(h=c.charCodeAt(y++),p=y<A?c.charCodeAt(y++):0,y<A?c.charCodeAt(y++):0),m=h>>2,u=(3&h)<<4|p>>4,w=1<L?(15&p)<<2|b>>6:64,g=2<L?63&b:64,_.push(o.charAt(m)+o.charAt(u)+o.charAt(w)+o.charAt(g));return _.join("")},i.decode=function(c){var h,p,b,m,u,w,g=0,_=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var A,L=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===o.charAt(64)&&L--,c.charAt(c.length-2)===o.charAt(64)&&L--,L%1!=0)throw new Error("Invalid base64 input, bad content length.");for(A=d.uint8array?new Uint8Array(0|L):new Array(0|L);g<c.length;)h=o.indexOf(c.charAt(g++))<<2|(m=o.indexOf(c.charAt(g++)))>>4,p=(15&m)<<4|(u=o.indexOf(c.charAt(g++)))>>2,b=(3&u)<<6|(w=o.indexOf(c.charAt(g++))),A[_++]=h,u!==64&&(A[_++]=p),w!==64&&(A[_++]=b);return A}},{"./support":30,"./utils":32}],2:[function(e,s,i){var a=e("./external"),d=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),c=e("./stream/DataLengthProbe");function h(p,b,m,u,w){this.compressedSize=p,this.uncompressedSize=b,this.crc32=m,this.compression=u,this.compressedContent=w}h.prototype={getContentWorker:function(){var p=new d(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),b=this;return p.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new d(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(p,b,m){return p.pipe(new o).pipe(new c("uncompressedSize")).pipe(b.compressWorker(m)).pipe(new c("compressedSize")).withStreamInfo("compression",b)},s.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,s,i){var a=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,s,i){var a=e("./utils"),d=(function(){for(var o,c=[],h=0;h<256;h++){o=h;for(var p=0;p<8;p++)o=1&o?3988292384^o>>>1:o>>>1;c[h]=o}return c})();s.exports=function(o,c){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?(function(h,p,b,m){var u=d,w=m+b;h^=-1;for(var g=m;g<w;g++)h=h>>>8^u[255&(h^p[g])];return-1^h})(0|c,o,o.length,0):(function(h,p,b,m){var u=d,w=m+b;h^=-1;for(var g=m;g<w;g++)h=h>>>8^u[255&(h^p.charCodeAt(g))];return-1^h})(0|c,o,o.length,0):0}},{"./utils":32}],5:[function(e,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,s,i){var a=null;a=typeof Promise<"u"?Promise:e("lie"),s.exports={Promise:a}},{lie:37}],7:[function(e,s,i){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",d=e("pako"),o=e("./utils"),c=e("./stream/GenericWorker"),h=a?"uint8array":"array";function p(b,m){c.call(this,"FlateWorker/"+b),this._pako=null,this._pakoAction=b,this._pakoOptions=m,this.meta={}}i.magic="\b\0",o.inherits(p,c),p.prototype.processChunk=function(b){this.meta=b.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,b.data),!1)},p.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new d[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(m){b.push({data:m,meta:b.meta})}},i.compressWorker=function(b){return new p("Deflate",b)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,s,i){function a(u,w){var g,_="";for(g=0;g<w;g++)_+=String.fromCharCode(255&u),u>>>=8;return _}function d(u,w,g,_,y,A){var L,E,F=u.file,Z=u.compression,Y=A!==h.utf8encode,G=o.transformTo("string",A(F.name)),O=o.transformTo("string",h.utf8encode(F.name)),Q=F.comment,I=o.transformTo("string",A(Q)),k=o.transformTo("string",h.utf8encode(Q)),D=O.length!==F.name.length,v=k.length!==Q.length,te="",ce="",re="",se=F.dir,le=F.date,Se={crc32:0,compressedSize:0,uncompressedSize:0};w&&!g||(Se.crc32=u.crc32,Se.compressedSize=u.compressedSize,Se.uncompressedSize=u.uncompressedSize);var ne=0;w&&(ne|=8),Y||!D&&!v||(ne|=2048);var C=0,H=0;se&&(C|=16),y==="UNIX"?(H=798,C|=(function(X,pe){var ve=X;return X||(ve=pe?16893:33204),(65535&ve)<<16})(F.unixPermissions,se)):(H=20,C|=(function(X){return 63&(X||0)})(F.dosPermissions)),L=le.getUTCHours(),L<<=6,L|=le.getUTCMinutes(),L<<=5,L|=le.getUTCSeconds()/2,E=le.getUTCFullYear()-1980,E<<=4,E|=le.getUTCMonth()+1,E<<=5,E|=le.getUTCDate(),D&&(ce=a(1,1)+a(p(G),4)+O,te+="up"+a(ce.length,2)+ce),v&&(re=a(1,1)+a(p(I),4)+k,te+="uc"+a(re.length,2)+re);var K="";return K+=`
\0`,K+=a(ne,2),K+=Z.magic,K+=a(L,2),K+=a(E,2),K+=a(Se.crc32,4),K+=a(Se.compressedSize,4),K+=a(Se.uncompressedSize,4),K+=a(G.length,2),K+=a(te.length,2),{fileRecord:b.LOCAL_FILE_HEADER+K+G+te,dirRecord:b.CENTRAL_FILE_HEADER+a(H,2)+K+a(I.length,2)+"\0\0\0\0"+a(C,4)+a(_,4)+G+te+I}}var o=e("../utils"),c=e("../stream/GenericWorker"),h=e("../utf8"),p=e("../crc32"),b=e("../signature");function m(u,w,g,_){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=g,this.encodeFileName=_,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(m,c),m.prototype.push=function(u){var w=u.meta.percent||0,g=this.entriesCount,_=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,c.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:g?(w+100*(g-_-1))/g:100}}))},m.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var w=this.streamFiles&&!u.file.dir;if(w){var g=d(u,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(u){this.accumulate=!1;var w=this.streamFiles&&!u.file.dir,g=d(u,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),w)this.push({data:(function(_){return b.DATA_DESCRIPTOR+a(_.crc32,4)+a(_.compressedSize,4)+a(_.uncompressedSize,4)})(u),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var u=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var g=this.bytesWritten-u,_=(function(y,A,L,E,F){var Z=o.transformTo("string",F(E));return b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(y,2)+a(y,2)+a(A,4)+a(L,4)+a(Z.length,2)+Z})(this.dirRecords.length,g,u,this.zipComment,this.encodeFileName);this.push({data:_,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(u){this._sources.push(u);var w=this;return u.on("data",function(g){w.processChunk(g)}),u.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),u.on("error",function(g){w.error(g)}),this},m.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(u){var w=this._sources;if(!c.prototype.error.call(this,u))return!1;for(var g=0;g<w.length;g++)try{w[g].error(u)}catch{}return!0},m.prototype.lock=function(){c.prototype.lock.call(this);for(var u=this._sources,w=0;w<u.length;w++)u[w].lock()},s.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,s,i){var a=e("../compressions"),d=e("./ZipFileWorker");i.generateWorker=function(o,c,h){var p=new d(c.streamFiles,h,c.platform,c.encodeFileName),b=0;try{o.forEach(function(m,u){b++;var w=(function(A,L){var E=A||L,F=a[E];if(!F)throw new Error(E+" is not a valid compression method !");return F})(u.options.compression,c.compression),g=u.options.compressionOptions||c.compressionOptions||{},_=u.dir,y=u.date;u._compressWorker(w,g).withStreamInfo("file",{name:m,dir:_,date:y,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(p)}),p.entriesCount=b}catch(m){p.error(m)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,s,i){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var d=new a;for(var o in this)typeof this[o]!="function"&&(d[o]=this[o]);return d}}(a.prototype=e("./object")).loadAsync=e("./load"),a.support=e("./support"),a.defaults=e("./defaults"),a.version="3.10.1",a.loadAsync=function(d,o){return new a().loadAsync(d,o)},a.external=e("./external"),s.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,s,i){var a=e("./utils"),d=e("./external"),o=e("./utf8"),c=e("./zipEntries"),h=e("./stream/Crc32Probe"),p=e("./nodejsUtils");function b(m){return new d.Promise(function(u,w){var g=m.decompressed.getContentWorker().pipe(new h);g.on("error",function(_){w(_)}).on("end",function(){g.streamInfo.crc32!==m.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}s.exports=function(m,u){var w=this;return u=a.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),p.isNode&&p.isStream(m)?d.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",m,!0,u.optimizedBinaryString,u.base64).then(function(g){var _=new c(u);return _.load(g),_}).then(function(g){var _=[d.Promise.resolve(g)],y=g.files;if(u.checkCRC32)for(var A=0;A<y.length;A++)_.push(b(y[A]));return d.Promise.all(_)}).then(function(g){for(var _=g.shift(),y=_.files,A=0;A<y.length;A++){var L=y[A],E=L.fileNameStr,F=a.resolve(L.fileNameStr);w.file(F,L.decompressed,{binary:!0,optimizedBinaryString:!0,date:L.date,dir:L.dir,comment:L.fileCommentStr.length?L.fileCommentStr:null,unixPermissions:L.unixPermissions,dosPermissions:L.dosPermissions,createFolders:u.createFolders}),L.dir||(w.file(F).unsafeOriginalName=E)}return _.zipComment.length&&(w.comment=_.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,s,i){var a=e("../utils"),d=e("../stream/GenericWorker");function o(c,h){d.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(h)}a.inherits(o,d),o.prototype._bindStream=function(c){var h=this;(this._stream=c).pause(),c.on("data",function(p){h.push({data:p,meta:{percent:0}})}).on("error",function(p){h.isPaused?this.generatedError=p:h.error(p)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!d.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,s,i){var a=e("readable-stream").Readable;function d(o,c,h){a.call(this,c),this._helper=o;var p=this;o.on("data",function(b,m){p.push(b)||p._helper.pause(),h&&h(m)}).on("error",function(b){p.emit("error",b)}).on("end",function(){p.push(null)})}e("../utils").inherits(d,a),d.prototype._read=function(){this._helper.resume()},s.exports=d},{"../utils":32,"readable-stream":16}],14:[function(e,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(a,d){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,d);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,d)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var d=new Buffer(a);return d.fill(0),d},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(e,s,i){function a(F,Z,Y){var G,O=o.getTypeOf(Z),Q=o.extend(Y||{},p);Q.date=Q.date||new Date,Q.compression!==null&&(Q.compression=Q.compression.toUpperCase()),typeof Q.unixPermissions=="string"&&(Q.unixPermissions=parseInt(Q.unixPermissions,8)),Q.unixPermissions&&16384&Q.unixPermissions&&(Q.dir=!0),Q.dosPermissions&&16&Q.dosPermissions&&(Q.dir=!0),Q.dir&&(F=y(F)),Q.createFolders&&(G=_(F))&&A.call(this,G,!0);var I=O==="string"&&Q.binary===!1&&Q.base64===!1;Y&&Y.binary!==void 0||(Q.binary=!I),(Z instanceof b&&Z.uncompressedSize===0||Q.dir||!Z||Z.length===0)&&(Q.base64=!1,Q.binary=!0,Z="",Q.compression="STORE",O="string");var k=null;k=Z instanceof b||Z instanceof c?Z:w.isNode&&w.isStream(Z)?new g(F,Z):o.prepareContent(F,Z,Q.binary,Q.optimizedBinaryString,Q.base64);var D=new m(F,k,Q);this.files[F]=D}var d=e("./utf8"),o=e("./utils"),c=e("./stream/GenericWorker"),h=e("./stream/StreamHelper"),p=e("./defaults"),b=e("./compressedObject"),m=e("./zipObject"),u=e("./generate"),w=e("./nodejsUtils"),g=e("./nodejs/NodejsStreamInputAdapter"),_=function(F){F.slice(-1)==="/"&&(F=F.substring(0,F.length-1));var Z=F.lastIndexOf("/");return 0<Z?F.substring(0,Z):""},y=function(F){return F.slice(-1)!=="/"&&(F+="/"),F},A=function(F,Z){return Z=Z!==void 0?Z:p.createFolders,F=y(F),this.files[F]||a.call(this,F,null,{dir:!0,createFolders:Z}),this.files[F]};function L(F){return Object.prototype.toString.call(F)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(F){var Z,Y,G;for(Z in this.files)G=this.files[Z],(Y=Z.slice(this.root.length,Z.length))&&Z.slice(0,this.root.length)===this.root&&F(Y,G)},filter:function(F){var Z=[];return this.forEach(function(Y,G){F(Y,G)&&Z.push(G)}),Z},file:function(F,Z,Y){if(arguments.length!==1)return F=this.root+F,a.call(this,F,Z,Y),this;if(L(F)){var G=F;return this.filter(function(Q,I){return!I.dir&&G.test(Q)})}var O=this.files[this.root+F];return O&&!O.dir?O:null},folder:function(F){if(!F)return this;if(L(F))return this.filter(function(O,Q){return Q.dir&&F.test(O)});var Z=this.root+F,Y=A.call(this,Z),G=this.clone();return G.root=Y.name,G},remove:function(F){F=this.root+F;var Z=this.files[F];if(Z||(F.slice(-1)!=="/"&&(F+="/"),Z=this.files[F]),Z&&!Z.dir)delete this.files[F];else for(var Y=this.filter(function(O,Q){return Q.name.slice(0,F.length)===F}),G=0;G<Y.length;G++)delete this.files[Y[G].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(F){var Z,Y={};try{if((Y=o.extend(F||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:d.utf8encode})).type=Y.type.toLowerCase(),Y.compression=Y.compression.toUpperCase(),Y.type==="binarystring"&&(Y.type="string"),!Y.type)throw new Error("No output type specified.");o.checkSupport(Y.type),Y.platform!=="darwin"&&Y.platform!=="freebsd"&&Y.platform!=="linux"&&Y.platform!=="sunos"||(Y.platform="UNIX"),Y.platform==="win32"&&(Y.platform="DOS");var G=Y.comment||this.comment||"";Z=u.generateWorker(this,Y,G)}catch(O){(Z=new c("error")).error(O)}return new h(Z,Y.type||"string",Y.mimeType)},generateAsync:function(F,Z){return this.generateInternalStream(F).accumulate(Z)},generateNodeStream:function(F,Z){return(F=F||{}).type||(F.type="nodebuffer"),this.generateInternalStream(F).toNodejsStream(Z)}};s.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,s,i){s.exports=e("stream")},{stream:void 0}],17:[function(e,s,i){var a=e("./DataReader");function d(o){a.call(this,o);for(var c=0;c<this.data.length;c++)o[c]=255&o[c]}e("../utils").inherits(d,a),d.prototype.byteAt=function(o){return this.data[this.zero+o]},d.prototype.lastIndexOfSignature=function(o){for(var c=o.charCodeAt(0),h=o.charCodeAt(1),p=o.charCodeAt(2),b=o.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===c&&this.data[m+1]===h&&this.data[m+2]===p&&this.data[m+3]===b)return m-this.zero;return-1},d.prototype.readAndCheckSignature=function(o){var c=o.charCodeAt(0),h=o.charCodeAt(1),p=o.charCodeAt(2),b=o.charCodeAt(3),m=this.readData(4);return c===m[0]&&h===m[1]&&p===m[2]&&b===m[3]},d.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},s.exports=d},{"../utils":32,"./DataReader":18}],18:[function(e,s,i){var a=e("../utils");function d(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}d.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var c,h=0;for(this.checkOffset(o),c=this.index+o-1;c>=this.index;c--)h=(h<<8)+this.byteAt(c);return this.index+=o,h},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=d},{"../utils":32}],19:[function(e,s,i){var a=e("./Uint8ArrayReader");function d(o){a.call(this,o)}e("../utils").inherits(d,a),d.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},s.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,s,i){var a=e("./DataReader");function d(o){a.call(this,o)}e("../utils").inherits(d,a),d.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},d.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},d.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},d.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},s.exports=d},{"../utils":32,"./DataReader":18}],21:[function(e,s,i){var a=e("./ArrayReader");function d(o){a.call(this,o)}e("../utils").inherits(d,a),d.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},s.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(e,s,i){var a=e("../utils"),d=e("../support"),o=e("./ArrayReader"),c=e("./StringReader"),h=e("./NodeBufferReader"),p=e("./Uint8ArrayReader");s.exports=function(b){var m=a.getTypeOf(b);return a.checkSupport(m),m!=="string"||d.uint8array?m==="nodebuffer"?new h(b):d.uint8array?new p(a.transformTo("uint8array",b)):new o(a.transformTo("array",b)):new c(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,s,i){var a=e("./GenericWorker"),d=e("../utils");function o(c){a.call(this,"ConvertWorker to "+c),this.destType=c}d.inherits(o,a),o.prototype.processChunk=function(c){this.push({data:d.transformTo(this.destType,c.data),meta:c.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,s,i){var a=e("./GenericWorker"),d=e("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,a),o.prototype.processChunk=function(c){this.streamInfo.crc32=d(c.data,this.streamInfo.crc32||0),this.push(c)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,s,i){var a=e("../utils"),d=e("./GenericWorker");function o(c){d.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}a.inherits(o,d),o.prototype.processChunk=function(c){if(c){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+c.data.length}d.prototype.processChunk.call(this,c)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,s,i){var a=e("../utils"),d=e("./GenericWorker");function o(c){d.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(p){h.dataIsReady=!0,h.data=p,h.max=p&&p.length||0,h.type=a.getTypeOf(p),h.isPaused||h._tickAndRepeat()},function(p){h.error(p)})}a.inherits(o,d),o.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,h);break;case"uint8array":c=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":c=this.data.slice(this.index,h)}return this.index=h,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,s,i){function a(d){this.name=d||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(d){this.emit("data",d)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(d){this.emit("error",d)}return!0},error:function(d){return!this.isFinished&&(this.isPaused?this.generatedError=d:(this.isFinished=!0,this.emit("error",d),this.previous&&this.previous.error(d),this.cleanUp()),!0)},on:function(d,o){return this._listeners[d].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(d,o){if(this._listeners[d])for(var c=0;c<this._listeners[d].length;c++)this._listeners[d][c].call(this,o)},pipe:function(d){return d.registerPrevious(this)},registerPrevious:function(d){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=d.streamInfo,this.mergeStreamInfo(),this.previous=d;var o=this;return d.on("data",function(c){o.processChunk(c)}),d.on("end",function(){o.end()}),d.on("error",function(c){o.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var d=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),d=!0),this.previous&&this.previous.resume(),!d},flush:function(){},processChunk:function(d){this.push(d)},withStreamInfo:function(d,o){return this.extraStreamInfo[d]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var d in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,d)&&(this.streamInfo[d]=this.extraStreamInfo[d])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var d="Worker "+this.name;return this.previous?this.previous+" -> "+d:d}},s.exports=a},{}],29:[function(e,s,i){var a=e("../utils"),d=e("./ConvertWorker"),o=e("./GenericWorker"),c=e("../base64"),h=e("../support"),p=e("../external"),b=null;if(h.nodestream)try{b=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(w,g){return new p.Promise(function(_,y){var A=[],L=w._internalType,E=w._outputType,F=w._mimeType;w.on("data",function(Z,Y){A.push(Z),g&&g(Y)}).on("error",function(Z){A=[],y(Z)}).on("end",function(){try{var Z=(function(Y,G,O){switch(Y){case"blob":return a.newBlob(a.transformTo("arraybuffer",G),O);case"base64":return c.encode(G);default:return a.transformTo(Y,G)}})(E,(function(Y,G){var O,Q=0,I=null,k=0;for(O=0;O<G.length;O++)k+=G[O].length;switch(Y){case"string":return G.join("");case"array":return Array.prototype.concat.apply([],G);case"uint8array":for(I=new Uint8Array(k),O=0;O<G.length;O++)I.set(G[O],Q),Q+=G[O].length;return I;case"nodebuffer":return Buffer.concat(G);default:throw new Error("concat : unsupported type '"+Y+"'")}})(L,A),F);_(Z)}catch(Y){y(Y)}A=[]}).resume()})}function u(w,g,_){var y=g;switch(g){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=g,this._mimeType=_,a.checkSupport(y),this._worker=w.pipe(new d(y)),w.lock()}catch(A){this._worker=new o("error"),this._worker.error(A)}}u.prototype={accumulate:function(w){return m(this,w)},on:function(w,g){var _=this;return w==="data"?this._worker.on(w,function(y){g.call(_,y.data,y.meta)}):this._worker.on(w,function(){a.delay(g,arguments,_)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new b(this,{objectMode:this._outputType!=="nodebuffer"},w)}},s.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var a=new ArrayBuffer(0);try{i.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);d.append(a),i.blob=d.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,s,i){for(var a=e("./utils"),d=e("./support"),o=e("./nodejsUtils"),c=e("./stream/GenericWorker"),h=new Array(256),p=0;p<256;p++)h[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;h[254]=h[254]=1;function b(){c.call(this,"utf-8 decode"),this.leftOver=null}function m(){c.call(this,"utf-8 encode")}i.utf8encode=function(u){return d.nodebuffer?o.newBufferFrom(u,"utf-8"):(function(w){var g,_,y,A,L,E=w.length,F=0;for(A=0;A<E;A++)(64512&(_=w.charCodeAt(A)))==55296&&A+1<E&&(64512&(y=w.charCodeAt(A+1)))==56320&&(_=65536+(_-55296<<10)+(y-56320),A++),F+=_<128?1:_<2048?2:_<65536?3:4;for(g=d.uint8array?new Uint8Array(F):new Array(F),A=L=0;L<F;A++)(64512&(_=w.charCodeAt(A)))==55296&&A+1<E&&(64512&(y=w.charCodeAt(A+1)))==56320&&(_=65536+(_-55296<<10)+(y-56320),A++),_<128?g[L++]=_:(_<2048?g[L++]=192|_>>>6:(_<65536?g[L++]=224|_>>>12:(g[L++]=240|_>>>18,g[L++]=128|_>>>12&63),g[L++]=128|_>>>6&63),g[L++]=128|63&_);return g})(u)},i.utf8decode=function(u){return d.nodebuffer?a.transformTo("nodebuffer",u).toString("utf-8"):(function(w){var g,_,y,A,L=w.length,E=new Array(2*L);for(g=_=0;g<L;)if((y=w[g++])<128)E[_++]=y;else if(4<(A=h[y]))E[_++]=65533,g+=A-1;else{for(y&=A===2?31:A===3?15:7;1<A&&g<L;)y=y<<6|63&w[g++],A--;1<A?E[_++]=65533:y<65536?E[_++]=y:(y-=65536,E[_++]=55296|y>>10&1023,E[_++]=56320|1023&y)}return E.length!==_&&(E.subarray?E=E.subarray(0,_):E.length=_),a.applyFromCharCode(E)})(u=a.transformTo(d.uint8array?"uint8array":"array",u))},a.inherits(b,c),b.prototype.processChunk=function(u){var w=a.transformTo(d.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(d.uint8array){var g=w;(w=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),w.set(g,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var _=(function(A,L){var E;for((L=L||A.length)>A.length&&(L=A.length),E=L-1;0<=E&&(192&A[E])==128;)E--;return E<0||E===0?L:E+h[A[E]]>L?E:L})(w),y=w;_!==w.length&&(d.uint8array?(y=w.subarray(0,_),this.leftOver=w.subarray(_,w.length)):(y=w.slice(0,_),this.leftOver=w.slice(_,w.length))),this.push({data:i.utf8decode(y),meta:u.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=b,a.inherits(m,c),m.prototype.processChunk=function(u){this.push({data:i.utf8encode(u.data),meta:u.meta})},i.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,s,i){var a=e("./support"),d=e("./base64"),o=e("./nodejsUtils"),c=e("./external");function h(g){return g}function p(g,_){for(var y=0;y<g.length;++y)_[y]=255&g.charCodeAt(y);return _}e("setimmediate"),i.newBlob=function(g,_){i.checkSupport("blob");try{return new Blob([g],{type:_})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(g),y.getBlob(_)}catch{throw new Error("Bug : can't construct the Blob.")}}};var b={stringifyByChunk:function(g,_,y){var A=[],L=0,E=g.length;if(E<=y)return String.fromCharCode.apply(null,g);for(;L<E;)_==="array"||_==="nodebuffer"?A.push(String.fromCharCode.apply(null,g.slice(L,Math.min(L+y,E)))):A.push(String.fromCharCode.apply(null,g.subarray(L,Math.min(L+y,E)))),L+=y;return A.join("")},stringifyByChar:function(g){for(var _="",y=0;y<g.length;y++)_+=String.fromCharCode(g[y]);return _},applyCanBeUsed:{uint8array:(function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function m(g){var _=65536,y=i.getTypeOf(g),A=!0;if(y==="uint8array"?A=b.applyCanBeUsed.uint8array:y==="nodebuffer"&&(A=b.applyCanBeUsed.nodebuffer),A)for(;1<_;)try{return b.stringifyByChunk(g,y,_)}catch{_=Math.floor(_/2)}return b.stringifyByChar(g)}function u(g,_){for(var y=0;y<g.length;y++)_[y]=g[y];return _}i.applyFromCharCode=m;var w={};w.string={string:h,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return w.string.uint8array(g).buffer},uint8array:function(g){return p(g,new Uint8Array(g.length))},nodebuffer:function(g){return p(g,o.allocBuffer(g.length))}},w.array={string:m,array:h,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},w.arraybuffer={string:function(g){return m(new Uint8Array(g))},array:function(g){return u(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:h,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},w.uint8array={string:m,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:h,nodebuffer:function(g){return o.newBufferFrom(g)}},w.nodebuffer={string:m,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return w.nodebuffer.uint8array(g).buffer},uint8array:function(g){return u(g,new Uint8Array(g.length))},nodebuffer:h},i.transformTo=function(g,_){if(_=_||"",!g)return _;i.checkSupport(g);var y=i.getTypeOf(_);return w[y][g](_)},i.resolve=function(g){for(var _=g.split("/"),y=[],A=0;A<_.length;A++){var L=_[A];L==="."||L===""&&A!==0&&A!==_.length-1||(L===".."?y.pop():y.push(L))}return y.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(g)?"nodebuffer":a.uint8array&&g instanceof Uint8Array?"uint8array":a.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!a[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var _,y,A="";for(y=0;y<(g||"").length;y++)A+="\\x"+((_=g.charCodeAt(y))<16?"0":"")+_.toString(16).toUpperCase();return A},i.delay=function(g,_,y){setImmediate(function(){g.apply(y||null,_||[])})},i.inherits=function(g,_){function y(){}y.prototype=_.prototype,g.prototype=new y},i.extend=function(){var g,_,y={};for(g=0;g<arguments.length;g++)for(_ in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],_)&&y[_]===void 0&&(y[_]=arguments[g][_]);return y},i.prepareContent=function(g,_,y,A,L){return c.Promise.resolve(_).then(function(E){return a.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new c.Promise(function(F,Z){var Y=new FileReader;Y.onload=function(G){F(G.target.result)},Y.onerror=function(G){Z(G.target.error)},Y.readAsArrayBuffer(E)}):E}).then(function(E){var F=i.getTypeOf(E);return F?(F==="arraybuffer"?E=i.transformTo("uint8array",E):F==="string"&&(L?E=d.decode(E):y&&A!==!0&&(E=(function(Z){return p(Z,a.uint8array?new Uint8Array(Z.length):new Array(Z.length))})(E))),E):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,s,i){var a=e("./reader/readerFor"),d=e("./utils"),o=e("./signature"),c=e("./zipEntry"),h=e("./support");function p(b){this.files=[],this.loadOptions=b}p.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+d.pretty(m)+", expected "+d.pretty(b)+")")}},isSignature:function(b,m){var u=this.reader.index;this.reader.setIndex(b);var w=this.reader.readString(4)===m;return this.reader.setIndex(u),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength),m=h.uint8array?"uint8array":"array",u=d.transformTo(m,b);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var b,m,u,w=this.zip64EndOfCentralSize-44;0<w;)b=this.reader.readInt(2),m=this.reader.readInt(4),u=this.reader.readData(m),this.zip64ExtensibleData[b]={id:b,length:m,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var b,m;for(b=0;b<this.files.length;b++)m=this.files[b],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(b=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(b<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var m=b;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===d.MAX_VALUE_16BITS||this.diskWithCentralDirStart===d.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===d.MAX_VALUE_16BITS||this.centralDirRecords===d.MAX_VALUE_16BITS||this.centralDirSize===d.MAX_VALUE_32BITS||this.centralDirOffset===d.MAX_VALUE_32BITS){if(this.zip64=!0,(b=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var w=m-u;if(0<w)this.isSignature(m,o.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(b){this.reader=a(b)},load:function(b){this.prepareReader(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,s,i){var a=e("./reader/readerFor"),d=e("./utils"),o=e("./compressedObject"),c=e("./crc32"),h=e("./utf8"),p=e("./compressions"),b=e("./support");function m(u,w){this.options=u,this.loadOptions=w}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var w,g;if(u.skip(22),this.fileNameLength=u.readInt(2),g=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=(function(_){for(var y in p)if(Object.prototype.hasOwnProperty.call(p,y)&&p[y].magic===_)return p[y];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+d.pretty(this.compressionMethod)+" unknown (inner file : "+d.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,w,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var w=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(w),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=a(this.extraFields[1].value);this.uncompressedSize===d.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===d.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===d.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===d.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var w,g,_,y=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<y;)w=u.readInt(2),g=u.readInt(2),_=u.readData(g),this.extraFields[w]={id:w,length:g,value:_};u.setIndex(y)},handleUTF8:function(){var u=b.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var g=d.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var _=this.findExtraFieldUnicodeComment();if(_!==null)this.fileCommentStr=_;else{var y=d.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var w=a(u.value);return w.readInt(1)!==1||c(this.fileName)!==w.readInt(4)?null:h.utf8decode(w.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var w=a(u.value);return w.readInt(1)!==1||c(this.fileComment)!==w.readInt(4)?null:h.utf8decode(w.readData(u.length-5))}return null}},s.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,s,i){function a(w,g,_){this.name=w,this.dir=_.dir,this.date=_.date,this.comment=_.comment,this.unixPermissions=_.unixPermissions,this.dosPermissions=_.dosPermissions,this._data=g,this._dataBinary=_.binary,this.options={compression:_.compression,compressionOptions:_.compressionOptions}}var d=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),c=e("./utf8"),h=e("./compressedObject"),p=e("./stream/GenericWorker");a.prototype={internalStream:function(w){var g=null,_="string";try{if(!w)throw new Error("No output type specified.");var y=(_=w.toLowerCase())==="string"||_==="text";_!=="binarystring"&&_!=="text"||(_="string"),g=this._decompressWorker();var A=!this._dataBinary;A&&!y&&(g=g.pipe(new c.Utf8EncodeWorker)),!A&&y&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(L){(g=new p("error")).error(L)}return new d(g,_,"")},async:function(w,g){return this.internalStream(w).accumulate(g)},nodeStream:function(w,g){return this.internalStream(w||"nodebuffer").toNodejsStream(g)},_compressWorker:function(w,g){if(this._data instanceof h&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var _=this._decompressWorker();return this._dataBinary||(_=_.pipe(new c.Utf8EncodeWorker)),h.createWorkerFrom(_,w,g)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof p?this._data:new o(this._data)}};for(var b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<b.length;u++)a.prototype[b[u]]=m;s.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,s,i){(function(a){var d,o,c=a.MutationObserver||a.WebKitMutationObserver;if(c){var h=0,p=new c(w),b=a.document.createTextNode("");p.observe(b,{characterData:!0}),d=function(){b.data=h=++h%2}}else if(a.setImmediate||a.MessageChannel===void 0)d="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var g=a.document.createElement("script");g.onreadystatechange=function(){w(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},a.document.documentElement.appendChild(g)}:function(){setTimeout(w,0)};else{var m=new a.MessageChannel;m.port1.onmessage=w,d=function(){m.port2.postMessage(0)}}var u=[];function w(){var g,_;o=!0;for(var y=u.length;y;){for(_=u,u=[],g=-1;++g<y;)_[g]();y=u.length}o=!1}s.exports=function(g){u.push(g)!==1||o||d()}}).call(this,typeof Uo<"u"?Uo:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,s,i){var a=e("immediate");function d(){}var o={},c=["REJECTED"],h=["FULFILLED"],p=["PENDING"];function b(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,y!==d&&g(this,y)}function m(y,A,L){this.promise=y,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof L=="function"&&(this.onRejected=L,this.callRejected=this.otherCallRejected)}function u(y,A,L){a(function(){var E;try{E=A(L)}catch(F){return o.reject(y,F)}E===y?o.reject(y,new TypeError("Cannot resolve promise with itself")):o.resolve(y,E)})}function w(y){var A=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof A=="function")return function(){A.apply(y,arguments)}}function g(y,A){var L=!1;function E(Y){L||(L=!0,o.reject(y,Y))}function F(Y){L||(L=!0,o.resolve(y,Y))}var Z=_(function(){A(F,E)});Z.status==="error"&&E(Z.value)}function _(y,A){var L={};try{L.value=y(A),L.status="success"}catch(E){L.status="error",L.value=E}return L}(s.exports=b).prototype.finally=function(y){if(typeof y!="function")return this;var A=this.constructor;return this.then(function(L){return A.resolve(y()).then(function(){return L})},function(L){return A.resolve(y()).then(function(){throw L})})},b.prototype.catch=function(y){return this.then(null,y)},b.prototype.then=function(y,A){if(typeof y!="function"&&this.state===h||typeof A!="function"&&this.state===c)return this;var L=new this.constructor(d);return this.state!==p?u(L,this.state===h?y:A,this.outcome):this.queue.push(new m(L,y,A)),L},m.prototype.callFulfilled=function(y){o.resolve(this.promise,y)},m.prototype.otherCallFulfilled=function(y){u(this.promise,this.onFulfilled,y)},m.prototype.callRejected=function(y){o.reject(this.promise,y)},m.prototype.otherCallRejected=function(y){u(this.promise,this.onRejected,y)},o.resolve=function(y,A){var L=_(w,A);if(L.status==="error")return o.reject(y,L.value);var E=L.value;if(E)g(y,E);else{y.state=h,y.outcome=A;for(var F=-1,Z=y.queue.length;++F<Z;)y.queue[F].callFulfilled(A)}return y},o.reject=function(y,A){y.state=c,y.outcome=A;for(var L=-1,E=y.queue.length;++L<E;)y.queue[L].callRejected(A);return y},b.resolve=function(y){return y instanceof this?y:o.resolve(new this(d),y)},b.reject=function(y){var A=new this(d);return o.reject(A,y)},b.all=function(y){var A=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=y.length,E=!1;if(!L)return this.resolve([]);for(var F=new Array(L),Z=0,Y=-1,G=new this(d);++Y<L;)O(y[Y],Y);return G;function O(Q,I){A.resolve(Q).then(function(k){F[I]=k,++Z!==L||E||(E=!0,o.resolve(G,F))},function(k){E||(E=!0,o.reject(G,k))})}},b.race=function(y){var A=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=y.length,E=!1;if(!L)return this.resolve([]);for(var F=-1,Z=new this(d);++F<L;)Y=y[F],A.resolve(Y).then(function(G){E||(E=!0,o.resolve(Z,G))},function(G){E||(E=!0,o.reject(Z,G))});var Y;return Z}},{immediate:36}],38:[function(e,s,i){var a={};(0,e("./lib/utils/common").assign)(a,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),s.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,s,i){var a=e("./zlib/deflate"),d=e("./utils/common"),o=e("./utils/strings"),c=e("./zlib/messages"),h=e("./zlib/zstream"),p=Object.prototype.toString,b=0,m=-1,u=0,w=8;function g(y){if(!(this instanceof g))return new g(y);this.options=d.assign({level:m,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},y||{});var A=this.options;A.raw&&0<A.windowBits?A.windowBits=-A.windowBits:A.gzip&&0<A.windowBits&&A.windowBits<16&&(A.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var L=a.deflateInit2(this.strm,A.level,A.method,A.windowBits,A.memLevel,A.strategy);if(L!==b)throw new Error(c[L]);if(A.header&&a.deflateSetHeader(this.strm,A.header),A.dictionary){var E;if(E=typeof A.dictionary=="string"?o.string2buf(A.dictionary):p.call(A.dictionary)==="[object ArrayBuffer]"?new Uint8Array(A.dictionary):A.dictionary,(L=a.deflateSetDictionary(this.strm,E))!==b)throw new Error(c[L]);this._dict_set=!0}}function _(y,A){var L=new g(A);if(L.push(y,!0),L.err)throw L.msg||c[L.err];return L.result}g.prototype.push=function(y,A){var L,E,F=this.strm,Z=this.options.chunkSize;if(this.ended)return!1;E=A===~~A?A:A===!0?4:0,typeof y=="string"?F.input=o.string2buf(y):p.call(y)==="[object ArrayBuffer]"?F.input=new Uint8Array(y):F.input=y,F.next_in=0,F.avail_in=F.input.length;do{if(F.avail_out===0&&(F.output=new d.Buf8(Z),F.next_out=0,F.avail_out=Z),(L=a.deflate(F,E))!==1&&L!==b)return this.onEnd(L),!(this.ended=!0);F.avail_out!==0&&(F.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(d.shrinkBuf(F.output,F.next_out))):this.onData(d.shrinkBuf(F.output,F.next_out)))}while((0<F.avail_in||F.avail_out===0)&&L!==1);return E===4?(L=a.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===b):E!==2||(this.onEnd(b),!(F.avail_out=0))},g.prototype.onData=function(y){this.chunks.push(y)},g.prototype.onEnd=function(y){y===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=g,i.deflate=_,i.deflateRaw=function(y,A){return(A=A||{}).raw=!0,_(y,A)},i.gzip=function(y,A){return(A=A||{}).gzip=!0,_(y,A)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,s,i){var a=e("./zlib/inflate"),d=e("./utils/common"),o=e("./utils/strings"),c=e("./zlib/constants"),h=e("./zlib/messages"),p=e("./zlib/zstream"),b=e("./zlib/gzheader"),m=Object.prototype.toString;function u(g){if(!(this instanceof u))return new u(g);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},g||{});var _=this.options;_.raw&&0<=_.windowBits&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),!(0<=_.windowBits&&_.windowBits<16)||g&&g.windowBits||(_.windowBits+=32),15<_.windowBits&&_.windowBits<48&&(15&_.windowBits)==0&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var y=a.inflateInit2(this.strm,_.windowBits);if(y!==c.Z_OK)throw new Error(h[y]);this.header=new b,a.inflateGetHeader(this.strm,this.header)}function w(g,_){var y=new u(_);if(y.push(g,!0),y.err)throw y.msg||h[y.err];return y.result}u.prototype.push=function(g,_){var y,A,L,E,F,Z,Y=this.strm,G=this.options.chunkSize,O=this.options.dictionary,Q=!1;if(this.ended)return!1;A=_===~~_?_:_===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?Y.input=o.binstring2buf(g):m.call(g)==="[object ArrayBuffer]"?Y.input=new Uint8Array(g):Y.input=g,Y.next_in=0,Y.avail_in=Y.input.length;do{if(Y.avail_out===0&&(Y.output=new d.Buf8(G),Y.next_out=0,Y.avail_out=G),(y=a.inflate(Y,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&O&&(Z=typeof O=="string"?o.string2buf(O):m.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,y=a.inflateSetDictionary(this.strm,Z)),y===c.Z_BUF_ERROR&&Q===!0&&(y=c.Z_OK,Q=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);Y.next_out&&(Y.avail_out!==0&&y!==c.Z_STREAM_END&&(Y.avail_in!==0||A!==c.Z_FINISH&&A!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(L=o.utf8border(Y.output,Y.next_out),E=Y.next_out-L,F=o.buf2string(Y.output,L),Y.next_out=E,Y.avail_out=G-E,E&&d.arraySet(Y.output,Y.output,L,E,0),this.onData(F)):this.onData(d.shrinkBuf(Y.output,Y.next_out)))),Y.avail_in===0&&Y.avail_out===0&&(Q=!0)}while((0<Y.avail_in||Y.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(A=c.Z_FINISH),A===c.Z_FINISH?(y=a.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):A!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(Y.avail_out=0))},u.prototype.onData=function(g){this.chunks.push(g)},u.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=u,i.inflate=w,i.inflateRaw=function(g,_){return(_=_||{}).raw=!0,w(g,_)},i.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,s,i){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var p=h.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var b in p)p.hasOwnProperty(b)&&(c[b]=p[b])}}return c},i.shrinkBuf=function(c,h){return c.length===h?c:c.subarray?c.subarray(0,h):(c.length=h,c)};var d={arraySet:function(c,h,p,b,m){if(h.subarray&&c.subarray)c.set(h.subarray(p,p+b),m);else for(var u=0;u<b;u++)c[m+u]=h[p+u]},flattenChunks:function(c){var h,p,b,m,u,w;for(h=b=0,p=c.length;h<p;h++)b+=c[h].length;for(w=new Uint8Array(b),h=m=0,p=c.length;h<p;h++)u=c[h],w.set(u,m),m+=u.length;return w}},o={arraySet:function(c,h,p,b,m){for(var u=0;u<b;u++)c[m+u]=h[p+u]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,d)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(a)},{}],42:[function(e,s,i){var a=e("./common"),d=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{d=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var c=new a.Buf8(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function p(b,m){if(m<65537&&(b.subarray&&o||!b.subarray&&d))return String.fromCharCode.apply(null,a.shrinkBuf(b,m));for(var u="",w=0;w<m;w++)u+=String.fromCharCode(b[w]);return u}c[254]=c[254]=1,i.string2buf=function(b){var m,u,w,g,_,y=b.length,A=0;for(g=0;g<y;g++)(64512&(u=b.charCodeAt(g)))==55296&&g+1<y&&(64512&(w=b.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(w-56320),g++),A+=u<128?1:u<2048?2:u<65536?3:4;for(m=new a.Buf8(A),g=_=0;_<A;g++)(64512&(u=b.charCodeAt(g)))==55296&&g+1<y&&(64512&(w=b.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(w-56320),g++),u<128?m[_++]=u:(u<2048?m[_++]=192|u>>>6:(u<65536?m[_++]=224|u>>>12:(m[_++]=240|u>>>18,m[_++]=128|u>>>12&63),m[_++]=128|u>>>6&63),m[_++]=128|63&u);return m},i.buf2binstring=function(b){return p(b,b.length)},i.binstring2buf=function(b){for(var m=new a.Buf8(b.length),u=0,w=m.length;u<w;u++)m[u]=b.charCodeAt(u);return m},i.buf2string=function(b,m){var u,w,g,_,y=m||b.length,A=new Array(2*y);for(u=w=0;u<y;)if((g=b[u++])<128)A[w++]=g;else if(4<(_=c[g]))A[w++]=65533,u+=_-1;else{for(g&=_===2?31:_===3?15:7;1<_&&u<y;)g=g<<6|63&b[u++],_--;1<_?A[w++]=65533:g<65536?A[w++]=g:(g-=65536,A[w++]=55296|g>>10&1023,A[w++]=56320|1023&g)}return p(A,w)},i.utf8border=function(b,m){var u;for((m=m||b.length)>b.length&&(m=b.length),u=m-1;0<=u&&(192&b[u])==128;)u--;return u<0||u===0?m:u+c[b[u]]>m?u:m}},{"./common":41}],43:[function(e,s,i){s.exports=function(a,d,o,c){for(var h=65535&a|0,p=a>>>16&65535|0,b=0;o!==0;){for(o-=b=2e3<o?2e3:o;p=p+(h=h+d[c++]|0)|0,--b;);h%=65521,p%=65521}return h|p<<16|0}},{}],44:[function(e,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,s,i){var a=(function(){for(var d,o=[],c=0;c<256;c++){d=c;for(var h=0;h<8;h++)d=1&d?3988292384^d>>>1:d>>>1;o[c]=d}return o})();s.exports=function(d,o,c,h){var p=a,b=h+c;d^=-1;for(var m=h;m<b;m++)d=d>>>8^p[255&(d^o[m])];return-1^d}},{}],46:[function(e,s,i){var a,d=e("../utils/common"),o=e("./trees"),c=e("./adler32"),h=e("./crc32"),p=e("./messages"),b=0,m=4,u=0,w=-2,g=-1,_=4,y=2,A=8,L=9,E=286,F=30,Z=19,Y=2*E+1,G=15,O=3,Q=258,I=Q+O+1,k=42,D=113,v=1,te=2,ce=3,re=4;function se(j,P){return j.msg=p[P],P}function le(j){return(j<<1)-(4<j?9:0)}function Se(j){for(var P=j.length;0<=--P;)j[P]=0}function ne(j){var P=j.state,V=P.pending;V>j.avail_out&&(V=j.avail_out),V!==0&&(d.arraySet(j.output,P.pending_buf,P.pending_out,V,j.next_out),j.next_out+=V,P.pending_out+=V,j.total_out+=V,j.avail_out-=V,P.pending-=V,P.pending===0&&(P.pending_out=0))}function C(j,P){o._tr_flush_block(j,0<=j.block_start?j.block_start:-1,j.strstart-j.block_start,P),j.block_start=j.strstart,ne(j.strm)}function H(j,P){j.pending_buf[j.pending++]=P}function K(j,P){j.pending_buf[j.pending++]=P>>>8&255,j.pending_buf[j.pending++]=255&P}function X(j,P){var V,$,z=j.max_chain_length,M=j.strstart,he=j.prev_length,me=j.nice_match,de=j.strstart>j.w_size-I?j.strstart-(j.w_size-I):0,Le=j.window,Ie=j.w_mask,Te=j.prev,Ve=j.strstart+Q,ht=Le[M+he-1],st=Le[M+he];j.prev_length>=j.good_match&&(z>>=2),me>j.lookahead&&(me=j.lookahead);do if(Le[(V=P)+he]===st&&Le[V+he-1]===ht&&Le[V]===Le[M]&&Le[++V]===Le[M+1]){M+=2,V++;do;while(Le[++M]===Le[++V]&&Le[++M]===Le[++V]&&Le[++M]===Le[++V]&&Le[++M]===Le[++V]&&Le[++M]===Le[++V]&&Le[++M]===Le[++V]&&Le[++M]===Le[++V]&&Le[++M]===Le[++V]&&M<Ve);if($=Q-(Ve-M),M=Ve-Q,he<$){if(j.match_start=P,me<=(he=$))break;ht=Le[M+he-1],st=Le[M+he]}}while((P=Te[P&Ie])>de&&--z!=0);return he<=j.lookahead?he:j.lookahead}function pe(j){var P,V,$,z,M,he,me,de,Le,Ie,Te=j.w_size;do{if(z=j.window_size-j.lookahead-j.strstart,j.strstart>=Te+(Te-I)){for(d.arraySet(j.window,j.window,Te,Te,0),j.match_start-=Te,j.strstart-=Te,j.block_start-=Te,P=V=j.hash_size;$=j.head[--P],j.head[P]=Te<=$?$-Te:0,--V;);for(P=V=Te;$=j.prev[--P],j.prev[P]=Te<=$?$-Te:0,--V;);z+=Te}if(j.strm.avail_in===0)break;if(he=j.strm,me=j.window,de=j.strstart+j.lookahead,Le=z,Ie=void 0,Ie=he.avail_in,Le<Ie&&(Ie=Le),V=Ie===0?0:(he.avail_in-=Ie,d.arraySet(me,he.input,he.next_in,Ie,de),he.state.wrap===1?he.adler=c(he.adler,me,Ie,de):he.state.wrap===2&&(he.adler=h(he.adler,me,Ie,de)),he.next_in+=Ie,he.total_in+=Ie,Ie),j.lookahead+=V,j.lookahead+j.insert>=O)for(M=j.strstart-j.insert,j.ins_h=j.window[M],j.ins_h=(j.ins_h<<j.hash_shift^j.window[M+1])&j.hash_mask;j.insert&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[M+O-1])&j.hash_mask,j.prev[M&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=M,M++,j.insert--,!(j.lookahead+j.insert<O)););}while(j.lookahead<I&&j.strm.avail_in!==0)}function ve(j,P){for(var V,$;;){if(j.lookahead<I){if(pe(j),j.lookahead<I&&P===b)return v;if(j.lookahead===0)break}if(V=0,j.lookahead>=O&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+O-1])&j.hash_mask,V=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),V!==0&&j.strstart-V<=j.w_size-I&&(j.match_length=X(j,V)),j.match_length>=O)if($=o._tr_tally(j,j.strstart-j.match_start,j.match_length-O),j.lookahead-=j.match_length,j.match_length<=j.max_lazy_match&&j.lookahead>=O){for(j.match_length--;j.strstart++,j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+O-1])&j.hash_mask,V=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart,--j.match_length!=0;);j.strstart++}else j.strstart+=j.match_length,j.match_length=0,j.ins_h=j.window[j.strstart],j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+1])&j.hash_mask;else $=o._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++;if($&&(C(j,!1),j.strm.avail_out===0))return v}return j.insert=j.strstart<O-1?j.strstart:O-1,P===m?(C(j,!0),j.strm.avail_out===0?ce:re):j.last_lit&&(C(j,!1),j.strm.avail_out===0)?v:te}function ke(j,P){for(var V,$,z;;){if(j.lookahead<I){if(pe(j),j.lookahead<I&&P===b)return v;if(j.lookahead===0)break}if(V=0,j.lookahead>=O&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+O-1])&j.hash_mask,V=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),j.prev_length=j.match_length,j.prev_match=j.match_start,j.match_length=O-1,V!==0&&j.prev_length<j.max_lazy_match&&j.strstart-V<=j.w_size-I&&(j.match_length=X(j,V),j.match_length<=5&&(j.strategy===1||j.match_length===O&&4096<j.strstart-j.match_start)&&(j.match_length=O-1)),j.prev_length>=O&&j.match_length<=j.prev_length){for(z=j.strstart+j.lookahead-O,$=o._tr_tally(j,j.strstart-1-j.prev_match,j.prev_length-O),j.lookahead-=j.prev_length-1,j.prev_length-=2;++j.strstart<=z&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+O-1])&j.hash_mask,V=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),--j.prev_length!=0;);if(j.match_available=0,j.match_length=O-1,j.strstart++,$&&(C(j,!1),j.strm.avail_out===0))return v}else if(j.match_available){if(($=o._tr_tally(j,0,j.window[j.strstart-1]))&&C(j,!1),j.strstart++,j.lookahead--,j.strm.avail_out===0)return v}else j.match_available=1,j.strstart++,j.lookahead--}return j.match_available&&($=o._tr_tally(j,0,j.window[j.strstart-1]),j.match_available=0),j.insert=j.strstart<O-1?j.strstart:O-1,P===m?(C(j,!0),j.strm.avail_out===0?ce:re):j.last_lit&&(C(j,!1),j.strm.avail_out===0)?v:te}function Ae(j,P,V,$,z){this.good_length=j,this.max_lazy=P,this.nice_length=V,this.max_chain=$,this.func=z}function Re(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=A,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*Y),this.dyn_dtree=new d.Buf16(2*(2*F+1)),this.bl_tree=new d.Buf16(2*(2*Z+1)),Se(this.dyn_ltree),Se(this.dyn_dtree),Se(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16(G+1),this.heap=new d.Buf16(2*E+1),Se(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*E+1),Se(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Me(j){var P;return j&&j.state?(j.total_in=j.total_out=0,j.data_type=y,(P=j.state).pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?k:D,j.adler=P.wrap===2?0:1,P.last_flush=b,o._tr_init(P),u):se(j,w)}function Ke(j){var P=Me(j);return P===u&&(function(V){V.window_size=2*V.w_size,Se(V.head),V.max_lazy_match=a[V.level].max_lazy,V.good_match=a[V.level].good_length,V.nice_match=a[V.level].nice_length,V.max_chain_length=a[V.level].max_chain,V.strstart=0,V.block_start=0,V.lookahead=0,V.insert=0,V.match_length=V.prev_length=O-1,V.match_available=0,V.ins_h=0})(j.state),P}function je(j,P,V,$,z,M){if(!j)return w;var he=1;if(P===g&&(P=6),$<0?(he=0,$=-$):15<$&&(he=2,$-=16),z<1||L<z||V!==A||$<8||15<$||P<0||9<P||M<0||_<M)return se(j,w);$===8&&($=9);var me=new Re;return(j.state=me).strm=j,me.wrap=he,me.gzhead=null,me.w_bits=$,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=z+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+O-1)/O),me.window=new d.Buf8(2*me.w_size),me.head=new d.Buf16(me.hash_size),me.prev=new d.Buf16(me.w_size),me.lit_bufsize=1<<z+6,me.pending_buf_size=4*me.lit_bufsize,me.pending_buf=new d.Buf8(me.pending_buf_size),me.d_buf=1*me.lit_bufsize,me.l_buf=3*me.lit_bufsize,me.level=P,me.strategy=M,me.method=V,Ke(j)}a=[new Ae(0,0,0,0,function(j,P){var V=65535;for(V>j.pending_buf_size-5&&(V=j.pending_buf_size-5);;){if(j.lookahead<=1){if(pe(j),j.lookahead===0&&P===b)return v;if(j.lookahead===0)break}j.strstart+=j.lookahead,j.lookahead=0;var $=j.block_start+V;if((j.strstart===0||j.strstart>=$)&&(j.lookahead=j.strstart-$,j.strstart=$,C(j,!1),j.strm.avail_out===0)||j.strstart-j.block_start>=j.w_size-I&&(C(j,!1),j.strm.avail_out===0))return v}return j.insert=0,P===m?(C(j,!0),j.strm.avail_out===0?ce:re):(j.strstart>j.block_start&&(C(j,!1),j.strm.avail_out),v)}),new Ae(4,4,8,4,ve),new Ae(4,5,16,8,ve),new Ae(4,6,32,32,ve),new Ae(4,4,16,16,ke),new Ae(8,16,32,32,ke),new Ae(8,16,128,128,ke),new Ae(8,32,128,256,ke),new Ae(32,128,258,1024,ke),new Ae(32,258,258,4096,ke)],i.deflateInit=function(j,P){return je(j,P,A,15,8,0)},i.deflateInit2=je,i.deflateReset=Ke,i.deflateResetKeep=Me,i.deflateSetHeader=function(j,P){return j&&j.state?j.state.wrap!==2?w:(j.state.gzhead=P,u):w},i.deflate=function(j,P){var V,$,z,M;if(!j||!j.state||5<P||P<0)return j?se(j,w):w;if($=j.state,!j.output||!j.input&&j.avail_in!==0||$.status===666&&P!==m)return se(j,j.avail_out===0?-5:w);if($.strm=j,V=$.last_flush,$.last_flush=P,$.status===k)if($.wrap===2)j.adler=0,H($,31),H($,139),H($,8),$.gzhead?(H($,($.gzhead.text?1:0)+($.gzhead.hcrc?2:0)+($.gzhead.extra?4:0)+($.gzhead.name?8:0)+($.gzhead.comment?16:0)),H($,255&$.gzhead.time),H($,$.gzhead.time>>8&255),H($,$.gzhead.time>>16&255),H($,$.gzhead.time>>24&255),H($,$.level===9?2:2<=$.strategy||$.level<2?4:0),H($,255&$.gzhead.os),$.gzhead.extra&&$.gzhead.extra.length&&(H($,255&$.gzhead.extra.length),H($,$.gzhead.extra.length>>8&255)),$.gzhead.hcrc&&(j.adler=h(j.adler,$.pending_buf,$.pending,0)),$.gzindex=0,$.status=69):(H($,0),H($,0),H($,0),H($,0),H($,0),H($,$.level===9?2:2<=$.strategy||$.level<2?4:0),H($,3),$.status=D);else{var he=A+($.w_bits-8<<4)<<8;he|=(2<=$.strategy||$.level<2?0:$.level<6?1:$.level===6?2:3)<<6,$.strstart!==0&&(he|=32),he+=31-he%31,$.status=D,K($,he),$.strstart!==0&&(K($,j.adler>>>16),K($,65535&j.adler)),j.adler=1}if($.status===69)if($.gzhead.extra){for(z=$.pending;$.gzindex<(65535&$.gzhead.extra.length)&&($.pending!==$.pending_buf_size||($.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),ne(j),z=$.pending,$.pending!==$.pending_buf_size));)H($,255&$.gzhead.extra[$.gzindex]),$.gzindex++;$.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),$.gzindex===$.gzhead.extra.length&&($.gzindex=0,$.status=73)}else $.status=73;if($.status===73)if($.gzhead.name){z=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),ne(j),z=$.pending,$.pending===$.pending_buf_size)){M=1;break}M=$.gzindex<$.gzhead.name.length?255&$.gzhead.name.charCodeAt($.gzindex++):0,H($,M)}while(M!==0);$.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),M===0&&($.gzindex=0,$.status=91)}else $.status=91;if($.status===91)if($.gzhead.comment){z=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),ne(j),z=$.pending,$.pending===$.pending_buf_size)){M=1;break}M=$.gzindex<$.gzhead.comment.length?255&$.gzhead.comment.charCodeAt($.gzindex++):0,H($,M)}while(M!==0);$.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),M===0&&($.status=103)}else $.status=103;if($.status===103&&($.gzhead.hcrc?($.pending+2>$.pending_buf_size&&ne(j),$.pending+2<=$.pending_buf_size&&(H($,255&j.adler),H($,j.adler>>8&255),j.adler=0,$.status=D)):$.status=D),$.pending!==0){if(ne(j),j.avail_out===0)return $.last_flush=-1,u}else if(j.avail_in===0&&le(P)<=le(V)&&P!==m)return se(j,-5);if($.status===666&&j.avail_in!==0)return se(j,-5);if(j.avail_in!==0||$.lookahead!==0||P!==b&&$.status!==666){var me=$.strategy===2?(function(de,Le){for(var Ie;;){if(de.lookahead===0&&(pe(de),de.lookahead===0)){if(Le===b)return v;break}if(de.match_length=0,Ie=o._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++,Ie&&(C(de,!1),de.strm.avail_out===0))return v}return de.insert=0,Le===m?(C(de,!0),de.strm.avail_out===0?ce:re):de.last_lit&&(C(de,!1),de.strm.avail_out===0)?v:te})($,P):$.strategy===3?(function(de,Le){for(var Ie,Te,Ve,ht,st=de.window;;){if(de.lookahead<=Q){if(pe(de),de.lookahead<=Q&&Le===b)return v;if(de.lookahead===0)break}if(de.match_length=0,de.lookahead>=O&&0<de.strstart&&(Te=st[Ve=de.strstart-1])===st[++Ve]&&Te===st[++Ve]&&Te===st[++Ve]){ht=de.strstart+Q;do;while(Te===st[++Ve]&&Te===st[++Ve]&&Te===st[++Ve]&&Te===st[++Ve]&&Te===st[++Ve]&&Te===st[++Ve]&&Te===st[++Ve]&&Te===st[++Ve]&&Ve<ht);de.match_length=Q-(ht-Ve),de.match_length>de.lookahead&&(de.match_length=de.lookahead)}if(de.match_length>=O?(Ie=o._tr_tally(de,1,de.match_length-O),de.lookahead-=de.match_length,de.strstart+=de.match_length,de.match_length=0):(Ie=o._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++),Ie&&(C(de,!1),de.strm.avail_out===0))return v}return de.insert=0,Le===m?(C(de,!0),de.strm.avail_out===0?ce:re):de.last_lit&&(C(de,!1),de.strm.avail_out===0)?v:te})($,P):a[$.level].func($,P);if(me!==ce&&me!==re||($.status=666),me===v||me===ce)return j.avail_out===0&&($.last_flush=-1),u;if(me===te&&(P===1?o._tr_align($):P!==5&&(o._tr_stored_block($,0,0,!1),P===3&&(Se($.head),$.lookahead===0&&($.strstart=0,$.block_start=0,$.insert=0))),ne(j),j.avail_out===0))return $.last_flush=-1,u}return P!==m?u:$.wrap<=0?1:($.wrap===2?(H($,255&j.adler),H($,j.adler>>8&255),H($,j.adler>>16&255),H($,j.adler>>24&255),H($,255&j.total_in),H($,j.total_in>>8&255),H($,j.total_in>>16&255),H($,j.total_in>>24&255)):(K($,j.adler>>>16),K($,65535&j.adler)),ne(j),0<$.wrap&&($.wrap=-$.wrap),$.pending!==0?u:1)},i.deflateEnd=function(j){var P;return j&&j.state?(P=j.state.status)!==k&&P!==69&&P!==73&&P!==91&&P!==103&&P!==D&&P!==666?se(j,w):(j.state=null,P===D?se(j,-3):u):w},i.deflateSetDictionary=function(j,P){var V,$,z,M,he,me,de,Le,Ie=P.length;if(!j||!j.state||(M=(V=j.state).wrap)===2||M===1&&V.status!==k||V.lookahead)return w;for(M===1&&(j.adler=c(j.adler,P,Ie,0)),V.wrap=0,Ie>=V.w_size&&(M===0&&(Se(V.head),V.strstart=0,V.block_start=0,V.insert=0),Le=new d.Buf8(V.w_size),d.arraySet(Le,P,Ie-V.w_size,V.w_size,0),P=Le,Ie=V.w_size),he=j.avail_in,me=j.next_in,de=j.input,j.avail_in=Ie,j.next_in=0,j.input=P,pe(V);V.lookahead>=O;){for($=V.strstart,z=V.lookahead-(O-1);V.ins_h=(V.ins_h<<V.hash_shift^V.window[$+O-1])&V.hash_mask,V.prev[$&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=$,$++,--z;);V.strstart=$,V.lookahead=O-1,pe(V)}return V.strstart+=V.lookahead,V.block_start=V.strstart,V.insert=V.lookahead,V.lookahead=0,V.match_length=V.prev_length=O-1,V.match_available=0,j.next_in=me,j.input=de,j.avail_in=he,V.wrap=M,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,s,i){s.exports=function(a,d){var o,c,h,p,b,m,u,w,g,_,y,A,L,E,F,Z,Y,G,O,Q,I,k,D,v,te;o=a.state,c=a.next_in,v=a.input,h=c+(a.avail_in-5),p=a.next_out,te=a.output,b=p-(d-a.avail_out),m=p+(a.avail_out-257),u=o.dmax,w=o.wsize,g=o.whave,_=o.wnext,y=o.window,A=o.hold,L=o.bits,E=o.lencode,F=o.distcode,Z=(1<<o.lenbits)-1,Y=(1<<o.distbits)-1;e:do{L<15&&(A+=v[c++]<<L,L+=8,A+=v[c++]<<L,L+=8),G=E[A&Z];t:for(;;){if(A>>>=O=G>>>24,L-=O,(O=G>>>16&255)===0)te[p++]=65535&G;else{if(!(16&O)){if((64&O)==0){G=E[(65535&G)+(A&(1<<O)-1)];continue t}if(32&O){o.mode=12;break e}a.msg="invalid literal/length code",o.mode=30;break e}Q=65535&G,(O&=15)&&(L<O&&(A+=v[c++]<<L,L+=8),Q+=A&(1<<O)-1,A>>>=O,L-=O),L<15&&(A+=v[c++]<<L,L+=8,A+=v[c++]<<L,L+=8),G=F[A&Y];r:for(;;){if(A>>>=O=G>>>24,L-=O,!(16&(O=G>>>16&255))){if((64&O)==0){G=F[(65535&G)+(A&(1<<O)-1)];continue r}a.msg="invalid distance code",o.mode=30;break e}if(I=65535&G,L<(O&=15)&&(A+=v[c++]<<L,(L+=8)<O&&(A+=v[c++]<<L,L+=8)),u<(I+=A&(1<<O)-1)){a.msg="invalid distance too far back",o.mode=30;break e}if(A>>>=O,L-=O,(O=p-b)<I){if(g<(O=I-O)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break e}if(D=y,(k=0)===_){if(k+=w-O,O<Q){for(Q-=O;te[p++]=y[k++],--O;);k=p-I,D=te}}else if(_<O){if(k+=w+_-O,(O-=_)<Q){for(Q-=O;te[p++]=y[k++],--O;);if(k=0,_<Q){for(Q-=O=_;te[p++]=y[k++],--O;);k=p-I,D=te}}}else if(k+=_-O,O<Q){for(Q-=O;te[p++]=y[k++],--O;);k=p-I,D=te}for(;2<Q;)te[p++]=D[k++],te[p++]=D[k++],te[p++]=D[k++],Q-=3;Q&&(te[p++]=D[k++],1<Q&&(te[p++]=D[k++]))}else{for(k=p-I;te[p++]=te[k++],te[p++]=te[k++],te[p++]=te[k++],2<(Q-=3););Q&&(te[p++]=te[k++],1<Q&&(te[p++]=te[k++]))}break}}break}}while(c<h&&p<m);c-=Q=L>>3,A&=(1<<(L-=Q<<3))-1,a.next_in=c,a.next_out=p,a.avail_in=c<h?h-c+5:5-(c-h),a.avail_out=p<m?m-p+257:257-(p-m),o.hold=A,o.bits=L}},{}],49:[function(e,s,i){var a=e("../utils/common"),d=e("./adler32"),o=e("./crc32"),c=e("./inffast"),h=e("./inftrees"),p=1,b=2,m=0,u=-2,w=1,g=852,_=592;function y(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function A(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function L(k){var D;return k&&k.state?(D=k.state,k.total_in=k.total_out=D.total=0,k.msg="",D.wrap&&(k.adler=1&D.wrap),D.mode=w,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new a.Buf32(g),D.distcode=D.distdyn=new a.Buf32(_),D.sane=1,D.back=-1,m):u}function E(k){var D;return k&&k.state?((D=k.state).wsize=0,D.whave=0,D.wnext=0,L(k)):u}function F(k,D){var v,te;return k&&k.state?(te=k.state,D<0?(v=0,D=-D):(v=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?u:(te.window!==null&&te.wbits!==D&&(te.window=null),te.wrap=v,te.wbits=D,E(k))):u}function Z(k,D){var v,te;return k?(te=new A,(k.state=te).window=null,(v=F(k,D))!==m&&(k.state=null),v):u}var Y,G,O=!0;function Q(k){if(O){var D;for(Y=new a.Buf32(512),G=new a.Buf32(32),D=0;D<144;)k.lens[D++]=8;for(;D<256;)k.lens[D++]=9;for(;D<280;)k.lens[D++]=7;for(;D<288;)k.lens[D++]=8;for(h(p,k.lens,0,288,Y,0,k.work,{bits:9}),D=0;D<32;)k.lens[D++]=5;h(b,k.lens,0,32,G,0,k.work,{bits:5}),O=!1}k.lencode=Y,k.lenbits=9,k.distcode=G,k.distbits=5}function I(k,D,v,te){var ce,re=k.state;return re.window===null&&(re.wsize=1<<re.wbits,re.wnext=0,re.whave=0,re.window=new a.Buf8(re.wsize)),te>=re.wsize?(a.arraySet(re.window,D,v-re.wsize,re.wsize,0),re.wnext=0,re.whave=re.wsize):(te<(ce=re.wsize-re.wnext)&&(ce=te),a.arraySet(re.window,D,v-te,ce,re.wnext),(te-=ce)?(a.arraySet(re.window,D,v-te,te,0),re.wnext=te,re.whave=re.wsize):(re.wnext+=ce,re.wnext===re.wsize&&(re.wnext=0),re.whave<re.wsize&&(re.whave+=ce))),0}i.inflateReset=E,i.inflateReset2=F,i.inflateResetKeep=L,i.inflateInit=function(k){return Z(k,15)},i.inflateInit2=Z,i.inflate=function(k,D){var v,te,ce,re,se,le,Se,ne,C,H,K,X,pe,ve,ke,Ae,Re,Me,Ke,je,j,P,V,$,z=0,M=new a.Buf8(4),he=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return u;(v=k.state).mode===12&&(v.mode=13),se=k.next_out,ce=k.output,Se=k.avail_out,re=k.next_in,te=k.input,le=k.avail_in,ne=v.hold,C=v.bits,H=le,K=Se,P=m;e:for(;;)switch(v.mode){case w:if(v.wrap===0){v.mode=13;break}for(;C<16;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if(2&v.wrap&&ne===35615){M[v.check=0]=255&ne,M[1]=ne>>>8&255,v.check=o(v.check,M,2,0),C=ne=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&ne)<<8)+(ne>>8))%31){k.msg="incorrect header check",v.mode=30;break}if((15&ne)!=8){k.msg="unknown compression method",v.mode=30;break}if(C-=4,j=8+(15&(ne>>>=4)),v.wbits===0)v.wbits=j;else if(j>v.wbits){k.msg="invalid window size",v.mode=30;break}v.dmax=1<<j,k.adler=v.check=1,v.mode=512&ne?10:12,C=ne=0;break;case 2:for(;C<16;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if(v.flags=ne,(255&v.flags)!=8){k.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){k.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=ne>>8&1),512&v.flags&&(M[0]=255&ne,M[1]=ne>>>8&255,v.check=o(v.check,M,2,0)),C=ne=0,v.mode=3;case 3:for(;C<32;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}v.head&&(v.head.time=ne),512&v.flags&&(M[0]=255&ne,M[1]=ne>>>8&255,M[2]=ne>>>16&255,M[3]=ne>>>24&255,v.check=o(v.check,M,4,0)),C=ne=0,v.mode=4;case 4:for(;C<16;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}v.head&&(v.head.xflags=255&ne,v.head.os=ne>>8),512&v.flags&&(M[0]=255&ne,M[1]=ne>>>8&255,v.check=o(v.check,M,2,0)),C=ne=0,v.mode=5;case 5:if(1024&v.flags){for(;C<16;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}v.length=ne,v.head&&(v.head.extra_len=ne),512&v.flags&&(M[0]=255&ne,M[1]=ne>>>8&255,v.check=o(v.check,M,2,0)),C=ne=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(le<(X=v.length)&&(X=le),X&&(v.head&&(j=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),a.arraySet(v.head.extra,te,re,X,j)),512&v.flags&&(v.check=o(v.check,te,X,re)),le-=X,re+=X,v.length-=X),v.length))break e;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(le===0)break e;for(X=0;j=te[re+X++],v.head&&j&&v.length<65536&&(v.head.name+=String.fromCharCode(j)),j&&X<le;);if(512&v.flags&&(v.check=o(v.check,te,X,re)),le-=X,re+=X,j)break e}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(le===0)break e;for(X=0;j=te[re+X++],v.head&&j&&v.length<65536&&(v.head.comment+=String.fromCharCode(j)),j&&X<le;);if(512&v.flags&&(v.check=o(v.check,te,X,re)),le-=X,re+=X,j)break e}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;C<16;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if(ne!==(65535&v.check)){k.msg="header crc mismatch",v.mode=30;break}C=ne=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),k.adler=v.check=0,v.mode=12;break;case 10:for(;C<32;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}k.adler=v.check=y(ne),C=ne=0,v.mode=11;case 11:if(v.havedict===0)return k.next_out=se,k.avail_out=Se,k.next_in=re,k.avail_in=le,v.hold=ne,v.bits=C,2;k.adler=v.check=1,v.mode=12;case 12:if(D===5||D===6)break e;case 13:if(v.last){ne>>>=7&C,C-=7&C,v.mode=27;break}for(;C<3;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}switch(v.last=1&ne,C-=1,3&(ne>>>=1)){case 0:v.mode=14;break;case 1:if(Q(v),v.mode=20,D!==6)break;ne>>>=2,C-=2;break e;case 2:v.mode=17;break;case 3:k.msg="invalid block type",v.mode=30}ne>>>=2,C-=2;break;case 14:for(ne>>>=7&C,C-=7&C;C<32;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if((65535&ne)!=(ne>>>16^65535)){k.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&ne,C=ne=0,v.mode=15,D===6)break e;case 15:v.mode=16;case 16:if(X=v.length){if(le<X&&(X=le),Se<X&&(X=Se),X===0)break e;a.arraySet(ce,te,re,X,se),le-=X,re+=X,Se-=X,se+=X,v.length-=X;break}v.mode=12;break;case 17:for(;C<14;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if(v.nlen=257+(31&ne),ne>>>=5,C-=5,v.ndist=1+(31&ne),ne>>>=5,C-=5,v.ncode=4+(15&ne),ne>>>=4,C-=4,286<v.nlen||30<v.ndist){k.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;C<3;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}v.lens[he[v.have++]]=7&ne,ne>>>=3,C-=3}for(;v.have<19;)v.lens[he[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,V={bits:v.lenbits},P=h(0,v.lens,0,19,v.lencode,0,v.work,V),v.lenbits=V.bits,P){k.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;Ae=(z=v.lencode[ne&(1<<v.lenbits)-1])>>>16&255,Re=65535&z,!((ke=z>>>24)<=C);){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if(Re<16)ne>>>=ke,C-=ke,v.lens[v.have++]=Re;else{if(Re===16){for($=ke+2;C<$;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if(ne>>>=ke,C-=ke,v.have===0){k.msg="invalid bit length repeat",v.mode=30;break}j=v.lens[v.have-1],X=3+(3&ne),ne>>>=2,C-=2}else if(Re===17){for($=ke+3;C<$;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}C-=ke,j=0,X=3+(7&(ne>>>=ke)),ne>>>=3,C-=3}else{for($=ke+7;C<$;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}C-=ke,j=0,X=11+(127&(ne>>>=ke)),ne>>>=7,C-=7}if(v.have+X>v.nlen+v.ndist){k.msg="invalid bit length repeat",v.mode=30;break}for(;X--;)v.lens[v.have++]=j}}if(v.mode===30)break;if(v.lens[256]===0){k.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,V={bits:v.lenbits},P=h(p,v.lens,0,v.nlen,v.lencode,0,v.work,V),v.lenbits=V.bits,P){k.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,V={bits:v.distbits},P=h(b,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,V),v.distbits=V.bits,P){k.msg="invalid distances set",v.mode=30;break}if(v.mode=20,D===6)break e;case 20:v.mode=21;case 21:if(6<=le&&258<=Se){k.next_out=se,k.avail_out=Se,k.next_in=re,k.avail_in=le,v.hold=ne,v.bits=C,c(k,K),se=k.next_out,ce=k.output,Se=k.avail_out,re=k.next_in,te=k.input,le=k.avail_in,ne=v.hold,C=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;Ae=(z=v.lencode[ne&(1<<v.lenbits)-1])>>>16&255,Re=65535&z,!((ke=z>>>24)<=C);){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if(Ae&&(240&Ae)==0){for(Me=ke,Ke=Ae,je=Re;Ae=(z=v.lencode[je+((ne&(1<<Me+Ke)-1)>>Me)])>>>16&255,Re=65535&z,!(Me+(ke=z>>>24)<=C);){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}ne>>>=Me,C-=Me,v.back+=Me}if(ne>>>=ke,C-=ke,v.back+=ke,v.length=Re,Ae===0){v.mode=26;break}if(32&Ae){v.back=-1,v.mode=12;break}if(64&Ae){k.msg="invalid literal/length code",v.mode=30;break}v.extra=15&Ae,v.mode=22;case 22:if(v.extra){for($=v.extra;C<$;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}v.length+=ne&(1<<v.extra)-1,ne>>>=v.extra,C-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;Ae=(z=v.distcode[ne&(1<<v.distbits)-1])>>>16&255,Re=65535&z,!((ke=z>>>24)<=C);){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if((240&Ae)==0){for(Me=ke,Ke=Ae,je=Re;Ae=(z=v.distcode[je+((ne&(1<<Me+Ke)-1)>>Me)])>>>16&255,Re=65535&z,!(Me+(ke=z>>>24)<=C);){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}ne>>>=Me,C-=Me,v.back+=Me}if(ne>>>=ke,C-=ke,v.back+=ke,64&Ae){k.msg="invalid distance code",v.mode=30;break}v.offset=Re,v.extra=15&Ae,v.mode=24;case 24:if(v.extra){for($=v.extra;C<$;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}v.offset+=ne&(1<<v.extra)-1,ne>>>=v.extra,C-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){k.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(Se===0)break e;if(X=K-Se,v.offset>X){if((X=v.offset-X)>v.whave&&v.sane){k.msg="invalid distance too far back",v.mode=30;break}pe=X>v.wnext?(X-=v.wnext,v.wsize-X):v.wnext-X,X>v.length&&(X=v.length),ve=v.window}else ve=ce,pe=se-v.offset,X=v.length;for(Se<X&&(X=Se),Se-=X,v.length-=X;ce[se++]=ve[pe++],--X;);v.length===0&&(v.mode=21);break;case 26:if(Se===0)break e;ce[se++]=v.length,Se--,v.mode=21;break;case 27:if(v.wrap){for(;C<32;){if(le===0)break e;le--,ne|=te[re++]<<C,C+=8}if(K-=Se,k.total_out+=K,v.total+=K,K&&(k.adler=v.check=v.flags?o(v.check,ce,K,se-K):d(v.check,ce,K,se-K)),K=Se,(v.flags?ne:y(ne))!==v.check){k.msg="incorrect data check",v.mode=30;break}C=ne=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;C<32;){if(le===0)break e;le--,ne+=te[re++]<<C,C+=8}if(ne!==(4294967295&v.total)){k.msg="incorrect length check",v.mode=30;break}C=ne=0}v.mode=29;case 29:P=1;break e;case 30:P=-3;break e;case 31:return-4;case 32:default:return u}return k.next_out=se,k.avail_out=Se,k.next_in=re,k.avail_in=le,v.hold=ne,v.bits=C,(v.wsize||K!==k.avail_out&&v.mode<30&&(v.mode<27||D!==4))&&I(k,k.output,k.next_out,K-k.avail_out)?(v.mode=31,-4):(H-=k.avail_in,K-=k.avail_out,k.total_in+=H,k.total_out+=K,v.total+=K,v.wrap&&K&&(k.adler=v.check=v.flags?o(v.check,ce,K,k.next_out-K):d(v.check,ce,K,k.next_out-K)),k.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(H==0&&K===0||D===4)&&P===m&&(P=-5),P)},i.inflateEnd=function(k){if(!k||!k.state)return u;var D=k.state;return D.window&&(D.window=null),k.state=null,m},i.inflateGetHeader=function(k,D){var v;return k&&k.state?(2&(v=k.state).wrap)==0?u:((v.head=D).done=!1,m):u},i.inflateSetDictionary=function(k,D){var v,te=D.length;return k&&k.state?(v=k.state).wrap!==0&&v.mode!==11?u:v.mode===11&&d(1,D,te,0)!==v.check?-3:I(k,D,te,te)?(v.mode=31,-4):(v.havedict=1,m):u},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,s,i){var a=e("../utils/common"),d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(p,b,m,u,w,g,_,y){var A,L,E,F,Z,Y,G,O,Q,I=y.bits,k=0,D=0,v=0,te=0,ce=0,re=0,se=0,le=0,Se=0,ne=0,C=null,H=0,K=new a.Buf16(16),X=new a.Buf16(16),pe=null,ve=0;for(k=0;k<=15;k++)K[k]=0;for(D=0;D<u;D++)K[b[m+D]]++;for(ce=I,te=15;1<=te&&K[te]===0;te--);if(te<ce&&(ce=te),te===0)return w[g++]=20971520,w[g++]=20971520,y.bits=1,0;for(v=1;v<te&&K[v]===0;v++);for(ce<v&&(ce=v),k=le=1;k<=15;k++)if(le<<=1,(le-=K[k])<0)return-1;if(0<le&&(p===0||te!==1))return-1;for(X[1]=0,k=1;k<15;k++)X[k+1]=X[k]+K[k];for(D=0;D<u;D++)b[m+D]!==0&&(_[X[b[m+D]]++]=D);if(Y=p===0?(C=pe=_,19):p===1?(C=d,H-=257,pe=o,ve-=257,256):(C=c,pe=h,-1),k=v,Z=g,se=D=ne=0,E=-1,F=(Se=1<<(re=ce))-1,p===1&&852<Se||p===2&&592<Se)return 1;for(;;){for(G=k-se,Q=_[D]<Y?(O=0,_[D]):_[D]>Y?(O=pe[ve+_[D]],C[H+_[D]]):(O=96,0),A=1<<k-se,v=L=1<<re;w[Z+(ne>>se)+(L-=A)]=G<<24|O<<16|Q|0,L!==0;);for(A=1<<k-1;ne&A;)A>>=1;if(A!==0?(ne&=A-1,ne+=A):ne=0,D++,--K[k]==0){if(k===te)break;k=b[m+_[D]]}if(ce<k&&(ne&F)!==E){for(se===0&&(se=ce),Z+=v,le=1<<(re=k-se);re+se<te&&!((le-=K[re+se])<=0);)re++,le<<=1;if(Se+=1<<re,p===1&&852<Se||p===2&&592<Se)return 1;w[E=ne&F]=ce<<24|re<<16|Z-g|0}}return ne!==0&&(w[Z+ne]=k-se<<24|64<<16|0),y.bits=ce,0}},{"../utils/common":41}],51:[function(e,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,s,i){var a=e("../utils/common"),d=0,o=1;function c(z){for(var M=z.length;0<=--M;)z[M]=0}var h=0,p=29,b=256,m=b+1+p,u=30,w=19,g=2*m+1,_=15,y=16,A=7,L=256,E=16,F=17,Z=18,Y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],G=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],I=new Array(2*(m+2));c(I);var k=new Array(2*u);c(k);var D=new Array(512);c(D);var v=new Array(256);c(v);var te=new Array(p);c(te);var ce,re,se,le=new Array(u);function Se(z,M,he,me,de){this.static_tree=z,this.extra_bits=M,this.extra_base=he,this.elems=me,this.max_length=de,this.has_stree=z&&z.length}function ne(z,M){this.dyn_tree=z,this.max_code=0,this.stat_desc=M}function C(z){return z<256?D[z]:D[256+(z>>>7)]}function H(z,M){z.pending_buf[z.pending++]=255&M,z.pending_buf[z.pending++]=M>>>8&255}function K(z,M,he){z.bi_valid>y-he?(z.bi_buf|=M<<z.bi_valid&65535,H(z,z.bi_buf),z.bi_buf=M>>y-z.bi_valid,z.bi_valid+=he-y):(z.bi_buf|=M<<z.bi_valid&65535,z.bi_valid+=he)}function X(z,M,he){K(z,he[2*M],he[2*M+1])}function pe(z,M){for(var he=0;he|=1&z,z>>>=1,he<<=1,0<--M;);return he>>>1}function ve(z,M,he){var me,de,Le=new Array(_+1),Ie=0;for(me=1;me<=_;me++)Le[me]=Ie=Ie+he[me-1]<<1;for(de=0;de<=M;de++){var Te=z[2*de+1];Te!==0&&(z[2*de]=pe(Le[Te]++,Te))}}function ke(z){var M;for(M=0;M<m;M++)z.dyn_ltree[2*M]=0;for(M=0;M<u;M++)z.dyn_dtree[2*M]=0;for(M=0;M<w;M++)z.bl_tree[2*M]=0;z.dyn_ltree[2*L]=1,z.opt_len=z.static_len=0,z.last_lit=z.matches=0}function Ae(z){8<z.bi_valid?H(z,z.bi_buf):0<z.bi_valid&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0}function Re(z,M,he,me){var de=2*M,Le=2*he;return z[de]<z[Le]||z[de]===z[Le]&&me[M]<=me[he]}function Me(z,M,he){for(var me=z.heap[he],de=he<<1;de<=z.heap_len&&(de<z.heap_len&&Re(M,z.heap[de+1],z.heap[de],z.depth)&&de++,!Re(M,me,z.heap[de],z.depth));)z.heap[he]=z.heap[de],he=de,de<<=1;z.heap[he]=me}function Ke(z,M,he){var me,de,Le,Ie,Te=0;if(z.last_lit!==0)for(;me=z.pending_buf[z.d_buf+2*Te]<<8|z.pending_buf[z.d_buf+2*Te+1],de=z.pending_buf[z.l_buf+Te],Te++,me===0?X(z,de,M):(X(z,(Le=v[de])+b+1,M),(Ie=Y[Le])!==0&&K(z,de-=te[Le],Ie),X(z,Le=C(--me),he),(Ie=G[Le])!==0&&K(z,me-=le[Le],Ie)),Te<z.last_lit;);X(z,L,M)}function je(z,M){var he,me,de,Le=M.dyn_tree,Ie=M.stat_desc.static_tree,Te=M.stat_desc.has_stree,Ve=M.stat_desc.elems,ht=-1;for(z.heap_len=0,z.heap_max=g,he=0;he<Ve;he++)Le[2*he]!==0?(z.heap[++z.heap_len]=ht=he,z.depth[he]=0):Le[2*he+1]=0;for(;z.heap_len<2;)Le[2*(de=z.heap[++z.heap_len]=ht<2?++ht:0)]=1,z.depth[de]=0,z.opt_len--,Te&&(z.static_len-=Ie[2*de+1]);for(M.max_code=ht,he=z.heap_len>>1;1<=he;he--)Me(z,Le,he);for(de=Ve;he=z.heap[1],z.heap[1]=z.heap[z.heap_len--],Me(z,Le,1),me=z.heap[1],z.heap[--z.heap_max]=he,z.heap[--z.heap_max]=me,Le[2*de]=Le[2*he]+Le[2*me],z.depth[de]=(z.depth[he]>=z.depth[me]?z.depth[he]:z.depth[me])+1,Le[2*he+1]=Le[2*me+1]=de,z.heap[1]=de++,Me(z,Le,1),2<=z.heap_len;);z.heap[--z.heap_max]=z.heap[1],(function(st,ot){var yt,dt,Vt,mt,Lt,zt,Et=ot.dyn_tree,wt=ot.max_code,Jt=ot.stat_desc.static_tree,Nt=ot.stat_desc.has_stree,Ft=ot.stat_desc.extra_bits,ar=ot.stat_desc.extra_base,Ot=ot.stat_desc.max_length,xt=0;for(mt=0;mt<=_;mt++)st.bl_count[mt]=0;for(Et[2*st.heap[st.heap_max]+1]=0,yt=st.heap_max+1;yt<g;yt++)Ot<(mt=Et[2*Et[2*(dt=st.heap[yt])+1]+1]+1)&&(mt=Ot,xt++),Et[2*dt+1]=mt,wt<dt||(st.bl_count[mt]++,Lt=0,ar<=dt&&(Lt=Ft[dt-ar]),zt=Et[2*dt],st.opt_len+=zt*(mt+Lt),Nt&&(st.static_len+=zt*(Jt[2*dt+1]+Lt)));if(xt!==0){do{for(mt=Ot-1;st.bl_count[mt]===0;)mt--;st.bl_count[mt]--,st.bl_count[mt+1]+=2,st.bl_count[Ot]--,xt-=2}while(0<xt);for(mt=Ot;mt!==0;mt--)for(dt=st.bl_count[mt];dt!==0;)wt<(Vt=st.heap[--yt])||(Et[2*Vt+1]!==mt&&(st.opt_len+=(mt-Et[2*Vt+1])*Et[2*Vt],Et[2*Vt+1]=mt),dt--)}})(z,M),ve(Le,ht,z.bl_count)}function j(z,M,he){var me,de,Le=-1,Ie=M[1],Te=0,Ve=7,ht=4;for(Ie===0&&(Ve=138,ht=3),M[2*(he+1)+1]=65535,me=0;me<=he;me++)de=Ie,Ie=M[2*(me+1)+1],++Te<Ve&&de===Ie||(Te<ht?z.bl_tree[2*de]+=Te:de!==0?(de!==Le&&z.bl_tree[2*de]++,z.bl_tree[2*E]++):Te<=10?z.bl_tree[2*F]++:z.bl_tree[2*Z]++,Le=de,ht=(Te=0)===Ie?(Ve=138,3):de===Ie?(Ve=6,3):(Ve=7,4))}function P(z,M,he){var me,de,Le=-1,Ie=M[1],Te=0,Ve=7,ht=4;for(Ie===0&&(Ve=138,ht=3),me=0;me<=he;me++)if(de=Ie,Ie=M[2*(me+1)+1],!(++Te<Ve&&de===Ie)){if(Te<ht)for(;X(z,de,z.bl_tree),--Te!=0;);else de!==0?(de!==Le&&(X(z,de,z.bl_tree),Te--),X(z,E,z.bl_tree),K(z,Te-3,2)):Te<=10?(X(z,F,z.bl_tree),K(z,Te-3,3)):(X(z,Z,z.bl_tree),K(z,Te-11,7));Le=de,ht=(Te=0)===Ie?(Ve=138,3):de===Ie?(Ve=6,3):(Ve=7,4)}}c(le);var V=!1;function $(z,M,he,me){K(z,(h<<1)+(me?1:0),3),(function(de,Le,Ie,Te){Ae(de),H(de,Ie),H(de,~Ie),a.arraySet(de.pending_buf,de.window,Le,Ie,de.pending),de.pending+=Ie})(z,M,he)}i._tr_init=function(z){V||((function(){var M,he,me,de,Le,Ie=new Array(_+1);for(de=me=0;de<p-1;de++)for(te[de]=me,M=0;M<1<<Y[de];M++)v[me++]=de;for(v[me-1]=de,de=Le=0;de<16;de++)for(le[de]=Le,M=0;M<1<<G[de];M++)D[Le++]=de;for(Le>>=7;de<u;de++)for(le[de]=Le<<7,M=0;M<1<<G[de]-7;M++)D[256+Le++]=de;for(he=0;he<=_;he++)Ie[he]=0;for(M=0;M<=143;)I[2*M+1]=8,M++,Ie[8]++;for(;M<=255;)I[2*M+1]=9,M++,Ie[9]++;for(;M<=279;)I[2*M+1]=7,M++,Ie[7]++;for(;M<=287;)I[2*M+1]=8,M++,Ie[8]++;for(ve(I,m+1,Ie),M=0;M<u;M++)k[2*M+1]=5,k[2*M]=pe(M,5);ce=new Se(I,Y,b+1,m,_),re=new Se(k,G,0,u,_),se=new Se(new Array(0),O,0,w,A)})(),V=!0),z.l_desc=new ne(z.dyn_ltree,ce),z.d_desc=new ne(z.dyn_dtree,re),z.bl_desc=new ne(z.bl_tree,se),z.bi_buf=0,z.bi_valid=0,ke(z)},i._tr_stored_block=$,i._tr_flush_block=function(z,M,he,me){var de,Le,Ie=0;0<z.level?(z.strm.data_type===2&&(z.strm.data_type=(function(Te){var Ve,ht=4093624447;for(Ve=0;Ve<=31;Ve++,ht>>>=1)if(1&ht&&Te.dyn_ltree[2*Ve]!==0)return d;if(Te.dyn_ltree[18]!==0||Te.dyn_ltree[20]!==0||Te.dyn_ltree[26]!==0)return o;for(Ve=32;Ve<b;Ve++)if(Te.dyn_ltree[2*Ve]!==0)return o;return d})(z)),je(z,z.l_desc),je(z,z.d_desc),Ie=(function(Te){var Ve;for(j(Te,Te.dyn_ltree,Te.l_desc.max_code),j(Te,Te.dyn_dtree,Te.d_desc.max_code),je(Te,Te.bl_desc),Ve=w-1;3<=Ve&&Te.bl_tree[2*Q[Ve]+1]===0;Ve--);return Te.opt_len+=3*(Ve+1)+5+5+4,Ve})(z),de=z.opt_len+3+7>>>3,(Le=z.static_len+3+7>>>3)<=de&&(de=Le)):de=Le=he+5,he+4<=de&&M!==-1?$(z,M,he,me):z.strategy===4||Le===de?(K(z,2+(me?1:0),3),Ke(z,I,k)):(K(z,4+(me?1:0),3),(function(Te,Ve,ht,st){var ot;for(K(Te,Ve-257,5),K(Te,ht-1,5),K(Te,st-4,4),ot=0;ot<st;ot++)K(Te,Te.bl_tree[2*Q[ot]+1],3);P(Te,Te.dyn_ltree,Ve-1),P(Te,Te.dyn_dtree,ht-1)})(z,z.l_desc.max_code+1,z.d_desc.max_code+1,Ie+1),Ke(z,z.dyn_ltree,z.dyn_dtree)),ke(z),me&&Ae(z)},i._tr_tally=function(z,M,he){return z.pending_buf[z.d_buf+2*z.last_lit]=M>>>8&255,z.pending_buf[z.d_buf+2*z.last_lit+1]=255&M,z.pending_buf[z.l_buf+z.last_lit]=255&he,z.last_lit++,M===0?z.dyn_ltree[2*he]++:(z.matches++,M--,z.dyn_ltree[2*(v[he]+b+1)]++,z.dyn_dtree[2*C(M)]++),z.last_lit===z.lit_bufsize-1},i._tr_align=function(z){K(z,2,3),X(z,L,I),(function(M){M.bi_valid===16?(H(M,M.bi_buf),M.bi_buf=0,M.bi_valid=0):8<=M.bi_valid&&(M.pending_buf[M.pending++]=255&M.bi_buf,M.bi_buf>>=8,M.bi_valid-=8)})(z)}},{"../utils/common":41}],53:[function(e,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,s,i){(function(a){(function(d,o){if(!d.setImmediate){var c,h,p,b,m=1,u={},w=!1,g=d.document,_=Object.getPrototypeOf&&Object.getPrototypeOf(d);_=_&&_.setTimeout?_:d,c={}.toString.call(d.process)==="[object process]"?function(E){process.nextTick(function(){A(E)})}:(function(){if(d.postMessage&&!d.importScripts){var E=!0,F=d.onmessage;return d.onmessage=function(){E=!1},d.postMessage("","*"),d.onmessage=F,E}})()?(b="setImmediate$"+Math.random()+"$",d.addEventListener?d.addEventListener("message",L,!1):d.attachEvent("onmessage",L),function(E){d.postMessage(b+E,"*")}):d.MessageChannel?((p=new MessageChannel).port1.onmessage=function(E){A(E.data)},function(E){p.port2.postMessage(E)}):g&&"onreadystatechange"in g.createElement("script")?(h=g.documentElement,function(E){var F=g.createElement("script");F.onreadystatechange=function(){A(E),F.onreadystatechange=null,h.removeChild(F),F=null},h.appendChild(F)}):function(E){setTimeout(A,0,E)},_.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var F=new Array(arguments.length-1),Z=0;Z<F.length;Z++)F[Z]=arguments[Z+1];var Y={callback:E,args:F};return u[m]=Y,c(m),m++},_.clearImmediate=y}function y(E){delete u[E]}function A(E){if(w)setTimeout(A,0,E);else{var F=u[E];if(F){w=!0;try{(function(Z){var Y=Z.callback,G=Z.args;switch(G.length){case 0:Y();break;case 1:Y(G[0]);break;case 2:Y(G[0],G[1]);break;case 3:Y(G[0],G[1],G[2]);break;default:Y.apply(o,G)}})(F)}finally{y(E),w=!1}}}}function L(E){E.source===d&&typeof E.data=="string"&&E.data.indexOf(b)===0&&A(+E.data.slice(b.length))}})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof Uo<"u"?Uo:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(gc)),gc.exports}var $2=q2();const ip=w0($2),vo=()=>new Date().toISOString().split("T")[0],op=()=>new Promise((t,r)=>{if(window.svguitar){t();return}const e=document.createElement("script");e.src="https://omnibrain.github.io/svguitar/js/svguitar.umd.js",e.async=!0,e.onload=()=>t(),e.onerror=()=>r(new Error("Failed to load SVGuitar library")),document.body.appendChild(e)}),W2=t=>{const r=document.createElement("div");r.style.position="absolute",r.style.left="-9999px",r.style.top="-9999px",document.body.appendChild(r);try{const e=new window.svguitar.SVGuitarChord(r),s={strings:t.numStrings||6,frets:t.numFrets||5,position:t.startingFret||1,tuning:[],width:150,height:165,fretSize:1.2,fingerSize:.75,sidePadding:.2,fontFamily:"Arial, sans-serif",color:"#333333",backgroundColor:"transparent",strokeColor:"#333333",textColor:"#333333",fretLabelColor:"#333333",fingerTextColor:"#ffffff",fingerTextSize:28,title:t.title||""},d={fingers:[...(t.fingers||[]).map(h=>{const[p,b,m]=h;return m&&m!=="undefined"?[p,b,m]:[p,b]}),...(t.openStrings||[]).map(h=>[h,0]),...(t.mutedStrings||[]).map(h=>[h,"x"])],barres:t.barres||[]};e.configure(s).chord(d).draw();const o=r.querySelector("svg");if(!o)throw new Error("SVG not rendered");return new XMLSerializer().serializeToString(o)}finally{document.body.removeChild(r)}},H2=(t,r,e)=>new Promise((s,i)=>{const a=document.createElement("canvas");a.width=r,a.height=e;const d=a.getContext("2d");d.fillStyle="white",d.fillRect(0,0,r,e);const o=new Image,c=new Blob([t],{type:"image/svg+xml;charset=utf-8"}),h=URL.createObjectURL(c);o.onload=()=>{d.drawImage(o,0,0,r,e),URL.revokeObjectURL(h),s(a.toDataURL("image/png"))},o.onerror=p=>{URL.revokeObjectURL(h),i(new Error("Failed to load SVG into image"))},o.src=h}),Qc=async(t,r)=>{const e=await fetch(t);if(!e.ok)throw new Error(`Download failed: ${e.statusText}`);const s=await e.blob(),i=window.URL.createObjectURL(s),a=document.createElement("a");a.href=i;const d=e.headers.get("Content-Disposition");if(d){const o=d.match(/filename="?([^";\n]+)"?/);o?a.download=o[1]:a.download=r}else a.download=r;a.click(),window.URL.revokeObjectURL(i)},G2=async(t="json")=>Qc(`/api/user/export/items?format=${t}`,`items-${vo()}.${t}`),V2=async(t="json")=>Qc(`/api/user/export/routines?format=${t}`,`routines-${vo()}.${t}`),Y2=async()=>Qc("/api/user/export/chord-charts",`chord-charts-${vo()}.json`),J2=async()=>{await op();const t=vo(),r=await fetch("/api/user/export/all");if(!r.ok)throw new Error(`Failed to fetch export data: ${r.statusText}`);const e=await r.blob(),s=await ip.loadAsync(e),i=await fetch("/api/user/export/chord-charts");if(!i.ok)throw new Error(`Failed to fetch chord charts: ${i.statusText}`);const a=await i.json();if(a.items&&a.items.length>0){for(const h of a.items)if(!(!h.charts||h.charts.length===0))try{const p=await cp(h,t),m=`ChordChartPDFs/${lp(h.item_title||"Untitled")} - Chord Charts.pdf`;s.file(m,p)}catch(p){console.error(`Failed to generate PDF for "${h.item_title}":`,p)}}const d=await s.generateAsync({type:"blob"}),o=window.URL.createObjectURL(d),c=document.createElement("a");c.href=o,c.download=`gpra-export-${t}.zip`,c.click(),window.URL.revokeObjectURL(o)},lp=t=>t.replace(/[/\\:*?"<>|]/g,"-").trim(),cp=async(t,r)=>{const e=new Mt({orientation:"landscape",unit:"mm",format:"a4"}),s=e.internal.pageSize.getWidth(),i=e.internal.pageSize.getHeight(),a=10,d=s-a*2,o=5,c=d/o,h=c-6,p=h*11/10,b=p+2;let m=a;const u=()=>{e.addPage(),m=a};e.setFontSize(14),e.setFont("helvetica","bold"),e.text(t.item_title||"Untitled",a,m),m+=6,t.tuning&&(e.setFontSize(9),e.setFont("helvetica","italic"),e.text(`Tuning: ${t.tuning}`,a,m),m+=5);const w={};for(const _ of t.charts){const y=_.sectionLabel||"General";w[y]||(w[y]=[]),w[y].push(_)}for(const[_,y]of Object.entries(w)){m+b+8>i-a&&u(),e.setFontSize(10),e.setFont("helvetica","bold"),e.text(_,a,m),m+=5;let A=0,L=0;for(const E of y){A>=o&&(A=0,m+=L+3,L=0,m+b>i-a&&u());const F=a+A*c,Z=m;try{const Y=W2(E),G=await H2(Y,300,330),O=F+(c-h)/2;e.addImage(G,"PNG",O,Z,h,p)}catch(Y){console.error("Failed to render chord:",E.title,Y),e.setDrawColor(150),e.rect(F+2,Z,c-6,p),e.setFontSize(9),e.setFont("helvetica","bold"),e.text(E.title||"Unknown",F+4,Z+15),e.setFontSize(7),e.setFont("helvetica","normal"),e.text("(Render failed)",F+4,Z+22)}L=Math.max(L,b),A++}m+=L+5}const g=e.internal.getNumberOfPages();for(let _=1;_<=g;_++)e.setPage(_),e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(128),e.text(`Guitar Practice Routine App - Exported ${r} - Page ${_} of ${g}`,a,i-5),e.setTextColor(0);return e.output("arraybuffer")},K2=async()=>{await op();const t=await fetch("/api/user/export/chord-charts");if(!t.ok)throw new Error(`Failed to fetch chord charts: ${t.statusText}`);const r=await t.json();if(!r.items||r.items.length===0)throw new Error("No chord charts to export");const e=vo(),s=new ip;for(const o of r.items){if(!o.charts||o.charts.length===0)continue;const c=await cp(o,e),p=`${lp(o.item_title||"Untitled")} - Chord Charts.pdf`;s.file(p,c)}const i=await s.generateAsync({type:"blob"}),a=window.URL.createObjectURL(i),d=document.createElement("a");d.href=a,d.download=`chord-charts-${e}.zip`,d.click(),window.URL.revokeObjectURL(a)},Z2=()=>{var ys,Cr;const[t,r]=U.useState(""),[e,s]=U.useState(!1),[i,a]=U.useState(null),[d,o]=U.useState(!1),[c,h]=U.useState(!1),[p,b]=U.useState(!1),[m,u]=U.useState(null),[w,g]=U.useState(null),[_,y]=U.useState({username:"",email:"",tier:"free",oauth_providers:[],unplugged_mode:!1}),[A,L]=U.useState(0),[E,F]=U.useState(1),[Z,Y]=U.useState(!1),[G,O]=U.useState(0),[Q,I]=U.useState(!1),[k,D]=U.useState(!1),[v,te]=U.useState(!1),[ce,re]=U.useState(!1),[se,le]=U.useState(!1),[Se,ne]=U.useState(!1),[C,H]=U.useState(null),[K,X]=U.useState(""),[pe,ve]=U.useState(""),[ke,Ae]=U.useState(""),[Re,Me]=U.useState({current:!1,new:!1,confirm:!1}),[Ke,je]=U.useState(!1),[j,P]=U.useState(null),[V,$]=U.useState(!1),[z,M]=U.useState(!1),[he,me]=U.useState(!1),[de,Le]=U.useState(""),[Ie,Te]=U.useState(""),[Ve,ht]=U.useState(!1),[st,ot]=U.useState(!1),[yt,dt]=U.useState(null),[Vt,mt]=U.useState(null),[Lt,zt]=U.useState("settings"),[Et,wt]=U.useState(()=>{const He=localStorage.getItem("gpra_timer_volume");return He!==null?parseFloat(He):5.5}),[Jt,Nt]=U.useState(null),[Ft,ar]=U.useState(!1),Ot=U.useRef(null),xt=U.useRef(null),Xt=U.useRef(null),[er,Rr]=U.useState(()=>{const He={overview:!0,timerVolume:!0,apiKey:!0,practiceData:!0,changePassword:!0,analytics:!0,guidedTour:!0,dangerZone:!0},ft=sessionStorage.getItem("accountSettingsCollapsed");return ft?{...He,...JSON.parse(ft)}:He});U.useEffect(()=>{sessionStorage.setItem("accountSettingsCollapsed",JSON.stringify(er))},[er]),U.useEffect(()=>{bn(),tn(),Ut(),$r();const He=localStorage.getItem("cookieConsent"),ft=document.cookie.split(";").some(ur=>{const Hr=ur.trim().split("=")[0];return/^ph.*phc_/.test(Hr)});$(He==="all"&&ft)},[]);const bn=async()=>{try{const He=await fetch("/api/user/api-key");if(He.ok){const ft=await He.json();s(ft.has_key),a(ft.updated_at)}}catch(He){console.error("Error fetching API key status:",He)}},tn=async()=>{try{const He=await fetch("/api/auth/status");if(He.ok){const ft=await He.json();y({username:ft.user||"",email:ft.email||"",tier:ft.tier||"free",oauth_providers:ft.oauth_providers||[],unplugged_mode:ft.unplugged_mode||!1}),F({free:1,basic:5,thegoods:10,moregoods:25,themost:50}[ft.tier]||1)}}catch(He){console.error("Error fetching user profile:",He)}},Ut=async()=>{try{const He=await fetch("/api/routines");if(He.ok){const ft=await He.json();L(Array.isArray(ft)?ft.length:0)}}catch(He){console.error("Error fetching routine count:",He)}},pn=async()=>{if(!t.trim()){u({type:"error",text:"Please enter an API key"});return}b(!0),u(null),g(null);try{const ft=await(await fetch("/api/user/api-key/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:t})})).json();ft.valid?(g(!0),u({type:"success",text:"API key is valid!"})):(g(!1),u({type:"error",text:ft.error||"Invalid API key"}))}catch{g(!1),u({type:"error",text:"Error validating API key"})}finally{b(!1)}},wn=async()=>{if(!t.trim()){u({type:"error",text:"Please enter an API key"});return}h(!0),u(null);try{const He=await fetch("/api/user/api-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:t})}),ft=await He.json();He.ok?(u({type:"success",text:"API key saved successfully!"}),s(!0),r(""),o(!1),g(null),await bn()):u({type:"error",text:ft.error||"Failed to save API key"})}catch{u({type:"error",text:"Error saving API key"})}finally{h(!1)}},Vr=async()=>{if(confirm("Are you sure you want to delete your API key? You will need to enter it again to use autocreate.")){h(!0),u(null);try{(await fetch("/api/user/api-key",{method:"DELETE"})).ok?(u({type:"success",text:"API key deleted successfully"}),s(!1),a(null),r(""),g(null)):u({type:"error",text:"Failed to delete API key"})}catch{u({type:"error",text:"Error deleting API key"})}finally{h(!1)}}},$r=async()=>{try{const ft=await(await fetch("/api/user/practice-data/expiration-warning")).json();ft.has_expiring_data&&ft.days_until_expiration<=7&&(Y(!0),O(ft.days_until_expiration))}catch(He){console.error("Error fetching expiration warning:",He)}},xr=async(He="csv")=>{I(!0);try{const ur=await(await fetch(`/api/user/practice-data/download?format=${He}`)).blob(),Hr=window.URL.createObjectURL(ur),Ur=document.createElement("a");Ur.href=Hr,Ur.download=`practice-data-${new Date().toISOString().split("T")[0]}.${He}`,Ur.click(),window.URL.revokeObjectURL(Hr),Y(!1)}catch(ft){console.error("Download failed:",ft)}finally{I(!1)}},Ar=async He=>{D(!0),H(null);try{await G2(He)}catch(ft){console.error("Download items failed:",ft),H(`Failed to download items: ${ft.message}`)}finally{D(!1)}},dr=async He=>{te(!0),H(null);try{await V2(He)}catch(ft){console.error("Download routines failed:",ft),H(`Failed to download routines: ${ft.message}`)}finally{te(!1)}},rs=async()=>{re(!0),H(null);try{await Y2()}catch(He){console.error("Download chord charts JSON failed:",He),H(`Failed to download chord charts: ${He.message}`)}finally{re(!1)}},wr=async()=>{le(!0),H(null);try{await K2()}catch(He){console.error("Generate chord charts PDF failed:",He),H(`Failed to generate PDF: ${He.message}`)}finally{le(!1)}},Sn=async()=>{ne(!0),H(null);try{await J2()}catch(He){console.error("Download all data failed:",He),H(`Failed to download data bundle: ${He.message}`)}finally{ne(!1)}},rn=async He=>{try{await fetch("/api/user/practice-data/dismiss-reminder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dismiss_duration_days:He})}),Y(!1)}catch(ft){console.error("Error dismissing reminder:",ft)}},kn=async()=>{try{await fetch("/api/user/preferences/tour-reset",{method:"POST",headers:{"Content-Type":"application/json"}}),window.location.href="/?show_tour=1"}catch(He){console.error("Error restarting tour:",He),window.location.href="/?show_tour=1"}},Wr=He=>He.length<14?"Password must be at least 14 characters long":/[A-Z]/.test(He)?/[a-z]/.test(He)?/[0-9]/.test(He)?/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>?]/.test(He)?null:"Password must contain at least one symbol or punctuation character":"Password must contain at least one number":"Password must contain at least one lowercase letter":"Password must contain at least one uppercase letter",Yr=He=>({free:"Free",basic:"Basic",thegoods:"The Goods",moregoods:"More Goods",themost:"The Most"})[He]||"Free",En=He=>{const ft={free:"bg-gray-600 text-gray-200",basic:"bg-blue-600 text-blue-100",thegoods:"bg-green-600 text-green-100",moregoods:"bg-purple-600 text-purple-100",themost:"bg-orange-600 text-orange-100"};return ft[He]||ft.free},lt=(He,ft)=>{if(ft===1/0)return"text-green-400";const ur=He/ft*100;return ur>=100?"text-red-400":ur>=80?"text-yellow-400":"text-green-400"},Jr=He=>{Rr(ft=>({...ft,[He]:!ft[He]}))},ye=async He=>{if(He.preventDefault(),P(null),!K||!pe||!ke){P({type:"error",text:"All fields are required"});return}if(pe!==ke){P({type:"error",text:"New passwords do not match"});return}const ft=Wr(pe);if(ft){P({type:"error",text:ft});return}je(!0);try{const ur=await fetch("/api/user/password-change",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({current_password:K,new_password:pe,confirm_password:ke})}),Hr=await ur.json();ur.ok?(P({type:"success",text:"Password changed successfully!"}),X(""),ve(""),Ae("")):P({type:"error",text:Hr.error||"Failed to change password"})}catch{P({type:"error",text:"Error changing password"})}finally{je(!1)}},ze=He=>{const ft=document.cookie.split(";");for(let ur=0;ur<ft.length;ur++){const Hr=ft[ur],Ur=Hr.indexOf("="),Lr=Ur>-1?Hr.substring(0,Ur).trim():Hr.trim();He.test(Lr)&&(document.cookie=Lr+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/",document.cookie=Lr+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain="+window.location.hostname,document.cookie=Lr+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=."+window.location.hostname)}},We=async()=>{const He=V?"essential":"all";localStorage.setItem("cookieConsent",He);try{const ft=await fetch("/api/csrf-token"),{csrf_token:ur}=await ft.json();await fetch("/api/consent",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":ur},body:JSON.stringify({consent:He})})}catch(ft){console.error("[AccountSettings] Failed to save consent to server:",ft)}V?(typeof posthog<"u"&&posthog.opt_out_capturing&&posthog.opt_out_capturing(),ze(/^ph_phc_/),Object.keys(localStorage).forEach(ft=>{(ft.startsWith("ph_")||ft.includes("posthog"))&&localStorage.removeItem(ft)})):typeof posthog<"u"&&posthog.opt_in_capturing&&posthog.opt_in_capturing(),window.location.reload()},Qe=()=>{Le(_.username),M(!0),dt(null)},at=()=>{M(!1),Le(""),dt(null)},tt=async()=>{const He=de.trim();if(!He){dt({type:"error",text:"Username is required"});return}if(He.length<3){dt({type:"error",text:"Username must be at least 3 characters"});return}if(He===_.username){M(!1);return}ht(!0),dt(null);try{const ft=await fetch("/api/user/username",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:He})}),ur=await ft.json();ft.ok?(y(Hr=>({...Hr,username:ur.username})),M(!1),dt({type:"success",text:"Username updated!"}),setTimeout(()=>dt(null),3e3)):dt({type:"error",text:ur.error||"Failed to update username"})}catch{dt({type:"error",text:"Error updating username"})}finally{ht(!1)}},rt=()=>{Te(_.email),me(!0),mt(null)},it=()=>{me(!1),Te(""),mt(null)},Ct=async()=>{const He=Ie.trim().toLowerCase();if(!He){mt({type:"error",text:"Email is required"});return}if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(He)){mt({type:"error",text:"Please enter a valid email address"});return}if(He===_.email){me(!1);return}ot(!0),mt(null);try{const ur=await fetch("/api/user/email",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:He})}),Hr=await ur.json();ur.ok?(y(Ur=>({...Ur,email:Hr.email})),me(!1),mt({type:"success",text:"Email updated!"}),setTimeout(()=>mt(null),3e3)):mt({type:"error",text:Hr.error||"Failed to update email"})}catch{mt({type:"error",text:"Error updating email"})}finally{ot(!1)}},_t=(ys=_.oauth_providers)==null?void 0:ys.includes("tidal"),$t=(Cr=_.oauth_providers)==null?void 0:Cr.includes("google"),Yt=!_t,gt=!$t,Wt=()=>{if(Ot.current){try{Ot.current.stop()}catch{}Ot.current=null}ar(!1)},ir=async()=>{if(Ft){Wt();return}try{xt.current||(xt.current=new(window.AudioContext||window.webkitAudioContext),Xt.current=xt.current.createGain(),Xt.current.connect(xt.current.destination)),xt.current.state==="suspended"&&await xt.current.resume(),Xt.current.gain.value=Et/11*3;const ft=await(await fetch("/static/sound/timesUp.mp3")).arrayBuffer(),ur=await xt.current.decodeAudioData(ft);Wt(),Ot.current=xt.current.createBufferSource(),Ot.current.buffer=ur,Ot.current.connect(Xt.current),Ot.current.onended=()=>{ar(!1),Ot.current=null},Ot.current.start(),ar(!0)}catch(He){console.error("Error playing test sound:",He),ar(!1)}},Pn=()=>{Wt(),localStorage.setItem("gpra_timer_volume",Et.toString()),Nt({type:"success",text:"Volume saved!"}),setTimeout(()=>Nt(null),2e3)};return U.useEffect(()=>()=>{Wt(),xt.current&&xt.current.close()},[]),U.useEffect(()=>{er.timerVolume&&Wt()},[er.timerVolume]),U.useEffect(()=>{Xt.current&&Ft&&(Xt.current.gain.value=Et/11*3)},[Et,Ft]),n.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[n.jsx("h1",{className:"text-3xl font-bold mb-6 text-gray-100",children:"Account Settings"}),n.jsxs("div",{className:"flex gap-2 mb-4 md:hidden",children:[n.jsx(Be,{variant:Lt==="settings"?"default":"outline",onClick:()=>zt("settings"),className:Lt==="settings"?"bg-orange-600":"bg-gray-700 border-gray-600","data-ph-capture-attribute-button":"mobile-view-settings",children:"Settings"}),n.jsx(Be,{variant:Lt==="subscription"?"default":"outline",onClick:()=>zt("subscription"),className:Lt==="subscription"?"bg-orange-600":"bg-gray-700 border-gray-600","data-ph-capture-attribute-button":"mobile-view-subscription",children:"Subscription"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:`space-y-6 md:block ${Lt==="settings"?"":"hidden"}`,children:[n.jsxs(ln,{className:"bg-gray-800 border-gray-700",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>Jr("overview"),"data-ph-capture-attribute-toggle":"settings-overview-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(cn,{className:"text-gray-100",children:_.username||"Loading..."}),n.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${En(_.tier)}`,children:Yr(_.tier)}),n.jsxs("span",{className:`text-sm font-medium ${lt(A,E)}`,children:[A," / ",E===1/0?"âˆž":E," routines"]})]}),er.overview?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!er.overview&&n.jsx(dn,{className:"pt-0",children:n.jsx("div",{className:"flex items-start gap-6 flex-wrap",children:n.jsxs("div",{className:"flex-1 min-w-[200px] space-y-3",children:[n.jsxs("div",{children:[z?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Dr,{value:de,onChange:He=>Le(He.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 text-lg font-bold h-9 max-w-[200px]",placeholder:"Username",disabled:Ve,onKeyDown:He=>{He.key==="Enter"&&!He.shiftKey&&tt(),He.key==="Escape"&&at()},autoFocus:!0}),n.jsx(Be,{size:"sm",onClick:tt,disabled:Ve,className:"bg-green-600 hover:bg-green-700 h-8 px-2",children:Ve?n.jsx(Or,{className:"w-4 h-4 animate-spin"}):n.jsx(Nn,{className:"w-4 h-4"})}),n.jsx(Be,{size:"sm",variant:"outline",onClick:at,disabled:Ve,className:"bg-gray-700 border-gray-600 h-8 px-2",children:n.jsx(Gr,{className:"w-4 h-4"})})]}):n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("h2",{className:"text-xl font-bold text-gray-100",children:_.username||"Loading..."}),Yt&&n.jsx("button",{onClick:Qe,className:"text-gray-400 hover:text-gray-200 p-1",title:"Edit username","aria-label":"Edit username","data-ph-capture-attribute-button":"edit-username",children:n.jsx(po,{className:"w-4 h-4","aria-hidden":"true"})})]}),!Yt&&!z&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You log in with your Tidal account, so you can't change your username here."}),yt&&n.jsx("p",{className:`text-xs mt-1 ${yt.type==="success"?"text-green-400":"text-red-400"}`,children:yt.text})]}),n.jsxs("div",{children:[he?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Dr,{type:"email",value:Ie,onChange:He=>Te(He.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 text-sm h-8 max-w-[250px]",placeholder:"Email",disabled:st,onKeyDown:He=>{He.key==="Enter"&&!He.shiftKey&&Ct(),He.key==="Escape"&&it()},autoFocus:!0}),n.jsx(Be,{size:"sm",onClick:Ct,disabled:st,className:"bg-green-600 hover:bg-green-700 h-8 px-2",children:st?n.jsx(Or,{className:"w-4 h-4 animate-spin"}):n.jsx(Nn,{className:"w-4 h-4"})}),n.jsx(Be,{size:"sm",variant:"outline",onClick:it,disabled:st,className:"bg-gray-700 border-gray-600 h-8 px-2",children:n.jsx(Gr,{className:"w-4 h-4"})})]}):n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("p",{className:"text-sm text-gray-400",children:_.email||"Loading..."}),gt&&n.jsx("button",{onClick:rt,className:"text-gray-400 hover:text-gray-200 p-1",title:"Edit email","aria-label":"Edit email","data-ph-capture-attribute-button":"edit-email",children:n.jsx(po,{className:"w-4 h-4","aria-hidden":"true"})})]}),!gt&&!he&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You log in with your Google account, so you can't change your email address here."}),_t&&gt&&!he&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add your real email address to get reminders if you haven't used the account for 90 days."}),Vt&&n.jsx("p",{className:`text-xs mt-1 ${Vt.type==="success"?"text-green-400":"text-red-400"}`,children:Vt.text})]}),_.oauth_providers&&_.oauth_providers.includes("tidal")&&n.jsx("div",{className:"flex gap-2 flex-wrap",children:n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-gray-700 text-gray-300 rounded border border-gray-600",children:[n.jsx("img",{src:"/static/images/tidal-logo.png",alt:"Tidal",className:"w-4 h-4 rounded"}),"Tidal"]})})]})})})]}),n.jsxs(ln,{className:"bg-gray-800 border-gray-700",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>Jr("timerVolume"),"data-ph-capture-attribute-toggle":"settings-timer-volume-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(cn,{className:"text-gray-100",children:"Time's up sound level"}),n.jsx(Fs,{className:"text-gray-400",children:"Set the volume for the timer completion sound"})]}),er.timerVolume?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!er.timerVolume&&n.jsxs(dn,{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(Wn,{htmlFor:"timer-volume",className:"text-gray-200 flex items-center gap-2",children:[n.jsx(O0,{className:"w-4 h-4"}),"Volume level"]}),n.jsx("span",{className:"text-sm font-mono text-orange-400 bg-gray-900 px-2 py-1 rounded",children:Et.toFixed(1)})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"text-xs text-gray-500",children:"0"}),n.jsx("input",{id:"timer-volume",type:"range",min:"0",max:"11",step:"0.1",value:Et,onChange:He=>wt(parseFloat(He.target.value)),className:"flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-orange-500"}),n.jsx("span",{className:"text-xs text-gray-500",children:"11"})]}),n.jsx("p",{className:"text-xs text-gray-500 italic",children:"These go to eleven. ðŸŽ¸"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Be,{onClick:ir,variant:"outline",size:"sm",className:`bg-gray-700 hover:bg-gray-600 border-gray-600 ${Ft?"ring-2 ring-orange-500":""}`,children:Ft?n.jsxs(n.Fragment,{children:[n.jsx(E0,{className:"w-4 h-4 mr-2"}),"Stop"]}):n.jsxs(n.Fragment,{children:[n.jsx(Md,{className:"w-4 h-4 mr-2"}),"Test sound"]})}),n.jsx("span",{className:"text-xs text-gray-400",children:Ft?"Click to stop":"Preview at current level"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs(Be,{onClick:Pn,className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"save-timer-volume",children:[n.jsx(Nn,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Save"]}),Jt&&n.jsx("span",{className:`text-sm ${Jt.type==="success"?"text-green-400":"text-red-400"}`,children:Jt.text})]})]})]}),n.jsxs(ln,{className:"bg-gray-800 border-gray-700",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>Jr("apiKey"),"data-tour":"api-key-card-header","data-ph-capture-attribute-toggle":"settings-api-key-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{children:n.jsx(cn,{className:"text-gray-100",children:"Anthropic API key"})}),er.apiKey?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!er.apiKey&&n.jsxs(dn,{className:"space-y-4",children:[n.jsxs("div",{className:"bg-blue-900/30 border border-blue-700 rounded-md p-4",children:[n.jsx("h3",{className:"text-sm font-semibold text-blue-300 mb-2",children:"About API keys"}),n.jsxs("ul",{className:"text-sm text-gray-300 space-y-1 list-disc list-inside",children:[n.jsxs("li",{children:[n.jsx("strong",{children:"Free/Basic tiers:"})," Provide your own API key to autocreate chord charts"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"The Goods+ tiers:"})," Optional. Autocreated chord charts already included, but you can use your own key if you're hitting rate limits"]}),n.jsx("li",{children:"Your key is encrypted and stored securely"}),n.jsxs("li",{children:["Get your API key from"," ",n.jsxs("a",{href:"https://console.anthropic.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 inline-flex items-center gap-1",children:["Anthropic Console",n.jsx(Ch,{className:"w-3 h-3"})]})]})]})]}),e&&n.jsxs(ps,{className:"bg-green-900/30 border-green-700",children:[n.jsx(Nn,{className:"h-4 w-4 text-green-400"}),n.jsxs(ms,{className:"text-gray-300",children:["API key configured",i&&n.jsxs("span",{className:"text-gray-400 ml-2",children:["(updated ",new Date(i).toLocaleDateString(),")"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"api-key",className:"text-gray-200",children:e?"Update API key":"Paste API key"}),n.jsxs("div",{className:"flex gap-2","data-tour":"api-key-input",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Dr,{id:"api-key",type:d?"text":"password",value:t,onChange:He=>{r(He.target.value),g(null),u(null)},placeholder:"sk-ant-api03-...",className:"bg-gray-900 border-gray-600 text-gray-100 pr-10",disabled:c||p}),n.jsx("button",{type:"button",onClick:()=>o(!d),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",disabled:c||p,"aria-label":d?"Hide API key":"Show API key","data-ph-capture-attribute-button":"toggle-api-key-visibility",children:d?n.jsx(zo,{className:"w-4 h-4","aria-hidden":"true"}):n.jsx(qo,{className:"w-4 h-4","aria-hidden":"true"})})]}),n.jsx(Be,{onClick:pn,disabled:!t.trim()||c||p,variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"validate-api-key",children:p?n.jsx(Or,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):"Validate"})]})]}),w!==null&&n.jsxs(ps,{className:w?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:[w?n.jsx(Nn,{className:"h-4 w-4 text-green-400"}):n.jsx(Gr,{className:"h-4 w-4 text-red-400"}),n.jsx(ms,{className:"text-gray-300",children:w?"API key is valid!":(m==null?void 0:m.text)||"Invalid API key"})]}),m&&w===null&&n.jsxs(ps,{className:m.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:[m.type==="success"?n.jsx(Nn,{className:"h-4 w-4 text-green-400"}):n.jsx(Gr,{className:"h-4 w-4 text-red-400"}),n.jsx(ms,{className:"text-gray-300",children:m.text})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(Be,{onClick:wn,disabled:!t.trim()||c||p,className:"bg-orange-600 hover:bg-orange-700 flex-1","data-ph-capture-attribute-button":"save-api-key",children:c?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin","aria-hidden":"true"}),"Saving..."]}):n.jsxs(n.Fragment,{children:[n.jsx(Nn,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Save API key"]})}),e&&n.jsx(Be,{onClick:Vr,disabled:c,variant:"destructive",className:"bg-red-900 hover:bg-red-800","aria-label":"Delete API key","data-ph-capture-attribute-button":"delete-api-key",children:n.jsx(Ph,{className:"w-4 h-4","aria-hidden":"true"})})]})]})]}),n.jsxs(ln,{className:"bg-gray-800 border-gray-700",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>Jr("practiceData"),"data-ph-capture-attribute-toggle":"settings-practice-data-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(cn,{className:"text-gray-100",children:"Download your data"}),n.jsx(Fs,{className:"text-gray-400",children:"Export your practice data, items, routines, and chord charts"})]}),er.practiceData?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!er.practiceData&&n.jsxs(dn,{className:"space-y-6",children:[C&&n.jsxs(ps,{className:"bg-red-900/30 border-red-700",children:[n.jsx(Gr,{className:"h-4 w-4 text-red-400"}),n.jsx(ms,{className:"text-gray-300",children:C})]}),Z&&n.jsx(ps,{className:"bg-orange-900/30 border-orange-700",children:n.jsxs(ms,{className:"text-gray-300",children:["You have practice data that will be deleted in ",G," days. Download it to keep your records!",n.jsxs("div",{className:"flex gap-2 mt-3 flex-wrap",children:[n.jsx(Be,{onClick:()=>xr("csv"),size:"sm",className:"bg-orange-600 hover:bg-orange-700",children:"Download now"}),n.jsx(Be,{onClick:()=>rn(1),variant:"outline",size:"sm",className:"border-gray-600",children:"Remind me tomorrow"}),n.jsx(Be,{onClick:()=>rn(90),variant:"outline",size:"sm",className:"border-gray-600",children:"Don't care"})]})]})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"Practice history (last 90 days)"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs(Be,{onClick:()=>xr("csv"),disabled:Q,size:"sm",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"download-practice-csv",children:[Q?n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Js,{className:"w-4 h-4 mr-2"}),"CSV"]}),n.jsxs(Be,{onClick:()=>xr("json"),disabled:Q,size:"sm",variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"download-practice-json",children:[Q?n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Js,{className:"w-4 h-4 mr-2"}),"JSON"]})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Practice data is automatically deleted after 90 days."})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"All practice items"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs(Be,{onClick:()=>Ar("csv"),disabled:k,size:"sm",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"download-items-csv",children:[k?n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Js,{className:"w-4 h-4 mr-2"}),"CSV"]}),n.jsxs(Be,{onClick:()=>Ar("json"),disabled:k,size:"sm",variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"download-items-json",children:[k?n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Js,{className:"w-4 h-4 mr-2"}),"JSON"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"All routines"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs(Be,{onClick:()=>dr("csv"),disabled:v,size:"sm",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"download-routines-csv",children:[v?n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Js,{className:"w-4 h-4 mr-2"}),"CSV"]}),n.jsxs(Be,{onClick:()=>dr("json"),disabled:v,size:"sm",variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"download-routines-json",children:[v?n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Js,{className:"w-4 h-4 mr-2"}),"JSON"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"All chord charts"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs(Be,{onClick:wr,disabled:se,size:"sm",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"download-chords-pdf",children:[se?n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Js,{className:"w-4 h-4 mr-2"}),"PDF"]}),n.jsxs(Be,{onClick:rs,disabled:ce,size:"sm",variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"download-chords-json",children:[ce?n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Js,{className:"w-4 h-4 mr-2"}),"JSON"]})]})]}),n.jsx("div",{className:"border-t border-gray-700 pt-4",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"Download all your data"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Get everything in one ZIP file: items, routines, chord charts, and practice history."}),n.jsx(Be,{onClick:Sn,disabled:Se,className:"bg-orange-600 hover:bg-orange-700 w-full sm:w-auto","data-ph-capture-attribute-button":"download-all-zip",children:Se?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}),"Preparing ZIP..."]}):n.jsxs(n.Fragment,{children:[n.jsx(Js,{className:"w-4 h-4 mr-2"}),"Download ZIP"]})})]})})]})]}),n.jsxs(ln,{className:"bg-gray-800 border-gray-700",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>Jr("changePassword"),"data-ph-capture-attribute-toggle":"settings-change-password-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(cn,{className:"text-gray-100",children:"Change password"}),n.jsx(Fs,{className:"text-gray-400",children:"Update your account password"})]}),er.changePassword?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!er.changePassword&&n.jsx(dn,{children:$t||_t?n.jsx("p",{className:"text-sm text-gray-400",children:$t?"You log in with Google, so you have no password here to change.":"You log in with Tidal, so you have no password here to change."}):n.jsxs("form",{onSubmit:ye,className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"current-password",className:"text-gray-200",children:"Current password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{id:"current-password",type:Re.current?"text":"password",value:K,onChange:He=>X(He.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 pr-10",disabled:Ke}),n.jsx("button",{type:"button",onClick:()=>Me(He=>({...He,current:!He.current})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",disabled:Ke,children:Re.current?n.jsx(zo,{className:"w-4 h-4"}):n.jsx(qo,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"new-password",className:"text-gray-200",children:"New password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{id:"new-password",type:Re.new?"text":"password",value:pe,onChange:He=>ve(He.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 pr-10",disabled:Ke}),n.jsx("button",{type:"button",onClick:()=>Me(He=>({...He,new:!He.new})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",disabled:Ke,children:Re.new?n.jsx(zo,{className:"w-4 h-4"}):n.jsx(qo,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Wn,{htmlFor:"confirm-password",className:"text-gray-200",children:"Confirm new password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{id:"confirm-password",type:Re.confirm?"text":"password",value:ke,onChange:He=>Ae(He.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 pr-10",disabled:Ke}),n.jsx("button",{type:"button",onClick:()=>Me(He=>({...He,confirm:!He.confirm})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",disabled:Ke,children:Re.confirm?n.jsx(zo,{className:"w-4 h-4"}):n.jsx(qo,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"bg-blue-900/30 border border-blue-700 rounded-md p-3",children:[n.jsx("h4",{className:"text-sm font-semibold text-blue-300 mb-1",children:"Password requirements:"}),n.jsxs("ul",{className:"text-xs text-gray-300 space-y-0.5 list-disc list-inside",children:[n.jsx("li",{children:"At least 14 characters long"}),n.jsx("li",{children:"At least one uppercase letter"}),n.jsx("li",{children:"At least one lowercase letter"}),n.jsx("li",{children:"At least one number"}),n.jsx("li",{children:"At least one symbol or punctuation character"})]})]}),j&&n.jsxs(ps,{className:j.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:[j.type==="success"?n.jsx(Nn,{className:"h-4 w-4 text-green-400"}):n.jsx(Gr,{className:"h-4 w-4 text-red-400"}),n.jsx(ms,{className:"text-gray-300",children:j.text})]}),n.jsx(Be,{type:"submit",disabled:Ke||!K||!pe||!ke,className:"bg-orange-600 hover:bg-orange-700 w-full",children:Ke?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}),"Changing password..."]}):n.jsxs(n.Fragment,{children:[n.jsx(Nn,{className:"w-4 h-4 mr-2"}),"Change password"]})})]})})]}),n.jsxs(ln,{className:"bg-gray-800 border-gray-700",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>Jr("analytics"),"data-ph-capture-attribute-toggle":"settings-analytics-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(cn,{className:"text-gray-100",children:"Analytics & privacy"}),n.jsx(Fs,{className:"text-gray-400",children:"Control whether we can collect analytics"})]}),er.analytics?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!er.analytics&&n.jsxs(dn,{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"Allow analytics tracking"}),n.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded ${V?"bg-green-900/50 text-green-300":"bg-red-900/50 text-red-300"}`,children:V?"Allowed":"Disallowed"})]}),n.jsx("p",{className:"text-xs text-gray-400",children:"Help us improve GPRA by allowing usage analytics via PostHog cookies. (We'll never sell or share your data.)"})]}),n.jsx("button",{onClick:We,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 ${V?"bg-green-600 focus:ring-green-500":"bg-red-600 focus:ring-red-500"}`,role:"switch","aria-checked":V,children:n.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${V?"translate-x-6":"translate-x-1"}`})})]}),n.jsx("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-700",children:n.jsxs("p",{children:["Learn more about how we handle your data in our"," ",n.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",className:"text-orange-400 hover:underline",children:"Privacy Policy"})]})})]})]}),n.jsxs(ln,{className:"bg-gray-800 border-gray-700",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>Jr("guidedTour"),"data-ph-capture-attribute-toggle":"settings-guided-tour-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(cn,{className:"text-gray-100",children:"Guided tour"}),n.jsx(Fs,{className:"text-gray-400",children:"Take the intro tour again"})]}),er.guidedTour?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!er.guidedTour&&n.jsx(dn,{children:n.jsxs(Be,{onClick:kn,className:"bg-orange-600 hover:bg-orange-700 w-full","data-ph-capture-attribute-button":"restart-guided-tour",children:[n.jsx(Md,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Restart tour"]})})]}),n.jsxs(ln,{className:"bg-gray-800 border-gray-700 border-red-900/50",children:[n.jsx(_n,{className:"cursor-pointer select-none",onClick:()=>Jr("dangerZone"),"data-ph-capture-attribute-toggle":"settings-danger-zone-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(cn,{className:"text-red-400",children:"Danger zone"}),n.jsx(Fs,{className:"text-gray-400",children:"Pause your payments, or delete your account and all your data"})]}),er.dangerZone?n.jsx(fs,{className:"w-5 h-5 text-gray-400"}):n.jsx(Xn,{className:"w-5 h-5 text-gray-400"})]})}),!er.dangerZone&&n.jsx(dn,{className:"p-0",children:n.jsx(Zm,{userTier:_.tier,unpluggedMode:_.unplugged_mode})})]})]}),n.jsx("div",{id:"subscription-card",className:`space-y-6 md:block ${Lt==="subscription"?"":"hidden"}`,children:n.jsx(Km,{currentTier:_.tier,onSubscriptionChange:tn})})]})]})};let Ic={},dp;function xc(t={}){Ic={animate:!0,allowClose:!0,overlayClickBehavior:"close",overlayOpacity:.7,smoothScroll:!1,disableActiveInteraction:!1,showProgress:!1,stagePadding:10,stageRadius:5,popoverOffset:10,showButtons:["next","previous","close"],disableButtons:[],overlayColor:"#000",...t}}function kt(t){return t?Ic[t]:Ic}function X2(t){dp=t}function gs(){return dp}let wl={};function tl(t,r){wl[t]=r}function ai(t){var r;(r=wl[t])==null||r.call(wl)}function Q2(){wl={}}function rl(t,r,e,s){return(t/=s/2)<1?e/2*t*t+r:-e/2*(--t*(t-2)-1)+r}function up(t){const r='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])';return t.flatMap(e=>{const s=e.matches(r),i=Array.from(e.querySelectorAll(r));return[...s?[e]:[],...i]}).filter(e=>getComputedStyle(e).pointerEvents!=="none"&&r5(e))}function hp(t){if(!t||t5(t))return;const r=kt("smoothScroll"),e=t.offsetHeight>window.innerHeight;t.scrollIntoView({behavior:!r||e5(t)?"auto":"smooth",inline:"center",block:e?"start":"center"})}function e5(t){if(!t||!t.parentElement)return;const r=t.parentElement;return r.scrollHeight>r.clientHeight}function t5(t){const r=t.getBoundingClientRect();return r.top>=0&&r.left>=0&&r.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&r.right<=(window.innerWidth||document.documentElement.clientWidth)}function r5(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)}let vl={};function vn(t,r){vl[t]=r}function Rt(t){return t?vl[t]:vl}function dh(){vl={}}function n5(t,r,e,s){let i=Rt("__activeStagePosition");const a=i||e.getBoundingClientRect(),d=s.getBoundingClientRect(),o=rl(t,a.x,d.x-a.x,r),c=rl(t,a.y,d.y-a.y,r),h=rl(t,a.width,d.width-a.width,r),p=rl(t,a.height,d.height-a.height,r);i={x:o,y:c,width:h,height:p},pp(i),vn("__activeStagePosition",i)}function fp(t){if(!t)return;const r=t.getBoundingClientRect(),e={x:r.x,y:r.y,width:r.width,height:r.height};vn("__activeStagePosition",e),pp(e)}function s5(){const t=Rt("__activeStagePosition"),r=Rt("__overlaySvg");if(!t)return;if(!r){console.warn("No stage svg found.");return}const e=window.innerWidth,s=window.innerHeight;r.setAttribute("viewBox",`0 0 ${e} ${s}`)}function a5(t){const r=i5(t);document.body.appendChild(r),xp(r,e=>{e.target.tagName==="path"&&ai("overlayClick")}),vn("__overlaySvg",r)}function pp(t){const r=Rt("__overlaySvg");if(!r){a5(t);return}const e=r.firstElementChild;if((e==null?void 0:e.tagName)!=="path")throw new Error("no path element found in stage svg");e.setAttribute("d",mp(t))}function i5(t){const r=window.innerWidth,e=window.innerHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.classList.add("driver-overlay","driver-overlay-animated"),s.setAttribute("viewBox",`0 0 ${r} ${e}`),s.setAttribute("xmlSpace","preserve"),s.setAttribute("xmlnsXlink","http://www.w3.org/1999/xlink"),s.setAttribute("version","1.1"),s.setAttribute("preserveAspectRatio","xMinYMin slice"),s.style.fillRule="evenodd",s.style.clipRule="evenodd",s.style.strokeLinejoin="round",s.style.strokeMiterlimit="2",s.style.zIndex="10000",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%";const i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",mp(t)),i.style.fill=kt("overlayColor")||"rgb(0,0,0)",i.style.opacity=`${kt("overlayOpacity")}`,i.style.pointerEvents="auto",i.style.cursor="auto",s.appendChild(i),s}function mp(t){const r=window.innerWidth,e=window.innerHeight,s=kt("stagePadding")||0,i=kt("stageRadius")||0,a=t.width+s*2,d=t.height+s*2,o=Math.min(i,a/2,d/2),c=Math.floor(Math.max(o,0)),h=t.x-s+c,p=t.y-s,b=a-c*2,m=d-c*2;return`M${r},0L0,0L0,${e}L${r},${e}L${r},0Z
    M${h},${p} h${b} a${c},${c} 0 0 1 ${c},${c} v${m} a${c},${c} 0 0 1 -${c},${c} h-${b} a${c},${c} 0 0 1 -${c},-${c} v-${m} a${c},${c} 0 0 1 ${c},-${c} z`}function o5(){const t=Rt("__overlaySvg");t&&t.remove()}function l5(){const t=document.getElementById("driver-dummy-element");if(t)return t;let r=document.createElement("div");return r.id="driver-dummy-element",r.style.width="0",r.style.height="0",r.style.pointerEvents="none",r.style.opacity="0",r.style.position="fixed",r.style.top="50%",r.style.left="50%",document.body.appendChild(r),r}function uh(t){const{element:r}=t;let e=typeof r=="function"?r():typeof r=="string"?document.querySelector(r):r;e||(e=l5()),d5(e,t)}function c5(){const t=Rt("__activeElement"),r=Rt("__activeStep");t&&(fp(t),s5(),bp(t,r))}function d5(t,r){var e;const s=Date.now(),i=Rt("__activeStep"),a=Rt("__activeElement")||t,d=!a||a===t,o=t.id==="driver-dummy-element",c=a.id==="driver-dummy-element",h=kt("animate"),p=r.onHighlightStarted||kt("onHighlightStarted"),b=(r==null?void 0:r.onHighlighted)||kt("onHighlighted"),m=(i==null?void 0:i.onDeselected)||kt("onDeselected"),u=kt(),w=Rt();!d&&m&&m(c?void 0:a,i,{config:u,state:w,driver:gs()}),p&&p(o?void 0:t,r,{config:u,state:w,driver:gs()});const g=!d&&h;let _=!1;m5(),vn("previousStep",i),vn("previousElement",a),vn("activeStep",r),vn("activeElement",t);const y=()=>{if(Rt("__transitionCallback")!==y)return;const A=Date.now()-s,L=400-A<=400/2;r.popover&&L&&!_&&g&&(hh(t,r),_=!0),kt("animate")&&A<400?n5(A,400,a,t):(fp(t),b&&b(o?void 0:t,r,{config:kt(),state:Rt(),driver:gs()}),vn("__transitionCallback",void 0),vn("__previousStep",i),vn("__previousElement",a),vn("__activeStep",r),vn("__activeElement",t)),window.requestAnimationFrame(y)};vn("__transitionCallback",y),window.requestAnimationFrame(y),hp(t),!g&&r.popover&&hh(t,r),a.classList.remove("driver-active-element","driver-no-interaction"),a.removeAttribute("aria-haspopup"),a.removeAttribute("aria-expanded"),a.removeAttribute("aria-controls"),((e=r.disableActiveInteraction)!=null?e:kt("disableActiveInteraction"))&&t.classList.add("driver-no-interaction"),t.classList.add("driver-active-element"),t.setAttribute("aria-haspopup","dialog"),t.setAttribute("aria-expanded","true"),t.setAttribute("aria-controls","driver-popover-content")}function u5(){var t;(t=document.getElementById("driver-dummy-element"))==null||t.remove(),document.querySelectorAll(".driver-active-element").forEach(r=>{r.classList.remove("driver-active-element","driver-no-interaction"),r.removeAttribute("aria-haspopup"),r.removeAttribute("aria-expanded"),r.removeAttribute("aria-controls")})}function xo(){const t=Rt("__resizeTimeout");t&&window.cancelAnimationFrame(t),vn("__resizeTimeout",window.requestAnimationFrame(c5))}function h5(t){var r;if(!Rt("isInitialized")||!(t.key==="Tab"||t.keyCode===9))return;const e=Rt("__activeElement"),s=(r=Rt("popover"))==null?void 0:r.wrapper,i=up([...s?[s]:[],...e?[e]:[]]),a=i[0],d=i[i.length-1];if(t.preventDefault(),t.shiftKey){const o=i[i.indexOf(document.activeElement)-1]||d;o==null||o.focus()}else{const o=i[i.indexOf(document.activeElement)+1]||a;o==null||o.focus()}}function gp(t){var r;((r=kt("allowKeyboardControl"))==null||r)&&(t.key==="Escape"?ai("escapePress"):t.key==="ArrowRight"?ai("arrowRightPress"):t.key==="ArrowLeft"&&ai("arrowLeftPress"))}function xp(t,r,e){const s=(i,a)=>{const d=i.target;t.contains(d)&&((!e||e(d))&&(i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation()),a==null||a(i))};document.addEventListener("pointerdown",s,!0),document.addEventListener("mousedown",s,!0),document.addEventListener("pointerup",s,!0),document.addEventListener("mouseup",s,!0),document.addEventListener("click",i=>{s(i,r)},!0)}function f5(){window.addEventListener("keyup",gp,!1),window.addEventListener("keydown",h5,!1),window.addEventListener("resize",xo),window.addEventListener("scroll",xo)}function p5(){window.removeEventListener("keyup",gp),window.removeEventListener("resize",xo),window.removeEventListener("scroll",xo)}function m5(){const t=Rt("popover");t&&(t.wrapper.style.display="none")}function hh(t,r){var e,s;let i=Rt("popover");i&&document.body.removeChild(i.wrapper),i=x5(),document.body.appendChild(i.wrapper);const{title:a,description:d,showButtons:o,disableButtons:c,showProgress:h,nextBtnText:p=kt("nextBtnText")||"Next &rarr;",prevBtnText:b=kt("prevBtnText")||"&larr; Previous",progressText:m=kt("progressText")||"{current} of {total}"}=r.popover||{};i.nextButton.innerHTML=p,i.previousButton.innerHTML=b,i.progress.innerHTML=m,a?(i.title.innerHTML=a,i.title.style.display="block"):i.title.style.display="none",d?(i.description.innerHTML=d,i.description.style.display="block"):i.description.style.display="none";const u=o||kt("showButtons"),w=h||kt("showProgress")||!1,g=(u==null?void 0:u.includes("next"))||(u==null?void 0:u.includes("previous"))||w;i.closeButton.style.display=u.includes("close")?"block":"none",g?(i.footer.style.display="flex",i.progress.style.display=w?"block":"none",i.nextButton.style.display=u.includes("next")?"block":"none",i.previousButton.style.display=u.includes("previous")?"block":"none"):i.footer.style.display="none";const _=c||kt("disableButtons")||[];_!=null&&_.includes("next")&&(i.nextButton.disabled=!0,i.nextButton.classList.add("driver-popover-btn-disabled")),_!=null&&_.includes("previous")&&(i.previousButton.disabled=!0,i.previousButton.classList.add("driver-popover-btn-disabled")),_!=null&&_.includes("close")&&(i.closeButton.disabled=!0,i.closeButton.classList.add("driver-popover-btn-disabled"));const y=i.wrapper;y.style.display="block",y.style.left="",y.style.top="",y.style.bottom="",y.style.right="",y.id="driver-popover-content",y.setAttribute("role","dialog"),y.setAttribute("aria-labelledby","driver-popover-title"),y.setAttribute("aria-describedby","driver-popover-description");const A=i.arrow;A.className="driver-popover-arrow";const L=((e=r.popover)==null?void 0:e.popoverClass)||kt("popoverClass")||"";y.className=`driver-popover ${L}`.trim(),xp(i.wrapper,Y=>{var G,O,Q;const I=Y.target,k=((G=r.popover)==null?void 0:G.onNextClick)||kt("onNextClick"),D=((O=r.popover)==null?void 0:O.onPrevClick)||kt("onPrevClick"),v=((Q=r.popover)==null?void 0:Q.onCloseClick)||kt("onCloseClick");if(I.closest(".driver-popover-next-btn"))return k?k(t,r,{config:kt(),state:Rt(),driver:gs()}):ai("nextClick");if(I.closest(".driver-popover-prev-btn"))return D?D(t,r,{config:kt(),state:Rt(),driver:gs()}):ai("prevClick");if(I.closest(".driver-popover-close-btn"))return v?v(t,r,{config:kt(),state:Rt(),driver:gs()}):ai("closeClick")},Y=>!(i!=null&&i.description.contains(Y))&&!(i!=null&&i.title.contains(Y))&&typeof Y.className=="string"&&Y.className.includes("driver-popover")),vn("popover",i);const E=((s=r.popover)==null?void 0:s.onPopoverRender)||kt("onPopoverRender");E&&E(i,{config:kt(),state:Rt(),driver:gs()}),bp(t,r),hp(y);const F=t.classList.contains("driver-dummy-element"),Z=up([y,...F?[]:[t]]);Z.length>0&&Z[0].focus()}function yp(){const t=Rt("popover");if(!(t!=null&&t.wrapper))return;const r=t.wrapper.getBoundingClientRect(),e=kt("stagePadding")||0,s=kt("popoverOffset")||0;return{width:r.width+e+s,height:r.height+e+s,realWidth:r.width,realHeight:r.height}}function fh(t,r){const{elementDimensions:e,popoverDimensions:s,popoverPadding:i,popoverArrowDimensions:a}=r;return t==="start"?Math.max(Math.min(e.top-i,window.innerHeight-s.realHeight-a.width),a.width):t==="end"?Math.max(Math.min(e.top-(s==null?void 0:s.realHeight)+e.height+i,window.innerHeight-(s==null?void 0:s.realHeight)-a.width),a.width):t==="center"?Math.max(Math.min(e.top+e.height/2-(s==null?void 0:s.realHeight)/2,window.innerHeight-(s==null?void 0:s.realHeight)-a.width),a.width):0}function ph(t,r){const{elementDimensions:e,popoverDimensions:s,popoverPadding:i,popoverArrowDimensions:a}=r;return t==="start"?Math.max(Math.min(e.left-i,window.innerWidth-s.realWidth-a.width),a.width):t==="end"?Math.max(Math.min(e.left-(s==null?void 0:s.realWidth)+e.width+i,window.innerWidth-(s==null?void 0:s.realWidth)-a.width),a.width):t==="center"?Math.max(Math.min(e.left+e.width/2-(s==null?void 0:s.realWidth)/2,window.innerWidth-(s==null?void 0:s.realWidth)-a.width),a.width):0}function bp(t,r){const e=Rt("popover");if(!e)return;const{align:s="start",side:i="left"}=(r==null?void 0:r.popover)||{},a=s,d=t.id==="driver-dummy-element"?"over":i,o=kt("stagePadding")||0,c=yp(),h=e.arrow.getBoundingClientRect(),p=t.getBoundingClientRect(),b=p.top-c.height;let m=b>=0;const u=window.innerHeight-(p.bottom+c.height);let w=u>=0;const g=p.left-c.width;let _=g>=0;const y=window.innerWidth-(p.right+c.width);let A=y>=0;const L=!m&&!w&&!_&&!A;let E=d;if(d==="top"&&m?A=_=w=!1:d==="bottom"&&w?A=_=m=!1:d==="left"&&_?A=m=w=!1:d==="right"&&A&&(_=m=w=!1),d==="over"){const F=window.innerWidth/2-c.realWidth/2,Z=window.innerHeight/2-c.realHeight/2;e.wrapper.style.left=`${F}px`,e.wrapper.style.right="auto",e.wrapper.style.top=`${Z}px`,e.wrapper.style.bottom="auto"}else if(L){const F=window.innerWidth/2-(c==null?void 0:c.realWidth)/2,Z=10;e.wrapper.style.left=`${F}px`,e.wrapper.style.right="auto",e.wrapper.style.bottom=`${Z}px`,e.wrapper.style.top="auto"}else if(_){const F=Math.min(g,window.innerWidth-(c==null?void 0:c.realWidth)-h.width),Z=fh(a,{elementDimensions:p,popoverDimensions:c,popoverPadding:o,popoverArrowDimensions:h});e.wrapper.style.left=`${F}px`,e.wrapper.style.top=`${Z}px`,e.wrapper.style.bottom="auto",e.wrapper.style.right="auto",E="left"}else if(A){const F=Math.min(y,window.innerWidth-(c==null?void 0:c.realWidth)-h.width),Z=fh(a,{elementDimensions:p,popoverDimensions:c,popoverPadding:o,popoverArrowDimensions:h});e.wrapper.style.right=`${F}px`,e.wrapper.style.top=`${Z}px`,e.wrapper.style.bottom="auto",e.wrapper.style.left="auto",E="right"}else if(m){const F=Math.min(b,window.innerHeight-c.realHeight-h.width);let Z=ph(a,{elementDimensions:p,popoverDimensions:c,popoverPadding:o,popoverArrowDimensions:h});e.wrapper.style.top=`${F}px`,e.wrapper.style.left=`${Z}px`,e.wrapper.style.bottom="auto",e.wrapper.style.right="auto",E="top"}else if(w){const F=Math.min(u,window.innerHeight-(c==null?void 0:c.realHeight)-h.width);let Z=ph(a,{elementDimensions:p,popoverDimensions:c,popoverPadding:o,popoverArrowDimensions:h});e.wrapper.style.left=`${Z}px`,e.wrapper.style.bottom=`${F}px`,e.wrapper.style.top="auto",e.wrapper.style.right="auto",E="bottom"}L?e.arrow.classList.add("driver-popover-arrow-none"):g5(a,E,t)}function g5(t,r,e){const s=Rt("popover");if(!s)return;const i=e.getBoundingClientRect(),a=yp(),d=s.arrow,o=a.width,c=window.innerWidth,h=i.width,p=i.left,b=a.height,m=window.innerHeight,u=i.top,w=i.height;d.className="driver-popover-arrow";let g=r,_=t;if(r==="top"?(p+h<=0?(g="right",_="end"):p+h-o<=0&&(g="top",_="start"),p>=c?(g="left",_="end"):p+o>=c&&(g="top",_="end")):r==="bottom"?(p+h<=0?(g="right",_="start"):p+h-o<=0&&(g="bottom",_="start"),p>=c?(g="left",_="start"):p+o>=c&&(g="bottom",_="end")):r==="left"?(u+w<=0?(g="bottom",_="end"):u+w-b<=0&&(g="left",_="start"),u>=m?(g="top",_="end"):u+b>=m&&(g="left",_="end")):r==="right"&&(u+w<=0?(g="bottom",_="start"):u+w-b<=0&&(g="right",_="start"),u>=m?(g="top",_="start"):u+b>=m&&(g="right",_="end")),!g)d.classList.add("driver-popover-arrow-none");else{d.classList.add(`driver-popover-arrow-side-${g}`),d.classList.add(`driver-popover-arrow-align-${_}`);const y=e.getBoundingClientRect(),A=d.getBoundingClientRect(),L=kt("stagePadding")||0,E=y.left-L<window.innerWidth&&y.right+L>0&&y.top-L<window.innerHeight&&y.bottom+L>0;r==="bottom"&&E&&(A.x>y.x&&A.x+A.width<y.x+y.width?s.wrapper.style.transform="translateY(0)":(d.classList.remove(`driver-popover-arrow-align-${_}`),d.classList.add("driver-popover-arrow-none"),s.wrapper.style.transform=`translateY(-${L/2}px)`))}}function x5(){const t=document.createElement("div");t.classList.add("driver-popover");const r=document.createElement("div");r.classList.add("driver-popover-arrow");const e=document.createElement("header");e.id="driver-popover-title",e.classList.add("driver-popover-title"),e.style.display="none",e.innerText="Popover Title";const s=document.createElement("div");s.id="driver-popover-description",s.classList.add("driver-popover-description"),s.style.display="none",s.innerText="Popover description is here";const i=document.createElement("button");i.type="button",i.classList.add("driver-popover-close-btn"),i.setAttribute("aria-label","Close"),i.innerHTML="&times;";const a=document.createElement("footer");a.classList.add("driver-popover-footer");const d=document.createElement("span");d.classList.add("driver-popover-progress-text"),d.innerText="";const o=document.createElement("span");o.classList.add("driver-popover-navigation-btns");const c=document.createElement("button");c.type="button",c.classList.add("driver-popover-prev-btn"),c.innerHTML="&larr; Previous";const h=document.createElement("button");return h.type="button",h.classList.add("driver-popover-next-btn"),h.innerHTML="Next &rarr;",o.appendChild(c),o.appendChild(h),a.appendChild(d),a.appendChild(o),t.appendChild(i),t.appendChild(r),t.appendChild(e),t.appendChild(s),t.appendChild(a),{wrapper:t,arrow:r,title:e,description:s,footer:a,previousButton:c,nextButton:h,closeButton:i,footerButtons:o,progress:d}}function y5(){var t;const r=Rt("popover");r&&((t=r.wrapper.parentElement)==null||t.removeChild(r.wrapper))}function b5(t={}){xc(t);function r(){kt("allowClose")&&p()}function e(){const m=kt("overlayClickBehavior");if(kt("allowClose")&&m==="close"){p();return}if(typeof m=="function"){const u=Rt("__activeStep"),w=Rt("__activeElement");m(w,u,{config:kt(),state:Rt(),driver:gs()});return}m==="nextStep"&&s()}function s(){const m=Rt("activeIndex"),u=kt("steps")||[];if(typeof m>"u")return;const w=m+1;u[w]?h(w):p()}function i(){const m=Rt("activeIndex"),u=kt("steps")||[];if(typeof m>"u")return;const w=m-1;u[w]?h(w):p()}function a(m){(kt("steps")||[])[m]?h(m):p()}function d(){var m;if(Rt("__transitionCallback"))return;const u=Rt("activeIndex"),w=Rt("__activeStep"),g=Rt("__activeElement");if(typeof u>"u"||typeof w>"u"||typeof Rt("activeIndex")>"u")return;const _=((m=w.popover)==null?void 0:m.onPrevClick)||kt("onPrevClick");if(_)return _(g,w,{config:kt(),state:Rt(),driver:gs()});i()}function o(){var m;if(Rt("__transitionCallback"))return;const u=Rt("activeIndex"),w=Rt("__activeStep"),g=Rt("__activeElement");if(typeof u>"u"||typeof w>"u")return;const _=((m=w.popover)==null?void 0:m.onNextClick)||kt("onNextClick");if(_)return _(g,w,{config:kt(),state:Rt(),driver:gs()});s()}function c(){Rt("isInitialized")||(vn("isInitialized",!0),document.body.classList.add("driver-active",kt("animate")?"driver-fade":"driver-simple"),f5(),tl("overlayClick",e),tl("escapePress",r),tl("arrowLeftPress",d),tl("arrowRightPress",o))}function h(m=0){var u,w,g,_,y,A,L,E;const F=kt("steps");if(!F){console.error("No steps to drive through"),p();return}if(!F[m]){p();return}vn("__activeOnDestroyed",document.activeElement),vn("activeIndex",m);const Z=F[m],Y=F[m+1],G=F[m-1],O=((u=Z.popover)==null?void 0:u.doneBtnText)||kt("doneBtnText")||"Done",Q=kt("allowClose"),I=typeof((w=Z.popover)==null?void 0:w.showProgress)<"u"?(g=Z.popover)==null?void 0:g.showProgress:kt("showProgress"),k=(((_=Z.popover)==null?void 0:_.progressText)||kt("progressText")||"{{current}} of {{total}}").replace("{{current}}",`${m+1}`).replace("{{total}}",`${F.length}`),D=((y=Z.popover)==null?void 0:y.showButtons)||kt("showButtons"),v=["next","previous",...Q?["close"]:[]].filter(se=>!(D!=null&&D.length)||D.includes(se)),te=((A=Z.popover)==null?void 0:A.onNextClick)||kt("onNextClick"),ce=((L=Z.popover)==null?void 0:L.onPrevClick)||kt("onPrevClick"),re=((E=Z.popover)==null?void 0:E.onCloseClick)||kt("onCloseClick");uh({...Z,popover:{showButtons:v,nextBtnText:Y?void 0:O,disableButtons:[...G?[]:["previous"]],showProgress:I,progressText:k,onNextClick:te||(()=>{Y?h(m+1):p()}),onPrevClick:ce||(()=>{h(m-1)}),onCloseClick:re||(()=>{p()}),...(Z==null?void 0:Z.popover)||{}}})}function p(m=!0){const u=Rt("__activeElement"),w=Rt("__activeStep"),g=Rt("__activeOnDestroyed"),_=kt("onDestroyStarted");if(m&&_){const L=!u||(u==null?void 0:u.id)==="driver-dummy-element";_(L?void 0:u,w,{config:kt(),state:Rt(),driver:gs()});return}const y=(w==null?void 0:w.onDeselected)||kt("onDeselected"),A=kt("onDestroyed");if(document.body.classList.remove("driver-active","driver-fade","driver-simple"),p5(),y5(),u5(),o5(),Q2(),dh(),u&&w){const L=u.id==="driver-dummy-element";y&&y(L?void 0:u,w,{config:kt(),state:Rt(),driver:gs()}),A&&A(L?void 0:u,w,{config:kt(),state:Rt(),driver:gs()})}g&&g.focus()}const b={isActive:()=>Rt("isInitialized")||!1,refresh:xo,drive:(m=0)=>{c(),h(m)},setConfig:xc,setSteps:m=>{dh(),xc({...kt(),steps:m})},getConfig:kt,getState:Rt,getActiveIndex:()=>Rt("activeIndex"),isFirstStep:()=>Rt("activeIndex")===0,isLastStep:()=>{const m=kt("steps")||[],u=Rt("activeIndex");return u!==void 0&&u===m.length-1},getActiveStep:()=>Rt("activeStep"),getActiveElement:()=>Rt("activeElement"),getPreviousElement:()=>Rt("previousElement"),getPreviousStep:()=>Rt("previousStep"),moveNext:s,movePrevious:i,moveTo:a,hasNextStep:()=>{const m=kt("steps")||[],u=Rt("activeIndex");return u!==void 0&&!!m[u+1]},hasPreviousStep:()=>{const m=kt("steps")||[],u=Rt("activeIndex");return u!==void 0&&!!m[u-1]},highlight:m=>{c(),uh({...m,popover:m.popover?{showButtons:[],showProgress:!1,progressText:"",...m.popover}:void 0})},destroy:()=>{p(!1)}};return X2(b),b}const w5=()=>{const{setActivePage:t}=zi();U.useEffect(()=>{(async()=>{try{console.log("[TOUR] Checking tour status...");const i=await fetch("/api/user/preferences/tour-status");if(console.log("[TOUR] API response status:",i.status),!i.ok){console.log("[TOUR] API response not OK, aborting");return}const a=await i.json();console.log("[TOUR] API data:",a);const o=new URLSearchParams(window.location.search).has("show_tour"),c=sessionStorage.getItem("show_tour_after_login")==="true";if(console.log("[TOUR] showTourParam:",o),console.log("[TOUR] showTourAfterLogin:",c),console.log("[TOUR] data.show_tour:",a.show_tour),a.show_tour||o||c){if(console.log("[TOUR] Starting tour!"),c&&sessionStorage.removeItem("show_tour_after_login"),o){const h=window.location.pathname;window.history.replaceState({},"",h)}setTimeout(()=>e(),500)}}catch(i){console.error("Error checking tour status:",i)}})()},[]);const r=async()=>{try{await fetch("/api/user/preferences/tour-complete",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(s){console.error("Error marking tour complete:",s)}},e=()=>{const s=b5({showProgress:!0,showButtons:["next","previous"],popoverClass:"gpra-tour-popover",overlayOpacity:.55,stagePadding:15,stageRadius:8,allowClose:!1,steps:[{element:'[data-tour="app-title"]',popover:{title:"Welcome to Guitar Practice Routine App!",description:"You'll be tempted to skip through this tour without reading it, but since you're new here you'll get a lot more from the app (a lot more quickly) if you take the tour.<br> Click `Next` to get going... ðŸŽ¸<br><br>Sidenote: The app works on mobile, but it's best on desktop/laptop ",popoverClass:"gpra-tour-popover gpra-tour-welcome",side:"bottom",align:"start"}},{element:'[data-tour="items-tab"]',onHighlightStarted:i=>new Promise(a=>{i.getBoundingClientRect();const d=document.querySelectorAll(".driver-popover img");if(d.length>0){let o=0;const c=()=>{o++,o===d.length&&setTimeout(a,100)};d.forEach(h=>{h.complete?c():(h.addEventListener("load",c),h.addEventListener("error",c))})}else setTimeout(a,100)}),popover:{title:"Step 1: Creating practice items",description:'Use the items page to create and manage items.<br>Items can be songs, exercises, reminders, etc.<br><br><div style="text-align: center;"><img src="/static/images/tour/CreateItem.gif" style="width: 600px; height: 579px; border-radius: 4px;" alt="Creating a practice item"></div>',side:"bottom",align:"start",onNextClick:()=>(t("Routines"),setTimeout(()=>{s.moveNext()},400),!1)}},{element:'[data-tour="new-routine-input"]',onHighlightStarted:i=>new Promise(a=>{i.getBoundingClientRect();const d=document.querySelectorAll(".driver-popover img");if(d.length>0){let o=0;const c=()=>{o++,o===d.length&&setTimeout(a,100)};d.forEach(h=>{h.complete?c():(h.addEventListener("load",c),h.addEventListener("error",c))})}else setTimeout(a,100)}),popover:{title:"Step 2: Creating routines",description:'Routines are for organizing your practice items into structured sessions.<br>Enter a name for a new routine, then click the `+ Add` button.<br><br><div style="text-align: center;"><img src="/static/images/tour/CreateRoutine.gif" style="width: 600px; height: 495px; border-radius: 4px;" alt="Creating a routine"></div>',side:"bottom",align:"start",onPrevClick:()=>(t("Items"),setTimeout(()=>{s.movePrevious()},400),!1),onPopoverRender:()=>{setTimeout(()=>{const i=document.querySelector('[data-tour="new-routine-input"]');i&&i.scrollIntoView({behavior:"smooth",block:"center"})},100)},onNextClick:()=>(s.moveNext(),!1)}},{element:'[data-tour="edit-routine-icon"]',popover:{title:"Step 3: Adding items to routines",description:`To add items to routines, click the âœï¸ edit icon.<br>Drag n' drop to reorder.<br><br><div style="text-align: center;"><img src="/static/images/tour/AddItemsToRoutine.gif" style="width: 600px; height: 435px; border-radius: 4px;" alt="Adding items to routine"></div>`,side:"left",align:"start",onNextClick:()=>(t("Practice"),setTimeout(()=>{s.moveNext()},200),!1)}},{element:'[data-tour="practice-tab"]',popover:{title:"Step 4: Practice page",description:"This is where you'll spend your time when you're practicing. The Practice page shows the active routine and its items.<br><br> To change the active routine, go to the Routines page and click the `+` on a routine to make it active.",side:"bottom",align:"start",onPrevClick:()=>(t("Routines"),setTimeout(()=>{s.movePrevious()},200),!1),onNextClick:()=>{const i=document.querySelector("[data-item-header]");return i&&i.getAttribute("data-expanded")!=="true"&&i.click(),setTimeout(()=>{const a=document.querySelector('[data-tour="chord-charts"]');if(a){const d=a.closest(".cursor-pointer");if(d){const o=d.querySelector("svg");o&&!o.classList.contains("rotate-0")&&d.click()}}setTimeout(()=>{s.moveNext()},500)},400),!1}}},{element:'[data-tour="chord-charts-section"]',popover:{title:"Step 5: Chord charts",description:"You can view and manage chord charts from the `Practice`, `Routines`, and `Items` pages. You can create charts manually, or use the autocreate feature to build charts from PDFs, images, YouTube lesson videos, or type the names of the song sections and chords.",side:"top",align:"start",popoverClass:"gpra-tour-popover gpra-tour-chord-charts",onPrevClick:()=>(t("Practice"),setTimeout(()=>{s.movePrevious()},200),!1),onNextClick:()=>(t("Account"),setTimeout(()=>{if(!document.querySelector('[data-tour="api-key-input"]')){const a=document.querySelector('[data-tour="api-key-card-header"]');a&&a.click()}setTimeout(()=>{s.moveNext()},300)},400),!1)}},{element:'[data-tour="api-key-input"]',popover:{title:"Step 6: Adding your API key",description:"To use the autocreate feature on free and basic tiers, add your Anthropic API key on the account page. Then Claude can build chord charts for you.",side:"top",align:"start",popoverClass:"gpra-tour-popover gpra-tour-api-key",onPrevClick:()=>(t("Practice"),setTimeout(()=>{s.movePrevious()},200),!1)}},{element:'[data-tour="items-tab"]',popover:{title:"You're all set!",description:"That's it for the tour. Rock on! ðŸ¤˜<br> (or blues on, folk on, jazz on, hip hop on, country on, reggae on, get your worship on, or whatever floats your musical boat...)",popoverClass:"gpra-tour-popover gpra-tour-welcome",side:"bottom",align:"start"}}],onDestroyed:()=>{t("Items"),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},200),r()}});s.drive()};return null};function v5({isOpen:t,onClose:r,daysUntil90:e,lapseDate:s}){const[i,a]=U.useState(!1),[d,o]=U.useState(null),[c,h]=U.useState(!0);U.useEffect(()=>{t&&(h(!0),fetch("/api/billing/last-payment",{credentials:"include"}).then(m=>m.json()).then(m=>{m.amount&&m.date&&o({amount:m.amount,date:new Date(m.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}).catch(m=>{console.error("Error fetching last payment:",m)}).finally(()=>{h(!1)}))},[t]);const p=async()=>{a(!0);try{const m=await fetch("/api/billing/resume-subscription",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!m.ok){const w=await m.text();throw console.error("Resume subscription failed:",m.status,w),new Error(`Failed to resume subscription: ${m.status}`)}const u=await m.json();if(u.url)window.location.href=u.url;else throw new Error("No portal URL returned")}catch(m){console.error("Error resuming subscription:",m),alert("Error resuming subscription. Please try again."),a(!1)}},b=async()=>{a(!0);try{const m=await fetch("/api/billing/set-unplugged",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!m.ok){const w=await m.text();throw console.error("Set unplugged failed:",m.status,w),new Error(`Failed to set unplugged mode: ${m.status}`)}if((await m.json()).success)sessionStorage.setItem("lapsedModalDismissed","true"),window.location.reload();else throw new Error("Failed to set unplugged mode")}catch(m){console.error("Error setting unplugged mode:",m),alert("Error. Please try again."),a(!1)}};return t?(s&&new Date(s).toLocaleDateString(),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:m=>{m.stopPropagation()},children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4 p-6",onClick:m=>m.stopPropagation(),children:[n.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 mb-6",children:[n.jsx("p",{className:"text-white text-lg font-semibold mb-2",children:"Caution, potential discomfort ahead: Money talk"}),!c&&d&&n.jsxs("p",{className:"text-gray-200 text-sm",children:["Your last payment was $",d.amount," on ",d.date]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50",children:[n.jsx("h3",{className:"font-semibold mb-2",children:"Resume with a payment"}),n.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Add or update your payment method to get your goodies back. We're keeping all your routines, items, and chord charts saved in our database for another ",e," days (counting from when you paused, canceled, or missed a payment)."]}),n.jsx("button",{onClick:p,disabled:i,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition-colors disabled:bg-gray-400",children:i?"Loading...":"Plug it in"})]}),n.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[n.jsx("h3",{className:"font-semibold mb-2",children:"Go back to freebie mode"}),n.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Keep using your most recently active routine for free. We'll save all your other stuff in our DB for another ",e," days if you renew by then (counting from when you paused, canceled, or missed a payment)."]}),n.jsx("button",{onClick:b,disabled:i,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded transition-colors disabled:bg-gray-400",children:i?"Loading...":"Unplugged"})]})]})]})})):null}function N5({isOpen:t,onClose:r,daysRemaining:e,targetPage:s}){const[i,a]=U.useState(!1),d=async()=>{a(!0);try{const c=await(await fetch("/api/billing/resume-subscription",{method:"POST",headers:{"Content-Type":"application/json"}})).json();c.url&&(window.location.href=c.url)}catch(o){console.error("Error:",o),a(!1)}};return t?n.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-gray-900 bg-opacity-75",onClick:r,children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",onClick:o=>o.stopPropagation(),children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Still unplugged"}),n.jsxs("p",{className:"text-gray-700 mb-6",children:["We're still saving your ",s==="routines"?"routines":"items"," for another ",e||0," days (counting from when you paused, canceled, or missed a payment)."]}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsx("button",{onClick:d,disabled:i,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition-colors",children:i?"Loading...":"Plug it back in"}),n.jsx("button",{onClick:r,className:"w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded transition-colors",children:"Keep it unplugged"})]})]})}):null}const _5=({deletionDate:t,deletionType:r,refundAmount:e,onCancel:s})=>{const[i,a]=U.useState(!1),[d,o]=U.useState(!1),[c,h]=U.useState(null),p=async()=>{a(!0),h(null);try{const m=await fetch("/api/user/cancel-deletion",{method:"POST",headers:{"Content-Type":"application/json"}}),u=await m.json();m.ok?(h({type:"success",text:"Deletion canceled successfully! Page will reload..."}),setTimeout(()=>{window.location.reload()},1500)):h({type:"error",text:u.error||"Failed to cancel deletion"})}catch{h({type:"error",text:"Error canceling deletion"})}finally{a(!1)}};if(d)return null;const b=new Date(t).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});return n.jsx("div",{className:"bg-yellow-900/30 border-l-4 border-yellow-500 p-4 mb-4 rounded-r-md",children:n.jsxs("div",{className:"flex items-start justify-between gap-4",children:[n.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[n.jsx(Rn,{className:"w-5 h-5 text-yellow-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-yellow-100 font-semibold mb-1",children:"Account deletion scheduled"}),n.jsxs("p",{className:"text-yellow-200 text-sm mb-2",children:["Your account will be permanently deleted on ",n.jsx("strong",{children:b}),".",e>0&&n.jsxs(n.Fragment,{children:[" You'll receive a refund of ",n.jsxs("strong",{children:["$",e.toFixed(2)]}),"."]})]}),c&&n.jsx(ps,{className:`mt-2 ${c.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700"}`,children:n.jsx(ms,{className:"text-gray-300 text-xs",children:c.text})})]})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n.jsx(Be,{onClick:p,disabled:i,size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",children:i?n.jsxs(n.Fragment,{children:[n.jsx(Or,{className:"w-4 h-4 mr-2 animate-spin"}),"Canceling..."]}):"Cancel deletion"}),n.jsx("button",{onClick:()=>o(!0),className:"text-yellow-400 hover:text-yellow-300 p-1","aria-label":"Dismiss banner",children:n.jsx(Gr,{className:"w-5 h-5"})})]})]})})},j5=()=>{const[t,r]=U.useState([]),[e,s]=U.useState(!0),[i,a]=U.useState(null),[d,o]=U.useState(0),c=async()=>{try{const p=await fetch("/api/items");if(!p.ok)throw new Error("Failed to fetch items");const b=await p.json();r(b),a(null)}catch(p){a(p.message),console.error("Fetch error:",p)}finally{s(!1)}},h=U.useCallback(async()=>{o(p=>p+1)},[]);return U.useEffect(()=>{c()},[d]),{items:t,loading:e,error:i,refreshItems:h}},S5=()=>{const{items:t,refreshItems:r}=j5();return n.jsx(wm,{items:t,onItemsChange:r})},k5=()=>{const{activePage:t}=zi();switch(t){case"Practice":return n.jsx(Am,{});case"Routines":return n.jsx(zm,{});case"Items":return n.jsx(S5,{});case"Imports":return n.jsx(Vm,{});case"Account":return n.jsx(Z2,{});case"FAQ":return window.location.href="/faq",null;default:return n.jsx("div",{children:"Page not implemented yet"})}},C5=()=>{const t=U.useRef(null),[r,e]=U.useState(160),[s,i]=U.useState(!1),[a,d]=U.useState({}),[o,c]=U.useState(null),{activePage:h,setActivePage:p}=zi(),[b,m]=U.useState(!1),[u,w]=U.useState("");return U.useEffect(()=>{const g=()=>{if(t.current){const _=t.current.offsetHeight;e(_+20)}};return g(),window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),U.useEffect(()=>{fetch("/api/auth/status").then(g=>g.json()).then(g=>{c(g),g.authenticated&&window.posthog&&(window.posthog.identify(g.posthog_distinct_id,{email:g.email,username:g.user,subscription_tier:g.tier,billing_period:g.billing_period,oauth_providers:g.oauth_providers||[]}),j0(g));const _=sessionStorage.getItem("lapsedModalDismissed")==="true";g.is_lapsed&&!_&&(d({daysUntil90:g.days_until_90,lapseDate:g.lapse_date}),i(!0))}).catch(g=>console.error("Error checking auth status:",g))},[]),n.jsxs("div",{className:"min-h-screen",children:[n.jsx(w5,{}),n.jsx(_0,{}),n.jsx(v5,{isOpen:s,onClose:()=>i(!1),daysUntil90:a.daysUntil90,lapseDate:a.lapseDate}),n.jsx(N5,{isOpen:b,onClose:()=>m(!1),daysRemaining:o==null?void 0:o.days_remaining,targetPage:u}),n.jsx("div",{ref:t,className:"fixed top-0 left-0 right-0 z-50 bg-gray-900",children:n.jsxs("div",{className:"container mx-auto px-4 pt-4 pb-1",children:[n.jsx("h1",{className:"text-2xl sm:text-4xl font-bold text-orange-500 mb-2","data-tour":"app-title",children:"Guitar Practice Routine App"}),n.jsx(Fm,{className:"mb-0",userStatus:o,onUnpluggedAttempt:g=>{w(g.toLowerCase()),m(!0)}})]})}),n.jsxs("div",{className:"pb-4 px-4 container mx-auto",style:{paddingTop:`${r}px`},children:[(o==null?void 0:o.deletion_scheduled_for)&&n.jsx(_5,{deletionDate:o.deletion_scheduled_for,deletionType:o.deletion_type,refundAmount:o.prorated_refund_amount||0}),n.jsx(k5,{})]}),n.jsx("footer",{className:"bg-gray-800 border-t border-gray-700 mt-8 py-6",children:n.jsx("div",{className:"container mx-auto px-4 text-center text-sm text-gray-400",children:n.jsxs("div",{className:"space-x-4",children:[n.jsx("a",{href:"/about",className:"hover:text-orange-400 transition-colors",children:"About"}),n.jsx("span",{children:"Â·"}),n.jsx("a",{href:"/faq",className:"hover:text-orange-400 transition-colors",children:"FAQ"}),n.jsx("span",{children:"Â·"}),n.jsx("a",{href:"/terms",className:"hover:text-orange-400 transition-colors",children:"Terms"}),n.jsx("span",{children:"Â·"}),n.jsx("a",{href:"/privacy",className:"hover:text-orange-400 transition-colors",children:"Privacy"})]})})})]})};N0.createRoot(document.getElementById("root")).render(n.jsx(Ui.StrictMode,{children:n.jsx(k0,{children:n.jsx(C5,{})})}));export{kr as _};
//# sourceMappingURL=main.js.map
