const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/index.es-C4kvL-gH.js","js/radix-vendor--xiUtzSD.js","js/rateLimitHandler-ds6wyuiE.js","css/rateLimitHandler.css","js/dnd-vendor-CrjKgCyd.js"])))=>i.map(i=>d[i]);
var Kp=Object.defineProperty;var Xp=(r,t,e)=>t in r?Kp(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var kr=(r,t,e)=>Xp(r,typeof t!="symbol"?t+"":t,e);import{r as U,j as n,O as Pc,P as ch,C as Tc,b as Ic,T as Fc,D as Oc,c as dh,u as uh,W as Qp,d as e0,e as hh,f as t0,g as r0,R as Bi,h as n0,i as s0,k as a0,l as i0,m as fh,I as o0,n as l0,o as ph,V as c0,L as mh,p as gh,q as d0,s as u0,S as xh,t as h0,v as f0,w as Ro,x as p0}from"./radix-vendor--xiUtzSD.js";import{c as pr,a as $r,A as m0,B as Be,L as Hn,I as Dr,d as ze,b as Rr,C as Rc,s as en,e as cn,f as jn,g as dn,h as un,i as Td,j as Os,k as ms,l as gs,E as Do,m as Bo,R as g0,n as x0}from"./rateLimitHandler-ds6wyuiE.js";import{u as yl,C as bl,a as Dc,b as Di,D as al,c as il,S as ol,v as ll,d as cl,s as Bc,K as Mc,P as Uc}from"./dnd-vendor-CrjKgCyd.js";let Ml={},ta={user_id:null,subscription_tier:null,posthog_distinct_id:null};const y0=r=>{r&&r.authenticated?ta={user_id:r.user,subscription_tier:r.tier,posthog_distinct_id:r.posthog_distinct_id}:ta={user_id:null,subscription_tier:null,posthog_distinct_id:null}},Id=(r,t={})=>{if(typeof window<"u"&&window.posthog){const e=t.previous_page;if(e&&Ml[e]){const s=Date.now()-Ml[e];window.posthog.capture("page_time_spent",{page_name:e,time_spent_ms:s,time_spent_seconds:Math.round(s/1e3),next_page:r})}Ml[r]=Date.now(),window.posthog.capture("$pageview",{$current_url:`${window.location.origin}${window.location.pathname}#${r}`,$host:window.location.host,$pathname:window.location.pathname,$search:window.location.search,title:`Guitar Practice - ${r}`,page_name:r,spa_navigation:!0,viewport_width:window.innerWidth,viewport_height:window.innerHeight,screen_width:window.screen.width,screen_height:window.screen.height,...ta,...t})}},Mo=(r,t,e={})=>{if(typeof window<"u"&&window.posthog){const i={started_timer:"practice_timer_started",marked_done:"practice_item_completed",timer_reset:"practice_timer_reset",timer_stopped:"practice_timer_stopped"}[r]||r;window.posthog.capture(i,{item_name:t,timer_started:r==="started_timer",timer_stopped:r==="timer_stopped",timer_reset:r==="timer_reset",...ta,...e}),fetch("/api/user/practice-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_type:r,item_name:t,duration_seconds:e.duration_seconds,additional_data:e})}).catch(a=>console.error("Failed to log practice event:",a))}},Xs=(r,t,e={})=>{if(typeof window<"u"&&window.posthog){const s={added:"chord_chart_created",edited:"chord_chart_updated",deleted:"chord_chart_deleted",autocreated:"chord_charts_autocreated",copied:"chord_charts_copied",chord_chart_created:"chord_chart_created",chord_chart_updated:"chord_chart_updated",chord_chart_deleted:"chord_chart_deleted",autocreate_completed:"chord_charts_autocreated"};let i={};typeof t=="object"?i={...t,...e}:i={item_name:t,...e},window.posthog.capture(s[r]||r,{...ta,...i})}},co=(r,t,e,s={})=>{if(typeof window<"u"&&window.posthog){const i=t==="routine"?`routine_${r}`:`practice_item_${r}`;window.posthog.capture(i,{[`${t}_name`]:e,operation_type:r,item_type:t,...ta,...s})}},mc=(r,t,e=null,s={})=>{if(typeof window<"u"&&window.posthog){const i={item_added:"routine_item_added",item_removed:"routine_item_removed",activated:"routine_activated"},a={routine_name:t,operation_type:r,...s};e&&(a.item_name=e),window.posthog.capture(i[r]||r,{...a,...ta})}},Ul=(r,t,e={})=>{if(typeof window<"u"&&window.posthog){const s={notes:"item_notes_updated",tuning:"item_tuning_updated",folder_path:"item_folder_path_updated"};window.posthog.capture(s[r]||`item_${r}_updated`,{item_name:t,update_type:r,...ta,...e})}},Fd=(r,t,e={})=>{typeof window<"u"&&window.posthog&&window.posthog.capture("songbook_folder_link_clicked",{item_name:r,songbook_folder_path:t,...ta,...e})},b0=(r,t={})=>{typeof window<"u"&&window.posthog&&(window.posthog.capture("practice_page_viewed",{active_routine_name:r,...ta,...t}),fetch("/api/user/practice-events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({event_type:"practice_page_visited",routine_name:r,additional_data:t})}).catch(e=>console.error("Failed to log practice event:",e)))},yh=U.createContext(void 0),w0=({children:r})=>{const t=()=>{let a=window.location.hash.slice(1).split("?")[0];const d=["Practice","Routines","Items","Account"];if(!d.includes(a)){const o=sessionStorage.getItem("gpra_login_redirect_hash");if(o){sessionStorage.removeItem("gpra_login_redirect_hash");const c=o.replace("#","").split("?")[0];if(d.includes(c))return window.history.replaceState(null,"",`/${o}`),c}}return d.includes(a)?a:"Practice"},[e,s]=U.useState(t);U.useEffect(()=>{const a=setTimeout(()=>{Id(e,{initial_page_load:!0,referrer:document.referrer})},100);return()=>clearTimeout(a)},[]);const i=(a,d=!0)=>{const o=e;s(a),Id(a,{previous_page:o,navigation_type:d?"user_action":"browser_navigation",timestamp:new Date().toISOString()}),d&&window.history.pushState(null,"",`#${a}`)};return U.useEffect(()=>{const a=()=>{const d=t();i(d,!1)};return window.addEventListener("popstate",a),()=>{window.removeEventListener("popstate",a)}},[]),n.jsx(yh.Provider,{value:{activePage:e,setActivePage:i},children:r})},Mi=()=>{const r=U.useContext(yh);if(r===void 0)throw new Error("useNavigation must be used within a NavigationProvider");return r},Bn=pr("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),v0=pr("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]),bh=pr("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),_n=pr("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Qn=pr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),ps=pr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),zl=pr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),wh=pr("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Zs=pr("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),vh=pr("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),Nh=pr("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),wl=pr("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),N0=pr("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),_0=pr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),_h=pr("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]),j0=pr("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),uo=pr("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),Od=pr("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),mo=pr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),jh=pr("Printer",[["polyline",{points:"6 9 6 2 18 2 18 9",key:"1306q4"}],["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["rect",{width:"12",height:"8",x:"6",y:"14",key:"5ipwut"}]]),S0=pr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),k0=pr("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),C0=pr("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),dl=pr("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),A0=pr("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),Sh=pr("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),kh=pr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),Ei=pr("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),L0=pr("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),gc=pr("Wand",[["path",{d:"M15 4V2",key:"z1p9b7"}],["path",{d:"M15 16v-2",key:"px0unx"}],["path",{d:"M8 9h2",key:"1g203m"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M17.8 11.8 19 13",key:"yihg8r"}],["path",{d:"M15 9h0",key:"kg5t1u"}],["path",{d:"M17.8 6.2 19 5",key:"fd4us0"}],["path",{d:"m3 21 9-9",key:"1jfql5"}],["path",{d:"M12.2 6.2 11 5",key:"i3da3b"}]]),E0=pr("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Gr=pr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),P0=pr("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Ch=()=>{if(typeof window>"u")return"unknown";const r=window.navigator.userAgent.toLowerCase();return r.includes("android")?"android":r.includes("iphone")||r.includes("ipad")||r.includes("ipod")?"ios":r.includes("mac")?"macos":r.includes("win")?"windows":r.includes("linux")?"linux":"unknown"},Ah=()=>{const r=Ch();return["windows","macos","linux"].includes(r)},Ni=()=>{if(typeof window>"u")return!1;const r=window.navigator.userAgent.toLowerCase(),t=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(r),e="ontouchstart"in window||navigator.maxTouchPoints>0,s=window.innerWidth<=768;return t||e&&s},T0=()=>{const r=Ch();return r==="windows"?"Windows Explorer":r==="macos"?"Finder":"File Manager"},I0=r=>{if(!r)return!1;const t=r.trim().toLowerCase();return t.startsWith("http://")||t.startsWith("https://")},es=dh,F0=ch,Lh=U.forwardRef(({className:r,...t},e)=>n.jsx(Pc,{ref:e,className:$r("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t}));Lh.displayName=Pc.displayName;const Vn=U.forwardRef(({className:r,children:t,...e},s)=>n.jsxs(F0,{children:[n.jsx(Lh,{}),n.jsxs(Tc,{ref:s,className:$r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...e,children:[t,n.jsxs(Ic,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[n.jsx(Gr,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Vn.displayName=Tc.displayName;const Gn=({className:r,...t})=>n.jsx("div",{className:$r("flex flex-col space-y-1.5 text-center sm:text-left",r),...t});Gn.displayName="DialogHeader";const xc=({className:r,...t})=>n.jsx("div",{className:$r("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});xc.displayName="DialogFooter";const Yn=U.forwardRef(({className:r,...t},e)=>n.jsx(Fc,{ref:e,className:$r("text-lg font-semibold leading-none tracking-tight",r),...t}));Yn.displayName=Fc.displayName;const ts=U.forwardRef(({className:r,...t},e)=>n.jsx(Oc,{ref:e,className:$r("text-sm text-muted-foreground",r),...t}));ts.displayName=Oc.displayName;const Pi=U.forwardRef(({className:r,...t},e)=>n.jsx("textarea",{className:$r("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",r),ref:e,...t}));Pi.displayName="Textarea";const Eh=({isOpen:r,onClose:t,limitType:e,currentTier:s,currentCount:i,limitAmount:a})=>{if(!r)return null;const d=()=>e==="routines"?`Your plan only includes ${a} routine${a!==1?"s":""}, you're at the max. Pick a button:`:`Your plan only includes ${a} item${a!==1?"s":""}, you're at the max. Pick a button:`,o=()=>{t(),window.location.hash="#Account",setTimeout(()=>{const c=document.getElementById("subscription-plans");if(c){const p=c.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:p,behavior:"smooth"})}},100)};return n.jsx(es,{open:r,onOpenChange:c=>!c&&t(),children:n.jsxs(Vn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Yn,{className:"flex items-center gap-2 text-xl",children:[n.jsx(m0,{className:"h-6 w-6 text-amber-500"}),"Oops!"]}),n.jsx(ts,{className:"text-left space-y-3 text-base mt-4",children:n.jsx("div",{className:"text-gray-700 dark:text-gray-300",children:d()})})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx(Be,{onClick:o,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition-colors",children:"Upgrade"}),n.jsx(Be,{onClick:t,className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded transition-colors dark:bg-gray-600 dark:hover:bg-gray-700 dark:text-gray-200",children:"Nope"})]})]})})},zc=r=>{if(!r)return"";const t=r.split(`
`),e=[];let s=!1;for(let i of t){let a=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");const d=a.match(/^(#{1,6})\s+(.+)$/);if(d){const h=d[1].length,p=d[2],b={1:"text-2xl font-bold",2:"text-xl font-bold",3:"text-lg font-semibold",4:"text-base font-semibold",5:"text-sm font-semibold",6:"text-sm font-medium"};s&&(e.push("</ul>"),s=!1),e.push(`<h${h} class="${b[h]} mt-2 mb-1">${Uo(p)}</h${h}>`);continue}const o=a.match(/^[-*]\s+(.+)$/);if(o){s||(e.push('<ul class="list-disc list-inside ml-2">'),s=!0),e.push(`<li>${Uo(o[1])}</li>`);continue}const c=a.match(/^\d+\.\s+(.+)$/);if(c){s||(e.push('<ol class="list-decimal list-inside ml-2">'),s=!0),e.push(`<li>${Uo(c[1])}</li>`);continue}if(s&&(e.push(s==="ol"?"</ol>":"</ul>"),s=!1),a.trim()===""){e.push("<br />");continue}e.push(`<p>${Uo(a)}</p>`)}return s&&e.push("</ul>"),e.join("")},Uo=r=>{let t=r;return t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/__(.+?)__/g,"<strong>$1</strong>"),t=t.replace(/\*(.+?)\*/g,"<em>$1</em>"),t=t.replace(/_(.+?)_/g,"<em>$1</em>"),t=t.replace(/`(.+?)`/g,'<code class="bg-gray-700 px-1 rounded">$1</code>'),t=t.replace(/\[(.+?)\]\((.+?)\)/g,'<a href="$2" class="text-blue-400 underline" target="_blank" rel="noopener noreferrer">$1</a>'),t},O0=({open:r,onOpenChange:t,itemId:e,currentNote:s="",onNoteSave:i})=>{const[a,d]=U.useState(""),[o,c]=U.useState(null),[h,p]=U.useState(!1),[b,m]=U.useState(!1),u=U.useRef("");U.useEffect(()=>{r&&(d(s),u.current=s,c(null),p(!1),m(!1))},[r,s]);const w=()=>a!==u.current&&a.trim()!=="",g=()=>{w()?p(!0):t(!1)},N=async y=>{y&&y.preventDefault();try{const S=await fetch(`/api/items/${e}/notes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notes:a})});if(!S.ok)throw new Error("Failed to save note");const L=await S.json();u.current=a,i==null||i(a),p(!1),t(!1)}catch(S){c(S.message),console.error("Save error:",S)}};return n.jsxs(n.Fragment,{children:[n.jsx(es,{open:r,onOpenChange:y=>{y?t(!0):g()},children:n.jsxs(Vn,{className:"max-w-2xl bg-gray-800",children:[n.jsxs(Gn,{children:[n.jsx(Yn,{children:"Edit note"}),n.jsx(ts,{children:"Add or edit your practice notes (markdown supported)"}),o&&n.jsx("div",{className:"mt-2 text-sm text-red-500",children:o})]}),n.jsxs("form",{onSubmit:N,className:"space-y-4",children:[n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{type:"button",variant:b?"outline":"default",size:"sm",onClick:()=>m(!1),children:"Edit"}),n.jsx(Be,{type:"button",variant:b?"default":"outline",size:"sm",onClick:()=>m(!0),children:"Preview"})]}),b?n.jsx("div",{className:"h-48 bg-gray-900 text-white p-3 rounded-md overflow-auto",dangerouslySetInnerHTML:{__html:zc(a)}}):n.jsx(Pi,{value:a,onChange:y=>d(y.target.value),placeholder:"Enter your notes... (markdown supported)",className:"h-48 bg-gray-900 text-white",autoComplete:"off"}),n.jsxs("div",{className:"flex justify-end space-x-4",children:[n.jsx(Be,{type:"button",variant:"outline",onClick:g,children:"Cancel"}),n.jsx(Be,{type:"submit",variant:"outline",children:"Save note"})]})]})]})}),n.jsx(es,{open:h,onOpenChange:p,children:n.jsxs(Vn,{className:"max-w-md bg-gray-800",children:[n.jsxs(Gn,{children:[n.jsx(Yn,{children:"Unsaved changes"}),n.jsx(ts,{children:"Are you sure you want to lose what you typed?"})]}),n.jsxs("div",{className:"flex justify-end space-x-3 mt-4",children:[n.jsx(Be,{variant:"outline",onClick:()=>p(!1),children:"Keep editing"}),n.jsx(Be,{variant:"outline",className:"text-red-400 hover:text-red-300",onClick:()=>{p(!1),t(!1)},children:"Lose it"}),n.jsx(Be,{variant:"default",onClick:N,children:"Save it"})]})]})})]})},R0=({open:r,onOpenChange:t,item:e=null,onItemChange:s})=>{const[i,a]=U.useState({C:"",D:"",E:5,F:"",G:"",H:"",I:""}),[d,o]=U.useState(null),[c,h]=U.useState(!1),[p,b]=U.useState(!1),[m,u]=U.useState(!1),[w,g]=U.useState({limitType:"items",currentTier:"free",currentCount:0,limitAmount:15});U.useEffect(()=>{r&&(e?e.D!==void 0||e.H!==void 0?(a({C:e.C||"",D:e.D||"",E:e.E||5,F:e.F||"",G:e.G||"",H:e.H||"",I:e.I||""}),o(null),h(!1),b(!1)):N(e.A):(a({C:"",D:"",E:5,F:"",G:"",H:"",I:""}),o(null),h(!1),b(!1)))},[r,e]);const N=async L=>{try{const E=await fetch(`/api/items/${L}`);if(!E.ok)throw new Error("Failed to fetch item details");const I=await E.json();a({C:I.C||"",D:I.D||"",E:I.E||5,F:I.F||"",G:I.G||"",H:I.H||"",I:I.I||""}),o(null),h(!1)}catch(E){o(`Failed to load item: ${E.message}`),console.error("Fetch item error:",E)}},y=(L,E)=>{a(I=>({...I,[L]:E})),h(!0)},S=async L=>{L.preventDefault();try{const{G:E,...I}=i,K="/api/items",Y=e!=null&&e.A?`${K}/${e.A}`:K,V=await fetch(Y,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});if(!V.ok){const k=await V.json().catch(()=>null);if(V.status===403&&(k==null?void 0:k.error)==="Item limit reached"){g({limitType:"items",currentTier:k.tier||"free",currentCount:k.current||0,limitAmount:k.limit||15}),u(!0);return}throw new Error((k==null?void 0:k.error)||"Failed to save item")}const O=await V.json(),Q=!(e!=null&&e.A),F=i.C||"Unnamed Item";if(Q)co("created","item",F);else{co("updated","item",F);const k=(e==null?void 0:e.D)||"",M=(e==null?void 0:e.H)||"",_=(e==null?void 0:e.I)||"";i.D&&i.D!==k&&Ul("notes",F),i.H&&i.H!==M&&Ul("tuning",F),i.I&&i.I!==_&&Ul("folder_path",F)}s==null||s(O),t(!1)}catch(E){o(E.message),console.error("Save error:",E)}};return n.jsxs(n.Fragment,{children:[n.jsx(es,{open:r,onOpenChange:t,children:n.jsxs(Vn,{className:"max-w-2xl bg-gray-800",children:[n.jsxs(Gn,{children:[n.jsx(Yn,{children:e?`Edit item: ${e.C}`:"Create new item"}),d&&n.jsx("div",{className:"mt-2 text-sm text-red-500",role:"alert",children:d})]}),n.jsxs("form",{onSubmit:S,className:"space-y-6",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"title",children:"Title"}),n.jsx(Dr,{id:"title",value:i.C,onChange:L=>y("C",L.target.value),placeholder:"Enter item title",required:!0,className:"bg-gray-900 text-white",autoComplete:"off"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"duration",children:"Duration"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex-1",children:[n.jsx(Dr,{id:"duration-minutes",type:"number",min:"0",max:"999",value:Math.floor(i.E),onChange:L=>{const E=parseInt(L.target.value)||0,I=i.E%1*60;y("E",E+I/60)},onInput:L=>{const E=parseInt(L.target.value)||0,I=i.E%1*60;y("E",E+I/60)},className:"bg-gray-900 text-white text-center",autoComplete:"off",placeholder:"0"}),n.jsx("div",{className:"text-xs text-gray-400 text-center mt-1",children:"minutes"})]}),n.jsx("span",{className:"text-xl text-gray-400",children:":"}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{id:"duration-seconds",type:"text",inputMode:"numeric",pattern:"[0-9]*",value:Math.round(i.E%1*60),onChange:L=>{const E=L.target.value.replace(/[^0-9]/g,""),I=Math.min(59,parseInt(E)||0),K=Math.floor(i.E);y("E",K+I/60)},className:"bg-gray-900 text-white text-center pr-6",autoComplete:"off",placeholder:"00"}),n.jsxs("div",{className:"absolute right-0 top-0 flex flex-col h-full border-l border-gray-700",children:[n.jsx("button",{type:"button",onClick:()=>{const L=Math.round(i.E%1*60),E=Math.min(59,L+15),I=Math.floor(i.E);y("E",I+E/60)},className:"flex-1 px-1 text-gray-400 hover:text-white hover:bg-gray-700 text-xs leading-none","aria-label":"Increase seconds by 15","data-ph-capture-attribute-button":"duration-seconds-up",children:"â–²"}),n.jsx("button",{type:"button",onClick:()=>{const L=Math.round(i.E%1*60),E=Math.max(0,L-15),I=Math.floor(i.E);y("E",I+E/60)},className:"flex-1 px-1 text-gray-400 hover:text-white hover:bg-gray-700 text-xs leading-none border-t border-gray-700","aria-label":"Decrease seconds by 15","data-ph-capture-attribute-button":"duration-seconds-down",children:"â–¼"})]})]}),n.jsx("div",{className:"text-xs text-gray-400 text-center mt-1",children:"seconds"})]})]}),n.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Total: ",Math.floor(i.E)," min ",Math.round(i.E%1*60)," sec"]})]}),Ah()&&n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"songbook",children:"Songbook folder or link"}),n.jsx(Dr,{id:"songbook",value:i.I,onChange:L=>y("I",L.target.value),placeholder:'e.g.: "C:\\Users\\...\\SongName" or "https://tabs.ultimate-guitar.com/..."',className:"bg-gray-900 font-mono"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"tuning",children:"Tuning"}),n.jsx(Dr,{id:"tuning",value:i.H,onChange:L=>y("H",L.target.value),placeholder:"e.g. EADGBE",className:"bg-gray-900 text-white",autoComplete:"off"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(Hn,{htmlFor:"notes",children:["Notes ",n.jsx("span",{className:"text-gray-500 font-normal",children:"(markdown supported)"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{type:"button",variant:p?"outline":"default",size:"sm",onClick:()=>b(!1),"data-ph-capture-attribute-button":"notes-edit-mode",children:"Edit"}),n.jsx(Be,{type:"button",variant:p?"default":"outline",size:"sm",onClick:()=>b(!0),"data-ph-capture-attribute-button":"notes-preview-mode",children:"Preview"})]})]}),p?n.jsx("div",{className:"h-24 bg-gray-900 text-white p-3 rounded-md overflow-auto",dangerouslySetInnerHTML:{__html:zc(i.D)}}):n.jsx(Pi,{id:"notes",value:i.D,onChange:L=>y("D",L.target.value),placeholder:"Enter any notes... (markdown supported)",className:"h-24 bg-gray-900 text-white",autoComplete:"off"})]}),n.jsxs("div",{className:"flex justify-end space-x-4",children:[n.jsx(Be,{type:"button",variant:"outline",onClick:()=>t(!1),className:"text-gray-300 hover:text-white","data-ph-capture-attribute-button":"item-editor-cancel",children:"Cancel"}),n.jsx(Be,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",disabled:!c,"data-ph-capture-attribute-button":"item-editor-save",children:"Save"})]})]})]})}),r&&n.jsx(Eh,{isOpen:m,onClose:()=>u(!1),limitType:w.limitType,currentTier:w.currentTier,currentCount:w.currentCount,limitAmount:w.limitAmount})]})},Ph=()=>{const[r,t]=U.useState([]),[e,s]=U.useState(!0),[i,a]=U.useState(null),[d,o]=U.useState(0),c=async()=>{try{const w=await fetch("/api/items");if(!w.ok)throw new Error("Failed to fetch items");const g=await w.json();t(g),a(null)}catch(w){a(w.message),console.error("Fetch error:",w)}finally{s(!1)}},h=async()=>{o(w=>w+1)},p=async w=>{try{if(!(await fetch(`/api/items/${w}`,{method:"DELETE"})).ok)throw new Error("Failed to delete item");t(N=>N.filter(y=>y.A!==w)),await h()}catch(g){throw a(g.message),console.error("Delete error:",g),g}},b=async w=>{try{const g=await fetch("/api/items",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(!g.ok)throw new Error("Failed to add item");const N=await g.json();return t([...r,N]),N}catch(g){throw a(g.message),g}},m=async(w,g)=>{try{const N=await fetch(`/api/items/${w}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)});if(!N.ok)throw new Error("Failed to update item");const y=await N.json();return t(r.map(S=>S.A===w?y:S)),y}catch(N){throw a(N.message),N}},u=async w=>{try{const g=await fetch("/api/items/order",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(w)});if(!g.ok)throw new Error("Failed to update items");const N=await g.json();return t(N),await h(),N}catch(g){throw a(g.message),console.error("Update error:",g),g}};return U.useEffect(()=>{c()},[d]),{items:r,loading:e,error:i,addItem:b,updateItem:m,deleteItem:p,updateItems:u,refreshItems:h}},D0={strings:6,frets:5,fretSize:1.2,fingerSize:.75,sidePadding:.2,fontFamily:"Arial",width:128,height:176,color:"#ffffff",backgroundColor:"transparent",strokeColor:"#ffffff",textColor:"#ffffff",fretLabelColor:"#ffffff",fingerTextColor:"#000000",fingerTextSize:28},ql=async(r,t={},e=3,s=null)=>{for(let i=0;i<e;i++)try{const a=await fetch(r,t);if(a.status===429){const d=Math.pow(2,i)*1e3,o=`Rate limited. Waiting ${d/1e3}s before retry ${i+1}/${e}`;s&&s(o),await new Promise(c=>setTimeout(c,d));continue}return a}catch(a){if(i===e-1)throw a;const d=Math.pow(2,i)*1e3,o=`Request failed. Waiting ${d/1e3}s before retry ${i+1}/${e}`;s&&s(o),await new Promise(c=>setTimeout(c,d))}throw new Error(`Failed after ${e} attempts`)},Th=({itemId:r,onSave:t,onCancel:e,editingChordId:s=null,insertionContext:i=null,defaultTuning:a="EADGBE"})=>{const[d,o]=U.useState(""),[c,h]=U.useState(1),[p,b]=U.useState(5),[m,u]=U.useState(6),[w,g]=U.useState("dots");U.useEffect(()=>{H.current=w},[w]);const[N,y]=U.useState(a),[S,L]=U.useState(0),[E,I]=U.useState([]),[K,Y]=U.useState([]);U.useEffect(()=>{},[K]);const[V,O]=U.useState(new Set),[Q,F]=U.useState(new Set),[k,M]=U.useState(!1),[_,te]=U.useState(!1),[ae,re]=U.useState(null),[se,ie]=U.useState(!1),je=U.useRef(null),ne=U.useRef(null),A=U.useRef(null),H=U.useRef(w),Z=U.useRef(null),X=async G=>{if(!(!G.trim()||!r))try{M(!0);const $=await ql(`/api/items/${r}/chord-charts`,{},3,1e3);if(!$.ok)return;const B=(await $.json()).filter(me=>me.title.toLowerCase()===G.toLowerCase());let he;if(B.length===0)try{await new Promise(de=>setTimeout(de,1e3));const me=await ql(`/api/chord-charts/common/search?name=${encodeURIComponent(G)}`,{},3,1e3);if(me.ok){const de=await me.json();de.length>0&&(he=de[0])}}catch(me){console.error("Error fetching common chords:",me)}else B.length===1||B.sort((me,de)=>{const Le=parseInt(me.order)||0,Ie=parseInt(de.order)||0;return Le!==Ie?Le-Ie:(parseInt(me.id)||0)-(parseInt(de.id)||0)}),he=B[0];if(he){h(he.startingFret||1),b(he.numFrets||5),u(he.numStrings||6),y(he.tuning||a),L(he.capo||0);const de=(he.fingers||[]).map(Ie=>{if(Array.isArray(Ie)){const[at,lt,bt]=Ie;return[at,lt,bt]}if(Ie&&typeof Ie=="object"&&"string"in Ie&&"fret"in Ie){const at=Ie.fingerNumber||Ie[2];return[Ie.string,Ie.fret,at]}const[Te,Ye,ft]=Array.isArray(Ie)?Ie:[Ie[0],Ie[1],Ie[2]];return[Te,Ye,ft]});I(de);const Le=he.barres||[];Y(Le),O(new Set(he.openStrings||[])),F(new Set(he.mutedStrings||[])),ie(!1)}}catch($){console.error("Error during autofill:",$)}finally{M(!1)}};U.useEffect(()=>{s&&r?(async()=>{try{M(!0);const $=await ql(`/api/items/${r}/chord-charts`);if($.ok){const B=(await $.json()).find(he=>parseInt(he.id)===parseInt(s));if(B){ze("ChordEditor","Loading chord for editing:",{id:B.id,title:B.title,hasLineBreakAfter:B.hasLineBreakAfter,editingChordId:s}),o(B.title||""),h(B.startingFret||1),b(B.numFrets||5),u(B.numStrings||6),y(B.tuning||a),L(B.capo||0);const me=(B.fingers||[]).map(Ie=>{if(Array.isArray(Ie)){const[at,lt,bt]=Ie;return[at,lt,bt]}if(Ie&&typeof Ie=="object"&&"string"in Ie&&"fret"in Ie){const at=Ie.fingerNumber||Ie[2];return[Ie.string,Ie.fret,at]}const[Te,Ye,ft]=Array.isArray(Ie)?Ie:[Ie[0],Ie[1],Ie[2]];return[Te,Ye,ft]});I(me);const de=B.barres||[];Y(de),O(new Set(B.openStrings||[])),F(new Set(B.mutedStrings||[]));const Le=B.hasLineBreakAfter||!1;ze("ChordEditor","Setting addLineBreak to:",Le,"from hasLineBreakAfter:",B.hasLineBreakAfter),ie(Le)}}else console.error("Failed to fetch chord charts:",$.status)}catch($){console.error("Error loading chord for editing:",$)}finally{M(!1)}})():s||(o(""),h(1),b(5),u(6),y(a),L(0),I([]),Y([]),O(new Set),F(new Set),te(!1),ie(!1))},[s,r,a]),U.useEffect(()=>{if(window.svguitar)pe();else{const G=document.createElement("script");G.src="/static/js/svguitar.es5.js",G.async=!0,G.onload=()=>{pe()},document.body.appendChild(G)}return()=>{ve.current&&ve.current.svg&&(ve.current.svg.removeEventListener("click",ve.current.clickHandler),ve.current.svg.removeEventListener("mousedown",ve.current.mousedownHandler))}},[]);const pe=()=>{try{je.current=new window.svguitar.SVGuitarChord("#editor-chart"),ne.current=new window.svguitar.SVGuitarChord("#result-chart"),P(),ke()}catch(G){console.error("Error initializing charts:",G)}},ve=U.useRef(null),ke=()=>{if(!A.current)return;const G=A.current.querySelector("svg");if(!G)return;ve.current&&ve.current.svg&&(ve.current.svg.removeEventListener("click",ve.current.clickHandler),ve.current.svg.removeEventListener("mousedown",ve.current.mousedownHandler));const $=B=>{if(B.detail>1)return B.preventDefault(),B.stopPropagation(),!1;B.preventDefault()},z=B=>{B.stopPropagation(),B.preventDefault(),Ae(B)};G.style.userSelect="none",G.style.webkitUserSelect="none",G.style.mozUserSelect="none",G.style.msUserSelect="none",G.addEventListener("mousedown",$),G.addEventListener("click",z),ve.current={svg:G,clickHandler:z,mousedownHandler:$}},Ae=G=>{if(!G||!G.currentTarget){console.error("handleEditorClick called with invalid event");return}const $=H.current;if($!=="dots"&&$!=="fingers"&&$!=="barres")return;const z=G.currentTarget,B=z.getBoundingClientRect(),he=G.clientX-B.left,me=G.clientY-B.top,de=z.viewBox.baseVal;if(!de||de.width===0||de.height===0||B.width===0||B.height===0)return;const Le=de.width/B.width,Ie=de.height/B.height;if(!isFinite(Le)||!isFinite(Ie)){console.error("Invalid scale values:",{scaleX:Le,scaleY:Ie});return}const Te=he*Le,Ye=me*Ie,ft=de.width,at=de.height,lt=ft*.15,bt=at*.08,ut=ft-lt*2,Yt=at-bt*2;if(Te<lt||Te>ft-lt)return;const Et=(Te-lt)/ut,qt=Math.floor(Et*m);if(qt<0||qt>=m)return;const Pt=m-qt;if(Ye<bt){Me(Pt);return}if(Ye>at-bt)return;const vt=Ye-bt,Zt=vt/Yt,_t=Math.ceil(Zt*p);ze("ChordEditor","Click debug:",{rawX:he,rawY:me,x:Te,y:Ye,svguitarString:Pt,fretIndex:_t,marginX:lt,marginY:bt,fretRatio:Zt,relativeY:vt,fretboardHeight:Yt}),!(_t<1||_t>p)&&($==="dots"?De(Pt,_t):$==="fingers"?Se(Pt,_t):$==="barres"&&Ke(Pt,_t))},De=(G,$)=>{O(z=>{const B=new Set(z);return B.delete(G),B}),F(z=>{const B=new Set(z);return B.delete(G),B}),I(z=>{const B=z.findIndex(he=>{const[me,de]=he;return me===G&&de===$});return B>=0?z.filter((me,de)=>de!==B):[...z,[G,$,void 0]]})},Me=G=>{const $=V.has(G),z=Q.has(G);I(B=>B.filter(([he])=>he!==G)),!$&&!z?O(B=>new Set([...B,G])):$?(O(B=>{const he=new Set(B);return he.delete(G),he}),F(B=>new Set([...B,G]))):z&&F(B=>{const he=new Set(B);return he.delete(G),he})},Ke=(G,$)=>{Y(z=>{const B=z.findIndex(he=>he.fret===$);if(B>=0)return z.filter((me,de)=>de!==B);{const he={fromString:6,toString:1,fret:$,text:"1"};return[...z,he]}})},Se=(G,$)=>{E.findIndex(B=>{const[he,me]=B;return he===G&&me===$})===-1?(O(B=>{const he=new Set(B);return he.delete(G),he}),F(B=>{const he=new Set(B);return he.delete(G),he}),I(B=>[...B,[G,$,void 0]]),re([G,$])):re([G,$])},j=(G,$,z)=>{I(B=>B.map(he=>{const[me,de,Le]=he;return me===G&&de===$?[me,de,z]:he.length===3?he:[me,de,Le]}))},P=()=>{if(!je.current||!ne.current)return;const G=document.querySelector("#editor-chart"),$=document.querySelector("#result-chart");if(!(!G||!$))try{const z={...D0,strings:m,frets:p,position:c,tuning:[]},me={fingers:[...E.map(Ie=>{const[Te,Ye,ft]=Ie;return ft&&ft!=="undefined"?[Te,Ye,ft]:[Te,Ye]}),...Array.from(V).map(Ie=>[Ie,0]),...Array.from(Q).map(Ie=>[Ie,"x"])],barres:K},de=JSON.stringify({chordData:me,title:d});de!==Z.current&&(Z.current=de,je.current.configure(z).chord(me).draw(),ne.current.configure({...z,title:d}).chord(me).draw()),setTimeout(()=>{const Ie=document.querySelector("#editor-chart svg"),Te=document.querySelector("#result-chart svg");Ie&&(Ie.style.width="100%",Ie.style.height="100%",Ie.style.maxWidth="128px",Ie.style.maxHeight="180px"),Te&&(Te.style.width="100%",Te.style.height="100%",Te.style.maxWidth="128px",Te.style.maxHeight="180px"),ke()},100)}catch(z){console.error("Error updating charts:",z)}};return U.useEffect(()=>{P()},[d,c,p,m,E,K,N,V,Q]),U.useEffect(()=>{const G=$=>{if(w!=="fingers"||!ae)return;const z=$.key;if(["1","2","3","4","5"].includes(z)){const[B,he]=ae;j(B,he,z),re(null),$.preventDefault()}else z==="Escape"&&(re(null),$.preventDefault())};if(w==="fingers")return document.addEventListener("keydown",G),()=>document.removeEventListener("keydown",G)},[w,ae]),n.jsx("div",{className:"bg-gray-800 rounded-lg p-4",children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-blue-400 mb-1",children:"Chord name"}),n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{value:d,onChange:G=>o(G.target.value),onBlur:()=>X(d),onKeyDown:G=>{G.key==="Enter"&&!G.shiftKey&&(G.preventDefault(),X(d))},placeholder:"Enter chord name (e.g. Am, C7) then hit 'Enter'",className:"bg-gray-900",disabled:k}),k&&n.jsxs("div",{className:"absolute right-2 top-2 text-yellow-400 text-xs",role:"status","aria-live":"polite",children:[n.jsx("span",{className:"sr-only",children:"Loading chord data"}),n.jsx("span",{"aria-hidden":"true",children:"Loading..."})]})]})]}),n.jsx("div",{className:"text-sm text-blue-400 hover:underline cursor-pointer",onClick:()=>te(!_),children:_?"Hide advanced settings...":"Show more settings..."}),_&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Tuning"}),n.jsx(Dr,{value:N,onChange:G=>y(G.target.value),placeholder:"EADGBE",className:"bg-gray-900"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Capo"}),n.jsx(Dr,{type:"number",min:"0",max:"12",value:S,onChange:G=>L(parseInt(G.target.value)||0),className:"bg-gray-900"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Starting fret"}),n.jsx(Dr,{type:"number",min:"1",max:"15",value:c,onChange:G=>h(parseInt(G.target.value)||1),className:"bg-gray-900"})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Number of frets"}),n.jsx(Dr,{type:"number",min:"1",max:"10",value:p,onChange:G=>b(parseInt(G.target.value)||5),className:"bg-gray-900"})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-sm text-white mb-1",children:"Number of strings"}),n.jsx(Dr,{type:"number",min:"4",max:"12",value:m,onChange:G=>u(parseInt(G.target.value)||6),className:"bg-gray-900"})]})]})]}),n.jsxs("div",{className:"flex gap-8 justify-center",children:[n.jsxs("div",{children:[n.jsx("div",{className:"text-lg text-white mb-2",children:"Editor"}),n.jsx("div",{className:"border border-gray-700 rounded-lg px-1 pt-1 pb-0",children:n.jsx("div",{className:"relative w-32 mx-auto flex items-center justify-center overflow-hidden select-none",style:{height:"184px"},children:n.jsx("div",{id:"editor-chart",ref:A,className:"cursor-pointer select-none"})})})]}),n.jsxs("div",{children:[n.jsx("div",{className:"text-lg text-white mb-2",children:"Result"}),n.jsx("div",{className:"border border-gray-700 rounded-lg px-1 pt-1 pb-0",children:n.jsx("div",{className:"relative w-32 mx-auto flex items-center justify-center overflow-hidden select-none",style:{height:"184px"},children:n.jsx("div",{id:"result-chart",className:"select-none"})})})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{variant:w==="dots"?"default":"outline",onClick:()=>g("dots"),className:`flex-1 ${w==="dots"?"bg-blue-700 hover:bg-blue-800 text-white":"bg-black hover:bg-gray-800 text-gray-300 border border-gray-600"}`,"data-ph-capture-attribute-button":"chord-editor-dots-mode",children:"Edit dots"}),n.jsx(Be,{variant:w==="fingers"?"default":"outline",onClick:()=>{g("fingers")},className:`flex-1 ${w==="fingers"?"!bg-blue-800 hover:!bg-blue-900 !text-white !border !border-blue-600":"!bg-black hover:!bg-gray-800 !text-gray-300 !border !border-gray-600"}`,"data-ph-capture-attribute-button":"chord-editor-fingers-mode",children:"Edit fingers"}),n.jsx(Be,{variant:w==="barres"?"default":"outline",onClick:()=>g("barres"),className:`flex-1 ${w==="barres"?"!bg-green-700 hover:!bg-green-800 !text-white !border !border-green-600":"!bg-black hover:!bg-gray-800 !text-gray-300 !border !border-gray-600"}`,"data-ph-capture-attribute-button":"chord-editor-barres-mode",children:"Edit barres"})]}),w==="dots"&&n.jsx("div",{className:"bg-gray-700 bg-opacity-50 border border-gray-600 rounded-lg p-3 text-sm text-gray-200",children:"Click on a string above the fret where you want to add a dot"}),w==="barres"&&n.jsx("div",{className:"bg-green-900 bg-opacity-50 border border-green-600 rounded-lg p-3 text-sm text-green-200",children:"Click on any fret to add/remove a full barre across all strings at that fret. Perfect for chords like F, B, F#m, etc."}),w==="fingers"&&n.jsxs("div",{className:"bg-blue-900 bg-opacity-50 border border-blue-600 rounded-lg p-3 text-sm text-blue-200",children:["Click on a finger position, then press 1-5 keys to assign finger numbers (5 = thumb). Press Escape to cancel selection.",ae&&n.jsxs("div",{className:"mt-2 text-yellow-300",children:["Selected position: String ",ae[0],", Fret ",ae[1]," - Press 1, 2, 3, 4, or 5"]})]}),n.jsxs("div",{className:"flex items-center space-x-2 bg-gray-700 rounded-lg p-3",children:[n.jsx("input",{type:"checkbox",id:"addLineBreak",checked:se,onChange:G=>ie(G.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-900 border-gray-600 rounded focus:ring-blue-500 focus:ring-2"}),n.jsx("label",{htmlFor:"addLineBreak",className:"text-sm text-gray-300 cursor-pointer",children:"Line break after â†©ï¸"})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{onClick:()=>{const G={title:d,startingFret:c,numFrets:p,numStrings:m,tuning:N,capo:S,fingers:E,barres:K,openStrings:Array.from(V),mutedStrings:Array.from(Q),startOnNewLine:se,editingChordId:s,insertionContext:i};ze("ChordEditor","Saving chord with line break data:",{title:d,addLineBreak:se,startOnNewLine:se,editingChordId:s}),t(G)},className:`flex-1 ${d.trim()?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-600 text-gray-400 cursor-not-allowed"}`,disabled:!d.trim(),"data-ph-capture-attribute-button":s?"chord-editor-update":"chord-editor-save",children:s?"Update chord chart":"Add chord chart"}),e&&n.jsx(Be,{onClick:e,variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-700","data-ph-capture-attribute-button":"chord-editor-cancel",children:"Cancel"})]})]})})},qc="gpra_rate_limit_backoff",B0=15,M0=120,Ih=()=>{try{const r=localStorage.getItem(qc);if(r){const t=JSON.parse(r);return Date.now()-t.timestamp>300*1e3?0:t.level||0}}catch(r){console.warn("Error reading backoff level:",r)}return 0},U0=()=>{try{const r=Ih(),t=Math.min(r+1,3);return localStorage.setItem(qc,JSON.stringify({level:t,timestamp:Date.now()})),t}catch(r){return console.warn("Error saving backoff level:",r),0}},ri=()=>{try{localStorage.removeItem(qc)}catch(r){console.warn("Error resetting backoff:",r)}},z0=r=>Math.min(B0*Math.pow(2,r),M0),Fh=({isOpen:r,onClose:t,error:e})=>{const[s,i]=U.useState(0),[a,d]=U.useState(!1),[o,c]=U.useState(null),h=u=>{const g=((u==null?void 0:u.message)||u||"").toLowerCase();return g.includes("529")||g.includes("overloaded")?{type:"overload",title:"API Temporarily Overloaded",message:"The AI servers are experiencing high traffic right now.",waitTime:30,icon:n.jsx(Rr,{className:"h-6 w-6 text-yellow-500 animate-spin"})}:g.includes("429")||g.includes("rate limit")?{type:"rate_limit",title:"Oops!",message:null,waitTime:null,icon:n.jsx(zl,{className:"h-6 w-6 text-orange-500"})}:g.includes("500")||g.includes("502")||g.includes("503")?{type:"server_error",title:"Server Error",message:"The server is experiencing issues. Let's try again in a moment.",waitTime:45,icon:n.jsx(Bn,{className:"h-6 w-6 text-red-500"})}:g.includes("timeout")?{type:"timeout",title:"Request Timeout",message:"The analysis took too long. This might work better with smaller files.",waitTime:15,icon:n.jsx(zl,{className:"h-6 w-6 text-blue-500"})}:{type:"generic",title:"Oops!",message:(u==null?void 0:u.message)||u||"An unexpected error occurred.",waitTime:10,icon:n.jsx(Bn,{className:"h-6 w-6 text-gray-500"})}};U.useEffect(()=>{if(r&&e){const u=h(e);let w=u.waitTime;if(u.type==="rate_limit"){const y=Ih();w=z0(y),U0()}const g={...u,waitTime:w};c(g),i(w),d(!1);const N=setInterval(()=>{i(y=>y<=1?(d(!0),clearInterval(N),0):y-1)},1e3);return()=>clearInterval(N)}},[r,e]);const p=u=>{if(u<60)return`${u}s`;const w=Math.floor(u/60),g=u%60;return`${w}m ${g}s`},b=()=>{d(!1),i(0),t()};return!r||!e||!o?null:(e==null?void 0:e.requiresApiKey)||!1?n.jsx(es,{open:r,onOpenChange:u=>!u&&t(),children:n.jsxs(Vn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Yn,{className:"flex items-center gap-2",children:[n.jsx(N0,{className:"h-6 w-6 text-orange-500"}),"API Key Required"]}),n.jsxs(ts,{className:"text-left space-y-3",children:[n.jsx("p",{children:e.message}),n.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:n.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"Add your Anthropic API key in Account Settings to use the autocreate feature."})})]})]}),n.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[n.jsx(Be,{variant:"outline",onClick:t,children:"Cancel"}),n.jsx(Be,{onClick:()=>{t(),window.location.href="#Account"},className:"bg-orange-600 hover:bg-orange-700",children:"Go to Account Settings"})]})]})}):n.jsx(es,{open:r,onOpenChange:u=>u||b(),children:n.jsxs(Vn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Yn,{className:"flex items-center gap-2",children:[o.icon,o.title]}),n.jsxs(ts,{className:"text-left space-y-3",children:[o.type==="rate_limit"?n.jsxs("p",{children:["We've hit Anthropic's rate limit"," ",n.jsx("a",{href:"/faq?expand=autocreate-limits",onClick:u=>{u.preventDefault(),u.stopPropagation(),window.open("/faq?expand=autocreate-limits","_blank")},className:"text-blue-500 hover:text-blue-400 underline",children:"(more info)"})]}):n.jsx("p",{children:o.message}),s>0?n.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx(zl,{className:"h-4 w-4 text-gray-500"}),n.jsxs("span",{children:["Please wait ",p(s)," before trying again"]})]}),n.jsx("div",{className:"w-full bg-gray-300 dark:bg-gray-600 rounded-full h-2 mt-2",children:n.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-1000",style:{width:`${(o.waitTime-s)/o.waitTime*100}%`}})})]}):n.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 p-3 rounded-lg",children:n.jsx("p",{className:"text-sm text-green-700 dark:text-green-300",children:"Ready to try again!"})})]})]}),n.jsx("div",{className:"flex justify-end gap-2 mt-4",children:n.jsx(Be,{onClick:b,disabled:!a,className:"min-w-20",children:a?"OK":`Wait ${p(s)}`})})]})})},yc=({isOpen:r,onClose:t,autocreateData:e})=>{if(!r||!e)return null;const{itemName:s,chordCount:i,contentType:a,uploadedFileNames:d,isVisionAnalysis:o=!1}=e,c=o||a==="chord_charts"||a==="auto-detected",h=()=>c?n.jsx(P0,{className:"h-6 w-6 text-yellow-500"}):n.jsx(Rc,{className:"h-6 w-6 text-green-500"}),p=()=>c?"ðŸŽ¸ Vision Analysis Complete!":"Chord charts created",b=()=>n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"font-medium",children:"Success! Or close to it!"}),n.jsx("p",{children:"We did the best we could. You'll likely need to make a few corrections."}),n.jsx("p",{children:"Click the pencil icon on a chord chart to fix it."}),n.jsxs("p",{children:["Be sure to click the ",n.jsx("code",{className:"px-1 py-0.5 bg-gray-700 text-gray-300 rounded text-sm",children:'"Update chord chart"'})," button after edits"]})]}),m=()=>{const u=[],w={chord_charts:"Chord charts",chord_names:"Lyrics with chord names",tablature:"Guitar tablature",mixed:"Mixed content types","auto-detected":c?"Chord charts":"Mixed content",youtube_transcript:"YouTube transcript"};if(["YouTube transcript","Manual entry"].includes(d))u.push(d);else if(a&&w[a]&&u.push(w[a]),d){const y=d.split(", ").slice(0,3),S=d.split(", ").length-y.length;let L=y.join(", ");S>0&&(L+=` and ${S} more`),u.push(L)}return u};return n.jsx(es,{open:r,onOpenChange:u=>!u&&t(),children:n.jsxs(Vn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Yn,{className:"flex items-center gap-2",children:[h(),p()]}),n.jsxs(ts,{className:"text-left space-y-1",children:[b(),n.jsxs("div",{className:"bg-gray-800 px-2 py-1 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-300 mb-1",children:[n.jsx(Nh,{className:"h-4 w-4"}),n.jsx("span",{children:"Details"})]}),n.jsx("ul",{className:"text-sm text-gray-400",children:m().map((u,w)=>n.jsxs("li",{className:"flex items-center gap-1",children:[n.jsx("span",{className:"w-1 h-1 bg-gray-400 rounded-full"}),u]},w))})]})]})]}),n.jsx("div",{className:"flex justify-end gap-2 -mt-2",children:n.jsx(Be,{onClick:t,variant:"outline",className:"min-w-20",children:"Show me"})})]})})};var q0=Symbol("radix.slottable");function $0(r){const t=({children:e})=>n.jsx(n.Fragment,{children:e});return t.displayName=`${r}.Slottable`,t.__radixId=q0,t}var Oh="AlertDialog",[W0]=t0(Oh,[hh]),ya=hh(),Rh=r=>{const{__scopeAlertDialog:t,...e}=r,s=ya(t);return n.jsx(dh,{...s,...e,modal:!0})};Rh.displayName=Oh;var H0="AlertDialogTrigger",V0=U.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,i=ya(e);return n.jsx(r0,{...i,...s,ref:t})});V0.displayName=H0;var G0="AlertDialogPortal",Dh=r=>{const{__scopeAlertDialog:t,...e}=r,s=ya(t);return n.jsx(ch,{...s,...e})};Dh.displayName=G0;var Y0="AlertDialogOverlay",Bh=U.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,i=ya(e);return n.jsx(Pc,{...i,...s,ref:t})});Bh.displayName=Y0;var Ti="AlertDialogContent",[J0,Z0]=W0(Ti),K0=$0("AlertDialogContent"),Mh=U.forwardRef((r,t)=>{const{__scopeAlertDialog:e,children:s,...i}=r,a=ya(e),d=U.useRef(null),o=uh(t,d),c=U.useRef(null);return n.jsx(Qp,{contentName:Ti,titleName:Uh,docsSlug:"alert-dialog",children:n.jsx(J0,{scope:e,cancelRef:c,children:n.jsxs(Tc,{role:"alertdialog",...a,...i,ref:o,onOpenAutoFocus:e0(i.onOpenAutoFocus,h=>{var p;h.preventDefault(),(p=c.current)==null||p.focus({preventScroll:!0})}),onPointerDownOutside:h=>h.preventDefault(),onInteractOutside:h=>h.preventDefault(),children:[n.jsx(K0,{children:s}),n.jsx(Q0,{contentRef:d})]})})})});Mh.displayName=Ti;var Uh="AlertDialogTitle",zh=U.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,i=ya(e);return n.jsx(Fc,{...i,...s,ref:t})});zh.displayName=Uh;var qh="AlertDialogDescription",$h=U.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,i=ya(e);return n.jsx(Oc,{...i,...s,ref:t})});$h.displayName=qh;var X0="AlertDialogAction",Wh=U.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,i=ya(e);return n.jsx(Ic,{...i,...s,ref:t})});Wh.displayName=X0;var Hh="AlertDialogCancel",Vh=U.forwardRef((r,t)=>{const{__scopeAlertDialog:e,...s}=r,{cancelRef:i}=Z0(Hh,e),a=ya(e),d=uh(t,i);return n.jsx(Ic,{...a,...s,ref:d})});Vh.displayName=Hh;var Q0=({contentRef:r})=>{const t=`\`${Ti}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Ti}\` by passing a \`${qh}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ti}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return U.useEffect(()=>{var s;document.getElementById((s=r.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(t)},[t,r]),null},em=Rh,tm=Dh,Gh=Bh,Yh=Mh,Jh=Wh,Zh=Vh,Kh=zh,Xh=$h;const Qs=em,rm=tm,Qh=U.forwardRef(({className:r,...t},e)=>n.jsx(Gh,{className:$r("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",r),...t,ref:e}));Qh.displayName=Gh.displayName;const Rs=U.forwardRef(({className:r,...t},e)=>n.jsxs(rm,{children:[n.jsx(Qh,{}),n.jsx(Yh,{ref:e,className:$r("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",r),...t})]}));Rs.displayName=Yh.displayName;const Ds=({className:r,...t})=>n.jsx("div",{className:$r("flex flex-col space-y-2 text-center sm:text-left",r),...t});Ds.displayName="AlertDialogHeader";const Bs=({className:r,...t})=>n.jsx("div",{className:$r("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",r),...t});Bs.displayName="AlertDialogFooter";const Ms=U.forwardRef(({className:r,...t},e)=>n.jsx(Kh,{ref:e,className:$r("text-lg font-semibold",r),...t}));Ms.displayName=Kh.displayName;const Us=U.forwardRef(({className:r,...t},e)=>n.jsx(Xh,{ref:e,className:$r("text-sm text-muted-foreground",r),...t}));Us.displayName=Xh.displayName;const Ss=U.forwardRef(({className:r,...t},e)=>n.jsx(Jh,{ref:e,className:$r("inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",r),...t}));Ss.displayName=Jh.displayName;const xa=U.forwardRef(({className:r,...t},e)=>n.jsx(Zh,{ref:e,className:$r("mt-2 inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-semibold ring-offset-background transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 sm:mt-0",r),...t}));xa.displayName=Zh.displayName;const nm=(r,t)=>{let e;return function(...i){const a=()=>{clearTimeout(e),r(...i)};clearTimeout(e),e=setTimeout(a,t)}},ul=r=>r.replace(/[''`"]/g,"'").replace(/[â€“â€”âˆ’]/g,"-").replace(/\s+/g," ").trim().toLowerCase(),Rd=r=>r.replace(/\s*\([^)]*\)\s*/g,"").trim(),Dd=(r,t,e)=>{const s=Rd(r),i=ul(s);return ze("CopyCharts","findSimilarSongs - sourceTitle:",r,"-> baseName:",s,"-> normalized:",i),t.filter(a=>{if(a.B===e)return!1;const d=a.C||"",o=Rd(d),c=ul(o);return i===c||i.length>3&&c.includes(i)||c.length>3&&i.includes(c)})},sm=U.memo(({chart:r,onEdit:t,onDelete:e,onInsertAfter:s})=>{const[i,a]=U.useState(!1),d=U.useRef(null),o=U.useRef(null);U.useEffect(()=>{const u=w=>{d.current&&!d.current.contains(w.target)&&a(!1)};if(i)return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[i]),U.useEffect(()=>{if(!o.current)return;(()=>{if(!(!window.svguitar||!o.current))try{const w=r.chordData||r;o.current.innerHTML="";const g=new window.svguitar.SVGuitarChord(o.current),N={strings:w.numStrings||6,frets:w.numFrets||5,position:w.startingFret||1,tuning:[],width:128,height:176,fretSize:1.2,fingerSize:.75,sidePadding:.2,fontFamily:"Arial",color:"#ffffff",backgroundColor:"transparent",strokeColor:"#ffffff",textColor:"#ffffff",fretLabelColor:"#ffffff",fingerTextColor:"#000000",fingerTextSize:28},L={fingers:[...(w.fingers||[]).map(E=>{const[I,K,Y]=E;return Y&&Y!=="undefined"?[I,K,Y]:[I,K]}),...(w.openStrings||[]).map(E=>[E,0]),...(w.mutedStrings||[]).map(E=>[E,"x"])],barres:w.barres||[]};g.configure(N).chord(L).draw(),setTimeout(()=>{var I;const E=(I=o.current)==null?void 0:I.querySelector("svg");E&&(E.style.width="100%",E.style.height="100%",E.style.maxWidth="128px",E.style.maxHeight="180px",E.style.position="relative",E.style.zIndex="1")},50)}catch(w){console.error("Error rendering memoized chord chart:",w)}})()},[r]);const c=u=>{u.preventDefault(),u.stopPropagation(),a(!1),t(r.id,{title:r.title,...r,sectionId:r.sectionId,sectionLabel:r.sectionLabel,sectionRepeatCount:r.sectionRepeatCount})},h=u=>{u.preventDefault(),u.stopPropagation(),a(!1),e(r.id)},p=u=>{u.preventDefault(),u.stopPropagation(),a(!1),s(r.id,{sectionId:r.sectionId,sectionLabel:r.sectionLabel,sectionRepeatCount:r.sectionRepeatCount})},b=u=>{u.preventDefault(),u.stopPropagation(),a(!1);const w={fingers:r.fingers||[],barres:r.barres||[],tuning:r.tuning||"EADGBE",capo:r.capo||0,startingFret:r.startingFret||1,numFrets:r.numFrets||5,numStrings:r.numStrings||6,openStrings:r.openStrings||[],mutedStrings:r.mutedStrings||[],sectionId:r.sectionId||"",sectionLabel:r.sectionLabel||"",sectionRepeatCount:r.sectionRepeatCount||"",hasLineBreakAfter:!r.hasLineBreakAfter};t(r.id,{title:r.title,chord_data:w,sectionId:r.sectionId,sectionLabel:r.sectionLabel,sectionRepeatCount:r.sectionRepeatCount})},m=u=>{u.preventDefault(),u.stopPropagation(),a(!i)};return n.jsxs("div",{className:"relative mx-auto",style:{maxWidth:"144px"},children:[n.jsxs("div",{className:"bg-gray-800 p-1 rounded-lg cursor-pointer relative group",onClick:m,style:{minWidth:"0",maxWidth:"100%",width:"100%",position:"relative"},children:[n.jsx("button",{className:"absolute top-1 right-1 bg-gray-700 text-gray-300 rounded-full w-6 h-6 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:m,"aria-label":"Chord chart menu","data-ph-capture-attribute-button":"chord-chart-menu",children:"â‹®"}),n.jsx("div",{className:"relative w-32 mx-auto flex items-center justify-center overflow-hidden",style:{height:"184px"},children:n.jsx("div",{ref:o,className:"w-full h-full"})}),n.jsx("div",{className:"text-center text-white text-sm font-semibold mt-2",children:r.title}),r.hasLineBreakAfter&&n.jsx("div",{className:"absolute -bottom-1 -right-1 bg-blue-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs",children:"â†µ"})]}),i&&n.jsxs("div",{ref:d,className:"absolute top-8 right-0 bg-gray-700 border border-gray-600 rounded-lg shadow-lg z-20 min-w-48",children:[n.jsx("button",{onClick:c,className:"w-full text-left px-4 py-2 text-gray-200 hover:bg-gray-600 rounded-t-lg flex items-center","data-ph-capture-attribute-button":"modal-edit-chord",children:"âœï¸ Edit chord"}),n.jsx("button",{onClick:p,className:"w-full text-left px-4 py-2 text-gray-200 hover:bg-gray-600 flex items-center","data-ph-capture-attribute-button":"modal-insert-chord-after",children:"âž• Insert chord after"}),n.jsx("button",{onClick:b,className:"w-full text-left px-4 py-2 text-gray-200 hover:bg-gray-600 flex items-center","data-ph-capture-attribute-button":"modal-toggle-line-break",children:r.hasLineBreakAfter?"â†©ï¸ Remove line break":"â†µ Add line break after"}),n.jsx("button",{onClick:h,className:"w-full text-left px-4 py-2 text-red-400 hover:bg-gray-600 rounded-b-lg flex items-center","data-ph-capture-attribute-button":"modal-delete-chord",children:"ðŸ—‘ï¸ Delete chord"})]})]})});function ef({isOpen:r,onClose:t,itemId:e,itemTitle:s}){var Zr;const{items:i}=Ph(),[a,d]=U.useState({}),[o,c]=U.useState({}),[h,p]=U.useState({}),[b,m]=U.useState(null),[u,w]=U.useState(null),[g,N]=U.useState({}),[y,S]=U.useState(new Set),[L,E]=U.useState(!1),[I,K]=U.useState(null),[Y,V]=U.useState(""),[O,Q]=U.useState(new Set),[F,k]=U.useState(new Set),[M,_]=U.useState(!1),[te,ae]=U.useState(null),[re,se]=U.useState({}),[ie,je]=U.useState({}),[ne,A]=U.useState({}),[H,Z]=U.useState({}),[X,pe]=U.useState({}),[ve,ke]=U.useState({}),[Ae,De]=U.useState({}),[Me,Ke]=U.useState({}),Se=["âœ¨ Claude is making magic happen","âœ¨ Claude is *still* making magic happen","Yeah, we all love instant gratification, but it'll still be quicker than you could do it from scratch","Are you familiar with the phrase 'A watched pot never boils'? It's kinda like that","Chill, I'm working on it.","You could be stretching or something while you wait, couldn't you?","The pyramids weren't built in a day... ","but hey, at least I'm not going to ask you for an email address to send the chord charts to.","Perfect chord charts take time to craft. These will take less time and they won't be perfect.","Yeah, I could show you a progress bar, but we both know it would just lie to you"],[j,P]=U.useState(0),[G,$]=U.useState([]),[z,B]=U.useState(!1),[he,me]=U.useState(null),[de,Le]=U.useState(!1),[Ie,Te]=U.useState(null),[Ye,ft]=U.useState(!1),[at,lt]=U.useState(null),[bt,ut]=U.useState(!1),[Yt,gt]=U.useState(null),Et=U.useCallback(ye=>ye===e?{C:s,B:e,E:5}:null,[e,s]);U.useEffect(()=>{if(!window.svguitar){const ye=document.createElement("script");ye.src="https://omnibrain.github.io/svguitar/js/svguitar.umd.js",ye.async=!0,document.body.appendChild(ye)}},[]),U.useEffect(()=>{r&&e&&qt(e)},[r,e]),U.useEffect(()=>{if(Object.values(ie).filter(it=>it==="processing").length===0){P(0),$([]);return}P(0);const He=Array.from({length:Se.length-1},(it,rt)=>rt+1).sort(()=>Math.random()-.5);$(He);const et=setInterval(()=>{$(it=>{if(it.length===0){const nt=Array.from({length:Se.length},(jt,Wt)=>Wt).sort(()=>Math.random()-.5),ot=nt[0],At=nt.slice(1);return P(ot),At}else{const rt=it[0],nt=it.slice(1);return P(rt),nt}})},1e4);return()=>clearInterval(et)},[ie,Se]),U.useEffect(()=>{if(!L||O.size===0)return;const ye=new Set;O.forEach(qe=>{var it;const He=i==null?void 0:i.find(rt=>rt.A===qe),et=He==null?void 0:He.B;et&&((it=a[et])==null?void 0:it.length)>0&&ye.add(qe)}),k(ye)},[L,O,a,i]);const qt=async ye=>{try{const qe=await fetch(`/api/items/${ye}/chord-charts`);if(qe.ok){const He=await qe.json();d(it=>({...it,[ye]:He}));const et=Pt(He);c(it=>({...it,[ye]:et}))}}catch(qe){console.error("Error loading chord charts:",qe)}},Pt=ye=>{const qe=new Map;return ye.forEach(He=>{const et=He.sectionId||"default-section",it=He.sectionLabel||"Section",rt=He.sectionRepeatCount||"";qe.has(et)||qe.set(et,{id:et,label:it,repeatCount:rt,chords:[]}),qe.get(et).chords.push(He)}),Array.from(qe.values())},vt=ye=>{const qe=a[ye]||[];return Pt(qe)},Zt=U.useMemo(()=>{if(!I||!i)return new Set;const ye=i.find(et=>et.B===I),qe=(ye==null?void 0:ye.C)||"",He=i.filter(et=>et.B!==I);return new Set(Dd(qe,He,I).map(et=>et.A))},[I,i]),_t=U.useMemo(()=>i?i.filter(ye=>{if(ye.B===I)return!1;if(Y.trim()){const qe=ye.C||"",He=ul(qe),et=ul(Y);return et?He.includes(et):!0}return!0}).sort((ye,qe)=>{if(Y.trim()){const nt=ye.C||"",ot=qe.C||"";return nt.localeCompare(ot)}const He=Zt.has(ye.A),et=Zt.has(qe.A);if(He&&!et)return-1;if(!He&&et)return 1;const it=ye.C||"",rt=qe.C||"";return it.localeCompare(rt)}):[],[i,I,Y,Zt]),Ot=U.useMemo(()=>nm(async(ye,qe,He)=>{try{ze("Section","Debounced section update:",{itemId:ye,sectionId:qe,updates:He});const it=(a[ye]||[]).filter(nt=>(nt.sectionId||"default-section")===qe);if(it.length===0){console.warn("No charts found for section:",qe);return}ze("Section","Updating section charts:",it.length);const rt=it.map(async nt=>{const ot={fingers:nt.fingers||[],barres:nt.barres||[],tuning:nt.tuning||"EADGBE",capo:nt.capo||0,startingFret:nt.startingFret||1,numFrets:nt.numFrets||5,numStrings:nt.numStrings||6,openStrings:nt.openStrings||[],mutedStrings:nt.mutedStrings||[],hasLineBreakAfter:nt.hasLineBreakAfter||!1,sectionId:qe,sectionLabel:He.label!==void 0?He.label:nt.sectionLabel||"Section",sectionRepeatCount:He.repeatCount!==void 0?He.repeatCount:nt.sectionRepeatCount||""},At=await fetch(`/api/chord-charts/${nt.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:nt.title,chord_data:ot})});if(!At.ok)throw new Error(`Failed to update chart ${nt.id}: ${At.statusText}`);return At.json()});await Promise.all(rt),ze("Section","All section charts updated successfully")}catch(et){console.error("Error updating section:",et)}},500),[a]),ir=(ye,qe,He)=>{ze("Section","Local section update:",{itemId:ye,sectionId:qe,updates:He}),c(et=>{const rt=(et[ye]||[]).map(nt=>nt.id===qe?{...nt,...He}:nt);return{...et,[ye]:rt}}),Ot(ye,qe,He)},Rt=async(ye,qe)=>{if(!y.has(qe)){S(He=>new Set(He).add(qe));try{const He=a[ye]||[],it=He.filter(nt=>(nt.sectionId||"default-section")===qe).map(nt=>fetch(`/api/items/${ye}/chord-charts/${nt.id}`,{method:"DELETE"}));await Promise.all(it);const rt=He.filter(nt=>(nt.sectionId||"default-section")!==qe);d(nt=>({...nt,[ye]:rt})),c(nt=>({...nt,[ye]:Pt(rt)}))}catch(He){console.error("Error deleting section:",He)}finally{S(He=>{const et=new Set(He);return et.delete(qe),et})}}},yt=ye=>{const qe=`section-${Date.now()}`,He={id:qe,label:"New Section",repeatCount:"",chords:[]};c(et=>({...et,[ye]:[...et[ye]||[],He]})),N({itemId:ye,scrollPosition:window.scrollY}),p(et=>({...et,[ye]:!0})),w({sectionId:qe,sectionLabel:"New Section",sectionRepeatCount:""})},Qt=(ye,qe,He)=>{m(qe),w(null),N({itemId:ye,chordId:qe,scrollPosition:window.scrollY}),p(et=>({...et,[ye]:!0})),setTimeout(()=>{const et=document.querySelector(`[data-editor-for-item="${ye}"]`);et&&et.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},tr=async(ye,qe)=>{try{if((await fetch(`/api/items/${ye}/chord-charts/${qe}`,{method:"DELETE"})).ok){d(it=>({...it,[ye]:(it[ye]||[]).filter(rt=>rt.id!==qe)}));const et=(a[ye]||[]).filter(it=>it.id!==qe);c(it=>({...it,[ye]:Pt(et)})),Xs("chord_chart_deleted",{itemId:ye})}}catch(He){console.error("Error deleting chord chart:",He)}},Br=(ye,qe,He)=>{m(null),w({afterChordId:qe,sectionId:He.sectionId,sectionLabel:He.sectionLabel,sectionRepeatCount:He.sectionRepeatCount}),N({itemId:ye,scrollPosition:window.scrollY}),p(et=>({...et,[ye]:!0}))},wn=async(ye,qe)=>{try{en("handleSaveChordChart called",{editingChordId:b,chartData:qe});const He=!!b;en("isUpdate check result",{isUpdate:He,editingChordId:b});let et={...qe};if(He){const ot=(a[ye]||[]).find(At=>At.id===b);et.sectionId=ot==null?void 0:ot.sectionId,et.sectionLabel=ot==null?void 0:ot.sectionLabel,et.sectionRepeatCount=ot==null?void 0:ot.sectionRepeatCount,en("Updating chord, preserving section",{originalSection:{id:ot==null?void 0:ot.sectionId,label:ot==null?void 0:ot.sectionLabel,repeatCount:ot==null?void 0:ot.sectionRepeatCount}})}else{const ot=o[ye]||[];let At;u?At={id:u.sectionId,label:u.sectionLabel,repeatCount:u.sectionRepeatCount}:ot.length===0?At={id:"section-1",label:"Verse",repeatCount:""}:At=ot[ot.length-1],et.sectionId=At.id,et.sectionLabel=At.label,et.sectionRepeatCount=At.repeatCount}et.hasLineBreakAfter=qe.startOnNewLine||!1,en("Setting line break after chord",{title:et.title,hasLineBreakAfter:et.hasLineBreakAfter}),en("Chord data with section metadata",{chartDataWithSection:et});const it=He?`/api/chord-charts/${b}`:`/api/items/${ye}/chord-charts`,rt=He?"PUT":"POST";en(`${He?"Updating":"Creating"} chord chart`,{method:rt,url:it});const nt=await fetch(it,{method:rt,headers:{"Content-Type":"application/json"},body:JSON.stringify(et)});if(!nt.ok)throw new Error(`Failed to save chord chart: ${nt.statusText}`);if(He){const ot=await nt.json();d(jt=>({...jt,[ye]:(jt[ye]||[]).map(Wt=>Wt.id===b?ot:Wt)}));const At=(a[ye]||[]).map(jt=>jt.id===b?ot:jt);c(jt=>({...jt,[ye]:Pt(At)})),Xs("chord_chart_updated",{itemId:ye})}else{const ot=await nt.json();d(jt=>({...jt,[ye]:[...jt[ye]||[],ot]}));const At=[...a[ye]||[],ot];c(jt=>({...jt,[ye]:Pt(At)})),Xs("chord_chart_created",{itemId:ye})}p(ot=>({...ot,[ye]:!1})),m(null),w(null)}catch(He){console.error("Error saving chord chart:",He)}},rn=()=>{g.itemId&&g.chordId&&setTimeout(()=>{const ye=document.querySelector(`[data-chord-id="${g.chordId}"]`);ye?ye.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}):g.scrollPosition!==void 0&&window.scrollTo({top:g.scrollPosition,behavior:"smooth"}),N({})},100)},zt=ye=>{if((a[ye]||[]).length===0)return;const He=window.open("","_blank");He.document.write(`
      <html>
        <head>
          <title>Chord Charts - ${s||ye}</title>
          <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            h1 { text-align: center; margin-bottom: 30px; }
            .section { margin-bottom: 40px; }
            .section-header { font-size: 18px; font-weight: bold; margin-bottom: 15px; }
            .chord-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 20px; }
            .chord-item { text-align: center; }
            .chord-svg { margin-bottom: 5px; }
            .chord-title { font-weight: bold; }
            @media print { body { margin: 0; } }
          </style>
        </head>
        <body>
          <h2>Chord Charts - ${s||ye}</h2>
          ${vt(ye).map(et=>`
            <div class="section">
              <div class="section-header">${et.label} ${et.repeatCount}</div>
              <div class="chord-grid">
                ${et.chords.map(it=>`
                  <div class="chord-item">
                    <div class="chord-svg">${it.svg_content||""}</div>
                    <div class="chord-title">${it.title}</div>
                  </div>
                `).join("")}
              </div>
            </div>
          `).join("")}
        </body>
      </html>
    `),He.document.close(),He.print()},mn=(ye,qe)=>{if(!ye||ye.trim().length===0)return ke(nt=>({...nt,[qe]:null})),!0;const He=ye.trim();return/^[A-Za-z0-9#bâ™­â™¯/\s,\n\r-]+$/.test(He)?He.split(/[\n\r]+/).some(nt=>{const ot=nt.trim();return ot.length===0?!1:/^[A-Za-z]+$/.test(ot)?!0:ot.split(/[,\s]+/).filter(Wt=>Wt.trim().length>0).every(Wt=>/^[A-Ga-g][A-Za-z0-9#bâ™­â™¯/]*$/.test(Wt))})?(ke(nt=>({...nt,[qe]:null})),!0):(ke(nt=>({...nt,[qe]:'Please enter chord names separated by commas, spaces, or section names (e.g., "C, G, Am, F" or "D A G D" or "Intro")'})),!1):(ke(nt=>({...nt,[qe]:"Only chord names (A-G), numbers, #, b, â™­, â™¯, /, commas, spaces, and section names are allowed"})),!1)},vn=(ye,qe)=>{if(!(!qe||qe.length===0)){if(qe.length>5){alert("Maximum 5 files allowed. Please select fewer files.");return}A(He=>({...He,[ye]:Array.from(qe)}))}},Yr=async ye=>{var it,rt;const qe=ne[ye]||[],He=(it=H[ye])==null?void 0:it.trim(),et=(rt=X[ye])==null?void 0:rt.trim();if(ze("AUTOCREATE",`handleProcessFiles called for item ${ye}, files:`,qe.length,"youtubeUrl:",He,"manualChords:",et),He){await yr(ye,He);return}if(et)if(mn(et,ye)){await Wr(ye,et);return}else return;if(qe.length===0){alert("Please add at least one file, YouTube URL, or manual chord input before processing.");return}await Lr(ye,qe)},Wr=async(ye,qe)=>{ze("AUTOCREATE",`Processing manual chord input for item ${ye}:`,qe),je(He=>({...He,[ye]:"processing"}));try{const He=new AbortController;Ke(Jt=>({...Jt,[ye]:He}));const et=new Blob([qe],{type:"text/plain"}),it=new File([et],"manual-input.txt",{type:"text/plain"}),rt=new FormData;rt.append("file0",it),rt.append("itemId",ye),rt.append("userChoice","chord_names"),ze("AUTOCREATE","Sending manual input to autocreate endpoint");const nt=await fetch("/api/autocreate-chord-charts",{method:"POST",body:rt,signal:He.signal});if(!nt.ok){let Jt=`Failed to process manual input: ${nt.statusText}`;try{const xt=await nt.json();if(xt.error&&(Jt=xt.error),xt.requires_api_key){je(Ht=>{const or={...Ht};return delete or[ye],or}),me({message:Jt,requiresApiKey:!0}),B(!0);return}}catch(xt){console.warn("Could not parse error response:",xt)}throw new Error(Jt)}const ot=await nt.json();ze("AUTOCREATE","Manual input processed successfully:",ot);const jt=await(await fetch(`/api/items/${ye}/chord-charts`)).json();d(Jt=>({...Jt,[ye]:jt})),c(Jt=>({...Jt,[ye]:Pt(jt)})),pe(Jt=>({...Jt,[ye]:""})),ri(),je(Jt=>({...Jt,[ye]:"complete"}));const Wt=Et(ye);Te({itemName:(Wt==null?void 0:Wt.C)||`Item ${ye}`,chordCount:jt.length,contentType:"chord_names",uploadedFileNames:"Manual entry",isVisionAnalysis:!1}),Le(!0),Ke(Jt=>{const xt={...Jt};return delete xt[ye],xt}),setTimeout(()=>{je(Jt=>({...Jt,[ye]:null})),se(Jt=>({...Jt,[ye]:!1}))},2e3)}catch(He){console.error("Error processing manual chord input:",He),je(et=>({...et,[ye]:"error"})),Ke(et=>{const it={...et};return delete it[ye],it}),setTimeout(()=>{je(et=>({...et,[ye]:null}))},3e3)}},yr=async(ye,qe)=>{ze("YOUTUBE",`Processing YouTube URL for item ${ye}:`,qe);const He=qe.trim().replace(/[<>"']/g,"");if(!/^https?:\/\/(www\.)?(youtube\.com\/watch\?v=[\w-]+|youtu\.be\/[\w-]+)(\?.*|&.*)?$/.test(He)){ze("YOUTUBE",`URL validation failed for: ${He}`),me({message:"Please enter a valid YouTube URL (e.g., https://youtube.com/watch?v=...)"}),B(!0);return}ze("YOUTUBE","URL validation passed, setting progress state"),je(it=>({...it,[ye]:"checking_transcript"}));try{ze("YOUTUBE","Fetching transcript from YouTube API");const it=await fetch("/api/youtube/check-transcript",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:He})});if(!it.ok)throw new Error("Failed to fetch YouTube transcript");const rt=await it.json();if(!rt.hasTranscript||!rt.transcript){me({message:"This YouTube video does not have a transcript available. Please try a different video or use file upload instead."}),B(!0);return}ze("YOUTUBE",`Transcript fetched successfully, length: ${rt.transcript.length} characters`),je(or=>({...or,[ye]:"processing"}));const nt=new Blob([rt.transcript],{type:"text/plain"}),ot=new File([nt],"youtube_transcript.txt",{type:"text/plain"}),At=new FormData;At.append("file0",ot),At.append("itemId",ye),At.append("userChoice","chord_names"),ze("AUTOCREATE","Sending transcript to autocreate endpoint");const jt=await fetch("/api/autocreate-chord-charts",{method:"POST",body:At});if(!jt.ok){const or=await jt.text();let Tn;try{Tn=JSON.parse(or)}catch{Tn={error:or}}if(Tn.requires_api_key){je(bs=>{const Ar={...bs};return delete Ar[ye],Ar}),me({message:Tn.error||"Autocreate requires an API key.",requiresApiKey:!0}),B(!0);return}throw new Error(`Failed to process YouTube transcript: ${jt.status} ${jt.statusText} - ${or}`)}const Wt=await jt.json();ze("AUTOCREATE","YouTube transcript processed successfully:",Wt);const xt=await(await fetch(`/api/items/${ye}/chord-charts`)).json();d(or=>({...or,[ye]:xt})),c(or=>({...or,[ye]:Pt(xt)})),Z(or=>({...or,[ye]:""})),ri();const Ht=Et(ye);Te({itemName:(Ht==null?void 0:Ht.C)||`Item ${ye}`,chordCount:xt.length,contentType:"chord_names",uploadedFileNames:"YouTube transcript",isVisionAnalysis:!1}),Le(!0)}catch(it){console.error("Error processing YouTube URL:",it),me({message:"Failed to process YouTube URL. Please try again."}),B(!0)}finally{je(it=>{const rt={...it};return delete rt[ye],rt})}},Lr=async(ye,qe)=>{try{je(At=>({...At,[ye]:"uploading"}));const He=new AbortController;Ke(At=>({...At,[ye]:He}));const et=new FormData;qe.forEach((At,jt)=>{et.append(`file${jt}`,At)}),et.append("itemId",ye);const it=2e3;let rt=!1;const nt=setTimeout(()=>{rt||je(At=>({...At,[ye]:"processing"}))},it),ot=await fetch("/api/autocreate-chord-charts",{method:"POST",body:et,signal:He.signal});if(ot.ok){ri(),je(xt=>({...xt,[ye]:"complete"}));const jt=await(await fetch(`/api/items/${ye}/chord-charts`)).json();d(xt=>({...xt,[ye]:jt})),c(xt=>({...xt,[ye]:Pt(jt)})),A(xt=>({...xt,[ye]:[]})),Xs("autocreate_completed",{itemId:ye,fileCount:qe.length});const Wt=Et(ye),Jt=qe.map(xt=>xt.name).join(", ");Te({itemName:(Wt==null?void 0:Wt.C)||`Item ${ye}`,chordCount:jt.length,contentType:"auto-detected",uploadedFileNames:Jt,isVisionAnalysis:!1}),Le(!0),Ke(xt=>{const Ht={...xt};return delete Ht[ye],Ht}),setTimeout(()=>{je(xt=>({...xt,[ye]:null})),se(xt=>({...xt,[ye]:!1}))},2e3)}else{rt=!0,clearTimeout(nt);let At=`Failed to create chord charts: ${ot.statusText}`;try{const jt=await ot.json();if(jt.error&&(At=jt.error),jt.requires_api_key){je(Wt=>{const Jt={...Wt};return delete Jt[ye],Jt}),me({message:At,requiresApiKey:!0}),B(!0),Ke(Wt=>{const Jt={...Wt};return delete Jt[ye],Jt});return}}catch(jt){console.warn("Could not parse error response:",jt)}me({message:At}),B(!0),je(jt=>{const Wt={...jt};return delete Wt[ye],Wt}),Ke(jt=>{const Wt={...jt};return delete Wt[ye],Wt})}}catch(He){hasErrorOccurred=!0,clearTimeout(processingTimer),console.error("Error processing files:",He),je(et=>{const it={...et};return delete it[ye],it}),Ke(et=>{const it={...et};return delete it[ye],it})}},ur=ye=>{(a[ye]||[]).length>0?(gt(ye),ut(!0)):se(He=>({...He,[ye]:!0}))},ns=async()=>{if(Yt)try{const ye=a[Yt]||[];for(const qe of ye)if(!(await fetch(`/api/items/${Yt}/chord-charts/${qe.id}`,{method:"DELETE"})).ok)throw new Error(`Failed to delete chord chart ${qe.id}`);d(qe=>({...qe,[Yt]:[]})),c(qe=>({...qe,[Yt]:[]})),se(qe=>({...qe,[Yt]:!0})),ut(!1),gt(null)}catch(ye){console.error("Error deleting existing chord charts:",ye)}},vr=ye=>{lt(ye),ft(!0)},kn=ye=>{Me[ye]&&Me[ye].abort(),je(qe=>{const He={...qe};return delete He[ye],He}),Ke(qe=>{const He={...qe};return delete He[ye],He}),A(qe=>{const He={...qe};return delete He[ye],He}),Z(qe=>({...qe,[ye]:""})),pe(qe=>({...qe,[ye]:""})),se(qe=>({...qe,[ye]:!1}))},nn=ye=>{ze("CopyCharts","Open copy from modal for item:",ye)},Cn=async ye=>{ze("CopyCharts","Opening copy modal for item:",ye),K(ye);const qe=i==null?void 0:i.find(rt=>rt.B===ye),He=(qe==null?void 0:qe.C)||"",et=Dd(He,i,ye);ze("CopyCharts","Source:",He),ze("CopyCharts","Found similar songs:",et.map(rt=>rt.C));const it=[ye,...et.map(rt=>rt.B)];ze("CopyCharts","Loading chord charts for relevant items:",it.length,"items");for(const rt of it)try{const nt=await fetch(`/api/items/${rt}/chord-charts`);if(nt.ok){const ot=await nt.json();d(At=>({...At,[rt]:ot})),ze("CopyCharts",`Loaded ${ot.length} charts for item ${rt}`)}}catch(nt){console.error(`Error loading chord charts for item ${rt}:`,nt)}E(!0),V(""),Q(new Set),ae(null)},Hr=()=>{E(!1),K(null),V(""),Q(new Set),k(new Set),_(!1),ae(null)},Jr=ye=>{Q(qe=>{const He=new Set(qe);if(He.has(ye))He.delete(ye);else{He.add(ye);const et=i==null?void 0:i.find(rt=>rt.A===ye),it=et==null?void 0:et.B;it&&qt(it)}return He})},Pn=async()=>{if(ze("CopyCharts","handleConfirmCopy called",{copySourceItemId:I,selectedTargetItems:Array.from(O)}),!I||O.size===0){ze("CopyCharts","Early return: missing source or targets");return}if(F.size>0&&!M){ze("CopyCharts","Showing overwrite confirmation, items with existing charts:",F.size),_(!0);return}try{const ye=await fetch("/api/chord-charts/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_item_id:I,target_item_ids:Array.from(O).map(it=>{const rt=i==null?void 0:i.find(nt=>nt.A===it);return rt==null?void 0:rt.B}).filter(Boolean)})});if(!ye.ok)throw new Error(`Failed to copy chord charts: ${ye.statusText}`);const qe=await ye.json();ze("CopyCharts","Chord charts copied successfully:",qe),ae("complete");const He=Array.from(O).map(it=>{const rt=i==null?void 0:i.find(nt=>nt.A===it);return rt==null?void 0:rt.B}).filter(Boolean),et=[I,...He];ze("CopyCharts","About to refresh chord charts for affected items:",et);for(const it of et)try{const rt=await fetch(`/api/items/${it}/chord-charts`);if(rt.ok){const nt=await rt.json();ze("CopyCharts","Updating chordCharts state for item",it,"with",nt.length,"charts"),d(ot=>({...ot,[it]:nt})),c(ot=>({...ot,[it]:Pt(nt)}))}}catch(rt){console.error(`Error refreshing chord charts for item ${it}:`,rt)}}catch(ye){console.error("Error copying chord charts:",ye)}};if(!r)return null;const ct=e;return n.jsxs(n.Fragment,{children:[n.jsx(es,{open:r&&!L,onOpenChange:t,children:n.jsxs(Vn,{className:"max-w-[95vw] sm:max-w-2xl md:max-w-3xl lg:max-w-4xl max-h-[90vh] overflow-y-auto",children:[n.jsxs(Gn,{children:[n.jsxs(Yn,{className:"flex items-center gap-2",children:[n.jsx(_h,{className:"h-5 w-5"}),"Chord Charts - ",s||e]}),n.jsx(ts,{className:"sr-only",children:"View and manage chord charts for this practice item"})]}),n.jsx("div",{className:"space-y-4",children:(()=>{var it;const ye=o[ct],qe=ye?null:vt(ct),et=(ye||qe||[]).map((rt,nt)=>n.jsxs("div",{className:"mb-6",children:[n.jsxs("div",{className:"flex justify-between items-center mb-3",children:[n.jsx("input",{type:"text",value:rt.label,onChange:ot=>{ze("Section","Updating section label:",rt.id,ot.target.value),ir(ct,rt.id,{label:ot.target.value})},className:"bg-gray-900 text-white px-2 py-1 rounded text-sm font-semibold border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Section name"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:rt.repeatCount,onChange:ot=>ir(ct,rt.id,{repeatCount:ot.target.value}),className:"bg-gray-900 text-white px-2 py-1 rounded text-sm w-16 text-center border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"x2",maxLength:"3"}),n.jsx("button",{onClick:()=>Rt(ct,rt.id),disabled:y.size>0,className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold transition-colors ${y.size>0?"bg-gray-500 cursor-not-allowed":"bg-red-600 hover:bg-red-700 cursor-pointer"} text-white`,title:y.size>0?"Deleting...":"Delete section",children:y.size>0?n.jsx(Rr,{className:"h-3 w-3 animate-spin"}):"Ã—"})]})]}),nt===0&&(()=>{const ot=rt.chords[0];if(!ot)return null;const At=ot.tuning||"EADGBE",jt=ot.capo||0;return n.jsx("div",{className:"text-center text-white font-bold text-sm mb-3",children:jt>0?`${At} | Capo on ${jt}`:At})})(),rt.chords.length>0&&n.jsx("div",{className:"space-y-2",children:(()=>{const ot=[];let At=[];return rt.chords.forEach((jt,Wt)=>{At.push(jt),(jt.hasLineBreakAfter||At.length>=5||Wt===rt.chords.length-1)&&(ot.push([...At]),At=[])}),ot.map((jt,Wt)=>n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2",children:jt.map(Jt=>n.jsx(sm,{chart:Jt,onEdit:(xt,Ht)=>Qt(ct,xt),onDelete:xt=>tr(ct,xt),onInsertAfter:(xt,Ht)=>Br(ct,xt,Ht)},Jt.id))},Wt))})()})]},rt.id));return n.jsxs(n.Fragment,{children:[et,(a[ct]||[]).length>0?n.jsx("div",{className:"flex justify-end mb-2",children:n.jsx(Be,{variant:"outline",size:"sm",onClick:nt=>{nt.stopPropagation(),zt(ct)},className:"p-2 border-gray-600 text-gray-400 hover:text-gray-200 hover:bg-gray-600",title:"Print chord charts",children:n.jsx(jh,{className:"h-4 w-4"})})}):null,(()=>{var At,jt,Wt,Jt;const rt=a[ct]||[],nt=ie[ct],ot=re[ct];return rt.length===0?n.jsxs("div",{className:"mb-4",children:[ot?n.jsx(Be,{onClick:()=>se(xt=>({...xt,[ct]:!1})),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-300 mb-2",title:"Collapse autocreate section",children:"â†"}):n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{onClick:()=>se(xt=>({...xt,[ct]:!0})),className:"max-w-md bg-gray-700 text-gray-300 hover:bg-gray-600 mb-2 flex items-center justify-center",children:[n.jsx(Ei,{className:"h-4 w-4 mr-2"}),"Autocreate Chord Charts"]})}),ot&&n.jsxs("div",{className:"border border-gray-600/30 rounded-lg p-4 bg-gray-800/10",children:[n.jsxs("div",{className:"text-sm text-gray-400 mb-6",children:[n.jsx("p",{children:"â€¢ Upload lyrics with chord names to create charts"}),n.jsx("p",{children:'â€¢ Upload image or PDF of chord charts to "import"'}),n.jsx("p",{children:"â€¢ One method at a time"})]}),!nt&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 items-start",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"text-center mb-2",children:n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Upload files"})}),n.jsx("div",{className:`flex-1 p-4 border-2 border-dashed rounded-lg transition-colors cursor-pointer ${Ae[ct]?"border-gray-500 bg-gray-800/20":"border-gray-600 hover:border-gray-500 bg-gray-800/10"}`,onDragOver:xt=>{xt.preventDefault(),De(Ht=>Ht[ct]!==!0?{...Ht,[ct]:!0}:Ht)},onDragLeave:xt=>{xt.preventDefault(),De(Ht=>Ht[ct]!==!1?{...Ht,[ct]:!1}:Ht)},onDrop:xt=>{xt.preventDefault(),De(Ht=>({...Ht,[ct]:!1})),vn(ct,xt.dataTransfer.files)},onClick:()=>{const xt=document.createElement("input");xt.type="file",xt.multiple=!0,xt.accept=".pdf,.png,.jpg,.jpeg",xt.onchange=Ht=>vn(ct,Ht.target.files),xt.click()},children:n.jsxs("div",{className:"text-center",children:[n.jsx(Ei,{className:`h-12 w-12 mx-auto mb-2 ${ne[ct]&&ne[ct].length>0?"text-gray-300":"text-gray-400"}`}),n.jsx("p",{className:`text-sm font-medium mb-2 ${ne[ct]&&ne[ct].length>0?"text-gray-200":"text-gray-300"}`,children:"Drop files or click"}),n.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"PDFs, images â€¢ 5mb max"}),ne[ct]&&ne[ct].length>0&&n.jsx("div",{children:n.jsxs("p",{className:"text-gray-300 text-xs font-medium mb-1",children:[ne[ct].length," file(s)"]})})]})})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"text-center mb-2",children:[n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"YouTube guitar lesson"}),n.jsx("p",{className:"text-gray-500 text-xs",children:"(video must have a transcript)"})]}),n.jsx("form",{className:"flex-1 flex flex-col justify-center",onSubmit:xt=>{var Ht;xt.preventDefault(),(Ht=H[ct])!=null&&Ht.trim()&&Yr(ct)},children:n.jsx("input",{type:"url",placeholder:"Paste YouTube URL",value:H[ct]||"",onChange:xt=>{const Ht=xt.target.value.replace(/[<>"']/g,"");Z(or=>({...or,[ct]:Ht}))},maxLength:500,className:"w-full p-3 bg-gray-700 text-white rounded border-2 border-gray-600 focus:border-gray-500 text-sm"})})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"text-center mb-2",children:n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Manual entry"})}),n.jsxs("div",{className:"flex-1 flex flex-col justify-center relative",children:[n.jsx("textarea",{placeholder:`Enter song section names and chord names, like this:
Intro
Am7 Em/A E7sus
Verse
C G/B Am (space or comma-separated)`,value:X[ct]||"",onChange:xt=>{const Ht=xt.target.value;Ht.length<=500&&(pe(or=>({...or,[ct]:Ht})),mn(Ht,ct))},maxLength:500,className:`w-full p-3 text-white rounded border-2 focus:border-gray-500 text-sm resize-none min-h-[160px] ${ve[ct]?"bg-red-900/20 border-red-500":"bg-gray-700 border-gray-600"}`}),n.jsxs("div",{className:"absolute bottom-1 right-2 text-xs text-gray-400",children:[(X[ct]||"").length,"/500"]}),ve[ct]&&n.jsx("div",{className:"mt-1 text-xs text-red-400",children:ve[ct]})]})]})]}),n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{onClick:()=>Yr(ct),disabled:nt||(ne[ct]||[]).length===0&&!((At=H[ct])!=null&&At.trim())&&!((jt=X[ct])!=null&&jt.trim())||((ne[ct]||[]).length>0?1:0)+((Wt=H[ct])!=null&&Wt.trim()?1:0)+((Jt=X[ct])!=null&&Jt.trim()?1:0)>1,className:"px-6",children:[n.jsx(gc,{className:"h-4 w-4 mr-2"}),"Create Chord Charts"]})})]}),n.jsx("div",{className:"w-full p-6 border-2 border-dashed rounded-lg mt-4 bg-gray-800/10 border-gray-600/50",children:n.jsxs("div",{className:"text-center",children:[nt==="checking_transcripts"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-500"}),n.jsx("span",{className:"text-yellow-400",children:"Checking for transcripts..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>vr(ct),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),nt==="reading_transcript"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500"}),n.jsx("span",{className:"text-gray-400",children:"Reading transcript..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>vr(ct),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),nt==="uploading"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500"}),n.jsx("span",{className:"text-gray-400",children:"Uploading files..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>vr(ct),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),nt==="processing_transcript"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500"}),n.jsx("span",{className:"text-white",children:"Processing transcript..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>vr(ct),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),nt==="processing"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"text-white",children:Se[j]}),n.jsx("div",{className:"ml-2 animate-spin",children:"âš™ï¸"})]})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>vr(ct),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),nt==="complete"&&n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx(_n,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-green-400",children:"Chord charts created!"})]}),nt==="error"&&n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx(Bn,{className:"h-4 w-4 text-red-500"}),n.jsx("span",{className:"text-red-400",children:"Error processing files. Please try again."})]}),!nt&&n.jsx(n.Fragment,{children:a[ct]&&a[ct].length>0?n.jsxs(n.Fragment,{children:[n.jsx(Bn,{className:"h-8 w-8 text-orange-400 mx-auto mb-2"}),n.jsx("p",{className:"text-orange-300 font-medium mb-1",children:"Chord charts already exist"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Please delete all chord charts from this song before using autocreate"})]}):n.jsx(n.Fragment,{children:(ne[ct]||[]).length>0?n.jsxs(n.Fragment,{children:[n.jsx(dl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-300 font-medium mb-1",children:"Ready to create chord charts"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Click 'Create chord charts'"})]}):n.jsxs(n.Fragment,{children:[n.jsx(dl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-300 font-medium mb-1",children:"Add a file, paste a YouTube URL, or type in the 'Manual entry' box, then click 'Create Chord Charts'"}),n.jsx("p",{className:"text-gray-400 text-xs",children:"(The results will probably contain errors. Use the âœï¸edit icon on a chart to correct it.)"})]})})})]})})]})]}):n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsxs(Be,{variant:"outline",onClick:()=>ur(ct),className:"max-w-md text-orange-300 hover:bg-orange-800 hover:border-orange-600",children:[n.jsx(Ei,{className:"h-4 w-4 mr-2"}),"Replace with autocreated charts"]})})})(),n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsx(Be,{variant:"default",onClick:()=>{N({itemId:ct,scrollPosition:window.scrollY}),p(rt=>({...rt,[ct]:!0})),setTimeout(()=>{const rt=document.querySelector(`[data-editor-for-item="${ct}"]`);rt&&rt.scrollIntoView({behavior:"smooth",block:"start"})},100)},className:"min-w-48",children:"+ Add new chord"})}),n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsx(Be,{variant:"default",onClick:()=>yt(ct),className:"min-w-48",children:"+ Add new section"})}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4 max-w-2xl mx-auto",children:[n.jsx(Be,{variant:"default",onClick:()=>nn(ct),className:"flex-1",children:"Copy chord charts from other song"}),n.jsx(Be,{variant:"default",onClick:()=>Cn(ct),disabled:!a[ct]||a[ct].length===0,className:"flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:"Copy chord charts to other song"})]}),h[ct]&&n.jsx("div",{"data-editor-for-item":ct,children:n.jsx(Th,{itemId:ct,defaultTuning:((it=Et(ct))==null?void 0:it.H)||"EADGBE",editingChordId:b,insertionContext:u,onSave:rt=>wn(ct,rt),onCancel:()=>{p(rt=>({...rt,[ct]:!1})),m(null),w(null),rn()}})})]})})()}),de&&n.jsx(yc,{isOpen:de,onClose:()=>Le(!1)}),Ye&&n.jsx(Qs,{open:Ye,onOpenChange:ft,children:n.jsxs(Rs,{children:[n.jsxs(Ds,{children:[n.jsx(Ms,{children:"Cancel processing?"}),n.jsx(Us,{children:"This will stop the current autocreate operation. Any progress will be lost."})]}),n.jsxs(Bs,{children:[n.jsx(xa,{children:"Continue processing"}),n.jsx(Ss,{onClick:()=>{at&&kn(at),ft(!1),lt(null)},children:"Cancel processing"})]})]})}),bt&&n.jsx(Qs,{open:bt,onOpenChange:ut,children:n.jsxs(Rs,{children:[n.jsxs(Ds,{children:[n.jsxs(Ms,{className:"flex items-center space-x-2",children:[n.jsx(Bn,{className:"h-5 w-5 text-orange-500"}),n.jsx("span",{children:"Replace Existing Chord Charts"})]}),n.jsx(Us,{children:"This song already has chord charts. To use autocreate, all existing chord charts must be deleted first. This action cannot be undone."})]}),n.jsxs(Bs,{children:[n.jsx(xa,{onClick:()=>{ut(!1),gt(null)},children:"Cancel"}),n.jsx(Ss,{onClick:ns,className:"bg-orange-500 hover:bg-orange-600 text-white border-orange-500 shadow-lg font-medium",children:"Delete all & autocreate"})]})]})}),n.jsx(Fh,{isOpen:z,onClose:()=>{B(!1),me(null)},error:he}),n.jsx(yc,{isOpen:de,onClose:()=>{Le(!1),Te(null)},autocreateData:Ie})]})}),L&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100]",onClick:Hr,children:n.jsx("div",{className:`bg-gray-700 rounded-lg p-6 ${M||te==="complete"?"max-w-xs":"w-full max-w-md"} max-h-[80vh] flex flex-col`,onClick:ye=>ye.stopPropagation(),onWheel:ye=>ye.stopPropagation(),children:te==="complete"?n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Success!"}),n.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[n.jsx(_n,{className:"h-6 w-6 text-green-500"}),n.jsx("span",{className:"text-green-400 text-lg",children:"Chord charts copied successfully!"})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(Be,{onClick:Hr,className:"min-w-24 bg-green-600 hover:bg-green-700",children:"Done"})})]}):M?n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"âš ï¸ Confirm Overwrite"}),n.jsxs("p",{className:"text-gray-300 mb-4",children:["This will overwrite existing chord charts on ",F.size," song",F.size!==1?"s":"",". Continue?"]}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx(Be,{variant:"outline",onClick:()=>_(!1),className:"min-w-24",children:"Cancel"}),n.jsx(Be,{onClick:Pn,className:"min-w-24 bg-red-600 hover:bg-red-700",children:"Overwrite"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Copy Chord Charts"}),n.jsxs("p",{className:"text-gray-300 mb-2",children:['Copy chord charts from "',((Zr=i==null?void 0:i.find(ye=>ye.B===I))==null?void 0:Zr.C)||"Unknown Song",'" to:']}),n.jsx("input",{type:"text",placeholder:"Search songs...",value:Y,onChange:ye=>V(ye.target.value),className:"w-full p-2 mb-4 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500"}),n.jsx("div",{className:"flex-1 overflow-y-auto mb-4 min-h-0 modal-scroll",children:_t.map(ye=>n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx("input",{type:"checkbox",id:`copy-item-${ye.A}`,checked:O.has(ye.A),onChange:()=>Jr(ye.A),className:"mr-3"}),n.jsxs("label",{htmlFor:`copy-item-${ye.A}`,className:"text-white cursor-pointer flex-1 flex items-center",children:[n.jsx("span",{children:ye.C||"Untitled"}),F.has(ye.A)&&n.jsx("span",{className:"text-yellow-400 ml-2 text-sm",children:" âš ï¸will overwrite"})]})]},ye.A))}),n.jsxs("div",{className:"flex gap-2 justify-end",children:[n.jsx(Be,{variant:"outline",onClick:Hr,className:"min-w-24",children:"Cancel"}),n.jsx(Be,{onClick:Pn,disabled:O.size===0,style:O.size===0?{backgroundColor:"#4b5563",color:"#d1d5db",opacity:"1"}:F.size>0?{backgroundColor:"#dc2626",color:"#ffffff",opacity:"1"}:{backgroundColor:"#5b1f1f",color:"#ffffff",opacity:"1"},className:"bg-purple-600 hover:bg-purple-700 disabled:cursor-not-allowed",children:F.size>0?`Copy and Overwrite ${O.size} song${O.size!==1?"s":""}`:`Copy to ${O.size} song${O.size!==1?"s":""}`})]})]})})})]})}const tf=({className:r="h-5 w-5",title:t="Chord chart"})=>n.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:r,role:"img","aria-label":t,children:[n.jsx("line",{x1:"4",y1:"6",x2:"20",y2:"6",stroke:"currentColor",strokeWidth:"1.5"}),n.jsx("line",{x1:"4",y1:"10",x2:"20",y2:"10",stroke:"currentColor",strokeWidth:"0.8"}),n.jsx("line",{x1:"4",y1:"14",x2:"20",y2:"14",stroke:"currentColor",strokeWidth:"0.8"}),n.jsx("line",{x1:"4",y1:"18",x2:"20",y2:"18",stroke:"currentColor",strokeWidth:"0.8"}),n.jsx("line",{x1:"7",y1:"6",x2:"7",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"10",y1:"6",x2:"10",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"13",y1:"6",x2:"13",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"16",y1:"6",x2:"16",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"19",y1:"6",x2:"19",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"4",y1:"6",x2:"4",y2:"18",stroke:"currentColor",strokeWidth:"0.5"}),n.jsx("line",{x1:"3",y1:"3",x2:"5",y2:"5",stroke:"currentColor",strokeWidth:"1"}),n.jsx("line",{x1:"5",y1:"3",x2:"3",y2:"5",stroke:"currentColor",strokeWidth:"1"}),n.jsx("circle",{cx:"7",cy:"14",r:"1.5",fill:"currentColor"}),n.jsx("circle",{cx:"10",cy:"10",r:"1.5",fill:"currentColor"}),n.jsx("circle",{cx:"16",cy:"6",r:"1.5",fill:"currentColor"})]}),am=Bi.memo(({item:r,onEdit:t,onDelete:e,onOpenChordCharts:s})=>{const{attributes:i,listeners:a,setNodeRef:d,transform:o,transition:c,isDragging:h}=yl({id:r.B}),p={transform:bl.Transform.toString(o),transition:c,zIndex:h?1:0},b=async m=>{m.preventDefault(),m.stopPropagation(),await e(r.B)};return n.jsxs("div",{ref:d,style:p,className:`flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 sm:p-5 rounded-lg gap-3 ${h?"bg-gray-700":"bg-gray-800"}`,children:[n.jsxs("div",{className:"flex items-center min-w-0 flex-1",children:[n.jsx("div",{...i,...a,className:"flex-shrink-0","aria-label":"Drag to reorder item","data-ph-capture-attribute-drag":"item-drag-handle",children:n.jsx(wl,{className:"h-6 w-6 text-gray-500 mr-2 sm:mr-4 cursor-move","aria-hidden":"true"})}),n.jsx("span",{className:"text-base sm:text-xl",children:r.C})]}),n.jsxs("div",{className:"flex space-x-3 justify-end sm:justify-start flex-shrink-0",children:[n.jsxs(Be,{variant:"ghost",size:"lg",onClick:()=>t(r),className:"hover:bg-gray-700",title:"Edit item","data-ph-capture-attribute-button":"edit-item",children:[n.jsx(uo,{className:"h-5 w-5","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Edit item"})]}),n.jsxs(Be,{variant:"ghost",size:"lg",onClick:()=>s(r.B,r.C),className:"text-blue-400 hover:text-blue-300 hover:bg-gray-700",title:"Add or edit chord charts","data-ph-capture-attribute-button":"open-chord-charts-modal",children:[n.jsx(tf,{className:"h-5 w-5","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Chord charts"})]}),n.jsxs(Be,{variant:"ghost",size:"lg",onClick:b,className:"text-red-500 hover:text-red-400 hover:bg-gray-700",title:"Delete this item and remove it from all routines","data-ph-capture-attribute-button":"delete-item",children:[n.jsx(Sh,{className:"h-5 w-5","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Delete item"})]})]})]})}),im=({items:r=[],onItemsChange:t})=>{const[e,s]=U.useState(""),[i,a]=U.useState(!1),[d,o]=U.useState(!1),[c,h]=U.useState(!1),[p,b]=U.useState(null),[m,u]=U.useState(null),[w,g]=U.useState(!1),[N,y]=U.useState(null),[S,L]=U.useState(""),E=async M=>{d||u(M)},I=async()=>{if(m){a(!0);try{if(!(await fetch(`/api/items/${m}`,{method:"DELETE"})).ok)throw new Error("Failed to delete item");const _=r.find(te=>te.B===m);if(_){const te=_.C||`Item ${m}`;co("deleted","item",te)}t()}catch(M){console.error("Delete failed:",M)}finally{a(!1),u(null)}}},K=M=>{b(M),h(!0)},Y=(M,_)=>{y(M),L(_),g(!0)},V=async()=>{t(),b(null),h(!1)},O=()=>{o(!0)},Q=async({active:M,over:_})=>{if(o(!1),i||!M||!_||M.id===_.id)return;const te=r.findIndex(re=>re.B===M.id),ae=r.findIndex(re=>re.B===_.id);try{const se=cl(r,te,ae).map((je,ne)=>({A:je.B,G:ne}));if(!(await fetch("/api/items/order",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)})).ok)throw new Error("Failed to update items");t()}catch(re){console.error("Reorder failed:",re)}},F=Dc(Di(Uc,{activationConstraint:{delay:100,tolerance:5}}),Di(Mc,{coordinateGetter:Bc})),k=r.filter(M=>{if(!e)return!0;const _=(M==null?void 0:M.C)||"",te=se=>se.replace(/[''`]/g,"'"),ae=te(_.toLowerCase()),re=te(e.toLowerCase());return ae.includes(re)});return n.jsxs(n.Fragment,{children:[n.jsxs(cn,{className:"w-full max-w-4xl mx-auto bg-gray-900 text-gray-100",children:[n.jsxs(jn,{className:"flex flex-row items-center justify-between",children:[n.jsx(dn,{className:"text-2xl",children:"Practice items"}),n.jsx("div",{className:"flex items-center space-x-2",children:n.jsxs(Be,{className:"bg-blue-600 hover:bg-blue-700 text-lg px-4 py-6",onClick:()=>{b(null),h(!0)},"data-ph-capture-attribute-button":"add-new-item",children:[n.jsx(mo,{className:"mr-2 h-5 w-5","aria-hidden":"true"}),"Add item"]})})]}),n.jsxs(un,{children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("label",{htmlFor:"search-items-input",className:"sr-only",children:"Search practice items"}),n.jsx(Dr,{id:"search-items-input",type:"text",placeholder:"Search items...",value:e,onChange:M=>s(M.target.value),className:"w-full text-lg py-6 px-4",autoComplete:"off"})]}),n.jsx(al,{sensors:F,collisionDetection:il,onDragStart:O,onDragEnd:Q,children:n.jsx(ol,{items:k.map(M=>M.B),strategy:ll,children:n.jsx("div",{className:"space-y-4",children:k.map(M=>n.jsx(am,{item:M,onEdit:K,onDelete:E,onOpenChordCharts:Y},M.B))})})})]})]}),c&&n.jsx(R0,{open:c,onOpenChange:M=>{M||(b(null),h(!1))},item:p,onItemChange:V}),n.jsx(Qs,{open:!!m,onOpenChange:()=>u(null),children:n.jsxs(Rs,{children:[n.jsxs(Ds,{children:[n.jsx(Ms,{children:"Are you sure?"}),n.jsx(Us,{children:"This action cannot be undone. This will permanently delete the practice item and remove it from all routines."})]}),n.jsxs(Bs,{children:[n.jsx(xa,{children:"Cancel"}),n.jsx(Ss,{onClick:I,children:"Delete"})]})]})}),n.jsx(ef,{isOpen:w,onClose:()=>g(!1),itemId:N,itemTitle:S})]})},om=()=>{const[r,t]=U.useState(null),[e,s]=U.useState(!0),[i,a]=U.useState(null),[d,o]=U.useState(0),c=async()=>{try{const p=await fetch("/api/practice/active-routine/lightweight");if(!p.ok)throw new Error("Failed to fetch active routine");const b=await p.json();if(!b.active_id){t(null),a(null),s(!1);return}const m=b.items.sort((u,w)=>parseInt(u.routineEntry.C)-parseInt(w.routineEntry.C));t({id:b.active_id,name:b.name,items:m.map(u=>({...u.routineEntry,minimalDetails:u.itemMinimal}))}),a(null)}catch(p){a(p.message),console.error("Fetch error:",p)}finally{s(!1)}},h=async()=>{o(p=>p+1)};return U.useEffect(()=>{c()},[d]),{routine:r,loading:e,error:i,refreshRoutine:h}},lm=()=>{const[r,t]=U.useState({}),[e,s]=U.useState(new Set),[i,a]=U.useState(null),d=U.useCallback(async p=>{if(r[p])return r[p];if(e.has(p))return null;try{s(u=>new Set([...u,p])),a(null);const b=await fetch(`/api/items/${p}`);if(!b.ok)throw new Error(`Failed to fetch item details: ${b.statusText}`);const m=await b.json();return t(u=>({...u,[p]:m})),m}catch(b){return a(b.message),console.error("Error fetching item details:",b),null}finally{s(b=>{const m=new Set(b);return m.delete(p),m})}},[r,e]),o=U.useCallback(p=>r[p]||null,[r]),c=U.useCallback(p=>e.has(p),[e]),h=U.useCallback(()=>{t({}),s(new Set),a(null)},[]);return{fetchItemDetails:d,getItemDetails:o,isLoadingItem:c,error:i,clearCache:h}},cm=(r,t)=>{let e;return function(...i){const a=()=>{clearTimeout(e),r(...i)};clearTimeout(e),e=setTimeout(a,t)}},dm=({className:r,...t})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:r,"aria-hidden":"true",...t,children:n.jsx("path",{d:"M8 5v14l11-7z"})}),um=({className:r,...t})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:r,"aria-hidden":"true",...t,children:n.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}),Bd=({className:r,...t})=>n.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:r,"aria-hidden":"true",...t,children:n.jsx("path",{d:"M17.65 6.35A7.958 7.958 0 0012 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0112 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})}),Md=r=>{const t=Math.floor(r/60),e=Math.floor(r%60);return`${t}:${e.toString().padStart(2,"0")}`},Ud=r=>{const t=Math.floor(r/60),e=r%60;return`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`},hm=U.memo(({chart:r,onEdit:t,onDelete:e,onInsertAfter:s})=>{const i=U.useRef(null);return U.useEffect(()=>{if(!i.current)return;(()=>{if(!(!window.svguitar||!i.current))try{const d=r.chordData||r;i.current.innerHTML="";const o=new window.svguitar.SVGuitarChord(i.current),c={strings:d.numStrings||6,frets:d.numFrets||5,position:d.startingFret||1,tuning:[],width:176,height:248,fretSize:1.2,fingerSize:.75,sidePadding:.2,fontFamily:"Arial",color:"#ffffff",backgroundColor:"transparent",strokeColor:"#ffffff",textColor:"#ffffff",fretLabelColor:"#ffffff",fingerTextColor:"#000000",fingerTextSize:28},b={fingers:[...(d.fingers||[]).map(m=>{const[u,w,g]=m;return g&&g!=="undefined"?[u,w,g]:[u,w]}),...(d.openStrings||[]).map(m=>[m,0]),...(d.mutedStrings||[]).map(m=>[m,"x"])],barres:d.barres||[]};o.configure(c).chord(b).draw(),setTimeout(()=>{var u;const m=(u=i.current)==null?void 0:u.querySelector("svg");m&&(m.style.width="100%",m.style.height="100%",m.style.maxWidth="144px",m.style.maxHeight="154px",m.style.position="relative",m.style.zIndex="1",m.setAttribute("role","img"),m.setAttribute("aria-label",fm(r)))},50)}catch(d){console.error("Error rendering memoized chord chart:",d)}})()},[r]),n.jsxs("div",{className:"bg-gray-800 p-1 rounded-lg relative","data-chord-id":r.id,style:{minWidth:"0",maxWidth:"100%",width:"100%",position:"relative"},children:[n.jsx("button",{onClick:a=>{a.stopPropagation(),t(r.id,r)},className:"absolute bottom-1 left-1 w-6 h-6 text-gray-400 hover:text-gray-200 flex items-center justify-center text-sm transition-colors cursor-pointer z-20 bg-gray-900 bg-opacity-75 rounded shadow-lg",title:"Edit chord chart",style:{position:"absolute",bottom:"4px",left:"4px",zIndex:20},"aria-label":"Edit chord chart","data-ph-capture-attribute-button":"edit-chord-chart",children:"âœï¸"}),n.jsx("button",{onClick:a=>{a.stopPropagation(),e(r.id)},className:"absolute bottom-1 right-1 w-6 h-6 text-red-500 hover:text-red-700 flex items-center justify-center text-lg font-black transition-colors cursor-pointer z-20 bg-gray-900 bg-opacity-75 rounded shadow-lg",title:"Delete chord chart",style:{position:"absolute",bottom:"4px",right:"4px",zIndex:20},"aria-label":"Delete chord chart","data-ph-capture-attribute-button":"delete-chord-chart",children:"Ã—"}),s&&n.jsx("button",{onClick:a=>{a.stopPropagation(),s(r.id,r)},className:"absolute bottom-1 right-8 w-6 h-6 bg-blue-500 hover:bg-blue-400 text-white rounded-full flex items-center justify-center text-sm font-bold transition-colors cursor-pointer z-20 shadow-lg",title:"Insert chord after this one",style:{position:"absolute",bottom:"4px",right:"32px",zIndex:20},"aria-label":"Insert chord after this one","data-ph-capture-attribute-button":"insert-chord-after",children:"+"}),n.jsx("div",{className:"relative mx-auto flex items-center justify-center overflow-hidden",style:{width:"144px",height:"154px"},children:n.jsx("div",{ref:i,className:"w-full h-full"})}),n.jsx("div",{className:"text-sm font-semibold mt-2 text-center text-gray-300",children:r.title})]})}),fm=r=>{const t=r.chordData||r,s=[`${r.title||"Chord"} chord diagram.`],i=t.fingers||[];if(i.length>0){const c=i.map(h=>{const[p,b,m]=h,u=7-p,w=m?` with finger ${m}`:"";return`string ${u} fret ${b}${w}`});s.push(`Finger positions: ${c.join(", ")}.`)}const a=t.openStrings||[];if(a.length>0){const c=a.map(h=>7-h).sort((h,p)=>h-p);s.push(`Open strings: ${c.join(", ")}.`)}const d=t.mutedStrings||[];if(d.length>0){const c=d.map(h=>7-h).sort((h,p)=>h-p);s.push(`Muted strings: ${c.join(", ")}.`)}const o=t.barres||[];if(o.length>0){const c=o.map(h=>{const p=7-h.fromString,b=7-h.toString;return`Barre at fret ${h.fret} from string ${p} to ${b}`});s.push(`${c.join(". ")}.`)}return s.join(" ")},Ai=r=>r.replace(/[''`"]/g,"'").replace(/[â€“â€”âˆ’]/g,"-").replace(/\s+/g," ").trim().toLowerCase(),zd=r=>r.replace(/\s*\([^)]*\)\s*/g,"").trim(),$l=(r,t,e)=>{const s=zd(r),i=Ai(s);return ze("CopyCharts","findSimilarSongs - sourceTitle:",r,"-> baseName:",s,"-> normalized:",i),t.filter(a=>{if(a.B===e)return!1;const d=a.C||"",o=zd(d),c=Ai(o),h=i===c||i.length>3&&c.includes(i)||c.length>3&&i.includes(c);return(d.toLowerCase().includes("feelin")||d.toLowerCase().includes("alright"))&&(ze("CopyCharts","Checking item:",d,"-> itemBaseName:",o,"-> normalized:",c,"-> matches:",h),ze("CopyCharts","  normalizedBaseName:",i),ze("CopyCharts","  normalizedItemBaseName:",c)),h})},pm=()=>{var $t,Kt,lr;const{routine:r}=om(),{fetchItemDetails:t,getItemDetails:e,isLoadingItem:s}=lm();Mi();const{items:i}=Ph(),[a,d]=U.useState(new Set),[o,c]=U.useState(new Set),[h,p]=U.useState(new Set),[b,m]=U.useState({}),[u,w]=U.useState(!1),[g,N]=U.useState(null),[y,S]=U.useState({}),[L,E]=U.useState(new Set),[I,K]=U.useState({}),[Y,V]=U.useState({}),[O,Q]=U.useState({}),[F,k]=U.useState(new Set),[M,_]=U.useState(null),[te,ae]=U.useState(null),[re,se]=U.useState(null),[ie,je]=U.useState(!1),[ne,A]=U.useState(null),[H,Z]=U.useState(""),[X,pe]=U.useState(new Set),[ve,ke]=U.useState(new Set),[Ae,De]=U.useState(!1),[Me,Ke]=U.useState(!1),[Se,j]=U.useState(null),[P,G]=U.useState({}),[$,z]=U.useState(null),[B,he]=U.useState(!1),[me,de]=U.useState(""),[Le,Ie]=U.useState(null),[Te,Ye]=U.useState(null),[ft,at]=U.useState({}),[lt,bt]=U.useState({}),[ut,Yt]=U.useState({}),[gt,Et]=U.useState(0),[qt,Pt]=U.useState([]),[vt,Zt]=U.useState(!1),[_t,Ot]=U.useState(!1),[ir,Rt]=U.useState(""),[yt,Qt]=U.useState(null),[tr,Br]=U.useState({}),[wn,rn]=U.useState(!1),[zt,mn]=U.useState(null),[vn,Yr]=U.useState(!1),[Wr,yr]=U.useState(null),[Lr,ur]=U.useState(!1),[ns,vr]=U.useState(null),[kn,nn]=U.useState(!1),[Cn,Hr]=U.useState(null),[Jr,Pn]=U.useState({}),[ct,Zr]=U.useState({}),[ye,qe]=U.useState({}),[He,et]=U.useState(!1),[it,rt]=U.useState(null),[nt,ot]=U.useState(""),[At,jt]=U.useState(!1),[Wt,Jt]=U.useState(!1),[xt,Ht]=U.useState(null),or=["âœ¨ Claude is making magic happen","âœ¨ Claude is *still* making magic happen","Yeah, we all love instant gratification, but it'll still be quicker than you could do it from scratch","Are you familiar with the phrase 'A watched pot never boils'? It's kinda like that","Chill, I'm working on it.","You could be stretching or something while you wait, couldn't you?","The pyramids weren't built in a day... ","but hey, at least I'm not going to ask you for an email address to send the chord charts to.","Perfect chord charts take time to craft. These will take less time and they won't be perfect.","Yeah, I could show you a progress bar, but we both know it would just lie to you","This is taking precisely as long as it needs to take","Meanwhile, your guitar is getting dusty just sitting there...","Quality over speed, as they say in the chord chart business. We'll see which this turns out to be","Calculating the optimal finger placement for maximum laziness...","Teaching AI to read guitar tabs is harder than teaching humans, surprisingly","Processing at the speed of artisanal chord crafting","Your patience is being converted into beautiful chord diagrams","Still faster than drawing the chord charts by hand","Fun fact: I process thousands of tokens per second, but this still takes a while. Go figure.","At least you're not on hold listening to elevator music right now","I'd apologize for the wait, but I'm kinda busy with building your chord charts","Remember when you had to buy chord books? Yeah, this is still better than that","I'm doing math that would make your guitar teacher's head spin. Or maybe just mild geometry.","Analyzing fret positions with the intensity of a guitarist tuning by ear in a loud bar","If you're wondering why this takes so long: perfectionism. Just kidding, it's token processing limits.","Good news: I found all the chords. Bad news: I'm still drawing the little dots","Pro tip: This wait time is perfect for questioning your life choices that led to learning Wonderwall","Yes, I could work faster, but then where would the suspense be?","Translating guitar hieroglyphics into something your fingers can actually use...","Automating what should have been automated decades ago. You're welcome.","The AI is thinking. Or maybe procrastinating. Hard to tell, really.","Breaking news: Local AI still processing, guitarist growing older by the second","This would go faster if you stopped watching. Seriously, go practice your scales or something.","Reminder: You could have practiced barre chords for 2 minutes by now. Just saying.","I promise this is the most interesting thing happening on your screen right now. Probably.","Currently debating whether that's a Cadd9 or just someone's finger slipped on the photo"],Tn=T=>{const ue=I[T]||[];if(ze("ChordCharts",`getChordSections for item ${T}:`,ue),ue.length===0)return[];const ge=new Map;return ue.forEach(fe=>{const Ne=fe.sectionId||"section-1",Fe=fe.sectionLabel||"Verse",$e=fe.sectionRepeatCount||"";ze("ChordCharts",`Processing chord ${fe.id} (${fe.title}) for section ${Ne}`,{chordSectionId:fe.sectionId,chordSectionLabel:fe.sectionLabel,fallbackUsed:!fe.sectionId}),ge.has(Ne)||ge.set(Ne,{id:Ne,label:Fe,repeatCount:$e,chords:[]}),ge.get(Ne).chords.push(fe)}),Array.from(ge.values())},bs=T=>{if(T.length===0)return[];const ue=new Map;T.forEach(xe=>{const fe=xe.sectionId||"section-1",Ne=xe.sectionLabel||"Verse",Fe=xe.sectionRepeatCount||"";ue.has(fe)||ue.set(fe,{id:fe,label:Ne,repeatCount:Fe,chords:[]}),ue.get(fe).chords.push(xe)});const ge=Array.from(ue.values()).sort((xe,fe)=>{const Ne=Math.min(...xe.chords.map($e=>$e.order||0)),Fe=Math.min(...fe.chords.map($e=>$e.order||0));return Ne-Fe});return ge.forEach(xe=>{xe.chords.sort((fe,Ne)=>(fe.order||0)-(Ne.order||0))}),ge},Ar=(T,ue="New Section")=>{ze("Section","Adding new section for item:",T,"with label:",ue);const ge={id:`section-${Date.now()}`,label:ue,repeatCount:"",chords:[]};Q(xe=>{const fe={...xe,[T]:[...xe[T]||[],ge]};return ze("Section","Updated chordSections:",fe),fe})},Ve=U.useCallback(cm(async(T,ue,ge)=>{ze("Section","Debounced section update:",ue,ge);try{const xe=await fetch(`/api/items/${T}/chord-charts`);if(!xe.ok)throw new Error(`Failed to fetch chord charts for item ${T}`);const Ne=await xe.json();ze("ChordCharts",`Fresh charts for item ${T}:`,Ne.map(Ze=>({id:Ze.id,title:Ze.title,sectionId:Ze.sectionId||"default-section"})));const Fe=Ne.filter(Ze=>(Ze.sectionId||"section-1")===ue);if(Fe.length===0){ze("Section",`No chord charts to update for section: ${ue}. This might be a new section without any chord charts yet.`);return}ze("Section",`Updating ${Fe.length} chord charts for section ${ue}:`,Fe.map(Ze=>Ze.id));const $e=Fe.map(Ze=>{const ht={};return ge.label!==void 0&&(ht.sectionLabel=ge.label),ge.repeatCount!==void 0&&(ht.sectionRepeatCount=ge.repeatCount),ze("Section",`Updating chord chart ${Ze.id} with:`,ht),fetch(`/api/chord-charts/${Ze.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ht)}).then(Qe=>{if(!Qe.ok)throw new Error(`Failed to update chord chart ${Ze.id}: ${Qe.status} ${Qe.statusText}`);return Qe.json()})});await Promise.all($e),ze("Section",`Successfully persisted ${Fe.length} chord charts for section ${ue}`)}catch(xe){console.error("Error persisting section updates:",xe)}},500),[]),pt=(T,ue,ge)=>{Q(xe=>({...xe,[T]:(xe[T]||[]).map(fe=>fe.id===ue?{...fe,...ge}:fe)})),K(xe=>({...xe,[T]:(xe[T]||[]).map(fe=>(fe.sectionId||"section-1")===ue?{...fe,sectionLabel:ge.label!==void 0?ge.label:fe.sectionLabel,sectionRepeatCount:ge.repeatCount!==void 0?ge.repeatCount:fe.sectionRepeatCount}:fe)})),Ve(T,ue,ge)},hr=async(T,ue)=>{if(!T){console.error("ERROR: deleteSection called with empty itemId",{itemId:T,sectionId:ue});return}const ge=`${T}-${ue}`;if(F.has(ge)){ze("Section",`Delete already in progress for section ${ue}`);return}k(xe=>new Set([...xe,ge]));try{const xe=(I[T]||[]).filter($e=>($e.sectionId||"section-1")===ue);if(xe.length===0){ze("Section",`No chord charts to delete in section ${ue}`),Q($e=>({...$e,[T]:($e[T]||[]).filter(Ze=>Ze.id!==ue)}));return}const fe=xe.map($e=>$e.id);ze("Section",`Batch deleting ${xe.length} chord charts from section ${ue}:`,fe),ze("Section",`Sending item_id=${T} to batch-delete endpoint`);const Ne=await fetch("/api/chord-charts/batch-delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({chord_ids:fe,item_id:T})});if(!Ne.ok){if(Ne.status===429){const $e=await Ne.json();console.warn("Rate limit exceeded, will retry after delay"),alert(`Rate limit exceeded. Please wait a moment and try again. (${$e.error})`);return}throw new Error(`HTTP ${Ne.status}: Failed to batch delete chord charts`)}const Fe=await Ne.json();if(ze("Section","Batch delete result:",Fe),Fe.deleted&&Fe.deleted.length>0&&ze("Section",`Successfully deleted ${Fe.deleted.length} chord charts`),Fe.not_found&&Fe.not_found.length>0&&console.warn(`${Fe.not_found.length} chord charts were already deleted:`,Fe.not_found),Fe.failed&&Fe.failed.length>0&&console.error(`Failed to delete ${Fe.failed.length} chord charts:`,Fe.failed),K($e=>({...$e,[T]:($e[T]||[]).filter(Ze=>(Ze.sectionId||"section-1")!==ue)})),Q($e=>({...$e,[T]:($e[T]||[]).filter(Ze=>Ze.id!==ue)})),!Fe.success&&Fe.failed&&Fe.failed.length===fe.length)throw new Error(Fe.error||"All chord chart deletions failed")}catch(xe){console.error("Error deleting section:",xe)}finally{k(xe=>{const fe=new Set(xe);return fe.delete(ge),fe})}},Vr=U.useCallback(async()=>{if(ze("ChordCharts","loadAllChordCharts called"),!r||!r.items)return;const T=r.items.map(ge=>ge.B),ue=T.filter(ge=>!I[ge]);if(ze("ChordCharts","All routine items:",T,"Items needing loading:",ue,"Current chordCharts keys:",Object.keys(I)),ue.length!==0)try{const ge=await fetch("/api/chord-charts/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_ids:ue})});if(ge.ok){const fe=await ge.json();K(Ne=>({...Ne,...fe})),Object.entries(fe).forEach(([Ne,Fe])=>{if(Fe.length===0)Q($e=>({...$e,[Ne]:[]}));else{const $e=new Map;Fe.forEach(ht=>{const Qe=ht.sectionId||"section-1",dt=ht.sectionLabel||"Verse",we=ht.sectionRepeatCount||"";$e.has(Qe)||$e.set(Qe,{id:Qe,label:dt,repeatCount:we,chords:[]}),$e.get(Qe).chords.push(ht)});const Ze=Array.from($e.values());Q(ht=>({...ht,[Ne]:Ze}))}})}}catch(ge){console.error("Error batch loading chord charts:",ge)}},[r]);U.useEffect(()=>{ze("ChordCharts","useEffect triggered for routine/loadAllChordCharts"),r&&r.items&&(Vr(),b0(r.name))},[r,Vr]),U.useEffect(()=>{if(X.size>0){const T=new Set;X.forEach(ue=>{const ge=i==null?void 0:i.find(Ne=>Ne.A===ue),xe=ge==null?void 0:ge.B;(I[xe]||[]).length>0&&T.add(ue)}),ke(T)}else ke(new Set)},[X,I,i]),U.useEffect(()=>{if(Object.values(P).filter(fe=>fe==="processing").length===0){Et(0),Pt([]);return}Et(0);const ge=Array.from({length:or.length-1},(fe,Ne)=>Ne+1).sort(()=>Math.random()-.5);Pt(ge);const xe=setInterval(()=>{Pt(fe=>{if(fe.length===0){const Fe=Array.from({length:or.length},(ht,Qe)=>Qe).sort(()=>Math.random()-.5),$e=Fe[0],Ze=Fe.slice(1);return Et($e),Ze}else{const Ne=fe[0],Fe=fe.slice(1);return Et(Ne),Fe}})},1e4);return()=>clearInterval(xe)},[P,or.length]);const zr=async T=>{if(!I[T])try{const ue=await fetch(`/api/items/${T}/chord-charts`);if(ue.ok){const ge=await ue.json(),xe=ge;if(K(Ne=>({...Ne,[T]:xe})),xe.length===0){Q(Ne=>({...Ne,[T]:[]}));return}const fe=new Map;xe.forEach(Ne=>{const Fe=Ne.sectionId||"section-1",$e=Ne.sectionLabel||"Verse",Ze=Ne.sectionRepeatCount||"";fe.has(Fe)||fe.set(Fe,{id:Fe,label:$e,repeatCount:Ze,chords:[]}),fe.get(Fe).chords.push(Ne)}),Q(Ne=>({...Ne,[T]:Array.from(fe.values())})),ze("ChordCharts","Loaded chord charts for item:",T,ge.length)}}catch(ue){console.error("Error loading chord charts for item:",T,ue)}},Er=U.useMemo(()=>r!=null&&r.items?new Set(r.items.filter(T=>T.D==="TRUE").map(T=>T.A)):new Set,[r]),[Jn,ba]=U.useState(new Set),Kr=U.useRef(null),wa=U.useRef(null),Fr=U.useRef(null),va=U.useRef(null);U.useEffect(()=>{Kr.current=new(window.AudioContext||window.webkitAudioContext),wa.current=Kr.current.createGain();const T=localStorage.getItem("gpra_timer_volume"),ue=T!==null?parseFloat(T):5.5;return wa.current.gain.value=ue/11*3,wa.current.connect(Kr.current.destination),fetch("/static/sound/timesUp.mp3").then(ge=>ge.arrayBuffer()).then(ge=>Kr.current.decodeAudioData(ge)).then(ge=>{va.current=ge}).catch(ge=>console.error("Error loading sound:",ge)),()=>{Kr.current&&Kr.current.close()}},[]),U.useEffect(()=>{const T=setInterval(()=>{S(ue=>{const ge={...ue};let xe=!1;return h.forEach(fe=>{ge[fe]>0&&(ge[fe]=ge[fe]-1,xe=!0,ge[fe]===0&&(Fr.current&&Fr.current.stop(),va.current&&Kr.current&&(Fr.current=Kr.current.createBufferSource(),Fr.current.buffer=va.current,Fr.current.connect(wa.current),Fr.current.start(),ze("AUDIO","Timer completion sound played"))))}),xe?ge:ue})},1e3);return ze("Timer","Active timers:",Array.from(h)),()=>{clearInterval(T),Fr.current&&(Fr.current.stop(),Fr.current=null)}},[h]),U.useEffect(()=>{ba(Er)},[Er]);const Na=U.useCallback(async T=>{try{const ue=await fetch(`/api/items/${T}/notes`);if(!ue.ok)throw new Error("Failed to fetch notes");const ge=await ue.json();ge.notes&&m(xe=>({...xe,[T]:ge.notes}))}catch(ue){console.error("Error fetching notes:",ue)}},[]),Ws=U.useMemo(()=>{if(!ne||!i)return new Set;const T=i.find(xe=>xe.B===ne),ue=(T==null?void 0:T.C)||"",ge=i.filter(xe=>xe.B!==ne);return new Set($l(ue,ge,ne).map(xe=>xe.A))},[ne,i]),Hs=U.useMemo(()=>i?i.filter(T=>{if(T.B===ne)return!1;if(H.trim()){const ue=T.C||"",ge=Ai(ue),xe=Ai(H);return xe?(ze("Search",`"${H}" -> "${xe}" searching in "${ue}" -> "${ge}" -> match: ${ge.includes(xe)}`),ge.includes(xe)):!0}return!0}).sort((T,ue)=>{if(H.trim()){const Fe=T.C||"",$e=ue.C||"";return Fe.localeCompare($e)}const ge=Ws.has(T.A),xe=Ws.has(ue.A);if(ge&&!xe)return-1;if(!ge&&xe)return 1;const fe=T.C||"",Ne=ue.C||"";return fe.localeCompare(Ne)}):[],[i,ne,H,Ws]),$a=U.useMemo(()=>{if(!Te||!i)return new Set;const T=i.find(xe=>xe.B===Te),ue=(T==null?void 0:T.C)||"",ge=i.filter(xe=>xe.B!==Te);return new Set($l(ue,ge,Te).map(xe=>xe.A))},[Te,i]),ci=U.useMemo(()=>i?i.filter(T=>{if(T.B===Te)return!1;if(me.trim()){const ue=T.C||"",ge=Ai(ue),xe=Ai(me);return xe?ge.includes(xe):!0}return!0}).sort((T,ue)=>{if(me.trim()){const Fe=T.C||"",$e=ue.C||"";return Fe.localeCompare($e)}const ge=$a.has(T.A),xe=$a.has(ue.A);if(ge&&!xe)return-1;if(!ge&&xe)return 1;const fe=T.C||"",Ne=ue.C||"";return fe.localeCompare(Ne)}):[],[i,Te,me,$a]),[na,_a]=U.useState({});U.useEffect(()=>{B&&i&&Object.keys(na).length===0&&(async()=>{const ue={},ge=i.map(xe=>xe.B);try{const xe=await fetch("/api/chord-charts/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_ids:ge})});if(xe.ok){const fe=await xe.json();Object.entries(fe).forEach(([Ne,Fe])=>{ue[Ne]=(Fe||[]).length}),_a(ue)}}catch(xe){console.error("Error loading chord chart counts:",xe)}})()},[B,i,na]);const di=U.useMemo(()=>ci.filter(T=>{const ue=T.B;return na[ue]>0}),[ci,na]);U.useEffect(()=>{const T=ue=>{ue.key==="Escape"&&(ie?Zn():B?Sa():Me?(Ke(!1),j(null)):wn?rn(!1):vn?Yr(!1):vt?Zt(!1):Lr?ur(!1):He?(et(!1),rt(null),ot("")):At&&jt(!1))};return document.addEventListener("keydown",T),()=>document.removeEventListener("keydown",T)},[ie,B,Me,wn,vn,vt,Lr,He,At]);const Mn=U.useCallback((T,ue)=>{ze("Timer",`Initializing timer for item ${T} with duration ${ue} minutes`),S(ge=>ge[T]?ge:{...ge,[T]:ue*60})},[]),ui=async T=>{d(ue=>{const ge=new Set(ue);if(ge.has(T))ge.delete(T);else{ge.add(T);const xe=r.items.find(fe=>fe.A===T);if(xe){const fe=xe.B;t(fe).then(Ne=>{Ne&&(Mn(T,Ne.E||5),Na(fe))})}}return ge})},Cs=async(T,ue=!0)=>{const ge=r.items.find(xe=>xe.A===T);if(ge){if(ue&&Kr.current&&Kr.current.state==="suspended")try{await Kr.current.resume(),ze("AUDIO","AudioContext resumed after user interaction")}catch(xe){console.error("[AUDIO] Failed to resume AudioContext:",xe)}if(Fr.current&&Fr.current.stop(),!y[T]){ze("Timer",`Timer ${T} not found, initializing...`);const xe=e(ge.B),fe=(xe==null?void 0:xe.E)||5;Mn(T,fe)}p(xe=>{const fe=new Set(xe),Ne=e(ge.B),Fe=(Ne==null?void 0:Ne.C)||`Item ${T}`;return ze("Timer",`Activating timer ${T}`),fe.add(T),Mo("started_timer",Fe),fe})}},Wa=async()=>{localStorage.setItem("timerSoundModalDismissed","true"),sessionStorage.setItem("timerSoundModalDismissedSession","true"),window.posthog&&window.posthog.capture("timer_sound_modal_dismissed",{action:"got_it",$set:{timer_sound_modal_dismissed:!0}}),Jt(!1),xt&&(await Cs(xt,!0),Ht(null))},hi=async()=>{sessionStorage.setItem("timerSoundModalDismissedSession","true"),Jt(!1),xt&&(await Cs(xt,!0),Ht(null))},Vt=async(T,ue)=>{ue==null||ue.stopPropagation();const ge=r.items.find(xe=>xe.A===T);if(ge)if(h.has(T))Fr.current&&Fr.current.stop(),p(fe=>{const Ne=new Set(fe),Fe=e(ge.B),$e=(Fe==null?void 0:Fe.C)||`Item ${T}`;ze("Timer",`Deactivating timer ${T}`),Ne.delete(T);const Ze=((Fe==null?void 0:Fe.E)||5)*60,ht=y[T]||Ze,Qe=Ze-ht;return Mo("timer_stopped",$e,{time_elapsed_seconds:Math.max(0,Qe),initial_duration_minutes:(Fe==null?void 0:Fe.E)||5}),Ne});else{if(Kr.current&&Kr.current.state==="suspended")try{await Kr.current.resume(),ze("AUDIO","AudioContext state after resume:",Kr.current.state)}catch(Fe){ze("AUDIO","Resume failed:",Fe)}const fe=localStorage.getItem("timerSoundModalDismissed")==="true",Ne=sessionStorage.getItem("timerSoundModalDismissedSession")==="true";fe||Ne?await Cs(T,!0):(ze("AUDIO","First timer start this session, showing sound info modal"),Ht(T),Jt(!0))}},fi=async(T,ue)=>{ue==null||ue.stopPropagation();const ge=!Jn.has(T);try{const xe=await fetch(`/api/routines/${r.id}/items/${T}/complete`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({completed:ge})});if(!xe.ok)throw new Error("Failed to update completion state");(await xe.json()).success&&ba(Ne=>{const Fe=new Set(Ne);if(ge){Fe.add(T);const $e=r.items.find(ht=>ht.A===T);if($e){const ht=e($e.B),Qe=(ht==null?void 0:ht.C)||`Item ${T}`,dt=((ht==null?void 0:ht.E)||5)*60,we=y[T]||dt,wt=dt-we;Mo("marked_done",Qe,{time_elapsed_seconds:Math.max(0,wt),was_timer_active:h.has(T),initial_duration_minutes:(ht==null?void 0:ht.E)||5})}p(ht=>{const Qe=new Set(ht);return Qe.delete(T),Qe});const Ze=r.items.findIndex(ht=>ht.A===T);d(ht=>{const Qe=new Set(ht);if(Qe.delete(T),Ze<r.items.length-1){const dt=r.items[Ze+1];Qe.add(dt.A);const we=dt.B;t(we).then(wt=>{wt&&(Mn(dt.A,wt.E||5),Na(we))})}return Qe})}else Fe.delete(T);return Fe})}catch(xe){console.error("Error updating completion state:",xe)}},pi=async(T,ue)=>{if(ue==null||ue.stopPropagation(),Kr.current&&Kr.current.state==="suspended")try{await Kr.current.resume(),ze("AUDIO","AudioContext resumed after user interaction")}catch(xe){console.error("[AUDIO] Failed to resume AudioContext:",xe)}Fr.current&&Fr.current.stop();const ge=r.items.find(xe=>xe.A===T);if(ge){const xe=e(ge.B),fe=(xe==null?void 0:xe.E)||5,Ne=(xe==null?void 0:xe.C)||`Item ${T}`;S(Fe=>({...Fe,[T]:fe*60})),Mo("timer_reset",Ne)}},zi=async(T,ue)=>{ue==null||ue.stopPropagation(),N(T),w(!0)},As=async()=>{await Na(g),N(null)},ws=(T,ue)=>{ue==null||ue.stopPropagation(),c(ge=>{const xe=new Set(ge);return xe.has(T)?xe.delete(T):xe.add(T),xe})},qi=async T=>{T==null||T.stopPropagation();try{if(!(await fetch(`/api/routines/${r.id}/reset`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Failed to reset progress");ba(new Set)}catch(ue){console.error("Error resetting progress:",ue)}},{totalMinutes:$i,completedMinutes:sa}=U.useMemo(()=>{if(!(r!=null&&r.items))return{totalMinutes:0,completedMinutes:0};const T=r.items.reduce((ge,xe)=>{const fe=e(xe.B),Ne=parseInt(fe==null?void 0:fe.E)||5;return ge+Ne},0),ue=r.items.filter(ge=>Jn.has(ge.A)).reduce((ge,xe)=>{const fe=e(xe.B),Ne=parseInt(fe==null?void 0:fe.E)||5;return ge+Ne},0);return{totalMinutes:T,completedMinutes:ue}},[r,Jn,e]);U.useEffect(()=>{if(!window.svguitar){const T=document.createElement("script");T.src="https://omnibrain.github.io/svguitar/js/svguitar.umd.js",T.async=!0,document.body.appendChild(T)}},[]);const ja=(T,ue)=>{ue==null||ue.stopPropagation(),E(ge=>{const xe=new Set(ge);if(xe.has(T))xe.delete(T);else{xe.add(T);const fe=r.items.find(Ne=>Ne.A===T);if(fe){const Ne=fe.B;zr(Ne)}}return xe})},aa=async(T,ue)=>{var ge;try{Td("Saving chord chart for item",{itemId:T,chartData:ue}),en("PracticePage handleSaveChordChart called",{editingChordId:M,chartData:ue});const xe=ue.editingChordId;en("PracticePage isUpdate check result",{isUpdate:xe,editingChordIdFromState:M,editingChordIdFromChartData:ue.editingChordId});let fe={...ue};if(xe){const Qe=(I[T]||[]).find(dt=>dt.id===ue.editingChordId);fe.sectionId=Qe==null?void 0:Qe.sectionId,fe.sectionLabel=Qe==null?void 0:Qe.sectionLabel,fe.sectionRepeatCount=Qe==null?void 0:Qe.sectionRepeatCount,en("Updating chord, preserving section",{originalSection:{id:Qe==null?void 0:Qe.sectionId,label:Qe==null?void 0:Qe.sectionLabel,repeatCount:Qe==null?void 0:Qe.sectionRepeatCount}})}else{const Qe=O[T]||Tn(T);let dt;ue.insertionContext?dt={id:ue.insertionContext.sectionId,label:ue.insertionContext.sectionLabel,repeatCount:ue.insertionContext.sectionRepeatCount}:Qe.length===0?dt={id:"section-1",label:"Verse",repeatCount:""}:dt=Qe[Qe.length-1],fe.sectionId=dt.id,fe.sectionLabel=dt.label,fe.sectionRepeatCount=dt.repeatCount}fe.hasLineBreakAfter=ue.startOnNewLine||!1,en("Setting line break after chord",{title:fe.title,hasLineBreakAfter:fe.hasLineBreakAfter}),en("Chord data with section metadata",{chartDataWithSection:fe});const Ne=xe?`/api/chord-charts/${ue.editingChordId}`:`/api/items/${T}/chord-charts`,Fe=xe?"PUT":"POST";en(`${xe?"Updating":"Creating"} chord chart`,{method:Fe,url:Ne}),ze("LineBreaks","Sending to server:",{title:fe.title,hasLineBreakAfter:fe.hasLineBreakAfter});const $e=await fetch(Ne,{method:Fe,headers:{"Content-Type":"application/json"},body:JSON.stringify(fe)});if(!$e.ok)throw new Error(`Failed to save chord chart: ${$e.statusText}`);const Ze=await $e.json();if(Td("Chord chart saved successfully",{savedChart:Ze}),ze("LineBreaks","Server returned:",{id:Ze.id,title:Ze.title,hasLineBreakAfter:Ze.hasLineBreakAfter}),ze("ChordCharts","Saved chord detailed breakdown:",{id:Ze.id,title:Ze.title,fingers:Ze.fingers,fingersType:typeof Ze.fingers,fingersLength:(ge=Ze.fingers)==null?void 0:ge.length,barres:Ze.barres,barresType:typeof Ze.barres,tuning:Ze.tuning,startingFret:Ze.startingFret,numFrets:Ze.numFrets,numStrings:Ze.numStrings,openStrings:Ze.openStrings,mutedStrings:Ze.mutedStrings}),K(Qe=>{const dt=Qe[T]||[];if(xe){const we=parseInt(ue.editingChordId);en("Updating chordCharts state",{editingId:we,editingChordIdOriginal:ue.editingChordId,existingChartIds:dt.map(St=>({id:St.id,type:typeof St.id}))});let wt=dt.map(St=>{const rr=parseInt(St.id)===we;return rr&&(en("Found matching chord to update",{chart:St.id,editingId:we}),ze("ChordCharts","State update - replacing old chart:",{oldChart:St,newChart:Ze,fingersOld:St.fingers,fingersNew:Ze.fingers})),rr?Ze:St});return fe._lineBreakUpdater&&(en("Applying stored line break updater to preserve line breaks"),wt=fe._lineBreakUpdater(wt)),en("Updated charts result",{originalCount:dt.length,updatedCount:wt.length,foundMatch:wt.some(St=>parseInt(St.id)===we),hasLineBreakUpdater:!!fe._lineBreakUpdater}),{...Qe,[T]:wt}}else{let we=[...dt,Ze];return fe._lineBreakUpdater&&(en("Applying stored line break updater to preserve line breaks for new chord"),we=fe._lineBreakUpdater(we)),{...Qe,[T]:we}}}),Q(Qe=>{const dt=Qe[T]||[];if(xe){const we=parseInt(ue.editingChordId);en("Updating chordSections state",{editingId:we,sectionsCount:dt.length});let wt=dt.map(St=>{const rr=St.chords.map(Nr=>{const Dt=parseInt(Nr.id)===we;return Dt&&en("Found matching chord in section",{sectionId:St.id,sectionLabel:St.label,chordId:Nr.id,editingId:we}),Dt?Ze:Nr});return{...St,chords:rr}});return fe._lineBreakUpdater&&(en("Applying line break updater to sections state"),wt=wt.map(St=>({...St,chords:fe._lineBreakUpdater(St.chords)}))),ze("LineBreaks","setChordSections update:",T,"updated sections with hasLineBreakAfter values:",wt.flatMap(St=>St.chords).map(St=>({id:St.id,title:St.title,hasLineBreakAfter:St.hasLineBreakAfter}))),{...Qe,[T]:wt}}else{if(dt.length===0){const wt=[{id:"section-1",label:"Verse",repeatCount:"",chords:[Ze]}];return fe._lineBreakUpdater&&(en("Applying line break updater to new section"),wt[0].chords=fe._lineBreakUpdater(wt[0].chords)),{...Qe,[T]:wt}}const we=[...dt];if(ue.insertionContext){const wt=we.findIndex(St=>St.id===ue.insertionContext.sectionId);if(wt>=0){const St={...we[wt]},rr=ue.insertionContext.insertOrder,Nr=St.chords.findIndex(Dt=>parseInt(Dt.order)>=rr);Nr>=0?St.chords=[...St.chords.slice(0,Nr),Ze,...St.chords.slice(Nr)]:St.chords=[...St.chords,Ze],we[wt]=St}else{const St={...we[we.length-1]};St.chords=[...St.chords,Ze],we[we.length-1]=St}}else{const wt={...we[we.length-1]};wt.chords=[...wt.chords,Ze],we[we.length-1]=wt}return fe._lineBreakUpdater&&(en("Applying line break updater to updated sections"),we.forEach(wt=>{wt.chords=fe._lineBreakUpdater(wt.chords)})),{...Qe,[T]:we}}}),r.items.find(Qe=>Qe.B===T)){const Qe=e(T),dt=(Qe==null?void 0:Qe.C)||`Item ${T}`;xe?Xs("edited",dt,{chord_name:ue.title||"Unknown Chord",section_id:fe.sectionId,section_label:fe.sectionLabel}):Xs("added",dt,{chord_name:ue.title||"Unknown Chord",section_id:fe.sectionId,section_label:fe.sectionLabel})}V(Qe=>({...Qe,[T]:!1})),_(null),ae(null),vs()}catch(xe){console.error("Error saving chord chart:",xe)}},Wi=async(T,ue)=>{try{ze("ChordCharts","Deleting chord chart:",ue,"for item:",T);const ge=await fetch(`/api/items/${T}/chord-charts/${ue}`,{method:"DELETE"});if(!ge.ok){if(ge.status===429){const fe=await ge.json();console.warn("Rate limit exceeded for individual delete"),alert(`Rate limit exceeded. Please wait a moment and try again. (${fe.error})`);return}throw new Error(`Failed to delete chord chart: ${ge.statusText}`)}if(ze("ChordCharts","Chord chart deleted successfully"),r.items.find(fe=>fe.B===T)){const fe=e(T),Ne=(fe==null?void 0:fe.C)||`Item ${T}`,Fe=(I[T]||[]).find($e=>$e.id===ue);Xs("deleted",Ne,{chord_name:(Fe==null?void 0:Fe.title)||"Unknown Chord",chord_id:ue})}K(fe=>{const Ne=fe[T]||[];return{...fe,[T]:Ne.filter(Fe=>Fe.id!==ue)}}),Q(fe=>{const Fe=(fe[T]||[]).map($e=>({...$e,chords:$e.chords.filter(Ze=>Ze.id!==ue)}));return{...fe,[T]:Fe}})}catch(ge){console.error("Error deleting chord chart:",ge)}},vs=()=>{re&&(setTimeout(()=>{const T=document.querySelector(`[data-chord-id="${re.chordId}"]`);T?T.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}):window.scrollTo({top:re.scrollPosition,behavior:"smooth"})},100),se(null))},Hi=(T,ue,ge)=>{ze("ChordCharts","Edit chord chart:",ue,"for item:",T,"with data:",ge),se({itemId:T,chordId:ue,scrollPosition:window.scrollY}),V(xe=>({...xe,[T]:!0})),_(ue),setTimeout(()=>{const xe=document.querySelector(`[data-editor-for-item="${T}"]`);xe&&xe.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})},100)},Ha=(T,ue,ge)=>{ze("ChordCharts","Insert chord after:",ue,"for item:",T,"with data:",ge),se({itemId:T,chordId:ue,scrollPosition:window.scrollY}),V(xe=>({...xe,[T]:!0})),ae({afterChordId:ue,sectionId:ge.sectionId,sectionLabel:ge.sectionLabel,sectionRepeatCount:ge.sectionRepeatCount,insertOrder:parseInt(ge.order)+1}),_(null),setTimeout(()=>{const xe=document.querySelector(`[data-editor-for-item="${T}"]`);xe&&xe.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},100)},Va=T=>{ze("Print","Print button clicked for item:",T);const ue=document.querySelector(`[data-item-id="${T}"].chord-charts-container`);ze("Print","Found container:",ue),ue?(ue.classList.add("chord-chart-print-area"),window.print(),setTimeout(()=>{ue.classList.remove("chord-chart-print-area")},100)):console.error("Could not find chord charts container for item:",T)},mi=async T=>{ze("CopyCharts","Opening copy modal for item:",T),A(T);const ue=i==null?void 0:i.find(Ne=>Ne.B===T),ge=(ue==null?void 0:ue.C)||"",xe=$l(ge,i,T);ze("CopyCharts","Source:",ge),ze("CopyCharts","Found similar songs:",xe.map(Ne=>Ne.C));const fe=[T,...xe.map(Ne=>Ne.B)];ze("CopyCharts","Loading chord charts for relevant items:",fe.length,"items");for(const Ne of fe)try{const Fe=await fetch(`/api/items/${Ne}/chord-charts`);if(Fe.ok){const $e=await Fe.json();K(Ze=>({...Ze,[Ne]:$e})),ze("CopyCharts",`Loaded ${$e.length} charts for item ${Ne}`)}}catch(Fe){console.error(`Error loading chord charts for item ${Ne}:`,Fe)}je(!0),Z(""),pe(new Set),z(null)},Zn=()=>{je(!1),A(null),Z(""),pe(new Set),ke(new Set),De(!1),z(null)},Ga=T=>{pe(ue=>{const ge=new Set(ue);if(ge.has(T))ge.delete(T);else{ge.add(T);const xe=i==null?void 0:i.find(Ne=>Ne.A===T),fe=xe==null?void 0:xe.B;fe&&zr(fe)}return ge})},ia=async()=>{if(ze("CopyCharts","handleConfirmCopy called",{copySourceItemId:ne,selectedTargetItems:Array.from(X)}),!ne||X.size===0){ze("CopyCharts","Early return: missing source or targets");return}if(ve.size>0&&!Ae){ze("CopyCharts","Showing overwrite confirmation, items with existing charts:",ve.size),De(!0);return}try{const T=await fetch("/api/chord-charts/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_item_id:ne,target_item_ids:Array.from(X).map(fe=>{const Ne=i==null?void 0:i.find(Fe=>Fe.A===fe);return Ne==null?void 0:Ne.B}).filter(Boolean)})});if(!T.ok)throw new Error(`Failed to copy chord charts: ${T.statusText}`);const ue=await T.json();ze("CopyCharts","Chord charts copied successfully:",ue),z("complete");const ge=Array.from(X).map(fe=>{const Ne=i==null?void 0:i.find(Fe=>Fe.A===fe);return Ne==null?void 0:Ne.B}).filter(Boolean),xe=[ne,...ge];ze("CopyCharts","About to refresh chord charts for affected items:",xe);for(const fe of xe)try{const Ne=await fetch(`/api/items/${fe}/chord-charts`);if(Ne.ok){const Fe=await Ne.json();if(ze("CopyCharts","Updating chordCharts state for item",fe,"with",Fe.length,"charts"),K($e=>({...$e,[fe]:Fe})),Fe.length===0)Q($e=>({...$e,[fe]:[]}));else{const $e=new Map;Fe.forEach(ht=>{const Qe=ht.sectionId||"section-1",dt=ht.sectionLabel||"Verse",we=ht.sectionRepeatCount||"";$e.has(Qe)||$e.set(Qe,{id:Qe,label:dt,repeatCount:we,chords:[]}),$e.get(Qe).chords.push(ht)});const Ze=Array.from($e.values()).sort((ht,Qe)=>{const dt=ht.chords.length>0&&ht.chords[0].order||0,we=Qe.chords.length>0&&Qe.chords[0].order||0;return dt-we});ze("CopyCharts","Updating chordSections state for item",fe,"with",Ze.length,"sections"),Q(ht=>({...ht,[fe]:Ze}))}}}catch(Ne){console.error("Error refreshing chord charts for item",fe,Ne)}Zn()}catch(T){console.error("Error copying chord charts:",T)}},Ya=()=>{ze("CopyCharts","Overwrite confirmed, proceeding with copy"),De(!1),ia()},oa=()=>{ze("CopyCharts","Overwrite cancelled, returning to item selection"),De(!1)},Ja=T=>{ze("CopyCharts","Opening copy from modal for item:",T),Ye(T),he(!0),de(""),Ie(null)},Sa=()=>{he(!1),Ye(null),de(""),Ie(null),_a({})},gi=async()=>{if(ze("CopyCharts","handleConfirmCopyFrom called",{selectedSourceItem:Le,copyFromTargetItemId:Te}),!Le||!Te){ze("CopyCharts","Early return: missing source or target");return}try{const T=await fetch("/api/chord-charts/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source_item_id:Le,target_item_ids:[Te]})});if(!T.ok)throw new Error(`Failed to copy chord charts: ${T.statusText}`);const ue=await T.json();ze("CopyCharts","Chord charts copied successfully:",ue);const ge=await fetch(`/api/items/${Te}/chord-charts`);if(ge.ok){const xe=await ge.json();if(K(fe=>({...fe,[Te]:xe})),xe.length===0)Q(fe=>({...fe,[Te]:[]}));else{const fe=new Map;xe.forEach(Fe=>{const $e=Fe.sectionId||"section-1",Ze=Fe.sectionLabel||"Verse",ht=Fe.sectionRepeatCount||"";fe.has($e)||fe.set($e,{id:$e,label:Ze,repeatCount:ht,chords:[]}),fe.get($e).chords.push(Fe)});const Ne=Array.from(fe.values()).sort((Fe,$e)=>{const Ze=Fe.chords.length>0&&Fe.chords[0].order||0,ht=$e.chords.length>0&&$e.chords[0].order||0;return Ze-ht});Q(Fe=>({...Fe,[Te]:Ne}))}}Sa()}catch(T){console.error("Error copying chord charts:",T)}},Ls=T=>{(I[T]||[]).length>0&&(j(T),Ke(!0))},Es=async()=>{if(Se)try{const T=I[Se]||[];for(const ue of T)if(!(await fetch(`/api/items/${Se}/chord-charts/${ue.id}`,{method:"DELETE"})).ok)throw new Error(`Failed to delete chord chart ${ue.id}`);K(ue=>({...ue,[Se]:[]})),Q(ue=>({...ue,[Se]:[]})),Ke(!1),j(null)}catch(T){console.error("Error deleting existing chord charts:",T)}},xi=T=>{ut[T]&&ut[T].abort(),G(ue=>{const ge={...ue};return delete ge[T],ge}),Yt(ue=>{const ge={...ue};return delete ge[T],ge}),Br(ue=>{const ge={...ue};return delete ge[T],ge})},ss=T=>{Qt(T),Zt(!0)},yi=()=>{yt&&xi(yt),Zt(!1),Qt(null)},x=()=>{Zt(!1),Qt(null)},R=(T,ue)=>{if(!(!ue||ue.length===0)){if(ue.length>5){alert("Maximum 5 files allowed. Please select fewer files.");return}Br(ge=>({...ge,[T]:Array.from(ue)}))}},oe=(T,ue)=>{if(!T||T.trim().length===0)return qe(Fe=>({...Fe,[ue]:null})),!0;const ge=T.trim();return/^[A-Za-z0-9#bâ™­â™¯/\s,\n\r-]+$/.test(ge)?ge.split(/[\n\r]+/).some(Fe=>{const $e=Fe.trim();return $e.length===0?!1:/^[A-Za-z]+$/.test($e)?!0:$e.split(/[,\s]+/).filter(Qe=>Qe.trim().length>0).every(Qe=>/^[A-Ga-g][A-Za-z0-9#bâ™­â™¯/]*$/.test(Qe))})?(qe(Fe=>({...Fe,[ue]:null})),!0):(qe(Fe=>({...Fe,[ue]:'Please enter chord names separated by commas, spaces, or section names (e.g., "C, G, Am, F" or "D A G D" or "Intro")'})),!1):(qe(Fe=>({...Fe,[ue]:"Only chord names (A-G), numbers, #, b, â™­, â™¯, /, commas, spaces, and section names are allowed"})),!1)},be=async T=>{var fe,Ne;const ue=tr[T]||[],ge=(fe=Jr[T])==null?void 0:fe.trim(),xe=(Ne=ct[T])==null?void 0:Ne.trim();if(ze("AUTOCREATE",`handleProcessFiles called for item ${T}, files:`,ue.length,"youtubeUrl:",ge,"manualChords:",xe),ge){await Ge(T,ge);return}if(xe)if(oe(xe,T)){await Ee(T,xe);return}else return;if(ue.length===0){alert("Please add at least one file, YouTube URL, or manual chord input before processing.");return}await Tt(T,ue)},Ee=async(T,ue)=>{ze("AUTOCREATE",`Processing manual chord input for item ${T}:`,ue),G(ge=>({...ge,[T]:"processing"}));try{const ge=new Blob([ue],{type:"text/plain"}),xe=new File([ge],"manual-input.txt",{type:"text/plain"}),fe=new FormData;fe.append("file0",xe),fe.append("itemId",T),fe.append("userChoice","chord_names"),ze("AUTOCREATE","Sending manual input to autocreate endpoint");const Ne=await fetch("/api/autocreate-chord-charts",{method:"POST",body:fe});if(!Ne.ok){let Qe=`Failed to process manual input: ${Ne.statusText}`;try{const dt=await Ne.json();if(dt.error&&(Qe=dt.error),dt.requires_api_key)throw new Error("API_KEY_REQUIRED: "+Qe)}catch(dt){if(!dt.message.startsWith("API_KEY_REQUIRED"))console.warn("Could not parse error response:",dt);else throw dt}throw new Error(Qe)}const Fe=await Ne.json();ze("AUTOCREATE","Manual input processed successfully:",Fe),ri();const Ze=await(await fetch(`/api/items/${T}/chord-charts`)).json();K(Qe=>({...Qe,[T]:Ze})),Q(Qe=>({...Qe,[T]:bs(Ze)})),Zr(Qe=>({...Qe,[T]:""}));const ht=e(T);Hr({itemTitle:(ht==null?void 0:ht.C)||`Item ${T}`,chordsCreated:Ze.length,processingMethod:"Manual Entry"}),nn(!0)}catch(ge){if(console.error("Error processing manual chord input:",ge),ge.message&&ge.message.startsWith("API_KEY_REQUIRED: ")){const xe=ge.message.replace("API_KEY_REQUIRED: ","");vr({message:xe,requiresApiKey:!0})}else vr({message:ge.message||"Failed to process manual chord input. Please try again."});ur(!0)}finally{G(ge=>{const xe={...ge};return delete xe[T],xe})}},Ge=async(T,ue)=>{ze("YOUTUBE",`Processing YouTube URL for item ${T}:`,ue);const ge=ue.trim().replace(/[<>"']/g,"");if(!/^https?:\/\/(www\.)?(youtube\.com\/watch\?v=[\w-]+|youtu\.be\/[\w-]+)(\?.*|&.*)?$/.test(ge)){vr({message:"Please enter a valid YouTube URL (e.g., https://youtube.com/watch?v=...)"}),ur(!0);return}G(fe=>({...fe,[T]:"checking_transcript"}));try{ze("YOUTUBE","Fetching transcript from YouTube API");const fe=await fetch("/api/youtube/check-transcript",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:ge})});if(!fe.ok)throw new Error("Failed to fetch YouTube transcript");const Ne=await fe.json();if(!Ne.hasTranscript||!Ne.transcript){vr({message:"This YouTube video does not have a transcript available. Please try a different video or use file upload instead."}),ur(!0);return}ze("YOUTUBE",`Transcript fetched successfully, length: ${Ne.transcript.length} characters`),await Xe(T,Ne.transcript)}catch(fe){console.error("Error processing YouTube URL:",fe),vr({message:"Failed to process YouTube URL. Please try again."}),ur(!0),G(Ne=>{const Fe={...Ne};return delete Fe[T],Fe})}},Xe=async(T,ue)=>{let ge=!1,xe=null;try{G(dt=>({...dt,[T]:"reading_transcript"}));const fe=new FormData;fe.append("itemId",T);const Ne=new Blob([ue],{type:"text/plain"});fe.append("file0",Ne,"youtube_transcript.txt"),xe=setTimeout(()=>{ge||G(dt=>({...dt,[T]:"processing"}))},2e3);const $e=await fetch("/api/autocreate-chord-charts",{method:"POST",headers:{"X-Item-Id":T},body:fe});if(!$e.ok){let dt=`Failed to create chord charts: ${$e.statusText}`;try{const we=await $e.json();if(we.error&&(dt=we.error),we.requires_api_key)throw new Error("API_KEY_REQUIRED: "+dt)}catch(we){if(!we.message.startsWith("API_KEY_REQUIRED"))console.warn("Could not parse error response:",we);else throw we}throw new Error(dt)}const Ze=await $e.json();if(ze("YOUTUBE","Chord charts created successfully:",Ze),ri(),Ze.error&&Ze.error.includes("No chord names found in this transcript")){jt(!0),G(dt=>{const we={...dt};return delete we[T],we}),Pn(dt=>({...dt,[T]:""}));return}if(r.items.find(dt=>dt.B===T)){const dt=e(T),we=(dt==null?void 0:dt.C)||`Item ${T}`;Xs("autocreated",we,{content_type:"youtube_transcript",source:"youtube_url"})}const Qe=e(T);Hr({itemName:(Qe==null?void 0:Qe.C)||`Item ${T}`,chordCount:Ze.chord_count||0,contentType:"youtube_transcript",uploadedFileNames:"YouTube transcript",isVisionAnalysis:!1}),nn(!0);try{const dt=await fetch(`/api/items/${T}/chord-charts`);if(dt.ok){const wt=await dt.json();if(K(St=>({...St,[T]:wt})),wt.length===0)Q(St=>({...St,[T]:[]}));else{const St=new Map;wt.forEach(Nr=>{const Dt=Nr.sectionId||"section-1",br=Nr.sectionLabel||"Verse",_r=Nr.sectionRepeatCount||"";St.has(Dt)||St.set(Dt,{id:Dt,label:br,repeatCount:_r,chords:[]}),St.get(Dt).chords.push(Nr)});const rr=Array.from(St.values());Q(Nr=>({...Nr,[T]:rr}))}}}catch(dt){console.error("Error refreshing chord charts:",dt)}Pn(dt=>({...dt,[T]:""})),G(dt=>{const we={...dt};return delete we[T],we})}catch(fe){if(ge=!0,xe&&clearTimeout(xe),console.error("Error processing YouTube transcript:",fe),fe.message&&fe.message.startsWith("API_KEY_REQUIRED: ")){const Ne=fe.message.replace("API_KEY_REQUIRED: ","");vr({message:Ne,requiresApiKey:!0})}else vr({message:fe.message||"Failed to create chord charts from transcript. Please try again."});ur(!0),G(Ne=>{const Fe={...Ne};return delete Fe[T],Fe})}},Nt=async T=>{if(!zt)return;const{itemId:ue,files:ge}=zt;ze("AUTOCREATE",`handleMixedContentChoice called with contentType: ${T}, itemId: ${ue}, files:`,ge.length);try{G(Fe=>({...Fe,[ue]:"processing"})),rn(!1),ze("AUTOCREATE",`Starting processing for ${T} with ${ge.length} files`);const xe=new FormData;ge.forEach((Fe,$e)=>{const Ze=atob(Fe.data),ht=Array.from({length:Ze.length});for(let we=0;we<Ze.length;we++)ht[we]=Ze.charCodeAt(we);const Qe=new Uint8Array(ht),dt=new File([Qe],Fe.name,{type:Fe.media_type});xe.append(`file${$e}`,dt)}),xe.append("itemId",ue),xe.append("userChoice",T),ze("AUTOCREATE","Sending API request to /api/autocreate-chord-charts");const fe=await fetch("/api/autocreate-chord-charts",{method:"POST",body:xe});if(ze("AUTOCREATE",`API response status: ${fe.status} ${fe.statusText}`),!fe.ok){let Fe="Failed to process files";try{const $e=await fe.json();if($e.error&&(Fe=$e.error),$e.requires_api_key)throw new Error("API_KEY_REQUIRED: "+Fe)}catch($e){if(!$e.message.startsWith("API_KEY_REQUIRED"))console.warn("Could not parse error response:",$e);else throw $e}throw new Error(Fe)}const Ne=await fe.json();if(ze("AUTOCREATE","API response data:",Ne),Ne.success){ze("AUTOCREATE","Processing successful, setting state to complete"),ri(),G(ht=>({...ht,[ue]:"complete"}));const Fe=e(ue),$e=(Fe==null?void 0:Fe.C)||`Item ${ue}`;r.items.find(ht=>ht.B===ue)&&Xs("autocreated",$e,{file_count:(ge==null?void 0:ge.length)||0,content_type:T||"mixed",uploaded_file_names:(ge==null?void 0:ge.map(ht=>ht.name).join(", "))||""}),Hr({itemName:$e,chordCount:Ne.chord_count||0,contentType:T||"mixed",uploadedFileNames:(ge==null?void 0:ge.map(ht=>ht.name).join(", "))||"",isVisionAnalysis:T==="chord_charts"||Ne.used_vision_analysis===!0}),nn(!0);try{const ht=await fetch(`/api/items/${ue}/chord-charts`);if(ht.ok){const dt=await ht.json();if(K(we=>({...we,[ue]:dt})),dt&&dt.length>0){const we=bs(dt);Q(wt=>({...wt,[ue]:we}))}}}catch(ht){console.error("Failed to refresh chord charts after mixed content choice:",ht)}setTimeout(()=>{G(ht=>{const Qe={...ht};return delete Qe[ue],Qe}),Br(ht=>{const Qe={...ht};return delete Qe[ue],Qe}),mn(null)},2e3)}}catch(xe){if(console.error("[AUTOCREATE] Error processing mixed content choice:",xe),console.error("[AUTOCREATE] Full error details:",{message:xe.message,stack:xe.stack,name:xe.name}),xe.message&&xe.message.startsWith("API_KEY_REQUIRED: ")){const fe=xe.message.replace("API_KEY_REQUIRED: ","");vr({message:fe,requiresApiKey:!0})}else vr({message:xe.message||"Failed to process files. Please try again."});ur(!0),G(fe=>{const Ne={...fe};return delete Ne[ue],Ne}),mn(null)}},Tt=async(T,ue)=>{if(!ue||ue.length===0)return;if(ue.length>5){alert("Maximum 5 files allowed. Please select fewer files.");return}let ge=!1,xe=null;try{G(we=>({...we,[T]:"uploading"}));const fe=new AbortController;Yt(we=>({...we,[T]:fe}));const Ne=new FormData;Array.from(ue).forEach((we,wt)=>{Ne.append(`file${wt}`,we)}),Ne.append("itemId",T),xe=setTimeout(()=>{ge||G(we=>({...we,[T]:"processing"}))},2e3);const $e=await fetch("/api/autocreate-chord-charts",{method:"POST",body:Ne,signal:fe.signal});if(!$e.ok){const we=await $e.json();throw new Error(we.error||"Failed to process files")}const Ze=await $e.json();if(Ze.needs_user_choice){mn({itemId:T,options:Ze.mixed_content_options||[],files:Ze.files||[]}),rn(!0),G(we=>{const wt={...we};return delete wt[T],wt});return}if(Ze.error==="unsupported_format"){yr({message:Ze.message,title:Ze.title}),Yr(!0),G(we=>{const wt={...we};return delete wt[T],wt});return}ri(),G(we=>({...we,[T]:"complete"}));const ht=e(T),Qe=(ht==null?void 0:ht.C)||`Item ${T}`;r.items.find(we=>we.B===T)&&Xs("autocreated",Qe,{file_count:Ze.file_count||0,content_type:Ze.content_type||"auto-detected",uploaded_file_names:Ze.uploaded_file_names||""}),Hr({itemName:Qe,chordCount:Ze.chord_count||0,contentType:Ze.content_type||"auto-detected",uploadedFileNames:Ze.uploaded_file_names||"",isVisionAnalysis:Ze.content_type==="chord_charts"||Ze.used_vision_analysis===!0||!Ze.content_type&&Ze.used_vision_analysis!==!1}),nn(!0);try{const we=await fetch(`/api/items/${T}/chord-charts`);if(we.ok){const St=await we.json();if(K(rr=>({...rr,[T]:St})),St.length===0)Q(rr=>({...rr,[T]:[]}));else{const rr=new Map;St.forEach(Dt=>{const br=Dt.sectionId||"section-1",_r=Dt.sectionLabel||"Verse",mr=Dt.sectionRepeatCount||"";rr.has(br)||rr.set(br,{id:br,label:_r,repeatCount:mr,chords:[]}),rr.get(br).chords.push(Dt)});const Nr=Array.from(rr.values()).sort((Dt,br)=>{const _r=Math.min(...Dt.chords.map(gr=>gr.order||0)),mr=Math.min(...br.chords.map(gr=>gr.order||0));return _r-mr});Nr.forEach(Dt=>{Dt.chords.sort((br,_r)=>(br.order||0)-(_r.order||0))}),Q(Dt=>({...Dt,[T]:Nr}))}}}catch(we){console.error("Failed to refresh chord charts after autocreate:",we)}setTimeout(()=>{G(we=>{const wt={...we};return delete wt[T],wt}),bt(we=>({...we,[T]:!1})),Yt(we=>{const wt={...we};return delete wt[T],wt}),Br(we=>{const wt={...we};return delete wt[T],wt})},5e3)}catch(fe){if(ge=!0,xe&&clearTimeout(xe),fe.name==="AbortError"){ze("AUTOCREATE","Request was cancelled");return}console.error("Error in autocreate:",fe);const Ne=fe.message||fe.toString();if(Ne.startsWith("API_KEY_REQUIRED: ")){const Fe=Ne.replace("API_KEY_REQUIRED: ","");vr({message:Fe,requiresApiKey:!0}),ur(!0),G($e=>{const Ze={...$e};return delete Ze[T],Ze})}else Ne.includes("529")||Ne.includes("overloaded")||Ne.includes("429")||Ne.includes("rate limit")||Ne.includes("500")||Ne.includes("502")||Ne.includes("503")||Ne.includes("timeout")?(vr(fe),ur(!0),G(Fe=>{const $e={...Fe};return delete $e[T],$e})):G(Fe=>({...Fe,[T]:"error"}));Ne.includes("529")||Ne.includes("overloaded")||Ne.includes("429")||Ne.includes("rate limit")||Ne.includes("500")||Ne.includes("502")||Ne.includes("503")||Ne.includes("timeout")||setTimeout(()=>{G(Fe=>{const $e={...Fe};return delete $e[T],$e}),Yt(Fe=>{const $e={...Fe};return delete $e[T],$e})},5e3)}};return n.jsxs("div",{className:"max-w-1130px mx-auto border border-gray-700 rounded-lg p-6",style:{maxWidth:"1130px"},children:[n.jsxs("div",{className:"flex justify-between items-center mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold",children:r==null?void 0:r.name}),n.jsxs("div",{className:"flex flex-col items-end gap-2",children:[n.jsxs("div",{className:"text-xl font-mono",children:[n.jsx("span",{title:"Time practiced so far",children:Ud(sa)})," / ",n.jsx("span",{title:"Total time of remaining items",children:Ud($i-sa)})]}),n.jsx(Be,{variant:"outline",onClick:qi,className:"text-gray-300 hover:text-white",title:"Reset progress and all timers","data-ph-capture-attribute-button":"reset-routine-progress",children:"Reset progress"})]})]}),n.jsx("div",{className:"space-y-4",children:($t=r==null?void 0:r.items)==null?void 0:$t.map(T=>{var dt;const ue=a.has(T.A),ge=o.has(T.A),xe=h.has(T.A),fe=Jn.has(T.A),Ne=e(T.B),Fe=y[T.A]!==void 0?y[T.A]:((Ne==null?void 0:Ne.E)||5)*60,$e=b[T.B]||"",Ze=L.has(T.A),ht=((dt=T.minimalDetails)==null?void 0:dt.C)||"Loading...",Qe=ue&&!Ne&&s(T.B);return n.jsxs("div",{className:"rounded-lg bg-gray-800 overflow-hidden",children:[n.jsxs("h2",{className:"sr-only",children:["Practice Item: ",ht]}),n.jsxs("div",{className:"flex items-center justify-between p-5 cursor-pointer hover:bg-gray-700",onClick:()=>ui(T.A),role:"button","aria-expanded":ue,"aria-controls":`practice-item-content-${T.A}`,tabIndex:0,"data-item-header":T.A,"data-expanded":ue?"true":"false",onKeyDown:we=>{(we.key==="Enter"||we.key===" ")&&(we.preventDefault(),ui(T.A))},children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("button",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${fe?"bg-green-500 border-green-500 text-white":"border-gray-400 text-transparent hover:border-gray-300"}`,onClick:we=>fi(T.A,we),"aria-label":fe?"Mark as incomplete":"Mark as complete","data-ph-capture-attribute-button":"toggle-item-complete",children:n.jsx(_n,{className:"h-4 w-4","aria-hidden":"true"})}),ue?n.jsx(Qn,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"}):n.jsx(ps,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"}),n.jsxs("span",{className:`text-xl ${fe?"line-through text-gray-500":""}`,id:`practice-item-title-${T.A}`,children:[ht,Qe&&n.jsx("span",{className:"text-gray-500 ml-2",role:"status","aria-live":"polite",children:"(Loading details...)"})]})]}),n.jsx("div",{className:"flex items-center space-x-4",children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Be,{variant:"ghost",size:"sm",className:"text-gray-400",onClick:we=>pi(T.A,we),title:"Reset timer","data-ph-capture-attribute-button":"reset-timer-header",children:n.jsx(Bd,{className:"h-5 w-5"})}),n.jsx("span",{className:"text-lg font-mono",title:"Time remaining",children:Md(Fe)})]})})]}),ue&&n.jsxs("div",{className:"px-8 pb-6",children:[n.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-6","data-tour":"practice-timer",children:[n.jsx("button",{onClick:we=>Vt(T.A,we),className:"w-48 h-48 rounded-full border-4 border-gray-600 flex items-center justify-center hover:border-gray-500 transition-colors",title:xe?"Pause timer":"Start timer","aria-label":xe?"Pause practice timer":"Start practice timer","data-ph-capture-attribute-button":xe?"pause-practice-timer":"start-practice-timer",children:xe?n.jsx(um,{className:"h-24 w-24 text-red-500"}):n.jsx(dm,{className:"h-24 w-24 text-green-500"})}),n.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[n.jsx("div",{className:"text-5xl font-mono",children:Md(Fe)}),!xe&&Fe!==((Ne==null?void 0:Ne.E)||5)*60&&n.jsxs("button",{onClick:we=>pi(T.A,we),className:"flex items-center space-x-2 text-gray-400 hover:text-gray-300 transition-colors","data-ph-capture-attribute-button":"reset-practice-timer",children:[n.jsx(Bd,{className:"h-4 w-4"}),n.jsx("span",{children:"Reset Timer"})]})]}),n.jsx("div",{className:"flex justify-center mt-6",children:n.jsx(Be,{variant:"outline",className:"max-w-md text-gray-300 hover:text-white",onClick:we=>fi(T.A,we),"data-ph-capture-attribute-button":"mark-item-done",children:"Mark done"})})]}),n.jsxs("div",{className:"space-y-2 px-4",children:[n.jsxs("div",{"data-tour":"chord-charts-section",children:[n.jsx("div",{className:"flex items-center justify-between p-2 hover:bg-gray-700 rounded cursor-pointer",onClick:we=>ja(T.A,we),role:"button","aria-expanded":Ze,"aria-controls":`chord-charts-content-${T.A}`,tabIndex:0,onKeyDown:we=>{(we.key==="Enter"||we.key===" ")&&(we.preventDefault(),ja(T.A,we))},children:n.jsxs("div",{className:"flex items-center",children:[Ze?n.jsx(Qn,{className:"h-5 w-5 text-gray-400 mr-2","aria-hidden":"true"}):n.jsx(ps,{className:"h-5 w-5 text-gray-400 mr-2","aria-hidden":"true"}),n.jsxs("h3",{className:"text-xl text-gray-300 flex items-center",id:`chord-charts-title-${T.A}`,"data-tour":"chord-charts",children:[n.jsx(_h,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Chord charts"]})]})}),Ze&&n.jsx("div",{id:`chord-charts-content-${T.A}`,className:"bg-gray-700 rounded-lg p-4 chord-charts-container relative","data-item-id":T.B,role:"region","aria-labelledby":`chord-charts-title-${T.A}`,children:(()=>{const we=T.B,wt=O[we],St=wt?null:Tn(we),rr=wt||St||[];ze("LineBreaks","Rendering sections for item",we,"from state:",!!wt,"chords:",rr.flatMap(Dt=>Dt.chords).map(Dt=>({id:Dt.id,title:Dt.title,hasLineBreakAfter:Dt.hasLineBreakAfter})));const Nr=rr.map((Dt,br)=>n.jsxs("div",{className:"mb-6",children:[n.jsxs("div",{className:"flex justify-between items-center mb-3",children:[n.jsx("input",{type:"text",value:Dt.label,onChange:_r=>{ze("Section","Updating section label:",Dt.id,_r.target.value),pt(we,Dt.id,{label:_r.target.value})},className:"bg-gray-900 text-white px-2 py-1 rounded text-sm font-semibold border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Section name"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("input",{type:"text",value:Dt.repeatCount,onChange:_r=>pt(we,Dt.id,{repeatCount:_r.target.value}),className:"bg-gray-900 text-white px-2 py-1 rounded text-sm w-16 text-center border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"x2",maxLength:"3"}),n.jsx("button",{onClick:()=>hr(we,Dt.id),disabled:F.size>0,className:`w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold transition-colors ${F.size>0?"bg-gray-500 cursor-not-allowed":"bg-red-600 hover:bg-red-700 cursor-pointer"} text-white`,title:F.size>0?"Deleting...":"Delete section","aria-label":"Delete chord section","data-ph-capture-attribute-button":"delete-chord-section",children:F.size>0?n.jsx(Rr,{className:"h-3 w-3 animate-spin"}):"Ã—"})]})]}),br===0&&(()=>{const _r=Dt.chords[0];if(!_r)return null;const mr=_r.tuning||"EADGBE",gr=_r.capo||0;return n.jsx("div",{className:"text-center text-white font-bold text-sm mb-3",children:gr>0?`${mr} | Capo on ${gr}`:mr})})(),Dt.chords.length>0&&n.jsx("div",{className:"space-y-2",children:(()=>{const _r=[];let mr=[];return ze("LineBreaks","Processing section:",Dt.id,"chords:",Dt.chords.map(gr=>({id:gr.id,title:gr.title,hasLineBreakAfter:gr.hasLineBreakAfter}))),Dt.chords.forEach((gr,Un)=>{mr.push(gr),(gr.hasLineBreakAfter||mr.length>=5||Un===Dt.chords.length-1)&&(ze("LineBreaks","Creating row with",mr.length,"chords. Reason:",gr.hasLineBreakAfter?"hasLineBreakAfter":mr.length>=5?"max 5":"last chord"),_r.push([...mr]),mr=[])}),ze("LineBreaks","Final row structure:",_r.map((gr,Un)=>`Row ${Un}: ${gr.map(zn=>zn.title).join(", ")}`)),_r.map((gr,Un)=>n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-2",children:gr.map(zn=>n.jsx(hm,{chart:zn,onEdit:(nr,xr)=>Hi(we,nr,xr),onDelete:nr=>Wi(we,nr),onInsertAfter:(nr,xr)=>Ha(we,nr,xr)},zn.id))},`row-${Un}-${gr.map(zn=>zn.id).join("-")}`))})()})]},Dt.id));return n.jsxs(n.Fragment,{children:[Nr,(I[we]||[]).length>0?n.jsx("div",{className:"flex justify-end mb-2",children:n.jsx(Be,{variant:"outline",size:"sm",onClick:br=>{br.stopPropagation(),Va(we)},className:"p-2 border-gray-600 text-gray-400 hover:text-gray-200 hover:bg-gray-600",title:"Print chord charts",children:n.jsx(jh,{className:"h-4 w-4"})})}):null,(()=>{var mr,gr,Un,zn;const Dt=I[we]||[],br=P[we],_r=lt[we];return Dt.length===0?n.jsxs("div",{className:"mb-4",children:[_r?n.jsx(Be,{onClick:()=>bt(nr=>({...nr,[we]:!1})),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-300 mb-2",title:"Collapse autocreate section",children:"â†"}):n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{onClick:()=>bt(nr=>({...nr,[we]:!0})),className:"max-w-md bg-gray-700 text-gray-300 hover:bg-gray-600 mb-2 flex items-center justify-center",children:[n.jsx(Ei,{className:"h-4 w-4 mr-2"}),"Autocreate chord charts"]})}),_r&&n.jsxs("div",{className:"border border-gray-600/30 rounded-lg p-4 bg-gray-800/10",children:[n.jsxs("div",{className:"text-sm text-gray-400 mb-6",children:[n.jsx("p",{children:"â€¢ Upload lyrics with chord names to create charts"}),n.jsx("p",{children:'â€¢ Upload image or PDF of chord charts to "import"'}),n.jsx("p",{children:"â€¢ One method at a time"})]}),!br&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 items-start",children:[n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"text-center mb-2",children:n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Upload files"})}),n.jsx("div",{className:`flex-1 p-4 border-2 border-dashed rounded-lg transition-colors cursor-pointer ${ft[we]?"border-gray-500 bg-gray-800/20":"border-gray-600 hover:border-gray-500 bg-gray-800/10"}`,onDragOver:nr=>{nr.preventDefault(),at(xr=>xr[we]!==!0?{...xr,[we]:!0}:xr)},onDragLeave:nr=>{nr.preventDefault(),at(xr=>xr[we]!==!1?{...xr,[we]:!1}:xr)},onDrop:nr=>{nr.preventDefault(),at(xr=>({...xr,[we]:!1})),R(we,nr.dataTransfer.files)},onClick:()=>{const nr=document.createElement("input");nr.type="file",nr.multiple=!0,nr.accept=".pdf,.png,.jpg,.jpeg",nr.onchange=xr=>R(we,xr.target.files),nr.click()},children:n.jsxs("div",{className:"text-center",children:[n.jsx(Ei,{className:`h-12 w-12 mx-auto mb-2 ${tr[we]&&tr[we].length>0?"text-gray-300":"text-gray-400"}`}),n.jsx("p",{className:`text-sm font-medium mb-2 ${tr[we]&&tr[we].length>0?"text-gray-200":"text-gray-300"}`,children:"Drop files or click"}),n.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"PDFs, images â€¢ 5mb max"}),tr[we]&&tr[we].length>0&&n.jsx("div",{children:n.jsxs("p",{className:"text-gray-300 text-xs font-medium mb-1",children:[tr[we].length," file(s)"]})})]})})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsxs("div",{className:"text-center mb-2",children:[n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"YouTube guitar lesson"}),n.jsx("p",{className:"text-gray-500 text-xs",children:"(video must have a transcript)"})]}),n.jsx("form",{className:"flex-1 flex flex-col justify-center",onSubmit:nr=>{var xr;nr.preventDefault(),(xr=Jr[we])!=null&&xr.trim()&&be(we)},children:n.jsx("input",{type:"url",placeholder:"Paste YouTube URL",value:Jr[we]||"",onChange:nr=>{const xr=nr.target.value.replace(/[<>"']/g,"");Pn(la=>({...la,[we]:xr}))},maxLength:500,className:"w-full p-3 bg-gray-700 text-white rounded border-2 border-gray-600 focus:border-gray-500 text-sm"})})]}),n.jsxs("div",{className:"flex flex-col",children:[n.jsx("div",{className:"text-center mb-2",children:n.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Manual entry"})}),n.jsxs("div",{className:"flex-1 flex flex-col justify-center relative",children:[n.jsx("textarea",{placeholder:`Enter song section names and chord names, like this:
Intro
Am7 Em/A E7sus
Verse
C G/B Am (space or comma-separated)`,value:ct[we]||"",onChange:nr=>{const xr=nr.target.value;xr.length<=500&&(Zr(la=>({...la,[we]:xr})),oe(xr,we))},maxLength:500,className:`w-full p-3 text-white rounded border-2 focus:border-gray-500 text-sm resize-none min-h-[160px] ${ye[we]?"bg-red-900/20 border-red-500":"bg-gray-700 border-gray-600"}`}),n.jsxs("div",{className:"absolute bottom-1 right-2 text-xs text-gray-400",children:[(ct[we]||"").length,"/500"]}),ye[we]&&n.jsx("div",{className:"mt-1 text-xs text-red-400",children:ye[we]})]})]})]}),n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{onClick:()=>be(we),disabled:br||(tr[we]||[]).length===0&&!((mr=Jr[we])!=null&&mr.trim())&&!((gr=ct[we])!=null&&gr.trim())||((tr[we]||[]).length>0?1:0)+((Un=Jr[we])!=null&&Un.trim()?1:0)+((zn=ct[we])!=null&&zn.trim()?1:0)>1,className:"px-6",children:[n.jsx(gc,{className:"h-4 w-4 mr-2"}),"Create chord charts"]})})]}),n.jsx("div",{className:"w-full p-6 border-2 border-dashed rounded-lg mt-4 bg-gray-800/10 border-gray-600/50",children:n.jsxs("div",{className:"text-center",children:[br==="checking_transcripts"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-500"}),n.jsx("span",{className:"text-yellow-400",children:"Checking for transcripts..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ss(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),br==="reading_transcript"&&n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500"}),n.jsx("span",{className:"text-gray-400",children:"Reading transcript..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ss(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),br==="uploading"&&n.jsxs("div",{className:"space-y-3",role:"status","aria-live":"polite",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-500","aria-hidden":"true"}),n.jsx("span",{className:"text-gray-400",children:"Uploading files..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ss(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),br==="processing_transcript"&&n.jsxs("div",{className:"space-y-3",role:"status","aria-live":"polite",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500","aria-hidden":"true"}),n.jsx("span",{className:"text-white",children:"Processing transcript..."})]}),n.jsx("br",{}),n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ss(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})]}),br==="processing"&&n.jsxs("div",{className:"space-y-3",role:"status","aria-live":"polite",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-500","aria-hidden":"true"}),n.jsxs("div",{className:"flex items-center",children:[n.jsx("span",{className:"text-white",children:or[gt]}),n.jsx("div",{className:"ml-2 animate-spin","aria-hidden":"true",children:"âš™ï¸"})]})]}),n.jsx("br",{}),n.jsx("div",{className:"flex justify-center",children:n.jsxs(Be,{variant:"outline",size:"sm",onClick:()=>ss(we),className:"text-gray-400 hover:text-gray-200 border-gray-600",children:[n.jsx(Gr,{className:"h-3 w-3 mr-1"}),"Cancel"]})})]}),br==="complete"&&n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx(_n,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-green-400",children:"Chord charts created!"})]}),br==="error"&&n.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[n.jsx(Bn,{className:"h-4 w-4 text-red-500"}),n.jsx("span",{className:"text-red-400",children:"Error processing files. Please try again."})]}),!br&&n.jsx(n.Fragment,{children:I[we]&&I[we].length>0?n.jsxs(n.Fragment,{children:[n.jsx(Bn,{className:"h-8 w-8 text-orange-400 mx-auto mb-2"}),n.jsx("p",{className:"text-orange-300 font-medium mb-1",children:"Chord charts already exist"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Please delete all chord charts from this song before using autocreate"})]}):n.jsx(n.Fragment,{children:(tr[we]||[]).length>0?n.jsxs(n.Fragment,{children:[n.jsx(dl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-300 font-medium mb-1",children:"Ready to create chord charts"}),n.jsx("p",{className:"text-gray-400 text-sm",children:"Click 'Create chord charts'"})]}):n.jsxs(n.Fragment,{children:[n.jsx(dl,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),n.jsx("p",{className:"text-gray-300 font-medium mb-1",children:"Add a file, paste a YouTube URL, or type in the 'Manual entry' box, then click 'Create Chord Charts'"}),n.jsx("p",{className:"text-gray-400 text-xs",children:"(The results will probably contain errors. Use the âœï¸edit icon on a chart to correct it.)"})]})})})]})})]})]}):n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsxs(Be,{variant:"outline",onClick:()=>Ls(we),className:"max-w-md text-orange-300 hover:bg-orange-800 hover:border-orange-600",children:[n.jsx(Ei,{className:"h-4 w-4 mr-2"}),"Replace with autocreated charts"]})})})(),n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsx(Be,{variant:"default",onClick:()=>{se({itemId:we,scrollPosition:window.scrollY}),V(Dt=>({...Dt,[we]:!0})),setTimeout(()=>{const Dt=document.querySelector(`[data-editor-for-item="${we}"]`);Dt&&Dt.scrollIntoView({behavior:"smooth",block:"start"})},100)},className:"min-w-48",children:"+ Add new chord"})}),n.jsx("div",{className:"mb-4 flex justify-center",children:n.jsx(Be,{variant:"default",onClick:()=>Ar(we),className:"min-w-48",children:"+ Add new section"})}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 mb-4 max-w-2xl mx-auto",children:[n.jsx(Be,{variant:"default",onClick:()=>Ja(we),className:"flex-1",children:"Copy chord charts from other song"}),n.jsx(Be,{variant:"default",onClick:()=>mi(we),disabled:!I[we]||I[we].length===0,className:"flex-1 bg-purple-700 text-purple-300 hover:bg-purple-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Copy chord charts to other song"})]}),Y[we]&&n.jsx("div",{"data-editor-for-item":we,children:n.jsx(Th,{itemId:we,defaultTuning:(Ne==null?void 0:Ne.H)||"EADGBE",editingChordId:M,insertionContext:te,onSave:Dt=>aa(we,Dt),onCancel:()=>{V(Dt=>({...Dt,[we]:!1})),_(null),ae(null),vs()}})})]})})()})]}),n.jsxs("div",{className:"flex items-center justify-between p-2 hover:bg-gray-700 rounded cursor-pointer",onClick:we=>ws(T.A,we),role:"button","aria-expanded":ge,"aria-controls":`notes-content-${T.A}`,tabIndex:0,onKeyDown:we=>{(we.key==="Enter"||we.key===" ")&&(we.preventDefault(),ws(T.A,we))},children:[n.jsxs("div",{className:"flex items-center",children:[ge?n.jsx(Qn,{className:"h-5 w-5 text-gray-400 mr-2","aria-hidden":"true"}):n.jsx(ps,{className:"h-5 w-5 text-gray-400 mr-2","aria-hidden":"true"}),n.jsxs("h3",{className:"text-xl text-gray-300 flex items-center",id:`notes-title-${T.A}`,children:[n.jsx(Nh,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Notes"]})]}),n.jsxs(Be,{variant:"outline",size:"sm",className:"text-gray-300",onClick:we=>{we.stopPropagation(),zi(T.B,we)},children:[n.jsx(mo,{className:"h-4 w-4 mr-2","aria-hidden":"true"}),$e?"Edit note":"Add note"]})]}),ge&&$e&&n.jsx("div",{id:`notes-content-${T.A}`,className:"px-4",role:"region","aria-labelledby":`notes-title-${T.A}`,children:n.jsx("div",{className:"bg-gray-700 p-3 rounded",children:n.jsx("div",{className:"text-gray-300",dangerouslySetInnerHTML:{__html:zc($e)}})})}),n.jsx("div",{className:"mt-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[(()=>{const we=(Ne==null?void 0:Ne.I)||(Ne==null?void 0:Ne.F);if(!we)return null;const wt=I0(we);if(!wt&&!Ah()&&!Ni())return null;const St=(Ne==null?void 0:Ne.C)||`Item ${T.A}`;return wt?n.jsxs("a",{href:we,target:"_blank",rel:"noopener noreferrer",onClick:rr=>{rr.stopPropagation(),Fd(St,we)},className:"text-gray-400 hover:text-gray-300 hover:underline flex items-center",title:"Open songbook link in new tab",children:[n.jsx(vh,{className:"h-4 w-4 mr-2"}),"Open Songbook Link"]}):n.jsxs("button",{onClick:rr=>{rr.stopPropagation(),Fd(St,we),Ni()?(Rt(we),Ot(!0)):navigator.clipboard.writeText(we).then(()=>{Rt(we),Ot(!0)}).catch(Nr=>{console.error("Failed to copy to clipboard:",Nr),Rt(we),Ot(!0)})},className:"text-gray-400 hover:text-gray-300 hover:underline flex items-center",title:Ni()?"View folder path":"Copy folder path",children:[n.jsx(v0,{className:"h-4 w-4 mr-2"}),Ni()?"View Songbook Folder":"Copy Folder Path"]})})(),(Ne==null?void 0:Ne.H)&&n.jsx("span",{className:"text-sm font-mono font-bold text-gray-400",children:Ne.H})]})})]})]}),a.has(T.A)&&n.jsx("div",{id:`practice-item-content-${T.A}`,className:"px-5 pb-5",role:"region","aria-labelledby":`practice-item-title-${T.A}`,children:n.jsx("div",{className:"text-gray-400"})})]},T.A)})}),n.jsx(O0,{open:u,onOpenChange:w,itemId:g,currentNote:g?b[g]:"",onNoteSave:As}),ie&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsx("div",{className:`bg-gray-700 rounded-lg p-6 ${Ae||$==="complete"?"max-w-xs":"w-full max-w-md"} max-h-[80vh] flex flex-col`,onWheel:T=>T.stopPropagation(),children:$==="complete"?n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Success!"}),n.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-4",children:[n.jsx(_n,{className:"h-6 w-6 text-green-500"}),n.jsx("span",{className:"text-green-400 text-lg",children:"Chord charts copied successfully!"})]}),n.jsx(Be,{onClick:Zn,className:"w-full bg-green-600 hover:bg-green-700",children:"Done"})]}):Ae?n.jsxs(n.Fragment,{children:[n.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Overwrite"}),n.jsxs("p",{className:"text-gray-300 mb-4",children:[ve.size," of the selected songs already have chord charts. Copying will replace all existing chord charts in those songs."]}),n.jsxs("div",{className:"bg-gray-600 rounded p-3 mb-4",children:[n.jsx("p",{className:"text-sm text-gray-200 mb-2 font-medium",children:"Songs that will be overwritten:"}),n.jsx("ul",{className:"text-sm text-gray-300 space-y-1",children:Hs.filter(T=>X.has(T.A)&&ve.has(T.A)).map(T=>n.jsxs("li",{className:"flex items-center",children:[n.jsx("span",{className:"text-yellow-400 mr-2",children:"â€¢"}),T.C||"Unknown Song"]},T.A))})]}),n.jsx("p",{className:"text-sm text-gray-400 mb-6",children:"This action cannot be undone."}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{variant:"outline",onClick:oa,className:"flex-1",children:"Go Back"}),n.jsx(Be,{onClick:Ya,className:"flex-1 bg-red-600 hover:bg-red-700",children:"Yes, Overwrite"})]})]}):n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Copy chord charts"}),n.jsxs("p",{className:"text-gray-300 mb-2",children:['Copy chord charts from "',((Kt=i==null?void 0:i.find(T=>T.B===ne))==null?void 0:Kt.C)||"Unknown Song",'" to:']}),n.jsx("input",{type:"text",placeholder:"Search songs...",value:H,onChange:T=>Z(T.target.value),className:"w-full p-2 mb-4 bg-gray-700 text-white rounded border border-gray-600 focus:border-purple-500"}),n.jsx("div",{className:"flex-1 overflow-y-auto mb-4 min-h-0 modal-scroll",children:Hs.map(T=>n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx("input",{type:"checkbox",id:`copy-item-${T.A}`,checked:X.has(T.A),onChange:()=>Ga(T.A),className:"mr-3"}),n.jsxs("label",{htmlFor:`copy-item-${T.A}`,className:"text-white cursor-pointer flex-1 flex items-center",children:[n.jsx("span",{children:T.C||"Untitled"}),ve.has(T.A)&&n.jsx("span",{className:"text-yellow-400 ml-2 text-sm",children:" âš ï¸will overwrite"})]})]},T.A))}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{variant:"outline",onClick:Zn,className:"flex-1",children:"Cancel"}),n.jsx(Be,{onClick:ia,disabled:X.size===0,style:X.size===0?{backgroundColor:"#4b5563",color:"#d1d5db",opacity:"1"}:ve.size>0?{backgroundColor:"#dc2626",color:"#ffffff",opacity:"1"}:{backgroundColor:"#5b1f1f",color:"#ffffff",opacity:"1"},className:"flex-1 bg-purple-600 hover:bg-purple-700 disabled:cursor-not-allowed",children:ve.size>0?`Copy and Overwrite ${X.size} song${X.size!==1?"s":""}`:`Copy to ${X.size} song${X.size!==1?"s":""}`})]})]})})}),B&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsxs("div",{className:"bg-gray-700 rounded-lg p-6 w-full max-w-md max-h-[80vh] flex flex-col",onWheel:T=>T.stopPropagation(),children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"Copy chord charts from other song"}),n.jsxs("p",{className:"text-gray-300 mb-2",children:['Copy chord charts to "',((lr=i==null?void 0:i.find(T=>T.B===Te))==null?void 0:lr.C)||"Unknown Song",'" from:']}),n.jsx("input",{type:"text",placeholder:"Search songs with chord charts...",value:me,onChange:T=>de(T.target.value),className:"w-full p-2 mb-4 bg-gray-700 text-white rounded border border-gray-600 focus:border-blue-500"}),n.jsx("div",{className:"flex-1 overflow-y-auto mb-4 min-h-0 modal-scroll",children:di.map(T=>n.jsxs("div",{className:"flex items-center mb-2",children:[n.jsx("input",{type:"radio",id:`copy-from-item-${T.A}`,name:"copyFromSource",checked:Le===T.B,onChange:()=>Ie(T.B),className:"mr-3"}),n.jsxs("label",{htmlFor:`copy-from-item-${T.A}`,className:"flex-1 cursor-pointer text-white hover:text-gray-300",children:[T.C||"Unknown Song",n.jsxs("span",{className:"text-xs text-gray-400 ml-2",children:["(",na[T.B]||0," charts)"]})]})]},T.A))}),n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Be,{variant:"outline",onClick:Sa,className:"flex-1",children:"Cancel"}),n.jsx(Be,{onClick:gi,disabled:!Le,className:"flex-1 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Copy chord charts"})]})]})}),n.jsx(Qs,{open:Me,onOpenChange:Ke,children:n.jsxs(Rs,{children:[n.jsxs(Ds,{children:[n.jsxs(Ms,{className:"flex items-center space-x-2",children:[n.jsx(Bn,{className:"h-5 w-5 text-orange-500"}),n.jsx("span",{children:"Replace existing chord charts"})]}),n.jsx(Us,{children:"This song already has chord charts. To use autocreate, all existing chord charts must be deleted first. This action cannot be undone."})]}),n.jsxs(Bs,{children:[n.jsx(xa,{onClick:()=>{Ke(!1),j(null)},children:"Cancel"}),n.jsx(Ss,{onClick:Es,className:"bg-orange-500 hover:bg-orange-600 text-white border-orange-500 shadow-lg font-medium",children:"Delete all & autocreate"})]})]})}),n.jsx(Qs,{open:wn,onOpenChange:rn,children:n.jsxs(Rs,{className:"w-80 min-h-[600px]",children:[n.jsxs(Ds,{children:[n.jsxs(Ms,{className:"flex items-center space-x-2",children:[n.jsx(Bn,{className:"h-5 w-5 text-blue-500"}),n.jsx("span",{children:"Mixed Content Detected"})]}),n.jsx(Us,{children:"Your file contains both chord names and chord charts. How would you like to process it?"})]}),n.jsxs("div",{className:"space-y-4 my-8",children:[n.jsxs(Ss,{onClick:()=>Nt("chord_names"),className:"w-full h-auto p-6 flex flex-col items-center bg-slate-700 hover:bg-slate-600 text-white",children:[n.jsx("div",{className:"font-medium",children:"Process Chord Names"}),n.jsx("div",{className:"text-sm text-slate-300 mt-1",children:"(standard tuning)"})]}),n.jsx(Ss,{onClick:()=>Nt("chord_charts"),className:"w-full p-4 bg-slate-700 hover:bg-slate-600 text-white",children:"Import chord charts"})]}),n.jsx(Bs,{children:n.jsx(xa,{onClick:()=>{rn(!1),mn(null)},children:"Cancel"})})]})}),n.jsx(Qs,{open:vn,onOpenChange:Yr,children:n.jsxs(Rs,{children:[n.jsxs(Ds,{children:[n.jsxs(Ms,{className:"flex items-center space-x-2",children:[n.jsx(Bn,{className:"h-5 w-5 text-red-500"}),n.jsx("span",{children:(Wr==null?void 0:Wr.title)||"Format Not Supported"})]}),n.jsx(Us,{children:(Wr==null?void 0:Wr.message)||"Sorry, we can only build chord charts. This file format is not supported."})]}),n.jsx(Bs,{children:n.jsx(Ss,{onClick:()=>{Yr(!1),yr(null)},children:"OK"})})]})}),n.jsx(Qs,{open:vt,onOpenChange:Zt,children:n.jsxs(Rs,{children:[n.jsxs(Ds,{children:[n.jsx(Ms,{children:"Are you sure you wanna do that?"}),n.jsx(Us,{children:"You'll have to wait just as long next time if you start over"})]}),n.jsxs(Bs,{children:[n.jsx(xa,{onClick:x,children:"*sigh* Ok, I'll wait..."}),n.jsx(Ss,{onClick:yi,children:"Yes, damnit, cancel!"})]})]})}),n.jsx(Qs,{open:Wt,onOpenChange:T=>{T||hi()},children:n.jsxs(Rs,{className:"max-w-md",children:[n.jsxs(Ds,{children:[n.jsxs(Ms,{className:"flex items-center space-x-2",children:[n.jsx("span",{children:"ðŸ””"}),n.jsx("span",{children:"Timer sound"})]}),n.jsx(Us,{asChild:!0,children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("p",{children:["Since this is your first time with the timer, you're going to want to set a level for it. It should be loud enough for you to hear it over your playing, but not loud enough to give you a jump scare or make your ears ring. ",n.jsx("a",{href:"/#Account",className:"text-blue-400 hover:text-blue-300 underline",children:"Go to settings"})," to set your levels now."]}),n.jsx("p",{children:"A bell will ring when your timer is up. If you don't hear it, click the settings icon in your browser's address bar and enable sound:"}),n.jsx("img",{src:"/static/images/chromiumsoundsettings.png",alt:"Browser sound settings - click the settings icon in the address bar and toggle Sound on",className:"rounded border border-gray-600 mx-auto"})]})})]}),n.jsxs(Bs,{className:"flex-col sm:flex-row gap-2",children:[n.jsx(xa,{onClick:hi,children:"Remind me next time"}),n.jsx(Ss,{onClick:Wa,className:"bg-blue-600 hover:bg-blue-700",children:"Got it"})]})]})}),n.jsx(Fh,{isOpen:Lr,onClose:()=>{ur(!1),vr(null)},error:ns}),n.jsx(yc,{isOpen:kn,onClose:()=>{nn(!1),Hr(null)},autocreateData:Cn}),n.jsx(Qs,{open:_t,onOpenChange:Ot,children:n.jsxs(Rs,{className:"bg-gray-800 border-gray-700 max-w-2xl",children:[n.jsxs(Ds,{children:[n.jsx(Ms,{className:"text-gray-100",children:Ni()?"Songbook Folder Path":"Path Copied to Clipboard"}),n.jsx(Us,{className:"text-gray-300",children:Ni()?n.jsxs(n.Fragment,{children:[n.jsx("p",{className:"mb-2",children:"Here's the folder path for this item:"}),n.jsx("code",{className:"block bg-gray-900 p-2 rounded text-sm break-all text-gray-200",children:ir})]}):n.jsxs(n.Fragment,{children:[n.jsxs("p",{className:"mb-2",children:["The path has been copied to your clipboard. Open ",n.jsx("strong",{children:T0()}),", paste, then hit ",n.jsx("kbd",{className:"bg-gray-700 px-2 py-1 rounded text-xs",children:"Enter"})," to open the folder."]}),n.jsx("code",{className:"block bg-gray-900 p-2 rounded text-sm break-all text-gray-200",children:ir})]})})]}),n.jsx(Bs,{children:n.jsx(Ss,{onClick:()=>Ot(!1),className:"bg-orange-600 hover:bg-orange-700 text-white",children:"OK"})})]})}),He&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsxs("div",{className:"bg-gray-700 rounded-lg p-6 w-full max-w-md max-h-[80vh] flex flex-col",children:[n.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"No Transcripts Available"}),n.jsx("p",{className:"text-gray-300 mb-4",children:"Oh, drag. This YouTube video doesn't have transcripts on it. So, go find a free tool to generate transcripts from YouTube videos, then copy/paste the transcript below:"}),n.jsx("textarea",{value:nt,onChange:T=>ot(T.target.value),placeholder:"Paste the transcript here...",className:"w-full h-32 p-3 bg-gray-800 text-white rounded border border-gray-600 focus:border-red-500 resize-none mb-4",maxLength:25e3}),n.jsxs("p",{className:"text-xs text-gray-400 mb-4",children:[nt.length,"/25,000 characters"]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(Be,{variant:"outline",onClick:()=>{et(!1),rt(null),ot("")},className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-600",children:"Cancel"}),n.jsxs(Be,{variant:"outline",onClick:async()=>{if(!nt.trim()){alert("Please paste a transcript before proceeding.");return}const{itemId:T}=it;et(!1),rt(null),await Xe(T,nt),ot("")},disabled:!nt.trim(),className:`flex-1 ${nt.trim()?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-600 text-gray-500 cursor-not-allowed"}`,children:[n.jsx(gc,{className:"h-4 w-4 mr-2"}),"ðŸª„ Create chord charts"]})]})]})}),n.jsx(es,{open:At,onOpenChange:T=>!T&&jt(!1),children:n.jsxs(Vn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Yn,{className:"flex items-center gap-2",children:[n.jsx(Bn,{className:"h-6 w-6 text-orange-500"}),"No Chord Names Found"]}),n.jsx(ts,{className:"text-left space-y-1",children:n.jsx("p",{children:"So, um, we can't find any chord names mentioned in this video. Sorry, we can't create tablature yet, just chord charts."})})]}),n.jsx("div",{className:"flex justify-end gap-2 -mt-2",children:n.jsx(Be,{onClick:()=>jt(!1),className:"min-w-20",children:"Ok"})})]})})]})},rf=()=>{const[r,t]=U.useState(!1),[e,s]=U.useState(!1),[i,a]=U.useState(!0),[d,o]=U.useState(null),c=U.useCallback(async()=>{try{const b=await fetch("/api/auth/status");if(!b.ok)throw new Error("Auth check failed");const m=await b.json();t(m.authenticated),s(m.hasSpreadsheetAccess),o(null)}catch(b){console.error("Auth check failed:",b),t(!1),s(!1),o(b.message)}finally{a(!1)}},[]);return U.useEffect(()=>{c();const b=setInterval(c,900*1e3);return()=>clearInterval(b)},[c]),{isAuthenticated:r,hasSpreadsheetAccess:e,checking:i,error:d,handleLogin:()=>{window.location.href="/authorize"},handleLogout:()=>{sessionStorage.removeItem("lapsedModalDismissed"),window.location.href="/logout/"},checkAuth:c}},mm=s0,gm=a0,xm=i0,nf=U.forwardRef(({className:r,sideOffset:t=4,...e},s)=>n.jsx(n0,{ref:s,sideOffset:t,className:"z-50 overflow-hidden rounded-md bg-gray-900 px-3 py-1.5 text-sm text-gray-50 shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",...e}));nf.displayName="TooltipContent";const ym=gm,bm=()=>{const{isAuthenticated:r,hasSpreadsheetAccess:t,checking:e,error:s,handleLogin:i,handleLogout:a}=rf(),{setActivePage:d}=Mi();return n.jsxs("div",{className:"ml-auto flex items-end gap-2",children:[r&&!t&&n.jsx("span",{className:"text-sm text-red-400",children:"Log in with gmail acct instead"}),r?n.jsxs("div",{className:"flex flex-col gap-1 items-end",children:[n.jsx(mm,{children:n.jsxs(ym,{children:[n.jsx(xm,{asChild:!0,children:n.jsx(Be,{onClick:()=>d("Account"),variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-200 h-auto py-1","aria-label":"Account settings","data-ph-capture-attribute-button":"account-settings",children:n.jsx(C0,{className:"h-4 w-4"})})}),n.jsx(nf,{children:n.jsx("p",{children:"Account/Settings"})})]})}),n.jsx(Be,{onClick:a,variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-200 h-auto py-1","data-ph-capture-attribute-button":"logout",children:"logout"})]}):e?null:n.jsx(Be,{onClick:i,variant:"default",className:"bg-blue-600 hover:bg-blue-700 text-gray-100","data-ph-capture-attribute-button":"login",children:s?"Auth Error - Click to retry":n.jsxs(n.Fragment,{children:[n.jsx(_0,{className:"mr-2 h-4 w-4","aria-hidden":"true"}),"Let me in"]})})]})},wm=({className:r,userStatus:t,onUnpluggedAttempt:e})=>{const{activePage:s,setActivePage:i}=Mi(),a=["Practice","Routines","Items"],d=o=>{if(t!=null&&t.unplugged_mode&&(o==="Routines"||o==="Items")){e==null||e(o);return}i(o)};return n.jsxs("nav",{className:$r("flex flex-wrap items-center gap-4",r),"aria-label":"Main navigation",children:[n.jsxs("div",{className:"flex flex-wrap gap-4",children:[a.map(o=>n.jsx(Be,{variant:s===o?"secondary":"ghost",className:$r("text-xl py-6 px-8",s===o?"bg-secondary hover:bg-secondary/90":"hover:bg-accent"),onClick:()=>d(o),"aria-current":s===o?"page":void 0,"data-tour":o==="Practice"?"practice-tab":o==="Routines"?"routines-tab":o==="Items"?"items-tab":void 0,"data-ph-capture-attribute-nav":`nav-${o.toLowerCase()}`,children:o},o)),n.jsx(Be,{variant:s==="Account"?"secondary":"ghost",className:$r("text-xl py-6 px-8",s==="Account"?"bg-secondary hover:bg-secondary/90":"hover:bg-accent","hidden"),onClick:()=>i("Account"),"aria-current":s==="Account"?"page":void 0,"data-tour":"account-tab",children:"Account"})]}),n.jsx(bm,{})]})},vm=(r=null,t=null,e=[])=>{const[s,i]=U.useState([]),[a,d]=U.useState({}),[o,c]=U.useState(""),[h,p]=U.useState(!0),[b,m]=U.useState(null);U.useEffect(()=>{t!=null&&t.items?(i(t.items),p(!1)):r?u():(i([]),p(!1))},[r,t]);const u=async()=>{try{const S=await fetch(`/api/routines/${r}/details`);if(!S.ok)throw new Error("Failed to fetch routine");const E=(await S.json()).items.sort((I,K)=>parseInt(I.routineEntry.C)-parseInt(K.routineEntry.C));i(E),m(null)}catch(S){m(S.message),console.error("Fetch error:",S)}finally{p(!1)}};return{availableItems:U.useMemo(()=>{const S=new Set(s.map(E=>{var I,K;return((I=E.itemDetails)==null?void 0:I.B)||((K=E.routineEntry)==null?void 0:K.B)}));return e.filter(E=>{const I=S.has(E.B),K=F=>F.replace(/[''`]/g,"'"),Y=E.C||"",V=K(Y.toLowerCase()),O=K(o.toLowerCase()),Q=V.includes(O);return!I&&Q})},[e,s,o]),selectedItems:s,setSelectedItems:i,searchQuery:o,setSearchQuery:c,loading:h,error:b,addToRoutine:async(S,L)=>{try{if(!(await fetch(`/api/routines/${S}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemId:L})})).ok)throw new Error("Failed to add item to routine");return await u(),!0}catch(E){return console.error("Error adding item:",E),!1}},removeFromRoutine:async(S,L)=>{try{const E=await fetch(`/api/routines/${S}/items/${L}`,{method:"DELETE"});if(!E.ok){const I=await E.json().catch(()=>({}));throw new Error(I.message||"Failed to remove item from routine")}return i(I=>I.filter(K=>K.routineEntry.A!==L)),!0}catch(E){return console.error("Error removing item:",E),!1}},updateRoutineOrder:async(S,L)=>{try{const E=L.map(Y=>({A:Y.A,C:Y.C})),I=`/api/routines/${S}/order`,K=await fetch(I,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!K.ok){const Y=await K.json().catch(()=>({}));throw console.error("Order update failed:",Y),new Error(Y.message||"Failed to update routine order")}return await u(),!0}catch(E){return console.error("Error updating routine order:",E),!1}}}},Nm=Bi.memo(({item:r,onAdd:t})=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-800 rounded-lg",children:[n.jsx("span",{className:"text-lg",children:r.C}),n.jsx(Be,{variant:"ghost",size:"sm",onClick:()=>t(r),className:"text-blue-500 hover:text-blue-400","aria-label":"Add item to routine","data-ph-capture-attribute-button":"routine-add-item",children:n.jsx(mo,{className:"h-4 w-4","aria-hidden":"true"})})]})),_m=Bi.memo(({item:r,onRemove:t})=>{var h,p;const{attributes:e,listeners:s,setNodeRef:i,transform:a,transition:d,isDragging:o}=yl({id:((h=r.routineEntry)==null?void 0:h.A)||r.A}),c={transform:bl.Transform.toString(a),transition:d,zIndex:o?1:0};return n.jsxs("div",{ref:i,style:c,className:`flex items-center justify-between p-4 ${o?"bg-gray-700":"bg-gray-800"} rounded-lg`,children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{...e,...s,"aria-label":"Drag to reorder item in routine","data-ph-capture-attribute-drag":"routine-editor-drag-handle",children:n.jsx(wl,{className:"h-5 w-5 text-gray-500 mr-4 cursor-move","aria-hidden":"true"})}),n.jsx("span",{className:"text-lg",children:((p=r.itemDetails)==null?void 0:p.C)||"Loading..."})]}),n.jsx(Be,{variant:"ghost",size:"sm",onClick:()=>{var b;return t(((b=r.routineEntry)==null?void 0:b.A)||r.A)},className:"text-red-500 hover:text-red-400","aria-label":"Remove item from routine","data-ph-capture-attribute-button":"routine-remove-item",children:n.jsx(Gr,{className:"h-4 w-4","aria-hidden":"true"})})]})}),jm=({open:r,onOpenChange:t,routine:e=null,onRoutineChange:s,items:i=[]})=>{const{availableItems:a,selectedItems:d,setSelectedItems:o,searchQuery:c,setSearchQuery:h,loading:p,error:b,addToRoutine:m,removeFromRoutine:u,updateRoutineOrder:w}=vm(e==null?void 0:e.id,e==null?void 0:e.details,i),[g,N]=U.useState((e==null?void 0:e.name)||""),[y,S]=U.useState(null);U.useEffect(()=>{r&&S(null)},[r]),U.useEffect(()=>{},[e]);const L=Dc(Di(Uc,{activationConstraint:{delay:100,tolerance:5}}),Di(Mc,{coordinateGetter:Bc})),E=async({active:Y,over:V})=>{if(Y.id!==(V==null?void 0:V.id)){const O=d.findIndex(M=>{var _;return(((_=M.routineEntry)==null?void 0:_.A)||M.A)===Y.id}),Q=d.findIndex(M=>{var _;return(((_=M.routineEntry)==null?void 0:_.A)||M.A)===V.id}),F=cl(d,O,Q),k=F.map((M,_)=>{var te;return{A:((te=M.routineEntry)==null?void 0:te.A)||M.A,C:_.toString()}});if(o(F),e!=null&&e.id)try{await w(e.id,k),s&&s()}catch(M){console.error("Failed to update routine order:",M),o(d)}}},I=async Y=>{try{if(S(null),!(e!=null&&e.id))o(V=>[...V,{routineEntry:{A:Y.A,B:Y.B,C:V.length.toString(),D:"FALSE"},itemDetails:Y}]);else{if(!await m(e.id,Y.B))throw new Error("Failed to add item to routine");mc("item_added",e.name,Y.C,{routine_id:e.id,item_id:Y.B}),s==null||s()}}catch(V){S(V.message),console.error("Error adding item:",V)}},K=async Y=>{var V,O;try{if(S(null),!(e!=null&&e.id))o(Q=>Q.filter(F=>F.routineEntry.A!==Y));else{const Q=d.find(k=>{var M;return(((M=k.routineEntry)==null?void 0:M.A)||k.A)===Y});if(!await u(e.id,Y))throw new Error("Failed to remove item from routine");Q&&mc("item_removed",e.name,(V=Q.itemDetails)==null?void 0:V.C,{routine_id:e.id,item_id:(O=Q.itemDetails)==null?void 0:O.B}),s==null||s()}}catch(Q){S(Q.message),console.error("Error removing item:",Q)}};return p?n.jsx("div",{className:"text-2xl text-center p-8",role:"status","aria-live":"polite",children:"Loading..."}):b?n.jsx("div",{className:"text-2xl text-red-500 text-center p-8",role:"alert",children:b}):n.jsx(es,{open:r,onOpenChange:t,children:n.jsxs(Vn,{className:"max-w-4xl max-h-[80vh]",children:[n.jsxs(Gn,{children:[n.jsx(Yn,{children:e?`Edit routine: ${e.name}`:"Create new routine"}),n.jsx(ts,{children:"Add or remove items and arrange them in your preferred order"}),y&&n.jsx("div",{className:"mt-2 text-sm text-red-500",role:"alert",children:y})]}),n.jsxs("div",{className:"flex gap-8 h-[60vh]",children:[n.jsxs(cn,{className:"w-1/2 bg-gray-900",children:[n.jsxs(jn,{children:[n.jsx(dn,{children:"Selected items"}),!(e!=null&&e.name)&&n.jsx(Dr,{placeholder:"Enter routine name...",value:g,onChange:Y=>N(Y.target.value),className:"mt-2",autoComplete:"off"})]}),n.jsx(un,{className:"space-y-4 overflow-y-auto h-[calc(100%-100px)]",children:n.jsx(al,{sensors:L,collisionDetection:il,onDragEnd:E,children:n.jsx(ol,{items:d.map(Y=>{var V;return((V=Y.routineEntry)==null?void 0:V.A)||Y.A}).filter(Y=>Y!=null),strategy:ll,children:n.jsx("div",{className:"space-y-4",children:d.filter(Y=>{var V;return(((V=Y.routineEntry)==null?void 0:V.A)||Y.A)!=null}).map(Y=>{var V;return n.jsx(_m,{item:Y,onRemove:K},((V=Y.routineEntry)==null?void 0:V.A)||Y.A)})})})})})]}),n.jsxs(cn,{className:"w-1/2 bg-gray-900",children:[n.jsxs(jn,{children:[n.jsx(dn,{children:"Available items"}),n.jsxs("div",{className:"relative",children:[n.jsx(k0,{className:"absolute left-3 top-3 h-4 w-4 text-gray-500"}),n.jsx(Dr,{className:"pl-9",placeholder:"Search items...",value:c,onChange:Y=>h(Y.target.value),autoComplete:"off"})]})]}),n.jsx(un,{className:"space-y-4 overflow-y-auto h-[calc(100%-100px)]",children:a.map(Y=>n.jsx(Nm,{item:Y,onAdd:I},Y.A))})]})]})]})})},Sm=Bi.memo(({item:r,itemDetails:t,handleOpenChordCharts:e})=>{var p,b,m;const{attributes:s,listeners:i,setNodeRef:a,transform:d,transition:o,isDragging:c}=yl({id:((p=r.routineEntry)==null?void 0:p.A)||r.A}),h={transform:bl.Transform.toString(d),transition:o,zIndex:c?1:0};return n.jsxs("div",{ref:a,style:h,className:`flex items-center justify-between p-4 rounded-lg ${c?"bg-gray-700":"bg-gray-800"}`,children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{...s,...i,"aria-label":"Drag to reorder item","data-ph-capture-attribute-drag":"routine-item-drag-handle",children:n.jsx(wl,{className:"h-5 w-5 text-gray-500 mr-4 cursor-move","aria-hidden":"true"})}),n.jsx("span",{className:"text-lg",children:(t==null?void 0:t.C)||`Item ${((b=r.routineEntry)==null?void 0:b.B)||r.B}`})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(Be,{variant:"ghost",size:"icon",onClick:()=>{var u,w;return e(((u=r.routineEntry)==null?void 0:u.B)||r.B,(t==null?void 0:t.C)||`Item ${((w=r.routineEntry)==null?void 0:w.B)||r.B}`)},className:"text-blue-400 hover:text-blue-300 hover:bg-gray-700 h-8 w-8",title:"Click to add or edit chord charts","data-ph-capture-attribute-button":"routine-item-chord-charts",children:[n.jsx(tf,{className:"h-5 w-5","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Chord charts"})]}),(((m=r.routineEntry)==null?void 0:m.D)||r.D)==="TRUE"&&n.jsx(Rc,{className:"h-5 w-5 text-green-500","aria-hidden":"true"})]})]})}),km=Bi.memo(({routine:r,handleActivateRoutine:t,handleEditClick:e,handleDeleteClick:s})=>{const{attributes:i,listeners:a,setNodeRef:d,transform:o,transition:c,isDragging:h}=yl({id:r.ID}),p={transform:bl.Transform.toString(o),transition:c,zIndex:h?1:0};return n.jsxs("div",{ref:d,style:p,className:`flex items-center justify-between p-3 ${h?"bg-gray-700":"bg-gray-800"} rounded-lg`,children:[n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{...i,...a,"aria-label":"Drag to reorder routine","data-ph-capture-attribute-drag":"routine-drag-handle",children:n.jsx(wl,{className:"h-5 w-5 text-gray-500 mr-4 cursor-move","aria-hidden":"true"})}),n.jsx("span",{children:r.name})]}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsxs(Be,{variant:"ghost",size:"sm",onClick:()=>t(r.ID),className:"text-green-500 hover:text-green-400",title:"Make this the active routine","data-ph-capture-attribute-button":"activate-routine",children:[n.jsx(mo,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Activate routine"})]}),n.jsxs(Be,{variant:"ghost",size:"sm",onClick:()=>e(r),className:"text-blue-500 hover:text-blue-400",title:"Edit routine","data-ph-capture-attribute-button":"edit-routine",children:[n.jsx(uo,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Edit routine"})]}),n.jsxs(Be,{variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-400",onClick:()=>s(r.ID),title:"Delete this routine","data-ph-capture-attribute-button":"delete-routine",children:[n.jsx(Gr,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Delete routine"})]})]})]})}),Cm=()=>{const{isAuthenticated:r,checking:t}=rf(),[e,s]=U.useState([]),[i,a]=U.useState(""),[d,o]=U.useState([]),[c,h]=U.useState(!0),[p,b]=U.useState(null),[m,u]=U.useState(!1),[w,g]=U.useState(null),[N,y]=U.useState(null),[S,L]=U.useState([]),[E,I]=U.useState(!1),[K,Y]=U.useState(null),[V,O]=U.useState(""),[Q,F]=U.useState(!1),[k,M]=U.useState({limitType:"routines",currentTier:"free",currentCount:0,limitAmount:1}),_=U.useRef(null),te=U.useRef(null),ae=U.useMemo(()=>d.find(Se=>Se.active),[d]),re=U.useMemo(()=>d.filter(Se=>!Se.active).sort((Se,j)=>Number(Se.order)-Number(j.order)),[d]),se=Dc(Di(Uc,{activationConstraint:{delay:100,tolerance:5}}),Di(Mc,{coordinateGetter:Bc})),ie=U.useCallback(async()=>{if(!r){h(!1);return}try{y(null);const Se=await fetch("/api/routines");if(!Se.ok)throw new Error("Failed to fetch routines");const j=await Se.json();o(j)}catch(Se){console.error("Error:",Se),y(Se.message)}finally{h(!1)}},[r]),je=U.useCallback(async()=>{if(e.length===0)try{const Se=await fetch("/api/items");if(!Se.ok)throw new Error("Failed to fetch items");const j=await Se.json();s(j)}catch(Se){console.error("Error fetching items:",Se),y(Se.message)}},[e.length]),ne=U.useCallback(async Se=>{try{if(!(await fetch(`/api/routines/${Se}/active`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!0})})).ok)throw new Error("Failed to activate routine");const P=await fetch("/api/routines");if(P.ok){const G=await P.json();o(G);const $=G.find(z=>z.active);if($){mc("activated",$.Name,null,{routine_id:$.ID,item_count:$.ItemCount||0});const z=await fetch(`/api/routines/${$.ID}`);if(z.ok){const he=(await z.json()).items.sort((me,de)=>parseInt(me.routineEntry.C)-parseInt(de.routineEntry.C)).map(me=>({...me,itemDetails:me.itemDetails||me}));L(he)}}}}catch(j){console.error("Error:",j),y(j.message)}},[]),A=U.useCallback(async Se=>{try{if(!(await fetch(`/api/routines/${Se}/active`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({active:!1})})).ok)throw new Error("Failed to deactivate routine");const P=await fetch("/api/routines");if(P.ok){const G=await P.json();o(G),L([])}}catch(j){console.error("Error:",j),y(j.message)}},[]),H=U.useCallback(Se=>{b(d.find(j=>j.ID===Se))},[d]),Z=U.useCallback((Se,j)=>{Y(Se),O(j),I(!0)},[]),X=U.useCallback(async()=>{if(p)try{if(!(await fetch(`/api/routines/${p.ID}`,{method:"DELETE"})).ok)throw new Error("Failed to delete routine");co("deleted","routine",p.Name),await ie()}catch(Se){console.error("Failed to delete routine:",Se),y(Se.message)}finally{b(null)}},[p,ie]),pe=U.useCallback(async()=>{if(i.trim())try{const Se=await fetch("/api/routines",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({routineName:i.trim()})});if(!Se.ok){if(Se.status===403){const j=await Se.json();if(j.error==="Routine limit reached"){M({limitType:"routines",currentTier:j.tier||"free",currentCount:j.current||0,limitAmount:j.limit||1}),F(!0);return}}throw new Error("Failed to create routine")}co("created","routine",i.trim()),await ie(),a("")}catch(Se){console.error("Failed to create routine:",Se),y(Se.message)}},[i,ie]),ve=U.useCallback(async Se=>{await je();const j=Se.active?{id:Se.ID,name:Se.name,items:S.map(P=>({routineEntry:P.routineEntry||P,itemDetails:P.itemDetails}))}:null;g({id:Se.ID,name:Se.name,details:j}),u(!0)},[S,je]),ke=U.useCallback(async()=>{const Se=await fetch("/api/routines");if(!Se.ok){console.error("Failed to fetch routines");return}const j=await Se.json();o(j);const P=j.find($=>$.active);if(!P){L([]);return}const G=await fetch(`/api/routines/${P.ID}`);if(G.ok){const z=(await G.json()).items.sort((B,he)=>parseInt(B.routineEntry.C)-parseInt(he.routineEntry.C)).map(B=>({...B,itemDetails:B.itemDetails||B}));L(z)}},[]),Ae=U.useCallback(async()=>{try{const Se=await fetch("/api/routines");if(!Se.ok)throw new Error("Failed to fetch routines");const P=(await Se.json()).find(B=>B.active);if(!P){L([]);return}const G=await fetch(`/api/routines/${P.ID}`);if(!G.ok)throw new Error("Failed to fetch routine details");const z=(await G.json()).items.sort((B,he)=>parseInt(B.routineEntry.C)-parseInt(he.routineEntry.C)).map(B=>({...B,itemDetails:B.itemDetails||B}));L(z),fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`LOAD: Active routine items loaded: ${z.length} items`,level:"info"})}),z.length>0&&fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`LOAD: Sortable IDs: ${z.map(B=>{var he;return((he=B.routineEntry)==null?void 0:he.A)||B.A}).join(", ")}`,level:"info"})})}catch(Se){console.error("Error fetching routine items:",Se),y(Se.message)}},[]);U.useEffect(()=>{Ae()},[Ae]);const De=async({active:Se,over:j})=>{if(fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`ACTIVE ROUTINE handleDragEnd called: active=${Se==null?void 0:Se.id}, over=${j==null?void 0:j.id}`,level:"info"})}),!Se||!j||Se.id===j.id){fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:"ACTIVE ROUTINE Drag end early return - no valid drag",level:"info"})});return}const P=S.findIndex($=>{var z;return(((z=$.routineEntry)==null?void 0:z.A)||$.A)===Se.id}),G=S.findIndex($=>{var z;return(((z=$.routineEntry)==null?void 0:z.A)||$.A)===j.id});fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`ACTIVE ROUTINE Indices: old=${P}, new=${G}, activeId=${Se.id}, overId=${j.id}`,level:"info"})});try{const $=await fetch("/api/routines/active");if(!$.ok)throw new Error("Failed to fetch active routine");const B=(await $.json()).A;if(!B)throw new Error("No active routine found");const he=cl(S,P,G),me=he.map((Ie,Te)=>{var Ye;return{A:((Ye=Ie.routineEntry)==null?void 0:Ye.A)||Ie.A,C:Te.toString()}});L(he);const de=`/api/routines/${B}/order`,Le=await fetch(de,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(me)});if(!Le.ok){const Ie=await Le.text();throw new Error(`Failed to update routine order: ${Ie}`)}await Ae()}catch($){console.error("Reorder failed:",$),await Ae()}},Me=U.useCallback(async Se=>{try{const j=await fetch("/api/routines/order",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Se)});if(!j.ok){const P=await j.text();throw new Error(`Failed to update routine order: ${P}`)}}catch(j){console.error("Failed to save routine order:",j),y("Failed to save routine order. Please refresh the page."),await ie()}},[ie]),Ke=({active:Se,over:j})=>{if(fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`INACTIVE ROUTINES handleDragEnd called: active=${Se==null?void 0:Se.id}, over=${j==null?void 0:j.id}`,level:"info"})}),!Se||!j||Se.id===j.id)return;const P=re.findIndex(B=>B.ID===Se.id),G=re.findIndex(B=>B.ID===j.id),z=cl(re,P,G).map((B,he)=>({A:B.ID,D:he.toString()}));o(B=>{const he=B.find(de=>de.active),me=z.map(de=>({...B.find(Ie=>Ie.ID===de.A),order:de.D}));return he?[he,...me]:me}),te.current=z,_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{te.current&&(Me(te.current),te.current=null)},500)};return U.useEffect(()=>{t||(h(!0),ie())},[t,ie]),U.useEffect(()=>()=>{_.current&&(clearTimeout(_.current),te.current&&Me(te.current))},[Me]),t?n.jsx("div",{className:"text-center p-8",role:"status","aria-live":"polite",children:n.jsx("h2",{className:"text-2xl mb-4",children:"Checking authentication..."})}):c?n.jsx("div",{className:"text-center p-8",role:"status","aria-live":"polite",children:n.jsx("h2",{className:"text-2xl mb-4",children:"Loading routines..."})}):N?n.jsxs("div",{className:"text-center p-8",children:[n.jsxs("h2",{className:"text-2xl text-red-500 mb-4",children:["Error: ",N]}),n.jsx(Be,{onClick:ie,className:"bg-blue-600 hover:bg-blue-700",children:"Retry"})]}):r?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs(cn,{className:"bg-gray-900 text-gray-100","data-tour":"routines-items",children:[n.jsx(jn,{children:n.jsx(dn,{children:"Current active routine"})}),n.jsx(un,{children:r?ae?n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(Rc,{className:"h-5 w-5 text-green-500 mr-2","aria-hidden":"true"}),ae.name]}),n.jsxs("div",{className:"flex space-x-2","data-tour":"edit-routine-icon",children:[n.jsxs(Be,{variant:"ghost",size:"sm",onClick:()=>ve(ae),className:"text-blue-500 hover:text-blue-400",title:"Edit routine",children:[n.jsx(uo,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Edit routine"})]}),n.jsxs(Be,{variant:"ghost",size:"sm",onClick:()=>A(ae.ID),className:"text-gray-400 hover:text-gray-200",title:"Deactivate this routine",children:[n.jsx(Gr,{className:"h-4 w-4","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:"Deactivate routine"})]})]})]}),n.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"(use drag and drop handles on the left to change order of items)"}),n.jsx(al,{sensors:se,collisionDetection:il,onDragStart:Se=>{fetch("/api/debug/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:`ACTIVE ROUTINE Drag started: ${Se.active.id}`,level:"info"})})},onDragEnd:De,children:n.jsx(ol,{items:S.map(Se=>{var j;return((j=Se.routineEntry)==null?void 0:j.A)||Se.A}),strategy:ll,children:n.jsx("div",{className:"space-y-2 mt-4",children:S.map(Se=>{var j;return n.jsx(Sm,{item:Se,itemDetails:Se.itemDetails,handleOpenChordCharts:Z},((j=Se.routineEntry)==null?void 0:j.A)||Se.A)})})})})]}):n.jsx("div",{className:"text-gray-400",children:"No active routine selected"}):n.jsx("div",{className:"text-gray-400",children:"Please log in to manage routines"})})]}),n.jsxs(cn,{className:"bg-gray-900 text-gray-100",children:[n.jsx(jn,{children:n.jsx(dn,{children:"Routines"})}),n.jsx(un,{children:r?n.jsx(n.Fragment,{children:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"mb-4 flex space-x-2","data-tour":"new-routine-input",children:[n.jsx("label",{htmlFor:"new-routine-name-input",className:"sr-only",children:"New routine name"}),n.jsx(Dr,{id:"new-routine-name-input",placeholder:"Enter name for new routine, then click '+ Add'",value:i,onChange:Se=>a(Se.target.value),onKeyPress:Se=>Se.key==="Enter"&&!Se.shiftKey&&pe(),className:"flex-grow"}),n.jsxs(Be,{onClick:pe,className:"bg-blue-600 hover:bg-blue-700",disabled:!i.trim(),"data-ph-capture-attribute-button":"add-new-routine",children:[n.jsx(mo,{className:"h-5 w-5 mr-2","aria-hidden":"true"}),"Add"]})]}),n.jsx(al,{sensors:se,collisionDetection:il,onDragEnd:Ke,children:n.jsx(ol,{items:re.map(Se=>Se.ID).filter(Se=>Se!=null),strategy:ll,children:n.jsx("div",{className:"space-y-2",children:re.filter(Se=>Se.ID!=null).map(Se=>n.jsx(km,{routine:Se,handleActivateRoutine:ne,handleEditClick:ve,handleDeleteClick:H},Se.ID))})})})]})}):n.jsx("div",{className:"text-gray-400",children:"Please log in to manage routines"})})]}),n.jsx(Qs,{open:!!p,onOpenChange:Se=>{Se||b(null)},children:n.jsxs(Rs,{children:[n.jsxs(Ds,{children:[n.jsx(Ms,{children:"Delete routine"}),n.jsxs(Us,{children:['Are you sure you want to delete the "',p==null?void 0:p.name,`" routine? You can't undo this deletion. (Items will remain, but the routine will be gone.)`]})]}),n.jsxs(Bs,{children:[n.jsx(xa,{children:"Cancel"}),n.jsx(Ss,{onClick:X,className:"bg-red-500 hover:bg-red-600",children:"Delete"})]})]})})]}),n.jsx(jm,{open:m,onOpenChange:u,routine:w,onRoutineChange:ke,items:e}),n.jsx(ef,{isOpen:E,onClose:()=>I(!1),itemId:K,itemTitle:V}),n.jsx(Eh,{isOpen:Q,onClose:()=>F(!1),limitType:k.limitType,currentTier:k.currentTier,currentCount:k.currentCount,limitAmount:k.limitAmount})]}):n.jsx("div",{className:"text-center p-8",children:n.jsx("h2",{className:"text-2xl mb-4",children:"Please log in to manage routines"})})},Am=()=>{const[r,t]=U.useState([]),[e,s]=U.useState(null),[i,a]=U.useState(!0),[d,o]=U.useState(null),c=async()=>{try{a(!0);const m=await fetch("/api/routines");if(!m.ok)throw new Error("Failed to fetch routines");const u=await m.json();t(u),o(null)}catch(m){console.error("Fetch routines error:",m),o(m.message)}finally{a(!1)}},h=async m=>{try{if(!(await fetch("/api/routines",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({routineName:m})})).ok)throw new Error("Failed to create routine");return await c(),!0}catch(u){return console.error("Create routine error:",u),o(u.message),!1}},p=async m=>{try{if(!(await fetch(`/api/routines/${m}`,{method:"DELETE"})).ok)throw new Error("Failed to delete routine");return await c(),!0}catch(u){return console.error("Delete routine error:",u),o(u.message),!1}},b=async m=>{s(m)};return U.useEffect(()=>{c()},[]),{routines:r,activeRoutine:e,loading:i,error:d,createRoutine:h,deleteRoutine:p,activateRoutine:b,refreshRoutines:c}},Lm=h0,Em=f0,sf=U.forwardRef(({className:r,children:t,...e},s)=>n.jsxs(fh,{ref:s,className:$r("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",r),...e,children:[t,n.jsx(o0,{asChild:!0,children:n.jsx(Qn,{className:"h-4 w-4 opacity-50"})})]}));sf.displayName=fh.displayName;const af=U.forwardRef(({className:r,children:t,position:e="popper",...s},i)=>n.jsx(l0,{children:n.jsx(ph,{ref:i,className:$r("relative z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",r),position:e,...s,children:n.jsx(c0,{className:$r("p-1",e==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t})})}));af.displayName=ph.displayName;const Pm=U.forwardRef(({className:r,...t},e)=>n.jsx(mh,{ref:e,className:$r("py-1.5 pl-8 pr-2 text-sm font-semibold",r),...t}));Pm.displayName=mh.displayName;const of=U.forwardRef(({className:r,children:t,...e},s)=>n.jsxs(gh,{ref:s,className:$r("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r),...e,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(d0,{children:n.jsx(_n,{className:"h-4 w-4"})})}),n.jsx(u0,{children:t})]}));of.displayName=gh.displayName;const Tm=U.forwardRef(({className:r,...t},e)=>n.jsx(xh,{ref:e,className:$r("-mx-1 my-1 h-px bg-muted",r),...t}));Tm.displayName=xh.displayName;function Im(){const[r,t]=U.useState(""),[e,s]=U.useState(""),[i,a]=U.useState(""),[d,o]=U.useState(""),{routines:c,loading:h}=Am(),p=async()=>{try{const u=JSON.parse(r);if(!(await fetch("/api/items/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).ok)throw new Error("Failed to import items");t("")}catch(u){console.error("Import error:",u)}},b=async()=>{try{const u=JSON.parse(e);if(!(await fetch("/api/routines/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).ok)throw new Error("Failed to import routines");s("")}catch(u){console.error("Import error:",u)}},m=async()=>{try{if(!d)throw new Error("Please select a routine first");const u=JSON.parse(i);if(!(await fetch(`/api/routines/${d}/items/import`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)})).ok)throw new Error("Failed to import routine items");a("")}catch(u){console.error("Import error:",u)}};return n.jsx(cn,{className:"w-full max-w-4xl bg-gray-900 text-gray-100",children:n.jsxs(un,{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx(dn,{className:"text-2xl mb-4",children:"Import Items"}),n.jsx("p",{className:"text-gray-300 mb-4",children:"Import practice items from other sources. Items will be appended to your existing items."}),n.jsx(Pi,{value:r,onChange:u=>t(u.target.value),placeholder:"Paste your JSON data here...",className:"h-48 font-mono bg-gray-800 mb-2"}),n.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Expected format: Array of objects with 'title' and 'duration' fields"}),n.jsx(Be,{onClick:p,className:"bg-blue-600 hover:bg-blue-700",children:"Import Items"})]}),n.jsxs("div",{children:[n.jsx(dn,{className:"text-2xl mb-4",children:"Import Routine Items"}),n.jsx("p",{className:"text-gray-300 mb-4",children:"Import items into an existing routine. Items will be matched by title with existing items."}),n.jsxs("div",{className:"mb-4",children:[n.jsx(Hn,{htmlFor:"routine-select",className:"block mb-2",children:"Select Routine"}),n.jsxs(Lm,{value:d,onValueChange:o,disabled:h,children:[n.jsx(sf,{className:"w-full bg-gray-800",children:n.jsx(Em,{placeholder:"Select a routine"})}),n.jsx(af,{className:"bg-gray-800",children:c.map(u=>n.jsx(of,{value:u.ID,className:"text-gray-100 hover:bg-gray-700",children:u.name},u.ID))})]})]}),n.jsx(Pi,{value:i,onChange:u=>a(u.target.value),placeholder:"Paste your JSON data here...",className:"h-48 font-mono bg-gray-800 mb-2"}),n.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Expected format: Array of objects with 'title' field"}),n.jsx(Be,{onClick:m,className:"bg-blue-600 hover:bg-blue-700",children:"Import Routine Items"})]}),n.jsxs("div",{children:[n.jsx(dn,{className:"text-2xl mb-4",children:"Import Routines"}),n.jsx("p",{className:"text-gray-300 mb-4",children:"Import practice routines. Each routine will be created as a new routine."}),n.jsx(Pi,{value:e,onChange:u=>s(u.target.value),placeholder:"Paste your JSON data here...",className:"h-48 font-mono bg-gray-800 mb-2"}),n.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Expected format: Array of objects with 'name' field"}),n.jsx(Be,{onClick:b,className:"bg-blue-600 hover:bg-blue-700",children:"Import Routines"})]})]})})}const Fm=({isOpen:r,onClose:t,title:e,message:s,icon:i})=>{if(!r)return null;const a=()=>i||(e!=null&&e.includes("Upgraded")?n.jsx(kh,{className:"h-6 w-6 text-green-500"}):e!=null&&e.includes("Billing Updated")?n.jsx(wh,{className:"h-6 w-6 text-blue-500"}):e!=null&&e.includes("Changed")?n.jsx(S0,{className:"h-6 w-6 text-orange-500"}):n.jsx(bh,{className:"h-6 w-6 text-green-500"}));return n.jsx(es,{open:r,onOpenChange:d=>!d&&t(),children:n.jsxs(Vn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Yn,{className:"flex items-center gap-2 text-xl",children:[a(),e]}),n.jsx(ts,{className:"text-left space-y-3 text-base mt-4",children:n.jsx("div",{className:"whitespace-pre-line text-gray-700 dark:text-gray-300",children:s})})]}),n.jsx("div",{className:"flex justify-end mt-6",children:n.jsx(Be,{onClick:t,className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6",children:"Got it! ðŸŽ¸"})})]})})},Om=({isOpen:r,onClose:t,onConfirm:e,targetTier:s,targetTierName:i,billingPeriod:a="monthly"})=>{const[d,o]=U.useState(!0),[c,h]=U.useState(!1),[p,b]=U.useState(null),[m,u]=U.useState(null),[w,g]=U.useState(""),[N,y]=U.useState(!1),[S,L]=U.useState(null),[E,I]=U.useState(null);U.useEffect(()=>{r&&s&&K()},[r,s,S==null?void 0:S.promotion_code_id]),U.useEffect(()=>{r||(g(""),L(null),I(null),u(null),b(null))},[r]);const K=async()=>{o(!0),b(null);try{const te={tier:s,billing_period:a};S!=null&&S.promotion_code_id&&(te.promotion_code_id=S.promotion_code_id);const ae=await fetch("/api/billing/preview-upgrade",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)}),re=await ae.json();if(!ae.ok){b(re.error||"Failed to preview upgrade"),o(!1);return}u(re)}catch{b("Error connecting to server")}finally{o(!1)}},Y=async()=>{if(w.trim()){y(!0),I(null),L(null);try{const ae=await(await fetch("/api/billing/validate-promo-code",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:w.trim()})})).json();ae.valid?L(ae):I(ae.error||"Invalid promo code")}catch{I("Error validating promo code")}finally{y(!1)}}},V=()=>{g(""),L(null),I(null)},O=async()=>{h(!0);try{if(m!=null&&m.no_existing_subscription){const ie=await fetch("/api/billing/create-checkout-session",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({tier:s,billing_period:a})}),je=await ie.json();if(!ie.ok){b(je.error||"Failed to create checkout session"),h(!1);return}je.url&&(window.location.href=je.url);return}const te={tier:s,billing_period:a};S!=null&&S.promotion_code_id&&(te.promotion_code_id=S.promotion_code_id);const ae=await fetch("/api/billing/update-subscription",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)}),re=await ae.json();if(!ae.ok){b(re.error||"Failed to update subscription"),h(!1);return}e(re)}catch{b("Error connecting to server"),h(!1)}},Q=te=>{te.key==="Enter"&&w.trim()&&!N&&Y()},F=i||s,k=m==null?void 0:m.no_existing_subscription,M=a==="yearly"?"year":"month",_=()=>c?k?"Redirecting...":"Upgrading...":k?"Continue to checkout":"Confirm upgrade";return n.jsx(es,{open:r,onOpenChange:te=>!te&&t(),children:n.jsxs(Vn,{className:"sm:max-w-md",children:[n.jsxs(Gn,{children:[n.jsxs(Yn,{className:"flex items-center gap-2 text-xl",children:[n.jsx(kh,{className:"h-6 w-6 text-orange-500"}),"Upgrade to ",F]}),n.jsx(ts,{className:"text-left mt-4",children:"Review your upgrade details before confirming."})]}),n.jsxs("div",{className:"space-y-4 mt-4",children:[!k&&n.jsxs("div",{className:"space-y-2",children:[n.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Have a promo code?"}),S?n.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(bh,{className:"h-5 w-5 text-green-600 dark:text-green-400"}),n.jsxs("div",{children:[n.jsx("span",{className:"font-medium text-green-800 dark:text-green-300",children:w.toUpperCase()}),n.jsxs("span",{className:"text-sm text-green-600 dark:text-green-400 ml-2",children:[S.description,S.duration_description&&` ${S.duration_description}`]})]})]}),n.jsx(Be,{variant:"ghost",size:"sm",onClick:V,className:"text-green-600 hover:text-green-700 dark:text-green-400",children:"Remove"})]}):n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Dr,{type:"text",placeholder:"Enter code",value:w,onChange:te=>g(te.target.value.toUpperCase()),onKeyPress:Q,disabled:N,className:"flex-1 bg-white dark:bg-gray-800"}),n.jsx(Be,{onClick:Y,disabled:!w.trim()||N,className:"bg-gray-600 hover:bg-gray-700",children:N?n.jsx(Rr,{className:"h-4 w-4 animate-spin"}):n.jsxs(n.Fragment,{children:[n.jsx(A0,{className:"h-4 w-4 mr-1"}),"Apply"]})})]}),E&&n.jsxs("div",{className:"flex items-center gap-2 text-sm text-red-600 dark:text-red-400",children:[n.jsx(E0,{className:"h-4 w-4"}),E]})]}),k&&!d&&n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"You can enter a promo code on the checkout page."}),n.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4 space-y-3",children:d?n.jsxs("div",{className:"flex items-center justify-center py-4",children:[n.jsx(Rr,{className:"h-6 w-6 animate-spin text-orange-500"}),n.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Calculating..."})]}):p?n.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-3 text-sm text-red-600 dark:text-red-400",children:p}):m?n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Charged today:"}),n.jsxs("span",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:["$",m.proration_amount.toFixed(2)]})]}),n.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:m.proration_details}),m.discount&&n.jsxs("div",{className:"flex justify-between items-center text-green-600 dark:text-green-400",children:[n.jsx("span",{children:"Discount applied:"}),n.jsx("span",{children:m.discount.description})]}),n.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-3 mt-3",children:n.jsx("div",{className:"flex justify-between items-center text-sm",children:n.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:["Then $",m.new_price,"/",M]})})})]}):null})]}),n.jsxs("div",{className:"flex gap-3 mt-6",children:[n.jsx(Be,{onClick:t,disabled:c,className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 dark:bg-gray-600 dark:hover:bg-gray-700 dark:text-gray-200",children:"Cancel"}),n.jsxs(Be,{onClick:O,disabled:d||c||!!p,className:"flex-1 bg-orange-600 hover:bg-orange-700 text-white font-semibold",children:[c&&n.jsx(Rr,{className:"h-4 w-4 mr-2 animate-spin"}),_()]})]})]})})},Rm=({currentTier:r="free",onSubscriptionChange:t})=>{const[e,s]=U.useState(null),[i,a]=U.useState(null),[d,o]=U.useState(!1),[c,h]=U.useState({title:"",message:""}),[p,b]=U.useState(!1),[m,u]=U.useState("free"),[w,g]=U.useState(!1),[N,y]=U.useState(null),[S,L]=U.useState(()=>{const ae=sessionStorage.getItem("pricingTiersCollapsed");return ae?JSON.parse(ae):{free:!0,basic:!0,thegoods:!0,moregoods:!0,themost:!0,rollyourown:!0}}),E=ae=>{L(re=>{const se={...re,[ae]:!re[ae]};return sessionStorage.setItem("pricingTiersCollapsed",JSON.stringify(se)),se})};U.useEffect(()=>{(async()=>{try{const re=await fetch("/api/auth/status");if(re.ok){const se=await re.json();b(se.unplugged_mode||!1),u(se.actual_tier||"free")}}catch(re){console.error("Error fetching unplugged status:",re)}})()},[]);const I=[{id:"free",name:"Free",itemsLimit:15,routinesLimit:1,price:0,autocreate:!1,description:"Get started with basic features",byocNote:"BYOClaude (enter your own Anthropic API key) for autocreated chord charts"},{id:"basic",name:"Basic",itemsLimit:80,routinesLimit:5,price:3,autocreate:!1,description:"More items and routines",byocNote:"BYOClaude (enter your own Anthropic API key) for autocreated chord charts"},{id:"thegoods",name:"The Goods",itemsLimit:200,routinesLimit:10,price:6,autocreate:!0,description:"Includes Autocreate for chord charts"},{id:"moregoods",name:"More Goods",itemsLimit:600,routinesLimit:25,price:12,autocreate:!0,description:"Even more items and routines"},{id:"themost",name:"The Most",itemsLimit:1500,routinesLimit:50,price:20,autocreate:!0,description:"Goes to 11"}],K=ae=>{const{old_tier:re,new_tier:se,tier_changed:ie,proration_amount:je,autocreate_enabled:ne}=ae,H={free:"Free",basic:"Basic",thegoods:"The Goods",moregoods:"More Goods",themost:"The Most"}[se]||se,Z=["free","basic","thegoods","moregoods","themost"],X=Z.indexOf(re),pe=Z.indexOf(se);if(ie&&pe<X)return{title:"Plan Changed",message:`You've downgraded to ${H}. Your new limits will take effect immediately. Thanks for sticking with us! ðŸŽ¸`};if(ie&&pe>X){const ve=`Right on, you've upgraded to ${H}!`,ke=je>0?` Your card was charged a prorated amount of $${je.toFixed(2)} usd.`:"";return ne&&re==="basic"?{title:"ðŸŽ‰ Upgraded!",message:`${ve}${ke} You're ready to add more items, organize more routines, and have your chord charts autocreated! ðŸ¤˜Rock on!`}:{title:"ðŸŽ‰ Upgraded!",message:`${ve}${ke} You're ready to add more items and organize more routines! ðŸ¤˜Rock on!`}}return ie?{title:"Plan Updated",message:`You've switched to ${H}. Rock on! ðŸ¤˜`}:{title:"Subscription Updated",message:"Your subscription has been updated successfully. ðŸŽ¸"}},Y=async ae=>{if(ae==="free")return;const re=m!=="free"&&!p,se=["free","basic","thegoods","moregoods","themost"],ie=se.indexOf(m),ne=se.indexOf(ae)>ie;if(re&&ne){const A=I.find(H=>H.id===ae);y({tierId:ae,tierName:(A==null?void 0:A.name)||ae}),g(!0);return}if(re&&!ne){s(ae),a(null);try{const A=await fetch("/api/billing/update-subscription",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({tier:ae,billing_period:"monthly"})}),H=await A.json();if(!A.ok){a(H.error||"Failed to update subscription"),s(null);return}if(H.details){const Z=K(H.details);h(Z),o(!0)}s(null)}catch(A){h({title:"Error",message:`Error: ${A.message||"Error updating subscription"}`}),o(!0),s(null)}return}s(ae),a(null);try{const A=await fetch("/api/billing/create-checkout-session",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({tier:ae,billing_period:"monthly"})}),H=await A.json();if(!A.ok){if(H.use_update_endpoint){console.log("Backend redirecting to upgrade confirmation modal");const Z=I.find(X=>X.id===ae);y({tierId:ae,tierName:(Z==null?void 0:Z.name)||ae}),g(!0),s(null);return}a(H.error||"Failed to process request"),s(null);return}H.url?window.location.href=H.url:(a("Unexpected response from server"),s(null))}catch(A){h({title:"Error",message:`Error: ${A.message||"Error connecting to payment system"}`}),o(!0),s(null)}},V=ae=>{if(g(!1),y(null),ae.details){const re=K(ae.details);h(re),o(!0)}},O=()=>{g(!1),y(null)},Q=async()=>{o(!1),t&&await t();try{const ae=await fetch("/api/auth/status");if(ae.ok){const re=await ae.json();b(re.unplugged_mode||!1),u(re.actual_tier||"free")}}catch(ae){console.error("Error refreshing subscription status:",ae)}},F=async()=>{s("portal"),a(null);try{const ae=await fetch("/api/billing/create-portal-session",{method:"POST",headers:{"Content-Type":"application/json"}}),re=await ae.json();ae.ok&&re.url?window.location.href=re.url:(a(re.error||"Failed to open subscription portal"),s(null))}catch{a("Error connecting to subscription portal"),s(null)}},k=async()=>{s("unpause"),a(null);try{const ae=await fetch("/api/billing/unpause-subscription",{method:"POST",headers:{"Content-Type":"application/json"}}),re=await ae.json();ae.ok?(h({title:"âœ… Subscription Resumed",message:"Welcome back! Your subscription has been reactivated. You now have access to all your routines and features. ðŸŽ¸"}),o(!0)):(a(re.error||"Failed to unpause subscription"),s(null))}catch{a("Error unpausing subscription"),s(null)}},_=(ae=>I.findIndex(re=>re.id===ae))(r),te=ae=>ae===_?"Current Plan":ae<_?"Downgrade":"Upgrade";return n.jsxs("div",{className:"space-y-4",children:[p&&n.jsx(cn,{className:"bg-orange-900/20 border-orange-700",children:n.jsx(un,{className:"pt-6",children:n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-orange-300 mb-1",children:"Your subscription is paused"}),n.jsx("p",{className:"text-sm text-gray-300",children:`You're currently in free mode with access to your last active routine. Click "Unpause" to restore full access to all your routines and features.`})]}),n.jsx(Be,{onClick:k,disabled:e==="unpause",className:"bg-green-600 hover:bg-green-700",children:e==="unpause"?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}),"Unpausing..."]}):"Unpause Subscription"})]})})}),i&&n.jsx("div",{className:"bg-red-900/30 border border-red-700 rounded-md p-3 text-sm text-red-300",children:i}),n.jsxs("div",{className:"space-y-4",children:[I.map((ae,re)=>{const se=ae.id===r,ie=e===ae.id,je=S[ae.id];return n.jsxs(cn,{className:`relative bg-gray-800 border-gray-700 ${se?"border-orange-600 border-2":""}`,children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>E(ae.id),"data-ph-capture-attribute-toggle":`pricing-tier-${ae.id}`,children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsxs(dn,{className:"text-gray-100 text-lg flex items-center gap-2",children:[ae.name,se&&n.jsx("span",{className:"text-xs font-normal text-orange-400 bg-orange-400/10 px-2 py-0.5 rounded",children:"Your current plan"}),je&&ae.price>0&&n.jsxs("span",{className:"text-sm font-normal text-gray-400",children:["$",ae.price,"/mo"]}),je&&ae.price===0&&n.jsx("span",{className:"text-sm font-normal text-gray-400",children:"Free"})]}),n.jsx(Os,{className:"text-gray-400 text-xs",children:ae.description})]}),je?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!je&&n.jsxs(un,{className:"space-y-3",children:[n.jsx("div",{className:"text-center py-2",children:ae.price===0?n.jsx("div",{className:"text-3xl font-bold text-gray-100",children:"Free"}):n.jsxs("div",{className:"text-3xl font-bold text-gray-100",children:["$",ae.price,n.jsx("span",{className:"text-sm text-gray-400 font-normal",children:"usd/mo"})]})}),n.jsxs("ul",{className:"space-y-2 text-sm text-gray-300",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx(_n,{className:"w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"}),n.jsxs("span",{children:[ae.itemsLimit," items"]})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx(_n,{className:"w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"}),n.jsxs("span",{children:[ae.routinesLimit," ",ae.routinesLimit===1?"routine":"routines"]})]}),ae.autocreate&&n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx(_n,{className:"w-4 h-4 text-green-400 flex-shrink-0 mt-0.5"}),n.jsx("span",{className:"font-medium text-orange-400",children:"Includes Autocreate for chord charts"})]})]}),ae.byocNote&&n.jsx("div",{className:"text-xs text-gray-300",children:ae.byocNote}),ae.id!=="free"&&!se&&n.jsx(Be,{onClick:()=>Y(ae.id),disabled:ie,className:`w-full ${re>_?"bg-orange-600 hover:bg-orange-700":"bg-gray-700 hover:bg-gray-600 border border-gray-600"}`,"data-ph-capture-attribute-button":re>_?`upgrade-to-${ae.id}`:`downgrade-to-${ae.id}`,children:ie?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}),"Loading..."]}):te(re)})]})]},ae.id)}),n.jsxs(cn,{className:"relative bg-gray-800 border-gray-700",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>E("rollyourown"),"data-ph-capture-attribute-toggle":"pricing-tier-rollyourown",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(dn,{className:"text-gray-100 text-lg",children:"Roll your own"}),n.jsx(Os,{className:"text-gray-400 text-xs",children:"Local-only, on your laptop or desktop"})]}),S.rollyourown?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!S.rollyourown&&n.jsxs(un,{className:"space-y-3",children:[n.jsx("div",{className:"text-center py-2",children:n.jsx("div",{className:"text-2xl font-bold text-gray-100",children:"Time and effort"})}),n.jsx("div",{className:"text-xs font-semibold text-gray-400 mb-1",children:"Requirements:"}),n.jsxs("ul",{className:"space-y-2 text-sm text-gray-300",children:[n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-gray-500",children:"â€¢"}),n.jsx("span",{children:"Familiarity with Linux CLI"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-gray-500",children:"â€¢"}),n.jsx("span",{children:"Familiarity with GitHub"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-gray-500",children:"â€¢"}),n.jsx("span",{children:"Familiarity with using APIs"})]}),n.jsxs("li",{className:"flex items-start gap-2",children:[n.jsx("span",{className:"text-gray-500",children:"â€¢"}),n.jsx("span",{children:"Familiarity with being a nerd"})]})]}),n.jsx(Be,{onClick:()=>window.open("https://github.com/slshults/guitar-practice-routine-app_postgresql/blob/main/README.md","_blank"),className:"w-full bg-gray-700 hover:bg-gray-600 border border-gray-600","data-ph-capture-attribute-button":"github-roll-your-own",children:"Get it from GitHub"})]})]})]}),m!=="free"&&n.jsx(cn,{className:"bg-gray-800 border-gray-700 mt-6",children:n.jsx(un,{className:"pt-6",children:n.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-semibold text-gray-100 mb-1",children:"Manage your subscription"}),n.jsx("p",{className:"text-sm text-gray-400",children:p?"Reactivate your subscription or view billing details":"Log in to your Stripe account to update your payment method, view invoices, view payment history, etc."})]}),n.jsx(Be,{onClick:F,disabled:e==="portal",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"stripe-billing-portal",children:e==="portal"?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin","aria-hidden":"true"}),"Loading..."]}):n.jsxs(n.Fragment,{children:[n.jsx(wh,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Stripe billing portal"]})})]})})}),n.jsx(Fm,{isOpen:d,onClose:Q,title:c.title,message:c.message}),n.jsx(Om,{isOpen:w,onClose:O,onConfirm:V,targetTier:N==null?void 0:N.tierId,targetTierName:N==null?void 0:N.tierName,billingPeriod:"monthly"})]})},Dm=({userTier:r,unpluggedMode:t})=>{const[e,s]=U.useState("initial"),[i,a]=U.useState(!1),[d,o]=U.useState(null),[c,h]=U.useState(!1),[p,b]=U.useState(!1),[m,u]=U.useState(null),[w,g]=U.useState(""),[N,y]=U.useState(""),[S,L]=U.useState(""),[E,I]=U.useState(!1),[K,Y]=U.useState(t||!1),V=r==="free";U.useEffect(()=>{V||Q(),O()},[V]),U.useEffect(()=>{Y(t||!1)},[t]);const O=async()=>{try{const se=await fetch("/api/auth/status");if(se.ok){const ie=await se.json();I(!!ie.deletion_scheduled_for)}}catch(se){console.error("Error checking deletion status:",se)}},Q=async()=>{try{const se=await fetch("/api/user/calculate-deletion-refund");if(se.ok){const ie=await se.json();g(ie.renewal_date)}}catch(se){console.error("Error fetching refund calculation:",se)}},F=async()=>{a(!0),o(null);try{const se=await fetch("/api/user/delete-account-scheduled",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmation_phrase:N,email:S})}),ie=await se.json();se.ok?(o({type:"success",text:`Account deletion scheduled for ${ie.deletion_date}. You can cancel this anytime before then.`}),s("initial"),y(""),L(""),I(!0)):o({type:"error",text:ie.error||"Failed to schedule deletion"})}catch(se){console.error("Error scheduling deletion:",se),o({type:"error",text:"Error scheduling deletion"})}finally{a(!1)}},k=async()=>{a(!0),o(null);try{const ie=await fetch(V?"/api/user/delete-account-free":"/api/user/delete-account-immediate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({confirmation_phrase:N,email:S})}),je=await ie.json();ie.ok?(u(je.redirect_url||"/login"),h(!0),y(""),L("")):o({type:"error",text:je.error||"Failed to delete account"})}catch(se){console.error("Error deleting account:",se),o({type:"error",text:"Error deleting account"})}finally{a(!1)}},M=()=>{window.location.href=m||"/login"},_=async()=>{try{const se=await fetch("/api/user/export/all");if(!se.ok)throw new Error("Failed to download data");const ie=await se.blob(),je=window.URL.createObjectURL(ie),ne=document.createElement("a");ne.href=je;const A=new Date().toISOString().split("T")[0];ne.download=`gpra-export-${A}.zip`,document.body.appendChild(ne),ne.click(),window.URL.revokeObjectURL(je),document.body.removeChild(ne)}catch(se){console.error("Error downloading data:",se),o({type:"error",text:"Failed to download your data. Please try again."})}},te=async()=>{a(!0),o(null);try{const se=await fetch("/api/user/cancel-deletion",{method:"POST",headers:{"Content-Type":"application/json"}}),ie=await se.json();se.ok?(o({type:"success",text:"Deletion canceled successfully!"}),I(!1)):o({type:"error",text:ie.error||"Failed to cancel deletion"})}catch(se){console.error("Error canceling deletion:",se),o({type:"error",text:"Error canceling deletion"})}finally{a(!1)}},ae=async()=>{b(!1),a(!0),o(null);try{const ie=await fetch(K?"/api/billing/unpause-subscription":"/api/billing/set-unplugged",{method:"POST",headers:{"Content-Type":"application/json"}}),je=await ie.json();ie.ok?(o({type:"success",text:K?"Subscription resumed! You now have access to all routines.":"Subscription paused. You can now use your most recently active routine for free."}),Y(!K),setTimeout(()=>window.location.reload(),1500)):o({type:"error",text:je.error||`Failed to ${K?"unpause":"pause"} subscription`})}catch(se){console.error(`Error ${K?"unpausing":"pausing"} subscription:`,se),o({type:"error",text:`Error ${K?"unpausing":"pausing"} subscription`})}finally{a(!1)}};let re;if(e==="initial")re=n.jsxs(cn,{className:"bg-red-900/10 border-red-700",children:[n.jsxs(jn,{children:[n.jsxs(dn,{className:"text-gray-100 flex items-center gap-2",children:[n.jsx(Bn,{className:"w-5 h-5 text-red-400"}),"Danger zone"]}),n.jsx(Os,{className:"text-gray-400",children:"Permanently delete your account and all associated data"})]}),n.jsxs(un,{className:"space-y-6",children:[n.jsxs(ms,{className:"bg-orange-900/30 border-orange-700",children:[n.jsx(Bn,{className:"h-4 w-4 text-orange-400"}),n.jsxs(gs,{className:"text-gray-300",children:[n.jsx("strong",{children:"Warning:"})," Deleting your account will permanently remove:",n.jsxs("ul",{className:"list-disc pl-5 mt-2 space-y-1",children:[n.jsx("li",{children:"All practice items and routines"}),n.jsx("li",{children:"All chord charts"}),n.jsx("li",{children:"Practice history (last 90 days)"}),n.jsx("li",{children:"Account settings and preferences"})]}),n.jsx("p",{className:"mt-2",children:n.jsx("strong",{children:"This action cannot be undone."})})]})]}),n.jsxs("div",{className:"flex items-center justify-between bg-blue-900/20 border border-blue-700 rounded-md p-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:"Download your data first"}),n.jsx("p",{className:"text-xs text-gray-400",children:"Your items, routines, chord charts, and practice history"})]}),n.jsxs(Be,{onClick:_,variant:"outline",size:"sm",className:"border-blue-600 text-blue-400 hover:bg-blue-900/40",children:[n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"Download all your data"]})]}),n.jsxs("div",{className:"space-y-3",children:[E&&n.jsx(Be,{onClick:te,disabled:i,className:"w-full bg-green-600 hover:bg-green-700",children:i?"Canceling...":"Keep my account"}),!E&&!V&&n.jsx(Be,{onClick:()=>b(!0),disabled:i,variant:"outline",className:`w-full h-auto py-5 px-4 flex flex-col items-center gap-2 ${K?"border-green-600 text-green-400 hover:bg-green-900/40":"border-orange-600 text-orange-400 hover:bg-orange-900/40"}`,children:i?K?"Unpausing...":"Pausing...":K?n.jsx("span",{className:"font-semibold",children:"Unpause"}):n.jsxs(n.Fragment,{children:[n.jsx("span",{className:"font-semibold",children:"Pause subscription when it expires"}),n.jsxs("span",{className:"text-xs font-normal leading-normal text-center whitespace-normal max-w-full",children:["Keep using your most recently active routine for free when your paid subscription ends. ",n.jsx("br",{})," We'll save your other routines for 90 days in case you renew."]})]})}),!V&&n.jsxs(Be,{onClick:()=>s("scheduled"),variant:"outline",className:"w-full border-orange-600 text-orange-400 hover:bg-orange-900/40",children:["Delete account after current paid subscription ends on ",w]}),n.jsxs(Be,{onClick:()=>s("immediate"),variant:"destructive",className:"w-full bg-red-900 hover:bg-red-800",children:["Delete my account now! ",!V&&"(No refund)"]})]}),d&&n.jsx(ms,{className:d.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:n.jsx(gs,{className:"text-gray-300",children:d.text})})]})]});else if(e==="scheduled"){const se="If I delete it I cannot get it back",ie=N===se;re=n.jsxs(cn,{className:"bg-orange-900/10 border-orange-700",children:[n.jsxs(jn,{children:[n.jsx(dn,{className:"text-gray-100",children:"Schedule account deletion"}),n.jsx(Os,{className:"text-gray-400",children:"Delete your account on your next renewal date"})]}),n.jsxs(un,{className:"space-y-6",children:[n.jsx(ms,{className:"bg-blue-900/30 border-blue-700",children:n.jsxs(gs,{className:"text-gray-300",children:[n.jsx("p",{className:"font-semibold mb-2",children:"Here's what will happen:"}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[n.jsx("li",{children:"Your subscription will be canceled"}),n.jsxs("li",{children:["Your account will stay active until ",n.jsx("strong",{children:w})]}),n.jsxs("li",{children:["On ",w,", all your data will be permanently deleted"]}),n.jsxs("li",{children:["You can cancel this deletion anytime before ",w]})]}),n.jsxs("p",{className:"mt-2 text-sm font-semibold text-orange-300",children:["Note: You're paying to use the service until ",w,", so no refunds."]})]})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"confirm-scheduled",className:"text-gray-200",children:"Type the following phrase to confirm:"}),n.jsx("p",{className:"text-sm font-mono bg-gray-800 border border-gray-700 rounded p-2 text-gray-300",children:se}),n.jsx(Dr,{id:"confirm-scheduled",value:N,onChange:je=>y(je.target.value),placeholder:"Type the phrase exactly as shown",className:`bg-gray-900 border-gray-600 text-gray-100 ${N.length>0&&(ie?"border-green-500":"border-red-500")}`,disabled:i}),N.length>=se.length&&!ie&&n.jsx("p",{className:"text-xs text-red-400",children:"Phrase does not match (case-sensitive)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"email-scheduled",className:"text-gray-200",children:"Enter your email address to confirm:"}),n.jsx(Dr,{id:"email-scheduled",type:"email",value:S,onChange:je=>L(je.target.value),placeholder:"your-email@example.com",className:"bg-gray-900 border-gray-600 text-gray-100",disabled:i}),n.jsx("p",{className:"text-xs text-gray-500",children:"Must match your account email"})]}),d&&n.jsx(ms,{className:d.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:n.jsx(gs,{className:"text-gray-300",children:d.text})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(Be,{onClick:()=>{s("initial"),y(""),L(""),o(null)},className:"flex-1 bg-green-600 hover:bg-green-700",disabled:i,children:[n.jsx(Gr,{className:"w-4 h-4 mr-2"}),"Nevermind. I'll stay for now"]}),n.jsx(Be,{onClick:F,disabled:!ie||!S||i,className:"flex-1 bg-orange-600 hover:bg-orange-700",children:i?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}),"Scheduling..."]}):"Confirm scheduled deletion"})]})]})]})}else if(e==="immediate"){const se="If I delete now I cannot get my data or money back",ie=N===se;re=n.jsxs(cn,{className:"bg-red-900/10 border-red-700",children:[n.jsxs(jn,{children:[n.jsxs(dn,{className:"text-gray-100 flex items-center gap-2",children:[n.jsx(Bn,{className:"w-5 h-5 text-red-400"}),"Delete account immediately"]}),n.jsx(Os,{className:"text-gray-400",children:"This action is immediate and permanent"})]}),n.jsxs(un,{className:"space-y-6",children:[n.jsxs(ms,{className:"bg-red-900/40 border-red-700",children:[n.jsx(Bn,{className:"h-4 w-4 text-red-400"}),n.jsxs(gs,{className:"text-gray-300",children:[n.jsx("p",{className:"font-bold mb-2",children:"âš ï¸ FINAL WARNING âš ï¸"}),n.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[n.jsxs("li",{children:[n.jsx("strong",{children:"NO REFUND"})," - You will not receive any money back"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"IMMEDIATE"})," - Your account will be deleted right now"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"PERMANENT"})," - All data will be permanently erased"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"NO RECOVERY"})," - You cannot undo this action"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"CANNOT ACCESS GPRA AGAIN"})," - You'll need to create a new account"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"YOU WILL BE FORGOTTEN"})," - We won't keep your email address or IP address, or anything. Most of it will be deleted immediately, but some anonymous logs which can't be connected to you (without a warrant) will age out of the logs within 90 days"]})]}),n.jsx("p",{className:"mt-2 text-sm font-semibold text-orange-300",children:"In addition to no refunds, the remainder of your prepaid period will not be prorated back to you."})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"confirm-immediate",className:"text-gray-200",children:"Type the following phrase to confirm:"}),n.jsx("p",{className:"text-sm font-mono bg-gray-800 border border-gray-700 rounded p-2 text-gray-300",children:se}),n.jsx(Dr,{id:"confirm-immediate",value:N,onChange:je=>y(je.target.value),onPaste:je=>je.preventDefault(),autoComplete:"off",placeholder:"Type the phrase exactly as shown (paste disabled)",className:`bg-gray-900 border-gray-600 text-gray-100 ${N.length>0&&(ie?"border-green-500":"border-red-500")}`,disabled:i}),N.length>=se.length&&!ie&&n.jsx("p",{className:"text-xs text-red-400",children:"Phrase does not match (case-sensitive)"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"email-immediate",className:"text-gray-200",children:"Enter your email address to confirm:"}),n.jsx(Dr,{id:"email-immediate",type:"email",value:S,onChange:je=>L(je.target.value),placeholder:"your-email@example.com",className:"bg-gray-900 border-gray-600 text-gray-100",disabled:i}),n.jsx("p",{className:"text-xs text-gray-500",children:"Must match your account email. Will also be deleted when you click the red button."})]}),d&&n.jsx(ms,{className:d.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:n.jsx(gs,{className:"text-gray-300",children:d.text})}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(Be,{onClick:()=>{s("initial"),y(""),L(""),o(null)},className:"flex-1 bg-green-600 hover:bg-green-700",disabled:i,children:[n.jsx(Gr,{className:"w-4 h-4 mr-2"}),"Nevermind, I'll stay for now."]}),n.jsx(Be,{onClick:k,disabled:!ie||!S||i,variant:"destructive",className:"flex-1 bg-red-900 hover:bg-red-800",children:i?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}),"Deleting..."]}):"Delete immediately - No refund"})]})]})]})}return n.jsxs(n.Fragment,{children:[re,n.jsx(es,{open:p,onOpenChange:b,children:n.jsxs(Vn,{className:"bg-gray-900 border-gray-700 text-gray-100",children:[n.jsxs(Gn,{children:[n.jsx(Yn,{className:"text-xl text-gray-100",children:K?"Resume subscription?":"Pause subscription?"}),n.jsx(ts,{className:"text-gray-300 space-y-3 pt-4",children:K?n.jsx("p",{children:"Your subscription will resume and you'll be charged when your next billing period arrives. You'll regain access to all your routines."}):n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"When your paid period ends, you'll only have access to your most recently active routine."}),n.jsx("p",{children:"Your other routines will be saved for 90 days in case you decide to come back."})]})})]}),n.jsxs(xc,{className:"flex gap-3 sm:gap-3",children:[n.jsx(Be,{onClick:()=>b(!1),variant:"outline",className:"flex-1 border-gray-600 text-gray-300 hover:bg-gray-800",children:"Cancel"}),n.jsx(Be,{onClick:ae,className:`flex-1 ${K?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"}`,children:K?"Resume":"Pause"})]})]})}),n.jsx(es,{open:c,onOpenChange:h,children:n.jsxs(Vn,{className:"bg-gray-900 border-gray-700 text-gray-100",children:[n.jsxs(Gn,{children:[n.jsx(Yn,{className:"text-xl text-gray-100",children:"Account deleted"}),n.jsx(ts,{className:"text-gray-300 space-y-3 pt-4",children:V?n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"Ok, done. We've deleted all your stuff."}),n.jsx("p",{children:"Your account has been deleted. Click Ok to return to login."})]}):n.jsxs(n.Fragment,{children:[n.jsx("p",{children:"Ok, done. We've deleted all your stuff, and we've cancelled your subscription on Stripe so it won't charge your card again."}),n.jsx("p",{children:`When you click "Ok", we'll send you to your Stripe portal, which will show you any saved cards and your past invoices. (Sadly, it won't show you confirmation of the cancelled subscription, it will just show you the absence of any subscriptions. ðŸ¤· Please feel free to complain to Stripe about that. I have.)`})]})})]}),n.jsx(xc,{children:n.jsx(Be,{onClick:M,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Ok"})})]})})]})},Bm="modulepreload",Mm=function(r){return"/static/"+r},qd={},Wl=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){let d=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=d(e.map(h=>{if(h=Mm(h),h in qd)return;qd[h]=!0;const p=h.endsWith(".css"),b=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${b}`))return;const m=document.createElement("link");if(m.rel=p?"stylesheet":Bm,p||(m.as="script"),m.crossOrigin="",m.href=h,c&&m.setAttribute("nonce",c),document.head.appendChild(m),p)return new Promise((u,w)=>{m.addEventListener("load",u),m.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${h}`)))})}))}function a(d){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=d,window.dispatchEvent(o),!o.defaultPrevented)throw d}return i.then(d=>{for(const o of d||[])o.status==="rejected"&&a(o.reason);return t().catch(a)})};function Cr(r){"@babel/helpers - typeof";return Cr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cr(r)}var zs=Uint8Array,ys=Uint16Array,$c=Int32Array,Wc=new zs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Hc=new zs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$d=new zs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lf=function(r,t){for(var e=new ys(31),s=0;s<31;++s)e[s]=t+=1<<r[s-1];for(var i=new $c(e[30]),s=1;s<30;++s)for(var a=e[s];a<e[s+1];++a)i[a]=a-e[s]<<5|s;return{b:e,r:i}},cf=lf(Wc,2),Um=cf.b,bc=cf.r;Um[28]=258,bc[258]=28;var zm=lf(Hc,0),Wd=zm.r,wc=new ys(32768);for(var Ur=0;Ur<32768;++Ur){var Ma=(Ur&43690)>>1|(Ur&21845)<<1;Ma=(Ma&52428)>>2|(Ma&13107)<<2,Ma=(Ma&61680)>>4|(Ma&3855)<<4,wc[Ur]=((Ma&65280)>>8|(Ma&255)<<8)>>1}var oo=(function(r,t,e){for(var s=r.length,i=0,a=new ys(t);i<s;++i)r[i]&&++a[r[i]-1];var d=new ys(t);for(i=1;i<t;++i)d[i]=d[i-1]+a[i-1]<<1;var o;if(e){o=new ys(1<<t);var c=15-t;for(i=0;i<s;++i)if(r[i])for(var h=i<<4|r[i],p=t-r[i],b=d[r[i]-1]++<<p,m=b|(1<<p)-1;b<=m;++b)o[wc[b]>>c]=h}else for(o=new ys(s),i=0;i<s;++i)r[i]&&(o[i]=wc[d[r[i]-1]++]>>15-r[i]);return o}),ai=new zs(288);for(var Ur=0;Ur<144;++Ur)ai[Ur]=8;for(var Ur=144;Ur<256;++Ur)ai[Ur]=9;for(var Ur=256;Ur<280;++Ur)ai[Ur]=7;for(var Ur=280;Ur<288;++Ur)ai[Ur]=8;var hl=new zs(32);for(var Ur=0;Ur<32;++Ur)hl[Ur]=5;var qm=oo(ai,9,0),$m=oo(hl,5,0),df=function(r){return(r+7)/8|0},Wm=function(r,t,e){return(e==null||e>r.length)&&(e=r.length),new zs(r.subarray(t,e))},pa=function(r,t,e){e<<=t&7;var s=t/8|0;r[s]|=e,r[s+1]|=e>>8},ao=function(r,t,e){e<<=t&7;var s=t/8|0;r[s]|=e,r[s+1]|=e>>8,r[s+2]|=e>>16},Hl=function(r,t){for(var e=[],s=0;s<r.length;++s)r[s]&&e.push({s,f:r[s]});var i=e.length,a=e.slice();if(!i)return{t:hf,l:0};if(i==1){var d=new zs(e[0].s+1);return d[e[0].s]=1,{t:d,l:1}}e.sort(function(I,K){return I.f-K.f}),e.push({s:-1,f:25001});var o=e[0],c=e[1],h=0,p=1,b=2;for(e[0]={s:-1,f:o.f+c.f,l:o,r:c};p!=i-1;)o=e[e[h].f<e[b].f?h++:b++],c=e[h!=p&&e[h].f<e[b].f?h++:b++],e[p++]={s:-1,f:o.f+c.f,l:o,r:c};for(var m=a[0].s,s=1;s<i;++s)a[s].s>m&&(m=a[s].s);var u=new ys(m+1),w=vc(e[p-1],u,0);if(w>t){var s=0,g=0,N=w-t,y=1<<N;for(a.sort(function(K,Y){return u[Y.s]-u[K.s]||K.f-Y.f});s<i;++s){var S=a[s].s;if(u[S]>t)g+=y-(1<<w-u[S]),u[S]=t;else break}for(g>>=N;g>0;){var L=a[s].s;u[L]<t?g-=1<<t-u[L]++-1:++s}for(;s>=0&&g;--s){var E=a[s].s;u[E]==t&&(--u[E],++g)}w=t}return{t:new zs(u),l:w}},vc=function(r,t,e){return r.s==-1?Math.max(vc(r.l,t,e+1),vc(r.r,t,e+1)):t[r.s]=e},Hd=function(r){for(var t=r.length;t&&!r[--t];);for(var e=new ys(++t),s=0,i=r[0],a=1,d=function(c){e[s++]=c},o=1;o<=t;++o)if(r[o]==i&&o!=t)++a;else{if(!i&&a>2){for(;a>138;a-=138)d(32754);a>2&&(d(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(d(i),--a;a>6;a-=6)d(8304);a>2&&(d(a-3<<5|8208),a=0)}for(;a--;)d(i);a=1,i=r[o]}return{c:e.subarray(0,s),n:t}},io=function(r,t){for(var e=0,s=0;s<t.length;++s)e+=r[s]*t[s];return e},uf=function(r,t,e){var s=e.length,i=df(t+2);r[i]=s&255,r[i+1]=s>>8,r[i+2]=r[i]^255,r[i+3]=r[i+1]^255;for(var a=0;a<s;++a)r[i+a+4]=e[a];return(i+4+s)*8},Vd=function(r,t,e,s,i,a,d,o,c,h,p){pa(t,p++,e),++i[256];for(var b=Hl(i,15),m=b.t,u=b.l,w=Hl(a,15),g=w.t,N=w.l,y=Hd(m),S=y.c,L=y.n,E=Hd(g),I=E.c,K=E.n,Y=new ys(19),V=0;V<S.length;++V)++Y[S[V]&31];for(var V=0;V<I.length;++V)++Y[I[V]&31];for(var O=Hl(Y,7),Q=O.t,F=O.l,k=19;k>4&&!Q[$d[k-1]];--k);var M=h+5<<3,_=io(i,ai)+io(a,hl)+d,te=io(i,m)+io(a,g)+d+14+3*k+io(Y,Q)+2*Y[16]+3*Y[17]+7*Y[18];if(c>=0&&M<=_&&M<=te)return uf(t,p,r.subarray(c,c+h));var ae,re,se,ie;if(pa(t,p,1+(te<_)),p+=2,te<_){ae=oo(m,u,0),re=m,se=oo(g,N,0),ie=g;var je=oo(Q,F,0);pa(t,p,L-257),pa(t,p+5,K-1),pa(t,p+10,k-4),p+=14;for(var V=0;V<k;++V)pa(t,p+3*V,Q[$d[V]]);p+=3*k;for(var ne=[S,I],A=0;A<2;++A)for(var H=ne[A],V=0;V<H.length;++V){var Z=H[V]&31;pa(t,p,je[Z]),p+=Q[Z],Z>15&&(pa(t,p,H[V]>>5&127),p+=H[V]>>12)}}else ae=qm,re=ai,se=$m,ie=hl;for(var V=0;V<o;++V){var X=s[V];if(X>255){var Z=X>>18&31;ao(t,p,ae[Z+257]),p+=re[Z+257],Z>7&&(pa(t,p,X>>23&31),p+=Wc[Z]);var pe=X&31;ao(t,p,se[pe]),p+=ie[pe],pe>3&&(ao(t,p,X>>5&8191),p+=Hc[pe])}else ao(t,p,ae[X]),p+=re[X]}return ao(t,p,ae[256]),p+re[256]},Hm=new $c([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),hf=new zs(0),Vm=function(r,t,e,s,i,a){var d=a.z||r.length,o=new zs(s+d+5*(1+Math.ceil(d/7e3))+i),c=o.subarray(s,o.length-i),h=a.l,p=(a.r||0)&7;if(t){p&&(c[0]=a.r>>3);for(var b=Hm[t-1],m=b>>13,u=b&8191,w=(1<<e)-1,g=a.p||new ys(32768),N=a.h||new ys(w+1),y=Math.ceil(e/3),S=2*y,L=function(j){return(r[j]^r[j+1]<<y^r[j+2]<<S)&w},E=new $c(25e3),I=new ys(288),K=new ys(32),Y=0,V=0,O=a.i||0,Q=0,F=a.w||0,k=0;O+2<d;++O){var M=L(O),_=O&32767,te=N[M];if(g[_]=te,N[M]=_,F<=O){var ae=d-O;if((Y>7e3||Q>24576)&&(ae>423||!h)){p=Vd(r,c,0,E,I,K,V,Q,k,O-k,p),Q=Y=V=0,k=O;for(var re=0;re<286;++re)I[re]=0;for(var re=0;re<30;++re)K[re]=0}var se=2,ie=0,je=u,ne=_-te&32767;if(ae>2&&M==L(O-ne))for(var A=Math.min(m,ae)-1,H=Math.min(32767,O),Z=Math.min(258,ae);ne<=H&&--je&&_!=te;){if(r[O+se]==r[O+se-ne]){for(var X=0;X<Z&&r[O+X]==r[O+X-ne];++X);if(X>se){if(se=X,ie=ne,X>A)break;for(var pe=Math.min(ne,X-2),ve=0,re=0;re<pe;++re){var ke=O-ne+re&32767,Ae=g[ke],De=ke-Ae&32767;De>ve&&(ve=De,te=ke)}}}_=te,te=g[_],ne+=_-te&32767}if(ie){E[Q++]=268435456|bc[se]<<18|Wd[ie];var Me=bc[se]&31,Ke=Wd[ie]&31;V+=Wc[Me]+Hc[Ke],++I[257+Me],++K[Ke],F=O+se,++Y}else E[Q++]=r[O],++I[r[O]]}}for(O=Math.max(O,F);O<d;++O)E[Q++]=r[O],++I[r[O]];p=Vd(r,c,h,E,I,K,V,Q,k,O-k,p),h||(a.r=p&7|c[p/8|0]<<3,p-=7,a.h=N,a.p=g,a.i=O,a.w=F)}else{for(var O=a.w||0;O<d+h;O+=65535){var Se=O+65535;Se>=d&&(c[p/8|0]=h,Se=d),p=uf(c,p+1,r.subarray(O,Se))}a.i=d}return Wm(o,0,s+df(p)+i)},ff=function(){var r=1,t=0;return{p:function(e){for(var s=r,i=t,a=e.length|0,d=0;d!=a;){for(var o=Math.min(d+2655,a);d<o;++d)i+=s+=e[d];s=(s&65535)+15*(s>>16),i=(i&65535)+15*(i>>16)}r=s,t=i},d:function(){return r%=65521,t%=65521,(r&255)<<24|(r&65280)<<8|(t&255)<<8|t>>8}}},Gm=function(r,t,e,s,i){if(!i&&(i={l:1},t.dictionary)){var a=t.dictionary.subarray(-32768),d=new zs(a.length+r.length);d.set(a),d.set(r,a.length),r=d,i.w=a.length}return Vm(r,t.level==null?6:t.level,t.mem==null?i.l?Math.ceil(Math.max(8,Math.min(13,Math.log(r.length)))*1.5):20:12+t.mem,e,s,i)},pf=function(r,t,e){for(;e;++t)r[t]=e,e>>>=8},Ym=function(r,t){var e=t.level,s=e==0?0:e<6?1:e==9?3:2;if(r[0]=120,r[1]=s<<6|(t.dictionary&&32),r[1]|=31-(r[0]<<8|r[1])%31,t.dictionary){var i=ff();i.p(t.dictionary),pf(r,2,i.d())}};function Nc(r,t){t||(t={});var e=ff();e.p(r);var s=Gm(r,t,t.dictionary?6:2,4);return Ym(s,t),pf(s,s.length-4,e.d()),s}var Jm=typeof TextDecoder<"u"&&new TextDecoder,Zm=0;try{Jm.decode(hf,{stream:!0}),Zm=1}catch{}function Km(r){if(Array.isArray(r))return r}function Xm(r,t){var e=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(e!=null){var s,i,a,d,o=[],c=!0,h=!1;try{if(a=(e=e.call(r)).next,t!==0)for(;!(c=(s=a.call(e)).done)&&(o.push(s.value),o.length!==t);c=!0);}catch(p){h=!0,i=p}finally{try{if(!c&&e.return!=null&&(d=e.return(),Object(d)!==d))return}finally{if(h)throw i}}return o}}function Gd(r,t){(t==null||t>r.length)&&(t=r.length);for(var e=0,s=Array(t);e<t;e++)s[e]=r[e];return s}function Qm(r,t){if(r){if(typeof r=="string")return Gd(r,t);var e={}.toString.call(r).slice(8,-1);return e==="Object"&&r.constructor&&(e=r.constructor.name),e==="Map"||e==="Set"?Array.from(r):e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?Gd(r,t):void 0}}function eg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Yd(r,t){return Km(r)||Xm(r,t)||Qm(r,t)||eg()}function Jd(r,t="utf8"){return new TextDecoder(t).decode(r)}const tg=new TextEncoder;function rg(r){return tg.encode(r)}const ng=1024*8,sg=(()=>{const r=new Uint8Array(4),t=new Uint32Array(r.buffer);return!((t[0]=1)&r[0])})(),Vl={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class Vc{constructor(t=ng,e={}){kr(this,"buffer");kr(this,"byteLength");kr(this,"byteOffset");kr(this,"length");kr(this,"offset");kr(this,"lastWrittenByte");kr(this,"littleEndian");kr(this,"_data");kr(this,"_mark");kr(this,"_marks");let s=!1;typeof t=="number"?t=new ArrayBuffer(t):(s=!0,this.lastWrittenByte=t.byteLength);const i=e.offset?e.offset>>>0:0,a=t.byteLength-i;let d=i;(ArrayBuffer.isView(t)||t instanceof Vc)&&(t.byteLength!==t.buffer.byteLength&&(d=t.byteOffset+i),t=t.buffer),s?this.lastWrittenByte=a:this.lastWrittenByte=0,this.buffer=t,this.length=a,this.byteLength=a,this.byteOffset=d,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,d,a),this._mark=0,this._marks=[]}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t=1){return this.offset+=t,this}back(t=1){return this.offset-=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(t===void 0)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t=1){if(!this.available(t)){const s=(this.offset+t)*2,i=new Uint8Array(s);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=s,this.byteLength=s,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t=1){return this.readArray(t,"uint8")}readArray(t,e){const s=Vl[e].BYTES_PER_ELEMENT*t,i=this.byteOffset+this.offset,a=this.buffer.slice(i,i+s);if(this.littleEndian===sg&&e!=="uint8"&&e!=="int8"){const o=new Uint8Array(this.buffer.slice(i,i+s));o.reverse();const c=new Vl[e](o.buffer);return this.offset+=s,c.reverse(),c}const d=new Vl[e](a);return this.offset+=s,d}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readBigInt64(){const t=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,t}readBigUint64(){const t=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){let e="";for(let s=0;s<t;s++)e+=this.readChar();return e}readUtf8(t=1){return Jd(this.readBytes(t))}decodeText(t=1,e="utf8"){return Jd(this.readBytes(t),e)}writeBoolean(t){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let e=0;e<t.length;e++)this._data.setUint8(this.offset++,t[e]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(t){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(t){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let e=0;e<t.length;e++)this.writeUint8(t.charCodeAt(e));return this}writeUtf8(t){return this.writeBytes(rg(t))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}function Ui(r){let t=r.length;for(;--t>=0;)r[t]=0}const ag=3,ig=258,mf=29,og=256,lg=og+1+mf,gf=30,cg=512,dg=new Array((lg+2)*2);Ui(dg);const ug=new Array(gf*2);Ui(ug);const hg=new Array(cg);Ui(hg);const fg=new Array(ig-ag+1);Ui(fg);const pg=new Array(mf);Ui(pg);const mg=new Array(gf);Ui(mg);const gg=(r,t,e,s)=>{let i=r&65535|0,a=r>>>16&65535|0,d=0;for(;e!==0;){d=e>2e3?2e3:e,e-=d;do i=i+t[s++]|0,a=a+i|0;while(--d);i%=65521,a%=65521}return i|a<<16|0};var _c=gg;const xg=()=>{let r,t=[];for(var e=0;e<256;e++){r=e;for(var s=0;s<8;s++)r=r&1?3988292384^r>>>1:r>>>1;t[e]=r}return t},yg=new Uint32Array(xg()),bg=(r,t,e,s)=>{const i=yg,a=s+e;r^=-1;for(let d=s;d<a;d++)r=r>>>8^i[(r^t[d])&255];return r^-1};var Js=bg,jc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},xf={Z_NO_FLUSH:0,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFLATED:8};const wg=(r,t)=>Object.prototype.hasOwnProperty.call(r,t);var vg=function(r){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const e=t.shift();if(e){if(typeof e!="object")throw new TypeError(e+"must be non-object");for(const s in e)wg(e,s)&&(r[s]=e[s])}}return r},Ng=r=>{let t=0;for(let s=0,i=r.length;s<i;s++)t+=r[s].length;const e=new Uint8Array(t);for(let s=0,i=0,a=r.length;s<a;s++){let d=r[s];e.set(d,i),i+=d.length}return e},yf={assign:vg,flattenChunks:Ng};let bf=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{bf=!1}const ho=new Uint8Array(256);for(let r=0;r<256;r++)ho[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;ho[254]=ho[254]=1;var _g=r=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(r);let t,e,s,i,a,d=r.length,o=0;for(i=0;i<d;i++)e=r.charCodeAt(i),(e&64512)===55296&&i+1<d&&(s=r.charCodeAt(i+1),(s&64512)===56320&&(e=65536+(e-55296<<10)+(s-56320),i++)),o+=e<128?1:e<2048?2:e<65536?3:4;for(t=new Uint8Array(o),a=0,i=0;a<o;i++)e=r.charCodeAt(i),(e&64512)===55296&&i+1<d&&(s=r.charCodeAt(i+1),(s&64512)===56320&&(e=65536+(e-55296<<10)+(s-56320),i++)),e<128?t[a++]=e:e<2048?(t[a++]=192|e>>>6,t[a++]=128|e&63):e<65536?(t[a++]=224|e>>>12,t[a++]=128|e>>>6&63,t[a++]=128|e&63):(t[a++]=240|e>>>18,t[a++]=128|e>>>12&63,t[a++]=128|e>>>6&63,t[a++]=128|e&63);return t};const jg=(r,t)=>{if(t<65534&&r.subarray&&bf)return String.fromCharCode.apply(null,r.length===t?r:r.subarray(0,t));let e="";for(let s=0;s<t;s++)e+=String.fromCharCode(r[s]);return e};var Sg=(r,t)=>{const e=t||r.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(r.subarray(0,t));let s,i;const a=new Array(e*2);for(i=0,s=0;s<e;){let d=r[s++];if(d<128){a[i++]=d;continue}let o=ho[d];if(o>4){a[i++]=65533,s+=o-1;continue}for(d&=o===2?31:o===3?15:7;o>1&&s<e;)d=d<<6|r[s++]&63,o--;if(o>1){a[i++]=65533;continue}d<65536?a[i++]=d:(d-=65536,a[i++]=55296|d>>10&1023,a[i++]=56320|d&1023)}return jg(a,i)},kg=(r,t)=>{t=t||r.length,t>r.length&&(t=r.length);let e=t-1;for(;e>=0&&(r[e]&192)===128;)e--;return e<0||e===0?t:e+ho[r[e]]>t?e:t},Sc={string2buf:_g,buf2string:Sg,utf8border:kg};function Cg(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Ag=Cg;const zo=16209,Lg=16191;var Eg=function(t,e){let s,i,a,d,o,c,h,p,b,m,u,w,g,N,y,S,L,E,I,K,Y,V,O,Q;const F=t.state;s=t.next_in,O=t.input,i=s+(t.avail_in-5),a=t.next_out,Q=t.output,d=a-(e-t.avail_out),o=a+(t.avail_out-257),c=F.dmax,h=F.wsize,p=F.whave,b=F.wnext,m=F.window,u=F.hold,w=F.bits,g=F.lencode,N=F.distcode,y=(1<<F.lenbits)-1,S=(1<<F.distbits)-1;e:do{w<15&&(u+=O[s++]<<w,w+=8,u+=O[s++]<<w,w+=8),L=g[u&y];t:for(;;){if(E=L>>>24,u>>>=E,w-=E,E=L>>>16&255,E===0)Q[a++]=L&65535;else if(E&16){I=L&65535,E&=15,E&&(w<E&&(u+=O[s++]<<w,w+=8),I+=u&(1<<E)-1,u>>>=E,w-=E),w<15&&(u+=O[s++]<<w,w+=8,u+=O[s++]<<w,w+=8),L=N[u&S];r:for(;;){if(E=L>>>24,u>>>=E,w-=E,E=L>>>16&255,E&16){if(K=L&65535,E&=15,w<E&&(u+=O[s++]<<w,w+=8,w<E&&(u+=O[s++]<<w,w+=8)),K+=u&(1<<E)-1,K>c){t.msg="invalid distance too far back",F.mode=zo;break e}if(u>>>=E,w-=E,E=a-d,K>E){if(E=K-E,E>p&&F.sane){t.msg="invalid distance too far back",F.mode=zo;break e}if(Y=0,V=m,b===0){if(Y+=h-E,E<I){I-=E;do Q[a++]=m[Y++];while(--E);Y=a-K,V=Q}}else if(b<E){if(Y+=h+b-E,E-=b,E<I){I-=E;do Q[a++]=m[Y++];while(--E);if(Y=0,b<I){E=b,I-=E;do Q[a++]=m[Y++];while(--E);Y=a-K,V=Q}}}else if(Y+=b-E,E<I){I-=E;do Q[a++]=m[Y++];while(--E);Y=a-K,V=Q}for(;I>2;)Q[a++]=V[Y++],Q[a++]=V[Y++],Q[a++]=V[Y++],I-=3;I&&(Q[a++]=V[Y++],I>1&&(Q[a++]=V[Y++]))}else{Y=a-K;do Q[a++]=Q[Y++],Q[a++]=Q[Y++],Q[a++]=Q[Y++],I-=3;while(I>2);I&&(Q[a++]=Q[Y++],I>1&&(Q[a++]=Q[Y++]))}}else if((E&64)===0){L=N[(L&65535)+(u&(1<<E)-1)];continue r}else{t.msg="invalid distance code",F.mode=zo;break e}break}}else if((E&64)===0){L=g[(L&65535)+(u&(1<<E)-1)];continue t}else if(E&32){F.mode=Lg;break e}else{t.msg="invalid literal/length code",F.mode=zo;break e}break}}while(s<i&&a<o);I=w>>3,s-=I,w-=I<<3,u&=(1<<w)-1,t.next_in=s,t.next_out=a,t.avail_in=s<i?5+(i-s):5-(s-i),t.avail_out=a<o?257+(o-a):257-(a-o),F.hold=u,F.bits=w};const _i=15,Zd=852,Kd=592,Xd=0,Gl=1,Qd=2,Pg=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Tg=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ig=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Fg=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Og=(r,t,e,s,i,a,d,o)=>{const c=o.bits;let h=0,p=0,b=0,m=0,u=0,w=0,g=0,N=0,y=0,S=0,L,E,I,K,Y,V=null,O;const Q=new Uint16Array(_i+1),F=new Uint16Array(_i+1);let k=null,M,_,te;for(h=0;h<=_i;h++)Q[h]=0;for(p=0;p<s;p++)Q[t[e+p]]++;for(u=c,m=_i;m>=1&&Q[m]===0;m--);if(u>m&&(u=m),m===0)return i[a++]=1<<24|64<<16|0,i[a++]=1<<24|64<<16|0,o.bits=1,0;for(b=1;b<m&&Q[b]===0;b++);for(u<b&&(u=b),N=1,h=1;h<=_i;h++)if(N<<=1,N-=Q[h],N<0)return-1;if(N>0&&(r===Xd||m!==1))return-1;for(F[1]=0,h=1;h<_i;h++)F[h+1]=F[h]+Q[h];for(p=0;p<s;p++)t[e+p]!==0&&(d[F[t[e+p]]++]=p);if(r===Xd?(V=k=d,O=20):r===Gl?(V=Pg,k=Tg,O=257):(V=Ig,k=Fg,O=0),S=0,p=0,h=b,Y=a,w=u,g=0,I=-1,y=1<<u,K=y-1,r===Gl&&y>Zd||r===Qd&&y>Kd)return 1;for(;;){M=h-g,d[p]+1<O?(_=0,te=d[p]):d[p]>=O?(_=k[d[p]-O],te=V[d[p]-O]):(_=96,te=0),L=1<<h-g,E=1<<w,b=E;do E-=L,i[Y+(S>>g)+E]=M<<24|_<<16|te|0;while(E!==0);for(L=1<<h-1;S&L;)L>>=1;if(L!==0?(S&=L-1,S+=L):S=0,p++,--Q[h]===0){if(h===m)break;h=t[e+d[p]]}if(h>u&&(S&K)!==I){for(g===0&&(g=u),Y+=b,w=h-g,N=1<<w;w+g<m&&(N-=Q[w+g],!(N<=0));)w++,N<<=1;if(y+=1<<w,r===Gl&&y>Zd||r===Qd&&y>Kd)return 1;I=S&K,i[I]=u<<24|w<<16|Y-a|0}}return S!==0&&(i[Y+S]=h-g<<24|64<<16|0),o.bits=u,0};var lo=Og;const Rg=0,wf=1,vf=2,{Z_FINISH:eu,Z_BLOCK:Dg,Z_TREES:qo,Z_OK:ii,Z_STREAM_END:Bg,Z_NEED_DICT:Mg,Z_STREAM_ERROR:ks,Z_DATA_ERROR:Nf,Z_MEM_ERROR:_f,Z_BUF_ERROR:Ug,Z_DEFLATED:tu}=xf,vl=16180,ru=16181,nu=16182,su=16183,au=16184,iu=16185,ou=16186,lu=16187,cu=16188,du=16189,fl=16190,ma=16191,Yl=16192,uu=16193,Jl=16194,hu=16195,fu=16196,pu=16197,mu=16198,$o=16199,Wo=16200,gu=16201,xu=16202,yu=16203,bu=16204,wu=16205,Zl=16206,vu=16207,Nu=16208,qr=16209,jf=16210,Sf=16211,zg=852,qg=592,$g=15,Wg=$g,_u=r=>(r>>>24&255)+(r>>>8&65280)+((r&65280)<<8)+((r&255)<<24);function Hg(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const oi=r=>{if(!r)return 1;const t=r.state;return!t||t.strm!==r||t.mode<vl||t.mode>Sf?1:0},kf=r=>{if(oi(r))return ks;const t=r.state;return r.total_in=r.total_out=t.total=0,r.msg="",t.wrap&&(r.adler=t.wrap&1),t.mode=vl,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(zg),t.distcode=t.distdyn=new Int32Array(qg),t.sane=1,t.back=-1,ii},Cf=r=>{if(oi(r))return ks;const t=r.state;return t.wsize=0,t.whave=0,t.wnext=0,kf(r)},Af=(r,t)=>{let e;if(oi(r))return ks;const s=r.state;return t<0?(e=0,t=-t):(e=(t>>4)+5,t<48&&(t&=15)),t&&(t<8||t>15)?ks:(s.window!==null&&s.wbits!==t&&(s.window=null),s.wrap=e,s.wbits=t,Cf(r))},Lf=(r,t)=>{if(!r)return ks;const e=new Hg;r.state=e,e.strm=r,e.window=null,e.mode=vl;const s=Af(r,t);return s!==ii&&(r.state=null),s},Vg=r=>Lf(r,Wg);let ju=!0,Kl,Xl;const Gg=r=>{if(ju){Kl=new Int32Array(512),Xl=new Int32Array(32);let t=0;for(;t<144;)r.lens[t++]=8;for(;t<256;)r.lens[t++]=9;for(;t<280;)r.lens[t++]=7;for(;t<288;)r.lens[t++]=8;for(lo(wf,r.lens,0,288,Kl,0,r.work,{bits:9}),t=0;t<32;)r.lens[t++]=5;lo(vf,r.lens,0,32,Xl,0,r.work,{bits:5}),ju=!1}r.lencode=Kl,r.lenbits=9,r.distcode=Xl,r.distbits=5},Ef=(r,t,e,s)=>{let i;const a=r.state;return a.window===null&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),s>=a.wsize?(a.window.set(t.subarray(e-a.wsize,e),0),a.wnext=0,a.whave=a.wsize):(i=a.wsize-a.wnext,i>s&&(i=s),a.window.set(t.subarray(e-s,e-s+i),a.wnext),s-=i,s?(a.window.set(t.subarray(e-s,e),0),a.wnext=s,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0},Yg=(r,t)=>{let e,s,i,a,d,o,c,h,p,b,m,u,w,g,N=0,y,S,L,E,I,K,Y,V;const O=new Uint8Array(4);let Q,F;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(oi(r)||!r.output||!r.input&&r.avail_in!==0)return ks;e=r.state,e.mode===ma&&(e.mode=Yl),d=r.next_out,i=r.output,c=r.avail_out,a=r.next_in,s=r.input,o=r.avail_in,h=e.hold,p=e.bits,b=o,m=c,V=ii;e:for(;;)switch(e.mode){case vl:if(e.wrap===0){e.mode=Yl;break}for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.wrap&2&&h===35615){e.wbits===0&&(e.wbits=15),e.check=0,O[0]=h&255,O[1]=h>>>8&255,e.check=Js(e.check,O,2,0),h=0,p=0,e.mode=ru;break}if(e.head&&(e.head.done=!1),!(e.wrap&1)||(((h&255)<<8)+(h>>8))%31){r.msg="incorrect header check",e.mode=qr;break}if((h&15)!==tu){r.msg="unknown compression method",e.mode=qr;break}if(h>>>=4,p-=4,Y=(h&15)+8,e.wbits===0&&(e.wbits=Y),Y>15||Y>e.wbits){r.msg="invalid window size",e.mode=qr;break}e.dmax=1<<e.wbits,e.flags=0,r.adler=e.check=1,e.mode=h&512?du:ma,h=0,p=0;break;case ru:for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.flags=h,(e.flags&255)!==tu){r.msg="unknown compression method",e.mode=qr;break}if(e.flags&57344){r.msg="unknown header flags set",e.mode=qr;break}e.head&&(e.head.text=h>>8&1),e.flags&512&&e.wrap&4&&(O[0]=h&255,O[1]=h>>>8&255,e.check=Js(e.check,O,2,0)),h=0,p=0,e.mode=nu;case nu:for(;p<32;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.head&&(e.head.time=h),e.flags&512&&e.wrap&4&&(O[0]=h&255,O[1]=h>>>8&255,O[2]=h>>>16&255,O[3]=h>>>24&255,e.check=Js(e.check,O,4,0)),h=0,p=0,e.mode=su;case su:for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.head&&(e.head.xflags=h&255,e.head.os=h>>8),e.flags&512&&e.wrap&4&&(O[0]=h&255,O[1]=h>>>8&255,e.check=Js(e.check,O,2,0)),h=0,p=0,e.mode=au;case au:if(e.flags&1024){for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.length=h,e.head&&(e.head.extra_len=h),e.flags&512&&e.wrap&4&&(O[0]=h&255,O[1]=h>>>8&255,e.check=Js(e.check,O,2,0)),h=0,p=0}else e.head&&(e.head.extra=null);e.mode=iu;case iu:if(e.flags&1024&&(u=e.length,u>o&&(u=o),u&&(e.head&&(Y=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(s.subarray(a,a+u),Y)),e.flags&512&&e.wrap&4&&(e.check=Js(e.check,s,u,a)),o-=u,a+=u,e.length-=u),e.length))break e;e.length=0,e.mode=ou;case ou:if(e.flags&2048){if(o===0)break e;u=0;do Y=s[a+u++],e.head&&Y&&e.length<65536&&(e.head.name+=String.fromCharCode(Y));while(Y&&u<o);if(e.flags&512&&e.wrap&4&&(e.check=Js(e.check,s,u,a)),o-=u,a+=u,Y)break e}else e.head&&(e.head.name=null);e.length=0,e.mode=lu;case lu:if(e.flags&4096){if(o===0)break e;u=0;do Y=s[a+u++],e.head&&Y&&e.length<65536&&(e.head.comment+=String.fromCharCode(Y));while(Y&&u<o);if(e.flags&512&&e.wrap&4&&(e.check=Js(e.check,s,u,a)),o-=u,a+=u,Y)break e}else e.head&&(e.head.comment=null);e.mode=cu;case cu:if(e.flags&512){for(;p<16;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.wrap&4&&h!==(e.check&65535)){r.msg="header crc mismatch",e.mode=qr;break}h=0,p=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),r.adler=e.check=0,e.mode=ma;break;case du:for(;p<32;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}r.adler=e.check=_u(h),h=0,p=0,e.mode=fl;case fl:if(e.havedict===0)return r.next_out=d,r.avail_out=c,r.next_in=a,r.avail_in=o,e.hold=h,e.bits=p,Mg;r.adler=e.check=1,e.mode=ma;case ma:if(t===Dg||t===qo)break e;case Yl:if(e.last){h>>>=p&7,p-=p&7,e.mode=Zl;break}for(;p<3;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}switch(e.last=h&1,h>>>=1,p-=1,h&3){case 0:e.mode=uu;break;case 1:if(Gg(e),e.mode=$o,t===qo){h>>>=2,p-=2;break e}break;case 2:e.mode=fu;break;case 3:r.msg="invalid block type",e.mode=qr}h>>>=2,p-=2;break;case uu:for(h>>>=p&7,p-=p&7;p<32;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if((h&65535)!==(h>>>16^65535)){r.msg="invalid stored block lengths",e.mode=qr;break}if(e.length=h&65535,h=0,p=0,e.mode=Jl,t===qo)break e;case Jl:e.mode=hu;case hu:if(u=e.length,u){if(u>o&&(u=o),u>c&&(u=c),u===0)break e;i.set(s.subarray(a,a+u),d),o-=u,a+=u,c-=u,d+=u,e.length-=u;break}e.mode=ma;break;case fu:for(;p<14;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.nlen=(h&31)+257,h>>>=5,p-=5,e.ndist=(h&31)+1,h>>>=5,p-=5,e.ncode=(h&15)+4,h>>>=4,p-=4,e.nlen>286||e.ndist>30){r.msg="too many length or distance symbols",e.mode=qr;break}e.have=0,e.mode=pu;case pu:for(;e.have<e.ncode;){for(;p<3;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.lens[k[e.have++]]=h&7,h>>>=3,p-=3}for(;e.have<19;)e.lens[k[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,Q={bits:e.lenbits},V=lo(Rg,e.lens,0,19,e.lencode,0,e.work,Q),e.lenbits=Q.bits,V){r.msg="invalid code lengths set",e.mode=qr;break}e.have=0,e.mode=mu;case mu:for(;e.have<e.nlen+e.ndist;){for(;N=e.lencode[h&(1<<e.lenbits)-1],y=N>>>24,S=N>>>16&255,L=N&65535,!(y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(L<16)h>>>=y,p-=y,e.lens[e.have++]=L;else{if(L===16){for(F=y+2;p<F;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(h>>>=y,p-=y,e.have===0){r.msg="invalid bit length repeat",e.mode=qr;break}Y=e.lens[e.have-1],u=3+(h&3),h>>>=2,p-=2}else if(L===17){for(F=y+3;p<F;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}h>>>=y,p-=y,Y=0,u=3+(h&7),h>>>=3,p-=3}else{for(F=y+7;p<F;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}h>>>=y,p-=y,Y=0,u=11+(h&127),h>>>=7,p-=7}if(e.have+u>e.nlen+e.ndist){r.msg="invalid bit length repeat",e.mode=qr;break}for(;u--;)e.lens[e.have++]=Y}}if(e.mode===qr)break;if(e.lens[256]===0){r.msg="invalid code -- missing end-of-block",e.mode=qr;break}if(e.lenbits=9,Q={bits:e.lenbits},V=lo(wf,e.lens,0,e.nlen,e.lencode,0,e.work,Q),e.lenbits=Q.bits,V){r.msg="invalid literal/lengths set",e.mode=qr;break}if(e.distbits=6,e.distcode=e.distdyn,Q={bits:e.distbits},V=lo(vf,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,Q),e.distbits=Q.bits,V){r.msg="invalid distances set",e.mode=qr;break}if(e.mode=$o,t===qo)break e;case $o:e.mode=Wo;case Wo:if(o>=6&&c>=258){r.next_out=d,r.avail_out=c,r.next_in=a,r.avail_in=o,e.hold=h,e.bits=p,Eg(r,m),d=r.next_out,i=r.output,c=r.avail_out,a=r.next_in,s=r.input,o=r.avail_in,h=e.hold,p=e.bits,e.mode===ma&&(e.back=-1);break}for(e.back=0;N=e.lencode[h&(1<<e.lenbits)-1],y=N>>>24,S=N>>>16&255,L=N&65535,!(y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(S&&(S&240)===0){for(E=y,I=S,K=L;N=e.lencode[K+((h&(1<<E+I)-1)>>E)],y=N>>>24,S=N>>>16&255,L=N&65535,!(E+y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}h>>>=E,p-=E,e.back+=E}if(h>>>=y,p-=y,e.back+=y,e.length=L,S===0){e.mode=wu;break}if(S&32){e.back=-1,e.mode=ma;break}if(S&64){r.msg="invalid literal/length code",e.mode=qr;break}e.extra=S&15,e.mode=gu;case gu:if(e.extra){for(F=e.extra;p<F;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.length+=h&(1<<e.extra)-1,h>>>=e.extra,p-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=xu;case xu:for(;N=e.distcode[h&(1<<e.distbits)-1],y=N>>>24,S=N>>>16&255,L=N&65535,!(y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if((S&240)===0){for(E=y,I=S,K=L;N=e.distcode[K+((h&(1<<E+I)-1)>>E)],y=N>>>24,S=N>>>16&255,L=N&65535,!(E+y<=p);){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}h>>>=E,p-=E,e.back+=E}if(h>>>=y,p-=y,e.back+=y,S&64){r.msg="invalid distance code",e.mode=qr;break}e.offset=L,e.extra=S&15,e.mode=yu;case yu:if(e.extra){for(F=e.extra;p<F;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}e.offset+=h&(1<<e.extra)-1,h>>>=e.extra,p-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){r.msg="invalid distance too far back",e.mode=qr;break}e.mode=bu;case bu:if(c===0)break e;if(u=m-c,e.offset>u){if(u=e.offset-u,u>e.whave&&e.sane){r.msg="invalid distance too far back",e.mode=qr;break}u>e.wnext?(u-=e.wnext,w=e.wsize-u):w=e.wnext-u,u>e.length&&(u=e.length),g=e.window}else g=i,w=d-e.offset,u=e.length;u>c&&(u=c),c-=u,e.length-=u;do i[d++]=g[w++];while(--u);e.length===0&&(e.mode=Wo);break;case wu:if(c===0)break e;i[d++]=e.length,c--,e.mode=Wo;break;case Zl:if(e.wrap){for(;p<32;){if(o===0)break e;o--,h|=s[a++]<<p,p+=8}if(m-=c,r.total_out+=m,e.total+=m,e.wrap&4&&m&&(r.adler=e.check=e.flags?Js(e.check,i,m,d-m):_c(e.check,i,m,d-m)),m=c,e.wrap&4&&(e.flags?h:_u(h))!==e.check){r.msg="incorrect data check",e.mode=qr;break}h=0,p=0}e.mode=vu;case vu:if(e.wrap&&e.flags){for(;p<32;){if(o===0)break e;o--,h+=s[a++]<<p,p+=8}if(e.wrap&4&&h!==(e.total&4294967295)){r.msg="incorrect length check",e.mode=qr;break}h=0,p=0}e.mode=Nu;case Nu:V=Bg;break e;case qr:V=Nf;break e;case jf:return _f;case Sf:default:return ks}return r.next_out=d,r.avail_out=c,r.next_in=a,r.avail_in=o,e.hold=h,e.bits=p,(e.wsize||m!==r.avail_out&&e.mode<qr&&(e.mode<Zl||t!==eu))&&Ef(r,r.output,r.next_out,m-r.avail_out),b-=r.avail_in,m-=r.avail_out,r.total_in+=b,r.total_out+=m,e.total+=m,e.wrap&4&&m&&(r.adler=e.check=e.flags?Js(e.check,i,m,r.next_out-m):_c(e.check,i,m,r.next_out-m)),r.data_type=e.bits+(e.last?64:0)+(e.mode===ma?128:0)+(e.mode===$o||e.mode===Jl?256:0),(b===0&&m===0||t===eu)&&V===ii&&(V=Ug),V},Jg=r=>{if(oi(r))return ks;let t=r.state;return t.window&&(t.window=null),r.state=null,ii},Zg=(r,t)=>{if(oi(r))return ks;const e=r.state;return(e.wrap&2)===0?ks:(e.head=t,t.done=!1,ii)},Kg=(r,t)=>{const e=t.length;let s,i,a;return oi(r)||(s=r.state,s.wrap!==0&&s.mode!==fl)?ks:s.mode===fl&&(i=1,i=_c(i,t,e,0),i!==s.check)?Nf:(a=Ef(r,t,e,e),a?(s.mode=jf,_f):(s.havedict=1,ii))};var Xg=Cf,Qg=Af,e1=kf,t1=Vg,r1=Lf,n1=Yg,s1=Jg,a1=Zg,i1=Kg,o1="pako inflate (from Nodeca project)",ga={inflateReset:Xg,inflateReset2:Qg,inflateResetKeep:e1,inflateInit:t1,inflateInit2:r1,inflate:n1,inflateEnd:s1,inflateGetHeader:a1,inflateSetDictionary:i1,inflateInfo:o1};function l1(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var c1=l1;const Pf=Object.prototype.toString,{Z_NO_FLUSH:d1,Z_FINISH:u1,Z_OK:fo,Z_STREAM_END:Ql,Z_NEED_DICT:ec,Z_STREAM_ERROR:h1,Z_DATA_ERROR:Su,Z_MEM_ERROR:f1}=xf;function go(r){this.options=yf.assign({chunkSize:1024*64,windowBits:15,to:""},r||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),t.windowBits>=0&&t.windowBits<16&&!(r&&r.windowBits)&&(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(t.windowBits&15)===0&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ag,this.strm.avail_out=0;let e=ga.inflateInit2(this.strm,t.windowBits);if(e!==fo)throw new Error(jc[e]);if(this.header=new c1,ga.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Sc.string2buf(t.dictionary):Pf.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=ga.inflateSetDictionary(this.strm,t.dictionary),e!==fo)))throw new Error(jc[e])}go.prototype.push=function(r,t){const e=this.strm,s=this.options.chunkSize,i=this.options.dictionary;let a,d,o;if(this.ended)return!1;for(t===~~t?d=t:d=t===!0?u1:d1,Pf.call(r)==="[object ArrayBuffer]"?e.input=new Uint8Array(r):e.input=r,e.next_in=0,e.avail_in=e.input.length;;){for(e.avail_out===0&&(e.output=new Uint8Array(s),e.next_out=0,e.avail_out=s),a=ga.inflate(e,d),a===ec&&i&&(a=ga.inflateSetDictionary(e,i),a===fo?a=ga.inflate(e,d):a===Su&&(a=ec));e.avail_in>0&&a===Ql&&e.state.wrap>0&&r[e.next_in]!==0;)ga.inflateReset(e),a=ga.inflate(e,d);switch(a){case h1:case Su:case ec:case f1:return this.onEnd(a),this.ended=!0,!1}if(o=e.avail_out,e.next_out&&(e.avail_out===0||a===Ql))if(this.options.to==="string"){let c=Sc.utf8border(e.output,e.next_out),h=e.next_out-c,p=Sc.buf2string(e.output,c);e.next_out=h,e.avail_out=s-h,h&&e.output.set(e.output.subarray(c,c+h),0),this.onData(p)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(!(a===fo&&o===0)){if(a===Ql)return a=ga.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(e.avail_in===0)break}}return!0};go.prototype.onData=function(r){this.chunks.push(r)};go.prototype.onEnd=function(r){r===fo&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=yf.flattenChunks(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg};function p1(r,t){const e=new go(t);if(e.push(r),e.err)throw e.msg||jc[e.err];return e.result}var m1=go,g1=p1,x1={Inflate:m1,inflate:g1};const{Inflate:y1,inflate:b1}=x1;var ku=y1,w1=b1;const Tf=[];for(let r=0;r<256;r++){let t=r;for(let e=0;e<8;e++)t&1?t=3988292384^t>>>1:t=t>>>1;Tf[r]=t}const Cu=4294967295;function v1(r,t,e){let s=r;for(let i=0;i<e;i++)s=Tf[(s^t[i])&255]^s>>>8;return s}function N1(r,t){return(v1(Cu,r,t)^Cu)>>>0}function Au(r,t,e){const s=r.readUint32(),i=N1(new Uint8Array(r.buffer,r.byteOffset+r.offset-t-4,t),t);if(i!==s)throw new Error(`CRC mismatch for chunk ${e}. Expected ${s}, found ${i}`)}function If(r,t,e){for(let s=0;s<e;s++)t[s]=r[s]}function Ff(r,t,e,s){let i=0;for(;i<s;i++)t[i]=r[i];for(;i<e;i++)t[i]=r[i]+t[i-s]&255}function Of(r,t,e,s){let i=0;if(e.length===0)for(;i<s;i++)t[i]=r[i];else for(;i<s;i++)t[i]=r[i]+e[i]&255}function Rf(r,t,e,s,i){let a=0;if(e.length===0){for(;a<i;a++)t[a]=r[a];for(;a<s;a++)t[a]=r[a]+(t[a-i]>>1)&255}else{for(;a<i;a++)t[a]=r[a]+(e[a]>>1)&255;for(;a<s;a++)t[a]=r[a]+(t[a-i]+e[a]>>1)&255}}function Df(r,t,e,s,i){let a=0;if(e.length===0){for(;a<i;a++)t[a]=r[a];for(;a<s;a++)t[a]=r[a]+t[a-i]&255}else{for(;a<i;a++)t[a]=r[a]+e[a]&255;for(;a<s;a++)t[a]=r[a]+_1(t[a-i],e[a],e[a-i])&255}}function _1(r,t,e){const s=r+t-e,i=Math.abs(s-r),a=Math.abs(s-t),d=Math.abs(s-e);return i<=a&&i<=d?r:a<=d?t:e}function j1(r,t,e,s,i,a){switch(r){case 0:If(t,e,i);break;case 1:Ff(t,e,i,a);break;case 2:Of(t,e,s,i);break;case 3:Rf(t,e,s,i,a);break;case 4:Df(t,e,s,i,a);break;default:throw new Error(`Unsupported filter: ${r}`)}}const S1=new Uint16Array([255]),k1=new Uint8Array(S1.buffer),C1=k1[0]===255;function A1(r){const{data:t,width:e,height:s,channels:i,depth:a}=r,d=[{x:0,y:0,xStep:8,yStep:8},{x:4,y:0,xStep:8,yStep:8},{x:0,y:4,xStep:4,yStep:8},{x:2,y:0,xStep:4,yStep:4},{x:0,y:2,xStep:2,yStep:4},{x:1,y:0,xStep:2,yStep:2},{x:0,y:1,xStep:1,yStep:2}],o=Math.ceil(a/8)*i,c=new Uint8Array(s*e*o);let h=0;for(let p=0;p<7;p++){const b=d[p],m=Math.ceil((e-b.x)/b.xStep),u=Math.ceil((s-b.y)/b.yStep);if(m<=0||u<=0)continue;const w=m*o,g=new Uint8Array(w);for(let N=0;N<u;N++){const y=t[h++],S=t.subarray(h,h+w);h+=w;const L=new Uint8Array(w);j1(y,S,L,g,w,o),g.set(L);for(let E=0;E<m;E++){const I=b.x+E*b.xStep,K=b.y+N*b.yStep;if(!(I>=e||K>=s))for(let Y=0;Y<o;Y++)c[(K*e+I)*o+Y]=L[E*o+Y]}}}if(a===16){const p=new Uint16Array(c.buffer);if(C1)for(let b=0;b<p.length;b++)p[b]=L1(p[b]);return p}else return c}function L1(r){return(r&255)<<8|r>>8&255}const E1=new Uint16Array([255]),P1=new Uint8Array(E1.buffer),T1=P1[0]===255,I1=new Uint8Array(0);function Lu(r){const{data:t,width:e,height:s,channels:i,depth:a}=r,d=Math.ceil(a/8)*i,o=Math.ceil(a/8*i*e),c=new Uint8Array(s*o);let h=I1,p=0,b,m;for(let u=0;u<s;u++){switch(b=t.subarray(p+1,p+1+o),m=c.subarray(u*o,(u+1)*o),t[p]){case 0:If(b,m,o);break;case 1:Ff(b,m,o,d);break;case 2:Of(b,m,h,o);break;case 3:Rf(b,m,h,o,d);break;case 4:Df(b,m,h,o,d);break;default:throw new Error(`Unsupported filter: ${t[p]}`)}h=m,p+=o+1}if(a===16){const u=new Uint16Array(c.buffer);if(T1)for(let w=0;w<u.length;w++)u[w]=F1(u[w]);return u}else return c}function F1(r){return(r&255)<<8|r>>8&255}const Qo=Uint8Array.of(137,80,78,71,13,10,26,10);function Eu(r){if(!O1(r.readBytes(Qo.length)))throw new Error("wrong PNG signature")}function O1(r){if(r.length<Qo.length)return!1;for(let t=0;t<Qo.length;t++)if(r[t]!==Qo[t])return!1;return!0}const R1="tEXt",D1=0,Bf=new TextDecoder("latin1");function B1(r){if(U1(r),r.length===0||r.length>79)throw new Error("keyword length must be between 1 and 79")}const M1=/^[\u0000-\u00FF]*$/;function U1(r){if(!M1.test(r))throw new Error("invalid latin1 text")}function z1(r,t,e){const s=Mf(t);r[s]=q1(t,e-s.length-1)}function Mf(r){for(r.mark();r.readByte()!==D1;);const t=r.offset;r.reset();const e=Bf.decode(r.readBytes(t-r.offset-1));return r.skip(1),B1(e),e}function q1(r,t){return Bf.decode(r.readBytes(t))}const fs={UNKNOWN:-1,GREYSCALE:0,TRUECOLOUR:2,INDEXED_COLOUR:3,GREYSCALE_ALPHA:4,TRUECOLOUR_ALPHA:6},tc={UNKNOWN:-1,DEFLATE:0},Pu={UNKNOWN:-1,ADAPTIVE:0},rc={UNKNOWN:-1,NO_INTERLACE:0,ADAM7:1},Ho={NONE:0,BACKGROUND:1,PREVIOUS:2},nc={SOURCE:0,OVER:1};class $1 extends Vc{constructor(e,s={}){super(e);kr(this,"_checkCrc");kr(this,"_inflator");kr(this,"_png");kr(this,"_apng");kr(this,"_end");kr(this,"_hasPalette");kr(this,"_palette");kr(this,"_hasTransparency");kr(this,"_transparency");kr(this,"_compressionMethod");kr(this,"_filterMethod");kr(this,"_interlaceMethod");kr(this,"_colorType");kr(this,"_isAnimated");kr(this,"_numberOfFrames");kr(this,"_numberOfPlays");kr(this,"_frames");kr(this,"_writingDataChunks");const{checkCrc:i=!1}=s;this._checkCrc=i,this._inflator=new ku,this._png={width:-1,height:-1,channels:-1,data:new Uint8Array(0),depth:1,text:{}},this._apng={width:-1,height:-1,channels:-1,depth:1,numberOfFrames:1,numberOfPlays:0,text:{},frames:[]},this._end=!1,this._hasPalette=!1,this._palette=[],this._hasTransparency=!1,this._transparency=new Uint16Array(0),this._compressionMethod=tc.UNKNOWN,this._filterMethod=Pu.UNKNOWN,this._interlaceMethod=rc.UNKNOWN,this._colorType=fs.UNKNOWN,this._isAnimated=!1,this._numberOfFrames=1,this._numberOfPlays=0,this._frames=[],this._writingDataChunks=!1,this.setBigEndian()}decode(){for(Eu(this);!this._end;){const e=this.readUint32(),s=this.readChars(4);this.decodeChunk(e,s)}return this.decodeImage(),this._png}decodeApng(){for(Eu(this);!this._end;){const e=this.readUint32(),s=this.readChars(4);this.decodeApngChunk(e,s)}return this.decodeApngImage(),this._apng}decodeChunk(e,s){const i=this.offset;switch(s){case"IHDR":this.decodeIHDR();break;case"PLTE":this.decodePLTE(e);break;case"IDAT":this.decodeIDAT(e);break;case"IEND":this._end=!0;break;case"tRNS":this.decodetRNS(e);break;case"iCCP":this.decodeiCCP(e);break;case R1:z1(this._png.text,this,e);break;case"pHYs":this.decodepHYs();break;default:this.skip(e);break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${s}`);this._checkCrc?Au(this,e+4,s):this.skip(4)}decodeApngChunk(e,s){const i=this.offset;switch(s!=="fdAT"&&s!=="IDAT"&&this._writingDataChunks&&this.pushDataToFrame(),s){case"acTL":this.decodeACTL();break;case"fcTL":this.decodeFCTL();break;case"fdAT":this.decodeFDAT(e);break;default:this.decodeChunk(e,s),this.offset=i+e;break}if(this.offset-i!==e)throw new Error(`Length mismatch while decoding chunk ${s}`);this._checkCrc?Au(this,e+4,s):this.skip(4)}decodeIHDR(){const e=this._png;e.width=this.readUint32(),e.height=this.readUint32(),e.depth=W1(this.readUint8());const s=this.readUint8();this._colorType=s;let i;switch(s){case fs.GREYSCALE:i=1;break;case fs.TRUECOLOUR:i=3;break;case fs.INDEXED_COLOUR:i=1;break;case fs.GREYSCALE_ALPHA:i=2;break;case fs.TRUECOLOUR_ALPHA:i=4;break;case fs.UNKNOWN:default:throw new Error(`Unknown color type: ${s}`)}if(this._png.channels=i,this._compressionMethod=this.readUint8(),this._compressionMethod!==tc.DEFLATE)throw new Error(`Unsupported compression method: ${this._compressionMethod}`);this._filterMethod=this.readUint8(),this._interlaceMethod=this.readUint8()}decodeACTL(){this._numberOfFrames=this.readUint32(),this._numberOfPlays=this.readUint32(),this._isAnimated=!0}decodeFCTL(){const e={sequenceNumber:this.readUint32(),width:this.readUint32(),height:this.readUint32(),xOffset:this.readUint32(),yOffset:this.readUint32(),delayNumber:this.readUint16(),delayDenominator:this.readUint16(),disposeOp:this.readUint8(),blendOp:this.readUint8(),data:new Uint8Array(0)};this._frames.push(e)}decodePLTE(e){if(e%3!==0)throw new RangeError(`PLTE field length must be a multiple of 3. Got ${e}`);const s=e/3;this._hasPalette=!0;const i=[];this._palette=i;for(let a=0;a<s;a++)i.push([this.readUint8(),this.readUint8(),this.readUint8()])}decodeIDAT(e){this._writingDataChunks=!0;const s=e,i=this.offset+this.byteOffset;if(this._inflator.push(new Uint8Array(this.buffer,i,s)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodeFDAT(e){this._writingDataChunks=!0;let s=e,i=this.offset+this.byteOffset;if(i+=4,s-=4,this._inflator.push(new Uint8Array(this.buffer,i,s)),this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);this.skip(e)}decodetRNS(e){switch(this._colorType){case fs.GREYSCALE:case fs.TRUECOLOUR:{if(e%2!==0)throw new RangeError(`tRNS chunk length must be a multiple of 2. Got ${e}`);if(e/2>this._png.width*this._png.height)throw new Error(`tRNS chunk contains more alpha values than there are pixels (${e/2} vs ${this._png.width*this._png.height})`);this._hasTransparency=!0,this._transparency=new Uint16Array(e/2);for(let s=0;s<e/2;s++)this._transparency[s]=this.readUint16();break}case fs.INDEXED_COLOUR:{if(e>this._palette.length)throw new Error(`tRNS chunk contains more alpha values than there are palette colors (${e} vs ${this._palette.length})`);let s=0;for(;s<e;s++){const i=this.readByte();this._palette[s].push(i)}for(;s<this._palette.length;s++)this._palette[s].push(255);break}case fs.UNKNOWN:case fs.GREYSCALE_ALPHA:case fs.TRUECOLOUR_ALPHA:default:throw new Error(`tRNS chunk is not supported for color type ${this._colorType}`)}}decodeiCCP(e){const s=Mf(this),i=this.readUint8();if(i!==tc.DEFLATE)throw new Error(`Unsupported iCCP compression method: ${i}`);const a=this.readBytes(e-s.length-2);this._png.iccEmbeddedProfile={name:s,profile:w1(a)}}decodepHYs(){const e=this.readUint32(),s=this.readUint32(),i=this.readByte();this._png.resolution={x:e,y:s,unit:i}}decodeApngImage(){this._apng.width=this._png.width,this._apng.height=this._png.height,this._apng.channels=this._png.channels,this._apng.depth=this._png.depth,this._apng.numberOfFrames=this._numberOfFrames,this._apng.numberOfPlays=this._numberOfPlays,this._apng.text=this._png.text,this._apng.resolution=this._png.resolution;for(let e=0;e<this._numberOfFrames;e++){const s={sequenceNumber:this._frames[e].sequenceNumber,delayNumber:this._frames[e].delayNumber,delayDenominator:this._frames[e].delayDenominator,data:this._apng.depth===8?new Uint8Array(this._apng.width*this._apng.height*this._apng.channels):new Uint16Array(this._apng.width*this._apng.height*this._apng.channels)},i=this._frames.at(e);if(i){if(i.data=Lu({data:i.data,width:i.width,height:i.height,channels:this._apng.channels,depth:this._apng.depth}),this._hasPalette&&(this._apng.palette=this._palette),this._hasTransparency&&(this._apng.transparency=this._transparency),e===0||i.xOffset===0&&i.yOffset===0&&i.width===this._png.width&&i.height===this._png.height)s.data=i.data;else{const a=this._apng.frames.at(e-1);this.disposeFrame(i,a,s),this.addFrameDataToCanvas(s,i)}this._apng.frames.push(s)}}return this._apng}disposeFrame(e,s,i){switch(e.disposeOp){case Ho.NONE:break;case Ho.BACKGROUND:for(let a=0;a<this._png.height;a++)for(let d=0;d<this._png.width;d++){const o=(a*e.width+d)*this._png.channels;for(let c=0;c<this._png.channels;c++)i.data[o+c]=0}break;case Ho.PREVIOUS:i.data.set(s.data);break;default:throw new Error("Unknown disposeOp")}}addFrameDataToCanvas(e,s){const i=1<<this._png.depth,a=(d,o)=>{const c=((d+s.yOffset)*this._png.width+s.xOffset+o)*this._png.channels,h=(d*s.width+o)*this._png.channels;return{index:c,frameIndex:h}};switch(s.blendOp){case nc.SOURCE:for(let d=0;d<s.height;d++)for(let o=0;o<s.width;o++){const{index:c,frameIndex:h}=a(d,o);for(let p=0;p<this._png.channels;p++)e.data[c+p]=s.data[h+p]}break;case nc.OVER:for(let d=0;d<s.height;d++)for(let o=0;o<s.width;o++){const{index:c,frameIndex:h}=a(d,o);for(let p=0;p<this._png.channels;p++){const b=s.data[h+this._png.channels-1]/i,m=p%(this._png.channels-1)===0?1:s.data[h+p],u=Math.floor(b*m+(1-b)*e.data[c+p]);e.data[c+p]+=u}}break;default:throw new Error("Unknown blendOp")}}decodeImage(){var s;if(this._inflator.err)throw new Error(`Error while decompressing the data: ${this._inflator.err}`);const e=this._isAnimated?((s=this._frames)==null?void 0:s.at(0)).data:this._inflator.result;if(this._filterMethod!==Pu.ADAPTIVE)throw new Error(`Filter method ${this._filterMethod} not supported`);if(this._interlaceMethod===rc.NO_INTERLACE)this._png.data=Lu({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else if(this._interlaceMethod===rc.ADAM7)this._png.data=A1({data:e,width:this._png.width,height:this._png.height,channels:this._png.channels,depth:this._png.depth});else throw new Error(`Interlace method ${this._interlaceMethod} not supported`);this._hasPalette&&(this._png.palette=this._palette),this._hasTransparency&&(this._png.transparency=this._transparency)}pushDataToFrame(){const e=this._inflator.result,s=this._frames.at(-1);s?s.data=e:this._frames.push({sequenceNumber:0,width:this._png.width,height:this._png.height,xOffset:0,yOffset:0,delayNumber:0,delayDenominator:0,disposeOp:Ho.NONE,blendOp:nc.SOURCE,data:e}),this._inflator=new ku,this._writingDataChunks=!1}}function W1(r){if(r!==1&&r!==2&&r!==4&&r!==8&&r!==16)throw new Error(`invalid bit depth: ${r}`);return r}var Tu;(function(r){r[r.UNKNOWN=0]="UNKNOWN",r[r.METRE=1]="METRE"})(Tu||(Tu={}));function H1(r,t){return new $1(r,t).decode()}var Gt=(function(){return typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this})();function sc(){Gt.console&&typeof Gt.console.log=="function"&&Gt.console.log.apply(Gt.console,arguments)}var Ir={log:sc,warn:function(r){Gt.console&&(typeof Gt.console.warn=="function"?Gt.console.warn.apply(Gt.console,arguments):sc.call(null,arguments))},error:function(r){Gt.console&&(typeof Gt.console.error=="function"?Gt.console.error.apply(Gt.console,arguments):sc(r))}};function ac(r,t,e){var s=new XMLHttpRequest;s.open("GET",r),s.responseType="blob",s.onload=function(){ei(s.response,t,e)},s.onerror=function(){Ir.error("could not download file")},s.send()}function Iu(r){var t=new XMLHttpRequest;t.open("HEAD",r,!1);try{t.send()}catch{}return t.status>=200&&t.status<=299}function Vo(r){try{r.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.dispatchEvent(t)}}var ei=Gt.saveAs||((typeof window>"u"?"undefined":Cr(window))!=="object"||window!==Gt?function(){}:typeof HTMLAnchorElement<"u"&&"download"in HTMLAnchorElement.prototype?function(r,t,e){var s=Gt.URL||Gt.webkitURL,i=document.createElement("a");t=t||r.name||"download",i.download=t,i.rel="noopener",typeof r=="string"?(i.href=r,i.origin!==location.origin?Iu(i.href)?ac(r,t,e):Vo(i,i.target="_blank"):Vo(i)):(i.href=s.createObjectURL(r),setTimeout(function(){s.revokeObjectURL(i.href)},4e4),setTimeout(function(){Vo(i)},0))}:"msSaveOrOpenBlob"in navigator?function(r,t,e){if(t=t||r.name||"download",typeof r=="string")if(Iu(r))ac(r,t,e);else{var s=document.createElement("a");s.href=r,s.target="_blank",setTimeout(function(){Vo(s)})}else navigator.msSaveOrOpenBlob((function(i,a){return a===void 0?a={autoBom:!1}:Cr(a)!=="object"&&(Ir.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i})(r,e),t)}:function(r,t,e,s){if((s=s||open("","_blank"))&&(s.document.title=s.document.body.innerText="downloading..."),typeof r=="string")return ac(r,t,e);var i=r.type==="application/octet-stream",a=/constructor/i.test(Gt.HTMLElement)||Gt.safari,d=/CriOS\/[\d]+/.test(navigator.userAgent);if((d||i&&a)&&(typeof FileReader>"u"?"undefined":Cr(FileReader))==="object"){var o=new FileReader;o.onloadend=function(){var p=o.result;p=d?p:p.replace(/^data:[^;]*;/,"data:attachment/file;"),s?s.location.href=p:location=p,s=null},o.readAsDataURL(r)}else{var c=Gt.URL||Gt.webkitURL,h=c.createObjectURL(r);s?s.location=h:location.href=h,s=null,setTimeout(function(){c.revokeObjectURL(h)},4e4)}});/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * {@link   http://www.phpied.com/rgb-color-parser-in-javascript/}
 * @license Use it if you like it
 */function Uf(r){var t;r=r||"",this.ok=!1,r.charAt(0)=="#"&&(r=r.substr(1,6)),r={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"}[r=(r=r.replace(/ /g,"")).toLowerCase()]||r;for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],s=0;s<e.length;s++){var i=e[s].re,a=e[s].process,d=i.exec(r);d&&(t=a(d),this.r=t[0],this.g=t[1],this.b=t[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var o=this.r.toString(16),c=this.g.toString(16),h=this.b.toString(16);return o.length==1&&(o="0"+o),c.length==1&&(c="0"+c),h.length==1&&(h="0"+h),"#"+o+c+h}}var el=Gt.atob.bind(Gt),Fu=Gt.btoa.bind(Gt);/**
 * @license
 * Joseph Myers does not specify a particular license for his work.
 *
 * Author: Joseph Myers
 * Accessed from: http://www.myersdaily.org/joseph/javascript/md5.js
 *
 * Modified by: Owen Leong
 */function ic(r,t){var e=r[0],s=r[1],i=r[2],a=r[3];e=Fn(e,s,i,a,t[0],7,-680876936),a=Fn(a,e,s,i,t[1],12,-389564586),i=Fn(i,a,e,s,t[2],17,606105819),s=Fn(s,i,a,e,t[3],22,-1044525330),e=Fn(e,s,i,a,t[4],7,-176418897),a=Fn(a,e,s,i,t[5],12,1200080426),i=Fn(i,a,e,s,t[6],17,-1473231341),s=Fn(s,i,a,e,t[7],22,-45705983),e=Fn(e,s,i,a,t[8],7,1770035416),a=Fn(a,e,s,i,t[9],12,-1958414417),i=Fn(i,a,e,s,t[10],17,-42063),s=Fn(s,i,a,e,t[11],22,-1990404162),e=Fn(e,s,i,a,t[12],7,1804603682),a=Fn(a,e,s,i,t[13],12,-40341101),i=Fn(i,a,e,s,t[14],17,-1502002290),e=On(e,s=Fn(s,i,a,e,t[15],22,1236535329),i,a,t[1],5,-165796510),a=On(a,e,s,i,t[6],9,-1069501632),i=On(i,a,e,s,t[11],14,643717713),s=On(s,i,a,e,t[0],20,-373897302),e=On(e,s,i,a,t[5],5,-701558691),a=On(a,e,s,i,t[10],9,38016083),i=On(i,a,e,s,t[15],14,-660478335),s=On(s,i,a,e,t[4],20,-405537848),e=On(e,s,i,a,t[9],5,568446438),a=On(a,e,s,i,t[14],9,-1019803690),i=On(i,a,e,s,t[3],14,-187363961),s=On(s,i,a,e,t[8],20,1163531501),e=On(e,s,i,a,t[13],5,-1444681467),a=On(a,e,s,i,t[2],9,-51403784),i=On(i,a,e,s,t[7],14,1735328473),e=Rn(e,s=On(s,i,a,e,t[12],20,-1926607734),i,a,t[5],4,-378558),a=Rn(a,e,s,i,t[8],11,-2022574463),i=Rn(i,a,e,s,t[11],16,1839030562),s=Rn(s,i,a,e,t[14],23,-35309556),e=Rn(e,s,i,a,t[1],4,-1530992060),a=Rn(a,e,s,i,t[4],11,1272893353),i=Rn(i,a,e,s,t[7],16,-155497632),s=Rn(s,i,a,e,t[10],23,-1094730640),e=Rn(e,s,i,a,t[13],4,681279174),a=Rn(a,e,s,i,t[0],11,-358537222),i=Rn(i,a,e,s,t[3],16,-722521979),s=Rn(s,i,a,e,t[6],23,76029189),e=Rn(e,s,i,a,t[9],4,-640364487),a=Rn(a,e,s,i,t[12],11,-421815835),i=Rn(i,a,e,s,t[15],16,530742520),e=Dn(e,s=Rn(s,i,a,e,t[2],23,-995338651),i,a,t[0],6,-198630844),a=Dn(a,e,s,i,t[7],10,1126891415),i=Dn(i,a,e,s,t[14],15,-1416354905),s=Dn(s,i,a,e,t[5],21,-57434055),e=Dn(e,s,i,a,t[12],6,1700485571),a=Dn(a,e,s,i,t[3],10,-1894986606),i=Dn(i,a,e,s,t[10],15,-1051523),s=Dn(s,i,a,e,t[1],21,-2054922799),e=Dn(e,s,i,a,t[8],6,1873313359),a=Dn(a,e,s,i,t[15],10,-30611744),i=Dn(i,a,e,s,t[6],15,-1560198380),s=Dn(s,i,a,e,t[13],21,1309151649),e=Dn(e,s,i,a,t[4],6,-145523070),a=Dn(a,e,s,i,t[11],10,-1120210379),i=Dn(i,a,e,s,t[2],15,718787259),s=Dn(s,i,a,e,t[9],21,-343485551),r[0]=za(e,r[0]),r[1]=za(s,r[1]),r[2]=za(i,r[2]),r[3]=za(a,r[3])}function Nl(r,t,e,s,i,a){return t=za(za(t,r),za(s,a)),za(t<<i|t>>>32-i,e)}function Fn(r,t,e,s,i,a,d){return Nl(t&e|~t&s,r,t,i,a,d)}function On(r,t,e,s,i,a,d){return Nl(t&s|e&~s,r,t,i,a,d)}function Rn(r,t,e,s,i,a,d){return Nl(t^e^s,r,t,i,a,d)}function Dn(r,t,e,s,i,a,d){return Nl(e^(t|~s),r,t,i,a,d)}function zf(r){var t,e=r.length,s=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=r.length;t+=64)ic(s,V1(r.substring(t-64,t)));r=r.substring(t-64);var i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<r.length;t++)i[t>>2]|=r.charCodeAt(t)<<(t%4<<3);if(i[t>>2]|=128<<(t%4<<3),t>55)for(ic(s,i),t=0;t<16;t++)i[t]=0;return i[14]=8*e,ic(s,i),s}function V1(r){var t,e=[];for(t=0;t<64;t+=4)e[t>>2]=r.charCodeAt(t)+(r.charCodeAt(t+1)<<8)+(r.charCodeAt(t+2)<<16)+(r.charCodeAt(t+3)<<24);return e}var Ou="0123456789abcdef".split("");function G1(r){for(var t="",e=0;e<4;e++)t+=Ou[r>>8*e+4&15]+Ou[r>>8*e&15];return t}function Y1(r){return String.fromCharCode(255&r,(65280&r)>>8,(16711680&r)>>16,(4278190080&r)>>24)}function kc(r){return zf(r).map(Y1).join("")}var J1=(function(r){for(var t=0;t<r.length;t++)r[t]=G1(r[t]);return r.join("")})(zf("hello"))!="5d41402abc4b2a76b9719d911017c592";function za(r,t){if(J1){var e=(65535&r)+(65535&t);return(r>>16)+(t>>16)+(e>>16)<<16|65535&e}return r+t&4294967295}/**
 * @license
 * FPDF is released under a permissive license: there is no usage restriction.
 * You may embed it freely in your application (commercial or not), with or
 * without modifications.
 *
 * Reference: http://www.fpdf.org/en/script/script37.php
 */function Cc(r,t){var e,s,i,a;if(r!==e){for(var d=(i=r,a=1+(256/r.length|0),new Array(a+1).join(i)),o=[],c=0;c<256;c++)o[c]=c;var h=0;for(c=0;c<256;c++){var p=o[c];h=(h+p+d.charCodeAt(c))%256,o[c]=o[h],o[h]=p}e=r,s=o}else o=s;var b=t.length,m=0,u=0,w="";for(c=0;c<b;c++)u=(u+(p=o[m=(m+1)%256]))%256,o[m]=o[u],o[u]=p,d=o[(o[m]+o[u])%256],w+=String.fromCharCode(t.charCodeAt(c)^d);return w}/**
 * @license
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 * Author: Owen Leong (@owenl131)
 * Date: 15 Oct 2020
 * References:
 * https://www.cs.cmu.edu/~dst/Adobe/Gallery/anon21jul01-pdf-encryption.txt
 * https://github.com/foliojs/pdfkit/blob/master/lib/security.js
 * http://www.fpdf.org/en/script/script37.php
 */var Ru={print:4,modify:8,copy:16,"annot-forms":32};function ki(r,t,e,s){this.v=1,this.r=2;var i=192;r.forEach(function(o){if(Ru.perm!==void 0)throw new Error("Invalid permission: "+o);i+=Ru[o]}),this.padding="(Â¿N^NuÂŠAd\0NVÃ¿Ãº\b..\0Â¶Ãh>Â€/\fÂ©Ã¾dSiz";var a=(t+this.padding).substr(0,32),d=(e+this.padding).substr(0,32);this.O=this.processOwnerPassword(a,d),this.P=-(1+(255^i)),this.encryptionKey=kc(a+this.O+this.lsbFirstWord(this.P)+this.hexToBytes(s)).substr(0,5),this.U=Cc(this.encryptionKey,this.padding)}function Ci(r){if(/[^\u0000-\u00ff]/.test(r))throw new Error("Invalid PDF Name Object: "+r+", Only accept ASCII characters.");for(var t="",e=r.length,s=0;s<e;s++){var i=r.charCodeAt(s);t+=i<33||i===35||i===37||i===40||i===41||i===47||i===60||i===62||i===91||i===93||i===123||i===125||i>126?"#"+("0"+i.toString(16)).slice(-2):r[s]}return t}function Du(r){if(Cr(r)!=="object")throw new Error("Invalid Context passed to initialize PubSub (jsPDF-module)");var t={};this.subscribe=function(e,s,i){if(i=i||!1,typeof e!="string"||typeof s!="function"||typeof i!="boolean")throw new Error("Invalid arguments passed to PubSub.subscribe (jsPDF-module)");t.hasOwnProperty(e)||(t[e]={});var a=Math.random().toString(35);return t[e][a]=[s,!!i],a},this.unsubscribe=function(e){for(var s in t)if(t[s][e])return delete t[s][e],Object.keys(t[s]).length===0&&delete t[s],!0;return!1},this.publish=function(e){if(t.hasOwnProperty(e)){var s=Array.prototype.slice.call(arguments,1),i=[];for(var a in t[e]){var d=t[e][a];try{d[0].apply(r,s)}catch(o){Gt.console&&Ir.error("jsPDF PubSub Error",o.message,o)}d[1]&&i.push(a)}i.length&&i.forEach(this.unsubscribe)}},this.getTopics=function(){return t}}function pl(r){if(!(this instanceof pl))return new pl(r);var t="opacity,stroke-opacity".split(",");for(var e in r)r.hasOwnProperty(e)&&t.indexOf(e)>=0&&(this[e]=r[e]);this.id="",this.objectNumber=-1}function qf(r,t){this.gState=r,this.matrix=t,this.id="",this.objectNumber=-1}function ti(r,t,e,s,i){if(!(this instanceof ti))return new ti(r,t,e,s,i);this.type=r==="axial"?2:3,this.coords=t,this.colors=e,qf.call(this,s,i)}function Li(r,t,e,s,i){if(!(this instanceof Li))return new Li(r,t,e,s,i);this.boundingBox=r,this.xStep=t,this.yStep=e,this.stream="",this.cloneIndex=0,qf.call(this,s,i)}function Ut(r){var t,e=typeof arguments[0]=="string"?arguments[0]:"p",s=arguments[1],i=arguments[2],a=arguments[3],d=[],o=1,c=16,h="S",p=null;Cr(r=r||{})==="object"&&(e=r.orientation,s=r.unit||s,i=r.format||i,a=r.compress||r.compressPdf||a,(p=r.encryption||null)!==null&&(p.userPassword=p.userPassword||"",p.ownerPassword=p.ownerPassword||"",p.userPermissions=p.userPermissions||[]),o=typeof r.userUnit=="number"?Math.abs(r.userUnit):1,r.precision!==void 0&&(t=r.precision),r.floatPrecision!==void 0&&(c=r.floatPrecision),h=r.defaultPathOperation||"S"),d=r.filters||(a===!0?["FlateEncode"]:d),s=s||"mm",e=(""+(e||"P")).toLowerCase();var b=r.putOnlyUsedFonts||!1,m={},u={internal:{},__private__:{}};u.__private__.PubSub=Du;var w="1.3",g=u.__private__.getPdfVersion=function(){return w};u.__private__.setPdfVersion=function(x){w=x};var N={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};u.__private__.getPageFormats=function(){return N};var y=u.__private__.getPageFormat=function(x){return N[x]};i=i||"a4";var S="compat",L="advanced",E=S;function I(){this.saveGraphicsState(),P(new zt(bt,0,0,-bt,0,ss()*bt).toString()+" cm"),this.setFontSize(this.getFontSize()/bt),h="n",E=L}function K(){this.restoreGraphicsState(),h="S",E=S}var Y=u.__private__.combineFontStyleAndFontWeight=function(x,R){if(x=="bold"&&R=="normal"||x=="bold"&&R==400||x=="normal"&&R=="italic"||x=="bold"&&R=="italic")throw new Error("Invalid Combination of fontweight and fontstyle");return R&&(x=R==400||R==="normal"?x==="italic"?"italic":"normal":R!=700&&R!=="bold"||x!=="normal"?(R==700?"bold":R)+""+x:"bold"),x};u.advancedAPI=function(x){var R=E===S;return R&&I.call(this),typeof x!="function"||(x(this),R&&K.call(this)),this},u.compatAPI=function(x){var R=E===L;return R&&K.call(this),typeof x!="function"||(x(this),R&&I.call(this)),this},u.isAdvancedAPI=function(){return E===L};var V,O=function(x){if(E!==L)throw new Error(x+" is only available in 'advanced' API mode. You need to call advancedAPI() first.")},Q=u.roundToPrecision=u.__private__.roundToPrecision=function(x,R){var oe=t||R;if(isNaN(x)||isNaN(oe))throw new Error("Invalid argument passed to jsPDF.roundToPrecision");return x.toFixed(oe).replace(/0+$/,"")};V=u.hpf=u.__private__.hpf=typeof c=="number"?function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.hpf");return Q(x,c)}:c==="smart"?function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.hpf");return Q(x,x>-1&&x<1?16:5)}:function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.hpf");return Q(x,16)};var F=u.f2=u.__private__.f2=function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.f2");return Q(x,2)},k=u.__private__.f3=function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.f3");return Q(x,3)},M=u.scale=u.__private__.scale=function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.scale");return E===S?x*bt:E===L?x:void 0},_=function(x){return M((function(R){return E===S?ss()-R:E===L?R:void 0})(x))};u.__private__.setPrecision=u.setPrecision=function(x){typeof parseInt(x,10)=="number"&&(t=parseInt(x,10))};var te,ae="00000000000000000000000000000000",re=u.__private__.getFileId=function(){return ae},se=u.__private__.setFileId=function(x){return ae=x!==void 0&&/^[a-fA-F0-9]{32}$/.test(x)?x.toUpperCase():ae.split("").map(function(){return"ABCDEF0123456789".charAt(Math.floor(16*Math.random()))}).join(""),p!==null&&(Er=new ki(p.userPermissions,p.userPassword,p.ownerPassword,ae)),ae};u.setFileId=function(x){return se(x),this},u.getFileId=function(){return re()};var ie=u.__private__.convertDateToPDFDate=function(x){var R=x.getTimezoneOffset(),oe=R<0?"+":"-",be=Math.floor(Math.abs(R/60)),Ee=Math.abs(R%60),Ge=[oe,Z(be),"'",Z(Ee),"'"].join("");return["D:",x.getFullYear(),Z(x.getMonth()+1),Z(x.getDate()),Z(x.getHours()),Z(x.getMinutes()),Z(x.getSeconds()),Ge].join("")},je=u.__private__.convertPDFDateToDate=function(x){var R=parseInt(x.substr(2,4),10),oe=parseInt(x.substr(6,2),10)-1,be=parseInt(x.substr(8,2),10),Ee=parseInt(x.substr(10,2),10),Ge=parseInt(x.substr(12,2),10),Xe=parseInt(x.substr(14,2),10);return new Date(R,oe,be,Ee,Ge,Xe,0)},ne=u.__private__.setCreationDate=function(x){var R;if(x===void 0&&(x=new Date),x instanceof Date)R=ie(x);else{if(!/^D:(20[0-2][0-9]|203[0-7]|19[7-9][0-9])(0[0-9]|1[0-2])([0-2][0-9]|3[0-1])(0[0-9]|1[0-9]|2[0-3])(0[0-9]|[1-5][0-9])(0[0-9]|[1-5][0-9])(\+0[0-9]|\+1[0-4]|-0[0-9]|-1[0-1])'(0[0-9]|[1-5][0-9])'?$/.test(x))throw new Error("Invalid argument passed to jsPDF.setCreationDate");R=x}return te=R},A=u.__private__.getCreationDate=function(x){var R=te;return x==="jsDate"&&(R=je(te)),R};u.setCreationDate=function(x){return ne(x),this},u.getCreationDate=function(x){return A(x)};var H,Z=u.__private__.padd2=function(x){return("0"+parseInt(x)).slice(-2)},X=u.__private__.padd2Hex=function(x){return("00"+(x=x.toString())).substr(x.length)},pe=0,ve=[],ke=[],Ae=0,De=[],Me=[],Ke=!1,Se=ke;u.__private__.setCustomOutputDestination=function(x){Ke=!0,Se=x};var j=function(x){Ke||(Se=x)};u.__private__.resetCustomOutputDestination=function(){Ke=!1,Se=ke};var P=u.__private__.out=function(x){return x=x.toString(),Ae+=x.length+1,Se.push(x),Se},G=u.__private__.write=function(x){return P(arguments.length===1?x.toString():Array.prototype.join.call(arguments," "))},$=u.__private__.getArrayBuffer=function(x){for(var R=x.length,oe=new ArrayBuffer(R),be=new Uint8Array(oe);R--;)be[R]=x.charCodeAt(R);return oe},z=[["Helvetica","helvetica","normal","WinAnsiEncoding"],["Helvetica-Bold","helvetica","bold","WinAnsiEncoding"],["Helvetica-Oblique","helvetica","italic","WinAnsiEncoding"],["Helvetica-BoldOblique","helvetica","bolditalic","WinAnsiEncoding"],["Courier","courier","normal","WinAnsiEncoding"],["Courier-Bold","courier","bold","WinAnsiEncoding"],["Courier-Oblique","courier","italic","WinAnsiEncoding"],["Courier-BoldOblique","courier","bolditalic","WinAnsiEncoding"],["Times-Roman","times","normal","WinAnsiEncoding"],["Times-Bold","times","bold","WinAnsiEncoding"],["Times-Italic","times","italic","WinAnsiEncoding"],["Times-BoldItalic","times","bolditalic","WinAnsiEncoding"],["ZapfDingbats","zapfdingbats","normal",null],["Symbol","symbol","normal",null]];u.__private__.getStandardFonts=function(){return z};var B=r.fontSize||16;u.__private__.setFontSize=u.setFontSize=function(x){return B=E===L?x/bt:x,this};var he,me=u.__private__.getFontSize=u.getFontSize=function(){return E===S?B:B*bt},de=r.R2L||!1;u.__private__.setR2L=u.setR2L=function(x){return de=x,this},u.__private__.getR2L=u.getR2L=function(){return de};var Le,Ie=u.__private__.setZoomMode=function(x){if(/^(?:\d+\.\d*|\d*\.\d+|\d+)%$/.test(x))he=x;else if(isNaN(x)){if([void 0,null,"fullwidth","fullheight","fullpage","original"].indexOf(x)===-1)throw new Error('zoom must be Integer (e.g. 2), a percentage Value (e.g. 300%) or fullwidth, fullheight, fullpage, original. "'+x+'" is not recognized.');he=x}else he=parseInt(x,10)};u.__private__.getZoomMode=function(){return he};var Te,Ye=u.__private__.setPageMode=function(x){if([void 0,null,"UseNone","UseOutlines","UseThumbs","FullScreen"].indexOf(x)==-1)throw new Error('Page mode must be one of UseNone, UseOutlines, UseThumbs, or FullScreen. "'+x+'" is not recognized.');Le=x};u.__private__.getPageMode=function(){return Le};var ft=u.__private__.setLayoutMode=function(x){if([void 0,null,"continuous","single","twoleft","tworight","two"].indexOf(x)==-1)throw new Error('Layout mode must be one of continuous, single, twoleft, tworight. "'+x+'" is not recognized.');Te=x};u.__private__.getLayoutMode=function(){return Te},u.__private__.setDisplayMode=u.setDisplayMode=function(x,R,oe){return Ie(x),ft(R),Ye(oe),this};var at={title:"",subject:"",author:"",keywords:"",creator:""};u.__private__.getDocumentProperty=function(x){if(Object.keys(at).indexOf(x)===-1)throw new Error("Invalid argument passed to jsPDF.getDocumentProperty");return at[x]},u.__private__.getDocumentProperties=function(){return at},u.__private__.setDocumentProperties=u.setProperties=u.setDocumentProperties=function(x){for(var R in at)at.hasOwnProperty(R)&&x[R]&&(at[R]=x[R]);return this},u.__private__.setDocumentProperty=function(x,R){if(Object.keys(at).indexOf(x)===-1)throw new Error("Invalid arguments passed to jsPDF.setDocumentProperty");return at[x]=R};var lt,bt,ut,Yt,gt,Et={},qt={},Pt=[],vt={},Zt={},_t={},Ot={},ir=null,Rt=0,yt=[],Qt=new Du(u),tr=r.hotfixes||[],Br={},wn={},rn=[],zt=function x(R,oe,be,Ee,Ge,Xe){if(!(this instanceof x))return new x(R,oe,be,Ee,Ge,Xe);isNaN(R)&&(R=1),isNaN(oe)&&(oe=0),isNaN(be)&&(be=0),isNaN(Ee)&&(Ee=1),isNaN(Ge)&&(Ge=0),isNaN(Xe)&&(Xe=0),this._matrix=[R,oe,be,Ee,Ge,Xe]};Object.defineProperty(zt.prototype,"sx",{get:function(){return this._matrix[0]},set:function(x){this._matrix[0]=x}}),Object.defineProperty(zt.prototype,"shy",{get:function(){return this._matrix[1]},set:function(x){this._matrix[1]=x}}),Object.defineProperty(zt.prototype,"shx",{get:function(){return this._matrix[2]},set:function(x){this._matrix[2]=x}}),Object.defineProperty(zt.prototype,"sy",{get:function(){return this._matrix[3]},set:function(x){this._matrix[3]=x}}),Object.defineProperty(zt.prototype,"tx",{get:function(){return this._matrix[4]},set:function(x){this._matrix[4]=x}}),Object.defineProperty(zt.prototype,"ty",{get:function(){return this._matrix[5]},set:function(x){this._matrix[5]=x}}),Object.defineProperty(zt.prototype,"a",{get:function(){return this._matrix[0]},set:function(x){this._matrix[0]=x}}),Object.defineProperty(zt.prototype,"b",{get:function(){return this._matrix[1]},set:function(x){this._matrix[1]=x}}),Object.defineProperty(zt.prototype,"c",{get:function(){return this._matrix[2]},set:function(x){this._matrix[2]=x}}),Object.defineProperty(zt.prototype,"d",{get:function(){return this._matrix[3]},set:function(x){this._matrix[3]=x}}),Object.defineProperty(zt.prototype,"e",{get:function(){return this._matrix[4]},set:function(x){this._matrix[4]=x}}),Object.defineProperty(zt.prototype,"f",{get:function(){return this._matrix[5]},set:function(x){this._matrix[5]=x}}),Object.defineProperty(zt.prototype,"rotation",{get:function(){return Math.atan2(this.shx,this.sx)}}),Object.defineProperty(zt.prototype,"scaleX",{get:function(){return this.decompose().scale.sx}}),Object.defineProperty(zt.prototype,"scaleY",{get:function(){return this.decompose().scale.sy}}),Object.defineProperty(zt.prototype,"isIdentity",{get:function(){return this.sx===1&&this.shy===0&&this.shx===0&&this.sy===1&&this.tx===0&&this.ty===0}}),zt.prototype.join=function(x){return[this.sx,this.shy,this.shx,this.sy,this.tx,this.ty].map(V).join(x)},zt.prototype.multiply=function(x){var R=x.sx*this.sx+x.shy*this.shx,oe=x.sx*this.shy+x.shy*this.sy,be=x.shx*this.sx+x.sy*this.shx,Ee=x.shx*this.shy+x.sy*this.sy,Ge=x.tx*this.sx+x.ty*this.shx+this.tx,Xe=x.tx*this.shy+x.ty*this.sy+this.ty;return new zt(R,oe,be,Ee,Ge,Xe)},zt.prototype.decompose=function(){var x=this.sx,R=this.shy,oe=this.shx,be=this.sy,Ee=this.tx,Ge=this.ty,Xe=Math.sqrt(x*x+R*R),Nt=(x/=Xe)*oe+(R/=Xe)*be;oe-=x*Nt,be-=R*Nt;var Tt=Math.sqrt(oe*oe+be*be);return Nt/=Tt,x*(be/=Tt)<R*(oe/=Tt)&&(x=-x,R=-R,Nt=-Nt,Xe=-Xe),{scale:new zt(Xe,0,0,Tt,0,0),translate:new zt(1,0,0,1,Ee,Ge),rotate:new zt(x,R,-R,x,0,0),skew:new zt(1,0,Nt,1,0,0)}},zt.prototype.toString=function(x){return this.join(" ")},zt.prototype.inversed=function(){var x=this.sx,R=this.shy,oe=this.shx,be=this.sy,Ee=this.tx,Ge=this.ty,Xe=1/(x*be-R*oe),Nt=be*Xe,Tt=-R*Xe,$t=-oe*Xe,Kt=x*Xe;return new zt(Nt,Tt,$t,Kt,-Nt*Ee-$t*Ge,-Tt*Ee-Kt*Ge)},zt.prototype.applyToPoint=function(x){var R=x.x*this.sx+x.y*this.shx+this.tx,oe=x.x*this.shy+x.y*this.sy+this.ty;return new Zn(R,oe)},zt.prototype.applyToRectangle=function(x){var R=this.applyToPoint(x),oe=this.applyToPoint(new Zn(x.x+x.w,x.y+x.h));return new Ga(R.x,R.y,oe.x-R.x,oe.y-R.y)},zt.prototype.clone=function(){var x=this.sx,R=this.shy,oe=this.shx,be=this.sy,Ee=this.tx,Ge=this.ty;return new zt(x,R,oe,be,Ee,Ge)},u.Matrix=zt;var mn=u.matrixMult=function(x,R){return R.multiply(x)},vn=new zt(1,0,0,1,0,0);u.unitMatrix=u.identityMatrix=vn;var Yr=function(x,R){if(!Zt[x]){var oe=(R instanceof ti?"Sh":"P")+(Object.keys(vt).length+1).toString(10);R.id=oe,Zt[x]=oe,vt[oe]=R,Qt.publish("addPattern",R)}};u.ShadingPattern=ti,u.TilingPattern=Li,u.addShadingPattern=function(x,R){return O("addShadingPattern()"),Yr(x,R),this},u.beginTilingPattern=function(x){O("beginTilingPattern()"),Ya(x.boundingBox[0],x.boundingBox[1],x.boundingBox[2]-x.boundingBox[0],x.boundingBox[3]-x.boundingBox[1],x.matrix)},u.endTilingPattern=function(x,R){O("endTilingPattern()"),R.stream=Me[H].join(`
`),Yr(x,R),Qt.publish("endTilingPattern",R),rn.pop().restore()};var Wr,yr=u.__private__.newObject=function(){var x=Lr();return ur(x,!0),x},Lr=u.__private__.newObjectDeferred=function(){return pe++,ve[pe]=function(){return Ae},pe},ur=function(x,R){return R=typeof R=="boolean"&&R,ve[x]=Ae,R&&P(x+" 0 obj"),x},ns=u.__private__.newAdditionalObject=function(){var x={objId:Lr(),content:""};return De.push(x),x},vr=Lr(),kn=Lr(),nn=u.__private__.decodeColorString=function(x){var R=x.split(" ");if(R.length!==2||R[1]!=="g"&&R[1]!=="G")R.length!==5||R[4]!=="k"&&R[4]!=="K"||(R=[(1-R[0])*(1-R[3]),(1-R[1])*(1-R[3]),(1-R[2])*(1-R[3]),"r"]);else{var oe=parseFloat(R[0]);R=[oe,oe,oe,"r"]}for(var be="#",Ee=0;Ee<3;Ee++)be+=("0"+Math.floor(255*parseFloat(R[Ee])).toString(16)).slice(-2);return be},Cn=u.__private__.encodeColorString=function(x){var R;typeof x=="string"&&(x={ch1:x});var oe=x.ch1,be=x.ch2,Ee=x.ch3,Ge=x.ch4,Xe=x.pdfColorType==="draw"?["G","RG","K"]:["g","rg","k"];if(typeof oe=="string"&&oe.charAt(0)!=="#"){var Nt=new Uf(oe);if(Nt.ok)oe=Nt.toHex();else if(!/^\d*\.?\d*$/.test(oe))throw new Error('Invalid color "'+oe+'" passed to jsPDF.encodeColorString.')}if(typeof oe=="string"&&/^#[0-9A-Fa-f]{3}$/.test(oe)&&(oe="#"+oe[1]+oe[1]+oe[2]+oe[2]+oe[3]+oe[3]),typeof oe=="string"&&/^#[0-9A-Fa-f]{6}$/.test(oe)){var Tt=parseInt(oe.substr(1),16);oe=Tt>>16&255,be=Tt>>8&255,Ee=255&Tt}if(be===void 0||Ge===void 0&&oe===be&&be===Ee)R=typeof oe=="string"?oe+" "+Xe[0]:x.precision===2?F(oe/255)+" "+Xe[0]:k(oe/255)+" "+Xe[0];else if(Ge===void 0||Cr(Ge)==="object"){if(Ge&&!isNaN(Ge.a)&&Ge.a===0)return["1.","1.","1.",Xe[1]].join(" ");R=typeof oe=="string"?[oe,be,Ee,Xe[1]].join(" "):x.precision===2?[F(oe/255),F(be/255),F(Ee/255),Xe[1]].join(" "):[k(oe/255),k(be/255),k(Ee/255),Xe[1]].join(" ")}else R=typeof oe=="string"?[oe,be,Ee,Ge,Xe[2]].join(" "):x.precision===2?[F(oe),F(be),F(Ee),F(Ge),Xe[2]].join(" "):[k(oe),k(be),k(Ee),k(Ge),Xe[2]].join(" ");return R},Hr=u.__private__.getFilters=function(){return d},Jr=u.__private__.putStream=function(x){var R=(x=x||{}).data||"",oe=x.filters||Hr(),be=x.alreadyAppliedFilters||[],Ee=x.addLength1||!1,Ge=R.length,Xe=x.objectId,Nt=function(xe){return xe};if(p!==null&&Xe===void 0)throw new Error("ObjectId must be passed to putStream for file encryption");p!==null&&(Nt=Er.encryptor(Xe,0));var Tt={};oe===!0&&(oe=["FlateEncode"]);var $t=x.additionalKeyValues||[],Kt=(Tt=Ut.API.processDataByFilters!==void 0?Ut.API.processDataByFilters(R,oe):{data:R,reverseChain:[]}).reverseChain+(Array.isArray(be)?be.join(" "):be.toString());if(Tt.data.length!==0&&($t.push({key:"Length",value:Tt.data.length}),Ee===!0&&$t.push({key:"Length1",value:Ge})),Kt.length!=0)if(Kt.split("/").length-1==1)$t.push({key:"Filter",value:Kt});else{$t.push({key:"Filter",value:"["+Kt+"]"});for(var lr=0;lr<$t.length;lr+=1)if($t[lr].key==="DecodeParms"){for(var T=[],ue=0;ue<Tt.reverseChain.split("/").length-1;ue+=1)T.push("null");T.push($t[lr].value),$t[lr].value="["+T.join(" ")+"]"}}P("<<");for(var ge=0;ge<$t.length;ge++)P("/"+$t[ge].key+" "+$t[ge].value);P(">>"),Tt.data.length!==0&&(P("stream"),P(Nt(Tt.data)),P("endstream"))},Pn=u.__private__.putPage=function(x){var R=x.number,oe=x.data,be=x.objId,Ee=x.contentsObjId;ur(be,!0),P("<</Type /Page"),P("/Parent "+x.rootDictionaryObjId+" 0 R"),P("/Resources "+x.resourceDictionaryObjId+" 0 R"),P("/MediaBox ["+parseFloat(V(x.mediaBox.bottomLeftX))+" "+parseFloat(V(x.mediaBox.bottomLeftY))+" "+V(x.mediaBox.topRightX)+" "+V(x.mediaBox.topRightY)+"]"),x.cropBox!==null&&P("/CropBox ["+V(x.cropBox.bottomLeftX)+" "+V(x.cropBox.bottomLeftY)+" "+V(x.cropBox.topRightX)+" "+V(x.cropBox.topRightY)+"]"),x.bleedBox!==null&&P("/BleedBox ["+V(x.bleedBox.bottomLeftX)+" "+V(x.bleedBox.bottomLeftY)+" "+V(x.bleedBox.topRightX)+" "+V(x.bleedBox.topRightY)+"]"),x.trimBox!==null&&P("/TrimBox ["+V(x.trimBox.bottomLeftX)+" "+V(x.trimBox.bottomLeftY)+" "+V(x.trimBox.topRightX)+" "+V(x.trimBox.topRightY)+"]"),x.artBox!==null&&P("/ArtBox ["+V(x.artBox.bottomLeftX)+" "+V(x.artBox.bottomLeftY)+" "+V(x.artBox.topRightX)+" "+V(x.artBox.topRightY)+"]"),typeof x.userUnit=="number"&&x.userUnit!==1&&P("/UserUnit "+x.userUnit),Qt.publish("putPage",{objId:be,pageContext:yt[R],pageNumber:R,page:oe}),P("/Contents "+Ee+" 0 R"),P(">>"),P("endobj");var Ge=oe.join(`
`);return E===L&&(Ge+=`
Q`),ur(Ee,!0),Jr({data:Ge,filters:Hr(),objectId:Ee}),P("endobj"),be},ct=u.__private__.putPages=function(){var x,R,oe=[];for(x=1;x<=Rt;x++)yt[x].objId=Lr(),yt[x].contentsObjId=Lr();for(x=1;x<=Rt;x++)oe.push(Pn({number:x,data:Me[x],objId:yt[x].objId,contentsObjId:yt[x].contentsObjId,mediaBox:yt[x].mediaBox,cropBox:yt[x].cropBox,bleedBox:yt[x].bleedBox,trimBox:yt[x].trimBox,artBox:yt[x].artBox,userUnit:yt[x].userUnit,rootDictionaryObjId:vr,resourceDictionaryObjId:kn}));ur(vr,!0),P("<</Type /Pages");var be="/Kids [";for(R=0;R<Rt;R++)be+=oe[R]+" 0 R ";P(be+"]"),P("/Count "+Rt),P(">>"),P("endobj"),Qt.publish("postPutPages")},Zr=function(x){Qt.publish("putFont",{font:x,out:P,newObject:yr,putStream:Jr}),x.isAlreadyPutted!==!0&&(x.objectNumber=yr(),P("<<"),P("/Type /Font"),P("/BaseFont /"+Ci(x.postScriptName)),P("/Subtype /Type1"),typeof x.encoding=="string"&&P("/Encoding /"+x.encoding),P("/FirstChar 32"),P("/LastChar 255"),P(">>"),P("endobj"))},ye=function(x){x.objectNumber=yr();var R=[];R.push({key:"Type",value:"/XObject"}),R.push({key:"Subtype",value:"/Form"}),R.push({key:"BBox",value:"["+[V(x.x),V(x.y),V(x.x+x.width),V(x.y+x.height)].join(" ")+"]"}),R.push({key:"Matrix",value:"["+x.matrix.toString()+"]"});var oe=x.pages[1].join(`
`);Jr({data:oe,additionalKeyValues:R,objectId:x.objectNumber}),P("endobj")},qe=function(x,R){R||(R=21);var oe=yr(),be=(function(Xe,Nt){var Tt,$t=[],Kt=1/(Nt-1);for(Tt=0;Tt<1;Tt+=Kt)$t.push(Tt);if($t.push(1),Xe[0].offset!=0){var lr={offset:0,color:Xe[0].color};Xe.unshift(lr)}if(Xe[Xe.length-1].offset!=1){var T={offset:1,color:Xe[Xe.length-1].color};Xe.push(T)}for(var ue="",ge=0,xe=0;xe<$t.length;xe++){for(Tt=$t[xe];Tt>Xe[ge+1].offset;)ge++;var fe=Xe[ge].offset,Ne=(Tt-fe)/(Xe[ge+1].offset-fe),Fe=Xe[ge].color,$e=Xe[ge+1].color;ue+=X(Math.round((1-Ne)*Fe[0]+Ne*$e[0]).toString(16))+X(Math.round((1-Ne)*Fe[1]+Ne*$e[1]).toString(16))+X(Math.round((1-Ne)*Fe[2]+Ne*$e[2]).toString(16))}return ue.trim()})(x.colors,R),Ee=[];Ee.push({key:"FunctionType",value:"0"}),Ee.push({key:"Domain",value:"[0.0 1.0]"}),Ee.push({key:"Size",value:"["+R+"]"}),Ee.push({key:"BitsPerSample",value:"8"}),Ee.push({key:"Range",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Ee.push({key:"Decode",value:"[0.0 1.0 0.0 1.0 0.0 1.0]"}),Jr({data:be,additionalKeyValues:Ee,alreadyAppliedFilters:["/ASCIIHexDecode"],objectId:oe}),P("endobj"),x.objectNumber=yr(),P("<< /ShadingType "+x.type),P("/ColorSpace /DeviceRGB");var Ge="/Coords ["+V(parseFloat(x.coords[0]))+" "+V(parseFloat(x.coords[1]))+" ";x.type===2?Ge+=V(parseFloat(x.coords[2]))+" "+V(parseFloat(x.coords[3])):Ge+=V(parseFloat(x.coords[2]))+" "+V(parseFloat(x.coords[3]))+" "+V(parseFloat(x.coords[4]))+" "+V(parseFloat(x.coords[5])),P(Ge+="]"),x.matrix&&P("/Matrix ["+x.matrix.toString()+"]"),P("/Function "+oe+" 0 R"),P("/Extend [true true]"),P(">>"),P("endobj")},He=function(x,R){var oe=Lr(),be=yr();R.push({resourcesOid:oe,objectOid:be}),x.objectNumber=be;var Ee=[];Ee.push({key:"Type",value:"/Pattern"}),Ee.push({key:"PatternType",value:"1"}),Ee.push({key:"PaintType",value:"1"}),Ee.push({key:"TilingType",value:"1"}),Ee.push({key:"BBox",value:"["+x.boundingBox.map(V).join(" ")+"]"}),Ee.push({key:"XStep",value:V(x.xStep)}),Ee.push({key:"YStep",value:V(x.yStep)}),Ee.push({key:"Resources",value:oe+" 0 R"}),x.matrix&&Ee.push({key:"Matrix",value:"["+x.matrix.toString()+"]"}),Jr({data:x.stream,additionalKeyValues:Ee,objectId:x.objectNumber}),P("endobj")},et=function(x){for(var R in x.objectNumber=yr(),P("<<"),x)switch(R){case"opacity":P("/ca "+F(x[R]));break;case"stroke-opacity":P("/CA "+F(x[R]))}P(">>"),P("endobj")},it=function(x){ur(x.resourcesOid,!0),P("<<"),P("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]"),(function(){for(var R in P("/Font <<"),Et)Et.hasOwnProperty(R)&&(b===!1||b===!0&&m.hasOwnProperty(R))&&P("/"+R+" "+Et[R].objectNumber+" 0 R");P(">>")})(),(function(){if(Object.keys(vt).length>0){for(var R in P("/Shading <<"),vt)vt.hasOwnProperty(R)&&vt[R]instanceof ti&&vt[R].objectNumber>=0&&P("/"+R+" "+vt[R].objectNumber+" 0 R");Qt.publish("putShadingPatternDict"),P(">>")}})(),(function(R){if(Object.keys(vt).length>0){for(var oe in P("/Pattern <<"),vt)vt.hasOwnProperty(oe)&&vt[oe]instanceof u.TilingPattern&&vt[oe].objectNumber>=0&&vt[oe].objectNumber<R&&P("/"+oe+" "+vt[oe].objectNumber+" 0 R");Qt.publish("putTilingPatternDict"),P(">>")}})(x.objectOid),(function(){if(Object.keys(_t).length>0){var R;for(R in P("/ExtGState <<"),_t)_t.hasOwnProperty(R)&&_t[R].objectNumber>=0&&P("/"+R+" "+_t[R].objectNumber+" 0 R");Qt.publish("putGStateDict"),P(">>")}})(),(function(){for(var R in P("/XObject <<"),Br)Br.hasOwnProperty(R)&&Br[R].objectNumber>=0&&P("/"+R+" "+Br[R].objectNumber+" 0 R");Qt.publish("putXobjectDict"),P(">>")})(),P(">>"),P("endobj")},rt=function(x){qt[x.fontName]=qt[x.fontName]||{},qt[x.fontName][x.fontStyle]=x.id},nt=function(x,R,oe,be,Ee){var Ge={id:"F"+(Object.keys(Et).length+1).toString(10),postScriptName:x,fontName:R,fontStyle:oe,encoding:be,isStandardFont:Ee||!1,metadata:{}};return Qt.publish("addFont",{font:Ge,instance:this}),Et[Ge.id]=Ge,rt(Ge),Ge.id},ot=u.__private__.pdfEscape=u.pdfEscape=function(x,R){return(function(oe,be){var Ee,Ge,Xe,Nt,Tt,$t,Kt,lr,T;if(Xe=(be=be||{}).sourceEncoding||"Unicode",Tt=be.outputEncoding,(be.autoencode||Tt)&&Et[lt].metadata&&Et[lt].metadata[Xe]&&Et[lt].metadata[Xe].encoding&&(Nt=Et[lt].metadata[Xe].encoding,!Tt&&Et[lt].encoding&&(Tt=Et[lt].encoding),!Tt&&Nt.codePages&&(Tt=Nt.codePages[0]),typeof Tt=="string"&&(Tt=Nt[Tt]),Tt)){for(Kt=!1,$t=[],Ee=0,Ge=oe.length;Ee<Ge;Ee++)(lr=Tt[oe.charCodeAt(Ee)])?$t.push(String.fromCharCode(lr)):$t.push(oe[Ee]),$t[Ee].charCodeAt(0)>>8&&(Kt=!0);oe=$t.join("")}for(Ee=oe.length;Kt===void 0&&Ee!==0;)oe.charCodeAt(Ee-1)>>8&&(Kt=!0),Ee--;if(!Kt)return oe;for($t=be.noBOM?[]:[254,255],Ee=0,Ge=oe.length;Ee<Ge;Ee++){if((T=(lr=oe.charCodeAt(Ee))>>8)>>8)throw new Error("Character at position "+Ee+" of string '"+oe+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");$t.push(T),$t.push(lr-(T<<8))}return String.fromCharCode.apply(void 0,$t)})(x,R).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},At=u.__private__.beginPage=function(x){Me[++Rt]=[],yt[Rt]={objId:0,contentsObjId:0,userUnit:Number(o),artBox:null,bleedBox:null,cropBox:null,trimBox:null,mediaBox:{bottomLeftX:0,bottomLeftY:0,topRightX:Number(x[0]),topRightY:Number(x[1])}},Jt(Rt),j(Me[H])},jt=function(x,R){var oe,be,Ee;switch(e=R||e,typeof x=="string"&&(oe=y(x.toLowerCase()),Array.isArray(oe)&&(be=oe[0],Ee=oe[1])),Array.isArray(x)&&(be=x[0]*bt,Ee=x[1]*bt),isNaN(be)&&(be=i[0],Ee=i[1]),(be>14400||Ee>14400)&&(Ir.warn("A page in a PDF can not be wider or taller than 14400 userUnit. jsPDF limits the width/height to 14400"),be=Math.min(14400,be),Ee=Math.min(14400,Ee)),i=[be,Ee],e.substr(0,1)){case"l":Ee>be&&(i=[Ee,be]);break;case"p":be>Ee&&(i=[Ee,be])}At(i),Vt(Wa),P(sa),Ha!==0&&P(Ha+" J"),Va!==0&&P(Va+" j"),Qt.publish("addPage",{pageNumber:Rt})},Wt=function(x){x>0&&x<=Rt&&(Me.splice(x,1),yt.splice(x,1),Rt--,H>Rt&&(H=Rt),this.setPage(H))},Jt=function(x){x>0&&x<=Rt&&(H=x)},xt=u.__private__.getNumberOfPages=u.getNumberOfPages=function(){return Me.length-1},Ht=function(x,R,oe){var be,Ee=void 0;return oe=oe||{},x=x!==void 0?x:Et[lt].fontName,R=R!==void 0?R:Et[lt].fontStyle,be=x.toLowerCase(),qt[be]!==void 0&&qt[be][R]!==void 0?Ee=qt[be][R]:qt[x]!==void 0&&qt[x][R]!==void 0?Ee=qt[x][R]:oe.disableWarning===!1&&Ir.warn("Unable to look up font label for font '"+x+"', '"+R+"'. Refer to getFontList() for available fonts."),Ee||oe.noFallback||(Ee=qt.times[R])==null&&(Ee=qt.times.normal),Ee},or=u.__private__.putInfo=function(){var x=yr(),R=function(be){return be};for(var oe in p!==null&&(R=Er.encryptor(x,0)),P("<<"),P("/Producer ("+ot(R("jsPDF "+Ut.version))+")"),at)at.hasOwnProperty(oe)&&at[oe]&&P("/"+oe.substr(0,1).toUpperCase()+oe.substr(1)+" ("+ot(R(at[oe]))+")");P("/CreationDate ("+ot(R(te))+")"),P(">>"),P("endobj")},Tn=u.__private__.putCatalog=function(x){var R=(x=x||{}).rootDictionaryObjId||vr;switch(yr(),P("<<"),P("/Type /Catalog"),P("/Pages "+R+" 0 R"),he||(he="fullwidth"),he){case"fullwidth":P("/OpenAction [3 0 R /FitH null]");break;case"fullheight":P("/OpenAction [3 0 R /FitV null]");break;case"fullpage":P("/OpenAction [3 0 R /Fit]");break;case"original":P("/OpenAction [3 0 R /XYZ null null 1]");break;default:var oe=""+he;oe.substr(oe.length-1)==="%"&&(he=parseInt(he)/100),typeof he=="number"&&P("/OpenAction [3 0 R /XYZ null null "+F(he)+"]")}switch(Te||(Te="continuous"),Te){case"continuous":P("/PageLayout /OneColumn");break;case"single":P("/PageLayout /SinglePage");break;case"two":case"twoleft":P("/PageLayout /TwoColumnLeft");break;case"tworight":P("/PageLayout /TwoColumnRight")}Le&&P("/PageMode /"+Le),Qt.publish("putCatalog"),P(">>"),P("endobj")},bs=u.__private__.putTrailer=function(){P("trailer"),P("<<"),P("/Size "+(pe+1)),P("/Root "+pe+" 0 R"),P("/Info "+(pe-1)+" 0 R"),p!==null&&P("/Encrypt "+Er.oid+" 0 R"),P("/ID [ <"+ae+"> <"+ae+"> ]"),P(">>")},Ar=u.__private__.putHeader=function(){P("%PDF-"+w),P("%ÂºÃŸÂ¬Ã ")},Ve=u.__private__.putXRef=function(){var x="0000000000";P("xref"),P("0 "+(pe+1)),P("0000000000 65535 f ");for(var R=1;R<=pe;R++)typeof ve[R]=="function"?P((x+ve[R]()).slice(-10)+" 00000 n "):ve[R]!==void 0?P((x+ve[R]).slice(-10)+" 00000 n "):P("0000000000 00000 n ")},pt=u.__private__.buildDocument=function(){var x;pe=0,Ae=0,ke=[],ve=[],De=[],vr=Lr(),kn=Lr(),j(ke),Qt.publish("buildDocument"),Ar(),ct(),(function(){Qt.publish("putAdditionalObjects");for(var oe=0;oe<De.length;oe++){var be=De[oe];ur(be.objId,!0),P(be.content),P("endobj")}Qt.publish("postPutAdditionalObjects")})(),x=[],(function(){for(var oe in Et)Et.hasOwnProperty(oe)&&(b===!1||b===!0&&m.hasOwnProperty(oe))&&Zr(Et[oe])})(),(function(){var oe;for(oe in _t)_t.hasOwnProperty(oe)&&et(_t[oe])})(),(function(){for(var oe in Br)Br.hasOwnProperty(oe)&&ye(Br[oe])})(),(function(oe){var be;for(be in vt)vt.hasOwnProperty(be)&&(vt[be]instanceof ti?qe(vt[be]):vt[be]instanceof Li&&He(vt[be],oe))})(x),Qt.publish("putResources"),x.forEach(it),it({resourcesOid:kn,objectOid:Number.MAX_SAFE_INTEGER}),Qt.publish("postPutResources"),p!==null&&(Er.oid=yr(),P("<<"),P("/Filter /Standard"),P("/V "+Er.v),P("/R "+Er.r),P("/U <"+Er.toHexString(Er.U)+">"),P("/O <"+Er.toHexString(Er.O)+">"),P("/P "+Er.P),P(">>"),P("endobj")),or(),Tn();var R=Ae;return Ve(),bs(),P("startxref"),P(""+R),P("%%EOF"),j(Me[H]),ke.join(`
`)},hr=u.__private__.getBlob=function(x){return new Blob([$(x)],{type:"application/pdf"})},Vr=u.output=u.__private__.output=(Wr=function(x,R){switch(typeof(R=R||{})=="string"?R={filename:R}:R.filename=R.filename||"generated.pdf",x){case void 0:return pt();case"save":u.save(R.filename);break;case"arraybuffer":return $(pt());case"blob":return hr(pt());case"bloburi":case"bloburl":if(Gt.URL!==void 0&&typeof Gt.URL.createObjectURL=="function")return Gt.URL&&Gt.URL.createObjectURL(hr(pt()))||void 0;Ir.warn("bloburl is not supported by your system, because URL.createObjectURL is not supported by your browser.");break;case"datauristring":case"dataurlstring":var oe="",be=pt();try{oe=Fu(be)}catch{oe=Fu(unescape(encodeURIComponent(be)))}return"data:application/pdf;filename="+R.filename+";base64,"+oe;case"pdfobjectnewwindow":if(Object.prototype.toString.call(Gt)==="[object Window]"){var Ee="https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.1.1/pdfobject.min.js",Ge=' integrity="sha512-4ze/a9/4jqu+tX9dfOqJYSvyYd5M6qum/3HpCLr+/Jqf0whc37VUbkpNGHR7/8pSnCFw47T1fmIpwBV7UySh3g==" crossorigin="anonymous"';R.pdfObjectUrl&&(Ee=R.pdfObjectUrl,Ge="");var Xe='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><script src="'+Ee+'"'+Ge+'><\/script><script >PDFObject.embed("'+this.output("dataurlstring")+'", '+JSON.stringify(R)+");<\/script></body></html>",Nt=Gt.open();return Nt!==null&&Nt.document.write(Xe),Nt}throw new Error("The option pdfobjectnewwindow just works in a browser-environment.");case"pdfjsnewwindow":if(Object.prototype.toString.call(Gt)==="[object Window]"){var Tt='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe id="pdfViewer" src="'+(R.pdfJsUrl||"examples/PDF.js/web/viewer.html")+"?file=&downloadName="+R.filename+'" width="500px" height="400px" /></body></html>',$t=Gt.open();if($t!==null){$t.document.write(Tt);var Kt=this;$t.document.documentElement.querySelector("#pdfViewer").onload=function(){$t.document.title=R.filename,$t.document.documentElement.querySelector("#pdfViewer").contentWindow.PDFViewerApplication.open(Kt.output("bloburl"))}}return $t}throw new Error("The option pdfjsnewwindow just works in a browser-environment.");case"dataurlnewwindow":if(Object.prototype.toString.call(Gt)!=="[object Window]")throw new Error("The option dataurlnewwindow just works in a browser-environment.");var lr='<html><style>html, body { padding: 0; margin: 0; } iframe { width: 100%; height: 100%; border: 0;}  </style><body><iframe src="'+this.output("datauristring",R)+'"></iframe></body></html>',T=Gt.open();if(T!==null&&(T.document.write(lr),T.document.title=R.filename),T||typeof safari>"u")return T;break;case"datauri":case"dataurl":return Gt.document.location.href=this.output("datauristring",R);default:return null}},Wr.foo=function(){try{return Wr.apply(this,arguments)}catch(oe){var x=oe.stack||"";~x.indexOf(" at ")&&(x=x.split(" at ")[1]);var R="Error in function "+x.split(`
`)[0].split("<")[0]+": "+oe.message;if(!Gt.console)throw new Error(R);Gt.console.error(R,oe),Gt.alert&&alert(R)}},Wr.foo.bar=Wr,Wr.foo),zr=function(x){return Array.isArray(tr)===!0&&tr.indexOf(x)>-1};switch(s){case"pt":bt=1;break;case"mm":bt=72/25.4;break;case"cm":bt=72/2.54;break;case"in":bt=72;break;case"px":bt=zr("px_scaling")==1?.75:96/72;break;case"pc":case"em":bt=12;break;case"ex":bt=6;break;default:if(typeof s!="number")throw new Error("Invalid unit: "+s);bt=s}var Er=null;ne(),se();var Jn=u.__private__.getPageInfo=u.getPageInfo=function(x){if(isNaN(x)||x%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfo");return{objId:yt[x].objId,pageNumber:x,pageContext:yt[x]}},ba=u.__private__.getPageInfoByObjId=function(x){if(isNaN(x)||x%1!=0)throw new Error("Invalid argument passed to jsPDF.getPageInfoByObjId");for(var R in yt)if(yt[R].objId===x)break;return Jn(R)},Kr=u.__private__.getCurrentPageInfo=u.getCurrentPageInfo=function(){return{objId:yt[H].objId,pageNumber:H,pageContext:yt[H]}};u.addPage=function(){return jt.apply(this,arguments),this},u.setPage=function(){return Jt.apply(this,arguments),j.call(this,Me[H]),this},u.insertPage=function(x){return this.addPage(),this.movePage(H,x),this},u.movePage=function(x,R){var oe,be;if(x>R){oe=Me[x],be=yt[x];for(var Ee=x;Ee>R;Ee--)Me[Ee]=Me[Ee-1],yt[Ee]=yt[Ee-1];Me[R]=oe,yt[R]=be,this.setPage(R)}else if(x<R){oe=Me[x],be=yt[x];for(var Ge=x;Ge<R;Ge++)Me[Ge]=Me[Ge+1],yt[Ge]=yt[Ge+1];Me[R]=oe,yt[R]=be,this.setPage(R)}return this},u.deletePage=function(){return Wt.apply(this,arguments),this},u.__private__.text=u.text=function(x,R,oe,be,Ee){var Ge,Xe,Nt,Tt,$t,Kt,lr,T,ue,ge=(be=be||{}).scope||this;if(typeof x=="number"&&typeof R=="number"&&(typeof oe=="string"||Array.isArray(oe))){var xe=oe;oe=R,R=x,x=xe}if(arguments[3]instanceof zt==0?(Nt=arguments[4],Tt=arguments[5],Cr(lr=arguments[3])==="object"&&lr!==null||(typeof Nt=="string"&&(Tt=Nt,Nt=null),typeof lr=="string"&&(Tt=lr,lr=null),typeof lr=="number"&&(Nt=lr,lr=null),be={flags:lr,angle:Nt,align:Tt})):(O("The transform parameter of text() with a Matrix value"),ue=Ee),isNaN(R)||isNaN(oe)||x==null)throw new Error("Invalid arguments passed to jsPDF.text");if(x.length===0)return ge;var fe,Ne="",Fe=typeof be.lineHeightFactor=="number"?be.lineHeightFactor:Cs,$e=ge.internal.scaleFactor;function Ze(wr){return wr=wr.split("	").join(Array(be.TabLen||9).join(" ")),ot(wr,lr)}function ht(wr){for(var Pr,an=wr.concat(),gn=[],da=an.length;da--;)typeof(Pr=an.shift())=="string"?gn.push(Pr):Array.isArray(wr)&&(Pr.length===1||Pr[1]===void 0&&Pr[2]===void 0)?gn.push(Pr[0]):gn.push([Pr[0],Pr[1],Pr[2]]);return gn}function Qe(wr,Pr){var an;if(typeof wr=="string")an=Pr(wr)[0];else if(Array.isArray(wr)){for(var gn,da,Xi=wr.concat(),wi=[],bo=Xi.length;bo--;)typeof(gn=Xi.shift())=="string"?wi.push(Pr(gn)[0]):Array.isArray(gn)&&typeof gn[0]=="string"&&(da=Pr(gn[0],gn[1],gn[2]),wi.push([da[0],da[1],da[2]]));an=wi}return an}var dt=!1,we=!0;if(typeof x=="string")dt=!0;else if(Array.isArray(x)){var wt=x.concat();Xe=[];for(var St,rr=wt.length;rr--;)(typeof(St=wt.shift())!="string"||Array.isArray(St)&&typeof St[0]!="string")&&(we=!1);dt=we}if(dt===!1)throw new Error('Type of text must be string or Array. "'+x+'" is not recognized.');typeof x=="string"&&(x=x.match(/[\r?\n]/)?x.split(/\r\n|\r|\n/g):[x]);var Nr=B/ge.internal.scaleFactor,Dt=Nr*(Fe-1);switch(be.baseline){case"bottom":oe-=Dt;break;case"top":oe+=Nr-Dt;break;case"hanging":oe+=Nr-2*Dt;break;case"middle":oe+=Nr/2-Dt}if((Kt=be.maxWidth||0)>0&&(typeof x=="string"?x=ge.splitTextToSize(x,Kt):Object.prototype.toString.call(x)==="[object Array]"&&(x=x.reduce(function(wr,Pr){return wr.concat(ge.splitTextToSize(Pr,Kt))},[]))),Ge={text:x,x:R,y:oe,options:be,mutex:{pdfEscape:ot,activeFontKey:lt,fonts:Et,activeFontSize:B}},Qt.publish("preProcessText",Ge),x=Ge.text,Nt=(be=Ge.options).angle,ue instanceof zt==0&&Nt&&typeof Nt=="number"){Nt*=Math.PI/180,be.rotationDirection===0&&(Nt=-Nt),E===L&&(Nt=-Nt);var br=Math.cos(Nt),_r=Math.sin(Nt);ue=new zt(br,_r,-_r,br,0,0)}else Nt&&Nt instanceof zt&&(ue=Nt);E!==L||ue||(ue=vn),($t=be.charSpace||vs)!==void 0&&(Ne+=V(M($t))+` Tc
`,this.setCharSpace(this.getCharSpace()||0)),(T=be.horizontalScale)!==void 0&&(Ne+=V(100*T)+` Tz
`),be.lang;var mr=-1,gr=be.renderingMode!==void 0?be.renderingMode:be.stroke,Un=ge.internal.getCurrentPageInfo().pageContext;switch(gr){case 0:case!1:case"fill":mr=0;break;case 1:case!0:case"stroke":mr=1;break;case 2:case"fillThenStroke":mr=2;break;case 3:case"invisible":mr=3;break;case 4:case"fillAndAddForClipping":mr=4;break;case 5:case"strokeAndAddPathForClipping":mr=5;break;case 6:case"fillThenStrokeAndAddToPathForClipping":mr=6;break;case 7:case"addToPathForClipping":mr=7}var zn=Un.usedRenderingMode!==void 0?Un.usedRenderingMode:-1;mr!==-1?Ne+=mr+` Tr
`:zn!==-1&&(Ne+=`0 Tr
`),mr!==-1&&(Un.usedRenderingMode=mr),Tt=be.align||"left";var nr,xr=B*Fe,la=ge.internal.pageSize.getWidth(),Vi=Et[lt];$t=be.charSpace||vs,Kt=be.maxWidth||0,lr=Object.assign({autoencode:!0,noBOM:!0},be.flags);var ka=[],Za=function(wr){return ge.getStringUnitWidth(wr,{font:Vi,charSpace:$t,fontSize:B,doKerning:!1})*B/$e};if(Object.prototype.toString.call(x)==="[object Array]"){var as;Xe=ht(x),Tt!=="left"&&(nr=Xe.map(Za));var is,Ca=0;if(Tt==="right"){R-=nr[0],x=[],rr=Xe.length;for(var ca=0;ca<rr;ca++)ca===0?(is=As(R),as=ws(oe)):(is=M(Ca-nr[ca]),as=-xr),x.push([Xe[ca],is,as]),Ca=nr[ca]}else if(Tt==="center"){R-=nr[0]/2,x=[],rr=Xe.length;for(var Aa=0;Aa<rr;Aa++)Aa===0?(is=As(R),as=ws(oe)):(is=M((Ca-nr[Aa])/2),as=-xr),x.push([Xe[Aa],is,as]),Ca=nr[Aa]}else if(Tt==="left"){x=[],rr=Xe.length;for(var Gi=0;Gi<rr;Gi++)x.push(Xe[Gi])}else if(Tt==="justify"&&Vi.encoding==="Identity-H"){x=[],rr=Xe.length,Kt=Kt!==0?Kt:la;for(var bi=0,sn=0;sn<rr;sn++)if(as=sn===0?ws(oe):-xr,is=sn===0?As(R):bi,sn<rr-1){var yo=M((Kt-nr[sn])/(Xe[sn].split(" ").length-1)),Vs=Xe[sn].split(" ");x.push([Vs[0]+" ",is,as]),bi=0;for(var Gs=1;Gs<Vs.length;Gs++){var Yi=(Za(Vs[Gs-1]+" "+Vs[Gs])-Za(Vs[Gs]))*$e+yo;Gs==Vs.length-1?x.push([Vs[Gs],Yi,0]):x.push([Vs[Gs]+" ",Yi,0]),bi-=Yi}}else x.push([Xe[sn],is,as]);x.push(["",bi,0])}else{if(Tt!=="justify")throw new Error('Unrecognized alignment option, use "left", "center", "right" or "justify".');for(x=[],rr=Xe.length,Kt=Kt!==0?Kt:la,sn=0;sn<rr;sn++){as=sn===0?ws(oe):-xr,is=sn===0?As(R):0;var Ji=Xe[sn].split(" ").length-1,Zi=Ji>0?(Kt-nr[sn])/Ji:0;sn<rr-1?ka.push(V(M(Zi))):ka.push(0),x.push([Xe[sn],is,as])}}}(typeof be.R2L=="boolean"?be.R2L:de)===!0&&(x=Qe(x,function(wr,Pr,an){return[wr.split("").reverse().join(""),Pr,an]})),Ge={text:x,x:R,y:oe,options:be,mutex:{pdfEscape:ot,activeFontKey:lt,fonts:Et,activeFontSize:B}},Qt.publish("postProcessText",Ge),x=Ge.text,fe=Ge.mutex.isHex||!1;var Ki=Et[lt].encoding;Ki!=="WinAnsiEncoding"&&Ki!=="StandardEncoding"||(x=Qe(x,function(wr,Pr,an){return[Ze(wr),Pr,an]})),Xe=ht(x),x=[];for(var La,Ea,Pa,Ka=Array.isArray(Xe[0])?1:0,Ta="",Xa=function(wr,Pr,an){var gn="";return an instanceof zt?(an=typeof be.angle=="number"?mn(an,new zt(1,0,0,1,wr,Pr)):mn(new zt(1,0,0,1,wr,Pr),an),E===L&&(an=mn(new zt(1,0,0,-1,0,0),an)),gn=an.join(" ")+` Tm
`):gn=V(wr)+" "+V(Pr)+` Td
`,gn},Ns=0;Ns<Xe.length;Ns++){switch(Ta="",Ka){case 1:Pa=(fe?"<":"(")+Xe[Ns][0]+(fe?">":")"),La=parseFloat(Xe[Ns][1]),Ea=parseFloat(Xe[Ns][2]);break;case 0:Pa=(fe?"<":"(")+Xe[Ns]+(fe?">":")"),La=As(R),Ea=ws(oe)}ka!==void 0&&ka[Ns]!==void 0&&(Ta=ka[Ns]+` Tw
`),Ns===0?x.push(Ta+Xa(La,Ea,ue)+Pa):Ka===0?x.push(Ta+Pa):Ka===1&&x.push(Ta+Xa(La,Ea,ue)+Pa)}x=Ka===0?x.join(` Tj
T* `):x.join(` Tj
`),x+=` Tj
`;var Ys=`BT
/`;return Ys+=lt+" "+B+` Tf
`,Ys+=V(B*Fe)+` TL
`,Ys+=aa+`
`,Ys+=Ne,Ys+=x,P(Ys+="ET"),m[lt]=!0,ge};var wa=u.__private__.clip=u.clip=function(x){return P(x==="evenodd"?"W*":"W"),this};u.clipEvenOdd=function(){return wa("evenodd")},u.__private__.discardPath=u.discardPath=function(){return P("n"),this};var Fr=u.__private__.isValidStyle=function(x){var R=!1;return[void 0,null,"S","D","F","DF","FD","f","f*","B","B*","n"].indexOf(x)!==-1&&(R=!0),R};u.__private__.setDefaultPathOperation=u.setDefaultPathOperation=function(x){return Fr(x)&&(h=x),this};var va=u.__private__.getStyle=u.getStyle=function(x){var R=h;switch(x){case"D":case"S":R="S";break;case"F":R="f";break;case"FD":case"DF":R="B";break;case"f":case"f*":case"B":case"B*":R=x}return R},Na=u.close=function(){return P("h"),this};u.stroke=function(){return P("S"),this},u.fill=function(x){return Ws("f",x),this},u.fillEvenOdd=function(x){return Ws("f*",x),this},u.fillStroke=function(x){return Ws("B",x),this},u.fillStrokeEvenOdd=function(x){return Ws("B*",x),this};var Ws=function(x,R){Cr(R)==="object"?ci(R,x):P(x)},Hs=function(x){x===null||E===L&&x===void 0||(x=va(x),P(x))};function $a(x,R,oe,be,Ee){var Ge=new Li(R||this.boundingBox,oe||this.xStep,be||this.yStep,this.gState,Ee||this.matrix);Ge.stream=this.stream;var Xe=x+"$$"+this.cloneIndex+++"$$";return Yr(Xe,Ge),Ge}var ci=function(x,R){var oe=Zt[x.key],be=vt[oe];if(be instanceof ti)P("q"),P(na(R)),be.gState&&u.setGState(be.gState),P(x.matrix.toString()+" cm"),P("/"+oe+" sh"),P("Q");else if(be instanceof Li){var Ee=new zt(1,0,0,-1,0,ss());x.matrix&&(Ee=Ee.multiply(x.matrix||vn),oe=$a.call(be,x.key,x.boundingBox,x.xStep,x.yStep,Ee).id),P("q"),P("/Pattern cs"),P("/"+oe+" scn"),be.gState&&u.setGState(be.gState),P(R),P("Q")}},na=function(x){switch(x){case"f":case"F":case"n":return"W n";case"f*":return"W* n";case"B":case"S":return"W S";case"B*":return"W* S"}},_a=u.moveTo=function(x,R){return P(V(M(x))+" "+V(_(R))+" m"),this},di=u.lineTo=function(x,R){return P(V(M(x))+" "+V(_(R))+" l"),this},Mn=u.curveTo=function(x,R,oe,be,Ee,Ge){return P([V(M(x)),V(_(R)),V(M(oe)),V(_(be)),V(M(Ee)),V(_(Ge)),"c"].join(" ")),this};u.__private__.line=u.line=function(x,R,oe,be,Ee){if(isNaN(x)||isNaN(R)||isNaN(oe)||isNaN(be)||!Fr(Ee))throw new Error("Invalid arguments passed to jsPDF.line");return E===S?this.lines([[oe-x,be-R]],x,R,[1,1],Ee||"S"):this.lines([[oe-x,be-R]],x,R,[1,1]).stroke()},u.__private__.lines=u.lines=function(x,R,oe,be,Ee,Ge){var Xe,Nt,Tt,$t,Kt,lr,T,ue,ge,xe,fe,Ne;if(typeof x=="number"&&(Ne=oe,oe=R,R=x,x=Ne),be=be||[1,1],Ge=Ge||!1,isNaN(R)||isNaN(oe)||!Array.isArray(x)||!Array.isArray(be)||!Fr(Ee)||typeof Ge!="boolean")throw new Error("Invalid arguments passed to jsPDF.lines");for(_a(R,oe),Xe=be[0],Nt=be[1],$t=x.length,xe=R,fe=oe,Tt=0;Tt<$t;Tt++)(Kt=x[Tt]).length===2?(xe=Kt[0]*Xe+xe,fe=Kt[1]*Nt+fe,di(xe,fe)):(lr=Kt[0]*Xe+xe,T=Kt[1]*Nt+fe,ue=Kt[2]*Xe+xe,ge=Kt[3]*Nt+fe,xe=Kt[4]*Xe+xe,fe=Kt[5]*Nt+fe,Mn(lr,T,ue,ge,xe,fe));return Ge&&Na(),Hs(Ee),this},u.path=function(x){for(var R=0;R<x.length;R++){var oe=x[R],be=oe.c;switch(oe.op){case"m":_a(be[0],be[1]);break;case"l":di(be[0],be[1]);break;case"c":Mn.apply(this,be);break;case"h":Na()}}return this},u.__private__.rect=u.rect=function(x,R,oe,be,Ee){if(isNaN(x)||isNaN(R)||isNaN(oe)||isNaN(be)||!Fr(Ee))throw new Error("Invalid arguments passed to jsPDF.rect");return E===S&&(be=-be),P([V(M(x)),V(_(R)),V(M(oe)),V(M(be)),"re"].join(" ")),Hs(Ee),this},u.__private__.triangle=u.triangle=function(x,R,oe,be,Ee,Ge,Xe){if(isNaN(x)||isNaN(R)||isNaN(oe)||isNaN(be)||isNaN(Ee)||isNaN(Ge)||!Fr(Xe))throw new Error("Invalid arguments passed to jsPDF.triangle");return this.lines([[oe-x,be-R],[Ee-oe,Ge-be],[x-Ee,R-Ge]],x,R,[1,1],Xe,!0),this},u.__private__.roundedRect=u.roundedRect=function(x,R,oe,be,Ee,Ge,Xe){if(isNaN(x)||isNaN(R)||isNaN(oe)||isNaN(be)||isNaN(Ee)||isNaN(Ge)||!Fr(Xe))throw new Error("Invalid arguments passed to jsPDF.roundedRect");var Nt=4/3*(Math.SQRT2-1);return Ee=Math.min(Ee,.5*oe),Ge=Math.min(Ge,.5*be),this.lines([[oe-2*Ee,0],[Ee*Nt,0,Ee,Ge-Ge*Nt,Ee,Ge],[0,be-2*Ge],[0,Ge*Nt,-Ee*Nt,Ge,-Ee,Ge],[2*Ee-oe,0],[-Ee*Nt,0,-Ee,-Ge*Nt,-Ee,-Ge],[0,2*Ge-be],[0,-Ge*Nt,Ee*Nt,-Ge,Ee,-Ge]],x+Ee,R,[1,1],Xe,!0),this},u.__private__.ellipse=u.ellipse=function(x,R,oe,be,Ee){if(isNaN(x)||isNaN(R)||isNaN(oe)||isNaN(be)||!Fr(Ee))throw new Error("Invalid arguments passed to jsPDF.ellipse");var Ge=4/3*(Math.SQRT2-1)*oe,Xe=4/3*(Math.SQRT2-1)*be;return _a(x+oe,R),Mn(x+oe,R-Xe,x+Ge,R-be,x,R-be),Mn(x-Ge,R-be,x-oe,R-Xe,x-oe,R),Mn(x-oe,R+Xe,x-Ge,R+be,x,R+be),Mn(x+Ge,R+be,x+oe,R+Xe,x+oe,R),Hs(Ee),this},u.__private__.circle=u.circle=function(x,R,oe,be){if(isNaN(x)||isNaN(R)||isNaN(oe)||!Fr(be))throw new Error("Invalid arguments passed to jsPDF.circle");return this.ellipse(x,R,oe,oe,be)},u.setFont=function(x,R,oe){return oe&&(R=Y(R,oe)),lt=Ht(x,R,{disableWarning:!1}),this};var ui=u.__private__.getFont=u.getFont=function(){return Et[Ht.apply(u,arguments)]};u.__private__.getFontList=u.getFontList=function(){var x,R,oe={};for(x in qt)if(qt.hasOwnProperty(x))for(R in oe[x]=[],qt[x])qt[x].hasOwnProperty(R)&&oe[x].push(R);return oe},u.addFont=function(x,R,oe,be,Ee){var Ge=["StandardEncoding","MacRomanEncoding","Identity-H","WinAnsiEncoding"];return arguments[3]&&Ge.indexOf(arguments[3])!==-1?Ee=arguments[3]:arguments[3]&&Ge.indexOf(arguments[3])==-1&&(oe=Y(oe,be)),nt.call(this,x,R,oe,Ee=Ee||"Identity-H")};var Cs,Wa=r.lineWidth||.200025,hi=u.__private__.getLineWidth=u.getLineWidth=function(){return Wa},Vt=u.__private__.setLineWidth=u.setLineWidth=function(x){return Wa=x,P(V(M(x))+" w"),this};u.__private__.setLineDash=Ut.API.setLineDash=Ut.API.setLineDashPattern=function(x,R){if(x=x||[],R=R||0,isNaN(R)||!Array.isArray(x))throw new Error("Invalid arguments passed to jsPDF.setLineDash");return x=x.map(function(oe){return V(M(oe))}).join(" "),R=V(M(R)),P("["+x+"] "+R+" d"),this};var fi=u.__private__.getLineHeight=u.getLineHeight=function(){return B*Cs};u.__private__.getLineHeight=u.getLineHeight=function(){return B*Cs};var pi=u.__private__.setLineHeightFactor=u.setLineHeightFactor=function(x){return typeof(x=x||1.15)=="number"&&(Cs=x),this},zi=u.__private__.getLineHeightFactor=u.getLineHeightFactor=function(){return Cs};pi(r.lineHeight);var As=u.__private__.getHorizontalCoordinate=function(x){return M(x)},ws=u.__private__.getVerticalCoordinate=function(x){return E===L?x:yt[H].mediaBox.topRightY-yt[H].mediaBox.bottomLeftY-M(x)},qi=u.__private__.getHorizontalCoordinateString=u.getHorizontalCoordinateString=function(x){return V(As(x))},$i=u.__private__.getVerticalCoordinateString=u.getVerticalCoordinateString=function(x){return V(ws(x))},sa=r.strokeColor||"0 G";u.__private__.getStrokeColor=u.getDrawColor=function(){return nn(sa)},u.__private__.setStrokeColor=u.setDrawColor=function(x,R,oe,be){return sa=Cn({ch1:x,ch2:R,ch3:oe,ch4:be,pdfColorType:"draw",precision:2}),P(sa),this};var ja=r.fillColor||"0 g";u.__private__.getFillColor=u.getFillColor=function(){return nn(ja)},u.__private__.setFillColor=u.setFillColor=function(x,R,oe,be){return ja=Cn({ch1:x,ch2:R,ch3:oe,ch4:be,pdfColorType:"fill",precision:2}),P(ja),this};var aa=r.textColor||"0 g",Wi=u.__private__.getTextColor=u.getTextColor=function(){return nn(aa)};u.__private__.setTextColor=u.setTextColor=function(x,R,oe,be){return aa=Cn({ch1:x,ch2:R,ch3:oe,ch4:be,pdfColorType:"text",precision:3}),this};var vs=r.charSpace,Hi=u.__private__.getCharSpace=u.getCharSpace=function(){return parseFloat(vs||0)};u.__private__.setCharSpace=u.setCharSpace=function(x){if(isNaN(x))throw new Error("Invalid argument passed to jsPDF.setCharSpace");return vs=x,this};var Ha=0;u.CapJoinStyles={0:0,butt:0,but:0,miter:0,1:1,round:1,rounded:1,circle:1,2:2,projecting:2,project:2,square:2,bevel:2},u.__private__.setLineCap=u.setLineCap=function(x){var R=u.CapJoinStyles[x];if(R===void 0)throw new Error("Line cap style of '"+x+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Ha=R,P(R+" J"),this};var Va=0;u.__private__.setLineJoin=u.setLineJoin=function(x){var R=u.CapJoinStyles[x];if(R===void 0)throw new Error("Line join style of '"+x+"' is not recognized. See or extend .CapJoinStyles property for valid styles");return Va=R,P(R+" j"),this},u.__private__.setLineMiterLimit=u.__private__.setMiterLimit=u.setLineMiterLimit=u.setMiterLimit=function(x){if(x=x||0,isNaN(x))throw new Error("Invalid argument passed to jsPDF.setLineMiterLimit");return P(V(M(x))+" M"),this},u.GState=pl,u.setGState=function(x){(x=typeof x=="string"?_t[Ot[x]]:mi(null,x)).equals(ir)||(P("/"+x.id+" gs"),ir=x)};var mi=function(x,R){if(!x||!Ot[x]){var oe=!1;for(var be in _t)if(_t.hasOwnProperty(be)&&_t[be].equals(R)){oe=!0;break}if(oe)R=_t[be];else{var Ee="GS"+(Object.keys(_t).length+1).toString(10);_t[Ee]=R,R.id=Ee}return x&&(Ot[x]=R.id),Qt.publish("addGState",R),R}};u.addGState=function(x,R){return mi(x,R),this},u.saveGraphicsState=function(){return P("q"),Pt.push({key:lt,size:B,color:aa}),this},u.restoreGraphicsState=function(){P("Q");var x=Pt.pop();return lt=x.key,B=x.size,aa=x.color,ir=null,this},u.setCurrentTransformationMatrix=function(x){return P(x.toString()+" cm"),this},u.comment=function(x){return P("#"+x),this};var Zn=function(x,R){var oe=x||0;Object.defineProperty(this,"x",{enumerable:!0,get:function(){return oe},set:function(Ge){isNaN(Ge)||(oe=parseFloat(Ge))}});var be=R||0;Object.defineProperty(this,"y",{enumerable:!0,get:function(){return be},set:function(Ge){isNaN(Ge)||(be=parseFloat(Ge))}});var Ee="pt";return Object.defineProperty(this,"type",{enumerable:!0,get:function(){return Ee},set:function(Ge){Ee=Ge.toString()}}),this},Ga=function(x,R,oe,be){Zn.call(this,x,R),this.type="rect";var Ee=oe||0;Object.defineProperty(this,"w",{enumerable:!0,get:function(){return Ee},set:function(Xe){isNaN(Xe)||(Ee=parseFloat(Xe))}});var Ge=be||0;return Object.defineProperty(this,"h",{enumerable:!0,get:function(){return Ge},set:function(Xe){isNaN(Xe)||(Ge=parseFloat(Xe))}}),this},ia=function(){this.page=Rt,this.currentPage=H,this.pages=Me.slice(0),this.pagesContext=yt.slice(0),this.x=ut,this.y=Yt,this.matrix=gt,this.width=Ja(H),this.height=gi(H),this.outputDestination=Se,this.id="",this.objectNumber=-1};ia.prototype.restore=function(){Rt=this.page,H=this.currentPage,yt=this.pagesContext,Me=this.pages,ut=this.x,Yt=this.y,gt=this.matrix,Sa(H,this.width),Ls(H,this.height),Se=this.outputDestination};var Ya=function(x,R,oe,be,Ee){rn.push(new ia),Rt=H=0,Me=[],ut=x,Yt=R,gt=Ee,At([oe,be])};for(var oa in u.beginFormObject=function(x,R,oe,be,Ee){return Ya(x,R,oe,be,Ee),this},u.endFormObject=function(x){return(function(R){if(wn[R])rn.pop().restore();else{var oe=new ia,be="Xo"+(Object.keys(Br).length+1).toString(10);oe.id=be,wn[R]=be,Br[be]=oe,Qt.publish("addFormObject",oe),rn.pop().restore()}})(x),this},u.doFormObject=function(x,R){var oe=Br[wn[x]];return P("q"),P(R.toString()+" cm"),P("/"+oe.id+" Do"),P("Q"),this},u.getFormObject=function(x){var R=Br[wn[x]];return{x:R.x,y:R.y,width:R.width,height:R.height,matrix:R.matrix}},u.save=function(x,R){return x=x||"generated.pdf",(R=R||{}).returnPromise=R.returnPromise||!1,R.returnPromise===!1?(ei(hr(pt()),x),typeof ei.unload=="function"&&Gt.setTimeout&&setTimeout(ei.unload,911),this):new Promise(function(oe,be){try{var Ee=ei(hr(pt()),x);typeof ei.unload=="function"&&Gt.setTimeout&&setTimeout(ei.unload,911),oe(Ee)}catch(Ge){be(Ge.message)}})},Ut.API)Ut.API.hasOwnProperty(oa)&&(oa==="events"&&Ut.API.events.length?(function(x,R){var oe,be,Ee;for(Ee=R.length-1;Ee!==-1;Ee--)oe=R[Ee][0],be=R[Ee][1],x.subscribe.apply(x,[oe].concat(typeof be=="function"?[be]:be))})(Qt,Ut.API.events):u[oa]=Ut.API[oa]);function Ja(x){return yt[x].mediaBox.topRightX-yt[x].mediaBox.bottomLeftX}function Sa(x,R){yt[x].mediaBox.topRightX=R+yt[x].mediaBox.bottomLeftX}function gi(x){return yt[x].mediaBox.topRightY-yt[x].mediaBox.bottomLeftY}function Ls(x,R){yt[x].mediaBox.topRightY=R+yt[x].mediaBox.bottomLeftY}var Es=u.getPageWidth=function(x){return Ja(x=x||H)/bt},xi=u.setPageWidth=function(x,R){Sa(x,R*bt)},ss=u.getPageHeight=function(x){return gi(x=x||H)/bt},yi=u.setPageHeight=function(x,R){Ls(x,R*bt)};return u.internal={pdfEscape:ot,getStyle:va,getFont:ui,getFontSize:me,getCharSpace:Hi,getTextColor:Wi,getLineHeight:fi,getLineHeightFactor:zi,getLineWidth:hi,write:G,getHorizontalCoordinate:As,getVerticalCoordinate:ws,getCoordinateString:qi,getVerticalCoordinateString:$i,collections:{},newObject:yr,newAdditionalObject:ns,newObjectDeferred:Lr,newObjectDeferredBegin:ur,getFilters:Hr,putStream:Jr,events:Qt,scaleFactor:bt,pageSize:{getWidth:function(){return Es(H)},setWidth:function(x){xi(H,x)},getHeight:function(){return ss(H)},setHeight:function(x){yi(H,x)}},encryptionOptions:p,encryption:Er,getEncryptor:function(x){return p!==null?Er.encryptor(x,0):function(R){return R}},output:Vr,getNumberOfPages:xt,get pages(){return Me},out:P,f2:F,f3:k,getPageInfo:Jn,getPageInfoByObjId:ba,getCurrentPageInfo:Kr,getPDFVersion:g,Point:Zn,Rectangle:Ga,Matrix:zt,hasHotfix:zr},Object.defineProperty(u.internal.pageSize,"width",{get:function(){return Es(H)},set:function(x){xi(H,x)},enumerable:!0,configurable:!0}),Object.defineProperty(u.internal.pageSize,"height",{get:function(){return ss(H)},set:function(x){yi(H,x)},enumerable:!0,configurable:!0}),(function(x){for(var R=0,oe=z.length;R<oe;R++){var be=nt.call(this,x[R][0],x[R][1],x[R][2],z[R][3],!0);b===!1&&(m[be]=!0);var Ee=x[R][0].split("-");rt({id:be,fontName:Ee[0],fontStyle:Ee[1]||""})}Qt.publish("addFonts",{fonts:Et,dictionary:qt})}).call(u,z),lt="F1",jt(i,e),Qt.publish("initialized"),u}ki.prototype.lsbFirstWord=function(r){return String.fromCharCode(255&r,r>>8&255,r>>16&255,r>>24&255)},ki.prototype.toHexString=function(r){return r.split("").map(function(t){return("0"+(255&t.charCodeAt(0)).toString(16)).slice(-2)}).join("")},ki.prototype.hexToBytes=function(r){for(var t=[],e=0;e<r.length;e+=2)t.push(String.fromCharCode(parseInt(r.substr(e,2),16)));return t.join("")},ki.prototype.processOwnerPassword=function(r,t){return Cc(kc(t).substr(0,5),r)},ki.prototype.encryptor=function(r,t){var e=kc(this.encryptionKey+String.fromCharCode(255&r,r>>8&255,r>>16&255,255&t,t>>8&255)).substr(0,10);return function(s){return Cc(e,s)}},pl.prototype.equals=function(r){var t,e="id,objectNumber,equals";if(!r||Cr(r)!==Cr(this))return!1;var s=0;for(t in this)if(!(e.indexOf(t)>=0)){if(this.hasOwnProperty(t)&&!r.hasOwnProperty(t)||this[t]!==r[t])return!1;s++}for(t in r)r.hasOwnProperty(t)&&e.indexOf(t)<0&&s--;return s===0},Ut.API={events:[]},Ut.version="4.0.0";var tn=Ut.API,Gc=1,li=function(r){return r.replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)")},ji=function(r){return r.replace(/\\\\/g,"\\").replace(/\\\(/g,"(").replace(/\\\)/g,")")},Xt=function(r){return r.toFixed(2)},Ua=function(r){return r.toFixed(5)};tn.__acroform__={};var rs=function(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r},Bu=function(r){return r*Gc},Ks=function(r){var t=new Wf,e=Lt.internal.getHeight(r)||0,s=Lt.internal.getWidth(r)||0;return t.BBox=[0,0,Number(Xt(s)),Number(Xt(e))],t},Z1=tn.__acroform__.setBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBit");return r|1<<t},K1=tn.__acroform__.clearBit=function(r,t){if(r=r||0,t=t||0,isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBit");return r&~(1<<t)},X1=tn.__acroform__.getBit=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBit");return r&1<<t?1:0},hn=tn.__acroform__.getBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.getBitForPdf");return X1(r,t-1)},fn=tn.__acroform__.setBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.setBitForPdf");return Z1(r,t-1)},pn=tn.__acroform__.clearBitForPdf=function(r,t){if(isNaN(r)||isNaN(t))throw new Error("Invalid arguments passed to jsPDF.API.__acroform__.clearBitForPdf");return K1(r,t-1)},Q1=tn.__acroform__.calculateCoordinates=function(r,t){var e=t.internal.getHorizontalCoordinate,s=t.internal.getVerticalCoordinate,i=r[0],a=r[1],d=r[2],o=r[3],c={};return c.lowerLeft_X=e(i)||0,c.lowerLeft_Y=s(a+o)||0,c.upperRight_X=e(i+d)||0,c.upperRight_Y=s(a)||0,[Number(Xt(c.lowerLeft_X)),Number(Xt(c.lowerLeft_Y)),Number(Xt(c.upperRight_X)),Number(Xt(c.upperRight_Y))]},e2=function(r){if(r.appearanceStreamContent)return r.appearanceStreamContent;if(r.V||r.DV){var t=[],e=r._V||r.DV,s=Ac(r,e),i=r.scope.internal.getFont(r.fontName,r.fontStyle).id;t.push("/Tx BMC"),t.push("q"),t.push("BT"),t.push(r.scope.__private__.encodeColorString(r.color)),t.push("/"+i+" "+Xt(s.fontSize)+" Tf"),t.push("1 0 0 1 0 0 Tm"),t.push(s.text),t.push("ET"),t.push("Q"),t.push("EMC");var a=Ks(r);return a.scope=r.scope,a.stream=t.join(`
`),a}},Ac=function(r,t){var e=r.fontSize===0?r.maxFontSize:r.fontSize,s={text:"",fontSize:""},i=(t=(t=t.substr(0,1)=="("?t.substr(1):t).substr(t.length-1)==")"?t.substr(0,t.length-1):t).split(" ");i=r.multiline?i.map(function(F){return F.split(`
`)}):i.map(function(F){return[F]});var a=e,d=Lt.internal.getHeight(r)||0;d=d<0?-d:d;var o=Lt.internal.getWidth(r)||0;o=o<0?-o:o;var c=function(F,k,M){if(F+1<i.length){var _=k+" "+i[F+1][0];return Go(_,r,M).width<=o-4}return!1};a++;e:for(;a>0;){t="",a--;var h,p,b=Go("3",r,a).height,m=r.multiline?d-a:(d-b)/2,u=m+=2,w=0,g=0,N=0;if(a<=0){t=`(...) Tj
`,t+="% Width of Text: "+Go(t,r,a=12).width+", FieldWidth:"+o+`
`;break}for(var y="",S=0,L=0;L<i.length;L++)if(i.hasOwnProperty(L)){var E=!1;if(i[L].length!==1&&N!==i[L].length-1){if((b+2)*(S+2)+2>d)continue e;y+=i[L][N],E=!0,g=L,L--}else{y=(y+=i[L][N]+" ").substr(y.length-1)==" "?y.substr(0,y.length-1):y;var I=parseInt(L),K=c(I,y,a),Y=L>=i.length-1;if(K&&!Y){y+=" ",N=0;continue}if(K||Y){if(Y)g=I;else if(r.multiline&&(b+2)*(S+2)+2>d)continue e}else{if(!r.multiline||(b+2)*(S+2)+2>d)continue e;g=I}}for(var V="",O=w;O<=g;O++){var Q=i[O];if(r.multiline){if(O===g){V+=Q[N]+" ",N=(N+1)%Q.length;continue}if(O===w){V+=Q[Q.length-1]+" ";continue}}V+=Q[0]+" "}switch(V=V.substr(V.length-1)==" "?V.substr(0,V.length-1):V,p=Go(V,r,a).width,r.textAlign){case"right":h=o-p-2;break;case"center":h=(o-p)/2;break;default:h=2}t+=Xt(h)+" "+Xt(u)+` Td
`,t+="("+li(V)+`) Tj
`,t+=-Xt(h)+` 0 Td
`,u=-(a+2),p=0,w=E?g:g+1,S++,y=""}break}return s.text=t,s.fontSize=a,s},Go=function(r,t,e){var s=t.scope.internal.getFont(t.fontName,t.fontStyle),i=t.scope.getStringUnitWidth(r,{font:s,fontSize:parseFloat(e),charSpace:0})*parseFloat(e);return{height:t.scope.getStringUnitWidth("3",{font:s,fontSize:parseFloat(e),charSpace:0})*parseFloat(e)*1.5,width:i}},t2={fields:[],xForms:[],acroFormDictionaryRoot:null,printedOut:!1,internal:null,isInitialized:!1},r2=function(r,t){var e={type:"reference",object:r};t.internal.getPageInfo(r.page).pageContext.annotations.find(function(s){return s.type===e.type&&s.object===e.object})===void 0&&t.internal.getPageInfo(r.page).pageContext.annotations.push(e)},n2=function(r,t){if(t.scope=r,r.internal!==void 0&&(r.internal.acroformPlugin===void 0||r.internal.acroformPlugin.isInitialized===!1)){if(qs.FieldNum=0,r.internal.acroformPlugin=JSON.parse(JSON.stringify(t2)),r.internal.acroformPlugin.acroFormDictionaryRoot)throw new Error("Exception while creating AcroformDictionary");Gc=r.internal.scaleFactor,r.internal.acroformPlugin.acroFormDictionaryRoot=new Hf,r.internal.acroformPlugin.acroFormDictionaryRoot.scope=r,r.internal.acroformPlugin.acroFormDictionaryRoot._eventID=r.internal.events.subscribe("postPutResources",function(){(function(e){e.internal.events.unsubscribe(e.internal.acroformPlugin.acroFormDictionaryRoot._eventID),delete e.internal.acroformPlugin.acroFormDictionaryRoot._eventID,e.internal.acroformPlugin.printedOut=!0})(r)}),r.internal.events.subscribe("buildDocument",function(){(function(e){e.internal.acroformPlugin.acroFormDictionaryRoot.objId=void 0;var s=e.internal.acroformPlugin.acroFormDictionaryRoot.Fields;for(var i in s)if(s.hasOwnProperty(i)){var a=s[i];a.objId=void 0,a.hasAnnotation&&r2(a,e)}})(r)}),r.internal.events.subscribe("putCatalog",function(){(function(e){if(e.internal.acroformPlugin.acroFormDictionaryRoot===void 0)throw new Error("putCatalogCallback: Root missing.");e.internal.write("/AcroForm "+e.internal.acroformPlugin.acroFormDictionaryRoot.objId+" 0 R")})(r)}),r.internal.events.subscribe("postPutPages",function(e){(function(s,i){var a=!s;for(var d in s||(i.internal.newObjectDeferredBegin(i.internal.acroformPlugin.acroFormDictionaryRoot.objId,!0),i.internal.acroformPlugin.acroFormDictionaryRoot.putStream()),s=s||i.internal.acroformPlugin.acroFormDictionaryRoot.Kids)if(s.hasOwnProperty(d)){var o=s[d],c=[],h=o.Rect;if(o.Rect&&(o.Rect=Q1(o.Rect,i)),i.internal.newObjectDeferredBegin(o.objId,!0),o.DA=Lt.createDefaultAppearanceStream(o),Cr(o)==="object"&&typeof o.getKeyValueListForStream=="function"&&(c=o.getKeyValueListForStream()),o.Rect=h,o.hasAppearanceStream&&!o.appearanceStreamContent){var p=e2(o);c.push({key:"AP",value:"<</N "+p+">>"}),i.internal.acroformPlugin.xForms.push(p)}if(o.appearanceStreamContent){var b="";for(var m in o.appearanceStreamContent)if(o.appearanceStreamContent.hasOwnProperty(m)){var u=o.appearanceStreamContent[m];if(b+="/"+m+" ",b+="<<",Object.keys(u).length>=1||Array.isArray(u)){for(var d in u)if(u.hasOwnProperty(d)){var w=u[d];typeof w=="function"&&(w=w.call(i,o)),b+="/"+d+" "+w+" ",i.internal.acroformPlugin.xForms.indexOf(w)>=0||i.internal.acroformPlugin.xForms.push(w)}}else typeof(w=u)=="function"&&(w=w.call(i,o)),b+="/"+d+" "+w,i.internal.acroformPlugin.xForms.indexOf(w)>=0||i.internal.acroformPlugin.xForms.push(w);b+=">>"}c.push({key:"AP",value:`<<
`+b+">>"})}i.internal.putStream({additionalKeyValues:c,objectId:o.objId}),i.internal.out("endobj")}a&&(function(g,N){for(var y in g)if(g.hasOwnProperty(y)){var S=y,L=g[y];N.internal.newObjectDeferredBegin(L.objId,!0),Cr(L)==="object"&&typeof L.putStream=="function"&&L.putStream(),delete g[S]}})(i.internal.acroformPlugin.xForms,i)})(e,r)}),r.internal.acroformPlugin.isInitialized=!0}},$f=tn.__acroform__.arrayToPdfArray=function(r,t,e){var s=function(d){return d};if(Array.isArray(r)){for(var i="[",a=0;a<r.length;a++)switch(a!==0&&(i+=" "),Cr(r[a])){case"boolean":case"number":case"object":i+=r[a].toString();break;case"string":r[a].substr(0,1)!=="/"?(t!==void 0&&e&&(s=e.internal.getEncryptor(t)),i+="("+li(s(r[a].toString()))+")"):i+=r[a].toString()}return i+"]"}throw new Error("Invalid argument passed to jsPDF.__acroform__.arrayToPdfArray")},oc=function(r,t,e){var s=function(i){return i};return t!==void 0&&e&&(s=e.internal.getEncryptor(t)),(r=r||"").toString(),"("+li(s(r))+")"},ea=function(){this._objId=void 0,this._scope=void 0,Object.defineProperty(this,"objId",{get:function(){if(this._objId===void 0){if(this.scope===void 0)return;this._objId=this.scope.internal.newObjectDeferred()}return this._objId},set:function(r){this._objId=r}}),Object.defineProperty(this,"scope",{value:this._scope,writable:!0})};ea.prototype.toString=function(){return this.objId+" 0 R"},ea.prototype.putStream=function(){var r=this.getKeyValueListForStream();this.scope.internal.putStream({data:this.stream,additionalKeyValues:r,objectId:this.objId}),this.scope.internal.out("endobj")},ea.prototype.getKeyValueListForStream=function(){var r=[],t=Object.getOwnPropertyNames(this).filter(function(a){return a!="content"&&a!="appearanceStreamContent"&&a!="scope"&&a!="objId"&&a.substring(0,1)!="_"});for(var e in t)if(Object.getOwnPropertyDescriptor(this,t[e]).configurable===!1){var s=t[e],i=this[s];i&&(Array.isArray(i)?r.push({key:s,value:$f(i,this.objId,this.scope)}):i instanceof ea?(i.scope=this.scope,r.push({key:s,value:i.objId+" 0 R"})):typeof i!="function"&&r.push({key:s,value:i}))}return r};var Wf=function(){ea.call(this),Object.defineProperty(this,"Type",{value:"/XObject",configurable:!1,writable:!0}),Object.defineProperty(this,"Subtype",{value:"/Form",configurable:!1,writable:!0}),Object.defineProperty(this,"FormType",{value:1,configurable:!1,writable:!0});var r,t=[];Object.defineProperty(this,"BBox",{configurable:!1,get:function(){return t},set:function(e){t=e}}),Object.defineProperty(this,"Resources",{value:"2 0 R",configurable:!1,writable:!0}),Object.defineProperty(this,"stream",{enumerable:!1,configurable:!0,set:function(e){r=e.trim()},get:function(){return r||null}})};rs(Wf,ea);var Hf=function(){ea.call(this);var r,t=[];Object.defineProperty(this,"Kids",{enumerable:!1,configurable:!0,get:function(){return t.length>0?t:void 0}}),Object.defineProperty(this,"Fields",{enumerable:!1,configurable:!1,get:function(){return t}}),Object.defineProperty(this,"DA",{enumerable:!1,configurable:!1,get:function(){if(r){var e=function(s){return s};return this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),"("+li(e(r))+")"}},set:function(e){r=e}})};rs(Hf,ea);var qs=function r(){ea.call(this);var t=4;Object.defineProperty(this,"F",{enumerable:!1,configurable:!1,get:function(){return t},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute F supplied.');t=y}}),Object.defineProperty(this,"showWhenPrinted",{enumerable:!0,configurable:!0,get:function(){return!!hn(t,3)},set:function(y){y?this.F=fn(t,3):this.F=pn(t,3)}});var e=0;Object.defineProperty(this,"Ff",{enumerable:!1,configurable:!1,get:function(){return e},set:function(y){if(isNaN(y))throw new Error('Invalid value "'+y+'" for attribute Ff supplied.');e=y}});var s=[];Object.defineProperty(this,"Rect",{enumerable:!1,configurable:!1,get:function(){if(s.length!==0)return s},set:function(y){s=y!==void 0?y:[]}}),Object.defineProperty(this,"x",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[0])?0:s[0]},set:function(y){s[0]=y}}),Object.defineProperty(this,"y",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[1])?0:s[1]},set:function(y){s[1]=y}}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[2])?0:s[2]},set:function(y){s[2]=y}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return!s||isNaN(s[3])?0:s[3]},set:function(y){s[3]=y}});var i="";Object.defineProperty(this,"FT",{enumerable:!0,configurable:!1,get:function(){return i},set:function(y){switch(y){case"/Btn":case"/Tx":case"/Ch":case"/Sig":i=y;break;default:throw new Error('Invalid value "'+y+'" for attribute FT supplied.')}}});var a=null;Object.defineProperty(this,"T",{enumerable:!0,configurable:!1,get:function(){if(!a||a.length<1){if(this instanceof ml)return;a="FieldObject"+r.FieldNum++}var y=function(S){return S};return this.scope&&(y=this.scope.internal.getEncryptor(this.objId)),"("+li(y(a))+")"},set:function(y){a=y.toString()}}),Object.defineProperty(this,"fieldName",{configurable:!0,enumerable:!0,get:function(){return a},set:function(y){a=y}});var d="helvetica";Object.defineProperty(this,"fontName",{enumerable:!0,configurable:!0,get:function(){return d},set:function(y){d=y}});var o="normal";Object.defineProperty(this,"fontStyle",{enumerable:!0,configurable:!0,get:function(){return o},set:function(y){o=y}});var c=0;Object.defineProperty(this,"fontSize",{enumerable:!0,configurable:!0,get:function(){return c},set:function(y){c=y}});var h=void 0;Object.defineProperty(this,"maxFontSize",{enumerable:!0,configurable:!0,get:function(){return h===void 0?50/Gc:h},set:function(y){h=y}});var p="black";Object.defineProperty(this,"color",{enumerable:!0,configurable:!0,get:function(){return p},set:function(y){p=y}});var b="/F1 0 Tf 0 g";Object.defineProperty(this,"DA",{enumerable:!0,configurable:!1,get:function(){if(!(!b||this instanceof ml||this instanceof ni))return oc(b,this.objId,this.scope)},set:function(y){y=y.toString(),b=y}});var m=null;Object.defineProperty(this,"DV",{enumerable:!1,configurable:!1,get:function(){if(m)return this instanceof Sn==0?oc(m,this.objId,this.scope):m},set:function(y){y=y.toString(),m=this instanceof Sn==0?y.substr(0,1)==="("?ji(y.substr(1,y.length-2)):ji(y):y}}),Object.defineProperty(this,"defaultValue",{enumerable:!0,configurable:!0,get:function(){return this instanceof Sn==1?ji(m.substr(1,m.length-1)):m},set:function(y){y=y.toString(),m=this instanceof Sn==1?"/"+y:y}});var u=null;Object.defineProperty(this,"_V",{enumerable:!1,configurable:!1,get:function(){if(u)return u},set:function(y){this.V=y}}),Object.defineProperty(this,"V",{enumerable:!1,configurable:!1,get:function(){if(u)return this instanceof Sn==0?oc(u,this.objId,this.scope):u},set:function(y){y=y.toString(),u=this instanceof Sn==0?y.substr(0,1)==="("?ji(y.substr(1,y.length-2)):ji(y):y}}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,get:function(){return this instanceof Sn==1?ji(u.substr(1,u.length-1)):u},set:function(y){y=y.toString(),u=this instanceof Sn==1?"/"+y:y}}),Object.defineProperty(this,"hasAnnotation",{enumerable:!0,configurable:!0,get:function(){return this.Rect}}),Object.defineProperty(this,"Type",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Annot":null}}),Object.defineProperty(this,"Subtype",{enumerable:!0,configurable:!1,get:function(){return this.hasAnnotation?"/Widget":null}});var w,g=!1;Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return g},set:function(y){y=!!y,g=y}}),Object.defineProperty(this,"page",{enumerable:!0,configurable:!0,get:function(){if(w)return w},set:function(y){w=y}}),Object.defineProperty(this,"readOnly",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,1)},set:function(y){y?this.Ff=fn(this.Ff,1):this.Ff=pn(this.Ff,1)}}),Object.defineProperty(this,"required",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,2)},set:function(y){y?this.Ff=fn(this.Ff,2):this.Ff=pn(this.Ff,2)}}),Object.defineProperty(this,"noExport",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,3)},set:function(y){y?this.Ff=fn(this.Ff,3):this.Ff=pn(this.Ff,3)}});var N=null;Object.defineProperty(this,"Q",{enumerable:!0,configurable:!1,get:function(){if(N!==null)return N},set:function(y){if([0,1,2].indexOf(y)===-1)throw new Error('Invalid value "'+y+'" for attribute Q supplied.');N=y}}),Object.defineProperty(this,"textAlign",{get:function(){var y;switch(N){case 0:default:y="left";break;case 1:y="center";break;case 2:y="right"}return y},configurable:!0,enumerable:!0,set:function(y){switch(y){case"right":case 2:N=2;break;case"center":case 1:N=1;break;default:N=0}}})};rs(qs,ea);var Ii=function(){qs.call(this),this.FT="/Ch",this.V="()",this.fontName="zapfdingbats";var r=0;Object.defineProperty(this,"TI",{enumerable:!0,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"topIndex",{enumerable:!0,configurable:!0,get:function(){return r},set:function(e){r=e}});var t=[];Object.defineProperty(this,"Opt",{enumerable:!0,configurable:!1,get:function(){return $f(t,this.objId,this.scope)},set:function(e){var s,i;i=[],typeof(s=e)=="string"&&(i=(function(a,d,o){o||(o=1);for(var c,h=[];c=d.exec(a);)h.push(c[o]);return h})(s,/\((.*?)\)/g)),t=i}}),this.getOptions=function(){return t},this.setOptions=function(e){t=e,this.sort&&t.sort()},this.addOption=function(e){e=(e=e||"").toString(),t.push(e),this.sort&&t.sort()},this.removeOption=function(e,s){for(s=s||!1,e=(e=e||"").toString();t.indexOf(e)!==-1&&(t.splice(t.indexOf(e),1),s!==!1););},Object.defineProperty(this,"combo",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,18)},set:function(e){e?this.Ff=fn(this.Ff,18):this.Ff=pn(this.Ff,18)}}),Object.defineProperty(this,"edit",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,19)},set:function(e){this.combo===!0&&(e?this.Ff=fn(this.Ff,19):this.Ff=pn(this.Ff,19))}}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,20)},set:function(e){e?(this.Ff=fn(this.Ff,20),t.sort()):this.Ff=pn(this.Ff,20)}}),Object.defineProperty(this,"multiSelect",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,22)},set:function(e){e?this.Ff=fn(this.Ff,22):this.Ff=pn(this.Ff,22)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,23)},set:function(e){e?this.Ff=fn(this.Ff,23):this.Ff=pn(this.Ff,23)}}),Object.defineProperty(this,"commitOnSelChange",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,27)},set:function(e){e?this.Ff=fn(this.Ff,27):this.Ff=pn(this.Ff,27)}}),this.hasAppearanceStream=!1};rs(Ii,qs);var Fi=function(){Ii.call(this),this.fontName="helvetica",this.combo=!1};rs(Fi,Ii);var Oi=function(){Fi.call(this),this.combo=!0};rs(Oi,Fi);var tl=function(){Oi.call(this),this.edit=!0};rs(tl,Oi);var Sn=function(){qs.call(this),this.FT="/Btn",Object.defineProperty(this,"noToggleToOff",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,15)},set:function(e){e?this.Ff=fn(this.Ff,15):this.Ff=pn(this.Ff,15)}}),Object.defineProperty(this,"radio",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,16)},set:function(e){e?this.Ff=fn(this.Ff,16):this.Ff=pn(this.Ff,16)}}),Object.defineProperty(this,"pushButton",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,17)},set:function(e){e?this.Ff=fn(this.Ff,17):this.Ff=pn(this.Ff,17)}}),Object.defineProperty(this,"radioIsUnison",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,26)},set:function(e){e?this.Ff=fn(this.Ff,26):this.Ff=pn(this.Ff,26)}});var r,t={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var e=function(a){return a};if(this.scope&&(e=this.scope.internal.getEncryptor(this.objId)),Object.keys(t).length!==0){var s,i=[];for(s in i.push("<<"),t)i.push("/"+s+" ("+li(e(t[s]))+")");return i.push(">>"),i.join(`
`)}},set:function(e){Cr(e)==="object"&&(t=e)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return t.CA||""},set:function(e){typeof e=="string"&&(t.CA=e)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return r},set:function(e){r=e}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return r.substr(1,r.length-1)},set:function(e){r="/"+e}})};rs(Sn,qs);var rl=function(){Sn.call(this),this.pushButton=!0};rs(rl,Sn);var Ri=function(){Sn.call(this),this.radio=!0,this.pushButton=!1;var r=[];Object.defineProperty(this,"Kids",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t!==void 0?t:[]}})};rs(Ri,Sn);var ml=function(){var r,t;qs.call(this),Object.defineProperty(this,"Parent",{enumerable:!1,configurable:!1,get:function(){return r},set:function(i){r=i}}),Object.defineProperty(this,"optionName",{enumerable:!1,configurable:!0,get:function(){return t},set:function(i){t=i}});var e,s={};Object.defineProperty(this,"MK",{enumerable:!1,configurable:!1,get:function(){var i=function(o){return o};this.scope&&(i=this.scope.internal.getEncryptor(this.objId));var a,d=[];for(a in d.push("<<"),s)d.push("/"+a+" ("+li(i(s[a]))+")");return d.push(">>"),d.join(`
`)},set:function(i){Cr(i)==="object"&&(s=i)}}),Object.defineProperty(this,"caption",{enumerable:!0,configurable:!0,get:function(){return s.CA||""},set:function(i){typeof i=="string"&&(s.CA=i)}}),Object.defineProperty(this,"AS",{enumerable:!1,configurable:!1,get:function(){return e},set:function(i){e=i}}),Object.defineProperty(this,"appearanceState",{enumerable:!0,configurable:!0,get:function(){return e.substr(1,e.length-1)},set:function(i){e="/"+i}}),this.caption="l",this.appearanceState="Off",this._AppearanceType=Lt.RadioButton.Circle,this.appearanceStreamContent=this._AppearanceType.createAppearanceStream(this.optionName)};rs(ml,qs),Ri.prototype.setAppearance=function(r){if(!("createAppearanceStream"in r)||!("getCA"in r))throw new Error("Couldn't assign Appearance to RadioButton. Appearance was Invalid!");for(var t in this.Kids)if(this.Kids.hasOwnProperty(t)){var e=this.Kids[t];e.appearanceStreamContent=r.createAppearanceStream(e.optionName),e.caption=r.getCA()}},Ri.prototype.createOption=function(r){var t=new ml;return t.Parent=this,t.optionName=r,this.Kids.push(t),s2.call(this.scope,t),t};var nl=function(){Sn.call(this),this.fontName="zapfdingbats",this.caption="3",this.appearanceState="On",this.value="On",this.textAlign="center",this.appearanceStreamContent=Lt.CheckBox.createAppearanceStream()};rs(nl,Sn);var ni=function(){qs.call(this),this.FT="/Tx",Object.defineProperty(this,"multiline",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,13)},set:function(t){t?this.Ff=fn(this.Ff,13):this.Ff=pn(this.Ff,13)}}),Object.defineProperty(this,"fileSelect",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,21)},set:function(t){t?this.Ff=fn(this.Ff,21):this.Ff=pn(this.Ff,21)}}),Object.defineProperty(this,"doNotSpellCheck",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,23)},set:function(t){t?this.Ff=fn(this.Ff,23):this.Ff=pn(this.Ff,23)}}),Object.defineProperty(this,"doNotScroll",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,24)},set:function(t){t?this.Ff=fn(this.Ff,24):this.Ff=pn(this.Ff,24)}}),Object.defineProperty(this,"comb",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,25)},set:function(t){t?this.Ff=fn(this.Ff,25):this.Ff=pn(this.Ff,25)}}),Object.defineProperty(this,"richText",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,26)},set:function(t){t?this.Ff=fn(this.Ff,26):this.Ff=pn(this.Ff,26)}});var r=null;Object.defineProperty(this,"MaxLen",{enumerable:!0,configurable:!1,get:function(){return r},set:function(t){r=t}}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,get:function(){return r},set:function(t){Number.isInteger(t)&&(r=t)}}),Object.defineProperty(this,"hasAppearanceStream",{enumerable:!0,configurable:!0,get:function(){return this.V||this.DV}})};rs(ni,qs);var sl=function(){ni.call(this),Object.defineProperty(this,"password",{enumerable:!0,configurable:!0,get:function(){return!!hn(this.Ff,14)},set:function(r){r?this.Ff=fn(this.Ff,14):this.Ff=pn(this.Ff,14)}}),this.password=!0};rs(sl,ni);var Lt={CheckBox:{createAppearanceStream:function(){return{N:{On:Lt.CheckBox.YesNormal},D:{On:Lt.CheckBox.YesPushDown,Off:Lt.CheckBox.OffPushDown}}},YesPushDown:function(r){var t=Ks(r);t.scope=r.scope;var e=[],s=r.scope.internal.getFont(r.fontName,r.fontStyle).id,i=r.scope.__private__.encodeColorString(r.color),a=Ac(r,r.caption);return e.push("0.749023 g"),e.push("0 0 "+Xt(Lt.internal.getWidth(r))+" "+Xt(Lt.internal.getHeight(r))+" re"),e.push("f"),e.push("BMC"),e.push("q"),e.push("0 0 1 rg"),e.push("/"+s+" "+Xt(a.fontSize)+" Tf "+i),e.push("BT"),e.push(a.text),e.push("ET"),e.push("Q"),e.push("EMC"),t.stream=e.join(`
`),t},YesNormal:function(r){var t=Ks(r);t.scope=r.scope;var e=r.scope.internal.getFont(r.fontName,r.fontStyle).id,s=r.scope.__private__.encodeColorString(r.color),i=[],a=Lt.internal.getHeight(r),d=Lt.internal.getWidth(r),o=Ac(r,r.caption);return i.push("1 g"),i.push("0 0 "+Xt(d)+" "+Xt(a)+" re"),i.push("f"),i.push("q"),i.push("0 0 1 rg"),i.push("0 0 "+Xt(d-1)+" "+Xt(a-1)+" re"),i.push("W"),i.push("n"),i.push("0 g"),i.push("BT"),i.push("/"+e+" "+Xt(o.fontSize)+" Tf "+s),i.push(o.text),i.push("ET"),i.push("Q"),t.stream=i.join(`
`),t},OffPushDown:function(r){var t=Ks(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Xt(Lt.internal.getWidth(r))+" "+Xt(Lt.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}},RadioButton:{Circle:{createAppearanceStream:function(r){var t={D:{Off:Lt.RadioButton.Circle.OffPushDown},N:{}};return t.N[r]=Lt.RadioButton.Circle.YesNormal,t.D[r]=Lt.RadioButton.Circle.YesPushDown,t},getCA:function(){return"l"},YesNormal:function(r){var t=Ks(r);t.scope=r.scope;var e=[],s=Lt.internal.getWidth(r)<=Lt.internal.getHeight(r)?Lt.internal.getWidth(r)/4:Lt.internal.getHeight(r)/4;s=Number((.9*s).toFixed(5));var i=Lt.internal.Bezier_C,a=Number((s*i).toFixed(5));return e.push("q"),e.push("1 0 0 1 "+Ua(Lt.internal.getWidth(r)/2)+" "+Ua(Lt.internal.getHeight(r)/2)+" cm"),e.push(s+" 0 m"),e.push(s+" "+a+" "+a+" "+s+" 0 "+s+" c"),e.push("-"+a+" "+s+" -"+s+" "+a+" -"+s+" 0 c"),e.push("-"+s+" -"+a+" -"+a+" -"+s+" 0 -"+s+" c"),e.push(a+" -"+s+" "+s+" -"+a+" "+s+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Ks(r);t.scope=r.scope;var e=[],s=Lt.internal.getWidth(r)<=Lt.internal.getHeight(r)?Lt.internal.getWidth(r)/4:Lt.internal.getHeight(r)/4;s=Number((.9*s).toFixed(5));var i=Number((2*s).toFixed(5)),a=Number((i*Lt.internal.Bezier_C).toFixed(5)),d=Number((s*Lt.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Ua(Lt.internal.getWidth(r)/2)+" "+Ua(Lt.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),e.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),e.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),e.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),e.push("f"),e.push("Q"),e.push("0 g"),e.push("q"),e.push("1 0 0 1 "+Ua(Lt.internal.getWidth(r)/2)+" "+Ua(Lt.internal.getHeight(r)/2)+" cm"),e.push(s+" 0 m"),e.push(s+" "+d+" "+d+" "+s+" 0 "+s+" c"),e.push("-"+d+" "+s+" -"+s+" "+d+" -"+s+" 0 c"),e.push("-"+s+" -"+d+" -"+d+" -"+s+" 0 -"+s+" c"),e.push(d+" -"+s+" "+s+" -"+d+" "+s+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t},OffPushDown:function(r){var t=Ks(r);t.scope=r.scope;var e=[],s=Lt.internal.getWidth(r)<=Lt.internal.getHeight(r)?Lt.internal.getWidth(r)/4:Lt.internal.getHeight(r)/4;s=Number((.9*s).toFixed(5));var i=Number((2*s).toFixed(5)),a=Number((i*Lt.internal.Bezier_C).toFixed(5));return e.push("0.749023 g"),e.push("q"),e.push("1 0 0 1 "+Ua(Lt.internal.getWidth(r)/2)+" "+Ua(Lt.internal.getHeight(r)/2)+" cm"),e.push(i+" 0 m"),e.push(i+" "+a+" "+a+" "+i+" 0 "+i+" c"),e.push("-"+a+" "+i+" -"+i+" "+a+" -"+i+" 0 c"),e.push("-"+i+" -"+a+" -"+a+" -"+i+" 0 -"+i+" c"),e.push(a+" -"+i+" "+i+" -"+a+" "+i+" 0 c"),e.push("f"),e.push("Q"),t.stream=e.join(`
`),t}},Cross:{createAppearanceStream:function(r){var t={D:{Off:Lt.RadioButton.Cross.OffPushDown},N:{}};return t.N[r]=Lt.RadioButton.Cross.YesNormal,t.D[r]=Lt.RadioButton.Cross.YesPushDown,t},getCA:function(){return"8"},YesNormal:function(r){var t=Ks(r);t.scope=r.scope;var e=[],s=Lt.internal.calculateCross(r);return e.push("q"),e.push("1 1 "+Xt(Lt.internal.getWidth(r)-2)+" "+Xt(Lt.internal.getHeight(r)-2)+" re"),e.push("W"),e.push("n"),e.push(Xt(s.x1.x)+" "+Xt(s.x1.y)+" m"),e.push(Xt(s.x2.x)+" "+Xt(s.x2.y)+" l"),e.push(Xt(s.x4.x)+" "+Xt(s.x4.y)+" m"),e.push(Xt(s.x3.x)+" "+Xt(s.x3.y)+" l"),e.push("s"),e.push("Q"),t.stream=e.join(`
`),t},YesPushDown:function(r){var t=Ks(r);t.scope=r.scope;var e=Lt.internal.calculateCross(r),s=[];return s.push("0.749023 g"),s.push("0 0 "+Xt(Lt.internal.getWidth(r))+" "+Xt(Lt.internal.getHeight(r))+" re"),s.push("f"),s.push("q"),s.push("1 1 "+Xt(Lt.internal.getWidth(r)-2)+" "+Xt(Lt.internal.getHeight(r)-2)+" re"),s.push("W"),s.push("n"),s.push(Xt(e.x1.x)+" "+Xt(e.x1.y)+" m"),s.push(Xt(e.x2.x)+" "+Xt(e.x2.y)+" l"),s.push(Xt(e.x4.x)+" "+Xt(e.x4.y)+" m"),s.push(Xt(e.x3.x)+" "+Xt(e.x3.y)+" l"),s.push("s"),s.push("Q"),t.stream=s.join(`
`),t},OffPushDown:function(r){var t=Ks(r);t.scope=r.scope;var e=[];return e.push("0.749023 g"),e.push("0 0 "+Xt(Lt.internal.getWidth(r))+" "+Xt(Lt.internal.getHeight(r))+" re"),e.push("f"),t.stream=e.join(`
`),t}}},createDefaultAppearanceStream:function(r){var t=r.scope.internal.getFont(r.fontName,r.fontStyle).id,e=r.scope.__private__.encodeColorString(r.color);return"/"+t+" "+r.fontSize+" Tf "+e}};Lt.internal={Bezier_C:.551915024494,calculateCross:function(r){var t=Lt.internal.getWidth(r),e=Lt.internal.getHeight(r),s=Math.min(t,e);return{x1:{x:(t-s)/2,y:(e-s)/2+s},x2:{x:(t-s)/2+s,y:(e-s)/2},x3:{x:(t-s)/2,y:(e-s)/2},x4:{x:(t-s)/2+s,y:(e-s)/2+s}}}},Lt.internal.getWidth=function(r){var t=0;return Cr(r)==="object"&&(t=Bu(r.Rect[2])),t},Lt.internal.getHeight=function(r){var t=0;return Cr(r)==="object"&&(t=Bu(r.Rect[3])),t};var s2=tn.addField=function(r){if(n2(this,r),!(r instanceof qs))throw new Error("Invalid argument passed to jsPDF.addField.");var t;return(t=r).scope.internal.acroformPlugin.printedOut&&(t.scope.internal.acroformPlugin.printedOut=!1,t.scope.internal.acroformPlugin.acroFormDictionaryRoot=null),t.scope.internal.acroformPlugin.acroFormDictionaryRoot.Fields.push(t),r.page=r.scope.internal.getCurrentPageInfo().pageNumber,this};tn.AcroFormChoiceField=Ii,tn.AcroFormListBox=Fi,tn.AcroFormComboBox=Oi,tn.AcroFormEditBox=tl,tn.AcroFormButton=Sn,tn.AcroFormPushButton=rl,tn.AcroFormRadioButton=Ri,tn.AcroFormCheckBox=nl,tn.AcroFormTextField=ni,tn.AcroFormPasswordField=sl,tn.AcroFormAppearance=Lt,tn.AcroForm={ChoiceField:Ii,ListBox:Fi,ComboBox:Oi,EditBox:tl,Button:Sn,PushButton:rl,RadioButton:Ri,CheckBox:nl,TextField:ni,PasswordField:sl,Appearance:Lt},Ut.AcroForm={ChoiceField:Ii,ListBox:Fi,ComboBox:Oi,EditBox:tl,Button:Sn,PushButton:rl,RadioButton:Ri,CheckBox:nl,TextField:ni,PasswordField:sl,Appearance:Lt};Ut.AcroForm;function Vf(r){return r.reduce(function(t,e,s){return t[e]=s,t},{})}(function(r){var t="addImage_";r.__addimage__={};var e="UNKNOWN",s={PNG:[[137,80,78,71]],TIFF:[[77,77,0,42],[73,73,42,0]],JPEG:[[255,216,255,224,void 0,void 0,74,70,73,70,0],[255,216,255,225,void 0,void 0,69,120,105,102,0,0],[255,216,255,219],[255,216,255,238]],JPEG2000:[[0,0,0,12,106,80,32,32]],GIF87a:[[71,73,70,56,55,97]],GIF89a:[[71,73,70,56,57,97]],WEBP:[[82,73,70,70,void 0,void 0,void 0,void 0,87,69,66,80]],BMP:[[66,77],[66,65],[67,73],[67,80],[73,67],[80,84]]},i=r.__addimage__.getImageFileTypeByImageData=function(F,k){var M,_,te,ae,re,se=e;if((k=k||e)==="RGBA"||F.data!==void 0&&F.data instanceof Uint8ClampedArray&&"height"in F&&"width"in F)return"RGBA";if(K(F))for(re in s)for(te=s[re],M=0;M<te.length;M+=1){for(ae=!0,_=0;_<te[M].length;_+=1)if(te[M][_]!==void 0&&te[M][_]!==F[_]){ae=!1;break}if(ae===!0){se=re;break}}else for(re in s)for(te=s[re],M=0;M<te.length;M+=1){for(ae=!0,_=0;_<te[M].length;_+=1)if(te[M][_]!==void 0&&te[M][_]!==F.charCodeAt(_)){ae=!1;break}if(ae===!0){se=re;break}}return se===e&&k!==e&&(se=k),se},a=function F(k){for(var M=this.internal.write,_=this.internal.putStream,te=(0,this.internal.getFilters)();te.indexOf("FlateEncode")!==-1;)te.splice(te.indexOf("FlateEncode"),1);k.objectId=this.internal.newObject();var ae=[];if(ae.push({key:"Type",value:"/XObject"}),ae.push({key:"Subtype",value:"/Image"}),ae.push({key:"Width",value:k.width}),ae.push({key:"Height",value:k.height}),k.colorSpace===y.INDEXED?ae.push({key:"ColorSpace",value:"[/Indexed /DeviceRGB "+(k.palette.length/3-1)+" "+("sMask"in k&&k.sMask!==void 0?k.objectId+2:k.objectId+1)+" 0 R]"}):(ae.push({key:"ColorSpace",value:"/"+k.colorSpace}),k.colorSpace===y.DEVICE_CMYK&&ae.push({key:"Decode",value:"[1 0 1 0 1 0 1 0]"})),ae.push({key:"BitsPerComponent",value:k.bitsPerComponent}),"decodeParameters"in k&&k.decodeParameters!==void 0&&ae.push({key:"DecodeParms",value:"<<"+k.decodeParameters+">>"}),"transparency"in k&&Array.isArray(k.transparency)&&k.transparency.length>0){for(var re="",se=0,ie=k.transparency.length;se<ie;se++)re+=k.transparency[se]+" "+k.transparency[se]+" ";ae.push({key:"Mask",value:"["+re+"]"})}k.sMask!==void 0&&ae.push({key:"SMask",value:k.objectId+1+" 0 R"});var je=k.filter!==void 0?["/"+k.filter]:void 0;if(_({data:k.data,additionalKeyValues:ae,alreadyAppliedFilters:je,objectId:k.objectId}),M("endobj"),"sMask"in k&&k.sMask!==void 0){var ne,A=(ne=k.sMaskBitsPerComponent)!==null&&ne!==void 0?ne:k.bitsPerComponent,H={width:k.width,height:k.height,colorSpace:"DeviceGray",bitsPerComponent:A,data:k.sMask};"filter"in k&&(H.decodeParameters="/Predictor ".concat(k.predictor," /Colors 1 /BitsPerComponent ").concat(A," /Columns ").concat(k.width),H.filter=k.filter),F.call(this,H)}if(k.colorSpace===y.INDEXED){var Z=this.internal.newObject();_({data:V(new Uint8Array(k.palette)),objectId:Z}),M("endobj")}},d=function(){var F=this.internal.collections[t+"images"];for(var k in F)a.call(this,F[k])},o=function(){var F,k=this.internal.collections[t+"images"],M=this.internal.write;for(var _ in k)M("/I"+(F=k[_]).index,F.objectId,"0","R")},c=function(){this.internal.collections[t+"images"]||(this.internal.collections[t+"images"]={},this.internal.events.subscribe("putResources",d),this.internal.events.subscribe("putXobjectDict",o))},h=function(){var F=this.internal.collections[t+"images"];return c.call(this),F},p=function(){return Object.keys(this.internal.collections[t+"images"]).length},b=function(F){return typeof r["process"+F.toUpperCase()]=="function"},m=function(F){return Cr(F)==="object"&&F.nodeType===1},u=function(F,k){if(F.nodeName==="IMG"&&F.hasAttribute("src")){var M=""+F.getAttribute("src");if(M.indexOf("data:image/")===0)return el(unescape(M).split("base64,").pop());var _=r.loadFile(M,!0);if(_!==void 0)return _}if(F.nodeName==="CANVAS"){if(F.width===0||F.height===0)throw new Error("Given canvas must have data. Canvas width: "+F.width+", height: "+F.height);var te;switch(k){case"PNG":te="image/png";break;case"WEBP":te="image/webp";break;default:te="image/jpeg"}return el(F.toDataURL(te,1).split("base64,").pop())}},w=function(F){var k=this.internal.collections[t+"images"];if(k){for(var M in k)if(F===k[M].alias)return k[M]}},g=function(F,k,M){return F||k||(F=-96,k=-96),F<0&&(F=-1*M.width*72/F/this.internal.scaleFactor),k<0&&(k=-1*M.height*72/k/this.internal.scaleFactor),F===0&&(F=k*M.width/M.height),k===0&&(k=F*M.height/M.width),[F,k]},N=function(F,k,M,_,te,ae){var re=g.call(this,M,_,te),se=this.internal.getCoordinateString,ie=this.internal.getVerticalCoordinateString,je=h.call(this);if(M=re[0],_=re[1],je[te.index]=te,ae){ae*=Math.PI/180;var ne=Math.cos(ae),A=Math.sin(ae),H=function(X){return X.toFixed(4)},Z=[H(ne),H(A),H(-1*A),H(ne),0,0,"cm"]}this.internal.write("q"),ae?(this.internal.write([1,"0","0",1,se(F),ie(k+_),"cm"].join(" ")),this.internal.write(Z.join(" ")),this.internal.write([se(M),"0","0",se(_),"0","0","cm"].join(" "))):this.internal.write([se(M),"0","0",se(_),se(F),ie(k+_),"cm"].join(" ")),this.isAdvancedAPI()&&this.internal.write([1,0,0,-1,0,0,"cm"].join(" ")),this.internal.write("/I"+te.index+" Do"),this.internal.write("Q")},y=r.color_spaces={DEVICE_RGB:"DeviceRGB",DEVICE_GRAY:"DeviceGray",DEVICE_CMYK:"DeviceCMYK",CAL_GREY:"CalGray",CAL_RGB:"CalRGB",LAB:"Lab",ICC_BASED:"ICCBased",INDEXED:"Indexed",PATTERN:"Pattern",SEPARATION:"Separation",DEVICE_N:"DeviceN"};r.decode={DCT_DECODE:"DCTDecode",FLATE_DECODE:"FlateDecode",LZW_DECODE:"LZWDecode",JPX_DECODE:"JPXDecode",JBIG2_DECODE:"JBIG2Decode",ASCII85_DECODE:"ASCII85Decode",ASCII_HEX_DECODE:"ASCIIHexDecode",RUN_LENGTH_DECODE:"RunLengthDecode",CCITT_FAX_DECODE:"CCITTFaxDecode"};var S=r.image_compression={NONE:"NONE",FAST:"FAST",MEDIUM:"MEDIUM",SLOW:"SLOW"},L=r.__addimage__.sHashCode=function(F){var k,M,_=0;if(typeof F=="string")for(M=F.length,k=0;k<M;k++)_=(_<<5)-_+F.charCodeAt(k),_|=0;else if(K(F))for(M=F.byteLength/2,k=0;k<M;k++)_=(_<<5)-_+F[k],_|=0;return _},E=r.__addimage__.validateStringAsBase64=function(F){(F=F||"").toString().trim();var k=!0;return F.length===0&&(k=!1),F.length%4!=0&&(k=!1),/^[A-Za-z0-9+/]+$/.test(F.substr(0,F.length-2))===!1&&(k=!1),/^[A-Za-z0-9/][A-Za-z0-9+/]|[A-Za-z0-9+/]=|==$/.test(F.substr(-2))===!1&&(k=!1),k},I=r.__addimage__.extractImageFromDataUrl=function(F){if(F==null||!(F=F.trim()).startsWith("data:"))return null;var k=F.indexOf(",");return k<0?null:F.substring(0,k).trim().endsWith("base64")?F.substring(k+1):null};r.__addimage__.isArrayBuffer=function(F){return F instanceof ArrayBuffer};var K=r.__addimage__.isArrayBufferView=function(F){return F instanceof Int8Array||F instanceof Uint8Array||F instanceof Uint8ClampedArray||F instanceof Int16Array||F instanceof Uint16Array||F instanceof Int32Array||F instanceof Uint32Array||F instanceof Float32Array||F instanceof Float64Array},Y=r.__addimage__.binaryStringToUint8Array=function(F){for(var k=F.length,M=new Uint8Array(k),_=0;_<k;_++)M[_]=F.charCodeAt(_);return M},V=r.__addimage__.arrayBufferToBinaryString=function(F){for(var k="",M=K(F)?F:new Uint8Array(F),_=0;_<M.length;_+=8192)k+=String.fromCharCode.apply(null,M.subarray(_,_+8192));return k};r.addImage=function(){var F,k,M,_,te,ae,re,se,ie;if(typeof arguments[1]=="number"?(k=e,M=arguments[1],_=arguments[2],te=arguments[3],ae=arguments[4],re=arguments[5],se=arguments[6],ie=arguments[7]):(k=arguments[1],M=arguments[2],_=arguments[3],te=arguments[4],ae=arguments[5],re=arguments[6],se=arguments[7],ie=arguments[8]),Cr(F=arguments[0])==="object"&&!m(F)&&"imageData"in F){var je=F;F=je.imageData,k=je.format||k||e,M=je.x||M||0,_=je.y||_||0,te=je.w||je.width||te,ae=je.h||je.height||ae,re=je.alias||re,se=je.compression||se,ie=je.rotation||je.angle||ie}var ne=this.internal.getFilters();if(se===void 0&&ne.indexOf("FlateEncode")!==-1&&(se="SLOW"),isNaN(M)||isNaN(_))throw new Error("Invalid coordinates passed to jsPDF.addImage");c.call(this);var A=O.call(this,F,k,re,se);return N.call(this,M,_,te,ae,A,ie),this};var O=function(F,k,M,_){var te,ae,re;if(typeof F=="string"&&i(F)===e){F=unescape(F);var se=Q(F,!1);(se!==""||(se=r.loadFile(F,!0))!==void 0)&&(F=se)}if(m(F)&&(F=u(F,k)),k=i(F,k),!b(k))throw new Error("addImage does not support files of type '"+k+"', please ensure that a plugin for '"+k+"' support is added.");if(((re=M)==null||re.length===0)&&(M=(function(ie){return typeof ie=="string"||K(ie)?L(ie):K(ie.data)?L(ie.data):null})(F)),(te=w.call(this,M))||(F instanceof Uint8Array||k==="RGBA"||(ae=F,F=Y(F)),te=this["process"+k.toUpperCase()](F,p.call(this),M,(function(ie){return ie&&typeof ie=="string"&&(ie=ie.toUpperCase()),ie in r.image_compression?ie:S.NONE})(_),ae)),!te)throw new Error("An unknown error occurred whilst processing the image.");return te},Q=r.__addimage__.convertBase64ToBinaryString=function(F,k){k=typeof k!="boolean"||k;var M,_="";if(typeof F=="string"){var te;M=(te=I(F))!==null&&te!==void 0?te:F;try{_=el(M)}catch(ae){if(k)throw E(M)?new Error("atob-Error in jsPDF.convertBase64ToBinaryString "+ae.message):new Error("Supplied Data is not a valid base64-String jsPDF.convertBase64ToBinaryString ")}}return _};r.getImageProperties=function(F){var k,M,_="";if(m(F)&&(F=u(F)),typeof F=="string"&&i(F)===e&&((_=Q(F,!1))===""&&(_=r.loadFile(F)||""),F=_),M=i(F),!b(M))throw new Error("addImage does not support files of type '"+M+"', please ensure that a plugin for '"+M+"' support is added.");if(F instanceof Uint8Array||(F=Y(F)),!(k=this["process"+M.toUpperCase()](F)))throw new Error("An unknown error occurred whilst processing the image");return k.fileType=M,k}})(Ut.API),(function(r){var t=function(e){if(e!==void 0&&e!="")return!0};Ut.API.events.push(["addPage",function(e){this.internal.getPageInfo(e.pageNumber).pageContext.annotations=[]}]),r.events.push(["putPage",function(e){for(var s,i,a,d=this.internal.getCoordinateString,o=this.internal.getVerticalCoordinateString,c=this.internal.getPageInfoByObjId(e.objId),h=e.pageContext.annotations,p=!1,b=0;b<h.length&&!p;b++)switch((s=h[b]).type){case"link":(t(s.options.url)||t(s.options.pageNumber))&&(p=!0);break;case"reference":case"text":case"freetext":p=!0}if(p!=0){this.internal.write("/Annots [");for(var m=0;m<h.length;m++){s=h[m];var u=this.internal.pdfEscape,w=this.internal.getEncryptor(e.objId);switch(s.type){case"reference":this.internal.write(" "+s.object.objId+" 0 R ");break;case"text":var g=this.internal.newAdditionalObject(),N=this.internal.newAdditionalObject(),y=this.internal.getEncryptor(g.objId),S=s.title||"Note";a="<</Type /Annot /Subtype /Text "+(i="/Rect ["+d(s.bounds.x)+" "+o(s.bounds.y+s.bounds.h)+" "+d(s.bounds.x+s.bounds.w)+" "+o(s.bounds.y)+"] ")+"/Contents ("+u(y(s.contents))+")",a+=" /Popup "+N.objId+" 0 R",a+=" /P "+c.objId+" 0 R",a+=" /T ("+u(y(S))+") >>",g.content=a;var L=g.objId+" 0 R";a="<</Type /Annot /Subtype /Popup "+(i="/Rect ["+d(s.bounds.x+30)+" "+o(s.bounds.y+s.bounds.h)+" "+d(s.bounds.x+s.bounds.w+30)+" "+o(s.bounds.y)+"] ")+" /Parent "+L,s.open&&(a+=" /Open true"),a+=" >>",N.content=a,this.internal.write(g.objId,"0 R",N.objId,"0 R");break;case"freetext":i="/Rect ["+d(s.bounds.x)+" "+o(s.bounds.y)+" "+d(s.bounds.x+s.bounds.w)+" "+o(s.bounds.y+s.bounds.h)+"] ";var E=s.color||"#000000";a="<</Type /Annot /Subtype /FreeText "+i+"/Contents ("+u(w(s.contents))+")",a+=" /DS(font: Helvetica,sans-serif 12.0pt; text-align:left; color:#"+E+")",a+=" /Border [0 0 0]",a+=" >>",this.internal.write(a);break;case"link":if(s.options.name){var I=this.annotations._nameMap[s.options.name];s.options.pageNumber=I.page,s.options.top=I.y}else s.options.top||(s.options.top=0);if(i="/Rect ["+s.finalBounds.x+" "+s.finalBounds.y+" "+s.finalBounds.w+" "+s.finalBounds.h+"] ",a="",s.options.url)a="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /A <</S /URI /URI ("+u(w(s.options.url))+") >>";else if(s.options.pageNumber)switch(a="<</Type /Annot /Subtype /Link "+i+"/Border [0 0 0] /Dest ["+this.internal.getPageInfo(s.options.pageNumber).objId+" 0 R",s.options.magFactor=s.options.magFactor||"XYZ",s.options.magFactor){case"Fit":a+=" /Fit]";break;case"FitH":a+=" /FitH "+s.options.top+"]";break;case"FitV":s.options.left=s.options.left||0,a+=" /FitV "+s.options.left+"]";break;default:var K=o(s.options.top);s.options.left=s.options.left||0,s.options.zoom===void 0&&(s.options.zoom=0),a+=" /XYZ "+s.options.left+" "+K+" "+s.options.zoom+"]"}a!=""&&(a+=" >>",this.internal.write(a))}}this.internal.write("]")}}]),r.createAnnotation=function(e){var s=this.internal.getCurrentPageInfo();switch(e.type){case"link":this.link(e.bounds.x,e.bounds.y,e.bounds.w,e.bounds.h,e);break;case"text":case"freetext":s.pageContext.annotations.push(e)}},r.link=function(e,s,i,a,d){var o=this.internal.getCurrentPageInfo(),c=this.internal.getCoordinateString,h=this.internal.getVerticalCoordinateString;o.pageContext.annotations.push({finalBounds:{x:c(e),y:h(s),w:c(e+i),h:h(s+a)},options:d,type:"link"})},r.textWithLink=function(e,s,i,a){var d,o,c=this.getTextWidth(e),h=this.internal.getLineHeight()/this.internal.scaleFactor;if(a.maxWidth!==void 0){o=a.maxWidth;var p=this.splitTextToSize(e,o).length;d=Math.ceil(h*p)}else o=c,d=h;return this.text(e,s,i,a),i+=.2*h,a.align==="center"&&(s-=c/2),a.align==="right"&&(s-=c),this.link(s,i-h,o,d,a),c},r.getTextWidth=function(e){var s=this.internal.getFontSize();return this.getStringUnitWidth(e)*s/this.internal.scaleFactor}})(Ut.API),(function(r){var t={1569:[65152],1570:[65153,65154],1571:[65155,65156],1572:[65157,65158],1573:[65159,65160],1574:[65161,65162,65163,65164],1575:[65165,65166],1576:[65167,65168,65169,65170],1577:[65171,65172],1578:[65173,65174,65175,65176],1579:[65177,65178,65179,65180],1580:[65181,65182,65183,65184],1581:[65185,65186,65187,65188],1582:[65189,65190,65191,65192],1583:[65193,65194],1584:[65195,65196],1585:[65197,65198],1586:[65199,65200],1587:[65201,65202,65203,65204],1588:[65205,65206,65207,65208],1589:[65209,65210,65211,65212],1590:[65213,65214,65215,65216],1591:[65217,65218,65219,65220],1592:[65221,65222,65223,65224],1593:[65225,65226,65227,65228],1594:[65229,65230,65231,65232],1601:[65233,65234,65235,65236],1602:[65237,65238,65239,65240],1603:[65241,65242,65243,65244],1604:[65245,65246,65247,65248],1605:[65249,65250,65251,65252],1606:[65253,65254,65255,65256],1607:[65257,65258,65259,65260],1608:[65261,65262],1609:[65263,65264,64488,64489],1610:[65265,65266,65267,65268],1649:[64336,64337],1655:[64477],1657:[64358,64359,64360,64361],1658:[64350,64351,64352,64353],1659:[64338,64339,64340,64341],1662:[64342,64343,64344,64345],1663:[64354,64355,64356,64357],1664:[64346,64347,64348,64349],1667:[64374,64375,64376,64377],1668:[64370,64371,64372,64373],1670:[64378,64379,64380,64381],1671:[64382,64383,64384,64385],1672:[64392,64393],1676:[64388,64389],1677:[64386,64387],1678:[64390,64391],1681:[64396,64397],1688:[64394,64395],1700:[64362,64363,64364,64365],1702:[64366,64367,64368,64369],1705:[64398,64399,64400,64401],1709:[64467,64468,64469,64470],1711:[64402,64403,64404,64405],1713:[64410,64411,64412,64413],1715:[64406,64407,64408,64409],1722:[64414,64415],1723:[64416,64417,64418,64419],1726:[64426,64427,64428,64429],1728:[64420,64421],1729:[64422,64423,64424,64425],1733:[64480,64481],1734:[64473,64474],1735:[64471,64472],1736:[64475,64476],1737:[64482,64483],1739:[64478,64479],1740:[64508,64509,64510,64511],1744:[64484,64485,64486,64487],1746:[64430,64431],1747:[64432,64433]},e={65247:{65154:65269,65156:65271,65160:65273,65166:65275},65248:{65154:65270,65156:65272,65160:65274,65166:65276},65165:{65247:{65248:{65258:65010}}},1617:{1612:64606,1613:64607,1614:64608,1615:64609,1616:64610}},s={1612:64606,1613:64607,1614:64608,1615:64609,1616:64610},i=[1570,1571,1573,1575];r.__arabicParser__={};var a=r.__arabicParser__.isInArabicSubstitutionA=function(g){return t[g.charCodeAt(0)]!==void 0},d=r.__arabicParser__.isArabicLetter=function(g){return typeof g=="string"&&/^[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]+$/.test(g)},o=r.__arabicParser__.isArabicEndLetter=function(g){return d(g)&&a(g)&&t[g.charCodeAt(0)].length<=2},c=r.__arabicParser__.isArabicAlfLetter=function(g){return d(g)&&i.indexOf(g.charCodeAt(0))>=0};r.__arabicParser__.arabicLetterHasIsolatedForm=function(g){return d(g)&&a(g)&&t[g.charCodeAt(0)].length>=1};var h=r.__arabicParser__.arabicLetterHasFinalForm=function(g){return d(g)&&a(g)&&t[g.charCodeAt(0)].length>=2};r.__arabicParser__.arabicLetterHasInitialForm=function(g){return d(g)&&a(g)&&t[g.charCodeAt(0)].length>=3};var p=r.__arabicParser__.arabicLetterHasMedialForm=function(g){return d(g)&&a(g)&&t[g.charCodeAt(0)].length==4},b=r.__arabicParser__.resolveLigatures=function(g){var N=0,y=e,S="",L=0;for(N=0;N<g.length;N+=1)y[g.charCodeAt(N)]!==void 0?(L++,typeof(y=y[g.charCodeAt(N)])=="number"&&(S+=String.fromCharCode(y),y=e,L=0),N===g.length-1&&(y=e,S+=g.charAt(N-(L-1)),N-=L-1,L=0)):(y=e,S+=g.charAt(N-L),N-=L,L=0);return S};r.__arabicParser__.isArabicDiacritic=function(g){return g!==void 0&&s[g.charCodeAt(0)]!==void 0};var m=r.__arabicParser__.getCorrectForm=function(g,N,y){return d(g)?a(g)===!1?-1:!h(g)||!d(N)&&!d(y)||!d(y)&&o(N)||o(g)&&!d(N)||o(g)&&c(N)||o(g)&&o(N)?0:p(g)&&d(N)&&!o(N)&&d(y)&&h(y)?3:o(g)||!d(y)?1:2:-1},u=function(g){var N=0,y=0,S=0,L="",E="",I="",K=(g=g||"").split("\\s+"),Y=[];for(N=0;N<K.length;N+=1){for(Y.push(""),y=0;y<K[N].length;y+=1)L=K[N][y],E=K[N][y-1],I=K[N][y+1],d(L)?(S=m(L,E,I),Y[N]+=S!==-1?String.fromCharCode(t[L.charCodeAt(0)][S]):L):Y[N]+=L;Y[N]=b(Y[N])}return Y.join(" ")},w=r.__arabicParser__.processArabic=r.processArabic=function(){var g,N=typeof arguments[0]=="string"?arguments[0]:arguments[0].text,y=[];if(Array.isArray(N)){var S=0;for(y=[],S=0;S<N.length;S+=1)Array.isArray(N[S])?y.push([u(N[S][0]),N[S][1],N[S][2]]):y.push([u(N[S])]);g=y}else g=u(N);return typeof arguments[0]=="string"?g:(arguments[0].text=g,arguments[0])};r.events.push(["preProcessText",w])})(Ut.API),Ut.API.autoPrint=function(r){var t;return(r=r||{}).variant=r.variant||"non-conform",r.variant==="javascript"?this.addJS("print({});"):(this.internal.events.subscribe("postPutResources",function(){t=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /Named"),this.internal.out("/Type /Action"),this.internal.out("/N /Print"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){this.internal.out("/OpenAction "+t+" 0 R")})),this},(function(r){var t=function(){var e=void 0;Object.defineProperty(this,"pdf",{get:function(){return e},set:function(o){e=o}});var s=150;Object.defineProperty(this,"width",{get:function(){return s},set:function(o){s=isNaN(o)||Number.isInteger(o)===!1||o<0?150:o,this.getContext("2d").pageWrapXEnabled&&(this.getContext("2d").pageWrapX=s+1)}});var i=300;Object.defineProperty(this,"height",{get:function(){return i},set:function(o){i=isNaN(o)||Number.isInteger(o)===!1||o<0?300:o,this.getContext("2d").pageWrapYEnabled&&(this.getContext("2d").pageWrapY=i+1)}});var a=[];Object.defineProperty(this,"childNodes",{get:function(){return a},set:function(o){a=o}});var d={};Object.defineProperty(this,"style",{get:function(){return d},set:function(o){d=o}}),Object.defineProperty(this,"parentNode",{})};t.prototype.getContext=function(e,s){var i;if((e=e||"2d")!=="2d")return null;for(i in s)this.pdf.context2d.hasOwnProperty(i)&&(this.pdf.context2d[i]=s[i]);return this.pdf.context2d._canvas=this,this.pdf.context2d},t.prototype.toDataURL=function(){throw new Error("toDataURL is not implemented.")},r.events.push(["initialized",function(){this.canvas=new t,this.canvas.pdf=this}])})(Ut.API),(function(r){var t={left:0,top:0,bottom:0,right:0},e=!1,s=function(){this.internal.__cell__===void 0&&(this.internal.__cell__={},this.internal.__cell__.padding=3,this.internal.__cell__.headerFunction=void 0,this.internal.__cell__.margins=Object.assign({},t),this.internal.__cell__.margins.width=this.getPageWidth(),i.call(this))},i=function(){this.internal.__cell__.lastCell=new a,this.internal.__cell__.pages=1},a=function(){var c=arguments[0];Object.defineProperty(this,"x",{enumerable:!0,get:function(){return c},set:function(g){c=g}});var h=arguments[1];Object.defineProperty(this,"y",{enumerable:!0,get:function(){return h},set:function(g){h=g}});var p=arguments[2];Object.defineProperty(this,"width",{enumerable:!0,get:function(){return p},set:function(g){p=g}});var b=arguments[3];Object.defineProperty(this,"height",{enumerable:!0,get:function(){return b},set:function(g){b=g}});var m=arguments[4];Object.defineProperty(this,"text",{enumerable:!0,get:function(){return m},set:function(g){m=g}});var u=arguments[5];Object.defineProperty(this,"lineNumber",{enumerable:!0,get:function(){return u},set:function(g){u=g}});var w=arguments[6];return Object.defineProperty(this,"align",{enumerable:!0,get:function(){return w},set:function(g){w=g}}),this};a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align)},a.prototype.toArray=function(){return[this.x,this.y,this.width,this.height,this.text,this.lineNumber,this.align]},r.setHeaderFunction=function(c){return s.call(this),this.internal.__cell__.headerFunction=typeof c=="function"?c:void 0,this},r.getTextDimensions=function(c,h){s.call(this);var p=(h=h||{}).fontSize||this.getFontSize(),b=h.font||this.getFont(),m=h.scaleFactor||this.internal.scaleFactor,u=0,w=0,g=0,N=this;if(!Array.isArray(c)&&typeof c!="string"){if(typeof c!="number")throw new Error("getTextDimensions expects text-parameter to be of type String or type Number or an Array of Strings.");c=String(c)}var y=h.maxWidth;y>0?typeof c=="string"?c=this.splitTextToSize(c,y):Object.prototype.toString.call(c)==="[object Array]"&&(c=c.reduce(function(L,E){return L.concat(N.splitTextToSize(E,y))},[])):c=Array.isArray(c)?c:[c];for(var S=0;S<c.length;S++)u<(g=this.getStringUnitWidth(c[S],{font:b})*p)&&(u=g);return u!==0&&(w=c.length),{w:u/=m,h:Math.max((w*p*this.getLineHeightFactor()-p*(this.getLineHeightFactor()-1))/m,0)}},r.cellAddPage=function(){s.call(this),this.addPage();var c=this.internal.__cell__.margins||t;return this.internal.__cell__.lastCell=new a(c.left,c.top,void 0,void 0),this.internal.__cell__.pages+=1,this};var d=r.cell=function(){var c;c=arguments[0]instanceof a?arguments[0]:new a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6]),s.call(this);var h=this.internal.__cell__.lastCell,p=this.internal.__cell__.padding,b=this.internal.__cell__.margins||t,m=this.internal.__cell__.tableHeaderRow,u=this.internal.__cell__.printHeaders;return h.lineNumber!==void 0&&(h.lineNumber===c.lineNumber?(c.x=(h.x||0)+(h.width||0),c.y=h.y||0):h.y+h.height+c.height+b.bottom>this.getPageHeight()?(this.cellAddPage(),c.y=b.top,u&&m&&(this.printHeaderRow(c.lineNumber,!0),c.y+=m[0].height)):c.y=h.y+h.height||c.y),c.text[0]!==void 0&&(this.rect(c.x,c.y,c.width,c.height,e===!0?"FD":void 0),c.align==="right"?this.text(c.text,c.x+c.width-p,c.y+p,{align:"right",baseline:"top"}):c.align==="center"?this.text(c.text,c.x+c.width/2,c.y+p,{align:"center",baseline:"top",maxWidth:c.width-p-p}):this.text(c.text,c.x+p,c.y+p,{align:"left",baseline:"top",maxWidth:c.width-p-p})),this.internal.__cell__.lastCell=c,this};r.table=function(c,h,p,b,m){if(s.call(this),!p)throw new Error("No data for PDF table.");var u,w,g,N,y=[],S=[],L=[],E={},I={},K=[],Y=[],V=(m=m||{}).autoSize||!1,O=m.printHeaders!==!1,Q=m.css&&m.css["font-size"]!==void 0?16*m.css["font-size"]:m.fontSize||12,F=m.margins||Object.assign({width:this.getPageWidth()},t),k=typeof m.padding=="number"?m.padding:3,M=m.headerBackgroundColor||"#c8c8c8",_=m.headerTextColor||"#000";if(i.call(this),this.internal.__cell__.printHeaders=O,this.internal.__cell__.margins=F,this.internal.__cell__.table_font_size=Q,this.internal.__cell__.padding=k,this.internal.__cell__.headerBackgroundColor=M,this.internal.__cell__.headerTextColor=_,this.setFontSize(Q),b==null)S=y=Object.keys(p[0]),L=y.map(function(){return"left"});else if(Array.isArray(b)&&Cr(b[0])==="object")for(y=b.map(function(je){return je.name}),S=b.map(function(je){return je.prompt||je.name||""}),L=b.map(function(je){return je.align||"left"}),u=0;u<b.length;u+=1)I[b[u].name]=.7499990551181103*b[u].width;else Array.isArray(b)&&typeof b[0]=="string"&&(S=y=b,L=y.map(function(){return"left"}));if(V||Array.isArray(b)&&typeof b[0]=="string")for(u=0;u<y.length;u+=1){for(E[N=y[u]]=p.map(function(je){return je[N]}),this.setFont(void 0,"bold"),K.push(this.getTextDimensions(S[u],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w),w=E[N],this.setFont(void 0,"normal"),g=0;g<w.length;g+=1)K.push(this.getTextDimensions(w[g],{fontSize:this.internal.__cell__.table_font_size,scaleFactor:this.internal.scaleFactor}).w);I[N]=Math.max.apply(null,K)+k+k,K=[]}if(O){var te={};for(u=0;u<y.length;u+=1)te[y[u]]={},te[y[u]].text=S[u],te[y[u]].align=L[u];var ae=o.call(this,te,I);Y=y.map(function(je){return new a(c,h,I[je],ae,te[je].text,void 0,te[je].align)}),this.setTableHeaderRow(Y),this.printHeaderRow(1,!1)}var re=b.reduce(function(je,ne){return je[ne.name]=ne.align,je},{});for(u=0;u<p.length;u+=1){"rowStart"in m&&m.rowStart instanceof Function&&m.rowStart({row:u,data:p[u]},this);var se=o.call(this,p[u],I);for(g=0;g<y.length;g+=1){var ie=p[u][y[g]];"cellStart"in m&&m.cellStart instanceof Function&&m.cellStart({row:u,col:g,data:ie},this),d.call(this,new a(c,h,I[y[g]],se,ie,u+2,re[y[g]]))}}return this.internal.__cell__.table_x=c,this.internal.__cell__.table_y=h,this};var o=function(c,h){var p=this.internal.__cell__.padding,b=this.internal.__cell__.table_font_size,m=this.internal.scaleFactor;return Object.keys(c).map(function(u){var w=c[u];return this.splitTextToSize(w.hasOwnProperty("text")?w.text:w,h[u]-p-p)},this).map(function(u){return this.getLineHeightFactor()*u.length*b/m+p+p},this).reduce(function(u,w){return Math.max(u,w)},0)};r.setTableHeaderRow=function(c){s.call(this),this.internal.__cell__.tableHeaderRow=c},r.printHeaderRow=function(c,h){if(s.call(this),!this.internal.__cell__.tableHeaderRow)throw new Error("Property tableHeaderRow does not exist.");var p;if(e=!0,typeof this.internal.__cell__.headerFunction=="function"){var b=this.internal.__cell__.headerFunction(this,this.internal.__cell__.pages);this.internal.__cell__.lastCell=new a(b[0],b[1],b[2],b[3],void 0,-1)}this.setFont(void 0,"bold");for(var m=[],u=0;u<this.internal.__cell__.tableHeaderRow.length;u+=1){p=this.internal.__cell__.tableHeaderRow[u].clone(),h&&(p.y=this.internal.__cell__.margins.top||0,m.push(p)),p.lineNumber=c;var w=this.getTextColor();this.setTextColor(this.internal.__cell__.headerTextColor),this.setFillColor(this.internal.__cell__.headerBackgroundColor),d.call(this,p),this.setTextColor(w)}m.length>0&&this.setTableHeaderRow(m),this.setFont(void 0,"normal"),e=!1}})(Ut.API);var Gf={italic:["italic","oblique","normal"],oblique:["oblique","italic","normal"],normal:["normal","oblique","italic"]},Yf=["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded"],Lc=Vf(Yf),Jf=[100,200,300,400,500,600,700,800,900],a2=Vf(Jf);function lc(r){var t=r.family.replace(/"|'/g,"").toLowerCase(),e=(function(a){return Gf[a=a||"normal"]?a:"normal"})(r.style),s=(function(a){return a?typeof a=="number"?a>=100&&a<=900&&a%100==0?a:400:/^\d00$/.test(a)?parseInt(a):a==="bold"?700:400:400})(r.weight),i=(function(a){return typeof Lc[a=a||"normal"]=="number"?a:"normal"})(r.stretch);return{family:t,style:e,weight:s,stretch:i,src:r.src||[],ref:r.ref||{name:t,style:[i,e,s].join(" ")}}}function Mu(r,t,e,s){var i;for(i=e;i>=0&&i<t.length;i+=s)if(r[t[i]])return r[t[i]];for(i=e;i>=0&&i<t.length;i-=s)if(r[t[i]])return r[t[i]]}var i2={"sans-serif":"helvetica",fixed:"courier",monospace:"courier",terminal:"courier",cursive:"times",fantasy:"times",serif:"times"},Uu={caption:"times",icon:"times",menu:"times","message-box":"times","small-caption":"times","status-bar":"times"};function zu(r){return[r.stretch,r.style,r.weight,r.family].join(" ")}function qu(r){return r.trimLeft()}function o2(r,t){for(var e=0;e<r.length;){if(r.charAt(e)===t)return[r.substring(0,e),r.substring(e+1)];e+=1}return null}function l2(r){var t=r.match(/^(-[a-z_]|[a-z_])[a-z0-9_-]*/i);return t===null?null:[t[0],r.substring(t[0].length)]}var Yo,$u,Wu,Si,Jo,Hu,Vu,Gu,cc=["times"];function Yu(r,t,e,s,i){var a=4,d=Zu;switch(i){case Ut.API.image_compression.FAST:a=1,d=Ju;break;case Ut.API.image_compression.MEDIUM:a=6,d=Ku;break;case Ut.API.image_compression.SLOW:a=9,d=Xu}r=(function(c,h,p,b){for(var m,u=c.length/h,w=new Uint8Array(c.length+u),g=[c2,Ju,Zu,Ku,Xu],N=0;N<u;N+=1){var y=N*h,S=c.subarray(y,y+h);if(b)w.set(b(S,p,m),y+N);else{for(var L=g.length,E=[],I=0;I<L;I+=1)E[I]=g[I](S,p,m);var K=u2(E.concat());w.set(E[K],y+N)}m=S}return w})(r,t,Math.ceil(e*s/8),d);var o=Nc(r,{level:a});return Ut.API.__addimage__.arrayBufferToBinaryString(o)}function c2(r){var t=Array.apply([],r);return t.unshift(0),t}function Ju(r,t){var e=r.length,s=[];s[0]=1;for(var i=0;i<e;i+=1){var a=r[i-t]||0;s[i+1]=r[i]-a+256&255}return s}function Zu(r,t,e){var s=r.length,i=[];i[0]=2;for(var a=0;a<s;a+=1){var d=e&&e[a]||0;i[a+1]=r[a]-d+256&255}return i}function Ku(r,t,e){var s=r.length,i=[];i[0]=3;for(var a=0;a<s;a+=1){var d=r[a-t]||0,o=e&&e[a]||0;i[a+1]=r[a]+256-(d+o>>>1)&255}return i}function Xu(r,t,e){var s=r.length,i=[];i[0]=4;for(var a=0;a<s;a+=1){var d=d2(r[a-t]||0,e&&e[a]||0,e&&e[a-t]||0);i[a+1]=r[a]-d+256&255}return i}function d2(r,t,e){if(r===t&&t===e)return r;var s=Math.abs(t-e),i=Math.abs(r-e),a=Math.abs(r+t-e-e);return s<=i&&s<=a?r:i<=a?t:e}function u2(r){var t=r.map(function(e){return e.reduce(function(s,i){return s+Math.abs(i)},0)});return t.indexOf(Math.min.apply(null,t))}function dc(r,t,e){var s=t*e,i=Math.floor(s/8),a=16-(s-8*i+e),d=(1<<e)-1;return Zf(r,i)>>a&d}function Qu(r,t,e,s){var i=e*s,a=Math.floor(i/8),d=16-(i-8*a+s),o=(1<<s)-1,c=(t&o)<<d;(function(h,p,b){if(p+1<h.byteLength)h.setUint16(p,b,!1);else{var m=b>>8&255;h.setUint8(p,m)}})(r,a,Zf(r,a)&~(o<<d)&65535|c)}function Zf(r,t){return t+1<r.byteLength?r.getUint16(t,!1):r.getUint8(t)<<8}function h2(r){var t=0;if(r[t++]!==71||r[t++]!==73||r[t++]!==70||r[t++]!==56||(r[t++]+1&253)!=56||r[t++]!==97)throw new Error("Invalid GIF 87a/89a header.");var e=r[t++]|r[t++]<<8,s=r[t++]|r[t++]<<8,i=r[t++],a=i>>7,d=1<<1+(7&i);r[t++],r[t++];var o=null,c=null;a&&(o=t,c=d,t+=3*d);var h=!0,p=[],b=0,m=null,u=0,w=null;for(this.width=e,this.height=s;h&&t<r.length;)switch(r[t++]){case 33:switch(r[t++]){case 255:if(r[t]!==11||r[t+1]==78&&r[t+2]==69&&r[t+3]==84&&r[t+4]==83&&r[t+5]==67&&r[t+6]==65&&r[t+7]==80&&r[t+8]==69&&r[t+9]==50&&r[t+10]==46&&r[t+11]==48&&r[t+12]==3&&r[t+13]==1&&r[t+16]==0)t+=14,w=r[t++]|r[t++]<<8,t++;else for(t+=12;;){if(!((F=r[t++])>=0))throw Error("Invalid block size");if(F===0)break;t+=F}break;case 249:if(r[t++]!==4||r[t+4]!==0)throw new Error("Invalid graphics extension block.");var g=r[t++];b=r[t++]|r[t++]<<8,m=r[t++],1&g||(m=null),u=g>>2&7,t++;break;case 254:for(;;){if(!((F=r[t++])>=0))throw Error("Invalid block size");if(F===0)break;t+=F}break;default:throw new Error("Unknown graphic control label: 0x"+r[t-1].toString(16))}break;case 44:var N=r[t++]|r[t++]<<8,y=r[t++]|r[t++]<<8,S=r[t++]|r[t++]<<8,L=r[t++]|r[t++]<<8,E=r[t++],I=E>>6&1,K=1<<1+(7&E),Y=o,V=c,O=!1;E>>7&&(O=!0,Y=t,V=K,t+=3*K);var Q=t;for(t++;;){var F;if(!((F=r[t++])>=0))throw Error("Invalid block size");if(F===0)break;t+=F}p.push({x:N,y,width:S,height:L,has_local_palette:O,palette_offset:Y,palette_size:V,data_offset:Q,data_length:t-Q,transparent_index:m,interlaced:!!I,delay:b,disposal:u});break;case 59:h=!1;break;default:throw new Error("Unknown gif block: 0x"+r[t-1].toString(16))}this.numFrames=function(){return p.length},this.loopCount=function(){return w},this.frameInfo=function(k){if(k<0||k>=p.length)throw new Error("Frame index out of range.");return p[k]},this.decodeAndBlitFrameBGRA=function(k,M){var _=this.frameInfo(k),te=_.width*_.height,ae=new Uint8Array(te);eh(r,_.data_offset,ae,te);var re=_.palette_offset,se=_.transparent_index;se===null&&(se=256);var ie=_.width,je=e-ie,ne=ie,A=4*(_.y*e+_.x),H=4*((_.y+_.height)*e+_.x),Z=A,X=4*je;_.interlaced===!0&&(X+=4*e*7);for(var pe=8,ve=0,ke=ae.length;ve<ke;++ve){var Ae=ae[ve];if(ne===0&&(ne=ie,(Z+=X)>=H&&(X=4*je+4*e*(pe-1),Z=A+(ie+je)*(pe<<1),pe>>=1)),Ae===se)Z+=4;else{var De=r[re+3*Ae],Me=r[re+3*Ae+1],Ke=r[re+3*Ae+2];M[Z++]=Ke,M[Z++]=Me,M[Z++]=De,M[Z++]=255}--ne}},this.decodeAndBlitFrameRGBA=function(k,M){var _=this.frameInfo(k),te=_.width*_.height,ae=new Uint8Array(te);eh(r,_.data_offset,ae,te);var re=_.palette_offset,se=_.transparent_index;se===null&&(se=256);var ie=_.width,je=e-ie,ne=ie,A=4*(_.y*e+_.x),H=4*((_.y+_.height)*e+_.x),Z=A,X=4*je;_.interlaced===!0&&(X+=4*e*7);for(var pe=8,ve=0,ke=ae.length;ve<ke;++ve){var Ae=ae[ve];if(ne===0&&(ne=ie,(Z+=X)>=H&&(X=4*je+4*e*(pe-1),Z=A+(ie+je)*(pe<<1),pe>>=1)),Ae===se)Z+=4;else{var De=r[re+3*Ae],Me=r[re+3*Ae+1],Ke=r[re+3*Ae+2];M[Z++]=De,M[Z++]=Me,M[Z++]=Ke,M[Z++]=255}--ne}}}function eh(r,t,e,s){for(var i=r[t++],a=1<<i,d=a+1,o=d+1,c=i+1,h=(1<<c)-1,p=0,b=0,m=0,u=r[t++],w=new Int32Array(4096),g=null;;){for(;p<16&&u!==0;)b|=r[t++]<<p,p+=8,u===1?u=r[t++]:--u;if(p<c)break;var N=b&h;if(b>>=c,p-=c,N!==a){if(N===d)break;for(var y=N<o?N:g,S=0,L=y;L>a;)L=w[L]>>8,++S;var E=L;if(m+S+(y!==N?1:0)>s)return void Ir.log("Warning, gif stream longer than expected.");e[m++]=E;var I=m+=S;for(y!==N&&(e[m++]=E),L=y;S--;)L=w[L],e[--I]=255&L,L>>=8;g!==null&&o<4096&&(w[o++]=g<<8|E,o>=h+1&&c<12&&(++c,h=h<<1|1)),g=N}else o=d+1,h=(1<<(c=i+1))-1,g=null}return m!==s&&Ir.log("Warning, gif stream shorter than expected."),e}/**
 * @license
  Copyright (c) 2008, Adobe Systems Incorporated
  All rights reserved.

  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are
  met:

  * Redistributions of source code must retain the above copyright notice, 
    this list of conditions and the following disclaimer.
  
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the 
    documentation and/or other materials provided with the distribution.
  
  * Neither the name of Adobe Systems Incorporated nor the names of its 
    contributors may be used to endorse or promote products derived from 
    this software without specific prior written permission.

  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS
  IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR 
  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/function uc(r){var t,e,s,i,a,d=Math.floor,o=new Array(64),c=new Array(64),h=new Array(64),p=new Array(64),b=new Array(65535),m=new Array(65535),u=new Array(64),w=new Array(64),g=[],N=0,y=7,S=new Array(64),L=new Array(64),E=new Array(64),I=new Array(256),K=new Array(2048),Y=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],V=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],O=[0,1,2,3,4,5,6,7,8,9,10,11],Q=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],F=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],k=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],M=[0,1,2,3,4,5,6,7,8,9,10,11],_=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],te=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function ae(A,H){for(var Z=0,X=0,pe=new Array,ve=1;ve<=16;ve++){for(var ke=1;ke<=A[ve];ke++)pe[H[X]]=[],pe[H[X]][0]=Z,pe[H[X]][1]=ve,X++,Z++;Z*=2}return pe}function re(A){for(var H=A[0],Z=A[1]-1;Z>=0;)H&1<<Z&&(N|=1<<y),Z--,--y<0&&(N==255?(se(255),se(0)):se(N),y=7,N=0)}function se(A){g.push(A)}function ie(A){se(A>>8&255),se(255&A)}function je(A,H,Z,X,pe){for(var ve,ke=pe[0],Ae=pe[240],De=(function(B,he){var me,de,Le,Ie,Te,Ye,ft,at,lt,bt,ut=0;for(lt=0;lt<8;++lt){me=B[ut],de=B[ut+1],Le=B[ut+2],Ie=B[ut+3],Te=B[ut+4],Ye=B[ut+5],ft=B[ut+6];var Yt=me+(at=B[ut+7]),gt=me-at,Et=de+ft,qt=de-ft,Pt=Le+Ye,vt=Le-Ye,Zt=Ie+Te,_t=Ie-Te,Ot=Yt+Zt,ir=Yt-Zt,Rt=Et+Pt,yt=Et-Pt;B[ut]=Ot+Rt,B[ut+4]=Ot-Rt;var Qt=.707106781*(yt+ir);B[ut+2]=ir+Qt,B[ut+6]=ir-Qt;var tr=.382683433*((Ot=_t+vt)-(yt=qt+gt)),Br=.5411961*Ot+tr,wn=1.306562965*yt+tr,rn=.707106781*(Rt=vt+qt),zt=gt+rn,mn=gt-rn;B[ut+5]=mn+Br,B[ut+3]=mn-Br,B[ut+1]=zt+wn,B[ut+7]=zt-wn,ut+=8}for(ut=0,lt=0;lt<8;++lt){me=B[ut],de=B[ut+8],Le=B[ut+16],Ie=B[ut+24],Te=B[ut+32],Ye=B[ut+40],ft=B[ut+48];var vn=me+(at=B[ut+56]),Yr=me-at,Wr=de+ft,yr=de-ft,Lr=Le+Ye,ur=Le-Ye,ns=Ie+Te,vr=Ie-Te,kn=vn+ns,nn=vn-ns,Cn=Wr+Lr,Hr=Wr-Lr;B[ut]=kn+Cn,B[ut+32]=kn-Cn;var Jr=.707106781*(Hr+nn);B[ut+16]=nn+Jr,B[ut+48]=nn-Jr;var Pn=.382683433*((kn=vr+ur)-(Hr=yr+Yr)),ct=.5411961*kn+Pn,Zr=1.306562965*Hr+Pn,ye=.707106781*(Cn=ur+yr),qe=Yr+ye,He=Yr-ye;B[ut+40]=He+ct,B[ut+24]=He-ct,B[ut+8]=qe+Zr,B[ut+56]=qe-Zr,ut++}for(lt=0;lt<64;++lt)bt=B[lt]*he[lt],u[lt]=bt>0?bt+.5|0:bt-.5|0;return u})(A,H),Me=0;Me<64;++Me)w[Y[Me]]=De[Me];var Ke=w[0]-Z;Z=w[0],Ke==0?re(X[0]):(re(X[m[ve=32767+Ke]]),re(b[ve]));for(var Se=63;Se>0&&w[Se]==0;)Se--;if(Se==0)return re(ke),Z;for(var j,P=1;P<=Se;){for(var G=P;w[P]==0&&P<=Se;)++P;var $=P-G;if($>=16){j=$>>4;for(var z=1;z<=j;++z)re(Ae);$&=15}ve=32767+w[P],re(pe[($<<4)+m[ve]]),re(b[ve]),P++}return Se!=63&&re(ke),Z}function ne(A){A=Math.min(Math.max(A,1),100),a!=A&&((function(H){for(var Z=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99],X=0;X<64;X++){var pe=d((Z[X]*H+50)/100);pe=Math.min(Math.max(pe,1),255),o[Y[X]]=pe}for(var ve=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99],ke=0;ke<64;ke++){var Ae=d((ve[ke]*H+50)/100);Ae=Math.min(Math.max(Ae,1),255),c[Y[ke]]=Ae}for(var De=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379],Me=0,Ke=0;Ke<8;Ke++)for(var Se=0;Se<8;Se++)h[Me]=1/(o[Y[Me]]*De[Ke]*De[Se]*8),p[Me]=1/(c[Y[Me]]*De[Ke]*De[Se]*8),Me++})(A<50?Math.floor(5e3/A):Math.floor(200-2*A)),a=A)}this.encode=function(A,H){H&&ne(H),g=new Array,N=0,y=7,ie(65496),ie(65504),ie(16),se(74),se(70),se(73),se(70),se(0),se(1),se(1),se(0),ie(1),ie(1),se(0),se(0),(function(){ie(65499),ie(132),se(0);for(var de=0;de<64;de++)se(o[de]);se(1);for(var Le=0;Le<64;Le++)se(c[Le])})(),(function(de,Le){ie(65472),ie(17),se(8),ie(Le),ie(de),se(3),se(1),se(17),se(0),se(2),se(17),se(1),se(3),se(17),se(1)})(A.width,A.height),(function(){ie(65476),ie(418),se(0);for(var de=0;de<16;de++)se(V[de+1]);for(var Le=0;Le<=11;Le++)se(O[Le]);se(16);for(var Ie=0;Ie<16;Ie++)se(Q[Ie+1]);for(var Te=0;Te<=161;Te++)se(F[Te]);se(1);for(var Ye=0;Ye<16;Ye++)se(k[Ye+1]);for(var ft=0;ft<=11;ft++)se(M[ft]);se(17);for(var at=0;at<16;at++)se(_[at+1]);for(var lt=0;lt<=161;lt++)se(te[lt])})(),ie(65498),ie(12),se(3),se(1),se(0),se(2),se(17),se(3),se(17),se(0),se(63),se(0);var Z=0,X=0,pe=0;N=0,y=7,this.encode.displayName="_encode_";for(var ve,ke,Ae,De,Me,Ke,Se,j,P,G=A.data,$=A.width,z=A.height,B=4*$,he=0;he<z;){for(ve=0;ve<B;){for(Me=B*he+ve,Se=-1,j=0,P=0;P<64;P++)Ke=Me+(j=P>>3)*B+(Se=4*(7&P)),he+j>=z&&(Ke-=B*(he+1+j-z)),ve+Se>=B&&(Ke-=ve+Se-B+4),ke=G[Ke++],Ae=G[Ke++],De=G[Ke++],S[P]=(K[ke]+K[Ae+256|0]+K[De+512|0]>>16)-128,L[P]=(K[ke+768|0]+K[Ae+1024|0]+K[De+1280|0]>>16)-128,E[P]=(K[ke+1280|0]+K[Ae+1536|0]+K[De+1792|0]>>16)-128;Z=je(S,h,Z,t,s),X=je(L,p,X,e,i),pe=je(E,p,pe,e,i),ve+=32}he+=8}if(y>=0){var me=[];me[1]=y+1,me[0]=(1<<y+1)-1,re(me)}return ie(65497),new Uint8Array(g)},r=r||50,(function(){for(var A=String.fromCharCode,H=0;H<256;H++)I[H]=A(H)})(),t=ae(V,O),e=ae(k,M),s=ae(Q,F),i=ae(_,te),(function(){for(var A=1,H=2,Z=1;Z<=15;Z++){for(var X=A;X<H;X++)m[32767+X]=Z,b[32767+X]=[],b[32767+X][1]=Z,b[32767+X][0]=X;for(var pe=-(H-1);pe<=-A;pe++)m[32767+pe]=Z,b[32767+pe]=[],b[32767+pe][1]=Z,b[32767+pe][0]=H-1+pe;A<<=1,H<<=1}})(),(function(){for(var A=0;A<256;A++)K[A]=19595*A,K[A+256|0]=38470*A,K[A+512|0]=7471*A+32768,K[A+768|0]=-11059*A,K[A+1024|0]=-21709*A,K[A+1280|0]=32768*A+8421375,K[A+1536|0]=-27439*A,K[A+1792|0]=-5329*A})(),ne(r)}/**
 * @license
 * Copyright (c) 2017 Aras Abbasi
 *
 * Licensed under the MIT License.
 * http://opensource.org/licenses/mit-license
 */function Fs(r,t){if(this.pos=0,this.buffer=r,this.datav=new DataView(r.buffer),this.is_with_alpha=!!t,this.bottom_up=!0,this.flag=String.fromCharCode(this.buffer[0])+String.fromCharCode(this.buffer[1]),this.pos+=2,["BM","BA","CI","CP","IC","PT"].indexOf(this.flag)===-1)throw new Error("Invalid BMP File");this.parseHeader(),this.parseBGR()}function th(r){function t(O){if(!O)throw Error("assert :P")}function e(O,Q,F){for(var k=0;4>k;k++)if(O[Q+k]!=F.charCodeAt(k))return!0;return!1}function s(O,Q,F,k,M){for(var _=0;_<M;_++)O[Q+_]=F[k+_]}function i(O,Q,F,k){for(var M=0;M<k;M++)O[Q+M]=F}function a(O){return new Int32Array(O)}function d(O,Q){for(var F=[],k=0;k<O;k++)F.push(new Q);return F}function o(O,Q){var F=[];return(function k(M,_,te){for(var ae=te[_],re=0;re<ae&&(M.push(te.length>_+1?[]:new Q),!(te.length<_+1));re++)k(M[re],_+1,te)})(F,0,O),F}var c=function(){var O=this;function Q(l,f){for(var v=1<<f-1>>>0;l&v;)v>>>=1;return v?(l&v-1)+v:l}function F(l,f,v,C,D){t(!(C%v));do l[f+(C-=v)]=D;while(0<C)}function k(l,f,v,C,D){if(t(2328>=D),512>=D)var q=a(512);else if((q=a(D))==null)return 0;return(function(W,J,ee,le,_e,Re){var ce,Ce,Pe=J,Ue=1<<ee,Oe=a(16),We=a(16);for(t(_e!=0),t(le!=null),t(W!=null),t(0<ee),Ce=0;Ce<_e;++Ce){if(15<le[Ce])return 0;++Oe[le[Ce]]}if(Oe[0]==_e)return 0;for(We[1]=0,ce=1;15>ce;++ce){if(Oe[ce]>1<<ce)return 0;We[ce+1]=We[ce]+Oe[ce]}for(Ce=0;Ce<_e;++Ce)ce=le[Ce],0<le[Ce]&&(Re[We[ce]++]=Ce);if(We[15]==1)return(le=new M).g=0,le.value=Re[0],F(W,Pe,1,Ue,le),Ue;var Je,st=-1,tt=Ue-1,Mt=0,kt=1,sr=1,It=1<<ee;for(Ce=0,ce=1,_e=2;ce<=ee;++ce,_e<<=1){if(kt+=sr<<=1,0>(sr-=Oe[ce]))return 0;for(;0<Oe[ce];--Oe[ce])(le=new M).g=ce,le.value=Re[Ce++],F(W,Pe+Mt,_e,It,le),Mt=Q(Mt,ce)}for(ce=ee+1,_e=2;15>=ce;++ce,_e<<=1){if(kt+=sr<<=1,0>(sr-=Oe[ce]))return 0;for(;0<Oe[ce];--Oe[ce]){if(le=new M,(Mt&tt)!=st){for(Pe+=It,Je=1<<(st=ce)-ee;15>st&&!(0>=(Je-=Oe[st]));)++st,Je<<=1;Ue+=It=1<<(Je=st-ee),W[J+(st=Mt&tt)].g=Je+ee,W[J+st].value=Pe-J-st}le.g=ce-ee,le.value=Re[Ce++],F(W,Pe+(Mt>>ee),_e,It,le),Mt=Q(Mt,ce)}}return kt!=2*We[15]-1?0:Ue})(l,f,v,C,D,q)}function M(){this.value=this.g=0}function _(){this.value=this.g=0}function te(){this.G=d(5,M),this.H=a(5),this.jc=this.Qb=this.qb=this.nd=0,this.pd=d(Za,_)}function ae(l,f,v,C){t(l!=null),t(f!=null),t(2147483648>C),l.Ca=254,l.I=0,l.b=-8,l.Ka=0,l.oa=f,l.pa=v,l.Jd=f,l.Yc=v+C,l.Zc=4<=C?v+C-4+1:v,ke(l)}function re(l,f){for(var v=0;0<f--;)v|=De(l,128)<<f;return v}function se(l,f){var v=re(l,f);return Ae(l)?-v:v}function ie(l,f,v,C){var D,q=0;for(t(l!=null),t(f!=null),t(4294967288>C),l.Sb=C,l.Ra=0,l.u=0,l.h=0,4<C&&(C=4),D=0;D<C;++D)q+=f[v+D]<<8*D;l.Ra=q,l.bb=C,l.oa=f,l.pa=v}function je(l){for(;8<=l.u&&l.bb<l.Sb;)l.Ra>>>=8,l.Ra+=l.oa[l.pa+l.bb]<<Ca-8>>>0,++l.bb,l.u-=8;X(l)&&(l.h=1,l.u=0)}function ne(l,f){if(t(0<=f),!l.h&&f<=is){var v=Z(l)&as[f];return l.u+=f,je(l),v}return l.h=1,l.u=0}function A(){this.b=this.Ca=this.I=0,this.oa=[],this.pa=0,this.Jd=[],this.Yc=0,this.Zc=[],this.Ka=0}function H(){this.Ra=0,this.oa=[],this.h=this.u=this.bb=this.Sb=this.pa=0}function Z(l){return l.Ra>>>(l.u&Ca-1)>>>0}function X(l){return t(l.bb<=l.Sb),l.h||l.bb==l.Sb&&l.u>Ca}function pe(l,f){l.u=f,l.h=X(l)}function ve(l){l.u>=ca&&(t(l.u>=ca),je(l))}function ke(l){t(l!=null&&l.oa!=null),l.pa<l.Zc?(l.I=(l.oa[l.pa++]|l.I<<8)>>>0,l.b+=8):(t(l!=null&&l.oa!=null),l.pa<l.Yc?(l.b+=8,l.I=l.oa[l.pa++]|l.I<<8):l.Ka?l.b=0:(l.I<<=8,l.b+=8,l.Ka=1))}function Ae(l){return re(l,1)}function De(l,f){var v=l.Ca;0>l.b&&ke(l);var C=l.b,D=v*f>>>8,q=(l.I>>>C>D)+0;for(q?(v-=D,l.I-=D+1<<C>>>0):v=D+1,C=v,D=0;256<=C;)D+=8,C>>=8;return C=7^D+Aa[C],l.b-=C,l.Ca=(v<<C)-1,q}function Me(l,f,v){l[f+0]=v>>24&255,l[f+1]=v>>16&255,l[f+2]=v>>8&255,l[f+3]=255&v}function Ke(l,f){return l[f+0]|l[f+1]<<8}function Se(l,f){return Ke(l,f)|l[f+2]<<16}function j(l,f){return Ke(l,f)|Ke(l,f+2)<<16}function P(l,f){var v=1<<f;return t(l!=null),t(0<f),l.X=a(v),l.X==null?0:(l.Mb=32-f,l.Xa=f,1)}function G(l,f){t(l!=null),t(f!=null),t(l.Xa==f.Xa),s(f.X,0,l.X,0,1<<f.Xa)}function $(){this.X=[],this.Xa=this.Mb=0}function z(l,f,v,C){t(v!=null),t(C!=null);var D=v[0],q=C[0];return D==0&&(D=(l*q+f/2)/f),q==0&&(q=(f*D+l/2)/l),0>=D||0>=q?0:(v[0]=D,C[0]=q,1)}function B(l,f){return l+(1<<f)-1>>>f}function he(l,f){return((4278255360&l)+(4278255360&f)>>>0&4278255360)+((16711935&l)+(16711935&f)>>>0&16711935)>>>0}function me(l,f){O[f]=function(v,C,D,q,W,J,ee){var le;for(le=0;le<W;++le){var _e=O[l](J[ee+le-1],D,q+le);J[ee+le]=he(v[C+le],_e)}}}function de(){this.ud=this.hd=this.jd=0}function Le(l,f){return((4278124286&(l^f))>>>1)+(l&f)>>>0}function Ie(l){return 0<=l&&256>l?l:0>l?0:255<l?255:void 0}function Te(l,f){return Ie(l+(l-f+.5>>1))}function Ye(l,f,v){return Math.abs(f-v)-Math.abs(l-v)}function ft(l,f,v,C,D,q,W){for(C=q[W-1],v=0;v<D;++v)q[W+v]=C=he(l[f+v],C)}function at(l,f,v,C,D){var q;for(q=0;q<v;++q){var W=l[f+q],J=W>>8&255,ee=16711935&(ee=(ee=16711935&W)+((J<<16)+J));C[D+q]=(4278255360&W)+ee>>>0}}function lt(l,f){f.jd=255&l,f.hd=l>>8&255,f.ud=l>>16&255}function bt(l,f,v,C,D,q){var W;for(W=0;W<C;++W){var J=f[v+W],ee=J>>>8,le=J,_e=255&(_e=(_e=J>>>16)+((l.jd<<24>>24)*(ee<<24>>24)>>>5));le=255&(le=(le+=(l.hd<<24>>24)*(ee<<24>>24)>>>5)+((l.ud<<24>>24)*(_e<<24>>24)>>>5)),D[q+W]=(4278255360&J)+(_e<<16)+le}}function ut(l,f,v,C,D){O[f]=function(q,W,J,ee,le,_e,Re,ce,Ce){for(ee=Re;ee<ce;++ee)for(Re=0;Re<Ce;++Re)le[_e++]=D(J[C(q[W++])])},O[l]=function(q,W,J,ee,le,_e,Re){var ce=8>>q.b,Ce=q.Ea,Pe=q.K[0],Ue=q.w;if(8>ce)for(q=(1<<q.b)-1,Ue=(1<<ce)-1;W<J;++W){var Oe,We=0;for(Oe=0;Oe<Ce;++Oe)Oe&q||(We=C(ee[le++])),_e[Re++]=D(Pe[We&Ue]),We>>=ce}else O["VP8LMapColor"+v](ee,le,Pe,Ue,_e,Re,W,J,Ce)}}function Yt(l,f,v,C,D){for(v=f+v;f<v;){var q=l[f++];C[D++]=q>>16&255,C[D++]=q>>8&255,C[D++]=255&q}}function gt(l,f,v,C,D){for(v=f+v;f<v;){var q=l[f++];C[D++]=q>>16&255,C[D++]=q>>8&255,C[D++]=255&q,C[D++]=q>>24&255}}function Et(l,f,v,C,D){for(v=f+v;f<v;){var q=(W=l[f++])>>16&240|W>>12&15,W=240&W|W>>28&15;C[D++]=q,C[D++]=W}}function qt(l,f,v,C,D){for(v=f+v;f<v;){var q=(W=l[f++])>>16&248|W>>13&7,W=W>>5&224|W>>3&31;C[D++]=q,C[D++]=W}}function Pt(l,f,v,C,D){for(v=f+v;f<v;){var q=l[f++];C[D++]=255&q,C[D++]=q>>8&255,C[D++]=q>>16&255}}function vt(l,f,v,C,D,q){if(q==0)for(v=f+v;f<v;)Me(C,((q=l[f++])[0]>>24|q[1]>>8&65280|q[2]<<8&16711680|q[3]<<24)>>>0),D+=32;else s(C,D,l,f,v)}function Zt(l,f){O[f][0]=O[l+"0"],O[f][1]=O[l+"1"],O[f][2]=O[l+"2"],O[f][3]=O[l+"3"],O[f][4]=O[l+"4"],O[f][5]=O[l+"5"],O[f][6]=O[l+"6"],O[f][7]=O[l+"7"],O[f][8]=O[l+"8"],O[f][9]=O[l+"9"],O[f][10]=O[l+"10"],O[f][11]=O[l+"11"],O[f][12]=O[l+"12"],O[f][13]=O[l+"13"],O[f][14]=O[l+"0"],O[f][15]=O[l+"0"]}function _t(l){return l==Sl||l==kl||l==So||l==Cl}function Ot(){this.eb=[],this.size=this.A=this.fb=0}function ir(){this.y=[],this.f=[],this.ea=[],this.F=[],this.Tc=this.Ed=this.Cd=this.Fd=this.lb=this.Db=this.Ab=this.fa=this.J=this.W=this.N=this.O=0}function Rt(){this.Rd=this.height=this.width=this.S=0,this.f={},this.f.RGBA=new Ot,this.f.kb=new ir,this.sd=null}function yt(){this.width=[0],this.height=[0],this.Pd=[0],this.Qd=[0],this.format=[0]}function Qt(){this.Id=this.fd=this.Md=this.hb=this.ib=this.da=this.bd=this.cd=this.j=this.v=this.Da=this.Sd=this.ob=0}function tr(l){return alert("todo:WebPSamplerProcessPlane"),l.T}function Br(l,f){var v=l.T,C=f.ba.f.RGBA,D=C.eb,q=C.fb+l.ka*C.A,W=js[f.ba.S],J=l.y,ee=l.O,le=l.f,_e=l.N,Re=l.ea,ce=l.W,Ce=f.cc,Pe=f.dc,Ue=f.Mc,Oe=f.Nc,We=l.ka,Je=l.ka+l.T,st=l.U,tt=st+1>>1;for(We==0?W(J,ee,null,null,le,_e,Re,ce,le,_e,Re,ce,D,q,null,null,st):(W(f.ec,f.fc,J,ee,Ce,Pe,Ue,Oe,le,_e,Re,ce,D,q-C.A,D,q,st),++v);We+2<Je;We+=2)Ce=le,Pe=_e,Ue=Re,Oe=ce,_e+=l.Rc,ce+=l.Rc,q+=2*C.A,W(J,(ee+=2*l.fa)-l.fa,J,ee,Ce,Pe,Ue,Oe,le,_e,Re,ce,D,q-C.A,D,q,st);return ee+=l.fa,l.j+Je<l.o?(s(f.ec,f.fc,J,ee,st),s(f.cc,f.dc,le,_e,tt),s(f.Mc,f.Nc,Re,ce,tt),v--):1&Je||W(J,ee,null,null,le,_e,Re,ce,le,_e,Re,ce,D,q+C.A,null,null,st),v}function wn(l,f,v){var C=l.F,D=[l.J];if(C!=null){var q=l.U,W=f.ba.S,J=W==jo||W==So;f=f.ba.f.RGBA;var ee=[0],le=l.ka;ee[0]=l.T,l.Kb&&(le==0?--ee[0]:(--le,D[0]-=l.width),l.j+l.ka+l.T==l.o&&(ee[0]=l.o-l.j-le));var _e=f.eb;le=f.fb+le*f.A,l=rd(C,D[0],l.width,q,ee,_e,le+(J?0:3),f.A),t(v==ee),l&&_t(W)&&Qi(_e,le,J,q,ee,f.A)}return 0}function rn(l){var f=l.ma,v=f.ba.S,C=11>v,D=v==No||v==_o||v==jo||v==jl||v==12||_t(v);if(f.memory=null,f.Ib=null,f.Jb=null,f.Nd=null,!la(f.Oa,l,D?11:12))return 0;if(D&&_t(v)&&ht(),l.da)alert("todo:use_scaling");else{if(C){if(f.Ib=tr,l.Kb){if(v=l.U+1>>1,f.memory=a(l.U+2*v),f.memory==null)return 0;f.ec=f.memory,f.fc=0,f.cc=f.ec,f.dc=f.fc+l.U,f.Mc=f.cc,f.Nc=f.dc+v,f.Ib=Br,ht()}}else alert("todo:EmitYUV");D&&(f.Jb=wn,C&&$e())}if(C&&!yd){for(l=0;256>l;++l)Tp[l]=89858*(l-128)+Co>>ko,Op[l]=-22014*(l-128)+Co,Fp[l]=-45773*(l-128),Ip[l]=113618*(l-128)+Co>>ko;for(l=to;l<El;++l)f=76283*(l-16)+Co>>ko,Rp[l-to]=or(f,255),Dp[l-to]=or(f+8>>4,15);yd=1}return 1}function zt(l){var f=l.ma,v=l.U,C=l.T;return t(!(1&l.ka)),0>=v||0>=C?0:(v=f.Ib(l,f),f.Jb!=null&&f.Jb(l,f,v),f.Dc+=v,1)}function mn(l){l.ma.memory=null}function vn(l,f,v,C){return ne(l,8)!=47?0:(f[0]=ne(l,14)+1,v[0]=ne(l,14)+1,C[0]=ne(l,1),ne(l,3)!=0?0:!l.h)}function Yr(l,f){if(4>l)return l+1;var v=l-2>>1;return(2+(1&l)<<v)+ne(f,v)+1}function Wr(l,f){return 120<f?f-120:1<=(v=((v=yp[f-1])>>4)*l+(8-(15&v)))?v:1;var v}function yr(l,f,v){var C=Z(v),D=l[f+=255&C].g-8;return 0<D&&(pe(v,v.u+8),C=Z(v),f+=l[f].value,f+=C&(1<<D)-1),pe(v,v.u+l[f].g),l[f].value}function Lr(l,f,v){return v.g+=l.g,v.value+=l.value<<f>>>0,t(8>=v.g),l.g}function ur(l,f,v){var C=l.xc;return t((f=C==0?0:l.vc[l.md*(v>>C)+(f>>C)])<l.Wb),l.Ya[f]}function ns(l,f,v,C){var D=l.ab,q=l.c*f,W=l.C;f=W+f;var J=v,ee=C;for(C=l.Ta,v=l.Ua;0<D--;){var le=l.gc[D],_e=W,Re=f,ce=J,Ce=ee,Pe=(ee=C,J=v,le.Ea);switch(t(_e<Re),t(Re<=le.nc),le.hc){case 2:sn(ce,Ce,(Re-_e)*Pe,ee,J);break;case 0:var Ue=_e,Oe=Re,We=ee,Je=J,st=(It=le).Ea;Ue==0&&(Gi(ce,Ce,null,null,1,We,Je),ft(ce,Ce+1,0,0,st-1,We,Je+1),Ce+=st,Je+=st,++Ue);for(var tt=1<<It.b,Mt=tt-1,kt=B(st,It.b),sr=It.K,It=It.w+(Ue>>It.b)*kt;Ue<Oe;){var cr=sr,xn=It,ar=1;for(bi(ce,Ce,We,Je-st,1,We,Je);ar<st;){var Ft=(ar&~Mt)+tt;Ft>st&&(Ft=st),(0,Ji[cr[xn++]>>8&15])(ce,Ce+ +ar,We,Je+ar-st,Ft-ar,We,Je+ar),ar=Ft}Ce+=st,Je+=st,++Ue&Mt||(It+=kt)}Re!=le.nc&&s(ee,J-Pe,ee,J+(Re-_e-1)*Pe,Pe);break;case 1:for(Pe=ce,Oe=Ce,st=(ce=le.Ea)-(Je=ce&~(We=(Ce=1<<le.b)-1)),Ue=B(ce,le.b),tt=le.K,le=le.w+(_e>>le.b)*Ue;_e<Re;){for(Mt=tt,kt=le,sr=new de,It=Oe+Je,cr=Oe+ce;Oe<It;)lt(Mt[kt++],sr),Zi(sr,Pe,Oe,Ce,ee,J),Oe+=Ce,J+=Ce;Oe<cr&&(lt(Mt[kt++],sr),Zi(sr,Pe,Oe,st,ee,J),Oe+=st,J+=st),++_e&We||(le+=Ue)}break;case 3:if(ce==ee&&Ce==J&&0<le.b){for(Oe=ee,ce=Pe=J+(Re-_e)*Pe-(Je=(Re-_e)*B(le.Ea,le.b)),Ce=ee,We=J,Ue=[],Je=(st=Je)-1;0<=Je;--Je)Ue[Je]=Ce[We+Je];for(Je=st-1;0<=Je;--Je)Oe[ce+Je]=Ue[Je];yo(le,_e,Re,ee,Pe,ee,J)}else yo(le,_e,Re,ce,Ce,ee,J)}J=C,ee=v}ee!=v&&s(C,v,J,ee,q)}function vr(l,f){var v=l.V,C=l.Ba+l.c*l.C,D=f-l.C;if(t(f<=l.l.o),t(16>=D),0<D){var q=l.l,W=l.Ta,J=l.Ua,ee=q.width;if(ns(l,D,v,C),D=J=[J],t((v=l.C)<(C=f)),t(q.v<q.va),C>q.o&&(C=q.o),v<q.j){var le=q.j-v;v=q.j,D[0]+=le*ee}if(v>=C?v=0:(D[0]+=4*q.v,q.ka=v-q.j,q.U=q.va-q.v,q.T=C-v,v=1),v){if(J=J[0],11>(v=l.ca).S){var _e=v.f.RGBA,Re=(C=v.S,D=q.U,q=q.T,le=_e.eb,_e.A),ce=q;for(_e=_e.fb+l.Ma*_e.A;0<ce--;){var Ce=W,Pe=J,Ue=D,Oe=le,We=_e;switch(C){case vo:Ki(Ce,Pe,Ue,Oe,We);break;case No:La(Ce,Pe,Ue,Oe,We);break;case Sl:La(Ce,Pe,Ue,Oe,We),Qi(Oe,We,0,Ue,1,0);break;case cd:Ka(Ce,Pe,Ue,Oe,We);break;case _o:vt(Ce,Pe,Ue,Oe,We,1);break;case kl:vt(Ce,Pe,Ue,Oe,We,1),Qi(Oe,We,0,Ue,1,0);break;case jo:vt(Ce,Pe,Ue,Oe,We,0);break;case So:vt(Ce,Pe,Ue,Oe,We,0),Qi(Oe,We,1,Ue,1,0);break;case jl:Ea(Ce,Pe,Ue,Oe,We);break;case Cl:Ea(Ce,Pe,Ue,Oe,We),td(Oe,We,Ue,1,0);break;case dd:Pa(Ce,Pe,Ue,Oe,We);break;default:t(0)}J+=ee,_e+=Re}l.Ma+=q}else alert("todo:EmitRescaledRowsYUVA");t(l.Ma<=v.height)}}l.C=f,t(l.C<=l.i)}function kn(l){var f;if(0<l.ua)return 0;for(f=0;f<l.Wb;++f){var v=l.Ya[f].G,C=l.Ya[f].H;if(0<v[1][C[1]+0].g||0<v[2][C[2]+0].g||0<v[3][C[3]+0].g)return 0}return 1}function nn(l,f,v,C,D,q){if(l.Z!=0){var W=l.qd,J=l.rd;for(t(Fa[l.Z]!=null);f<v;++f)Fa[l.Z](W,J,C,D,C,D,q),W=C,J=D,D+=q;l.qd=W,l.rd=J}}function Cn(l,f){var v=l.l.ma,C=v.Z==0||v.Z==1?l.l.j:l.C;if(C=l.C<C?C:l.C,t(f<=l.l.o),f>C){var D=l.l.width,q=v.ca,W=v.tb+D*C,J=l.V,ee=l.Ba+l.c*C,le=l.gc;t(l.ab==1),t(le[0].hc==3),Gs(le[0],C,f,J,ee,q,W),nn(v,C,f,q,W,D)}l.C=l.Ma=f}function Hr(l,f,v,C,D,q,W){var J=l.$/C,ee=l.$%C,le=l.m,_e=l.s,Re=v+l.$,ce=Re;D=v+C*D;var Ce=v+C*q,Pe=280+_e.ua,Ue=l.Pb?J:16777216,Oe=0<_e.ua?_e.Wa:null,We=_e.wc,Je=Re<Ce?ur(_e,ee,J):null;t(l.C<q),t(Ce<=D);var st=!1;e:for(;;){for(;st||Re<Ce;){var tt=0;if(J>=Ue){var Mt=Re-v;t((Ue=l).Pb),Ue.wd=Ue.m,Ue.xd=Mt,0<Ue.s.ua&&G(Ue.s.Wa,Ue.s.vb),Ue=J+wp}if(ee&We||(Je=ur(_e,ee,J)),t(Je!=null),Je.Qb&&(f[Re]=Je.qb,st=!0),!st)if(ve(le),Je.jc){tt=le,Mt=f;var kt=Re,sr=Je.pd[Z(tt)&Za-1];t(Je.jc),256>sr.g?(pe(tt,tt.u+sr.g),Mt[kt]=sr.value,tt=0):(pe(tt,tt.u+sr.g-256),t(256<=sr.value),tt=sr.value),tt==0&&(st=!0)}else tt=yr(Je.G[0],Je.H[0],le);if(le.h)break;if(st||256>tt){if(!st)if(Je.nd)f[Re]=(Je.qb|tt<<8)>>>0;else{if(ve(le),st=yr(Je.G[1],Je.H[1],le),ve(le),Mt=yr(Je.G[2],Je.H[2],le),kt=yr(Je.G[3],Je.H[3],le),le.h)break;f[Re]=(kt<<24|st<<16|tt<<8|Mt)>>>0}if(st=!1,++Re,++ee>=C&&(ee=0,++J,W!=null&&J<=q&&!(J%16)&&W(l,J),Oe!=null))for(;ce<Re;)tt=f[ce++],Oe.X[(506832829*tt&4294967295)>>>Oe.Mb]=tt}else if(280>tt){if(tt=Yr(tt-256,le),Mt=yr(Je.G[4],Je.H[4],le),ve(le),Mt=Wr(C,Mt=Yr(Mt,le)),le.h)break;if(Re-v<Mt||D-Re<tt)break e;for(kt=0;kt<tt;++kt)f[Re+kt]=f[Re+kt-Mt];for(Re+=tt,ee+=tt;ee>=C;)ee-=C,++J,W!=null&&J<=q&&!(J%16)&&W(l,J);if(t(Re<=D),ee&We&&(Je=ur(_e,ee,J)),Oe!=null)for(;ce<Re;)tt=f[ce++],Oe.X[(506832829*tt&4294967295)>>>Oe.Mb]=tt}else{if(!(tt<Pe))break e;for(st=tt-280,t(Oe!=null);ce<Re;)tt=f[ce++],Oe.X[(506832829*tt&4294967295)>>>Oe.Mb]=tt;tt=Re,t(!(st>>>(Mt=Oe).Xa)),f[tt]=Mt.X[st],st=!0}st||t(le.h==X(le))}if(l.Pb&&le.h&&Re<D)t(l.m.h),l.a=5,l.m=l.wd,l.$=l.xd,0<l.s.ua&&G(l.s.vb,l.s.Wa);else{if(le.h)break e;W!=null&&W(l,J>q?q:J),l.a=0,l.$=Re-v}return 1}return l.a=3,0}function Jr(l){t(l!=null),l.vc=null,l.yc=null,l.Ya=null;var f=l.Wa;f!=null&&(f.X=null),l.vb=null,t(l!=null)}function Pn(){var l=new $t;return l==null?null:(l.a=0,l.xb=fd,Zt("Predictor","VP8LPredictors"),Zt("Predictor","VP8LPredictors_C"),Zt("PredictorAdd","VP8LPredictorsAdd"),Zt("PredictorAdd","VP8LPredictorsAdd_C"),sn=at,Zi=bt,Ki=Yt,La=gt,Ea=Et,Pa=qt,Ka=Pt,O.VP8LMapColor32b=Vs,O.VP8LMapColor8b=Yi,l)}function ct(l,f,v,C,D){var q=1,W=[l],J=[f],ee=C.m,le=C.s,_e=null,Re=0;e:for(;;){if(v)for(;q&&ne(ee,1);){var ce=W,Ce=J,Pe=C,Ue=1,Oe=Pe.m,We=Pe.gc[Pe.ab],Je=ne(Oe,2);if(Pe.Oc&1<<Je)q=0;else{switch(Pe.Oc|=1<<Je,We.hc=Je,We.Ea=ce[0],We.nc=Ce[0],We.K=[null],++Pe.ab,t(4>=Pe.ab),Je){case 0:case 1:We.b=ne(Oe,3)+2,Ue=ct(B(We.Ea,We.b),B(We.nc,We.b),0,Pe,We.K),We.K=We.K[0];break;case 3:var st,tt=ne(Oe,8)+1,Mt=16<tt?0:4<tt?1:2<tt?2:3;if(ce[0]=B(We.Ea,Mt),We.b=Mt,st=Ue=ct(tt,1,0,Pe,We.K)){var kt,sr=tt,It=We,cr=1<<(8>>It.b),xn=a(cr);if(xn==null)st=0;else{var ar=It.K[0],Ft=It.w;for(xn[0]=It.K[0][0],kt=1;kt<1*sr;++kt)xn[kt]=he(ar[Ft+kt],xn[kt-1]);for(;kt<4*cr;++kt)xn[kt]=0;It.K[0]=null,It.K[0]=xn,st=1}}Ue=st;break;case 2:break;default:t(0)}q=Ue}}if(W=W[0],J=J[0],q&&ne(ee,1)&&!(q=1<=(Re=ne(ee,4))&&11>=Re)){C.a=3;break e}var mt;if(mt=q)t:{var on,er,dr,Mr=C,An=W,qn=J,Xr=Re,In=v,$n=Mr.m,yn=Mr.s,fr=[null],jr=1,Qr=0,Sr=bp[Xr];r:for(;;){if(In&&ne($n,1)){var Ln=ne($n,3)+2,Ts=B(An,Ln),ln=B(qn,Ln),Kn=Ts*ln;if(!ct(Ts,ln,0,Mr,fr))break r;for(fr=fr[0],yn.xc=Ln,on=0;on<Kn;++on){var Tr=fr[on]>>8&65535;fr[on]=Tr,Tr>=jr&&(jr=Tr+1)}}if($n.h)break r;for(er=0;5>er;++er){var bn=ud[er];!er&&0<Xr&&(bn+=1<<Xr),Qr<bn&&(Qr=bn)}var ls=d(jr*Sr,M),Wn=jr,cs=d(Wn,te);if(cs==null)var ds=null;else t(65536>=Wn),ds=cs;var Xn=a(Qr);if(ds==null||Xn==null||ls==null){Mr.a=1;break r}var us=ls;for(on=dr=0;on<jr;++on){var Or=ds[on],hs=Or.G,Is=Or.H,Qa=0,ha=1,En=0;for(er=0;5>er;++er){bn=ud[er],hs[er]=us,Is[er]=dr,!er&&0<Xr&&(bn+=1<<Xr);s:{var Lo,Pl=bn,Eo=Mr,ro=Xn,Up=us,zp=dr,Tl=0,Oa=Eo.m,qp=ne(Oa,1);if(i(ro,0,0,Pl),qp){var $p=ne(Oa,1)+1,Wp=ne(Oa,1),vd=ne(Oa,Wp==0?1:8);ro[vd]=1,$p==2&&(ro[vd=ne(Oa,8)]=1);var Po=1}else{var Nd=a(19),_d=ne(Oa,4)+4;if(19<_d){Eo.a=3;var To=0;break s}for(Lo=0;Lo<_d;++Lo)Nd[xp[Lo]]=ne(Oa,3);var Il=void 0,no=void 0,jd=Eo,Hp=Nd,Io=Pl,Sd=ro,Fl=0,Ra=jd.m,kd=8,Cd=d(128,M);n:for(;k(Cd,0,7,Hp,19);){if(ne(Ra,1)){var Vp=2+2*ne(Ra,3);if((Il=2+ne(Ra,Vp))>Io)break n}else Il=Io;for(no=0;no<Io&&Il--;){ve(Ra);var Ad=Cd[0+(127&Z(Ra))];pe(Ra,Ra.u+Ad.g);var vi=Ad.value;if(16>vi)Sd[no++]=vi,vi!=0&&(kd=vi);else{var Gp=vi==16,Ld=vi-16,Yp=mp[Ld],Ed=ne(Ra,pp[Ld])+Yp;if(no+Ed>Io)break n;for(var Jp=Gp?kd:0;0<Ed--;)Sd[no++]=Jp}}Fl=1;break n}Fl||(jd.a=3),Po=Fl}(Po=Po&&!Oa.h)&&(Tl=k(Up,zp,8,ro,Pl)),Po&&Tl!=0?To=Tl:(Eo.a=3,To=0)}if(To==0)break r;if(ha&&gp[er]==1&&(ha=us[dr].g==0),Qa+=us[dr].g,dr+=To,3>=er){var so,Ol=Xn[0];for(so=1;so<bn;++so)Xn[so]>Ol&&(Ol=Xn[so]);En+=Ol}}if(Or.nd=ha,Or.Qb=0,ha&&(Or.qb=(hs[3][Is[3]+0].value<<24|hs[1][Is[1]+0].value<<16|hs[2][Is[2]+0].value)>>>0,Qa==0&&256>hs[0][Is[0]+0].value&&(Or.Qb=1,Or.qb+=hs[0][Is[0]+0].value<<8)),Or.jc=!Or.Qb&&6>En,Or.jc){var Fo,fa=Or;for(Fo=0;Fo<Za;++Fo){var Da=Fo,Ba=fa.pd[Da],Oo=fa.G[0][fa.H[0]+Da];256<=Oo.value?(Ba.g=Oo.g+256,Ba.value=Oo.value):(Ba.g=0,Ba.value=0,Da>>=Lr(Oo,8,Ba),Da>>=Lr(fa.G[1][fa.H[1]+Da],16,Ba),Da>>=Lr(fa.G[2][fa.H[2]+Da],0,Ba),Lr(fa.G[3][fa.H[3]+Da],24,Ba))}}}yn.vc=fr,yn.Wb=jr,yn.Ya=ds,yn.yc=ls,mt=1;break t}mt=0}if(!(q=mt)){C.a=3;break e}if(0<Re){if(le.ua=1<<Re,!P(le.Wa,Re)){C.a=1,q=0;break e}}else le.ua=0;var Rl=C,Pd=W,Zp=J,Dl=Rl.s,Bl=Dl.xc;if(Rl.c=Pd,Rl.i=Zp,Dl.md=B(Pd,Bl),Dl.wc=Bl==0?-1:(1<<Bl)-1,v){C.xb=Cp;break e}if((_e=a(W*J))==null){C.a=1,q=0;break e}q=(q=Hr(C,_e,0,W,J,J,null))&&!ee.h;break e}return q?(D!=null?D[0]=_e:(t(_e==null),t(v)),C.$=0,v||Jr(le)):Jr(le),q}function Zr(l,f){var v=l.c*l.i,C=v+f+16*f;return t(l.c<=f),l.V=a(C),l.V==null?(l.Ta=null,l.Ua=0,l.a=1,0):(l.Ta=l.V,l.Ua=l.Ba+v+f,1)}function ye(l,f){var v=l.C,C=f-v,D=l.V,q=l.Ba+l.c*v;for(t(f<=l.l.o);0<C;){var W=16<C?16:C,J=l.l.ma,ee=l.l.width,le=ee*W,_e=J.ca,Re=J.tb+ee*v,ce=l.Ta,Ce=l.Ua;ns(l,W,D,q),nd(ce,Ce,_e,Re,le),nn(J,v,v+W,_e,Re,ee),C-=W,D+=W*l.c,v+=W}t(v==f),l.C=l.Ma=f}function qe(){this.ub=this.yd=this.td=this.Rb=0}function He(){this.Kd=this.Ld=this.Ud=this.Td=this.i=this.c=0}function et(){this.Fb=this.Bb=this.Cb=0,this.Zb=a(4),this.Lb=a(4)}function it(){this.Yb=(function(){var l=[];return(function f(v,C,D){for(var q=D[C],W=0;W<q&&(v.push(D.length>C+1?[]:0),!(D.length<C+1));W++)f(v[W],C+1,D)})(l,0,[3,11]),l})()}function rt(){this.jb=a(3),this.Wc=o([4,8],it),this.Xc=o([4,17],it)}function nt(){this.Pc=this.wb=this.Tb=this.zd=0,this.vd=new a(4),this.od=new a(4)}function ot(){this.ld=this.La=this.dd=this.tc=0}function At(){this.Na=this.la=0}function jt(){this.Sc=[0,0],this.Eb=[0,0],this.Qc=[0,0],this.ia=this.lc=0}function Wt(){this.ad=a(384),this.Za=0,this.Ob=a(16),this.$b=this.Ad=this.ia=this.Gc=this.Hc=this.Dd=0}function Jt(){this.uc=this.M=this.Nb=0,this.wa=Array(new ot),this.Y=0,this.ya=Array(new Wt),this.aa=0,this.l=new Tn}function xt(){this.y=a(16),this.f=a(8),this.ea=a(8)}function Ht(){this.cb=this.a=0,this.sc="",this.m=new A,this.Od=new qe,this.Kc=new He,this.ed=new nt,this.Qa=new et,this.Ic=this.$c=this.Aa=0,this.D=new Jt,this.Xb=this.Va=this.Hb=this.zb=this.yb=this.Ub=this.za=0,this.Jc=d(8,A),this.ia=0,this.pb=d(4,jt),this.Pa=new rt,this.Bd=this.kc=0,this.Ac=[],this.Bc=0,this.zc=[0,0,0,0],this.Gd=Array(new xt),this.Hd=0,this.rb=Array(new At),this.sb=0,this.wa=Array(new ot),this.Y=0,this.oc=[],this.pc=0,this.sa=[],this.ta=0,this.qa=[],this.ra=0,this.Ha=[],this.B=this.R=this.Ia=0,this.Ec=[],this.M=this.ja=this.Vb=this.Fc=0,this.ya=Array(new Wt),this.L=this.aa=0,this.gd=o([4,2],ot),this.ga=null,this.Fa=[],this.Cc=this.qc=this.P=0,this.Gb=[],this.Uc=0,this.mb=[],this.nb=0,this.rc=[],this.Ga=this.Vc=0}function or(l,f){return 0>l?0:l>f?f:l}function Tn(){this.T=this.U=this.ka=this.height=this.width=0,this.y=[],this.f=[],this.ea=[],this.Rc=this.fa=this.W=this.N=this.O=0,this.ma="void",this.put="VP8IoPutHook",this.ac="VP8IoSetupHook",this.bc="VP8IoTeardownHook",this.ha=this.Kb=0,this.data=[],this.hb=this.ib=this.da=this.o=this.j=this.va=this.v=this.Da=this.ob=this.w=0,this.F=[],this.J=0}function bs(){var l=new Ht;return l!=null&&(l.a=0,l.sc="OK",l.cb=0,l.Xb=0,eo||(eo=hr)),l}function Ar(l,f,v){return l.a==0&&(l.a=f,l.sc=v,l.cb=0),0}function Ve(l,f,v){return 3<=v&&l[f+0]==157&&l[f+1]==1&&l[f+2]==42}function pt(l,f){if(l==null)return 0;if(l.a=0,l.sc="OK",f==null)return Ar(l,2,"null VP8Io passed to VP8GetHeaders()");var v=f.data,C=f.w,D=f.ha;if(4>D)return Ar(l,7,"Truncated header.");var q=v[C+0]|v[C+1]<<8|v[C+2]<<16,W=l.Od;if(W.Rb=!(1&q),W.td=q>>1&7,W.yd=q>>4&1,W.ub=q>>5,3<W.td)return Ar(l,3,"Incorrect keyframe parameters.");if(!W.yd)return Ar(l,4,"Frame not displayable.");C+=3,D-=3;var J=l.Kc;if(W.Rb){if(7>D)return Ar(l,7,"cannot parse picture header");if(!Ve(v,C,D))return Ar(l,3,"Bad code word");J.c=16383&(v[C+4]<<8|v[C+3]),J.Td=v[C+4]>>6,J.i=16383&(v[C+6]<<8|v[C+5]),J.Ud=v[C+6]>>6,C+=7,D-=7,l.za=J.c+15>>4,l.Ub=J.i+15>>4,f.width=J.c,f.height=J.i,f.Da=0,f.j=0,f.v=0,f.va=f.width,f.o=f.height,f.da=0,f.ib=f.width,f.hb=f.height,f.U=f.width,f.T=f.height,i((q=l.Pa).jb,0,255,q.jb.length),t((q=l.Qa)!=null),q.Cb=0,q.Bb=0,q.Fb=1,i(q.Zb,0,0,q.Zb.length),i(q.Lb,0,0,q.Lb)}if(W.ub>D)return Ar(l,7,"bad partition length");ae(q=l.m,v,C,W.ub),C+=W.ub,D-=W.ub,W.Rb&&(J.Ld=Ae(q),J.Kd=Ae(q)),J=l.Qa;var ee,le=l.Pa;if(t(q!=null),t(J!=null),J.Cb=Ae(q),J.Cb){if(J.Bb=Ae(q),Ae(q)){for(J.Fb=Ae(q),ee=0;4>ee;++ee)J.Zb[ee]=Ae(q)?se(q,7):0;for(ee=0;4>ee;++ee)J.Lb[ee]=Ae(q)?se(q,6):0}if(J.Bb)for(ee=0;3>ee;++ee)le.jb[ee]=Ae(q)?re(q,8):255}else J.Bb=0;if(q.Ka)return Ar(l,3,"cannot parse segment header");if((J=l.ed).zd=Ae(q),J.Tb=re(q,6),J.wb=re(q,3),J.Pc=Ae(q),J.Pc&&Ae(q)){for(le=0;4>le;++le)Ae(q)&&(J.vd[le]=se(q,6));for(le=0;4>le;++le)Ae(q)&&(J.od[le]=se(q,6))}if(l.L=J.Tb==0?0:J.zd?1:2,q.Ka)return Ar(l,3,"cannot parse filter header");var _e=D;if(D=ee=C,C=ee+_e,J=_e,l.Xb=(1<<re(l.m,2))-1,_e<3*(le=l.Xb))v=7;else{for(ee+=3*le,J-=3*le,_e=0;_e<le;++_e){var Re=v[D+0]|v[D+1]<<8|v[D+2]<<16;Re>J&&(Re=J),ae(l.Jc[+_e],v,ee,Re),ee+=Re,J-=Re,D+=3}ae(l.Jc[+le],v,ee,J),v=ee<C?0:5}if(v!=0)return Ar(l,v,"cannot parse partitions");for(v=re(ee=l.m,7),D=Ae(ee)?se(ee,4):0,C=Ae(ee)?se(ee,4):0,J=Ae(ee)?se(ee,4):0,le=Ae(ee)?se(ee,4):0,ee=Ae(ee)?se(ee,4):0,_e=l.Qa,Re=0;4>Re;++Re){if(_e.Cb){var ce=_e.Zb[Re];_e.Fb||(ce+=v)}else{if(0<Re){l.pb[Re]=l.pb[0];continue}ce=v}var Ce=l.pb[Re];Ce.Sc[0]=Al[or(ce+D,127)],Ce.Sc[1]=Ll[or(ce+0,127)],Ce.Eb[0]=2*Al[or(ce+C,127)],Ce.Eb[1]=101581*Ll[or(ce+J,127)]>>16,8>Ce.Eb[1]&&(Ce.Eb[1]=8),Ce.Qc[0]=Al[or(ce+le,117)],Ce.Qc[1]=Ll[or(ce+ee,127)],Ce.lc=ce+ee}if(!W.Rb)return Ar(l,4,"Not a key frame.");for(Ae(q),W=l.Pa,v=0;4>v;++v){for(D=0;8>D;++D)for(C=0;3>C;++C)for(J=0;11>J;++J)le=De(q,Sp[v][D][C][J])?re(q,8):_p[v][D][C][J],W.Wc[v][D].Yb[C][J]=le;for(D=0;17>D;++D)W.Xc[v][D]=W.Wc[v][kp[D]]}return l.kc=Ae(q),l.kc&&(l.Bd=re(q,8)),l.cb=1}function hr(l,f,v,C,D,q,W){var J=f[D].Yb[v];for(v=0;16>D;++D){if(!De(l,J[v+0]))return D;for(;!De(l,J[v+1]);)if(J=f[++D].Yb[0],v=0,D==16)return 16;var ee=f[D+1].Yb;if(De(l,J[v+2])){var le=l,_e=0;if(De(le,(ce=J)[(Re=v)+3]))if(De(le,ce[Re+6])){for(J=0,Re=2*(_e=De(le,ce[Re+8]))+(ce=De(le,ce[Re+9+_e])),_e=0,ce=vp[Re];ce[J];++J)_e+=_e+De(le,ce[J]);_e+=3+(8<<Re)}else De(le,ce[Re+7])?(_e=7+2*De(le,165),_e+=De(le,145)):_e=5+De(le,159);else _e=De(le,ce[Re+4])?3+De(le,ce[Re+5]):2;J=ee[2]}else _e=1,J=ee[1];ee=W+Np[D],0>(le=l).b&&ke(le);var Re,ce=le.b,Ce=(Re=le.Ca>>1)-(le.I>>ce)>>31;--le.b,le.Ca+=Ce,le.Ca|=1,le.I-=(Re+1&Ce)<<ce,q[ee]=((_e^Ce)-Ce)*C[(0<D)+0]}return 16}function Vr(l){var f=l.rb[l.sb-1];f.la=0,f.Na=0,i(l.zc,0,0,l.zc.length),l.ja=0}function zr(l,f,v,C,D){D=l[f+v+32*C]+(D>>3),l[f+v+32*C]=-256&D?0>D?0:255:D}function Er(l,f,v,C,D,q){zr(l,f,0,v,C+D),zr(l,f,1,v,C+q),zr(l,f,2,v,C-q),zr(l,f,3,v,C-D)}function Jn(l){return(20091*l>>16)+l}function ba(l,f,v,C){var D,q=0,W=a(16);for(D=0;4>D;++D){var J=l[f+0]+l[f+8],ee=l[f+0]-l[f+8],le=(35468*l[f+4]>>16)-Jn(l[f+12]),_e=Jn(l[f+4])+(35468*l[f+12]>>16);W[q+0]=J+_e,W[q+1]=ee+le,W[q+2]=ee-le,W[q+3]=J-_e,q+=4,f++}for(D=q=0;4>D;++D)J=(l=W[q+0]+4)+W[q+8],ee=l-W[q+8],le=(35468*W[q+4]>>16)-Jn(W[q+12]),zr(v,C,0,0,J+(_e=Jn(W[q+4])+(35468*W[q+12]>>16))),zr(v,C,1,0,ee+le),zr(v,C,2,0,ee-le),zr(v,C,3,0,J-_e),q++,C+=32}function Kr(l,f,v,C){var D=l[f+0]+4,q=35468*l[f+4]>>16,W=Jn(l[f+4]),J=35468*l[f+1]>>16;Er(v,C,0,D+W,l=Jn(l[f+1]),J),Er(v,C,1,D+q,l,J),Er(v,C,2,D-q,l,J),Er(v,C,3,D-W,l,J)}function wa(l,f,v,C,D){ba(l,f,v,C),D&&ba(l,f+16,v,C+4)}function Fr(l,f,v,C){Xa(l,f+0,v,C,1),Xa(l,f+32,v,C+128,1)}function va(l,f,v,C){var D;for(l=l[f+0]+4,D=0;4>D;++D)for(f=0;4>f;++f)zr(v,C,f,D,l)}function Na(l,f,v,C){l[f+0]&&wr(l,f+0,v,C),l[f+16]&&wr(l,f+16,v,C+4),l[f+32]&&wr(l,f+32,v,C+128),l[f+48]&&wr(l,f+48,v,C+128+4)}function Ws(l,f,v,C){var D,q=a(16);for(D=0;4>D;++D){var W=l[f+0+D]+l[f+12+D],J=l[f+4+D]+l[f+8+D],ee=l[f+4+D]-l[f+8+D],le=l[f+0+D]-l[f+12+D];q[0+D]=W+J,q[8+D]=W-J,q[4+D]=le+ee,q[12+D]=le-ee}for(D=0;4>D;++D)W=(l=q[0+4*D]+3)+q[3+4*D],J=q[1+4*D]+q[2+4*D],ee=q[1+4*D]-q[2+4*D],le=l-q[3+4*D],v[C+0]=W+J>>3,v[C+16]=le+ee>>3,v[C+32]=W-J>>3,v[C+48]=le-ee>>3,C+=64}function Hs(l,f,v){var C,D=f-32,q=os,W=255-l[D-1];for(C=0;C<v;++C){var J,ee=q,le=W+l[f-1];for(J=0;J<v;++J)l[f+J]=ee[le+l[D+J]];f+=32}}function $a(l,f){Hs(l,f,4)}function ci(l,f){Hs(l,f,8)}function na(l,f){Hs(l,f,16)}function _a(l,f){var v;for(v=0;16>v;++v)s(l,f+32*v,l,f-32,16)}function di(l,f){var v;for(v=16;0<v;--v)i(l,f,l[f-1],16),f+=32}function Mn(l,f,v){var C;for(C=0;16>C;++C)i(f,v+32*C,l,16)}function ui(l,f){var v,C=16;for(v=0;16>v;++v)C+=l[f-1+32*v]+l[f+v-32];Mn(C>>5,l,f)}function Cs(l,f){var v,C=8;for(v=0;16>v;++v)C+=l[f-1+32*v];Mn(C>>4,l,f)}function Wa(l,f){var v,C=8;for(v=0;16>v;++v)C+=l[f+v-32];Mn(C>>4,l,f)}function hi(l,f){Mn(128,l,f)}function Vt(l,f,v){return l+2*f+v+2>>2}function fi(l,f){var v,C=f-32;for(C=new Uint8Array([Vt(l[C-1],l[C+0],l[C+1]),Vt(l[C+0],l[C+1],l[C+2]),Vt(l[C+1],l[C+2],l[C+3]),Vt(l[C+2],l[C+3],l[C+4])]),v=0;4>v;++v)s(l,f+32*v,C,0,C.length)}function pi(l,f){var v=l[f-1],C=l[f-1+32],D=l[f-1+64],q=l[f-1+96];Me(l,f+0,16843009*Vt(l[f-1-32],v,C)),Me(l,f+32,16843009*Vt(v,C,D)),Me(l,f+64,16843009*Vt(C,D,q)),Me(l,f+96,16843009*Vt(D,q,q))}function zi(l,f){var v,C=4;for(v=0;4>v;++v)C+=l[f+v-32]+l[f-1+32*v];for(C>>=3,v=0;4>v;++v)i(l,f+32*v,C,4)}function As(l,f){var v=l[f-1+0],C=l[f-1+32],D=l[f-1+64],q=l[f-1-32],W=l[f+0-32],J=l[f+1-32],ee=l[f+2-32],le=l[f+3-32];l[f+0+96]=Vt(C,D,l[f-1+96]),l[f+1+96]=l[f+0+64]=Vt(v,C,D),l[f+2+96]=l[f+1+64]=l[f+0+32]=Vt(q,v,C),l[f+3+96]=l[f+2+64]=l[f+1+32]=l[f+0+0]=Vt(W,q,v),l[f+3+64]=l[f+2+32]=l[f+1+0]=Vt(J,W,q),l[f+3+32]=l[f+2+0]=Vt(ee,J,W),l[f+3+0]=Vt(le,ee,J)}function ws(l,f){var v=l[f+1-32],C=l[f+2-32],D=l[f+3-32],q=l[f+4-32],W=l[f+5-32],J=l[f+6-32],ee=l[f+7-32];l[f+0+0]=Vt(l[f+0-32],v,C),l[f+1+0]=l[f+0+32]=Vt(v,C,D),l[f+2+0]=l[f+1+32]=l[f+0+64]=Vt(C,D,q),l[f+3+0]=l[f+2+32]=l[f+1+64]=l[f+0+96]=Vt(D,q,W),l[f+3+32]=l[f+2+64]=l[f+1+96]=Vt(q,W,J),l[f+3+64]=l[f+2+96]=Vt(W,J,ee),l[f+3+96]=Vt(J,ee,ee)}function qi(l,f){var v=l[f-1+0],C=l[f-1+32],D=l[f-1+64],q=l[f-1-32],W=l[f+0-32],J=l[f+1-32],ee=l[f+2-32],le=l[f+3-32];l[f+0+0]=l[f+1+64]=q+W+1>>1,l[f+1+0]=l[f+2+64]=W+J+1>>1,l[f+2+0]=l[f+3+64]=J+ee+1>>1,l[f+3+0]=ee+le+1>>1,l[f+0+96]=Vt(D,C,v),l[f+0+64]=Vt(C,v,q),l[f+0+32]=l[f+1+96]=Vt(v,q,W),l[f+1+32]=l[f+2+96]=Vt(q,W,J),l[f+2+32]=l[f+3+96]=Vt(W,J,ee),l[f+3+32]=Vt(J,ee,le)}function $i(l,f){var v=l[f+0-32],C=l[f+1-32],D=l[f+2-32],q=l[f+3-32],W=l[f+4-32],J=l[f+5-32],ee=l[f+6-32],le=l[f+7-32];l[f+0+0]=v+C+1>>1,l[f+1+0]=l[f+0+64]=C+D+1>>1,l[f+2+0]=l[f+1+64]=D+q+1>>1,l[f+3+0]=l[f+2+64]=q+W+1>>1,l[f+0+32]=Vt(v,C,D),l[f+1+32]=l[f+0+96]=Vt(C,D,q),l[f+2+32]=l[f+1+96]=Vt(D,q,W),l[f+3+32]=l[f+2+96]=Vt(q,W,J),l[f+3+64]=Vt(W,J,ee),l[f+3+96]=Vt(J,ee,le)}function sa(l,f){var v=l[f-1+0],C=l[f-1+32],D=l[f-1+64],q=l[f-1+96];l[f+0+0]=v+C+1>>1,l[f+2+0]=l[f+0+32]=C+D+1>>1,l[f+2+32]=l[f+0+64]=D+q+1>>1,l[f+1+0]=Vt(v,C,D),l[f+3+0]=l[f+1+32]=Vt(C,D,q),l[f+3+32]=l[f+1+64]=Vt(D,q,q),l[f+3+64]=l[f+2+64]=l[f+0+96]=l[f+1+96]=l[f+2+96]=l[f+3+96]=q}function ja(l,f){var v=l[f-1+0],C=l[f-1+32],D=l[f-1+64],q=l[f-1+96],W=l[f-1-32],J=l[f+0-32],ee=l[f+1-32],le=l[f+2-32];l[f+0+0]=l[f+2+32]=v+W+1>>1,l[f+0+32]=l[f+2+64]=C+v+1>>1,l[f+0+64]=l[f+2+96]=D+C+1>>1,l[f+0+96]=q+D+1>>1,l[f+3+0]=Vt(J,ee,le),l[f+2+0]=Vt(W,J,ee),l[f+1+0]=l[f+3+32]=Vt(v,W,J),l[f+1+32]=l[f+3+64]=Vt(C,v,W),l[f+1+64]=l[f+3+96]=Vt(D,C,v),l[f+1+96]=Vt(q,D,C)}function aa(l,f){var v;for(v=0;8>v;++v)s(l,f+32*v,l,f-32,8)}function Wi(l,f){var v;for(v=0;8>v;++v)i(l,f,l[f-1],8),f+=32}function vs(l,f,v){var C;for(C=0;8>C;++C)i(f,v+32*C,l,8)}function Hi(l,f){var v,C=8;for(v=0;8>v;++v)C+=l[f+v-32]+l[f-1+32*v];vs(C>>4,l,f)}function Ha(l,f){var v,C=4;for(v=0;8>v;++v)C+=l[f+v-32];vs(C>>3,l,f)}function Va(l,f){var v,C=4;for(v=0;8>v;++v)C+=l[f-1+32*v];vs(C>>3,l,f)}function mi(l,f){vs(128,l,f)}function Zn(l,f,v){var C=l[f-v],D=l[f+0],q=3*(D-C)+_l[1020+l[f-2*v]-l[f+v]],W=wo[112+(q+4>>3)];l[f-v]=os[255+C+wo[112+(q+3>>3)]],l[f+0]=os[255+D-W]}function Ga(l,f,v,C){var D=l[f+0],q=l[f+v];return _s[255+l[f-2*v]-l[f-v]]>C||_s[255+q-D]>C}function ia(l,f,v,C){return 4*_s[255+l[f-v]-l[f+0]]+_s[255+l[f-2*v]-l[f+v]]<=C}function Ya(l,f,v,C,D){var q=l[f-3*v],W=l[f-2*v],J=l[f-v],ee=l[f+0],le=l[f+v],_e=l[f+2*v],Re=l[f+3*v];return 4*_s[255+J-ee]+_s[255+W-le]>C?0:_s[255+l[f-4*v]-q]<=D&&_s[255+q-W]<=D&&_s[255+W-J]<=D&&_s[255+Re-_e]<=D&&_s[255+_e-le]<=D&&_s[255+le-ee]<=D}function oa(l,f,v,C){var D=2*C+1;for(C=0;16>C;++C)ia(l,f+C,v,D)&&Zn(l,f+C,v)}function Ja(l,f,v,C){var D=2*C+1;for(C=0;16>C;++C)ia(l,f+C*v,1,D)&&Zn(l,f+C*v,1)}function Sa(l,f,v,C){var D;for(D=3;0<D;--D)oa(l,f+=4*v,v,C)}function gi(l,f,v,C){var D;for(D=3;0<D;--D)Ja(l,f+=4,v,C)}function Ls(l,f,v,C,D,q,W,J){for(q=2*q+1;0<D--;){if(Ya(l,f,v,q,W))if(Ga(l,f,v,J))Zn(l,f,v);else{var ee=l,le=f,_e=v,Re=ee[le-2*_e],ce=ee[le-_e],Ce=ee[le+0],Pe=ee[le+_e],Ue=ee[le+2*_e],Oe=27*(Je=_l[1020+3*(Ce-ce)+_l[1020+Re-Pe]])+63>>7,We=18*Je+63>>7,Je=9*Je+63>>7;ee[le-3*_e]=os[255+ee[le-3*_e]+Je],ee[le-2*_e]=os[255+Re+We],ee[le-_e]=os[255+ce+Oe],ee[le+0]=os[255+Ce-Oe],ee[le+_e]=os[255+Pe-We],ee[le+2*_e]=os[255+Ue-Je]}f+=C}}function Es(l,f,v,C,D,q,W,J){for(q=2*q+1;0<D--;){if(Ya(l,f,v,q,W))if(Ga(l,f,v,J))Zn(l,f,v);else{var ee=l,le=f,_e=v,Re=ee[le-_e],ce=ee[le+0],Ce=ee[le+_e],Pe=wo[112+(4+(Ue=3*(ce-Re))>>3)],Ue=wo[112+(Ue+3>>3)],Oe=Pe+1>>1;ee[le-2*_e]=os[255+ee[le-2*_e]+Oe],ee[le-_e]=os[255+Re+Ue],ee[le+0]=os[255+ce-Pe],ee[le+_e]=os[255+Ce-Oe]}f+=C}}function xi(l,f,v,C,D,q){Ls(l,f,v,1,16,C,D,q)}function ss(l,f,v,C,D,q){Ls(l,f,1,v,16,C,D,q)}function yi(l,f,v,C,D,q){var W;for(W=3;0<W;--W)Es(l,f+=4*v,v,1,16,C,D,q)}function x(l,f,v,C,D,q){var W;for(W=3;0<W;--W)Es(l,f+=4,1,v,16,C,D,q)}function R(l,f,v,C,D,q,W,J){Ls(l,f,D,1,8,q,W,J),Ls(v,C,D,1,8,q,W,J)}function oe(l,f,v,C,D,q,W,J){Ls(l,f,1,D,8,q,W,J),Ls(v,C,1,D,8,q,W,J)}function be(l,f,v,C,D,q,W,J){Es(l,f+4*D,D,1,8,q,W,J),Es(v,C+4*D,D,1,8,q,W,J)}function Ee(l,f,v,C,D,q,W,J){Es(l,f+4,1,D,8,q,W,J),Es(v,C+4,1,D,8,q,W,J)}function Ge(){this.ba=new Rt,this.ec=[],this.cc=[],this.Mc=[],this.Dc=this.Nc=this.dc=this.fc=0,this.Oa=new Qt,this.memory=0,this.Ib="OutputFunc",this.Jb="OutputAlphaFunc",this.Nd="OutputRowFunc"}function Xe(){this.data=[],this.offset=this.kd=this.ha=this.w=0,this.na=[],this.xa=this.gb=this.Ja=this.Sa=this.P=0}function Nt(){this.nc=this.Ea=this.b=this.hc=0,this.K=[],this.w=0}function Tt(){this.ua=0,this.Wa=new $,this.vb=new $,this.md=this.xc=this.wc=0,this.vc=[],this.Wb=0,this.Ya=new te,this.yc=new M}function $t(){this.xb=this.a=0,this.l=new Tn,this.ca=new Rt,this.V=[],this.Ba=0,this.Ta=[],this.Ua=0,this.m=new H,this.Pb=0,this.wd=new H,this.Ma=this.$=this.C=this.i=this.c=this.xd=0,this.s=new Tt,this.ab=0,this.gc=d(4,Nt),this.Oc=0}function Kt(){this.Lc=this.Z=this.$a=this.i=this.c=0,this.l=new Tn,this.ic=0,this.ca=[],this.tb=0,this.qd=null,this.rd=0}function lr(l,f,v,C,D,q,W){for(l=l==null?0:l[f+0],f=0;f<W;++f)D[q+f]=l+v[C+f]&255,l=D[q+f]}function T(l,f,v,C,D,q,W){var J;if(l==null)lr(null,null,v,C,D,q,W);else for(J=0;J<W;++J)D[q+J]=l[f+J]+v[C+J]&255}function ue(l,f,v,C,D,q,W){if(l==null)lr(null,null,v,C,D,q,W);else{var J,ee=l[f+0],le=ee,_e=ee;for(J=0;J<W;++J)le=_e+(ee=l[f+J])-le,_e=v[C+J]+(-256&le?0>le?0:255:le)&255,le=ee,D[q+J]=_e}}function ge(l,f,v,C){var D=f.width,q=f.o;if(t(l!=null&&f!=null),0>v||0>=C||v+C>q)return null;if(!l.Cc){if(l.ga==null){var W;if(l.ga=new Kt,(W=l.ga==null)||(W=f.width*f.o,t(l.Gb.length==0),l.Gb=a(W),l.Uc=0,l.Gb==null?W=0:(l.mb=l.Gb,l.nb=l.Uc,l.rc=null,W=1),W=!W),!W){W=l.ga;var J=l.Fa,ee=l.P,le=l.qc,_e=l.mb,Re=l.nb,ce=ee+1,Ce=le-1,Pe=W.l;if(t(J!=null&&_e!=null&&f!=null),Fa[0]=null,Fa[1]=lr,Fa[2]=T,Fa[3]=ue,W.ca=_e,W.tb=Re,W.c=f.width,W.i=f.height,t(0<W.c&&0<W.i),1>=le)f=0;else if(W.$a=3&J[ee+0],W.Z=J[ee+0]>>2&3,W.Lc=J[ee+0]>>4&3,ee=J[ee+0]>>6&3,0>W.$a||1<W.$a||4<=W.Z||1<W.Lc||ee)f=0;else if(Pe.put=zt,Pe.ac=rn,Pe.bc=mn,Pe.ma=W,Pe.width=f.width,Pe.height=f.height,Pe.Da=f.Da,Pe.v=f.v,Pe.va=f.va,Pe.j=f.j,Pe.o=f.o,W.$a)e:{t(W.$a==1),f=Pn();t:for(;;){if(f==null){f=0;break e}if(t(W!=null),W.mc=f,f.c=W.c,f.i=W.i,f.l=W.l,f.l.ma=W,f.l.width=W.c,f.l.height=W.i,f.a=0,ie(f.m,J,ce,Ce),!ct(W.c,W.i,1,f,null)||(f.ab==1&&f.gc[0].hc==3&&kn(f.s)?(W.ic=1,J=f.c*f.i,f.Ta=null,f.Ua=0,f.V=a(J),f.Ba=0,f.V==null?(f.a=1,f=0):f=1):(W.ic=0,f=Zr(f,W.c)),!f))break t;f=1;break e}W.mc=null,f=0}else f=Ce>=W.c*W.i;W=!f}if(W)return null;l.ga.Lc!=1?l.Ga=0:C=q-v}t(l.ga!=null),t(v+C<=q);e:{if(f=(J=l.ga).c,q=J.l.o,J.$a==0){if(ce=l.rc,Ce=l.Vc,Pe=l.Fa,ee=l.P+1+v*f,le=l.mb,_e=l.nb+v*f,t(ee<=l.P+l.qc),J.Z!=0)for(t(Fa[J.Z]!=null),W=0;W<C;++W)Fa[J.Z](ce,Ce,Pe,ee,le,_e,f),ce=le,Ce=_e,_e+=f,ee+=f;else for(W=0;W<C;++W)s(le,_e,Pe,ee,f),ce=le,Ce=_e,_e+=f,ee+=f;l.rc=ce,l.Vc=Ce}else{if(t(J.mc!=null),f=v+C,t((W=J.mc)!=null),t(f<=W.i),W.C>=f)f=1;else if(J.ic||$e(),J.ic){J=W.V,ce=W.Ba,Ce=W.c;var Ue=W.i,Oe=(Pe=1,ee=W.$/Ce,le=W.$%Ce,_e=W.m,Re=W.s,W.$),We=Ce*Ue,Je=Ce*f,st=Re.wc,tt=Oe<Je?ur(Re,le,ee):null;t(Oe<=We),t(f<=Ue),t(kn(Re));t:for(;;){for(;!_e.h&&Oe<Je;){if(le&st||(tt=ur(Re,le,ee)),t(tt!=null),ve(_e),256>(Ue=yr(tt.G[0],tt.H[0],_e)))J[ce+Oe]=Ue,++Oe,++le>=Ce&&(le=0,++ee<=f&&!(ee%16)&&Cn(W,ee));else{if(!(280>Ue)){Pe=0;break t}Ue=Yr(Ue-256,_e);var Mt,kt=yr(tt.G[4],tt.H[4],_e);if(ve(_e),!(Oe>=(kt=Wr(Ce,kt=Yr(kt,_e)))&&We-Oe>=Ue)){Pe=0;break t}for(Mt=0;Mt<Ue;++Mt)J[ce+Oe+Mt]=J[ce+Oe+Mt-kt];for(Oe+=Ue,le+=Ue;le>=Ce;)le-=Ce,++ee<=f&&!(ee%16)&&Cn(W,ee);Oe<Je&&le&st&&(tt=ur(Re,le,ee))}t(_e.h==X(_e))}Cn(W,ee>f?f:ee);break t}!Pe||_e.h&&Oe<We?(Pe=0,W.a=_e.h?5:3):W.$=Oe,f=Pe}else f=Hr(W,W.V,W.Ba,W.c,W.i,f,ye);if(!f){C=0;break e}}v+C>=q&&(l.Cc=1),C=1}if(!C)return null;if(l.Cc&&((C=l.ga)!=null&&(C.mc=null),l.ga=null,0<l.Ga))return alert("todo:WebPDequantizeLevels"),null}return l.nb+v*D}function xe(l,f,v,C,D,q){for(;0<D--;){var W,J=l,ee=f+(v?1:0),le=l,_e=f+(v?0:3);for(W=0;W<C;++W){var Re=le[_e+4*W];Re!=255&&(Re*=32897,J[ee+4*W+0]=J[ee+4*W+0]*Re>>23,J[ee+4*W+1]=J[ee+4*W+1]*Re>>23,J[ee+4*W+2]=J[ee+4*W+2]*Re>>23)}f+=q}}function fe(l,f,v,C,D){for(;0<C--;){var q;for(q=0;q<v;++q){var W=l[f+2*q+0],J=15&(le=l[f+2*q+1]),ee=4369*J,le=(240&le|le>>4)*ee>>16;l[f+2*q+0]=(240&W|W>>4)*ee>>16&240|(15&W|W<<4)*ee>>16>>4&15,l[f+2*q+1]=240&le|J}f+=D}}function Ne(l,f,v,C,D,q,W,J){var ee,le,_e=255;for(le=0;le<D;++le){for(ee=0;ee<C;++ee){var Re=l[f+ee];q[W+4*ee]=Re,_e&=Re}f+=v,W+=J}return _e!=255}function Fe(l,f,v,C,D){var q;for(q=0;q<D;++q)v[C+q]=l[f+q]>>8}function $e(){Qi=xe,td=fe,rd=Ne,nd=Fe}function Ze(l,f,v){O[l]=function(C,D,q,W,J,ee,le,_e,Re,ce,Ce,Pe,Ue,Oe,We,Je,st){var tt,Mt=st-1>>1,kt=J[ee+0]|le[_e+0]<<16,sr=Re[ce+0]|Ce[Pe+0]<<16;t(C!=null);var It=3*kt+sr+131074>>2;for(f(C[D+0],255&It,It>>16,Ue,Oe),q!=null&&(It=3*sr+kt+131074>>2,f(q[W+0],255&It,It>>16,We,Je)),tt=1;tt<=Mt;++tt){var cr=J[ee+tt]|le[_e+tt]<<16,xn=Re[ce+tt]|Ce[Pe+tt]<<16,ar=kt+cr+sr+xn+524296,Ft=ar+2*(cr+sr)>>3;It=Ft+kt>>1,kt=(ar=ar+2*(kt+xn)>>3)+cr>>1,f(C[D+2*tt-1],255&It,It>>16,Ue,Oe+(2*tt-1)*v),f(C[D+2*tt-0],255&kt,kt>>16,Ue,Oe+(2*tt-0)*v),q!=null&&(It=ar+sr>>1,kt=Ft+xn>>1,f(q[W+2*tt-1],255&It,It>>16,We,Je+(2*tt-1)*v),f(q[W+2*tt+0],255&kt,kt>>16,We,Je+(2*tt+0)*v)),kt=cr,sr=xn}1&st||(It=3*kt+sr+131074>>2,f(C[D+st-1],255&It,It>>16,Ue,Oe+(st-1)*v),q!=null&&(It=3*sr+kt+131074>>2,f(q[W+st-1],255&It,It>>16,We,Je+(st-1)*v)))}}function ht(){js[vo]=Ap,js[No]=pd,js[cd]=Lp,js[_o]=md,js[jo]=gd,js[jl]=xd,js[dd]=Ep,js[Sl]=pd,js[kl]=md,js[So]=gd,js[Cl]=xd}function Qe(l){return l&-16384?0>l?0:255:l>>Pp}function dt(l,f){return Qe((19077*l>>8)+(26149*f>>8)-14234)}function we(l,f,v){return Qe((19077*l>>8)-(6419*f>>8)-(13320*v>>8)+8708)}function wt(l,f){return Qe((19077*l>>8)+(33050*f>>8)-17685)}function St(l,f,v,C,D){C[D+0]=dt(l,v),C[D+1]=we(l,f,v),C[D+2]=wt(l,f)}function rr(l,f,v,C,D){C[D+0]=wt(l,f),C[D+1]=we(l,f,v),C[D+2]=dt(l,v)}function Nr(l,f,v,C,D){var q=we(l,f,v);f=q<<3&224|wt(l,f)>>3,C[D+0]=248&dt(l,v)|q>>5,C[D+1]=f}function Dt(l,f,v,C,D){var q=240&wt(l,f)|15;C[D+0]=240&dt(l,v)|we(l,f,v)>>4,C[D+1]=q}function br(l,f,v,C,D){C[D+0]=255,St(l,f,v,C,D+1)}function _r(l,f,v,C,D){rr(l,f,v,C,D),C[D+3]=255}function mr(l,f,v,C,D){St(l,f,v,C,D),C[D+3]=255}function gr(l,f,v){O[l]=function(C,D,q,W,J,ee,le,_e,Re){for(var ce=_e+(-2&Re)*v;_e!=ce;)f(C[D+0],q[W+0],J[ee+0],le,_e),f(C[D+1],q[W+0],J[ee+0],le,_e+v),D+=2,++W,++ee,_e+=2*v;1&Re&&f(C[D+0],q[W+0],J[ee+0],le,_e)}}function Un(l,f,v){return v==0?l==0?f==0?6:5:f==0?4:0:v}function zn(l,f,v,C,D){switch(l>>>30){case 3:Xa(f,v,C,D,0);break;case 2:Ns(f,v,C,D);break;case 1:wr(f,v,C,D)}}function nr(l,f){var v,C,D=f.M,q=f.Nb,W=l.oc,J=l.pc+40,ee=l.oc,le=l.pc+584,_e=l.oc,Re=l.pc+600;for(v=0;16>v;++v)W[J+32*v-1]=129;for(v=0;8>v;++v)ee[le+32*v-1]=129,_e[Re+32*v-1]=129;for(0<D?W[J-1-32]=ee[le-1-32]=_e[Re-1-32]=129:(i(W,J-32-1,127,21),i(ee,le-32-1,127,9),i(_e,Re-32-1,127,9)),C=0;C<l.za;++C){var ce=f.ya[f.aa+C];if(0<C){for(v=-1;16>v;++v)s(W,J+32*v-4,W,J+32*v+12,4);for(v=-1;8>v;++v)s(ee,le+32*v-4,ee,le+32*v+4,4),s(_e,Re+32*v-4,_e,Re+32*v+4,4)}var Ce=l.Gd,Pe=l.Hd+C,Ue=ce.ad,Oe=ce.Hc;if(0<D&&(s(W,J-32,Ce[Pe].y,0,16),s(ee,le-32,Ce[Pe].f,0,8),s(_e,Re-32,Ce[Pe].ea,0,8)),ce.Za){var We=W,Je=J-32+16;for(0<D&&(C>=l.za-1?i(We,Je,Ce[Pe].y[15],4):s(We,Je,Ce[Pe+1].y,0,4)),v=0;4>v;v++)We[Je+128+v]=We[Je+256+v]=We[Je+384+v]=We[Je+0+v];for(v=0;16>v;++v,Oe<<=2)We=W,Je=J+bd[v],Ps[ce.Ob[v]](We,Je),zn(Oe,Ue,16*+v,We,Je)}else if(We=Un(C,D,ce.Ob[0]),Ia[We](W,J),Oe!=0)for(v=0;16>v;++v,Oe<<=2)zn(Oe,Ue,16*+v,W,J+bd[v]);for(v=ce.Gc,We=Un(C,D,ce.Dd),ua[We](ee,le),ua[We](_e,Re),Oe=Ue,We=ee,Je=le,255&(ce=0|v)&&(170&ce?Ys(Oe,256,We,Je):Pr(Oe,256,We,Je)),ce=_e,Oe=Re,255&(v>>=8)&&(170&v?Ys(Ue,320,ce,Oe):Pr(Ue,320,ce,Oe)),D<l.Ub-1&&(s(Ce[Pe].y,0,W,J+480,16),s(Ce[Pe].f,0,ee,le+224,8),s(Ce[Pe].ea,0,_e,Re+224,8)),v=8*q*l.B,Ce=l.sa,Pe=l.ta+16*C+16*q*l.R,Ue=l.qa,ce=l.ra+8*C+v,Oe=l.Ha,We=l.Ia+8*C+v,v=0;16>v;++v)s(Ce,Pe+v*l.R,W,J+32*v,16);for(v=0;8>v;++v)s(Ue,ce+v*l.B,ee,le+32*v,8),s(Oe,We+v*l.B,_e,Re+32*v,8)}}function xr(l,f,v,C,D,q,W,J,ee){var le=[0],_e=[0],Re=0,ce=ee!=null?ee.kd:0,Ce=ee??new Xe;if(l==null||12>v)return 7;Ce.data=l,Ce.w=f,Ce.ha=v,f=[f],v=[v],Ce.gb=[Ce.gb];e:{var Pe=f,Ue=v,Oe=Ce.gb;if(t(l!=null),t(Ue!=null),t(Oe!=null),Oe[0]=0,12<=Ue[0]&&!e(l,Pe[0],"RIFF")){if(e(l,Pe[0]+8,"WEBP")){Oe=3;break e}var We=j(l,Pe[0]+4);if(12>We||4294967286<We){Oe=3;break e}if(ce&&We>Ue[0]-8){Oe=7;break e}Oe[0]=We,Pe[0]+=12,Ue[0]-=12}Oe=0}if(Oe!=0)return Oe;for(We=0<Ce.gb[0],v=v[0];;){e:{var Je=l;Ue=f,Oe=v;var st=le,tt=_e,Mt=Pe=[0];if((It=Re=[Re])[0]=0,8>Oe[0])Oe=7;else{if(!e(Je,Ue[0],"VP8X")){if(j(Je,Ue[0]+4)!=10){Oe=3;break e}if(18>Oe[0]){Oe=7;break e}var kt=j(Je,Ue[0]+8),sr=1+Se(Je,Ue[0]+12);if(2147483648<=sr*(Je=1+Se(Je,Ue[0]+15))){Oe=3;break e}Mt!=null&&(Mt[0]=kt),st!=null&&(st[0]=sr),tt!=null&&(tt[0]=Je),Ue[0]+=18,Oe[0]-=18,It[0]=1}Oe=0}}if(Re=Re[0],Pe=Pe[0],Oe!=0)return Oe;if(Ue=!!(2&Pe),!We&&Re)return 3;if(q!=null&&(q[0]=!!(16&Pe)),W!=null&&(W[0]=Ue),J!=null&&(J[0]=0),W=le[0],Pe=_e[0],Re&&Ue&&ee==null){Oe=0;break}if(4>v){Oe=7;break}if(We&&Re||!We&&!Re&&!e(l,f[0],"ALPH")){v=[v],Ce.na=[Ce.na],Ce.P=[Ce.P],Ce.Sa=[Ce.Sa];e:{kt=l,Oe=f,We=v;var It=Ce.gb;st=Ce.na,tt=Ce.P,Mt=Ce.Sa,sr=22,t(kt!=null),t(We!=null),Je=Oe[0];var cr=We[0];for(t(st!=null),t(Mt!=null),st[0]=null,tt[0]=null,Mt[0]=0;;){if(Oe[0]=Je,We[0]=cr,8>cr){Oe=7;break e}var xn=j(kt,Je+4);if(4294967286<xn){Oe=3;break e}var ar=8+xn+1&-2;if(sr+=ar,0<It&&sr>It){Oe=3;break e}if(!e(kt,Je,"VP8 ")||!e(kt,Je,"VP8L")){Oe=0;break e}if(cr[0]<ar){Oe=7;break e}e(kt,Je,"ALPH")||(st[0]=kt,tt[0]=Je+8,Mt[0]=xn),Je+=ar,cr-=ar}}if(v=v[0],Ce.na=Ce.na[0],Ce.P=Ce.P[0],Ce.Sa=Ce.Sa[0],Oe!=0)break}v=[v],Ce.Ja=[Ce.Ja],Ce.xa=[Ce.xa];e:if(It=l,Oe=f,We=v,st=Ce.gb[0],tt=Ce.Ja,Mt=Ce.xa,kt=Oe[0],Je=!e(It,kt,"VP8 "),sr=!e(It,kt,"VP8L"),t(It!=null),t(We!=null),t(tt!=null),t(Mt!=null),8>We[0])Oe=7;else{if(Je||sr){if(It=j(It,kt+4),12<=st&&It>st-12){Oe=3;break e}if(ce&&It>We[0]-8){Oe=7;break e}tt[0]=It,Oe[0]+=8,We[0]-=8,Mt[0]=sr}else Mt[0]=5<=We[0]&&It[kt+0]==47&&!(It[kt+4]>>5),tt[0]=We[0];Oe=0}if(v=v[0],Ce.Ja=Ce.Ja[0],Ce.xa=Ce.xa[0],f=f[0],Oe!=0)break;if(4294967286<Ce.Ja)return 3;if(J==null||Ue||(J[0]=Ce.xa?2:1),W=[W],Pe=[Pe],Ce.xa){if(5>v){Oe=7;break}J=W,ce=Pe,Ue=q,l==null||5>v?l=0:5<=v&&l[f+0]==47&&!(l[f+4]>>5)?(We=[0],It=[0],st=[0],ie(tt=new H,l,f,v),vn(tt,We,It,st)?(J!=null&&(J[0]=We[0]),ce!=null&&(ce[0]=It[0]),Ue!=null&&(Ue[0]=st[0]),l=1):l=0):l=0}else{if(10>v){Oe=7;break}J=Pe,l==null||10>v||!Ve(l,f+3,v-3)?l=0:(ce=l[f+0]|l[f+1]<<8|l[f+2]<<16,Ue=16383&(l[f+7]<<8|l[f+6]),l=16383&(l[f+9]<<8|l[f+8]),1&ce||3<(ce>>1&7)||!(ce>>4&1)||ce>>5>=Ce.Ja||!Ue||!l?l=0:(W&&(W[0]=Ue),J&&(J[0]=l),l=1))}if(!l||(W=W[0],Pe=Pe[0],Re&&(le[0]!=W||_e[0]!=Pe)))return 3;ee!=null&&(ee[0]=Ce,ee.offset=f-ee.w,t(4294967286>f-ee.w),t(ee.offset==ee.ha-v));break}return Oe==0||Oe==7&&Re&&ee==null?(q!=null&&(q[0]|=Ce.na!=null&&0<Ce.na.length),C!=null&&(C[0]=W),D!=null&&(D[0]=Pe),0):Oe}function la(l,f,v){var C=f.width,D=f.height,q=0,W=0,J=C,ee=D;if(f.Da=l!=null&&0<l.Da,f.Da&&(J=l.cd,ee=l.bd,q=l.v,W=l.j,11>v||(q&=-2,W&=-2),0>q||0>W||0>=J||0>=ee||q+J>C||W+ee>D))return 0;if(f.v=q,f.j=W,f.va=q+J,f.o=W+ee,f.U=J,f.T=ee,f.da=l!=null&&0<l.da,f.da){if(!z(J,ee,v=[l.ib],q=[l.hb]))return 0;f.ib=v[0],f.hb=q[0]}return f.ob=l!=null&&l.ob,f.Kb=l==null||!l.Sd,f.da&&(f.ob=f.ib<3*C/4&&f.hb<3*D/4,f.Kb=0),1}function Vi(l){if(l==null)return 2;if(11>l.S){var f=l.f.RGBA;f.fb+=(l.height-1)*f.A,f.A=-f.A}else f=l.f.kb,l=l.height,f.O+=(l-1)*f.fa,f.fa=-f.fa,f.N+=(l-1>>1)*f.Ab,f.Ab=-f.Ab,f.W+=(l-1>>1)*f.Db,f.Db=-f.Db,f.F!=null&&(f.J+=(l-1)*f.lb,f.lb=-f.lb);return 0}function ka(l,f,v,C){if(C==null||0>=l||0>=f)return 2;if(v!=null){if(v.Da){var D=v.cd,q=v.bd,W=-2&v.v,J=-2&v.j;if(0>W||0>J||0>=D||0>=q||W+D>l||J+q>f)return 2;l=D,f=q}if(v.da){if(!z(l,f,D=[v.ib],q=[v.hb]))return 2;l=D[0],f=q[0]}}C.width=l,C.height=f;e:{var ee=C.width,le=C.height;if(l=C.S,0>=ee||0>=le||!(l>=vo&&13>l))l=2;else{if(0>=C.Rd&&C.sd==null){W=q=D=f=0;var _e=(J=ee*wd[l])*le;if(11>l||(q=(le+1)/2*(f=(ee+1)/2),l==12&&(W=(D=ee)*le)),(le=a(_e+2*q+W))==null){l=1;break e}C.sd=le,11>l?((ee=C.f.RGBA).eb=le,ee.fb=0,ee.A=J,ee.size=_e):((ee=C.f.kb).y=le,ee.O=0,ee.fa=J,ee.Fd=_e,ee.f=le,ee.N=0+_e,ee.Ab=f,ee.Cd=q,ee.ea=le,ee.W=0+_e+q,ee.Db=f,ee.Ed=q,l==12&&(ee.F=le,ee.J=0+_e+2*q),ee.Tc=W,ee.lb=D)}if(f=1,D=C.S,q=C.width,W=C.height,D>=vo&&13>D)if(11>D)l=C.f.RGBA,f&=(J=Math.abs(l.A))*(W-1)+q<=l.size,f&=J>=q*wd[D],f&=l.eb!=null;else{l=C.f.kb,J=(q+1)/2,_e=(W+1)/2,ee=Math.abs(l.fa),le=Math.abs(l.Ab);var Re=Math.abs(l.Db),ce=Math.abs(l.lb),Ce=ce*(W-1)+q;f&=ee*(W-1)+q<=l.Fd,f&=le*(_e-1)+J<=l.Cd,f=(f&=Re*(_e-1)+J<=l.Ed)&ee>=q&le>=J&Re>=J,f&=l.y!=null,f&=l.f!=null,f&=l.ea!=null,D==12&&(f&=ce>=q,f&=Ce<=l.Tc,f&=l.F!=null)}else f=0;l=f?0:2}}return l!=0||v!=null&&v.fd&&(l=Vi(C)),l}var Za=64,as=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535,131071,262143,524287,1048575,2097151,4194303,8388607,16777215],is=24,Ca=32,ca=8,Aa=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];me("Predictor0","PredictorAdd0"),O.Predictor0=function(){return 4278190080},O.Predictor1=function(l){return l},O.Predictor2=function(l,f,v){return f[v+0]},O.Predictor3=function(l,f,v){return f[v+1]},O.Predictor4=function(l,f,v){return f[v-1]},O.Predictor5=function(l,f,v){return Le(Le(l,f[v+1]),f[v+0])},O.Predictor6=function(l,f,v){return Le(l,f[v-1])},O.Predictor7=function(l,f,v){return Le(l,f[v+0])},O.Predictor8=function(l,f,v){return Le(f[v-1],f[v+0])},O.Predictor9=function(l,f,v){return Le(f[v+0],f[v+1])},O.Predictor10=function(l,f,v){return Le(Le(l,f[v-1]),Le(f[v+0],f[v+1]))},O.Predictor11=function(l,f,v){var C=f[v+0];return 0>=Ye(C>>24&255,l>>24&255,(f=f[v-1])>>24&255)+Ye(C>>16&255,l>>16&255,f>>16&255)+Ye(C>>8&255,l>>8&255,f>>8&255)+Ye(255&C,255&l,255&f)?C:l},O.Predictor12=function(l,f,v){var C=f[v+0];return(Ie((l>>24&255)+(C>>24&255)-((f=f[v-1])>>24&255))<<24|Ie((l>>16&255)+(C>>16&255)-(f>>16&255))<<16|Ie((l>>8&255)+(C>>8&255)-(f>>8&255))<<8|Ie((255&l)+(255&C)-(255&f)))>>>0},O.Predictor13=function(l,f,v){var C=f[v-1];return(Te((l=Le(l,f[v+0]))>>24&255,C>>24&255)<<24|Te(l>>16&255,C>>16&255)<<16|Te(l>>8&255,C>>8&255)<<8|Te(255&l,255&C))>>>0};var Gi=O.PredictorAdd0;O.PredictorAdd1=ft,me("Predictor2","PredictorAdd2"),me("Predictor3","PredictorAdd3"),me("Predictor4","PredictorAdd4"),me("Predictor5","PredictorAdd5"),me("Predictor6","PredictorAdd6"),me("Predictor7","PredictorAdd7"),me("Predictor8","PredictorAdd8"),me("Predictor9","PredictorAdd9"),me("Predictor10","PredictorAdd10"),me("Predictor11","PredictorAdd11"),me("Predictor12","PredictorAdd12"),me("Predictor13","PredictorAdd13");var bi=O.PredictorAdd2;ut("ColorIndexInverseTransform","MapARGB","32b",function(l){return l>>8&255},function(l){return l}),ut("VP8LColorIndexInverseTransformAlpha","MapAlpha","8b",function(l){return l},function(l){return l>>8&255});var sn,yo=O.ColorIndexInverseTransform,Vs=O.MapARGB,Gs=O.VP8LColorIndexInverseTransformAlpha,Yi=O.MapAlpha,Ji=O.VP8LPredictorsAdd=[];Ji.length=16,(O.VP8LPredictors=[]).length=16,(O.VP8LPredictorsAdd_C=[]).length=16,(O.VP8LPredictors_C=[]).length=16;var Zi,Ki,La,Ea,Pa,Ka,Ta,Xa,Ns,Ys,wr,Pr,an,gn,da,Xi,wi,bo,Jc,Zc,Kc,Xc,Qc,ed,Qi,td,rd,nd,sd=a(511),ad=a(2041),id=a(225),od=a(767),ld=0,_l=ad,wo=id,os=od,_s=sd,vo=0,No=1,cd=2,_o=3,jo=4,jl=5,dd=6,Sl=7,kl=8,So=9,Cl=10,pp=[2,3,7],mp=[3,3,11],ud=[280,256,256,256,40],gp=[0,1,1,1,0],xp=[17,18,0,1,2,3,4,5,16,6,7,8,9,10,11,12,13,14,15],yp=[24,7,23,25,40,6,39,41,22,26,38,42,56,5,55,57,21,27,54,58,37,43,72,4,71,73,20,28,53,59,70,74,36,44,88,69,75,52,60,3,87,89,19,29,86,90,35,45,68,76,85,91,51,61,104,2,103,105,18,30,102,106,34,46,84,92,67,77,101,107,50,62,120,1,119,121,83,93,17,31,100,108,66,78,118,122,33,47,117,123,49,63,99,109,82,94,0,116,124,65,79,16,32,98,110,48,115,125,81,95,64,114,126,97,111,80,113,127,96,112],bp=[2954,2956,2958,2962,2970,2986,3018,3082,3212,3468,3980,5004],wp=8,Al=[4,5,6,7,8,9,10,10,11,12,13,14,15,16,17,17,18,19,20,20,21,21,22,22,23,23,24,25,25,26,27,28,29,30,31,32,33,34,35,36,37,37,38,39,40,41,42,43,44,45,46,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,76,77,78,79,80,81,82,83,84,85,86,87,88,89,91,93,95,96,98,100,101,102,104,106,108,110,112,114,116,118,122,124,126,128,130,132,134,136,138,140,143,145,148,151,154,157],Ll=[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,60,62,64,66,68,70,72,74,76,78,80,82,84,86,88,90,92,94,96,98,100,102,104,106,108,110,112,114,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,167,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,234,239,245,249,254,259,264,269,274,279,284],eo=null,vp=[[173,148,140,0],[176,155,140,135,0],[180,157,141,134,130,0],[254,254,243,230,196,177,153,140,133,130,129,0]],Np=[0,1,4,8,5,2,3,6,9,12,13,10,7,11,14,15],hd=[-0,1,-1,2,-2,3,4,6,-3,5,-4,-5,-6,7,-7,8,-8,-9],_p=[[[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]],[[253,136,254,255,228,219,128,128,128,128,128],[189,129,242,255,227,213,255,219,128,128,128],[106,126,227,252,214,209,255,255,128,128,128]],[[1,98,248,255,236,226,255,255,128,128,128],[181,133,238,254,221,234,255,154,128,128,128],[78,134,202,247,198,180,255,219,128,128,128]],[[1,185,249,255,243,255,128,128,128,128,128],[184,150,247,255,236,224,128,128,128,128,128],[77,110,216,255,236,230,128,128,128,128,128]],[[1,101,251,255,241,255,128,128,128,128,128],[170,139,241,252,236,209,255,255,128,128,128],[37,116,196,243,228,255,255,255,128,128,128]],[[1,204,254,255,245,255,128,128,128,128,128],[207,160,250,255,238,128,128,128,128,128,128],[102,103,231,255,211,171,128,128,128,128,128]],[[1,152,252,255,240,255,128,128,128,128,128],[177,135,243,255,234,225,128,128,128,128,128],[80,129,211,255,194,224,128,128,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[246,1,255,128,128,128,128,128,128,128,128],[255,128,128,128,128,128,128,128,128,128,128]]],[[[198,35,237,223,193,187,162,160,145,155,62],[131,45,198,221,172,176,220,157,252,221,1],[68,47,146,208,149,167,221,162,255,223,128]],[[1,149,241,255,221,224,255,255,128,128,128],[184,141,234,253,222,220,255,199,128,128,128],[81,99,181,242,176,190,249,202,255,255,128]],[[1,129,232,253,214,197,242,196,255,255,128],[99,121,210,250,201,198,255,202,128,128,128],[23,91,163,242,170,187,247,210,255,255,128]],[[1,200,246,255,234,255,128,128,128,128,128],[109,178,241,255,231,245,255,255,128,128,128],[44,130,201,253,205,192,255,255,128,128,128]],[[1,132,239,251,219,209,255,165,128,128,128],[94,136,225,251,218,190,255,255,128,128,128],[22,100,174,245,186,161,255,199,128,128,128]],[[1,182,249,255,232,235,128,128,128,128,128],[124,143,241,255,227,234,128,128,128,128,128],[35,77,181,251,193,211,255,205,128,128,128]],[[1,157,247,255,236,231,255,255,128,128,128],[121,141,235,255,225,227,255,255,128,128,128],[45,99,188,251,195,217,255,224,128,128,128]],[[1,1,251,255,213,255,128,128,128,128,128],[203,1,248,255,255,128,128,128,128,128,128],[137,1,177,255,224,255,128,128,128,128,128]]],[[[253,9,248,251,207,208,255,192,128,128,128],[175,13,224,243,193,185,249,198,255,255,128],[73,17,171,221,161,179,236,167,255,234,128]],[[1,95,247,253,212,183,255,255,128,128,128],[239,90,244,250,211,209,255,255,128,128,128],[155,77,195,248,188,195,255,255,128,128,128]],[[1,24,239,251,218,219,255,205,128,128,128],[201,51,219,255,196,186,128,128,128,128,128],[69,46,190,239,201,218,255,228,128,128,128]],[[1,191,251,255,255,128,128,128,128,128,128],[223,165,249,255,213,255,128,128,128,128,128],[141,124,248,255,255,128,128,128,128,128,128]],[[1,16,248,255,255,128,128,128,128,128,128],[190,36,230,255,236,255,128,128,128,128,128],[149,1,255,128,128,128,128,128,128,128,128]],[[1,226,255,128,128,128,128,128,128,128,128],[247,192,255,128,128,128,128,128,128,128,128],[240,128,255,128,128,128,128,128,128,128,128]],[[1,134,252,255,255,128,128,128,128,128,128],[213,62,250,255,255,128,128,128,128,128,128],[55,93,255,128,128,128,128,128,128,128,128]],[[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128],[128,128,128,128,128,128,128,128,128,128,128]]],[[[202,24,213,235,186,191,220,160,240,175,255],[126,38,182,232,169,184,228,174,255,187,128],[61,46,138,219,151,178,240,170,255,216,128]],[[1,112,230,250,199,191,247,159,255,255,128],[166,109,228,252,211,215,255,174,128,128,128],[39,77,162,232,172,180,245,178,255,255,128]],[[1,52,220,246,198,199,249,220,255,255,128],[124,74,191,243,183,193,250,221,255,255,128],[24,71,130,219,154,170,243,182,255,255,128]],[[1,182,225,249,219,240,255,224,128,128,128],[149,150,226,252,216,205,255,171,128,128,128],[28,108,170,242,183,194,254,223,255,255,128]],[[1,81,230,252,204,203,255,192,128,128,128],[123,102,209,247,188,196,255,233,128,128,128],[20,95,153,243,164,173,255,203,128,128,128]],[[1,222,248,255,216,213,128,128,128,128,128],[168,175,246,252,235,205,255,255,128,128,128],[47,116,215,255,211,212,255,255,128,128,128]],[[1,121,236,253,212,214,255,255,128,128,128],[141,84,213,252,201,202,255,219,128,128,128],[42,80,160,240,162,185,255,205,128,128,128]],[[1,1,255,128,128,128,128,128,128,128,128],[244,1,255,128,128,128,128,128,128,128,128],[238,1,255,128,128,128,128,128,128,128,128]]]],jp=[[[231,120,48,89,115,113,120,152,112],[152,179,64,126,170,118,46,70,95],[175,69,143,80,85,82,72,155,103],[56,58,10,171,218,189,17,13,152],[114,26,17,163,44,195,21,10,173],[121,24,80,195,26,62,44,64,85],[144,71,10,38,171,213,144,34,26],[170,46,55,19,136,160,33,206,71],[63,20,8,114,114,208,12,9,226],[81,40,11,96,182,84,29,16,36]],[[134,183,89,137,98,101,106,165,148],[72,187,100,130,157,111,32,75,80],[66,102,167,99,74,62,40,234,128],[41,53,9,178,241,141,26,8,107],[74,43,26,146,73,166,49,23,157],[65,38,105,160,51,52,31,115,128],[104,79,12,27,217,255,87,17,7],[87,68,71,44,114,51,15,186,23],[47,41,14,110,182,183,21,17,194],[66,45,25,102,197,189,23,18,22]],[[88,88,147,150,42,46,45,196,205],[43,97,183,117,85,38,35,179,61],[39,53,200,87,26,21,43,232,171],[56,34,51,104,114,102,29,93,77],[39,28,85,171,58,165,90,98,64],[34,22,116,206,23,34,43,166,73],[107,54,32,26,51,1,81,43,31],[68,25,106,22,64,171,36,225,114],[34,19,21,102,132,188,16,76,124],[62,18,78,95,85,57,50,48,51]],[[193,101,35,159,215,111,89,46,111],[60,148,31,172,219,228,21,18,111],[112,113,77,85,179,255,38,120,114],[40,42,1,196,245,209,10,25,109],[88,43,29,140,166,213,37,43,154],[61,63,30,155,67,45,68,1,209],[100,80,8,43,154,1,51,26,71],[142,78,78,16,255,128,34,197,171],[41,40,5,102,211,183,4,1,221],[51,50,17,168,209,192,23,25,82]],[[138,31,36,171,27,166,38,44,229],[67,87,58,169,82,115,26,59,179],[63,59,90,180,59,166,93,73,154],[40,40,21,116,143,209,34,39,175],[47,15,16,183,34,223,49,45,183],[46,17,33,183,6,98,15,32,183],[57,46,22,24,128,1,54,17,37],[65,32,73,115,28,128,23,128,205],[40,3,9,115,51,192,18,6,223],[87,37,9,115,59,77,64,21,47]],[[104,55,44,218,9,54,53,130,226],[64,90,70,205,40,41,23,26,57],[54,57,112,184,5,41,38,166,213],[30,34,26,133,152,116,10,32,134],[39,19,53,221,26,114,32,73,255],[31,9,65,234,2,15,1,118,73],[75,32,12,51,192,255,160,43,51],[88,31,35,67,102,85,55,186,85],[56,21,23,111,59,205,45,37,192],[55,38,70,124,73,102,1,34,98]],[[125,98,42,88,104,85,117,175,82],[95,84,53,89,128,100,113,101,45],[75,79,123,47,51,128,81,171,1],[57,17,5,71,102,57,53,41,49],[38,33,13,121,57,73,26,1,85],[41,10,67,138,77,110,90,47,114],[115,21,2,10,102,255,166,23,6],[101,29,16,10,85,128,101,196,26],[57,18,10,102,102,213,34,20,43],[117,20,15,36,163,128,68,1,26]],[[102,61,71,37,34,53,31,243,192],[69,60,71,38,73,119,28,222,37],[68,45,128,34,1,47,11,245,171],[62,17,19,70,146,85,55,62,70],[37,43,37,154,100,163,85,160,1],[63,9,92,136,28,64,32,201,85],[75,15,9,9,64,255,184,119,16],[86,6,28,5,64,255,25,248,1],[56,8,17,132,137,255,55,116,128],[58,15,20,82,135,57,26,121,40]],[[164,50,31,137,154,133,25,35,218],[51,103,44,131,131,123,31,6,158],[86,40,64,135,148,224,45,183,128],[22,26,17,131,240,154,14,1,209],[45,16,21,91,64,222,7,1,197],[56,21,39,155,60,138,23,102,213],[83,12,13,54,192,255,68,47,28],[85,26,85,85,128,128,32,146,171],[18,11,7,63,144,171,4,4,246],[35,27,10,146,174,171,12,26,128]],[[190,80,35,99,180,80,126,54,45],[85,126,47,87,176,51,41,20,32],[101,75,128,139,118,146,116,128,85],[56,41,15,176,236,85,37,9,62],[71,30,17,119,118,255,17,18,138],[101,38,60,138,55,70,43,26,142],[146,36,19,30,171,255,97,27,20],[138,45,61,62,219,1,81,188,64],[32,41,20,117,151,142,20,21,163],[112,19,12,61,195,128,48,4,24]]],Sp=[[[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[176,246,255,255,255,255,255,255,255,255,255],[223,241,252,255,255,255,255,255,255,255,255],[249,253,253,255,255,255,255,255,255,255,255]],[[255,244,252,255,255,255,255,255,255,255,255],[234,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255]],[[255,246,254,255,255,255,255,255,255,255,255],[239,253,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[251,255,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[251,254,254,255,255,255,255,255,255,255,255],[254,255,254,255,255,255,255,255,255,255,255]],[[255,254,253,255,254,255,255,255,255,255,255],[250,255,254,255,254,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[217,255,255,255,255,255,255,255,255,255,255],[225,252,241,253,255,255,254,255,255,255,255],[234,250,241,250,253,255,253,254,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[223,254,254,255,255,255,255,255,255,255,255],[238,253,254,254,255,255,255,255,255,255,255]],[[255,248,254,255,255,255,255,255,255,255,255],[249,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,255,255,255,255,255,255,255,255,255],[247,254,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[252,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[253,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[186,251,250,255,255,255,255,255,255,255,255],[234,251,244,254,255,255,255,255,255,255,255],[251,251,243,253,254,255,254,255,255,255,255]],[[255,253,254,255,255,255,255,255,255,255,255],[236,253,254,255,255,255,255,255,255,255,255],[251,253,253,254,254,255,255,255,255,255,255]],[[255,254,254,255,255,255,255,255,255,255,255],[254,254,254,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,254,255,255,255,255,255,255,255,255,255],[254,254,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]],[[[248,255,255,255,255,255,255,255,255,255,255],[250,254,252,254,255,255,255,255,255,255,255],[248,254,249,253,255,255,255,255,255,255,255]],[[255,253,253,255,255,255,255,255,255,255,255],[246,253,253,255,255,255,255,255,255,255,255],[252,254,251,254,254,255,255,255,255,255,255]],[[255,254,252,255,255,255,255,255,255,255,255],[248,254,253,255,255,255,255,255,255,255,255],[253,255,254,254,255,255,255,255,255,255,255]],[[255,251,254,255,255,255,255,255,255,255,255],[245,251,254,255,255,255,255,255,255,255,255],[253,253,254,255,255,255,255,255,255,255,255]],[[255,251,253,255,255,255,255,255,255,255,255],[252,253,254,255,255,255,255,255,255,255,255],[255,254,255,255,255,255,255,255,255,255,255]],[[255,252,255,255,255,255,255,255,255,255,255],[249,255,254,255,255,255,255,255,255,255,255],[255,255,254,255,255,255,255,255,255,255,255]],[[255,255,253,255,255,255,255,255,255,255,255],[250,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]],[[255,255,255,255,255,255,255,255,255,255,255],[254,255,255,255,255,255,255,255,255,255,255],[255,255,255,255,255,255,255,255,255,255,255]]]],kp=[0,1,2,3,6,4,5,6,6,6,6,6,6,6,6,7,0],Ia=[],Ps=[],ua=[],Cp=1,fd=2,Fa=[],js=[];Ze("UpsampleRgbLinePair",St,3),Ze("UpsampleBgrLinePair",rr,3),Ze("UpsampleRgbaLinePair",mr,4),Ze("UpsampleBgraLinePair",_r,4),Ze("UpsampleArgbLinePair",br,4),Ze("UpsampleRgba4444LinePair",Dt,2),Ze("UpsampleRgb565LinePair",Nr,2);var Ap=O.UpsampleRgbLinePair,Lp=O.UpsampleBgrLinePair,pd=O.UpsampleRgbaLinePair,md=O.UpsampleBgraLinePair,gd=O.UpsampleArgbLinePair,xd=O.UpsampleRgba4444LinePair,Ep=O.UpsampleRgb565LinePair,ko=16,Co=1<<ko-1,to=-227,El=482,Pp=6,yd=0,Tp=a(256),Ip=a(256),Fp=a(256),Op=a(256),Rp=a(El-to),Dp=a(El-to);gr("YuvToRgbRow",St,3),gr("YuvToBgrRow",rr,3),gr("YuvToRgbaRow",mr,4),gr("YuvToBgraRow",_r,4),gr("YuvToArgbRow",br,4),gr("YuvToRgba4444Row",Dt,2),gr("YuvToRgb565Row",Nr,2);var bd=[0,4,8,12,128,132,136,140,256,260,264,268,384,388,392,396],Ao=[0,2,8],Bp=[8,7,6,4,4,2,2,2,1,1,1,1],Mp=1;this.WebPDecodeRGBA=function(l,f,v,C,D){var q=No,W=new Ge,J=new Rt;W.ba=J,J.S=q,J.width=[J.width],J.height=[J.height];var ee=J.width,le=J.height,_e=new yt;if(_e==null||l==null)var Re=2;else t(_e!=null),Re=xr(l,f,v,_e.width,_e.height,_e.Pd,_e.Qd,_e.format,null);if(Re!=0?ee=0:(ee!=null&&(ee[0]=_e.width[0]),le!=null&&(le[0]=_e.height[0]),ee=1),ee){J.width=J.width[0],J.height=J.height[0],C!=null&&(C[0]=J.width),D!=null&&(D[0]=J.height);e:{if(C=new Tn,(D=new Xe).data=l,D.w=f,D.ha=v,D.kd=1,f=[0],t(D!=null),((l=xr(D.data,D.w,D.ha,null,null,null,f,null,D))==0||l==7)&&f[0]&&(l=4),(f=l)==0){if(t(W!=null),C.data=D.data,C.w=D.w+D.offset,C.ha=D.ha-D.offset,C.put=zt,C.ac=rn,C.bc=mn,C.ma=W,D.xa){if((l=Pn())==null){W=1;break e}if((function(ce,Ce){var Pe=[0],Ue=[0],Oe=[0];t:for(;;){if(ce==null)return 0;if(Ce==null)return ce.a=2,0;if(ce.l=Ce,ce.a=0,ie(ce.m,Ce.data,Ce.w,Ce.ha),!vn(ce.m,Pe,Ue,Oe)){ce.a=3;break t}if(ce.xb=fd,Ce.width=Pe[0],Ce.height=Ue[0],!ct(Pe[0],Ue[0],1,ce,null))break t;return 1}return t(ce.a!=0),0})(l,C)){if(C=(f=ka(C.width,C.height,W.Oa,W.ba))==0){t:{C=l;r:for(;;){if(C==null){C=0;break t}if(t(C.s.yc!=null),t(C.s.Ya!=null),t(0<C.s.Wb),t((v=C.l)!=null),t((D=v.ma)!=null),C.xb!=0){if(C.ca=D.ba,C.tb=D.tb,t(C.ca!=null),!la(D.Oa,v,_o)){C.a=2;break r}if(!Zr(C,v.width)||v.da)break r;if((v.da||_t(C.ca.S))&&$e(),11>C.ca.S||(alert("todo:WebPInitConvertARGBToYUV"),C.ca.f.kb.F!=null&&$e()),C.Pb&&0<C.s.ua&&C.s.vb.X==null&&!P(C.s.vb,C.s.Wa.Xa)){C.a=1;break r}C.xb=0}if(!Hr(C,C.V,C.Ba,C.c,C.i,v.o,vr))break r;D.Dc=C.Ma,C=1;break t}t(C.a!=0),C=0}C=!C}C&&(f=l.a)}else f=l.a}else{if((l=new bs)==null){W=1;break e}if(l.Fa=D.na,l.P=D.P,l.qc=D.Sa,pt(l,C)){if((f=ka(C.width,C.height,W.Oa,W.ba))==0){if(l.Aa=0,v=W.Oa,t((D=l)!=null),v!=null){if(0<(ee=0>(ee=v.Md)?0:100<ee?255:255*ee/100)){for(le=_e=0;4>le;++le)12>(Re=D.pb[le]).lc&&(Re.ia=ee*Bp[0>Re.lc?0:Re.lc]>>3),_e|=Re.ia;_e&&(alert("todo:VP8InitRandom"),D.ia=1)}D.Ga=v.Id,100<D.Ga?D.Ga=100:0>D.Ga&&(D.Ga=0)}(function(ce,Ce){if(ce==null)return 0;if(Ce==null)return Ar(ce,2,"NULL VP8Io parameter in VP8Decode().");if(!ce.cb&&!pt(ce,Ce))return 0;if(t(ce.cb),Ce.ac==null||Ce.ac(Ce)){Ce.ob&&(ce.L=0);var Pe=Ao[ce.L];if(ce.L==2?(ce.yb=0,ce.zb=0):(ce.yb=Ce.v-Pe>>4,ce.zb=Ce.j-Pe>>4,0>ce.yb&&(ce.yb=0),0>ce.zb&&(ce.zb=0)),ce.Va=Ce.o+15+Pe>>4,ce.Hb=Ce.va+15+Pe>>4,ce.Hb>ce.za&&(ce.Hb=ce.za),ce.Va>ce.Ub&&(ce.Va=ce.Ub),0<ce.L){var Ue=ce.ed;for(Pe=0;4>Pe;++Pe){var Oe;if(ce.Qa.Cb){var We=ce.Qa.Lb[Pe];ce.Qa.Fb||(We+=Ue.Tb)}else We=Ue.Tb;for(Oe=0;1>=Oe;++Oe){var Je=ce.gd[Pe][Oe],st=We;if(Ue.Pc&&(st+=Ue.vd[0],Oe&&(st+=Ue.od[0])),0<(st=0>st?0:63<st?63:st)){var tt=st;0<Ue.wb&&(tt=4<Ue.wb?tt>>2:tt>>1)>9-Ue.wb&&(tt=9-Ue.wb),1>tt&&(tt=1),Je.dd=tt,Je.tc=2*st+tt,Je.ld=40<=st?2:15<=st?1:0}else Je.tc=0;Je.La=Oe}}}Pe=0}else Ar(ce,6,"Frame setup failed"),Pe=ce.a;if(Pe=Pe==0){if(Pe){ce.$c=0,0<ce.Aa||(ce.Ic=Mp);t:{Pe=ce.Ic,Ue=4*(tt=ce.za);var Mt=32*tt,kt=tt+1,sr=0<ce.L?tt*(0<ce.Aa?2:1):0,It=(ce.Aa==2?2:1)*tt;if((Je=Ue+832+(Oe=3*(16*Pe+Ao[ce.L])/2*Mt)+(We=ce.Fa!=null&&0<ce.Fa.length?ce.Kc.c*ce.Kc.i:0))!=Je)Pe=0;else{if(Je>ce.Vb){if(ce.Vb=0,ce.Ec=a(Je),ce.Fc=0,ce.Ec==null){Pe=Ar(ce,1,"no memory during frame initialization.");break t}ce.Vb=Je}Je=ce.Ec,st=ce.Fc,ce.Ac=Je,ce.Bc=st,st+=Ue,ce.Gd=d(Mt,xt),ce.Hd=0,ce.rb=d(kt+1,At),ce.sb=1,ce.wa=sr?d(sr,ot):null,ce.Y=0,ce.D.Nb=0,ce.D.wa=ce.wa,ce.D.Y=ce.Y,0<ce.Aa&&(ce.D.Y+=tt),t(!0),ce.oc=Je,ce.pc=st,st+=832,ce.ya=d(It,Wt),ce.aa=0,ce.D.ya=ce.ya,ce.D.aa=ce.aa,ce.Aa==2&&(ce.D.aa+=tt),ce.R=16*tt,ce.B=8*tt,tt=(Mt=Ao[ce.L])*ce.R,Mt=Mt/2*ce.B,ce.sa=Je,ce.ta=st+tt,ce.qa=ce.sa,ce.ra=ce.ta+16*Pe*ce.R+Mt,ce.Ha=ce.qa,ce.Ia=ce.ra+8*Pe*ce.B+Mt,ce.$c=0,st+=Oe,ce.mb=We?Je:null,ce.nb=We?st:null,t(st+We<=ce.Fc+ce.Vb),Vr(ce),i(ce.Ac,ce.Bc,0,Ue),Pe=1}}if(Pe){if(Ce.ka=0,Ce.y=ce.sa,Ce.O=ce.ta,Ce.f=ce.qa,Ce.N=ce.ra,Ce.ea=ce.Ha,Ce.Vd=ce.Ia,Ce.fa=ce.R,Ce.Rc=ce.B,Ce.F=null,Ce.J=0,!ld){for(Pe=-255;255>=Pe;++Pe)sd[255+Pe]=0>Pe?-Pe:Pe;for(Pe=-1020;1020>=Pe;++Pe)ad[1020+Pe]=-128>Pe?-128:127<Pe?127:Pe;for(Pe=-112;112>=Pe;++Pe)id[112+Pe]=-16>Pe?-16:15<Pe?15:Pe;for(Pe=-255;510>=Pe;++Pe)od[255+Pe]=0>Pe?0:255<Pe?255:Pe;ld=1}Ta=Ws,Xa=wa,Ys=Fr,wr=va,Pr=Na,Ns=Kr,an=xi,gn=ss,da=R,Xi=oe,wi=yi,bo=x,Jc=be,Zc=Ee,Kc=oa,Xc=Ja,Qc=Sa,ed=gi,Ps[0]=zi,Ps[1]=$a,Ps[2]=fi,Ps[3]=pi,Ps[4]=As,Ps[5]=qi,Ps[6]=ws,Ps[7]=$i,Ps[8]=ja,Ps[9]=sa,Ia[0]=ui,Ia[1]=na,Ia[2]=_a,Ia[3]=di,Ia[4]=Cs,Ia[5]=Wa,Ia[6]=hi,ua[0]=Hi,ua[1]=ci,ua[2]=aa,ua[3]=Wi,ua[4]=Va,ua[5]=Ha,ua[6]=mi,Pe=1}else Pe=0}Pe&&(Pe=(function(cr,xn){for(cr.M=0;cr.M<cr.Va;++cr.M){var ar,Ft=cr.Jc[cr.M&cr.Xb],mt=cr.m,on=cr;for(ar=0;ar<on.za;++ar){var er=mt,dr=on,Mr=dr.Ac,An=dr.Bc+4*ar,qn=dr.zc,Xr=dr.ya[dr.aa+ar];if(dr.Qa.Bb?Xr.$b=De(er,dr.Pa.jb[0])?2+De(er,dr.Pa.jb[2]):De(er,dr.Pa.jb[1]):Xr.$b=0,dr.kc&&(Xr.Ad=De(er,dr.Bd)),Xr.Za=!De(er,145)+0,Xr.Za){var In=Xr.Ob,$n=0;for(dr=0;4>dr;++dr){var yn,fr=qn[0+dr];for(yn=0;4>yn;++yn){fr=jp[Mr[An+yn]][fr];for(var jr=hd[De(er,fr[0])];0<jr;)jr=hd[2*jr+De(er,fr[jr])];fr=-jr,Mr[An+yn]=fr}s(In,$n,Mr,An,4),$n+=4,qn[0+dr]=fr}}else fr=De(er,156)?De(er,128)?1:3:De(er,163)?2:0,Xr.Ob[0]=fr,i(Mr,An,fr,4),i(qn,0,fr,4);Xr.Dd=De(er,142)?De(er,114)?De(er,183)?1:3:2:0}if(on.m.Ka)return Ar(cr,7,"Premature end-of-partition0 encountered.");for(;cr.ja<cr.za;++cr.ja){if(on=Ft,er=(mt=cr).rb[mt.sb-1],Mr=mt.rb[mt.sb+mt.ja],ar=mt.ya[mt.aa+mt.ja],An=mt.kc?ar.Ad:0)er.la=Mr.la=0,ar.Za||(er.Na=Mr.Na=0),ar.Hc=0,ar.Gc=0,ar.ia=0;else{var Qr,Sr;if(er=Mr,Mr=on,An=mt.Pa.Xc,qn=mt.ya[mt.aa+mt.ja],Xr=mt.pb[qn.$b],dr=qn.ad,In=0,$n=mt.rb[mt.sb-1],fr=yn=0,i(dr,In,0,384),qn.Za)var Ln=0,Ts=An[3];else{jr=a(16);var ln=er.Na+$n.Na;if(ln=eo(Mr,An[1],ln,Xr.Eb,0,jr,0),er.Na=$n.Na=(0<ln)+0,1<ln)Ta(jr,0,dr,In);else{var Kn=jr[0]+3>>3;for(jr=0;256>jr;jr+=16)dr[In+jr]=Kn}Ln=1,Ts=An[0]}var Tr=15&er.la,bn=15&$n.la;for(jr=0;4>jr;++jr){var ls=1&bn;for(Kn=Sr=0;4>Kn;++Kn)Tr=Tr>>1|(ls=(ln=eo(Mr,Ts,ln=ls+(1&Tr),Xr.Sc,Ln,dr,In))>Ln)<<7,Sr=Sr<<2|(3<ln?3:1<ln?2:dr[In+0]!=0),In+=16;Tr>>=4,bn=bn>>1|ls<<7,yn=(yn<<8|Sr)>>>0}for(Ts=Tr,Ln=bn>>4,Qr=0;4>Qr;Qr+=2){for(Sr=0,Tr=er.la>>4+Qr,bn=$n.la>>4+Qr,jr=0;2>jr;++jr){for(ls=1&bn,Kn=0;2>Kn;++Kn)ln=ls+(1&Tr),Tr=Tr>>1|(ls=0<(ln=eo(Mr,An[2],ln,Xr.Qc,0,dr,In)))<<3,Sr=Sr<<2|(3<ln?3:1<ln?2:dr[In+0]!=0),In+=16;Tr>>=2,bn=bn>>1|ls<<5}fr|=Sr<<4*Qr,Ts|=Tr<<4<<Qr,Ln|=(240&bn)<<Qr}er.la=Ts,$n.la=Ln,qn.Hc=yn,qn.Gc=fr,qn.ia=43690&fr?0:Xr.ia,An=!(yn|fr)}if(0<mt.L&&(mt.wa[mt.Y+mt.ja]=mt.gd[ar.$b][ar.Za],mt.wa[mt.Y+mt.ja].La|=!An),on.Ka)return Ar(cr,7,"Premature end-of-file encountered.")}if(Vr(cr),mt=xn,on=1,ar=(Ft=cr).D,er=0<Ft.L&&Ft.M>=Ft.zb&&Ft.M<=Ft.Va,Ft.Aa==0)t:{if(ar.M=Ft.M,ar.uc=er,nr(Ft,ar),on=1,ar=(Sr=Ft.D).Nb,er=(fr=Ao[Ft.L])*Ft.R,Mr=fr/2*Ft.B,jr=16*ar*Ft.R,Kn=8*ar*Ft.B,An=Ft.sa,qn=Ft.ta-er+jr,Xr=Ft.qa,dr=Ft.ra-Mr+Kn,In=Ft.Ha,$n=Ft.Ia-Mr+Kn,bn=(Tr=Sr.M)==0,yn=Tr>=Ft.Va-1,Ft.Aa==2&&nr(Ft,Sr),Sr.uc)for(ls=(ln=Ft).D.M,t(ln.D.uc),Sr=ln.yb;Sr<ln.Hb;++Sr){Ln=Sr,Ts=ls;var Wn=(cs=(En=ln).D).Nb;Qr=En.R;var cs=cs.wa[cs.Y+Ln],ds=En.sa,Xn=En.ta+16*Wn*Qr+16*Ln,us=cs.dd,Or=cs.tc;if(Or!=0)if(t(3<=Or),En.L==1)0<Ln&&Xc(ds,Xn,Qr,Or+4),cs.La&&ed(ds,Xn,Qr,Or),0<Ts&&Kc(ds,Xn,Qr,Or+4),cs.La&&Qc(ds,Xn,Qr,Or);else{var hs=En.B,Is=En.qa,Qa=En.ra+8*Wn*hs+8*Ln,ha=En.Ha,En=En.Ia+8*Wn*hs+8*Ln;Wn=cs.ld,0<Ln&&(gn(ds,Xn,Qr,Or+4,us,Wn),Xi(Is,Qa,ha,En,hs,Or+4,us,Wn)),cs.La&&(bo(ds,Xn,Qr,Or,us,Wn),Zc(Is,Qa,ha,En,hs,Or,us,Wn)),0<Ts&&(an(ds,Xn,Qr,Or+4,us,Wn),da(Is,Qa,ha,En,hs,Or+4,us,Wn)),cs.La&&(wi(ds,Xn,Qr,Or,us,Wn),Jc(Is,Qa,ha,En,hs,Or,us,Wn))}}if(Ft.ia&&alert("todo:DitherRow"),mt.put!=null){if(Sr=16*Tr,Tr=16*(Tr+1),bn?(mt.y=Ft.sa,mt.O=Ft.ta+jr,mt.f=Ft.qa,mt.N=Ft.ra+Kn,mt.ea=Ft.Ha,mt.W=Ft.Ia+Kn):(Sr-=fr,mt.y=An,mt.O=qn,mt.f=Xr,mt.N=dr,mt.ea=In,mt.W=$n),yn||(Tr-=fr),Tr>mt.o&&(Tr=mt.o),mt.F=null,mt.J=null,Ft.Fa!=null&&0<Ft.Fa.length&&Sr<Tr&&(mt.J=ge(Ft,mt,Sr,Tr-Sr),mt.F=Ft.mb,mt.F==null&&mt.F.length==0)){on=Ar(Ft,3,"Could not decode alpha data.");break t}Sr<mt.j&&(fr=mt.j-Sr,Sr=mt.j,t(!(1&fr)),mt.O+=Ft.R*fr,mt.N+=Ft.B*(fr>>1),mt.W+=Ft.B*(fr>>1),mt.F!=null&&(mt.J+=mt.width*fr)),Sr<Tr&&(mt.O+=mt.v,mt.N+=mt.v>>1,mt.W+=mt.v>>1,mt.F!=null&&(mt.J+=mt.v),mt.ka=Sr-mt.j,mt.U=mt.va-mt.v,mt.T=Tr-Sr,on=mt.put(mt))}ar+1!=Ft.Ic||yn||(s(Ft.sa,Ft.ta-er,An,qn+16*Ft.R,er),s(Ft.qa,Ft.ra-Mr,Xr,dr+8*Ft.B,Mr),s(Ft.Ha,Ft.Ia-Mr,In,$n+8*Ft.B,Mr))}if(!on)return Ar(cr,6,"Output aborted.")}return 1})(ce,Ce)),Ce.bc!=null&&Ce.bc(Ce),Pe&=1}return Pe?(ce.cb=0,Pe):0})(l,C)||(f=l.a)}}else f=l.a}f==0&&W.Oa!=null&&W.Oa.fd&&(f=Vi(W.ba))}W=f}q=W!=0?null:11>q?J.f.RGBA.eb:J.f.kb.y}else q=null;return q};var wd=[3,4,3,4,4,2,2,4,4,4,2,1,1]};function h(O,Q){for(var F="",k=0;k<4;k++)F+=String.fromCharCode(O[Q++]);return F}function p(O,Q){return O[Q+0]|O[Q+1]<<8}function b(O,Q){return(O[Q+0]|O[Q+1]<<8|O[Q+2]<<16)>>>0}function m(O,Q){return(O[Q+0]|O[Q+1]<<8|O[Q+2]<<16|O[Q+3]<<24)>>>0}new c;var u=[0],w=[0],g=[],N=new c,y=r,S=(function(O,Q){var F={},k=0,M=!1,_=0,te=0;if(F.frames=[],!(function(A,H){for(var Z=0;Z<4;Z++)if(A[H+Z]!="RIFF".charCodeAt(Z))return!0;return!1})(O,Q)){for(m(O,Q+=4),Q+=8;Q<O.length;){var ae=h(O,Q),re=m(O,Q+=4);Q+=4;var se=re+(1&re);switch(ae){case"VP8 ":case"VP8L":F.frames[k]===void 0&&(F.frames[k]={}),(ne=F.frames[k]).src_off=M?te:Q-8,ne.src_size=_+re+8,k++,M&&(M=!1,_=0,te=0);break;case"VP8X":(ne=F.header={}).feature_flags=O[Q];var ie=Q+4;ne.canvas_width=1+b(O,ie),ie+=3,ne.canvas_height=1+b(O,ie),ie+=3;break;case"ALPH":M=!0,_=se+8,te=Q-8;break;case"ANIM":(ne=F.header).bgcolor=m(O,Q),ie=Q+4,ne.loop_count=p(O,ie),ie+=2;break;case"ANMF":var je,ne;(ne=F.frames[k]={}).offset_x=2*b(O,Q),Q+=3,ne.offset_y=2*b(O,Q),Q+=3,ne.width=1+b(O,Q),Q+=3,ne.height=1+b(O,Q),Q+=3,ne.duration=b(O,Q),Q+=3,je=O[Q++],ne.dispose=1&je,ne.blend=je>>1&1}ae!="ANMF"&&(Q+=se)}return F}})(y,0);S.response=y,S.rgbaoutput=!0,S.dataurl=!1;var L=S.header?S.header:null,E=S.frames?S.frames:null;if(L){L.loop_counter=L.loop_count,u=[L.canvas_height],w=[L.canvas_width];for(var I=0;I<E.length&&E[I].blend!=0;I++);}var K=E[0],Y=N.WebPDecodeRGBA(y,K.src_off,K.src_size,w,u);K.rgba=Y,K.imgwidth=w[0],K.imgheight=u[0];for(var V=0;V<w[0]*u[0]*4;V++)g[V]=Y[V];return this.width=w,this.height=u,this.data=g,this}(function(r){var t,e,s,i,a,d,o,c,h,p=function(A){return A=A||{},this.isStrokeTransparent=A.isStrokeTransparent||!1,this.strokeOpacity=A.strokeOpacity||1,this.strokeStyle=A.strokeStyle||"#000000",this.fillStyle=A.fillStyle||"#000000",this.isFillTransparent=A.isFillTransparent||!1,this.fillOpacity=A.fillOpacity||1,this.font=A.font||"10px sans-serif",this.textBaseline=A.textBaseline||"alphabetic",this.textAlign=A.textAlign||"left",this.lineWidth=A.lineWidth||1,this.lineJoin=A.lineJoin||"miter",this.lineCap=A.lineCap||"butt",this.path=A.path||[],this.transform=A.transform!==void 0?A.transform.clone():new c,this.globalCompositeOperation=A.globalCompositeOperation||"normal",this.globalAlpha=A.globalAlpha||1,this.clip_path=A.clip_path||[],this.currentPoint=A.currentPoint||new d,this.miterLimit=A.miterLimit||10,this.lastPoint=A.lastPoint||new d,this.lineDashOffset=A.lineDashOffset||0,this.lineDash=A.lineDash||[],this.margin=A.margin||[0,0,0,0],this.prevPageLastElemOffset=A.prevPageLastElemOffset||0,this.ignoreClearRect=typeof A.ignoreClearRect!="boolean"||A.ignoreClearRect,this};r.events.push(["initialized",function(){this.context2d=new b(this),t=this.internal.f2,e=this.internal.getCoordinateString,s=this.internal.getVerticalCoordinateString,i=this.internal.getHorizontalCoordinate,a=this.internal.getVerticalCoordinate,d=this.internal.Point,o=this.internal.Rectangle,c=this.internal.Matrix,h=new p}]);var b=function(A){Object.defineProperty(this,"canvas",{get:function(){return{parentNode:!1,style:!1}}});var H=A;Object.defineProperty(this,"pdf",{get:function(){return H}});var Z=!1;Object.defineProperty(this,"pageWrapXEnabled",{get:function(){return Z},set:function(P){Z=!!P}});var X=!1;Object.defineProperty(this,"pageWrapYEnabled",{get:function(){return X},set:function(P){X=!!P}});var pe=0;Object.defineProperty(this,"posX",{get:function(){return pe},set:function(P){isNaN(P)||(pe=P)}});var ve=0;Object.defineProperty(this,"posY",{get:function(){return ve},set:function(P){isNaN(P)||(ve=P)}}),Object.defineProperty(this,"margin",{get:function(){return h.margin},set:function(P){var G;typeof P=="number"?G=[P,P,P,P]:((G=new Array(4))[0]=P[0],G[1]=P.length>=2?P[1]:G[0],G[2]=P.length>=3?P[2]:G[0],G[3]=P.length>=4?P[3]:G[1]),h.margin=G}});var ke=!1;Object.defineProperty(this,"autoPaging",{get:function(){return ke},set:function(P){ke=P}});var Ae=0;Object.defineProperty(this,"lastBreak",{get:function(){return Ae},set:function(P){Ae=P}});var De=[];Object.defineProperty(this,"pageBreaks",{get:function(){return De},set:function(P){De=P}}),Object.defineProperty(this,"ctx",{get:function(){return h},set:function(P){P instanceof p&&(h=P)}}),Object.defineProperty(this,"path",{get:function(){return h.path},set:function(P){h.path=P}});var Me=[];Object.defineProperty(this,"ctxStack",{get:function(){return Me},set:function(P){Me=P}}),Object.defineProperty(this,"fillStyle",{get:function(){return this.ctx.fillStyle},set:function(P){var G;G=m(P),this.ctx.fillStyle=G.style,this.ctx.isFillTransparent=G.a===0,this.ctx.fillOpacity=G.a,this.pdf.setFillColor(G.r,G.g,G.b,{a:G.a}),this.pdf.setTextColor(G.r,G.g,G.b,{a:G.a})}}),Object.defineProperty(this,"strokeStyle",{get:function(){return this.ctx.strokeStyle},set:function(P){var G=m(P);this.ctx.strokeStyle=G.style,this.ctx.isStrokeTransparent=G.a===0,this.ctx.strokeOpacity=G.a,G.a===0?this.pdf.setDrawColor(255,255,255):(G.a,this.pdf.setDrawColor(G.r,G.g,G.b))}}),Object.defineProperty(this,"lineCap",{get:function(){return this.ctx.lineCap},set:function(P){["butt","round","square"].indexOf(P)!==-1&&(this.ctx.lineCap=P,this.pdf.setLineCap(P))}}),Object.defineProperty(this,"lineWidth",{get:function(){return this.ctx.lineWidth},set:function(P){isNaN(P)||(this.ctx.lineWidth=P,this.pdf.setLineWidth(P))}}),Object.defineProperty(this,"lineJoin",{get:function(){return this.ctx.lineJoin},set:function(P){["bevel","round","miter"].indexOf(P)!==-1&&(this.ctx.lineJoin=P,this.pdf.setLineJoin(P))}}),Object.defineProperty(this,"miterLimit",{get:function(){return this.ctx.miterLimit},set:function(P){isNaN(P)||(this.ctx.miterLimit=P,this.pdf.setMiterLimit(P))}}),Object.defineProperty(this,"textBaseline",{get:function(){return this.ctx.textBaseline},set:function(P){this.ctx.textBaseline=P}}),Object.defineProperty(this,"textAlign",{get:function(){return this.ctx.textAlign},set:function(P){["right","end","center","left","start"].indexOf(P)!==-1&&(this.ctx.textAlign=P)}});var Ke=null,Se=null,j=null;Object.defineProperty(this,"fontFaces",{get:function(){return j},set:function(P){Ke=null,Se=null,j=P}}),Object.defineProperty(this,"font",{get:function(){return this.ctx.font},set:function(P){var G;if(this.ctx.font=P,(G=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-_,\"\'\sa-z0-9]+?)\s*$/i.exec(P))!==null){var $=G[1];G[2];var z=G[3],B=G[4];G[5];var he=G[6],me=/^([.\d]+)((?:%|in|[cem]m|ex|p[ctx]))$/i.exec(B)[2];B=Math.floor(me==="px"?parseFloat(B)*this.pdf.internal.scaleFactor:me==="em"?parseFloat(B)*this.pdf.getFontSize():parseFloat(B)*this.pdf.internal.scaleFactor),this.pdf.setFontSize(B);var de=(function(ut){var Yt,gt,Et=[],qt=ut.trim();if(qt==="")return cc;if(qt in Uu)return[Uu[qt]];for(;qt!=="";){switch(gt=null,Yt=(qt=qu(qt)).charAt(0)){case'"':case"'":gt=o2(qt.substring(1),Yt);break;default:gt=l2(qt)}if(gt===null||(Et.push(gt[0]),(qt=qu(gt[1]))!==""&&qt.charAt(0)!==","))return cc;qt=qt.replace(/^,/,"")}return Et})(he);if(this.fontFaces){var Le=(function(ut,Yt){var gt=ut.getFontList(),Et=JSON.stringify(gt);if(Ke===null||Se!==Et){var qt=(function(Pt){var vt=[];return Object.keys(Pt).forEach(function(Zt){Pt[Zt].forEach(function(_t){var Ot=null;switch(_t){case"bold":Ot={family:Zt,weight:"bold"};break;case"italic":Ot={family:Zt,style:"italic"};break;case"bolditalic":Ot={family:Zt,weight:"bold",style:"italic"};break;case"":case"normal":Ot={family:Zt}}Ot!==null&&(Ot.ref={name:Zt,style:_t},vt.push(Ot))})}),vt})(gt);Ke=(function(Pt){for(var vt={},Zt=0;Zt<Pt.length;++Zt){var _t=lc(Pt[Zt]),Ot=_t.family,ir=_t.stretch,Rt=_t.style,yt=_t.weight;vt[Ot]=vt[Ot]||{},vt[Ot][ir]=vt[Ot][ir]||{},vt[Ot][ir][Rt]=vt[Ot][ir][Rt]||{},vt[Ot][ir][Rt][yt]=_t}return vt})(qt.concat(Yt)),Se=Et}return Ke})(this.pdf,this.fontFaces),Ie=de.map(function(ut){return{family:ut,stretch:"normal",weight:z,style:$}}),Te=(function(ut,Yt,gt){for(var Et=(gt=gt||{}).defaultFontFamily||"times",qt=Object.assign({},i2,gt.genericFontFamilies||{}),Pt=null,vt=null,Zt=0;Zt<Yt.length;++Zt)if(qt[(Pt=lc(Yt[Zt])).family]&&(Pt.family=qt[Pt.family]),ut.hasOwnProperty(Pt.family)){vt=ut[Pt.family];break}if(!(vt=vt||ut[Et]))throw new Error("Could not find a font-family for the rule '"+zu(Pt)+"' and default family '"+Et+"'.");if(vt=(function(_t,Ot){if(Ot[_t])return Ot[_t];var ir=Lc[_t],Rt=ir<=Lc.normal?-1:1,yt=Mu(Ot,Yf,ir,Rt);if(!yt)throw new Error("Could not find a matching font-stretch value for "+_t);return yt})(Pt.stretch,vt),vt=(function(_t,Ot){if(Ot[_t])return Ot[_t];for(var ir=Gf[_t],Rt=0;Rt<ir.length;++Rt)if(Ot[ir[Rt]])return Ot[ir[Rt]];throw new Error("Could not find a matching font-style for "+_t)})(Pt.style,vt),!(vt=(function(_t,Ot){if(Ot[_t])return Ot[_t];if(_t===400&&Ot[500])return Ot[500];if(_t===500&&Ot[400])return Ot[400];var ir=a2[_t],Rt=Mu(Ot,Jf,ir,_t<400?-1:1);if(!Rt)throw new Error("Could not find a matching font-weight for value "+_t);return Rt})(Pt.weight,vt)))throw new Error("Failed to resolve a font for the rule '"+zu(Pt)+"'.");return vt})(Le,Ie);this.pdf.setFont(Te.ref.name,Te.ref.style)}else{var Ye="";(z==="bold"||parseInt(z,10)>=700||$==="bold")&&(Ye="bold"),$==="italic"&&(Ye+="italic"),Ye.length===0&&(Ye="normal");for(var ft="",at={arial:"Helvetica",Arial:"Helvetica",verdana:"Helvetica",Verdana:"Helvetica",helvetica:"Helvetica",Helvetica:"Helvetica","sans-serif":"Helvetica",fixed:"Courier",monospace:"Courier",terminal:"Courier",cursive:"Times",fantasy:"Times",serif:"Times"},lt=0;lt<de.length;lt++){if(this.pdf.internal.getFont(de[lt],Ye,{noFallback:!0,disableWarning:!0})!==void 0){ft=de[lt];break}if(Ye==="bolditalic"&&this.pdf.internal.getFont(de[lt],"bold",{noFallback:!0,disableWarning:!0})!==void 0)ft=de[lt],Ye="bold";else if(this.pdf.internal.getFont(de[lt],"normal",{noFallback:!0,disableWarning:!0})!==void 0){ft=de[lt],Ye="normal";break}}if(ft===""){for(var bt=0;bt<de.length;bt++)if(at[de[bt]]){ft=at[de[bt]];break}}ft=ft===""?"Times":ft,this.pdf.setFont(ft,Ye)}}}}),Object.defineProperty(this,"globalCompositeOperation",{get:function(){return this.ctx.globalCompositeOperation},set:function(P){this.ctx.globalCompositeOperation=P}}),Object.defineProperty(this,"globalAlpha",{get:function(){return this.ctx.globalAlpha},set:function(P){this.ctx.globalAlpha=P}}),Object.defineProperty(this,"lineDashOffset",{get:function(){return this.ctx.lineDashOffset},set:function(P){this.ctx.lineDashOffset=P,ne.call(this)}}),Object.defineProperty(this,"lineDash",{get:function(){return this.ctx.lineDash},set:function(P){this.ctx.lineDash=P,ne.call(this)}}),Object.defineProperty(this,"ignoreClearRect",{get:function(){return this.ctx.ignoreClearRect},set:function(P){this.ctx.ignoreClearRect=!!P}})};b.prototype.setLineDash=function(A){this.lineDash=A},b.prototype.getLineDash=function(){return this.lineDash.length%2?this.lineDash.concat(this.lineDash):this.lineDash.slice()},b.prototype.fill=function(){E.call(this,"fill",!1)},b.prototype.stroke=function(){E.call(this,"stroke",!1)},b.prototype.beginPath=function(){this.path=[{type:"begin"}]},b.prototype.moveTo=function(A,H){if(isNaN(A)||isNaN(H))throw Ir.error("jsPDF.context2d.moveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.moveTo");var Z=this.ctx.transform.applyToPoint(new d(A,H));this.path.push({type:"mt",x:Z.x,y:Z.y}),this.ctx.lastPoint=new d(A,H)},b.prototype.closePath=function(){var A=new d(0,0),H=0;for(H=this.path.length-1;H!==-1;H--)if(this.path[H].type==="begin"&&Cr(this.path[H+1])==="object"&&typeof this.path[H+1].x=="number"){A=new d(this.path[H+1].x,this.path[H+1].y);break}this.path.push({type:"close"}),this.ctx.lastPoint=new d(A.x,A.y)},b.prototype.lineTo=function(A,H){if(isNaN(A)||isNaN(H))throw Ir.error("jsPDF.context2d.lineTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.lineTo");var Z=this.ctx.transform.applyToPoint(new d(A,H));this.path.push({type:"lt",x:Z.x,y:Z.y}),this.ctx.lastPoint=new d(Z.x,Z.y)},b.prototype.clip=function(){this.ctx.clip_path=JSON.parse(JSON.stringify(this.path)),E.call(this,null,!0)},b.prototype.quadraticCurveTo=function(A,H,Z,X){if(isNaN(Z)||isNaN(X)||isNaN(A)||isNaN(H))throw Ir.error("jsPDF.context2d.quadraticCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.quadraticCurveTo");var pe=this.ctx.transform.applyToPoint(new d(Z,X)),ve=this.ctx.transform.applyToPoint(new d(A,H));this.path.push({type:"qct",x1:ve.x,y1:ve.y,x:pe.x,y:pe.y}),this.ctx.lastPoint=new d(pe.x,pe.y)},b.prototype.bezierCurveTo=function(A,H,Z,X,pe,ve){if(isNaN(pe)||isNaN(ve)||isNaN(A)||isNaN(H)||isNaN(Z)||isNaN(X))throw Ir.error("jsPDF.context2d.bezierCurveTo: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.bezierCurveTo");var ke=this.ctx.transform.applyToPoint(new d(pe,ve)),Ae=this.ctx.transform.applyToPoint(new d(A,H)),De=this.ctx.transform.applyToPoint(new d(Z,X));this.path.push({type:"bct",x1:Ae.x,y1:Ae.y,x2:De.x,y2:De.y,x:ke.x,y:ke.y}),this.ctx.lastPoint=new d(ke.x,ke.y)},b.prototype.arc=function(A,H,Z,X,pe,ve){if(isNaN(A)||isNaN(H)||isNaN(Z)||isNaN(X)||isNaN(pe))throw Ir.error("jsPDF.context2d.arc: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.arc");if(ve=!!ve,!this.ctx.transform.isIdentity){var ke=this.ctx.transform.applyToPoint(new d(A,H));A=ke.x,H=ke.y;var Ae=this.ctx.transform.applyToPoint(new d(0,Z)),De=this.ctx.transform.applyToPoint(new d(0,0));Z=Math.sqrt(Math.pow(Ae.x-De.x,2)+Math.pow(Ae.y-De.y,2))}Math.abs(pe-X)>=2*Math.PI&&(X=0,pe=2*Math.PI),this.path.push({type:"arc",x:A,y:H,radius:Z,startAngle:X,endAngle:pe,counterclockwise:ve})},b.prototype.arcTo=function(A,H,Z,X,pe){throw new Error("arcTo not implemented.")},b.prototype.rect=function(A,H,Z,X){if(isNaN(A)||isNaN(H)||isNaN(Z)||isNaN(X))throw Ir.error("jsPDF.context2d.rect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rect");this.moveTo(A,H),this.lineTo(A+Z,H),this.lineTo(A+Z,H+X),this.lineTo(A,H+X),this.lineTo(A,H),this.lineTo(A+Z,H),this.lineTo(A,H)},b.prototype.fillRect=function(A,H,Z,X){if(isNaN(A)||isNaN(H)||isNaN(Z)||isNaN(X))throw Ir.error("jsPDF.context2d.fillRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillRect");if(!u.call(this)){var pe={};this.lineCap!=="butt"&&(pe.lineCap=this.lineCap,this.lineCap="butt"),this.lineJoin!=="miter"&&(pe.lineJoin=this.lineJoin,this.lineJoin="miter"),this.beginPath(),this.rect(A,H,Z,X),this.fill(),pe.hasOwnProperty("lineCap")&&(this.lineCap=pe.lineCap),pe.hasOwnProperty("lineJoin")&&(this.lineJoin=pe.lineJoin)}},b.prototype.strokeRect=function(A,H,Z,X){if(isNaN(A)||isNaN(H)||isNaN(Z)||isNaN(X))throw Ir.error("jsPDF.context2d.strokeRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeRect");w.call(this)||(this.beginPath(),this.rect(A,H,Z,X),this.stroke())},b.prototype.clearRect=function(A,H,Z,X){if(isNaN(A)||isNaN(H)||isNaN(Z)||isNaN(X))throw Ir.error("jsPDF.context2d.clearRect: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.clearRect");this.ignoreClearRect||(this.fillStyle="#ffffff",this.fillRect(A,H,Z,X))},b.prototype.save=function(A){A=typeof A!="boolean"||A;for(var H=this.pdf.internal.getCurrentPageInfo().pageNumber,Z=0;Z<this.pdf.internal.getNumberOfPages();Z++)this.pdf.setPage(Z+1),this.pdf.internal.out("q");if(this.pdf.setPage(H),A){this.ctx.fontSize=this.pdf.internal.getFontSize();var X=new p(this.ctx);this.ctxStack.push(this.ctx),this.ctx=X}},b.prototype.restore=function(A){A=typeof A!="boolean"||A;for(var H=this.pdf.internal.getCurrentPageInfo().pageNumber,Z=0;Z<this.pdf.internal.getNumberOfPages();Z++)this.pdf.setPage(Z+1),this.pdf.internal.out("Q");this.pdf.setPage(H),A&&this.ctxStack.length!==0&&(this.ctx=this.ctxStack.pop(),this.fillStyle=this.ctx.fillStyle,this.strokeStyle=this.ctx.strokeStyle,this.font=this.ctx.font,this.lineCap=this.ctx.lineCap,this.lineWidth=this.ctx.lineWidth,this.lineJoin=this.ctx.lineJoin,this.lineDash=this.ctx.lineDash,this.lineDashOffset=this.ctx.lineDashOffset)},b.prototype.toDataURL=function(){throw new Error("toDataUrl not implemented.")};var m=function(A){var H,Z,X,pe;if(A.isCanvasGradient===!0&&(A=A.getColor()),!A)return{r:0,g:0,b:0,a:0,style:A};if(/transparent|rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*0+\s*\)/.test(A))H=0,Z=0,X=0,pe=0;else{var ve=/rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(A);if(ve!==null)H=parseInt(ve[1]),Z=parseInt(ve[2]),X=parseInt(ve[3]),pe=1;else if((ve=/rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\s*\)/.exec(A))!==null)H=parseInt(ve[1]),Z=parseInt(ve[2]),X=parseInt(ve[3]),pe=parseFloat(ve[4]);else{if(pe=1,typeof A=="string"&&A.charAt(0)!=="#"){var ke=new Uf(A);A=ke.ok?ke.toHex():"#000000"}A.length===4?(H=A.substring(1,2),H+=H,Z=A.substring(2,3),Z+=Z,X=A.substring(3,4),X+=X):(H=A.substring(1,3),Z=A.substring(3,5),X=A.substring(5,7)),H=parseInt(H,16),Z=parseInt(Z,16),X=parseInt(X,16)}}return{r:H,g:Z,b:X,a:pe,style:A}},u=function(){return this.ctx.isFillTransparent||this.globalAlpha==0},w=function(){return!!(this.ctx.isStrokeTransparent||this.globalAlpha==0)};b.prototype.fillText=function(A,H,Z,X){if(isNaN(H)||isNaN(Z)||typeof A!="string")throw Ir.error("jsPDF.context2d.fillText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.fillText");if(X=isNaN(X)?void 0:X,!u.call(this)){var pe=se(this.ctx.transform.rotation),ve=this.ctx.transform.scaleX;k.call(this,{text:A,x:H,y:Z,scale:ve,angle:pe,align:this.textAlign,maxWidth:X})}},b.prototype.strokeText=function(A,H,Z,X){if(isNaN(H)||isNaN(Z)||typeof A!="string")throw Ir.error("jsPDF.context2d.strokeText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.strokeText");if(!w.call(this)){X=isNaN(X)?void 0:X;var pe=se(this.ctx.transform.rotation),ve=this.ctx.transform.scaleX;k.call(this,{text:A,x:H,y:Z,scale:ve,renderingMode:"stroke",angle:pe,align:this.textAlign,maxWidth:X})}},b.prototype.measureText=function(A){if(typeof A!="string")throw Ir.error("jsPDF.context2d.measureText: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.measureText");var H=this.pdf,Z=this.pdf.internal.scaleFactor,X=H.internal.getFontSize(),pe=H.getStringUnitWidth(A)*X/H.internal.scaleFactor;return new function(ve){var ke=(ve=ve||{}).width||0;return Object.defineProperty(this,"width",{get:function(){return ke}}),this}({width:pe*=Math.round(96*Z/72*1e4)/1e4})},b.prototype.scale=function(A,H){if(isNaN(A)||isNaN(H))throw Ir.error("jsPDF.context2d.scale: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.scale");var Z=new c(A,0,0,H,0,0);this.ctx.transform=this.ctx.transform.multiply(Z)},b.prototype.rotate=function(A){if(isNaN(A))throw Ir.error("jsPDF.context2d.rotate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.rotate");var H=new c(Math.cos(A),Math.sin(A),-Math.sin(A),Math.cos(A),0,0);this.ctx.transform=this.ctx.transform.multiply(H)},b.prototype.translate=function(A,H){if(isNaN(A)||isNaN(H))throw Ir.error("jsPDF.context2d.translate: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.translate");var Z=new c(1,0,0,1,A,H);this.ctx.transform=this.ctx.transform.multiply(Z)},b.prototype.transform=function(A,H,Z,X,pe,ve){if(isNaN(A)||isNaN(H)||isNaN(Z)||isNaN(X)||isNaN(pe)||isNaN(ve))throw Ir.error("jsPDF.context2d.transform: Invalid arguments",arguments),new Error("Invalid arguments passed to jsPDF.context2d.transform");var ke=new c(A,H,Z,X,pe,ve);this.ctx.transform=this.ctx.transform.multiply(ke)},b.prototype.setTransform=function(A,H,Z,X,pe,ve){A=isNaN(A)?1:A,H=isNaN(H)?0:H,Z=isNaN(Z)?0:Z,X=isNaN(X)?1:X,pe=isNaN(pe)?0:pe,ve=isNaN(ve)?0:ve,this.ctx.transform=new c(A,H,Z,X,pe,ve)};var g=function(){return this.margin[0]>0||this.margin[1]>0||this.margin[2]>0||this.margin[3]>0};b.prototype.drawImage=function(A,H,Z,X,pe,ve,ke,Ae,De){var Me=this.pdf.getImageProperties(A),Ke=1,Se=1,j=1,P=1;X!==void 0&&Ae!==void 0&&(j=Ae/X,P=De/pe,Ke=Me.width/X*Ae/X,Se=Me.height/pe*De/pe),ve===void 0&&(ve=H,ke=Z,H=0,Z=0),X!==void 0&&Ae===void 0&&(Ae=X,De=pe),X===void 0&&Ae===void 0&&(Ae=Me.width,De=Me.height);var G=this.ctx.transform.decompose(),$=se(G.rotate.shx),z=new c,B=(z=(z=(z=z.multiply(G.translate)).multiply(G.skew)).multiply(G.scale)).applyToRectangle(new o(ve-H*j,ke-Z*P,X*Ke,pe*Se));if(this.autoPaging){for(var he,me=N.call(this,B),de=[],Le=0;Le<me.length;Le+=1)de.indexOf(me[Le])===-1&&de.push(me[Le]);L(de);for(var Ie=de[0],Te=de[de.length-1],Ye=Ie;Ye<Te+1;Ye++){this.pdf.setPage(Ye);var ft=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],at=Ye===1?this.posY+this.margin[0]:this.margin[0],lt=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],bt=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],ut=Ye===1?0:lt+(Ye-2)*bt;if(this.ctx.clip_path.length!==0){var Yt=this.path;he=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=S(he,this.posX+this.margin[3],-ut+at+this.ctx.prevPageLastElemOffset),I.call(this,"fill",!0),this.path=Yt}var gt=JSON.parse(JSON.stringify(B));gt=S([gt],this.posX+this.margin[3],-ut+at+this.ctx.prevPageLastElemOffset)[0];var Et=(Ye>Ie||Ye<Te)&&g.call(this);Et&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],ft,bt,null).clip().discardPath()),this.pdf.addImage(A,"JPEG",gt.x,gt.y,gt.w,gt.h,null,null,$),Et&&this.pdf.restoreGraphicsState()}}else this.pdf.addImage(A,"JPEG",B.x,B.y,B.w,B.h,null,null,$)};var N=function(A,H,Z){var X=[];H=H||this.pdf.internal.pageSize.width,Z=Z||this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2];var pe=this.posY+this.ctx.prevPageLastElemOffset;switch(A.type){default:case"mt":case"lt":X.push(Math.floor((A.y+pe)/Z)+1);break;case"arc":X.push(Math.floor((A.y+pe-A.radius)/Z)+1),X.push(Math.floor((A.y+pe+A.radius)/Z)+1);break;case"qct":var ve=ie(this.ctx.lastPoint.x,this.ctx.lastPoint.y,A.x1,A.y1,A.x,A.y);X.push(Math.floor((ve.y+pe)/Z)+1),X.push(Math.floor((ve.y+ve.h+pe)/Z)+1);break;case"bct":var ke=je(this.ctx.lastPoint.x,this.ctx.lastPoint.y,A.x1,A.y1,A.x2,A.y2,A.x,A.y);X.push(Math.floor((ke.y+pe)/Z)+1),X.push(Math.floor((ke.y+ke.h+pe)/Z)+1);break;case"rect":X.push(Math.floor((A.y+pe)/Z)+1),X.push(Math.floor((A.y+A.h+pe)/Z)+1)}for(var Ae=0;Ae<X.length;Ae+=1)for(;this.pdf.internal.getNumberOfPages()<X[Ae];)y.call(this);return X},y=function(){var A=this.fillStyle,H=this.strokeStyle,Z=this.font,X=this.lineCap,pe=this.lineWidth,ve=this.lineJoin;this.pdf.addPage(),this.fillStyle=A,this.strokeStyle=H,this.font=Z,this.lineCap=X,this.lineWidth=pe,this.lineJoin=ve},S=function(A,H,Z){for(var X=0;X<A.length;X++)switch(A[X].type){case"bct":A[X].x2+=H,A[X].y2+=Z;case"qct":A[X].x1+=H,A[X].y1+=Z;default:A[X].x+=H,A[X].y+=Z}return A},L=function(A){return A.sort(function(H,Z){return H-Z})},E=function(A,H){var Z=this.fillStyle,X=this.strokeStyle,pe=this.lineCap,ve=this.lineWidth,ke=Math.abs(ve*this.ctx.transform.scaleX),Ae=this.lineJoin;if(this.autoPaging){for(var De,Me,Ke=JSON.parse(JSON.stringify(this.path)),Se=JSON.parse(JSON.stringify(this.path)),j=[],P=0;P<Se.length;P++)if(Se[P].x!==void 0)for(var G=N.call(this,Se[P]),$=0;$<G.length;$+=1)j.indexOf(G[$])===-1&&j.push(G[$]);for(var z=0;z<j.length;z++)for(;this.pdf.internal.getNumberOfPages()<j[z];)y.call(this);L(j);for(var B=j[0],he=j[j.length-1],me=B;me<he+1;me++){this.pdf.setPage(me),this.fillStyle=Z,this.strokeStyle=X,this.lineCap=pe,this.lineWidth=ke,this.lineJoin=Ae;var de=this.pdf.internal.pageSize.width-this.margin[3]-this.margin[1],Le=me===1?this.posY+this.margin[0]:this.margin[0],Ie=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Te=this.pdf.internal.pageSize.height-this.margin[0]-this.margin[2],Ye=me===1?0:Ie+(me-2)*Te;if(this.ctx.clip_path.length!==0){var ft=this.path;De=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=S(De,this.posX+this.margin[3],-Ye+Le+this.ctx.prevPageLastElemOffset),I.call(this,A,!0),this.path=ft}if(Me=JSON.parse(JSON.stringify(Ke)),this.path=S(Me,this.posX+this.margin[3],-Ye+Le+this.ctx.prevPageLastElemOffset),H===!1||me===0){var at=(me>B||me<he)&&g.call(this);at&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],de,Te,null).clip().discardPath()),I.call(this,A,H),at&&this.pdf.restoreGraphicsState()}this.lineWidth=ve}this.path=Ke}else this.lineWidth=ke,I.call(this,A,H),this.lineWidth=ve},I=function(A,H){if((A!=="stroke"||H||!w.call(this))&&(A==="stroke"||H||!u.call(this))){for(var Z,X,pe=[],ve=this.path,ke=0;ke<ve.length;ke++){var Ae=ve[ke];switch(Ae.type){case"begin":pe.push({begin:!0});break;case"close":pe.push({close:!0});break;case"mt":pe.push({start:Ae,deltas:[],abs:[]});break;case"lt":var De=pe.length;if(ve[ke-1]&&!isNaN(ve[ke-1].x)&&(Z=[Ae.x-ve[ke-1].x,Ae.y-ve[ke-1].y],De>0)){for(;De>=0;De--)if(pe[De-1].close!==!0&&pe[De-1].begin!==!0){pe[De-1].deltas.push(Z),pe[De-1].abs.push(Ae);break}}break;case"bct":Z=[Ae.x1-ve[ke-1].x,Ae.y1-ve[ke-1].y,Ae.x2-ve[ke-1].x,Ae.y2-ve[ke-1].y,Ae.x-ve[ke-1].x,Ae.y-ve[ke-1].y],pe[pe.length-1].deltas.push(Z);break;case"qct":var Me=ve[ke-1].x+2/3*(Ae.x1-ve[ke-1].x),Ke=ve[ke-1].y+2/3*(Ae.y1-ve[ke-1].y),Se=Ae.x+2/3*(Ae.x1-Ae.x),j=Ae.y+2/3*(Ae.y1-Ae.y),P=Ae.x,G=Ae.y;Z=[Me-ve[ke-1].x,Ke-ve[ke-1].y,Se-ve[ke-1].x,j-ve[ke-1].y,P-ve[ke-1].x,G-ve[ke-1].y],pe[pe.length-1].deltas.push(Z);break;case"arc":pe.push({deltas:[],abs:[],arc:!0}),Array.isArray(pe[pe.length-1].abs)&&pe[pe.length-1].abs.push(Ae)}}X=H?null:A==="stroke"?"stroke":"fill";for(var $=!1,z=0;z<pe.length;z++)if(pe[z].arc)for(var B=pe[z].abs,he=0;he<B.length;he++){var me=B[he];me.type==="arc"?V.call(this,me.x,me.y,me.radius,me.startAngle,me.endAngle,me.counterclockwise,void 0,H,!$):M.call(this,me.x,me.y),$=!0}else if(pe[z].close===!0)this.pdf.internal.out("h"),$=!1;else if(pe[z].begin!==!0){var de=pe[z].start.x,Le=pe[z].start.y;_.call(this,pe[z].deltas,de,Le),$=!0}X&&O.call(this,X),H&&Q.call(this)}},K=function(A){var H=this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor,Z=H*(this.pdf.internal.getLineHeightFactor()-1);switch(this.ctx.textBaseline){case"bottom":return A-Z;case"top":return A+H-Z;case"hanging":return A+H-2*Z;case"middle":return A+H/2-Z;default:return A}},Y=function(A){return A+this.pdf.internal.getFontSize()/this.pdf.internal.scaleFactor*(this.pdf.internal.getLineHeightFactor()-1)};b.prototype.createLinearGradient=function(){var A=function(){};return A.colorStops=[],A.addColorStop=function(H,Z){this.colorStops.push([H,Z])},A.getColor=function(){return this.colorStops.length===0?"#000000":this.colorStops[0][1]},A.isCanvasGradient=!0,A},b.prototype.createPattern=function(){return this.createLinearGradient()},b.prototype.createRadialGradient=function(){return this.createLinearGradient()};var V=function(A,H,Z,X,pe,ve,ke,Ae,De){for(var Me=ae.call(this,Z,X,pe,ve),Ke=0;Ke<Me.length;Ke++){var Se=Me[Ke];Ke===0&&(De?F.call(this,Se.x1+A,Se.y1+H):M.call(this,Se.x1+A,Se.y1+H)),te.call(this,A,H,Se.x2,Se.y2,Se.x3,Se.y3,Se.x4,Se.y4)}Ae?Q.call(this):O.call(this,ke)},O=function(A){switch(A){case"stroke":this.pdf.internal.out("S");break;case"fill":this.pdf.internal.out("f")}},Q=function(){this.pdf.clip(),this.pdf.discardPath()},F=function(A,H){this.pdf.internal.out(e(A)+" "+s(H)+" m")},k=function(A){var H;switch(A.align){case"right":case"end":H="right";break;case"center":H="center";break;default:H="left"}var Z,X,pe,ve=this.pdf.getTextDimensions(A.text),ke=K.call(this,A.y),Ae=Y.call(this,ke)-ve.h,De=this.ctx.transform.applyToPoint(new d(A.x,ke));if(this.autoPaging){var Me=this.ctx.transform.decompose(),Ke=new c;Ke=(Ke=(Ke=Ke.multiply(Me.translate)).multiply(Me.skew)).multiply(Me.scale);for(var Se=this.ctx.transform.applyToRectangle(new o(A.x,ke,ve.w,ve.h)),j=Ke.applyToRectangle(new o(A.x,Ae,ve.w,ve.h)),P=N.call(this,j),G=[],$=0;$<P.length;$+=1)G.indexOf(P[$])===-1&&G.push(P[$]);L(G);for(var z=G[0],B=G[G.length-1],he=z;he<B+1;he++){this.pdf.setPage(he);var me=he===1?this.posY+this.margin[0]:this.margin[0],de=this.pdf.internal.pageSize.height-this.posY-this.margin[0]-this.margin[2],Le=this.pdf.internal.pageSize.height-this.margin[2],Ie=Le-this.margin[0],Te=this.pdf.internal.pageSize.width-this.margin[1],Ye=Te-this.margin[3],ft=he===1?0:de+(he-2)*Ie;if(this.ctx.clip_path.length!==0){var at=this.path;Z=JSON.parse(JSON.stringify(this.ctx.clip_path)),this.path=S(Z,this.posX+this.margin[3],-1*ft+me),I.call(this,"fill",!0),this.path=at}var lt=S([JSON.parse(JSON.stringify(j))],this.posX+this.margin[3],-ft+me+this.ctx.prevPageLastElemOffset)[0];A.scale>=.01&&(X=this.pdf.internal.getFontSize(),this.pdf.setFontSize(X*A.scale),pe=this.lineWidth,this.lineWidth=pe*A.scale);var bt=this.autoPaging!=="text";if(bt||lt.y+lt.h<=Le){if(bt||lt.y>=me&&lt.x<=Te){var ut=bt?A.text:this.pdf.splitTextToSize(A.text,A.maxWidth||Te-lt.x)[0],Yt=S([JSON.parse(JSON.stringify(Se))],this.posX+this.margin[3],-ft+me+this.ctx.prevPageLastElemOffset)[0],gt=bt&&(he>z||he<B)&&g.call(this);gt&&(this.pdf.saveGraphicsState(),this.pdf.rect(this.margin[3],this.margin[0],Ye,Ie,null).clip().discardPath()),this.pdf.text(ut,Yt.x,Yt.y,{angle:A.angle,align:H,renderingMode:A.renderingMode}),gt&&this.pdf.restoreGraphicsState()}}else lt.y<Le&&(this.ctx.prevPageLastElemOffset+=Le-lt.y);A.scale>=.01&&(this.pdf.setFontSize(X),this.lineWidth=pe)}}else A.scale>=.01&&(X=this.pdf.internal.getFontSize(),this.pdf.setFontSize(X*A.scale),pe=this.lineWidth,this.lineWidth=pe*A.scale),this.pdf.text(A.text,De.x+this.posX,De.y+this.posY,{angle:A.angle,align:H,renderingMode:A.renderingMode,maxWidth:A.maxWidth}),A.scale>=.01&&(this.pdf.setFontSize(X),this.lineWidth=pe)},M=function(A,H,Z,X){Z=Z||0,X=X||0,this.pdf.internal.out(e(A+Z)+" "+s(H+X)+" l")},_=function(A,H,Z){return this.pdf.lines(A,H,Z,null,null)},te=function(A,H,Z,X,pe,ve,ke,Ae){this.pdf.internal.out([t(i(Z+A)),t(a(X+H)),t(i(pe+A)),t(a(ve+H)),t(i(ke+A)),t(a(Ae+H)),"c"].join(" "))},ae=function(A,H,Z,X){for(var pe=2*Math.PI,ve=Math.PI/2;H>Z;)H-=pe;var ke=Math.abs(Z-H);ke<pe&&X&&(ke=pe-ke);for(var Ae=[],De=X?-1:1,Me=H;ke>1e-5;){var Ke=Me+De*Math.min(ke,ve);Ae.push(re.call(this,A,Me,Ke)),ke-=Math.abs(Ke-Me),Me=Ke}return Ae},re=function(A,H,Z){var X=(Z-H)/2,pe=A*Math.cos(X),ve=A*Math.sin(X),ke=pe,Ae=-ve,De=ke*ke+Ae*Ae,Me=De+ke*pe+Ae*ve,Ke=4/3*(Math.sqrt(2*De*Me)-Me)/(ke*ve-Ae*pe),Se=ke-Ke*Ae,j=Ae+Ke*ke,P=Se,G=-j,$=X+H,z=Math.cos($),B=Math.sin($);return{x1:A*Math.cos(H),y1:A*Math.sin(H),x2:Se*z-j*B,y2:Se*B+j*z,x3:P*z-G*B,y3:P*B+G*z,x4:A*Math.cos(Z),y4:A*Math.sin(Z)}},se=function(A){return 180*A/Math.PI},ie=function(A,H,Z,X,pe,ve){var ke=A+.5*(Z-A),Ae=H+.5*(X-H),De=pe+.5*(Z-pe),Me=ve+.5*(X-ve),Ke=Math.min(A,pe,ke,De),Se=Math.max(A,pe,ke,De),j=Math.min(H,ve,Ae,Me),P=Math.max(H,ve,Ae,Me);return new o(Ke,j,Se-Ke,P-j)},je=function(A,H,Z,X,pe,ve,ke,Ae){var De,Me,Ke,Se,j,P,G,$,z,B,he,me,de,Le,Ie=Z-A,Te=X-H,Ye=pe-Z,ft=ve-X,at=ke-pe,lt=Ae-ve;for(Me=0;Me<41;Me++)z=(G=(Ke=A+(De=Me/40)*Ie)+De*((j=Z+De*Ye)-Ke))+De*(j+De*(pe+De*at-j)-G),B=($=(Se=H+De*Te)+De*((P=X+De*ft)-Se))+De*(P+De*(ve+De*lt-P)-$),Me==0?(he=z,me=B,de=z,Le=B):(he=Math.min(he,z),me=Math.min(me,B),de=Math.max(de,z),Le=Math.max(Le,B));return new o(Math.round(he),Math.round(me),Math.round(de-he),Math.round(Le-me))},ne=function(){if(this.prevLineDash||this.ctx.lineDash.length||this.ctx.lineDashOffset){var A,H,Z=(A=this.ctx.lineDash,H=this.ctx.lineDashOffset,JSON.stringify({lineDash:A,lineDashOffset:H}));this.prevLineDash!==Z&&(this.pdf.setLineDash(this.ctx.lineDash,this.ctx.lineDashOffset),this.prevLineDash=Z)}}})(Ut.API),(function(r){var t=function(d){var o,c,h,p,b,m,u,w,g,N;for(c=[],h=0,p=(d+=o="\0\0\0\0".slice(d.length%4||4)).length;p>h;h+=4)(b=(d.charCodeAt(h)<<24)+(d.charCodeAt(h+1)<<16)+(d.charCodeAt(h+2)<<8)+d.charCodeAt(h+3))!==0?(m=(b=((b=((b=((b=(b-(N=b%85))/85)-(g=b%85))/85)-(w=b%85))/85)-(u=b%85))/85)%85,c.push(m+33,u+33,w+33,g+33,N+33)):c.push(122);return(function(y,S){for(var L=S;L>0;L--)y.pop()})(c,o.length),String.fromCharCode.apply(String,c)+"~>"},e=function(d){var o,c,h,p,b,m=String,u="length",w=255,g="charCodeAt",N="slice",y="replace";for(d[N](-2),d=d[N](0,-2)[y](/\s/g,"")[y]("z","!!!!!"),h=[],p=0,b=(d+=o="uuuuu"[N](d[u]%5||5))[u];b>p;p+=5)c=52200625*(d[g](p)-33)+614125*(d[g](p+1)-33)+7225*(d[g](p+2)-33)+85*(d[g](p+3)-33)+(d[g](p+4)-33),h.push(w&c>>24,w&c>>16,w&c>>8,w&c);return(function(S,L){for(var E=L;E>0;E--)S.pop()})(h,o[u]),m.fromCharCode.apply(m,h)},s=function(d){return d.split("").map(function(o){return("0"+o.charCodeAt().toString(16)).slice(-2)}).join("")+">"},i=function(d){var o=new RegExp(/^([0-9A-Fa-f]{2})+$/);if((d=d.replace(/\s/g,"")).indexOf(">")!==-1&&(d=d.substr(0,d.indexOf(">"))),d.length%2&&(d+="0"),o.test(d)===!1)return"";for(var c="",h=0;h<d.length;h+=2)c+=String.fromCharCode("0x"+(d[h]+d[h+1]));return c},a=function(d){for(var o=new Uint8Array(d.length),c=d.length;c--;)o[c]=d.charCodeAt(c);return(o=Nc(o)).reduce(function(h,p){return h+String.fromCharCode(p)},"")};r.processDataByFilters=function(d,o){var c=0,h=d||"",p=[];for(typeof(o=o||[])=="string"&&(o=[o]),c=0;c<o.length;c+=1)switch(o[c]){case"ASCII85Decode":case"/ASCII85Decode":h=e(h),p.push("/ASCII85Encode");break;case"ASCII85Encode":case"/ASCII85Encode":h=t(h),p.push("/ASCII85Decode");break;case"ASCIIHexDecode":case"/ASCIIHexDecode":h=i(h),p.push("/ASCIIHexEncode");break;case"ASCIIHexEncode":case"/ASCIIHexEncode":h=s(h),p.push("/ASCIIHexDecode");break;case"FlateEncode":case"/FlateEncode":h=a(h),p.push("/FlateDecode");break;default:throw new Error('The filter: "'+o[c]+'" is not implemented')}return{data:h,reverseChain:p.reverse().join(" ")}}})(Ut.API),(function(r){r.loadFile=function(t,e,s){return(function(i,a,d){a=a!==!1,d=typeof d=="function"?d:function(){};var o=void 0;try{o=(function(c,h,p){var b=new XMLHttpRequest,m=0,u=function(w){var g=w.length,N=[],y=String.fromCharCode;for(m=0;m<g;m+=1)N.push(y(255&w.charCodeAt(m)));return N.join("")};if(b.open("GET",c,!h),b.overrideMimeType("text/plain; charset=x-user-defined"),h===!1&&(b.onload=function(){b.status===200?p(u(this.responseText)):p(void 0)}),b.send(null),h&&b.status===200)return u(b.responseText)})(i,a,d)}catch{}return o})(t,e,s)},r.allowFsRead=void 0,r.loadImageFile=r.loadFile})(Ut.API),(function(r){function t(){return(Gt.html2canvas?Promise.resolve(Gt.html2canvas):Wl(()=>import("./html2canvas.esm-QH1iLAAe.js"),[])).catch(function(o){return Promise.reject(new Error("Could not load html2canvas: "+o))}).then(function(o){return o.default?o.default:o})}function e(){return(Gt.DOMPurify?Promise.resolve(Gt.DOMPurify):Wl(()=>import("./purify.es-B9ZVCkUG.js"),[])).catch(function(o){return Promise.reject(new Error("Could not load dompurify: "+o))}).then(function(o){return o.default?o.default:o})}var s=function(o){var c=Cr(o);return c==="undefined"?"undefined":c==="string"||o instanceof String?"string":c==="number"||o instanceof Number?"number":c==="function"||o instanceof Function?"function":o&&o.constructor===Array?"array":o&&o.nodeType===1?"element":c==="object"?"object":"unknown"},i=function(o,c){var h=document.createElement(o);for(var p in c.className&&(h.className=c.className),c.innerHTML&&c.dompurify&&(h.innerHTML=c.dompurify.sanitize(c.innerHTML)),c.style)h.style[p]=c.style[p];return h},a=function o(c,h){for(var p=c.nodeType===3?document.createTextNode(c.nodeValue):c.cloneNode(!1),b=c.firstChild;b;b=b.nextSibling)h!==!0&&b.nodeType===1&&b.nodeName==="SCRIPT"||p.appendChild(o(b,h));return c.nodeType===1&&(c.nodeName==="CANVAS"?(p.width=c.width,p.height=c.height,p.getContext("2d").drawImage(c,0,0)):c.nodeName!=="TEXTAREA"&&c.nodeName!=="SELECT"||(p.value=c.value),p.addEventListener("load",function(){p.scrollTop=c.scrollTop,p.scrollLeft=c.scrollLeft},!0)),p},d=function o(c){var h=Object.assign(o.convert(Promise.resolve()),JSON.parse(JSON.stringify(o.template))),p=o.convert(Promise.resolve(),h);return(p=p.setProgress(1,o,1,[o])).set(c)};(d.prototype=Object.create(Promise.prototype)).constructor=d,d.convert=function(o,c){return o.__proto__=c||d.prototype,o},d.template={prop:{src:null,container:null,overlay:null,canvas:null,img:null,pdf:null,pageSize:null,callback:function(){}},progress:{val:0,state:null,n:0,stack:[]},opt:{filename:"file.pdf",margin:[0,0,0,0],enableLinks:!0,x:0,y:0,html2canvas:{},jsPDF:{},backgroundColor:"transparent"}},d.prototype.from=function(o,c){return this.then(function(){switch(c=c||(function(h){switch(s(h)){case"string":return"string";case"element":return h.nodeName.toLowerCase()==="canvas"?"canvas":"element";default:return"unknown"}})(o),c){case"string":return this.then(e).then(function(h){return this.set({src:i("div",{innerHTML:o,dompurify:h})})});case"element":return this.set({src:o});case"canvas":return this.set({canvas:o});case"img":return this.set({img:o});default:return this.error("Unknown source type.")}})},d.prototype.to=function(o){switch(o){case"container":return this.toContainer();case"canvas":return this.toCanvas();case"img":return this.toImg();case"pdf":return this.toPdf();default:return this.error("Invalid target.")}},d.prototype.toContainer=function(){return this.thenList([function(){return this.prop.src||this.error("Cannot duplicate - no source HTML.")},function(){return this.prop.pageSize||this.setPageSize()}]).then(function(){var o={position:"relative",display:"inline-block",width:(typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?Math.max(this.prop.src.clientWidth,this.prop.src.scrollWidth,this.prop.src.offsetWidth):this.opt.windowWidth)+"px",left:0,right:0,top:0,margin:"auto",backgroundColor:this.opt.backgroundColor},c=a(this.prop.src,this.opt.html2canvas.javascriptEnabled);c.tagName==="BODY"&&(o.height=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)+"px"),this.prop.overlay=i("div",{className:"html2pdf__overlay",style:{position:"fixed",overflow:"hidden",zIndex:1e3,left:"-100000px",right:0,bottom:0,top:0}}),this.prop.container=i("div",{className:"html2pdf__container",style:o}),this.prop.container.appendChild(c),this.prop.container.firstChild.appendChild(i("div",{style:{clear:"both",border:"0 none transparent",margin:0,padding:0,height:0}})),this.prop.container.style.float="none",this.prop.overlay.appendChild(this.prop.container),document.body.appendChild(this.prop.overlay),this.prop.container.firstChild.style.position="relative",this.prop.container.height=Math.max(this.prop.container.firstChild.clientHeight,this.prop.container.firstChild.scrollHeight,this.prop.container.firstChild.offsetHeight)+"px"})},d.prototype.toCanvas=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(t).then(function(c){var h=Object.assign({},this.opt.html2canvas);return delete h.onrendered,c(this.prop.container,h)}).then(function(c){(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},d.prototype.toContext2d=function(){var o=[function(){return document.body.contains(this.prop.container)||this.toContainer()}];return this.thenList(o).then(t).then(function(c){var h=this.opt.jsPDF,p=this.opt.fontFaces,b=typeof this.opt.width!="number"||isNaN(this.opt.width)||typeof this.opt.windowWidth!="number"||isNaN(this.opt.windowWidth)?1:this.opt.width/this.opt.windowWidth,m=Object.assign({async:!0,allowTaint:!0,scale:b,scrollX:this.opt.scrollX||0,scrollY:this.opt.scrollY||0,backgroundColor:"#ffffff",imageTimeout:15e3,logging:!0,proxy:null,removeContainer:!0,foreignObjectRendering:!1,useCORS:!1},this.opt.html2canvas);if(delete m.onrendered,h.context2d.autoPaging=this.opt.autoPaging===void 0||this.opt.autoPaging,h.context2d.posX=this.opt.x,h.context2d.posY=this.opt.y,h.context2d.margin=this.opt.margin,h.context2d.fontFaces=p,p)for(var u=0;u<p.length;++u){var w=p[u],g=w.src.find(function(N){return N.format==="truetype"});g&&h.addFont(g.url,w.ref.name,w.ref.style)}return m.windowHeight=m.windowHeight||0,m.windowHeight=m.windowHeight==0?Math.max(this.prop.container.clientHeight,this.prop.container.scrollHeight,this.prop.container.offsetHeight):m.windowHeight,h.context2d.save(!0),c(this.prop.container,m)}).then(function(c){this.opt.jsPDF.context2d.restore(!0),(this.opt.html2canvas.onrendered||function(){})(c),this.prop.canvas=c,document.body.removeChild(this.prop.overlay)})},d.prototype.toImg=function(){return this.thenList([function(){return this.prop.canvas||this.toCanvas()}]).then(function(){var o=this.prop.canvas.toDataURL("image/"+this.opt.image.type,this.opt.image.quality);this.prop.img=document.createElement("img"),this.prop.img.src=o})},d.prototype.toPdf=function(){return this.thenList([function(){return this.toContext2d()}]).then(function(){this.prop.pdf=this.prop.pdf||this.opt.jsPDF})},d.prototype.output=function(o,c,h){return(h=h||"pdf").toLowerCase()==="img"||h.toLowerCase()==="image"?this.outputImg(o,c):this.outputPdf(o,c)},d.prototype.outputPdf=function(o,c){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){return this.prop.pdf.output(o,c)})},d.prototype.outputImg=function(o){return this.thenList([function(){return this.prop.img||this.toImg()}]).then(function(){switch(o){case void 0:case"img":return this.prop.img;case"datauristring":case"dataurlstring":return this.prop.img.src;case"datauri":case"dataurl":return document.location.href=this.prop.img.src;default:throw'Image output type "'+o+'" is not supported.'}})},d.prototype.save=function(o){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).set(o?{filename:o}:null).then(function(){this.prop.pdf.save(this.opt.filename)})},d.prototype.doCallback=function(){return this.thenList([function(){return this.prop.pdf||this.toPdf()}]).then(function(){this.prop.callback(this.prop.pdf)})},d.prototype.set=function(o){if(s(o)!=="object")return this;var c=Object.keys(o||{}).map(function(h){if(h in d.template.prop)return function(){this.prop[h]=o[h]};switch(h){case"margin":return this.setMargin.bind(this,o.margin);case"jsPDF":return function(){return this.opt.jsPDF=o.jsPDF,this.setPageSize()};case"pageSize":return this.setPageSize.bind(this,o.pageSize);default:return function(){this.opt[h]=o[h]}}},this);return this.then(function(){return this.thenList(c)})},d.prototype.get=function(o,c){return this.then(function(){var h=o in d.template.prop?this.prop[o]:this.opt[o];return c?c(h):h})},d.prototype.setMargin=function(o){return this.then(function(){switch(s(o)){case"number":o=[o,o,o,o];case"array":if(o.length===2&&(o=[o[0],o[1],o[0],o[1]]),o.length===4)break;default:return this.error("Invalid margin array.")}this.opt.margin=o}).then(this.setPageSize)},d.prototype.setPageSize=function(o){function c(h,p){return Math.floor(h*p/72*96)}return this.then(function(){(o=o||Ut.getPageSize(this.opt.jsPDF)).hasOwnProperty("inner")||(o.inner={width:o.width-this.opt.margin[1]-this.opt.margin[3],height:o.height-this.opt.margin[0]-this.opt.margin[2]},o.inner.px={width:c(o.inner.width,o.k),height:c(o.inner.height,o.k)},o.inner.ratio=o.inner.height/o.inner.width),this.prop.pageSize=o})},d.prototype.setProgress=function(o,c,h,p){return o!=null&&(this.progress.val=o),c!=null&&(this.progress.state=c),h!=null&&(this.progress.n=h),p!=null&&(this.progress.stack=p),this.progress.ratio=this.progress.val/this.progress.state,this},d.prototype.updateProgress=function(o,c,h,p){return this.setProgress(o?this.progress.val+o:null,c||null,h?this.progress.n+h:null,p?this.progress.stack.concat(p):null)},d.prototype.then=function(o,c){var h=this;return this.thenCore(o,c,function(p,b){return h.updateProgress(null,null,1,[p]),Promise.prototype.then.call(this,function(m){return h.updateProgress(null,p),m}).then(p,b).then(function(m){return h.updateProgress(1),m})})},d.prototype.thenCore=function(o,c,h){h=h||Promise.prototype.then;var p=this;o&&(o=o.bind(p)),c&&(c=c.bind(p));var b=Promise.toString().indexOf("[native code]")!==-1&&Promise.name==="Promise"?p:d.convert(Object.assign({},p),Promise.prototype),m=h.call(b,o,c);return d.convert(m,p.__proto__)},d.prototype.thenExternal=function(o,c){return Promise.prototype.then.call(this,o,c)},d.prototype.thenList=function(o){var c=this;return o.forEach(function(h){c=c.thenCore(h)}),c},d.prototype.catch=function(o){o&&(o=o.bind(this));var c=Promise.prototype.catch.call(this,o);return d.convert(c,this)},d.prototype.catchExternal=function(o){return Promise.prototype.catch.call(this,o)},d.prototype.error=function(o){return this.then(function(){throw new Error(o)})},d.prototype.using=d.prototype.set,d.prototype.saveAs=d.prototype.save,d.prototype.export=d.prototype.output,d.prototype.run=d.prototype.then,Ut.getPageSize=function(o,c,h){if(Cr(o)==="object"){var p=o;o=p.orientation,c=p.unit||c,h=p.format||h}c=c||"mm",h=h||"a4",o=(""+(o||"P")).toLowerCase();var b,m=(""+h).toLowerCase(),u={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89],a5:[419.53,595.28],a6:[297.64,419.53],a7:[209.76,297.64],a8:[147.4,209.76],a9:[104.88,147.4],a10:[73.7,104.88],b0:[2834.65,4008.19],b1:[2004.09,2834.65],b2:[1417.32,2004.09],b3:[1000.63,1417.32],b4:[708.66,1000.63],b5:[498.9,708.66],b6:[354.33,498.9],b7:[249.45,354.33],b8:[175.75,249.45],b9:[124.72,175.75],b10:[87.87,124.72],c0:[2599.37,3676.54],c1:[1836.85,2599.37],c2:[1298.27,1836.85],c3:[918.43,1298.27],c4:[649.13,918.43],c5:[459.21,649.13],c6:[323.15,459.21],c7:[229.61,323.15],c8:[161.57,229.61],c9:[113.39,161.57],c10:[79.37,113.39],dl:[311.81,623.62],letter:[612,792],"government-letter":[576,756],legal:[612,1008],"junior-legal":[576,360],ledger:[1224,792],tabloid:[792,1224],"credit-card":[153,243]};switch(c){case"pt":b=1;break;case"mm":b=72/25.4;break;case"cm":b=72/2.54;break;case"in":b=72;break;case"px":b=.75;break;case"pc":case"em":b=12;break;case"ex":b=6;break;default:throw"Invalid unit: "+c}var w,g=0,N=0;if(u.hasOwnProperty(m))g=u[m][1]/b,N=u[m][0]/b;else try{g=h[1],N=h[0]}catch{throw new Error("Invalid format: "+h)}if(o==="p"||o==="portrait")o="p",N>g&&(w=N,N=g,g=w);else{if(o!=="l"&&o!=="landscape")throw"Invalid orientation: "+o;o="l",g>N&&(w=N,N=g,g=w)}return{width:N,height:g,unit:c,k:b,orientation:o}},r.html=function(o,c){(c=c||{}).callback=c.callback||function(){},c.html2canvas=c.html2canvas||{},c.html2canvas.canvas=c.html2canvas.canvas||this.canvas,c.jsPDF=c.jsPDF||this,c.fontFaces=c.fontFaces?c.fontFaces.map(lc):null;var h=new d(c);return c.worker?h:h.from(o).doCallback()}})(Ut.API),Ut.API.addJS=function(r){return Wu=r,this.internal.events.subscribe("postPutResources",function(){Yo=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/Names [(EmbeddedJS) "+(Yo+1)+" 0 R]"),this.internal.out(">>"),this.internal.out("endobj"),$u=this.internal.newObject(),this.internal.out("<<"),this.internal.out("/S /JavaScript"),this.internal.out("/JS ("+Wu+")"),this.internal.out(">>"),this.internal.out("endobj")}),this.internal.events.subscribe("putCatalog",function(){Yo!==void 0&&$u!==void 0&&this.internal.out("/Names <</JavaScript "+Yo+" 0 R>>")}),this},(function(r){var t;r.events.push(["postPutResources",function(){var e=this,s=/^(\d+) 0 obj$/;if(this.outline.root.children.length>0)for(var i=e.outline.render().split(/\r\n/),a=0;a<i.length;a++){var d=i[a],o=s.exec(d);if(o!=null){var c=o[1];e.internal.newObjectDeferredBegin(c,!1)}e.internal.write(d)}if(this.outline.createNamedDestinations){var h=this.internal.pages.length,p=[];for(a=0;a<h;a++){var b=e.internal.newObject();p.push(b);var m=e.internal.getPageInfo(a+1);e.internal.write("<< /D["+m.objId+" 0 R /XYZ null null null]>> endobj")}var u=e.internal.newObject();for(e.internal.write("<< /Names [ "),a=0;a<p.length;a++)e.internal.write("(page_"+(a+1)+")"+p[a]+" 0 R");e.internal.write(" ] >>","endobj"),t=e.internal.newObject(),e.internal.write("<< /Dests "+u+" 0 R"),e.internal.write(">>","endobj")}}]),r.events.push(["putCatalog",function(){var e=this;e.outline.root.children.length>0&&(e.internal.write("/Outlines",this.outline.makeRef(this.outline.root)),this.outline.createNamedDestinations&&e.internal.write("/Names "+t+" 0 R"))}]),r.events.push(["initialized",function(){var e=this;e.outline={createNamedDestinations:!1,root:{children:[]}},e.outline.add=function(s,i,a){var d={title:i,options:a,children:[]};return s==null&&(s=this.root),s.children.push(d),d},e.outline.render=function(){return this.ctx={},this.ctx.val="",this.ctx.pdf=e,this.genIds_r(this.root),this.renderRoot(this.root),this.renderItems(this.root),this.ctx.val},e.outline.genIds_r=function(s){s.id=e.internal.newObjectDeferred();for(var i=0;i<s.children.length;i++)this.genIds_r(s.children[i])},e.outline.renderRoot=function(s){this.objStart(s),this.line("/Type /Outlines"),s.children.length>0&&(this.line("/First "+this.makeRef(s.children[0])),this.line("/Last "+this.makeRef(s.children[s.children.length-1]))),this.line("/Count "+this.count_r({count:0},s)),this.objEnd()},e.outline.renderItems=function(s){for(var i=this.ctx.pdf.internal.getVerticalCoordinateString,a=0;a<s.children.length;a++){var d=s.children[a];this.objStart(d),this.line("/Title "+this.makeString(d.title)),this.line("/Parent "+this.makeRef(s)),a>0&&this.line("/Prev "+this.makeRef(s.children[a-1])),a<s.children.length-1&&this.line("/Next "+this.makeRef(s.children[a+1])),d.children.length>0&&(this.line("/First "+this.makeRef(d.children[0])),this.line("/Last "+this.makeRef(d.children[d.children.length-1])));var o=this.count=this.count_r({count:0},d);if(o>0&&this.line("/Count "+o),d.options&&d.options.pageNumber){var c=e.internal.getPageInfo(d.options.pageNumber);this.line("/Dest ["+c.objId+" 0 R /XYZ 0 "+i(0)+" 0]")}this.objEnd()}for(var h=0;h<s.children.length;h++)this.renderItems(s.children[h])},e.outline.line=function(s){this.ctx.val+=s+`\r
`},e.outline.makeRef=function(s){return s.id+" 0 R"},e.outline.makeString=function(s){return"("+e.internal.pdfEscape(s)+")"},e.outline.objStart=function(s){this.ctx.val+=`\r
`+s.id+` 0 obj\r
<<\r
`},e.outline.objEnd=function(){this.ctx.val+=`>> \r
endobj\r
`},e.outline.count_r=function(s,i){for(var a=0;a<i.children.length;a++)s.count++,this.count_r(s,i.children[a]);return s.count}}])})(Ut.API),(function(r){var t=[192,193,194,195,196,197,198,199];r.processJPEG=function(e,s,i,a,d,o){var c,h=this.decode.DCT_DECODE,p=null;if(typeof e=="string"||this.__addimage__.isArrayBuffer(e)||this.__addimage__.isArrayBufferView(e)){switch(e=d||e,e=this.__addimage__.isArrayBuffer(e)?new Uint8Array(e):e,c=(function(b){for(var m,u=256*b.charCodeAt(4)+b.charCodeAt(5),w=b.length,g={width:0,height:0,numcomponents:1},N=4;N<w;N+=2){if(N+=u,t.indexOf(b.charCodeAt(N+1))!==-1){m=256*b.charCodeAt(N+5)+b.charCodeAt(N+6),g={width:256*b.charCodeAt(N+7)+b.charCodeAt(N+8),height:m,numcomponents:b.charCodeAt(N+9)};break}u=256*b.charCodeAt(N+2)+b.charCodeAt(N+3)}return g})(e=this.__addimage__.isArrayBufferView(e)?this.__addimage__.arrayBufferToBinaryString(e):e),c.numcomponents){case 1:o=this.color_spaces.DEVICE_GRAY;break;case 4:o=this.color_spaces.DEVICE_CMYK;break;case 3:o=this.color_spaces.DEVICE_RGB}p={data:e,width:c.width,height:c.height,colorSpace:o,bitsPerComponent:8,filter:h,index:s,alias:i}}return p}})(Ut.API),Ut.API.processPNG=function(r,t,e,s){if(this.__addimage__.isArrayBuffer(r)&&(r=new Uint8Array(r)),this.__addimage__.isArrayBufferView(r)){var i,a=H1(r,{checkCrc:!0}),d=a.width,o=a.height,c=a.channels,h=a.palette,p=a.depth;i=h&&c===1?(function(V){for(var O=V.width,Q=V.height,F=V.data,k=V.palette,M=V.depth,_=!1,te=[],ae=[],re=void 0,se=!1,ie=0,je=0;je<k.length;je++){var ne=Yd(k[je],4),A=ne[0],H=ne[1],Z=ne[2],X=ne[3];te.push(A,H,Z),X!=null&&(X===0?(ie++,ae.length<1&&ae.push(je)):X<255&&(se=!0))}if(se||ie>1){_=!0,ae=void 0;var pe=O*Q;re=new Uint8Array(pe);for(var ve=new DataView(F.buffer),ke=0;ke<pe;ke++){var Ae=dc(ve,ke,M),De=Yd(k[Ae],4)[3];re[ke]=De}}else ie===0&&(ae=void 0);return{colorSpace:"Indexed",colorsPerPixel:1,sMaskBitsPerComponent:_?8:void 0,colorBytes:F,alphaBytes:re,needSMask:_,palette:te,mask:ae}})(a):c===2||c===4?(function(V){for(var O=V.data,Q=V.width,F=V.height,k=V.channels,M=V.depth,_=k===2?"DeviceGray":"DeviceRGB",te=k-1,ae=Q*F,re=te,se=ae*re,ie=1*ae,je=Math.ceil(se*M/8),ne=Math.ceil(ie*M/8),A=new Uint8Array(je),H=new Uint8Array(ne),Z=new DataView(O.buffer),X=new DataView(A.buffer),pe=new DataView(H.buffer),ve=!1,ke=0;ke<ae;ke++){for(var Ae=ke*k,De=0;De<re;De++)Qu(X,dc(Z,Ae+De,M),ke*re+De,M);var Me=dc(Z,Ae+re,M);Me<(1<<M)-1&&(ve=!0),Qu(pe,Me,1*ke,M)}return{colorSpace:_,colorsPerPixel:te,sMaskBitsPerComponent:ve?M:void 0,colorBytes:A,alphaBytes:H,needSMask:ve}})(a):(function(V){var O=V.data,Q=V.channels===1?"DeviceGray":"DeviceRGB";return{colorSpace:Q,colorsPerPixel:Q==="DeviceGray"?1:3,colorBytes:O instanceof Uint16Array?(function(F){for(var k=F.length,M=new Uint8Array(2*k),_=new DataView(M.buffer,M.byteOffset,M.byteLength),te=0;te<k;te++)_.setUint16(2*te,F[te],!1);return M})(O):O,needSMask:!1}})(a);var b,m,u,w=i,g=w.colorSpace,N=w.colorsPerPixel,y=w.sMaskBitsPerComponent,S=w.colorBytes,L=w.alphaBytes,E=w.needSMask,I=w.palette,K=w.mask,Y=null;return s!==Ut.API.image_compression.NONE&&typeof Nc=="function"?(Y=(function(V){var O;switch(V){case Ut.API.image_compression.FAST:O=11;break;case Ut.API.image_compression.MEDIUM:O=13;break;case Ut.API.image_compression.SLOW:O=14;break;default:O=12}return O})(s),b=this.decode.FLATE_DECODE,m="/Predictor ".concat(Y," /Colors ").concat(N," /BitsPerComponent ").concat(p," /Columns ").concat(d),r=Yu(S,Math.ceil(d*N*p/8),N,p,s),E&&(u=Yu(L,Math.ceil(d*y/8),1,y,s))):(b=void 0,m=void 0,r=S,E&&(u=L)),(this.__addimage__.isArrayBuffer(r)||this.__addimage__.isArrayBufferView(r))&&(r=this.__addimage__.arrayBufferToBinaryString(r)),(u&&this.__addimage__.isArrayBuffer(u)||this.__addimage__.isArrayBufferView(u))&&(u=this.__addimage__.arrayBufferToBinaryString(u)),{alias:e,data:r,index:t,filter:b,decodeParameters:m,transparency:K,palette:I,sMask:u,predictor:Y,width:d,height:o,bitsPerComponent:p,sMaskBitsPerComponent:y,colorSpace:g}}},(function(r){r.processGIF89A=function(t,e,s,i){var a=new h2(t),d=a.width,o=a.height,c=[];a.decodeAndBlitFrameRGBA(0,c);var h={data:c,width:d,height:o},p=new uc(100).encode(h,100);return r.processJPEG.call(this,p,e,s,i)},r.processGIF87A=r.processGIF89A})(Ut.API),Fs.prototype.parseHeader=function(){if(this.fileSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.reserved=this.datav.getUint32(this.pos,!0),this.pos+=4,this.offset=this.datav.getUint32(this.pos,!0),this.pos+=4,this.headerSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.width=this.datav.getUint32(this.pos,!0),this.pos+=4,this.height=this.datav.getInt32(this.pos,!0),this.pos+=4,this.planes=this.datav.getUint16(this.pos,!0),this.pos+=2,this.bitPP=this.datav.getUint16(this.pos,!0),this.pos+=2,this.compress=this.datav.getUint32(this.pos,!0),this.pos+=4,this.rawSize=this.datav.getUint32(this.pos,!0),this.pos+=4,this.hr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.vr=this.datav.getUint32(this.pos,!0),this.pos+=4,this.colors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.importantColors=this.datav.getUint32(this.pos,!0),this.pos+=4,this.bitPP===16&&this.is_with_alpha&&(this.bitPP=15),this.bitPP<15){var r=this.colors===0?1<<this.bitPP:this.colors;this.palette=new Array(r);for(var t=0;t<r;t++){var e=this.datav.getUint8(this.pos++,!0),s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0);this.palette[t]={red:i,green:s,blue:e,quad:a}}}this.height<0&&(this.height*=-1,this.bottom_up=!1)},Fs.prototype.parseBGR=function(){this.pos=this.offset;try{var r="bit"+this.bitPP,t=this.width*this.height*4;this.data=new Uint8Array(t),this[r]()}catch(e){Ir.log("bit decode error:"+e)}},Fs.prototype.bit1=function(){var r,t=Math.ceil(this.width/8),e=t%4;for(r=this.height-1;r>=0;r--){for(var s=this.bottom_up?r:this.height-1-r,i=0;i<t;i++)for(var a=this.datav.getUint8(this.pos++,!0),d=s*this.width*4+8*i*4,o=0;o<8&&8*i+o<this.width;o++){var c=this.palette[a>>7-o&1];this.data[d+4*o]=c.blue,this.data[d+4*o+1]=c.green,this.data[d+4*o+2]=c.red,this.data[d+4*o+3]=255}e!==0&&(this.pos+=4-e)}},Fs.prototype.bit4=function(){for(var r=Math.ceil(this.width/2),t=r%4,e=this.height-1;e>=0;e--){for(var s=this.bottom_up?e:this.height-1-e,i=0;i<r;i++){var a=this.datav.getUint8(this.pos++,!0),d=s*this.width*4+2*i*4,o=a>>4,c=15&a,h=this.palette[o];if(this.data[d]=h.blue,this.data[d+1]=h.green,this.data[d+2]=h.red,this.data[d+3]=255,2*i+1>=this.width)break;h=this.palette[c],this.data[d+4]=h.blue,this.data[d+4+1]=h.green,this.data[d+4+2]=h.red,this.data[d+4+3]=255}t!==0&&(this.pos+=4-t)}},Fs.prototype.bit8=function(){for(var r=this.width%4,t=this.height-1;t>=0;t--){for(var e=this.bottom_up?t:this.height-1-t,s=0;s<this.width;s++){var i=this.datav.getUint8(this.pos++,!0),a=e*this.width*4+4*s;if(i<this.palette.length){var d=this.palette[i];this.data[a]=d.red,this.data[a+1]=d.green,this.data[a+2]=d.blue,this.data[a+3]=255}else this.data[a]=255,this.data[a+1]=255,this.data[a+2]=255,this.data[a+3]=255}r!==0&&(this.pos+=4-r)}},Fs.prototype.bit15=function(){for(var r=this.width%3,t=parseInt("11111",2),e=this.height-1;e>=0;e--){for(var s=this.bottom_up?e:this.height-1-e,i=0;i<this.width;i++){var a=this.datav.getUint16(this.pos,!0);this.pos+=2;var d=(a&t)/t*255|0,o=(a>>5&t)/t*255|0,c=(a>>10&t)/t*255|0,h=a>>15?255:0,p=s*this.width*4+4*i;this.data[p]=c,this.data[p+1]=o,this.data[p+2]=d,this.data[p+3]=h}this.pos+=r}},Fs.prototype.bit16=function(){for(var r=this.width%3,t=parseInt("11111",2),e=parseInt("111111",2),s=this.height-1;s>=0;s--){for(var i=this.bottom_up?s:this.height-1-s,a=0;a<this.width;a++){var d=this.datav.getUint16(this.pos,!0);this.pos+=2;var o=(d&t)/t*255|0,c=(d>>5&e)/e*255|0,h=(d>>11)/t*255|0,p=i*this.width*4+4*a;this.data[p]=h,this.data[p+1]=c,this.data[p+2]=o,this.data[p+3]=255}this.pos+=r}},Fs.prototype.bit24=function(){for(var r=this.height-1;r>=0;r--){for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),d=t*this.width*4+4*e;this.data[d]=a,this.data[d+1]=i,this.data[d+2]=s,this.data[d+3]=255}this.pos+=this.width%4}},Fs.prototype.bit32=function(){for(var r=this.height-1;r>=0;r--)for(var t=this.bottom_up?r:this.height-1-r,e=0;e<this.width;e++){var s=this.datav.getUint8(this.pos++,!0),i=this.datav.getUint8(this.pos++,!0),a=this.datav.getUint8(this.pos++,!0),d=this.datav.getUint8(this.pos++,!0),o=t*this.width*4+4*e;this.data[o]=a,this.data[o+1]=i,this.data[o+2]=s,this.data[o+3]=d}},Fs.prototype.getData=function(){return this.data},(function(r){r.processBMP=function(t,e,s,i){var a=new Fs(t,!1),d=a.width,o=a.height,c={data:a.getData(),width:d,height:o},h=new uc(100).encode(c,100);return r.processJPEG.call(this,h,e,s,i)}})(Ut.API),th.prototype.getData=function(){return this.data},(function(r){r.processWEBP=function(t,e,s,i){var a=new th(t),d=a.width,o=a.height,c={data:a.getData(),width:d,height:o},h=new uc(100).encode(c,100);return r.processJPEG.call(this,h,e,s,i)}})(Ut.API),Ut.API.processRGBA=function(r,t,e){for(var s=r.data,i=s.length,a=new Uint8Array(i/4*3),d=new Uint8Array(i/4),o=0,c=0,h=0;h<i;h+=4){var p=s[h],b=s[h+1],m=s[h+2],u=s[h+3];a[o++]=p,a[o++]=b,a[o++]=m,d[c++]=u}var w=this.__addimage__.arrayBufferToBinaryString(a);return{alpha:this.__addimage__.arrayBufferToBinaryString(d),data:w,index:t,alias:e,colorSpace:"DeviceRGB",bitsPerComponent:8,width:r.width,height:r.height}},Ut.API.setLanguage=function(r){return this.internal.languageSettings===void 0&&(this.internal.languageSettings={},this.internal.languageSettings.isSubscribed=!1),{af:"Afrikaans",sq:"Albanian",ar:"Arabic (Standard)","ar-DZ":"Arabic (Algeria)","ar-BH":"Arabic (Bahrain)","ar-EG":"Arabic (Egypt)","ar-IQ":"Arabic (Iraq)","ar-JO":"Arabic (Jordan)","ar-KW":"Arabic (Kuwait)","ar-LB":"Arabic (Lebanon)","ar-LY":"Arabic (Libya)","ar-MA":"Arabic (Morocco)","ar-OM":"Arabic (Oman)","ar-QA":"Arabic (Qatar)","ar-SA":"Arabic (Saudi Arabia)","ar-SY":"Arabic (Syria)","ar-TN":"Arabic (Tunisia)","ar-AE":"Arabic (U.A.E.)","ar-YE":"Arabic (Yemen)",an:"Aragonese",hy:"Armenian",as:"Assamese",ast:"Asturian",az:"Azerbaijani",eu:"Basque",be:"Belarusian",bn:"Bengali",bs:"Bosnian",br:"Breton",bg:"Bulgarian",my:"Burmese",ca:"Catalan",ch:"Chamorro",ce:"Chechen",zh:"Chinese","zh-HK":"Chinese (Hong Kong)","zh-CN":"Chinese (PRC)","zh-SG":"Chinese (Singapore)","zh-TW":"Chinese (Taiwan)",cv:"Chuvash",co:"Corsican",cr:"Cree",hr:"Croatian",cs:"Czech",da:"Danish",nl:"Dutch (Standard)","nl-BE":"Dutch (Belgian)",en:"English","en-AU":"English (Australia)","en-BZ":"English (Belize)","en-CA":"English (Canada)","en-IE":"English (Ireland)","en-JM":"English (Jamaica)","en-NZ":"English (New Zealand)","en-PH":"English (Philippines)","en-ZA":"English (South Africa)","en-TT":"English (Trinidad & Tobago)","en-GB":"English (United Kingdom)","en-US":"English (United States)","en-ZW":"English (Zimbabwe)",eo:"Esperanto",et:"Estonian",fo:"Faeroese",fj:"Fijian",fi:"Finnish",fr:"French (Standard)","fr-BE":"French (Belgium)","fr-CA":"French (Canada)","fr-FR":"French (France)","fr-LU":"French (Luxembourg)","fr-MC":"French (Monaco)","fr-CH":"French (Switzerland)",fy:"Frisian",fur:"Friulian",gd:"Gaelic (Scots)","gd-IE":"Gaelic (Irish)",gl:"Galacian",ka:"Georgian",de:"German (Standard)","de-AT":"German (Austria)","de-DE":"German (Germany)","de-LI":"German (Liechtenstein)","de-LU":"German (Luxembourg)","de-CH":"German (Switzerland)",el:"Greek",gu:"Gujurati",ht:"Haitian",he:"Hebrew",hi:"Hindi",hu:"Hungarian",is:"Icelandic",id:"Indonesian",iu:"Inuktitut",ga:"Irish",it:"Italian (Standard)","it-CH":"Italian (Switzerland)",ja:"Japanese",kn:"Kannada",ks:"Kashmiri",kk:"Kazakh",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Korean","ko-KP":"Korean (North Korea)","ko-KR":"Korean (South Korea)",la:"Latin",lv:"Latvian",lt:"Lithuanian",lb:"Luxembourgish",mk:"North Macedonia",ms:"Malay",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavian",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Norwegian",nb:"Norwegian (Bokmal)",nn:"Norwegian (Nynorsk)",oc:"Occitan",or:"Oriya",om:"Oromo",fa:"Persian","fa-IR":"Persian/Iran",pl:"Polish",pt:"Portuguese","pt-BR":"Portuguese (Brazil)",pa:"Punjabi","pa-IN":"Punjabi (India)","pa-PK":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhaeto-Romanic",ro:"Romanian","ro-MO":"Romanian (Moldavia)",ru:"Russian","ru-MO":"Russian (Moldavia)",sz:"Sami (Lappish)",sg:"Sango",sa:"Sanskrit",sc:"Sardinian",sd:"Sindhi",si:"Singhalese",sr:"Serbian",sk:"Slovak",sl:"Slovenian",so:"Somani",sb:"Sorbian",es:"Spanish","es-AR":"Spanish (Argentina)","es-BO":"Spanish (Bolivia)","es-CL":"Spanish (Chile)","es-CO":"Spanish (Colombia)","es-CR":"Spanish (Costa Rica)","es-DO":"Spanish (Dominican Republic)","es-EC":"Spanish (Ecuador)","es-SV":"Spanish (El Salvador)","es-GT":"Spanish (Guatemala)","es-HN":"Spanish (Honduras)","es-MX":"Spanish (Mexico)","es-NI":"Spanish (Nicaragua)","es-PA":"Spanish (Panama)","es-PY":"Spanish (Paraguay)","es-PE":"Spanish (Peru)","es-PR":"Spanish (Puerto Rico)","es-ES":"Spanish (Spain)","es-UY":"Spanish (Uruguay)","es-VE":"Spanish (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Swedish","sv-FI":"Swedish (Finland)","sv-SV":"Swedish (Sweden)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turkish",tk:"Turkmen",uk:"Ukrainian",hsb:"Upper Sorbian",ur:"Urdu",ve:"Venda",vi:"Vietnamese",vo:"Volapuk",wa:"Walloon",cy:"Welsh",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"}[r]!==void 0&&(this.internal.languageSettings.languageCode=r,this.internal.languageSettings.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){this.internal.write("/Lang ("+this.internal.languageSettings.languageCode+")")}),this.internal.languageSettings.isSubscribed=!0)),this},Si=Ut.API,Jo=Si.getCharWidthsArray=function(r,t){var e,s,i=(t=t||{}).font||this.internal.getFont(),a=t.fontSize||this.internal.getFontSize(),d=t.charSpace||this.internal.getCharSpace(),o=t.widths?t.widths:i.metadata.Unicode.widths,c=o.fof?o.fof:1,h=t.kerning?t.kerning:i.metadata.Unicode.kerning,p=h.fof?h.fof:1,b=t.doKerning!==!1,m=0,u=r.length,w=0,g=o[0]||c,N=[];for(e=0;e<u;e++)s=r.charCodeAt(e),typeof i.metadata.widthOfString=="function"?N.push((i.metadata.widthOfGlyph(i.metadata.characterToGlyph(s))+d*(1e3/a)||0)/1e3):(m=b&&Cr(h[s])==="object"&&!isNaN(parseInt(h[s][w],10))?h[s][w]/p:0,N.push((o[s]||g)/c+m)),w=s;return N},Hu=Si.getStringUnitWidth=function(r,t){var e=(t=t||{}).fontSize||this.internal.getFontSize(),s=t.font||this.internal.getFont(),i=t.charSpace||this.internal.getCharSpace();return Si.processArabic&&(r=Si.processArabic(r)),typeof s.metadata.widthOfString=="function"?s.metadata.widthOfString(r,e,i)/e:Jo.apply(this,arguments).reduce(function(a,d){return a+d},0)},Vu=function(r,t,e,s){for(var i=[],a=0,d=r.length,o=0;a!==d&&o+t[a]<e;)o+=t[a],a++;i.push(r.slice(0,a));var c=a;for(o=0;a!==d;)o+t[a]>s&&(i.push(r.slice(c,a)),o=0,c=a),o+=t[a],a++;return c!==a&&i.push(r.slice(c,a)),i},Gu=function(r,t,e){e||(e={});var s,i,a,d,o,c,h,p=[],b=[p],m=e.textIndent||0,u=0,w=0,g=r.split(" "),N=Jo.apply(this,[" ",e])[0];if(c=e.lineIndent===-1?g[0].length+2:e.lineIndent||0){var y=Array(c).join(" "),S=[];g.map(function(E){(E=E.split(/\s*\n/)).length>1?S=S.concat(E.map(function(I,K){return(K&&I.length?`
`:"")+I})):S.push(E[0])}),g=S,c=Hu.apply(this,[y,e])}for(a=0,d=g.length;a<d;a++){var L=0;if(s=g[a],c&&s[0]==`
`&&(s=s.substr(1),L=1),m+u+(w=(i=Jo.apply(this,[s,e])).reduce(function(E,I){return E+I},0))>t||L){if(w>t){for(o=Vu.apply(this,[s,i,t-(m+u),t]),p.push(o.shift()),p=[o.pop()];o.length;)b.push([o.shift()]);w=i.slice(s.length-(p[0]?p[0].length:0)).reduce(function(E,I){return E+I},0)}else p=[s];b.push(p),m=w+c,u=N}else p.push(s),m+=u+w,u=N}return h=c?function(E,I){return(I?y:"")+E.join(" ")}:function(E){return E.join(" ")},b.map(h)},Si.splitTextToSize=function(r,t,e){var s,i=(e=e||{}).fontSize||this.internal.getFontSize(),a=(function(p){if(p.widths&&p.kerning)return{widths:p.widths,kerning:p.kerning};var b=this.internal.getFont(p.fontName,p.fontStyle),m="Unicode";return b.metadata[m]?{widths:b.metadata[m].widths||{0:1},kerning:b.metadata[m].kerning||{}}:{font:b.metadata,fontSize:this.internal.getFontSize(),charSpace:this.internal.getCharSpace()}}).call(this,e);s=Array.isArray(r)?r:String(r).split(/\r?\n/);var d=1*this.internal.scaleFactor*t/i;a.textIndent=e.textIndent?1*e.textIndent*this.internal.scaleFactor/i:0,a.lineIndent=e.lineIndent;var o,c,h=[];for(o=0,c=s.length;o<c;o++)h=h.concat(Gu.apply(this,[s[o],d,a]));return h},(function(r){r.__fontmetrics__=r.__fontmetrics__||{};for(var t="0123456789abcdef",e="klmnopqrstuvwxyz",s={},i={},a=0;a<16;a++)s[e[a]]=t[a],i[t[a]]=e[a];var d=function(m){return"0x"+parseInt(m,10).toString(16)},o=r.__fontmetrics__.compress=function(m){var u,w,g,N,y=["{"];for(var S in m){if(u=m[S],isNaN(parseInt(S,10))?w="'"+S+"'":(S=parseInt(S,10),w=(w=d(S).slice(2)).slice(0,-1)+i[w.slice(-1)]),typeof u=="number")u<0?(g=d(u).slice(3),N="-"):(g=d(u).slice(2),N=""),g=N+g.slice(0,-1)+i[g.slice(-1)];else{if(Cr(u)!=="object")throw new Error("Don't know what to do with value type "+Cr(u)+".");g=o(u)}y.push(w+g)}return y.push("}"),y.join("")},c=r.__fontmetrics__.uncompress=function(m){if(typeof m!="string")throw new Error("Invalid argument passed to uncompress.");for(var u,w,g,N,y={},S=1,L=y,E=[],I="",K="",Y=m.length-1,V=1;V<Y;V+=1)(N=m[V])=="'"?u?(g=u.join(""),u=void 0):u=[]:u?u.push(N):N=="{"?(E.push([L,g]),L={},g=void 0):N=="}"?((w=E.pop())[0][w[1]]=L,g=void 0,L=w[0]):N=="-"?S=-1:g===void 0?s.hasOwnProperty(N)?(I+=s[N],g=parseInt(I,16)*S,S=1,I=""):I+=N:s.hasOwnProperty(N)?(K+=s[N],L[g]=parseInt(K,16)*S,S=1,g=void 0,K=""):K+=N;return y},h={codePages:["WinAnsiEncoding"],WinAnsiEncoding:c("{19m8n201n9q201o9r201s9l201t9m201u8m201w9n201x9o201y8o202k8q202l8r202m9p202q8p20aw8k203k8t203t8v203u9v2cq8s212m9t15m8w15n9w2dw9s16k8u16l9u17s9z17x8y17y9y}")},p={Unicode:{Courier:h,"Courier-Bold":h,"Courier-BoldOblique":h,"Courier-Oblique":h,Helvetica:h,"Helvetica-Bold":h,"Helvetica-BoldOblique":h,"Helvetica-Oblique":h,"Times-Roman":h,"Times-Bold":h,"Times-BoldItalic":h,"Times-Italic":h}},b={Unicode:{"Courier-Oblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-BoldItalic":c("{'widths'{k3o2q4ycx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2r202m2n2n3m2o3m2p5n202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5n4l4m4m4m4n4m4o4s4p4m4q4m4r4s4s4y4t2r4u3m4v4m4w3x4x5t4y4s4z4s5k3x5l4s5m4m5n3r5o3x5p4s5q4m5r5t5s4m5t3x5u3x5v2l5w1w5x2l5y3t5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q2l6r3m6s3r6t1w6u1w6v3m6w1w6x4y6y3r6z3m7k3m7l3m7m2r7n2r7o1w7p3r7q2w7r4m7s3m7t2w7u2r7v2n7w1q7x2n7y3t202l3mcl4mal2ram3man3mao3map3mar3mas2lat4uau1uav3maw3way4uaz2lbk2sbl3t'fof'6obo2lbp3tbq3mbr1tbs2lbu1ybv3mbz3mck4m202k3mcm4mcn4mco4mcp4mcq5ycr4mcs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz2w203k6o212m6o2dw2l2cq2l3t3m3u2l17s3x19m3m}'kerning'{cl{4qu5kt5qt5rs17ss5ts}201s{201ss}201t{cks4lscmscnscoscpscls2wu2yu201ts}201x{2wu2yu}2k{201ts}2w{4qx5kx5ou5qx5rs17su5tu}2x{17su5tu5ou}2y{4qx5kx5ou5qx5rs17ss5ts}'fof'-6ofn{17sw5tw5ou5qw5rs}7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qs}3v{17su5tu5os5qs}7p{17su5tu}ck{4qu5kt5qt5rs17ss5ts}4l{4qu5kt5qt5rs17ss5ts}cm{4qu5kt5qt5rs17ss5ts}cn{4qu5kt5qt5rs17ss5ts}co{4qu5kt5qt5rs17ss5ts}cp{4qu5kt5qt5rs17ss5ts}6l{4qu5ou5qw5rt17su5tu}5q{ckuclucmucnucoucpu4lu}5r{ckuclucmucnucoucpu4lu}7q{cksclscmscnscoscps4ls}6p{4qu5ou5qw5rt17sw5tw}ek{4qu5ou5qw5rt17su5tu}el{4qu5ou5qw5rt17su5tu}em{4qu5ou5qw5rt17su5tu}en{4qu5ou5qw5rt17su5tu}eo{4qu5ou5qw5rt17su5tu}ep{4qu5ou5qw5rt17su5tu}es{17ss5ts5qs4qu}et{4qu5ou5qw5rt17sw5tw}eu{4qu5ou5qw5rt17ss5ts}ev{17ss5ts5qs4qu}6z{17sw5tw5ou5qw5rs}fm{17sw5tw5ou5qw5rs}7n{201ts}fo{17sw5tw5ou5qw5rs}fp{17sw5tw5ou5qw5rs}fq{17sw5tw5ou5qw5rs}7r{cksclscmscnscoscps4ls}fs{17sw5tw5ou5qw5rs}ft{17su5tu}fu{17su5tu}fv{17su5tu}fw{17su5tu}fz{cksclscmscnscoscps4ls}}}"),"Helvetica-Bold":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),Courier:c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-BoldOblique":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Bold":c("{'widths'{k3q2q5ncx2r201n3m201o6o201s2l201t2l201u2l201w3m201x3m201y3m2k1t2l2l202m2n2n3m2o3m2p6o202q6o2r1w2s2l2t2l2u3m2v3t2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w3t3x3t3y3t3z3m4k5x4l4s4m4m4n4s4o4s4p4m4q3x4r4y4s4y4t2r4u3m4v4y4w4m4x5y4y4s4z4y5k3x5l4y5m4s5n3r5o4m5p4s5q4s5r6o5s4s5t4s5u4m5v2l5w1w5x2l5y3u5z3m6k2l6l3m6m3r6n2w6o3r6p2w6q2l6r3m6s3r6t1w6u2l6v3r6w1w6x5n6y3r6z3m7k3r7l3r7m2w7n2r7o2l7p3r7q3m7r4s7s3m7t3m7u2w7v2r7w1q7x2r7y3o202l3mcl4sal2lam3man3mao3map3mar3mas2lat4uau1yav3maw3tay4uaz2lbk2sbl3t'fof'6obo2lbp3rbr1tbs2lbu2lbv3mbz3mck4s202k3mcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw2r2m3rcy2rcz2rdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3rek3mel3mem3men3meo3mep3meq4ser2wes2wet2weu2wev2wew1wex1wey1wez1wfl3rfm3mfn3mfo3mfp3mfq3mfr3tfs3mft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3m3u2l17s4s19m3m}'kerning'{cl{4qt5ks5ot5qy5rw17sv5tv}201t{cks4lscmscnscoscpscls4wv}2k{201ts}2w{4qu5ku7mu5os5qx5ru17su5tu}2x{17su5tu5ou5qs}2y{4qv5kv7mu5ot5qz5ru17su5tu}'fof'-6o7t{cksclscmscnscoscps4ls}3u{17su5tu5os5qu}3v{17su5tu5os5qu}fu{17su5tu5ou5qu}7p{17su5tu5ou5qu}ck{4qt5ks5ot5qy5rw17sv5tv}4l{4qt5ks5ot5qy5rw17sv5tv}cm{4qt5ks5ot5qy5rw17sv5tv}cn{4qt5ks5ot5qy5rw17sv5tv}co{4qt5ks5ot5qy5rw17sv5tv}cp{4qt5ks5ot5qy5rw17sv5tv}6l{17st5tt5ou5qu}17s{ckuclucmucnucoucpu4lu4wu}5o{ckuclucmucnucoucpu4lu4wu}5q{ckzclzcmzcnzcozcpz4lz4wu}5r{ckxclxcmxcnxcoxcpx4lx4wu}5t{ckuclucmucnucoucpu4lu4wu}7q{ckuclucmucnucoucpu4lu}6p{17sw5tw5ou5qu}ek{17st5tt5qu}el{17st5tt5ou5qu}em{17st5tt5qu}en{17st5tt5qu}eo{17st5tt5qu}ep{17st5tt5ou5qu}es{17ss5ts5qu}et{17sw5tw5ou5qu}eu{17sw5tw5ou5qu}ev{17ss5ts5qu}6z{17sw5tw5ou5qu5rs}fm{17sw5tw5ou5qu5rs}fn{17sw5tw5ou5qu5rs}fo{17sw5tw5ou5qu5rs}fp{17sw5tw5ou5qu5rs}fq{17sw5tw5ou5qu5rs}7r{cktcltcmtcntcotcpt4lt5os}fs{17sw5tw5ou5qu5rs}ft{17su5tu5ou5qu}7m{5os}fv{17su5tu5ou5qu}fw{17su5tu5ou5qu}fz{cksclscmscnscoscps4ls}}}"),Symbol:c("{'widths'{k3uaw4r19m3m2k1t2l2l202m2y2n3m2p5n202q6o3k3m2s2l2t2l2v3r2w1t3m3m2y1t2z1wbk2sbl3r'fof'6o3n3m3o3m3p3m3q3m3r3m3s3m3t3m3u1w3v1w3w3r3x3r3y3r3z2wbp3t3l3m5v2l5x2l5z3m2q4yfr3r7v3k7w1o7x3k}'kerning'{'fof'-6o}}"),Helvetica:c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}"),"Helvetica-BoldOblique":c("{'widths'{k3s2q4scx1w201n3r201o6o201s1w201t1w201u1w201w3m201x3m201y3m2k1w2l2l202m2n2n3r2o3r2p5t202q6o2r1s2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v2l3w3u3x3u3y3u3z3x4k6l4l4s4m4s4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3r4v4s4w3x4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v2l5w1w5x2l5y3u5z3r6k2l6l3r6m3x6n3r6o3x6p3r6q2l6r3x6s3x6t1w6u1w6v3r6w1w6x5t6y3x6z3x7k3x7l3x7m2r7n3r7o2l7p3x7q3r7r4y7s3r7t3r7u3m7v2r7w1w7x2r7y3u202l3rcl4sal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3xbq3rbr1wbs2lbu2obv3rbz3xck4s202k3rcm4scn4sco4scp4scq6ocr4scs4mct4mcu4mcv4mcw1w2m2zcy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3res3ret3reu3rev3rew1wex1wey1wez1wfl3xfm3xfn3xfo3xfp3xfq3xfr3ufs3xft3xfu3xfv3xfw3xfz3r203k6o212m6o2dw2l2cq2l3t3r3u2l17s4m19m3r}'kerning'{cl{4qs5ku5ot5qs17sv5tv}201t{2ww4wy2yw}201w{2ks}201x{2ww4wy2yw}2k{201ts201xs}2w{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}2x{5ow5qs}2y{7qs4qu5kw5os5qw5rs17su5tu7tsfzs}'fof'-6o7p{17su5tu5ot}ck{4qs5ku5ot5qs17sv5tv}4l{4qs5ku5ot5qs17sv5tv}cm{4qs5ku5ot5qs17sv5tv}cn{4qs5ku5ot5qs17sv5tv}co{4qs5ku5ot5qs17sv5tv}cp{4qs5ku5ot5qs17sv5tv}6l{17st5tt5os}17s{2kwclvcmvcnvcovcpv4lv4wwckv}5o{2kucltcmtcntcotcpt4lt4wtckt}5q{2ksclscmscnscoscps4ls4wvcks}5r{2ks4ws}5t{2kwclvcmvcnvcovcpv4lv4wwckv}eo{17st5tt5os}fu{17su5tu5ot}6p{17ss5ts}ek{17st5tt5os}el{17st5tt5os}em{17st5tt5os}en{17st5tt5os}6o{201ts}ep{17st5tt5os}es{17ss5ts}et{17ss5ts}eu{17ss5ts}ev{17ss5ts}6z{17su5tu5os5qt}fm{17su5tu5os5qt}fn{17su5tu5os5qt}fo{17su5tu5os5qt}fp{17su5tu5os5qt}fq{17su5tu5os5qt}fs{17su5tu5os5qt}ft{17su5tu5ot}7m{5os}fv{17su5tu5ot}fw{17su5tu5ot}}}"),ZapfDingbats:c("{'widths'{k4u2k1w'fof'6o}'kerning'{'fof'-6o}}"),"Courier-Bold":c("{'widths'{k3w'fof'6o}'kerning'{'fof'-6o}}"),"Times-Italic":c("{'widths'{k3n2q4ycx2l201n3m201o5t201s2l201t2l201u2l201w3r201x3r201y3r2k1t2l2l202m2n2n3m2o3m2p5n202q5t2r1p2s2l2t2l2u3m2v4n2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v2l3w4n3x4n3y4n3z3m4k5w4l3x4m3x4n4m4o4s4p3x4q3x4r4s4s4s4t2l4u2w4v4m4w3r4x5n4y4m4z4s5k3x5l4s5m3x5n3m5o3r5p4s5q3x5r5n5s3x5t3r5u3r5v2r5w1w5x2r5y2u5z3m6k2l6l3m6m3m6n2w6o3m6p2w6q1w6r3m6s3m6t1w6u1w6v2w6w1w6x4s6y3m6z3m7k3m7l3m7m2r7n2r7o1w7p3m7q2w7r4m7s2w7t2w7u2r7v2s7w1v7x2s7y3q202l3mcl3xal2ram3man3mao3map3mar3mas2lat4wau1vav3maw4nay4waz2lbk2sbl4n'fof'6obo2lbp3mbq3obr1tbs2lbu1zbv3mbz3mck3x202k3mcm3xcn3xco3xcp3xcq5tcr4mcs3xct3xcu3xcv3xcw2l2m2ucy2lcz2ldl4mdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek3mel3mem3men3meo3mep3meq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr4nfs3mft3mfu3mfv3mfw3mfz2w203k6o212m6m2dw2l2cq2l3t3m3u2l17s3r19m3m}'kerning'{cl{5kt4qw}201s{201sw}201t{201tw2wy2yy6q-t}201x{2wy2yy}2k{201tw}2w{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}2x{17ss5ts5os}2y{7qs4qy7rs5ky7mw5os5qx5ru17su5tu}'fof'-6o6t{17ss5ts5qs}7t{5os}3v{5qs}7p{17su5tu5qs}ck{5kt4qw}4l{5kt4qw}cm{5kt4qw}cn{5kt4qw}co{5kt4qw}cp{5kt4qw}6l{4qs5ks5ou5qw5ru17su5tu}17s{2ks}5q{ckvclvcmvcnvcovcpv4lv}5r{ckuclucmucnucoucpu4lu}5t{2ks}6p{4qs5ks5ou5qw5ru17su5tu}ek{4qs5ks5ou5qw5ru17su5tu}el{4qs5ks5ou5qw5ru17su5tu}em{4qs5ks5ou5qw5ru17su5tu}en{4qs5ks5ou5qw5ru17su5tu}eo{4qs5ks5ou5qw5ru17su5tu}ep{4qs5ks5ou5qw5ru17su5tu}es{5ks5qs4qs}et{4qs5ks5ou5qw5ru17su5tu}eu{4qs5ks5qw5ru17su5tu}ev{5ks5qs4qs}ex{17ss5ts5qs}6z{4qv5ks5ou5qw5ru17su5tu}fm{4qv5ks5ou5qw5ru17su5tu}fn{4qv5ks5ou5qw5ru17su5tu}fo{4qv5ks5ou5qw5ru17su5tu}fp{4qv5ks5ou5qw5ru17su5tu}fq{4qv5ks5ou5qw5ru17su5tu}7r{5os}fs{4qv5ks5ou5qw5ru17su5tu}ft{17su5tu5qs}fu{17su5tu5qs}fv{17su5tu5qs}fw{17su5tu5qs}}}"),"Times-Roman":c("{'widths'{k3n2q4ycx2l201n3m201o6o201s2l201t2l201u2l201w2w201x2w201y2w2k1t2l2l202m2n2n3m2o3m2p5n202q6o2r1m2s2l2t2l2u3m2v3s2w1t2x2l2y1t2z1w3k3m3l3m3m3m3n3m3o3m3p3m3q3m3r3m3s3m203t2l203u2l3v1w3w3s3x3s3y3s3z2w4k5w4l4s4m4m4n4m4o4s4p3x4q3r4r4s4s4s4t2l4u2r4v4s4w3x4x5t4y4s4z4s5k3r5l4s5m4m5n3r5o3x5p4s5q4s5r5y5s4s5t4s5u3x5v2l5w1w5x2l5y2z5z3m6k2l6l2w6m3m6n2w6o3m6p2w6q2l6r3m6s3m6t1w6u1w6v3m6w1w6x4y6y3m6z3m7k3m7l3m7m2l7n2r7o1w7p3m7q3m7r4s7s3m7t3m7u2w7v3k7w1o7x3k7y3q202l3mcl4sal2lam3man3mao3map3mar3mas2lat4wau1vav3maw3say4waz2lbk2sbl3s'fof'6obo2lbp3mbq2xbr1tbs2lbu1zbv3mbz2wck4s202k3mcm4scn4sco4scp4scq5tcr4mcs3xct3xcu3xcv3xcw2l2m2tcy2lcz2ldl4sdm4sdn4sdo4sdp4sdq4sds4sdt4sdu4sdv4sdw4sdz3mek2wel2wem2wen2weo2wep2weq4mer2wes2wet2weu2wev2wew1wex1wey1wez1wfl3mfm3mfn3mfo3mfp3mfq3mfr3sfs3mft3mfu3mfv3mfw3mfz3m203k6o212m6m2dw2l2cq2l3t3m3u1w17s4s19m3m}'kerning'{cl{4qs5ku17sw5ou5qy5rw201ss5tw201ws}201s{201ss}201t{ckw4lwcmwcnwcowcpwclw4wu201ts}2k{201ts}2w{4qs5kw5os5qx5ru17sx5tx}2x{17sw5tw5ou5qu}2y{4qs5kw5os5qx5ru17sx5tx}'fof'-6o7t{ckuclucmucnucoucpu4lu5os5rs}3u{17su5tu5qs}3v{17su5tu5qs}7p{17sw5tw5qs}ck{4qs5ku17sw5ou5qy5rw201ss5tw201ws}4l{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cm{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cn{4qs5ku17sw5ou5qy5rw201ss5tw201ws}co{4qs5ku17sw5ou5qy5rw201ss5tw201ws}cp{4qs5ku17sw5ou5qy5rw201ss5tw201ws}6l{17su5tu5os5qw5rs}17s{2ktclvcmvcnvcovcpv4lv4wuckv}5o{ckwclwcmwcnwcowcpw4lw4wu}5q{ckyclycmycnycoycpy4ly4wu5ms}5r{cktcltcmtcntcotcpt4lt4ws}5t{2ktclvcmvcnvcovcpv4lv4wuckv}7q{cksclscmscnscoscps4ls}6p{17su5tu5qw5rs}ek{5qs5rs}el{17su5tu5os5qw5rs}em{17su5tu5os5qs5rs}en{17su5qs5rs}eo{5qs5rs}ep{17su5tu5os5qw5rs}es{5qs}et{17su5tu5qw5rs}eu{17su5tu5qs5rs}ev{5qs}6z{17sv5tv5os5qx5rs}fm{5os5qt5rs}fn{17sv5tv5os5qx5rs}fo{17sv5tv5os5qx5rs}fp{5os5qt5rs}fq{5os5qt5rs}7r{ckuclucmucnucoucpu4lu5os}fs{17sv5tv5os5qx5rs}ft{17ss5ts5qs}fu{17sw5tw5qs}fv{17sw5tw5qs}fw{17ss5ts5qs}fz{ckuclucmucnucoucpu4lu5os5rs}}}"),"Helvetica-Oblique":c("{'widths'{k3p2q4mcx1w201n3r201o6o201s1q201t1q201u1q201w2l201x2l201y2l2k1w2l1w202m2n2n3r2o3r2p5t202q6o2r1n2s2l2t2l2u2r2v3u2w1w2x2l2y1w2z1w3k3r3l3r3m3r3n3r3o3r3p3r3q3r3r3r3s3r203t2l203u2l3v1w3w3u3x3u3y3u3z3r4k6p4l4m4m4m4n4s4o4s4p4m4q3x4r4y4s4s4t1w4u3m4v4m4w3r4x5n4y4s4z4y5k4m5l4y5m4s5n4m5o3x5p4s5q4m5r5y5s4m5t4m5u3x5v1w5w1w5x1w5y2z5z3r6k2l6l3r6m3r6n3m6o3r6p3r6q1w6r3r6s3r6t1q6u1q6v3m6w1q6x5n6y3r6z3r7k3r7l3r7m2l7n3m7o1w7p3r7q3m7r4s7s3m7t3m7u3m7v2l7w1u7x2l7y3u202l3rcl4mal2lam3ran3rao3rap3rar3ras2lat4tau2pav3raw3uay4taz2lbk2sbl3u'fof'6obo2lbp3rbr1wbs2lbu2obv3rbz3xck4m202k3rcm4mcn4mco4mcp4mcq6ocr4scs4mct4mcu4mcv4mcw1w2m2ncy1wcz1wdl4sdm4ydn4ydo4ydp4ydq4yds4ydt4sdu4sdv4sdw4sdz3xek3rel3rem3ren3reo3rep3req5ter3mes3ret3reu3rev3rew1wex1wey1wez1wfl3rfm3rfn3rfo3rfp3rfq3rfr3ufs3xft3rfu3rfv3rfw3rfz3m203k6o212m6o2dw2l2cq2l3t3r3u1w17s4m19m3r}'kerning'{5q{4wv}cl{4qs5kw5ow5qs17sv5tv}201t{2wu4w1k2yu}201x{2wu4wy2yu}17s{2ktclucmucnu4otcpu4lu4wycoucku}2w{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}2x{17sy5ty5oy5qs}2y{7qs4qz5k1m17sy5ow5qx5rsfsu5ty7tufzu}'fof'-6o7p{17sv5tv5ow}ck{4qs5kw5ow5qs17sv5tv}4l{4qs5kw5ow5qs17sv5tv}cm{4qs5kw5ow5qs17sv5tv}cn{4qs5kw5ow5qs17sv5tv}co{4qs5kw5ow5qs17sv5tv}cp{4qs5kw5ow5qs17sv5tv}6l{17sy5ty5ow}do{17st5tt}4z{17st5tt}7s{fst}dm{17st5tt}dn{17st5tt}5o{ckwclwcmwcnwcowcpw4lw4wv}dp{17st5tt}dq{17st5tt}7t{5ow}ds{17st5tt}5t{2ktclucmucnu4otcpu4lu4wycoucku}fu{17sv5tv5ow}6p{17sy5ty5ow5qs}ek{17sy5ty5ow}el{17sy5ty5ow}em{17sy5ty5ow}en{5ty}eo{17sy5ty5ow}ep{17sy5ty5ow}es{17sy5ty5qs}et{17sy5ty5ow5qs}eu{17sy5ty5ow5qs}ev{17sy5ty5ow5qs}6z{17sy5ty5ow5qs}fm{17sy5ty5ow5qs}fn{17sy5ty5ow5qs}fo{17sy5ty5ow5qs}fp{17sy5ty5qs}fq{17sy5ty5ow5qs}7r{5ow}fs{17sy5ty5ow5qs}ft{17sv5tv5ow}7m{5ow}fv{17sv5tv5ow}fw{17sv5tv5ow}}}")}};r.events.push(["addFont",function(m){var u=m.font,w=b.Unicode[u.postScriptName];w&&(u.metadata.Unicode={},u.metadata.Unicode.widths=w.widths,u.metadata.Unicode.kerning=w.kerning);var g=p.Unicode[u.postScriptName];g&&(u.metadata.Unicode.encoding=g,u.encoding=g.codePages[0])}])})(Ut.API),(function(r){var t=function(e){for(var s=e.length,i=new Uint8Array(s),a=0;a<s;a++)i[a]=e.charCodeAt(a);return i};r.API.events.push(["addFont",function(e){var s=void 0,i=e.font,a=e.instance;if(!i.isStandardFont){if(a===void 0)throw new Error("Font does not exist in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");if(typeof(s=a.existsFileInVFS(i.postScriptName)===!1?a.loadFile(i.postScriptName):a.getFileFromVFS(i.postScriptName))!="string")throw new Error("Font is not stored as string-data in vFS, import fonts or remove declaration doc.addFont('"+i.postScriptName+"').");(function(d,o){o=/^\x00\x01\x00\x00/.test(o)?t(o):t(el(o)),d.metadata=r.API.TTFFont.open(o),d.metadata.Unicode=d.metadata.Unicode||{encoding:{},kerning:{},widths:[]},d.metadata.glyIdsUsed=[0]})(i,s)}}])})(Ut),Ut.API.addSvgAsImage=function(r,t,e,s,i,a,d,o){if(isNaN(t)||isNaN(e))throw Ir.error("jsPDF.addSvgAsImage: Invalid coordinates",arguments),new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");if(isNaN(s)||isNaN(i))throw Ir.error("jsPDF.addSvgAsImage: Invalid measurements",arguments),new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");var c=document.createElement("canvas");c.width=s,c.height=i;var h=c.getContext("2d");h.fillStyle="#fff",h.fillRect(0,0,c.width,c.height);var p={ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0},b=this;return(Gt.canvg?Promise.resolve(Gt.canvg):Wl(()=>import("./index.es-C4kvL-gH.js"),__vite__mapDeps([0,1,2,3,4]))).catch(function(m){return Promise.reject(new Error("Could not load canvg: "+m))}).then(function(m){return m.default?m.default:m}).then(function(m){return m.fromString(h,r,p)},function(){return Promise.reject(new Error("Could not load canvg."))}).then(function(m){return m.render(p)}).then(function(){b.addImage(c.toDataURL("image/jpeg",1),t,e,s,i,d,o)})},Ut.API.putTotalPages=function(r){var t,e=0;parseInt(this.internal.getFont().id.substr(1),10)<15?(t=new RegExp(r,"g"),e=this.internal.getNumberOfPages()):(t=new RegExp(this.pdfEscape16(r,this.internal.getFont()),"g"),e=this.pdfEscape16(this.internal.getNumberOfPages()+"",this.internal.getFont()));for(var s=1;s<=this.internal.getNumberOfPages();s++)for(var i=0;i<this.internal.pages[s].length;i++)this.internal.pages[s][i]=this.internal.pages[s][i].replace(t,e);return this},Ut.API.viewerPreferences=function(r,t){var e;r=r||{},t=t||!1;var s,i,a,d={HideToolbar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideMenubar:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},HideWindowUI:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},FitWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},CenterWindow:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.3},DisplayDocTitle:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.4},NonFullScreenPageMode:{defaultValue:"UseNone",value:"UseNone",type:"name",explicitSet:!1,valueSet:["UseNone","UseOutlines","UseThumbs","UseOC"],pdfVersion:1.3},Direction:{defaultValue:"L2R",value:"L2R",type:"name",explicitSet:!1,valueSet:["L2R","R2L"],pdfVersion:1.3},ViewArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},ViewClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintArea:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintClip:{defaultValue:"CropBox",value:"CropBox",type:"name",explicitSet:!1,valueSet:["MediaBox","CropBox","TrimBox","BleedBox","ArtBox"],pdfVersion:1.4},PrintScaling:{defaultValue:"AppDefault",value:"AppDefault",type:"name",explicitSet:!1,valueSet:["AppDefault","None"],pdfVersion:1.6},Duplex:{defaultValue:"",value:"none",type:"name",explicitSet:!1,valueSet:["Simplex","DuplexFlipShortEdge","DuplexFlipLongEdge","none"],pdfVersion:1.7},PickTrayByPDFSize:{defaultValue:!1,value:!1,type:"boolean",explicitSet:!1,valueSet:[!0,!1],pdfVersion:1.7},PrintPageRange:{defaultValue:"",value:"",type:"array",explicitSet:!1,valueSet:null,pdfVersion:1.7},NumCopies:{defaultValue:1,value:1,type:"integer",explicitSet:!1,valueSet:null,pdfVersion:1.7}},o=Object.keys(d),c=[],h=0,p=0,b=0;function m(w,g){var N,y=!1;for(N=0;N<w.length;N+=1)w[N]===g&&(y=!0);return y}if(this.internal.viewerpreferences===void 0&&(this.internal.viewerpreferences={},this.internal.viewerpreferences.configuration=JSON.parse(JSON.stringify(d)),this.internal.viewerpreferences.isSubscribed=!1),e=this.internal.viewerpreferences.configuration,r==="reset"||t===!0){var u=o.length;for(b=0;b<u;b+=1)e[o[b]].value=e[o[b]].defaultValue,e[o[b]].explicitSet=!1}if(Cr(r)==="object"){for(i in r)if(a=r[i],m(o,i)&&a!==void 0){if(e[i].type==="boolean"&&typeof a=="boolean")e[i].value=a;else if(e[i].type==="name"&&m(e[i].valueSet,a))e[i].value=a;else if(e[i].type==="integer"&&Number.isInteger(a))e[i].value=a;else if(e[i].type==="array"){for(h=0;h<a.length;h+=1)if(s=!0,a[h].length===1&&typeof a[h][0]=="number")c.push(String(a[h]-1));else if(a[h].length>1){for(p=0;p<a[h].length;p+=1)typeof a[h][p]!="number"&&(s=!1);s===!0&&c.push([a[h][0]-1,a[h][1]-1].join(" "))}e[i].value="["+c.join(" ")+"]"}else e[i].value=e[i].defaultValue;e[i].explicitSet=!0}}return this.internal.viewerpreferences.isSubscribed===!1&&(this.internal.events.subscribe("putCatalog",function(){var w,g=[];for(w in e)e[w].explicitSet===!0&&(e[w].type==="name"?g.push("/"+w+" /"+e[w].value):g.push("/"+w+" "+e[w].value));g.length!==0&&this.internal.write(`/ViewerPreferences
<<
`+g.join(`
`)+`
>>`)}),this.internal.viewerpreferences.isSubscribed=!0),this.internal.viewerpreferences.configuration=e,this},(function(r){var t=function(){var s='<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:jspdf="'+this.internal.__metadata__.namespaceuri+'"><jspdf:metadata>',i=unescape(encodeURIComponent('<x:xmpmeta xmlns:x="adobe:ns:meta/">')),a=unescape(encodeURIComponent(s)),d=unescape(encodeURIComponent(this.internal.__metadata__.metadata)),o=unescape(encodeURIComponent("</jspdf:metadata></rdf:Description></rdf:RDF>")),c=unescape(encodeURIComponent("</x:xmpmeta>")),h=a.length+d.length+o.length+i.length+c.length;this.internal.__metadata__.metadata_object_number=this.internal.newObject(),this.internal.write("<< /Type /Metadata /Subtype /XML /Length "+h+" >>"),this.internal.write("stream"),this.internal.write(i+a+d+o+c),this.internal.write("endstream"),this.internal.write("endobj")},e=function(){this.internal.__metadata__.metadata_object_number&&this.internal.write("/Metadata "+this.internal.__metadata__.metadata_object_number+" 0 R")};r.addMetadata=function(s,i){return this.internal.__metadata__===void 0&&(this.internal.__metadata__={metadata:s,namespaceuri:i||"http://jspdf.default.namespaceuri/"},this.internal.events.subscribe("putCatalog",e),this.internal.events.subscribe("postPutResources",t)),this}})(Ut.API),(function(r){var t=r.API,e=t.pdfEscape16=function(a,d){for(var o,c=d.metadata.Unicode.widths,h=["","0","00","000","0000"],p=[""],b=0,m=a.length;b<m;++b){if(o=d.metadata.characterToGlyph(a.charCodeAt(b)),d.metadata.glyIdsUsed.push(o),d.metadata.toUnicode[o]=a.charCodeAt(b),c.indexOf(o)==-1&&(c.push(o),c.push([parseInt(d.metadata.widthOfGlyph(o),10)])),o=="0")return p.join("");o=o.toString(16),p.push(h[4-o.length],o)}return p.join("")},s=function(a){var d,o,c,h,p,b,m;for(p=`/CIDInit /ProcSet findresource begin
12 dict begin
begincmap
/CIDSystemInfo <<
  /Registry (Adobe)
  /Ordering (UCS)
  /Supplement 0
>> def
/CMapName /Adobe-Identity-UCS def
/CMapType 2 def
1 begincodespacerange
<0000><ffff>
endcodespacerange`,c=[],b=0,m=(o=Object.keys(a).sort(function(u,w){return u-w})).length;b<m;b++)d=o[b],c.length>=100&&(p+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar`,c=[]),a[d]!==void 0&&a[d]!==null&&typeof a[d].toString=="function"&&(h=("0000"+a[d].toString(16)).slice(-4),d=("0000"+(+d).toString(16)).slice(-4),c.push("<"+d+"><"+h+">"));return c.length&&(p+=`
`+c.length+` beginbfchar
`+c.join(`
`)+`
endbfchar
`),p+`endcmap
CMapName currentdict /CMap defineresource pop
end
end`};t.events.push(["putFont",function(a){(function(d){var o=d.font,c=d.out,h=d.newObject,p=d.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="Identity-H"){for(var b=o.metadata.Unicode.widths,m=o.metadata.subset.encode(o.metadata.glyIdsUsed,1),u="",w=0;w<m.length;w++)u+=String.fromCharCode(m[w]);var g=h();p({data:u,addLength1:!0,objectId:g}),c("endobj");var N=h();p({data:s(o.metadata.toUnicode),addLength1:!0,objectId:N}),c("endobj");var y=h();c("<<"),c("/Type /FontDescriptor"),c("/FontName /"+Ci(o.fontName)),c("/FontFile2 "+g+" 0 R"),c("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),c("/Flags "+o.metadata.flags),c("/StemV "+o.metadata.stemV),c("/ItalicAngle "+o.metadata.italicAngle),c("/Ascent "+o.metadata.ascender),c("/Descent "+o.metadata.decender),c("/CapHeight "+o.metadata.capHeight),c(">>"),c("endobj");var S=h();c("<<"),c("/Type /Font"),c("/BaseFont /"+Ci(o.fontName)),c("/FontDescriptor "+y+" 0 R"),c("/W "+r.API.PDFObject.convert(b)),c("/CIDToGIDMap /Identity"),c("/DW 1000"),c("/Subtype /CIDFontType2"),c("/CIDSystemInfo"),c("<<"),c("/Supplement 0"),c("/Registry (Adobe)"),c("/Ordering ("+o.encoding+")"),c(">>"),c(">>"),c("endobj"),o.objectNumber=h(),c("<<"),c("/Type /Font"),c("/Subtype /Type0"),c("/ToUnicode "+N+" 0 R"),c("/BaseFont /"+Ci(o.fontName)),c("/Encoding /"+o.encoding),c("/DescendantFonts ["+S+" 0 R]"),c(">>"),c("endobj"),o.isAlreadyPutted=!0}})(a)}]),t.events.push(["putFont",function(a){(function(d){var o=d.font,c=d.out,h=d.newObject,p=d.putStream;if(o.metadata instanceof r.API.TTFFont&&o.encoding==="WinAnsiEncoding"){for(var b=o.metadata.rawData,m="",u=0;u<b.length;u++)m+=String.fromCharCode(b[u]);var w=h();p({data:m,addLength1:!0,objectId:w}),c("endobj");var g=h();p({data:s(o.metadata.toUnicode),addLength1:!0,objectId:g}),c("endobj");var N=h();c("<<"),c("/Descent "+o.metadata.decender),c("/CapHeight "+o.metadata.capHeight),c("/StemV "+o.metadata.stemV),c("/Type /FontDescriptor"),c("/FontFile2 "+w+" 0 R"),c("/Flags 96"),c("/FontBBox "+r.API.PDFObject.convert(o.metadata.bbox)),c("/FontName /"+Ci(o.fontName)),c("/ItalicAngle "+o.metadata.italicAngle),c("/Ascent "+o.metadata.ascender),c(">>"),c("endobj"),o.objectNumber=h();for(var y=0;y<o.metadata.hmtx.widths.length;y++)o.metadata.hmtx.widths[y]=parseInt(o.metadata.hmtx.widths[y]*(1e3/o.metadata.head.unitsPerEm));c("<</Subtype/TrueType/Type/Font/ToUnicode "+g+" 0 R/BaseFont/"+Ci(o.fontName)+"/FontDescriptor "+N+" 0 R/Encoding/"+o.encoding+" /FirstChar 29 /LastChar 255 /Widths "+r.API.PDFObject.convert(o.metadata.hmtx.widths)+">>"),c("endobj"),o.isAlreadyPutted=!0}})(a)}]);var i=function(a){var d,o=a.text||"",c=a.x,h=a.y,p=a.options||{},b=a.mutex||{},m=b.pdfEscape,u=b.activeFontKey,w=b.fonts,g=u,N="",y=0,S="",L=w[g].encoding;if(w[g].encoding!=="Identity-H")return{text:o,x:c,y:h,options:p,mutex:b};for(S=o,g=u,Array.isArray(o)&&(S=o[0]),y=0;y<S.length;y+=1)w[g].metadata.hasOwnProperty("cmap")&&(d=w[g].metadata.cmap.unicode.codeMap[S[y].charCodeAt(0)]),d||S[y].charCodeAt(0)<256&&w[g].metadata.hasOwnProperty("Unicode")?N+=S[y]:N+="";var E="";return parseInt(g.slice(1))<14||L==="WinAnsiEncoding"?E=m(N,g).split("").map(function(I){return I.charCodeAt(0).toString(16)}).join(""):L==="Identity-H"&&(E=e(N,w[g])),b.isHex=!0,{text:E,x:c,y:h,options:p,mutex:b}};t.events.push(["postProcessText",function(a){var d=a.text||"",o=[],c={text:d,x:a.x,y:a.y,options:a.options,mutex:a.mutex};if(Array.isArray(d)){var h=0;for(h=0;h<d.length;h+=1)Array.isArray(d[h])&&d[h].length===3?o.push([i(Object.assign({},c,{text:d[h][0]})).text,d[h][1],d[h][2]]):o.push(i(Object.assign({},c,{text:d[h]})).text);a.text=o}else a.text=i(Object.assign({},c,{text:d})).text}])})(Ut),(function(r){var t=function(){return this.internal.vFS===void 0&&(this.internal.vFS={}),!0};r.existsFileInVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0},r.addFileToVFS=function(e,s){return t.call(this),this.internal.vFS[e]=s,this},r.getFileFromVFS=function(e){return t.call(this),this.internal.vFS[e]!==void 0?this.internal.vFS[e]:null}})(Ut.API),(function(r){r.__bidiEngine__=r.prototype.__bidiEngine__=function(s){var i,a,d,o,c,h,p,b=t,m=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],u=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],w={L:0,R:1,EN:2,AN:3,N:4,B:5,S:6},g={0:0,5:1,6:2,7:3,32:4,251:5,254:6,255:7},N=["(",")","(","<",">","<","[","]","[","{","}","{","Â«","Â»","Â«","â€¹","â€º","â€¹","â…","â†","â…","â½","â¾","â½","â‚","â‚Ž","â‚","â‰¤","â‰¥","â‰¤","âŒ©","âŒª","âŒ©","ï¹™","ï¹š","ï¹™","ï¹›","ï¹œ","ï¹›","ï¹","ï¹ž","ï¹","ï¹¤","ï¹¥","ï¹¤"],y=new RegExp(/^([1-4|9]|1[0-9]|2[0-9]|3[0168]|4[04589]|5[012]|7[78]|159|16[0-9]|17[0-2]|21[569]|22[03489]|250)$/),S=!1,L=0;this.__bidiEngine__={};var E=function(F){var k=F.charCodeAt(),M=k>>8,_=g[M];return _!==void 0?b[256*_+(255&k)]:M===252||M===253?"AL":y.test(M)?"L":M===8?"R":"N"},I=function(F){for(var k,M=0;M<F.length;M++){if((k=E(F.charAt(M)))==="L")return!1;if(k==="R")return!0}return!1},K=function(F,k,M,_){var te,ae,re,se,ie=k[_];switch(ie){case"L":case"R":case"LRE":case"RLE":case"LRO":case"RLO":case"PDF":S=!1;break;case"N":case"AN":break;case"EN":S&&(ie="AN");break;case"AL":S=!0,ie="R";break;case"WS":case"BN":ie="N";break;case"CS":_<1||_+1>=k.length||(te=M[_-1])!=="EN"&&te!=="AN"||(ae=k[_+1])!=="EN"&&ae!=="AN"?ie="N":S&&(ae="AN"),ie=ae===te?ae:"N";break;case"ES":ie=(te=_>0?M[_-1]:"B")==="EN"&&_+1<k.length&&k[_+1]==="EN"?"EN":"N";break;case"ET":if(_>0&&M[_-1]==="EN"){ie="EN";break}if(S){ie="N";break}for(re=_+1,se=k.length;re<se&&k[re]==="ET";)re++;ie=re<se&&k[re]==="EN"?"EN":"N";break;case"NSM":if(d&&!o){for(se=k.length,re=_+1;re<se&&k[re]==="NSM";)re++;if(re<se){var je=F[_],ne=je>=1425&&je<=2303||je===64286;if(te=k[re],ne&&(te==="R"||te==="AL")){ie="R";break}}}ie=_<1||(te=k[_-1])==="B"?"N":M[_-1];break;case"B":S=!1,i=!0,ie=L;break;case"S":a=!0,ie="N"}return ie},Y=function(F,k,M){var _=F.split("");return M&&V(_,M,{hiLevel:L}),_.reverse(),k&&k.reverse(),_.join("")},V=function(F,k,M){var _,te,ae,re,se,ie=-1,je=F.length,ne=0,A=[],H=L?u:m,Z=[];for(S=!1,i=!1,a=!1,te=0;te<je;te++)Z[te]=E(F[te]);for(ae=0;ae<je;ae++){if(se=ne,A[ae]=K(F,Z,A,ae),_=240&(ne=H[se][w[A[ae]]]),ne&=15,k[ae]=re=H[ne][5],_>0)if(_===16){for(te=ie;te<ae;te++)k[te]=1;ie=-1}else ie=-1;if(H[ne][6])ie===-1&&(ie=ae);else if(ie>-1){for(te=ie;te<ae;te++)k[te]=re;ie=-1}Z[ae]==="B"&&(k[ae]=0),M.hiLevel|=re}a&&(function(X,pe,ve){for(var ke=0;ke<ve;ke++)if(X[ke]==="S"){pe[ke]=L;for(var Ae=ke-1;Ae>=0&&X[Ae]==="WS";Ae--)pe[Ae]=L}})(Z,k,je)},O=function(F,k,M,_,te){if(!(te.hiLevel<F)){if(F===1&&L===1&&!i)return k.reverse(),void(M&&M.reverse());for(var ae,re,se,ie,je=k.length,ne=0;ne<je;){if(_[ne]>=F){for(se=ne+1;se<je&&_[se]>=F;)se++;for(ie=ne,re=se-1;ie<re;ie++,re--)ae=k[ie],k[ie]=k[re],k[re]=ae,M&&(ae=M[ie],M[ie]=M[re],M[re]=ae);ne=se}ne++}}},Q=function(F,k,M){var _=F.split(""),te={hiLevel:L};return M||(M=[]),V(_,M,te),(function(ae,re,se){if(se.hiLevel!==0&&p)for(var ie,je=0;je<ae.length;je++)re[je]===1&&(ie=N.indexOf(ae[je]))>=0&&(ae[je]=N[ie+1])})(_,M,te),O(2,_,k,M,te),O(1,_,k,M,te),_.join("")};return this.__bidiEngine__.doBidiReorder=function(F,k,M){if((function(te,ae){if(ae)for(var re=0;re<te.length;re++)ae[re]=re;o===void 0&&(o=I(te)),h===void 0&&(h=I(te))})(F,k),d||!c||h)if(d&&c&&o^h)L=o?1:0,F=Y(F,k,M);else if(!d&&c&&h)L=o?1:0,F=Q(F,k,M),F=Y(F,k);else if(!d||o||c||h){if(d&&!c&&o^h)F=Y(F,k),o?(L=0,F=Q(F,k,M)):(L=1,F=Q(F,k,M),F=Y(F,k));else if(d&&o&&!c&&h)L=1,F=Q(F,k,M),F=Y(F,k);else if(!d&&!c&&o^h){var _=p;o?(L=1,F=Q(F,k,M),L=0,p=!1,F=Q(F,k,M),p=_):(L=0,F=Q(F,k,M),F=Y(F,k),L=1,p=!1,F=Q(F,k,M),p=_,F=Y(F,k))}}else L=0,F=Q(F,k,M);else L=o?1:0,F=Q(F,k,M);return F},this.__bidiEngine__.setOptions=function(F){F&&(d=F.isInputVisual,c=F.isOutputVisual,o=F.isInputRtl,h=F.isOutputRtl,p=F.isSymmetricSwapping)},this.__bidiEngine__.setOptions(s),this.__bidiEngine__};var t=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","N","ET","ET","ET","ET","N","N","N","N","L","N","N","BN","N","N","ET","ET","EN","EN","N","L","N","N","N","EN","L","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","L","L","L","L","L","L","L","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","L","N","N","N","N","N","ET","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","NSM","R","NSM","NSM","R","NSM","NSM","R","NSM","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","N","N","N","N","N","R","R","R","R","R","N","N","N","N","N","N","N","N","N","N","N","AN","AN","AN","AN","AN","AN","N","N","AL","ET","ET","AL","CS","AL","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","N","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","N","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","R","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","R","R","N","N","N","N","R","N","N","N","N","N","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","WS","BN","BN","BN","L","R","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","B","LRE","RLE","PDF","LRO","RLO","CS","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","WS","BN","BN","BN","BN","BN","N","LRI","RLI","FSI","PDI","BN","BN","BN","BN","BN","BN","EN","L","N","N","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","L","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","ES","ES","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","N","N","N","N","N","R","NSM","R","R","R","R","R","R","R","R","R","R","ES","R","R","R","R","R","R","R","R","R","R","R","R","R","N","R","R","R","R","R","N","R","N","R","R","N","R","R","N","R","R","R","R","R","R","R","R","R","R","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","CS","N","CS","N","N","CS","N","N","N","N","N","N","N","N","N","ET","N","N","ES","ES","N","N","N","N","N","ET","ET","N","N","N","N","N","AL","AL","AL","AL","AL","N","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","N","N","BN","N","N","N","ET","ET","ET","N","N","N","N","N","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","N","N","N","N","N","N","N","N","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","N","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","L","L","L","N","N","L","L","L","N","N","N","ET","ET","N","N","N","ET","ET","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N"],e=new r.__bidiEngine__({isInputVisual:!0});r.API.events.push(["postProcessText",function(s){var i=s.text;s.x,s.y;var a=s.options||{};s.mutex,a.lang;var d=[];if(a.isInputVisual=typeof a.isInputVisual!="boolean"||a.isInputVisual,e.setOptions(a),Object.prototype.toString.call(i)==="[object Array]"){var o=0;for(d=[],o=0;o<i.length;o+=1)Object.prototype.toString.call(i[o])==="[object Array]"?d.push([e.doBidiReorder(i[o][0]),i[o][1],i[o][2]]):d.push([e.doBidiReorder(i[o])]);s.text=d}else s.text=e.doBidiReorder(i);e.setOptions({isInputVisual:!0})}])})(Ut),Ut.API.TTFFont=(function(){function r(t){var e;if(this.rawData=t,e=this.contents=new qa(t),this.contents.pos=4,e.readString(4)==="ttcf")throw new Error("TTCF not supported.");e.pos=0,this.parse(),this.subset=new C2(this),this.registerTTF()}return r.open=function(t){return new r(t)},r.prototype.parse=function(){return this.directory=new f2(this.contents),this.head=new m2(this),this.name=new w2(this),this.cmap=new Kf(this),this.toUnicode={},this.hhea=new g2(this),this.maxp=new v2(this),this.hmtx=new N2(this),this.post=new y2(this),this.os2=new x2(this),this.loca=new k2(this),this.glyf=new _2(this),this.ascender=this.os2.exists&&this.os2.ascender||this.hhea.ascender,this.decender=this.os2.exists&&this.os2.decender||this.hhea.decender,this.lineGap=this.os2.exists&&this.os2.lineGap||this.hhea.lineGap,this.bbox=[this.head.xMin,this.head.yMin,this.head.xMax,this.head.yMax]},r.prototype.registerTTF=function(){var t,e,s,i,a;if(this.scaleFactor=1e3/this.head.unitsPerEm,this.bbox=(function(){var d,o,c,h;for(h=[],d=0,o=(c=this.bbox).length;d<o;d++)t=c[d],h.push(Math.round(t*this.scaleFactor));return h}).call(this),this.stemV=0,this.post.exists?(s=255&(i=this.post.italic_angle),32768&(e=i>>16)&&(e=-(1+(65535^e))),this.italicAngle=+(e+"."+s)):this.italicAngle=0,this.ascender=Math.round(this.ascender*this.scaleFactor),this.decender=Math.round(this.decender*this.scaleFactor),this.lineGap=Math.round(this.lineGap*this.scaleFactor),this.capHeight=this.os2.exists&&this.os2.capHeight||this.ascender,this.xHeight=this.os2.exists&&this.os2.xHeight||0,this.familyClass=(this.os2.exists&&this.os2.familyClass||0)>>8,this.isSerif=(a=this.familyClass)===1||a===2||a===3||a===4||a===5||a===7,this.isScript=this.familyClass===10,this.flags=0,this.post.isFixedPitch&&(this.flags|=1),this.isSerif&&(this.flags|=2),this.isScript&&(this.flags|=8),this.italicAngle!==0&&(this.flags|=64),this.flags|=32,!this.cmap.unicode)throw new Error("No unicode cmap for font")},r.prototype.characterToGlyph=function(t){var e;return((e=this.cmap.unicode)!=null?e.codeMap[t]:void 0)||0},r.prototype.widthOfGlyph=function(t){var e;return e=1e3/this.head.unitsPerEm,this.hmtx.forGlyph(t).advance*e},r.prototype.widthOfString=function(t,e,s){var i,a,d,o;for(d=0,a=0,o=(t=""+t).length;0<=o?a<o:a>o;a=0<=o?++a:--a)i=t.charCodeAt(a),d+=this.widthOfGlyph(this.characterToGlyph(i))+s*(1e3/e)||0;return d*(e/1e3)},r.prototype.lineHeight=function(t,e){var s;return e==null&&(e=!1),s=e?this.lineGap:0,(this.ascender+s-this.decender)/1e3*t},r})();var $s,qa=(function(){function r(t){this.data=t??[],this.pos=0,this.length=this.data.length}return r.prototype.readByte=function(){return this.data[this.pos++]},r.prototype.writeByte=function(t){return this.data[this.pos++]=t},r.prototype.readUInt32=function(){return 16777216*this.readByte()+(this.readByte()<<16)+(this.readByte()<<8)+this.readByte()},r.prototype.writeUInt32=function(t){return this.writeByte(t>>>24&255),this.writeByte(t>>16&255),this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt32=function(){var t;return(t=this.readUInt32())>=2147483648?t-4294967296:t},r.prototype.writeInt32=function(t){return t<0&&(t+=4294967296),this.writeUInt32(t)},r.prototype.readUInt16=function(){return this.readByte()<<8|this.readByte()},r.prototype.writeUInt16=function(t){return this.writeByte(t>>8&255),this.writeByte(255&t)},r.prototype.readInt16=function(){var t;return(t=this.readUInt16())>=32768?t-65536:t},r.prototype.writeInt16=function(t){return t<0&&(t+=65536),this.writeUInt16(t)},r.prototype.readString=function(t){var e,s;for(s=[],e=0;0<=t?e<t:e>t;e=0<=t?++e:--e)s[e]=String.fromCharCode(this.readByte());return s.join("")},r.prototype.writeString=function(t){var e,s,i;for(i=[],e=0,s=t.length;0<=s?e<s:e>s;e=0<=s?++e:--e)i.push(this.writeByte(t.charCodeAt(e)));return i},r.prototype.readShort=function(){return this.readInt16()},r.prototype.writeShort=function(t){return this.writeInt16(t)},r.prototype.readLongLong=function(){var t,e,s,i,a,d,o,c;return t=this.readByte(),e=this.readByte(),s=this.readByte(),i=this.readByte(),a=this.readByte(),d=this.readByte(),o=this.readByte(),c=this.readByte(),128&t?-1*(72057594037927940*(255^t)+281474976710656*(255^e)+1099511627776*(255^s)+4294967296*(255^i)+16777216*(255^a)+65536*(255^d)+256*(255^o)+(255^c)+1):72057594037927940*t+281474976710656*e+1099511627776*s+4294967296*i+16777216*a+65536*d+256*o+c},r.prototype.writeLongLong=function(t){var e,s;return e=Math.floor(t/4294967296),s=4294967295&t,this.writeByte(e>>24&255),this.writeByte(e>>16&255),this.writeByte(e>>8&255),this.writeByte(255&e),this.writeByte(s>>24&255),this.writeByte(s>>16&255),this.writeByte(s>>8&255),this.writeByte(255&s)},r.prototype.readInt=function(){return this.readInt32()},r.prototype.writeInt=function(t){return this.writeInt32(t)},r.prototype.read=function(t){var e,s;for(e=[],s=0;0<=t?s<t:s>t;s=0<=t?++s:--s)e.push(this.readByte());return e},r.prototype.write=function(t){var e,s,i,a;for(a=[],s=0,i=t.length;s<i;s++)e=t[s],a.push(this.writeByte(e));return a},r})(),f2=(function(){var r;function t(e){var s,i,a;for(this.scalarType=e.readInt(),this.tableCount=e.readShort(),this.searchRange=e.readShort(),this.entrySelector=e.readShort(),this.rangeShift=e.readShort(),this.tables={},i=0,a=this.tableCount;0<=a?i<a:i>a;i=0<=a?++i:--i)s={tag:e.readString(4),checksum:e.readInt(),offset:e.readInt(),length:e.readInt()},this.tables[s.tag]=s}return t.prototype.encode=function(e){var s,i,a,d,o,c,h,p,b,m,u,w,g;for(g in u=Object.keys(e).length,c=Math.log(2),b=16*Math.floor(Math.log(u)/c),d=Math.floor(b/c),p=16*u-b,(i=new qa).writeInt(this.scalarType),i.writeShort(u),i.writeShort(b),i.writeShort(d),i.writeShort(p),a=16*u,h=i.pos+a,o=null,w=[],e)for(m=e[g],i.writeString(g),i.writeInt(r(m)),i.writeInt(h),i.writeInt(m.length),w=w.concat(m),g==="head"&&(o=h),h+=m.length;h%4;)w.push(0),h++;return i.write(w),s=2981146554-r(i.data),i.pos=o+8,i.writeUInt32(s),i.data},r=function(e){var s,i,a,d;for(e=Xf.call(e);e.length%4;)e.push(0);for(a=new qa(e),i=0,s=0,d=e.length;s<d;s=s+=4)i+=a.readUInt32();return 4294967295&i},t})(),p2={}.hasOwnProperty,ra=function(r,t){for(var e in t)p2.call(t,e)&&(r[e]=t[e]);function s(){this.constructor=r}return s.prototype=t.prototype,r.prototype=new s,r.__super__=t.prototype,r};$s=(function(){function r(t){var e;this.file=t,e=this.file.directory.tables[this.tag],this.exists=!!e,e&&(this.offset=e.offset,this.length=e.length,this.parse(this.file.contents))}return r.prototype.parse=function(){},r.prototype.encode=function(){},r.prototype.raw=function(){return this.exists?(this.file.contents.pos=this.offset,this.file.contents.read(this.length)):null},r})();var m2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="head",r.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.revision=t.readInt(),this.checkSumAdjustment=t.readInt(),this.magicNumber=t.readInt(),this.flags=t.readShort(),this.unitsPerEm=t.readShort(),this.created=t.readLongLong(),this.modified=t.readLongLong(),this.xMin=t.readShort(),this.yMin=t.readShort(),this.xMax=t.readShort(),this.yMax=t.readShort(),this.macStyle=t.readShort(),this.lowestRecPPEM=t.readShort(),this.fontDirectionHint=t.readShort(),this.indexToLocFormat=t.readShort(),this.glyphDataFormat=t.readShort()},r.prototype.encode=function(t){var e;return(e=new qa).writeInt(this.version),e.writeInt(this.revision),e.writeInt(this.checkSumAdjustment),e.writeInt(this.magicNumber),e.writeShort(this.flags),e.writeShort(this.unitsPerEm),e.writeLongLong(this.created),e.writeLongLong(this.modified),e.writeShort(this.xMin),e.writeShort(this.yMin),e.writeShort(this.xMax),e.writeShort(this.yMax),e.writeShort(this.macStyle),e.writeShort(this.lowestRecPPEM),e.writeShort(this.fontDirectionHint),e.writeShort(t),e.writeShort(this.glyphDataFormat),e.data},r})(),rh=(function(){function r(t,e){var s,i,a,d,o,c,h,p,b,m,u,w,g,N,y,S,L;switch(this.platformID=t.readUInt16(),this.encodingID=t.readShort(),this.offset=e+t.readInt(),b=t.pos,t.pos=this.offset,this.format=t.readUInt16(),this.length=t.readUInt16(),this.language=t.readUInt16(),this.isUnicode=this.platformID===3&&this.encodingID===1&&this.format===4||this.platformID===0&&this.format===4,this.codeMap={},this.format){case 0:for(c=0;c<256;++c)this.codeMap[c]=t.readByte();break;case 4:for(u=t.readUInt16(),m=u/2,t.pos+=6,a=(function(){var E,I;for(I=[],c=E=0;0<=m?E<m:E>m;c=0<=m?++E:--E)I.push(t.readUInt16());return I})(),t.pos+=2,g=(function(){var E,I;for(I=[],c=E=0;0<=m?E<m:E>m;c=0<=m?++E:--E)I.push(t.readUInt16());return I})(),h=(function(){var E,I;for(I=[],c=E=0;0<=m?E<m:E>m;c=0<=m?++E:--E)I.push(t.readUInt16());return I})(),p=(function(){var E,I;for(I=[],c=E=0;0<=m?E<m:E>m;c=0<=m?++E:--E)I.push(t.readUInt16());return I})(),i=(this.length-t.pos+this.offset)/2,o=(function(){var E,I;for(I=[],c=E=0;0<=i?E<i:E>i;c=0<=i?++E:--E)I.push(t.readUInt16());return I})(),c=y=0,L=a.length;y<L;c=++y)for(N=a[c],s=S=w=g[c];w<=N?S<=N:S>=N;s=w<=N?++S:--S)p[c]===0?d=s+h[c]:(d=o[p[c]/2+(s-w)-(m-c)]||0)!==0&&(d+=h[c]),this.codeMap[s]=65535&d}t.pos=b}return r.encode=function(t,e){var s,i,a,d,o,c,h,p,b,m,u,w,g,N,y,S,L,E,I,K,Y,V,O,Q,F,k,M,_,te,ae,re,se,ie,je,ne,A,H,Z,X,pe,ve,ke,Ae,De,Me,Ke;switch(_=new qa,d=Object.keys(t).sort(function(Se,j){return Se-j}),e){case"macroman":for(g=0,N=(function(){var Se=[];for(w=0;w<256;++w)Se.push(0);return Se})(),S={0:0},a={},te=0,ie=d.length;te<ie;te++)S[Ae=t[i=d[te]]]==null&&(S[Ae]=++g),a[i]={old:t[i],new:S[t[i]]},N[i]=S[t[i]];return _.writeUInt16(1),_.writeUInt16(0),_.writeUInt32(12),_.writeUInt16(0),_.writeUInt16(262),_.writeUInt16(0),_.write(N),{charMap:a,subtable:_.data,maxGlyphID:g+1};case"unicode":for(k=[],b=[],L=0,S={},s={},y=h=null,ae=0,je=d.length;ae<je;ae++)S[I=t[i=d[ae]]]==null&&(S[I]=++L),s[i]={old:I,new:S[I]},o=S[I]-i,y!=null&&o===h||(y&&b.push(y),k.push(i),h=o),y=i;for(y&&b.push(y),b.push(65535),k.push(65535),Q=2*(O=k.length),V=2*Math.pow(Math.log(O)/Math.LN2,2),m=Math.log(V/2)/Math.LN2,Y=2*O-V,c=[],K=[],u=[],w=re=0,ne=k.length;re<ne;w=++re){if(F=k[w],p=b[w],F===65535){c.push(0),K.push(0);break}if(F-(M=s[F].new)>=32768)for(c.push(0),K.push(2*(u.length+O-w)),i=se=F;F<=p?se<=p:se>=p;i=F<=p?++se:--se)u.push(s[i].new);else c.push(M-F),K.push(0)}for(_.writeUInt16(3),_.writeUInt16(1),_.writeUInt32(12),_.writeUInt16(4),_.writeUInt16(16+8*O+2*u.length),_.writeUInt16(0),_.writeUInt16(Q),_.writeUInt16(V),_.writeUInt16(m),_.writeUInt16(Y),ve=0,A=b.length;ve<A;ve++)i=b[ve],_.writeUInt16(i);for(_.writeUInt16(0),ke=0,H=k.length;ke<H;ke++)i=k[ke],_.writeUInt16(i);for(De=0,Z=c.length;De<Z;De++)o=c[De],_.writeUInt16(o);for(Me=0,X=K.length;Me<X;Me++)E=K[Me],_.writeUInt16(E);for(Ke=0,pe=u.length;Ke<pe;Ke++)g=u[Ke],_.writeUInt16(g);return{charMap:s,subtable:_.data,maxGlyphID:L+1}}},r})(),Kf=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="cmap",r.prototype.parse=function(t){var e,s,i;for(t.pos=this.offset,this.version=t.readUInt16(),i=t.readUInt16(),this.tables=[],this.unicode=null,s=0;0<=i?s<i:s>i;s=0<=i?++s:--s)e=new rh(t,this.offset),this.tables.push(e),e.isUnicode&&this.unicode==null&&(this.unicode=e);return!0},r.encode=function(t,e){var s,i;return e==null&&(e="macroman"),s=rh.encode(t,e),(i=new qa).writeUInt16(0),i.writeUInt16(1),s.table=i.data.concat(s.subtable),s},r})(),g2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="hhea",r.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.ascender=t.readShort(),this.decender=t.readShort(),this.lineGap=t.readShort(),this.advanceWidthMax=t.readShort(),this.minLeftSideBearing=t.readShort(),this.minRightSideBearing=t.readShort(),this.xMaxExtent=t.readShort(),this.caretSlopeRise=t.readShort(),this.caretSlopeRun=t.readShort(),this.caretOffset=t.readShort(),t.pos+=8,this.metricDataFormat=t.readShort(),this.numberOfMetrics=t.readUInt16()},r})(),x2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="OS/2",r.prototype.parse=function(t){if(t.pos=this.offset,this.version=t.readUInt16(),this.averageCharWidth=t.readShort(),this.weightClass=t.readUInt16(),this.widthClass=t.readUInt16(),this.type=t.readShort(),this.ySubscriptXSize=t.readShort(),this.ySubscriptYSize=t.readShort(),this.ySubscriptXOffset=t.readShort(),this.ySubscriptYOffset=t.readShort(),this.ySuperscriptXSize=t.readShort(),this.ySuperscriptYSize=t.readShort(),this.ySuperscriptXOffset=t.readShort(),this.ySuperscriptYOffset=t.readShort(),this.yStrikeoutSize=t.readShort(),this.yStrikeoutPosition=t.readShort(),this.familyClass=t.readShort(),this.panose=(function(){var e,s;for(s=[],e=0;e<10;++e)s.push(t.readByte());return s})(),this.charRange=(function(){var e,s;for(s=[],e=0;e<4;++e)s.push(t.readInt());return s})(),this.vendorID=t.readString(4),this.selection=t.readShort(),this.firstCharIndex=t.readShort(),this.lastCharIndex=t.readShort(),this.version>0&&(this.ascent=t.readShort(),this.descent=t.readShort(),this.lineGap=t.readShort(),this.winAscent=t.readShort(),this.winDescent=t.readShort(),this.codePageRange=(function(){var e,s;for(s=[],e=0;e<2;e=++e)s.push(t.readInt());return s})(),this.version>1))return this.xHeight=t.readShort(),this.capHeight=t.readShort(),this.defaultChar=t.readShort(),this.breakChar=t.readShort(),this.maxContext=t.readShort()},r})(),y2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="post",r.prototype.parse=function(t){var e,s,i;switch(t.pos=this.offset,this.format=t.readInt(),this.italicAngle=t.readInt(),this.underlinePosition=t.readShort(),this.underlineThickness=t.readShort(),this.isFixedPitch=t.readInt(),this.minMemType42=t.readInt(),this.maxMemType42=t.readInt(),this.minMemType1=t.readInt(),this.maxMemType1=t.readInt(),this.format){case 65536:case 196608:break;case 131072:var a;for(s=t.readUInt16(),this.glyphNameIndex=[],a=0;0<=s?a<s:a>s;a=0<=s?++a:--a)this.glyphNameIndex.push(t.readUInt16());for(this.names=[],i=[];t.pos<this.offset+this.length;)e=t.readByte(),i.push(this.names.push(t.readString(e)));return i;case 151552:return s=t.readUInt16(),this.offsets=t.read(s);case 262144:return this.map=(function(){var d,o,c;for(c=[],a=d=0,o=this.file.maxp.numGlyphs;0<=o?d<o:d>o;a=0<=o?++d:--d)c.push(t.readUInt32());return c}).call(this)}},r})(),b2=function(r,t){this.raw=r,this.length=r.length,this.platformID=t.platformID,this.encodingID=t.encodingID,this.languageID=t.languageID},w2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="name",r.prototype.parse=function(t){var e,s,i,a,d,o,c,h,p,b,m;for(t.pos=this.offset,t.readShort(),e=t.readShort(),o=t.readShort(),s=[],a=0;0<=e?a<e:a>e;a=0<=e?++a:--a)s.push({platformID:t.readShort(),encodingID:t.readShort(),languageID:t.readShort(),nameID:t.readShort(),length:t.readShort(),offset:this.offset+o+t.readShort()});for(c={},a=p=0,b=s.length;p<b;a=++p)i=s[a],t.pos=i.offset,h=t.readString(i.length),d=new b2(h,i),c[m=i.nameID]==null&&(c[m]=[]),c[i.nameID].push(d);this.strings=c,this.copyright=c[0],this.fontFamily=c[1],this.fontSubfamily=c[2],this.uniqueSubfamily=c[3],this.fontName=c[4],this.version=c[5];try{this.postscriptName=c[6][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}catch{this.postscriptName=c[4][0].raw.replace(/[\x00-\x19\x80-\xff]/g,"")}return this.trademark=c[7],this.manufacturer=c[8],this.designer=c[9],this.description=c[10],this.vendorUrl=c[11],this.designerUrl=c[12],this.license=c[13],this.licenseUrl=c[14],this.preferredFamily=c[15],this.preferredSubfamily=c[17],this.compatibleFull=c[18],this.sampleText=c[19]},r})(),v2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="maxp",r.prototype.parse=function(t){return t.pos=this.offset,this.version=t.readInt(),this.numGlyphs=t.readUInt16(),this.maxPoints=t.readUInt16(),this.maxContours=t.readUInt16(),this.maxCompositePoints=t.readUInt16(),this.maxComponentContours=t.readUInt16(),this.maxZones=t.readUInt16(),this.maxTwilightPoints=t.readUInt16(),this.maxStorage=t.readUInt16(),this.maxFunctionDefs=t.readUInt16(),this.maxInstructionDefs=t.readUInt16(),this.maxStackElements=t.readUInt16(),this.maxSizeOfInstructions=t.readUInt16(),this.maxComponentElements=t.readUInt16(),this.maxComponentDepth=t.readUInt16()},r})(),N2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="hmtx",r.prototype.parse=function(t){var e,s,i,a,d,o,c;for(t.pos=this.offset,this.metrics=[],e=0,o=this.file.hhea.numberOfMetrics;0<=o?e<o:e>o;e=0<=o?++e:--e)this.metrics.push({advance:t.readUInt16(),lsb:t.readInt16()});for(i=this.file.maxp.numGlyphs-this.file.hhea.numberOfMetrics,this.leftSideBearings=(function(){var h,p;for(p=[],e=h=0;0<=i?h<i:h>i;e=0<=i?++h:--h)p.push(t.readInt16());return p})(),this.widths=(function(){var h,p,b,m;for(m=[],h=0,p=(b=this.metrics).length;h<p;h++)a=b[h],m.push(a.advance);return m}).call(this),s=this.widths[this.widths.length-1],c=[],e=d=0;0<=i?d<i:d>i;e=0<=i?++d:--d)c.push(this.widths.push(s));return c},r.prototype.forGlyph=function(t){return t in this.metrics?this.metrics[t]:{advance:this.metrics[this.metrics.length-1].advance,lsb:this.leftSideBearings[t-this.metrics.length]}},r})(),Xf=[].slice,_2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="glyf",r.prototype.parse=function(){return this.cache={}},r.prototype.glyphFor=function(t){var e,s,i,a,d,o,c,h,p,b;return t in this.cache?this.cache[t]:(a=this.file.loca,e=this.file.contents,s=a.indexOf(t),(i=a.lengthOf(t))===0?this.cache[t]=null:(e.pos=this.offset+s,d=(o=new qa(e.read(i))).readShort(),h=o.readShort(),b=o.readShort(),c=o.readShort(),p=o.readShort(),this.cache[t]=d===-1?new S2(o,h,b,c,p):new j2(o,d,h,b,c,p),this.cache[t]))},r.prototype.encode=function(t,e,s){var i,a,d,o,c;for(d=[],a=[],o=0,c=e.length;o<c;o++)i=t[e[o]],a.push(d.length),i&&(d=d.concat(i.encode(s)));return a.push(d.length),{table:d,offsets:a}},r})(),j2=(function(){function r(t,e,s,i,a,d){this.raw=t,this.numberOfContours=e,this.xMin=s,this.yMin=i,this.xMax=a,this.yMax=d,this.compound=!1}return r.prototype.encode=function(){return this.raw.data},r})(),S2=(function(){function r(t,e,s,i,a){var d,o;for(this.raw=t,this.xMin=e,this.yMin=s,this.xMax=i,this.yMax=a,this.compound=!0,this.glyphIDs=[],this.glyphOffsets=[],d=this.raw;o=d.readShort(),this.glyphOffsets.push(d.pos),this.glyphIDs.push(d.readUInt16()),32&o;)d.pos+=1&o?4:2,128&o?d.pos+=8:64&o?d.pos+=4:8&o&&(d.pos+=2)}return r.prototype.encode=function(){var t,e,s;for(e=new qa(Xf.call(this.raw.data)),t=0,s=this.glyphIDs.length;t<s;++t)e.pos=this.glyphOffsets[t];return e.data},r})(),k2=(function(){function r(){return r.__super__.constructor.apply(this,arguments)}return ra(r,$s),r.prototype.tag="loca",r.prototype.parse=function(t){var e,s;return t.pos=this.offset,e=this.file.head.indexToLocFormat,this.offsets=e===0?(function(){var i,a;for(a=[],s=0,i=this.length;s<i;s+=2)a.push(2*t.readUInt16());return a}).call(this):(function(){var i,a;for(a=[],s=0,i=this.length;s<i;s+=4)a.push(t.readUInt32());return a}).call(this)},r.prototype.indexOf=function(t){return this.offsets[t]},r.prototype.lengthOf=function(t){return this.offsets[t+1]-this.offsets[t]},r.prototype.encode=function(t,e){for(var s=new Uint32Array(this.offsets.length),i=0,a=0,d=0;d<s.length;++d)if(s[d]=i,a<e.length&&e[a]==d){++a,s[d]=i;var o=this.offsets[d],c=this.offsets[d+1]-o;c>0&&(i+=c)}for(var h=new Array(4*s.length),p=0;p<s.length;++p)h[4*p+3]=255&s[p],h[4*p+2]=(65280&s[p])>>8,h[4*p+1]=(16711680&s[p])>>16,h[4*p]=(4278190080&s[p])>>24;return h},r})(),C2=(function(){function r(t){this.font=t,this.subset={},this.unicodes={},this.next=33}return r.prototype.generateCmap=function(){var t,e,s,i,a;for(e in i=this.font.cmap.tables[0].codeMap,t={},a=this.subset)s=a[e],t[e]=i[s];return t},r.prototype.glyphsFor=function(t){var e,s,i,a,d,o,c;for(i={},d=0,o=t.length;d<o;d++)i[a=t[d]]=this.font.glyf.glyphFor(a);for(a in e=[],i)(s=i[a])!=null&&s.compound&&e.push.apply(e,s.glyphIDs);if(e.length>0)for(a in c=this.glyphsFor(e))s=c[a],i[a]=s;return i},r.prototype.encode=function(t,e){var s,i,a,d,o,c,h,p,b,m,u,w,g,N,y;for(i in s=Kf.encode(this.generateCmap(),"unicode"),d=this.glyphsFor(t),u={0:0},y=s.charMap)u[(c=y[i]).old]=c.new;for(w in m=s.maxGlyphID,d)w in u||(u[w]=m++);return p=(function(S){var L,E;for(L in E={},S)E[S[L]]=L;return E})(u),b=Object.keys(p).sort(function(S,L){return S-L}),g=(function(){var S,L,E;for(E=[],S=0,L=b.length;S<L;S++)o=b[S],E.push(p[o]);return E})(),a=this.font.glyf.encode(d,g,u),h=this.font.loca.encode(a.offsets,g),N={cmap:this.font.cmap.raw(),glyf:a.table,loca:h,hmtx:this.font.hmtx.raw(),hhea:this.font.hhea.raw(),maxp:this.font.maxp.raw(),post:this.font.post.raw(),name:this.font.name.raw(),head:this.font.head.encode(e)},this.font.os2.exists&&(N["OS/2"]=this.font.os2.raw()),this.font.directory.encode(N)},r})();Ut.API.PDFObject=(function(){var r;function t(){}return r=function(e,s){return(Array(s+1).join("0")+e).slice(-s)},t.convert=function(e){var s,i,a,d;if(Array.isArray(e))return"["+(function(){var o,c,h;for(h=[],o=0,c=e.length;o<c;o++)s=e[o],h.push(t.convert(s));return h})().join(" ")+"]";if(typeof e=="string")return"/"+e;if(e!=null&&e.isString)return"("+e+")";if(e instanceof Date)return"(D:"+r(e.getUTCFullYear(),4)+r(e.getUTCMonth(),2)+r(e.getUTCDate(),2)+r(e.getUTCHours(),2)+r(e.getUTCMinutes(),2)+r(e.getUTCSeconds(),2)+"Z)";if({}.toString.call(e)==="[object Object]"){for(i in a=["<<"],e)d=e[i],a.push("/"+i+" "+t.convert(d));return a.push(">>"),a.join(`
`)}return""+e},t})();function Zo(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var hc={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var nh;function A2(){return nh||(nh=1,(function(r,t){(function(e){r.exports=e()})(function(){return(function e(s,i,a){function d(h,p){if(!i[h]){if(!s[h]){var b=typeof Zo=="function"&&Zo;if(!p&&b)return b(h,!0);if(o)return o(h,!0);var m=new Error("Cannot find module '"+h+"'");throw m.code="MODULE_NOT_FOUND",m}var u=i[h]={exports:{}};s[h][0].call(u.exports,function(w){var g=s[h][1][w];return d(g||w)},u,u.exports,e,s,i,a)}return i[h].exports}for(var o=typeof Zo=="function"&&Zo,c=0;c<a.length;c++)d(a[c]);return d})({1:[function(e,s,i){var a=e("./utils"),d=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(c){for(var h,p,b,m,u,w,g,N=[],y=0,S=c.length,L=S,E=a.getTypeOf(c)!=="string";y<c.length;)L=S-y,b=E?(h=c[y++],p=y<S?c[y++]:0,y<S?c[y++]:0):(h=c.charCodeAt(y++),p=y<S?c.charCodeAt(y++):0,y<S?c.charCodeAt(y++):0),m=h>>2,u=(3&h)<<4|p>>4,w=1<L?(15&p)<<2|b>>6:64,g=2<L?63&b:64,N.push(o.charAt(m)+o.charAt(u)+o.charAt(w)+o.charAt(g));return N.join("")},i.decode=function(c){var h,p,b,m,u,w,g=0,N=0,y="data:";if(c.substr(0,y.length)===y)throw new Error("Invalid base64 input, it looks like a data url.");var S,L=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===o.charAt(64)&&L--,c.charAt(c.length-2)===o.charAt(64)&&L--,L%1!=0)throw new Error("Invalid base64 input, bad content length.");for(S=d.uint8array?new Uint8Array(0|L):new Array(0|L);g<c.length;)h=o.indexOf(c.charAt(g++))<<2|(m=o.indexOf(c.charAt(g++)))>>4,p=(15&m)<<4|(u=o.indexOf(c.charAt(g++)))>>2,b=(3&u)<<6|(w=o.indexOf(c.charAt(g++))),S[N++]=h,u!==64&&(S[N++]=p),w!==64&&(S[N++]=b);return S}},{"./support":30,"./utils":32}],2:[function(e,s,i){var a=e("./external"),d=e("./stream/DataWorker"),o=e("./stream/Crc32Probe"),c=e("./stream/DataLengthProbe");function h(p,b,m,u,w){this.compressedSize=p,this.uncompressedSize=b,this.crc32=m,this.compression=u,this.compressedContent=w}h.prototype={getContentWorker:function(){var p=new d(a.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),b=this;return p.on("end",function(){if(this.streamInfo.data_length!==b.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),p},getCompressedWorker:function(){return new d(a.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},h.createWorkerFrom=function(p,b,m){return p.pipe(new o).pipe(new c("uncompressedSize")).pipe(b.compressWorker(m)).pipe(new c("compressedSize")).withStreamInfo("compression",b)},s.exports=h},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,s,i){var a=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new a("STORE compression")},uncompressWorker:function(){return new a("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,s,i){var a=e("./utils"),d=(function(){for(var o,c=[],h=0;h<256;h++){o=h;for(var p=0;p<8;p++)o=1&o?3988292384^o>>>1:o>>>1;c[h]=o}return c})();s.exports=function(o,c){return o!==void 0&&o.length?a.getTypeOf(o)!=="string"?(function(h,p,b,m){var u=d,w=m+b;h^=-1;for(var g=m;g<w;g++)h=h>>>8^u[255&(h^p[g])];return-1^h})(0|c,o,o.length,0):(function(h,p,b,m){var u=d,w=m+b;h^=-1;for(var g=m;g<w;g++)h=h>>>8^u[255&(h^p.charCodeAt(g))];return-1^h})(0|c,o,o.length,0):0}},{"./utils":32}],5:[function(e,s,i){i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,s,i){var a=null;a=typeof Promise<"u"?Promise:e("lie"),s.exports={Promise:a}},{lie:37}],7:[function(e,s,i){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",d=e("pako"),o=e("./utils"),c=e("./stream/GenericWorker"),h=a?"uint8array":"array";function p(b,m){c.call(this,"FlateWorker/"+b),this._pako=null,this._pakoAction=b,this._pakoOptions=m,this.meta={}}i.magic="\b\0",o.inherits(p,c),p.prototype.processChunk=function(b){this.meta=b.meta,this._pako===null&&this._createPako(),this._pako.push(o.transformTo(h,b.data),!1)},p.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},p.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},p.prototype._createPako=function(){this._pako=new d[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var b=this;this._pako.onData=function(m){b.push({data:m,meta:b.meta})}},i.compressWorker=function(b){return new p("Deflate",b)},i.uncompressWorker=function(){return new p("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(e,s,i){function a(u,w){var g,N="";for(g=0;g<w;g++)N+=String.fromCharCode(255&u),u>>>=8;return N}function d(u,w,g,N,y,S){var L,E,I=u.file,K=u.compression,Y=S!==h.utf8encode,V=o.transformTo("string",S(I.name)),O=o.transformTo("string",h.utf8encode(I.name)),Q=I.comment,F=o.transformTo("string",S(Q)),k=o.transformTo("string",h.utf8encode(Q)),M=O.length!==I.name.length,_=k.length!==Q.length,te="",ae="",re="",se=I.dir,ie=I.date,je={crc32:0,compressedSize:0,uncompressedSize:0};w&&!g||(je.crc32=u.crc32,je.compressedSize=u.compressedSize,je.uncompressedSize=u.uncompressedSize);var ne=0;w&&(ne|=8),Y||!M&&!_||(ne|=2048);var A=0,H=0;se&&(A|=16),y==="UNIX"?(H=798,A|=(function(X,pe){var ve=X;return X||(ve=pe?16893:33204),(65535&ve)<<16})(I.unixPermissions,se)):(H=20,A|=(function(X){return 63&(X||0)})(I.dosPermissions)),L=ie.getUTCHours(),L<<=6,L|=ie.getUTCMinutes(),L<<=5,L|=ie.getUTCSeconds()/2,E=ie.getUTCFullYear()-1980,E<<=4,E|=ie.getUTCMonth()+1,E<<=5,E|=ie.getUTCDate(),M&&(ae=a(1,1)+a(p(V),4)+O,te+="up"+a(ae.length,2)+ae),_&&(re=a(1,1)+a(p(F),4)+k,te+="uc"+a(re.length,2)+re);var Z="";return Z+=`
\0`,Z+=a(ne,2),Z+=K.magic,Z+=a(L,2),Z+=a(E,2),Z+=a(je.crc32,4),Z+=a(je.compressedSize,4),Z+=a(je.uncompressedSize,4),Z+=a(V.length,2),Z+=a(te.length,2),{fileRecord:b.LOCAL_FILE_HEADER+Z+V+te,dirRecord:b.CENTRAL_FILE_HEADER+a(H,2)+Z+a(F.length,2)+"\0\0\0\0"+a(A,4)+a(N,4)+V+te+F}}var o=e("../utils"),c=e("../stream/GenericWorker"),h=e("../utf8"),p=e("../crc32"),b=e("../signature");function m(u,w,g,N){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=w,this.zipPlatform=g,this.encodeFileName=N,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(m,c),m.prototype.push=function(u){var w=u.meta.percent||0,g=this.entriesCount,N=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,c.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:g?(w+100*(g-N-1))/g:100}}))},m.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var w=this.streamFiles&&!u.file.dir;if(w){var g=d(u,w,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:g.fileRecord,meta:{percent:0}})}else this.accumulate=!0},m.prototype.closedSource=function(u){this.accumulate=!1;var w=this.streamFiles&&!u.file.dir,g=d(u,w,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(g.dirRecord),w)this.push({data:(function(N){return b.DATA_DESCRIPTOR+a(N.crc32,4)+a(N.compressedSize,4)+a(N.uncompressedSize,4)})(u),meta:{percent:100}});else for(this.push({data:g.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},m.prototype.flush=function(){for(var u=this.bytesWritten,w=0;w<this.dirRecords.length;w++)this.push({data:this.dirRecords[w],meta:{percent:100}});var g=this.bytesWritten-u,N=(function(y,S,L,E,I){var K=o.transformTo("string",I(E));return b.CENTRAL_DIRECTORY_END+"\0\0\0\0"+a(y,2)+a(y,2)+a(S,4)+a(L,4)+a(K.length,2)+K})(this.dirRecords.length,g,u,this.zipComment,this.encodeFileName);this.push({data:N,meta:{percent:100}})},m.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},m.prototype.registerPrevious=function(u){this._sources.push(u);var w=this;return u.on("data",function(g){w.processChunk(g)}),u.on("end",function(){w.closedSource(w.previous.streamInfo),w._sources.length?w.prepareNextSource():w.end()}),u.on("error",function(g){w.error(g)}),this},m.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},m.prototype.error=function(u){var w=this._sources;if(!c.prototype.error.call(this,u))return!1;for(var g=0;g<w.length;g++)try{w[g].error(u)}catch{}return!0},m.prototype.lock=function(){c.prototype.lock.call(this);for(var u=this._sources,w=0;w<u.length;w++)u[w].lock()},s.exports=m},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,s,i){var a=e("../compressions"),d=e("./ZipFileWorker");i.generateWorker=function(o,c,h){var p=new d(c.streamFiles,h,c.platform,c.encodeFileName),b=0;try{o.forEach(function(m,u){b++;var w=(function(S,L){var E=S||L,I=a[E];if(!I)throw new Error(E+" is not a valid compression method !");return I})(u.options.compression,c.compression),g=u.options.compressionOptions||c.compressionOptions||{},N=u.dir,y=u.date;u._compressWorker(w,g).withStreamInfo("file",{name:m,dir:N,date:y,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(p)}),p.entriesCount=b}catch(m){p.error(m)}return p}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,s,i){function a(){if(!(this instanceof a))return new a;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var d=new a;for(var o in this)typeof this[o]!="function"&&(d[o]=this[o]);return d}}(a.prototype=e("./object")).loadAsync=e("./load"),a.support=e("./support"),a.defaults=e("./defaults"),a.version="3.10.1",a.loadAsync=function(d,o){return new a().loadAsync(d,o)},a.external=e("./external"),s.exports=a},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,s,i){var a=e("./utils"),d=e("./external"),o=e("./utf8"),c=e("./zipEntries"),h=e("./stream/Crc32Probe"),p=e("./nodejsUtils");function b(m){return new d.Promise(function(u,w){var g=m.decompressed.getContentWorker().pipe(new h);g.on("error",function(N){w(N)}).on("end",function(){g.streamInfo.crc32!==m.decompressed.crc32?w(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}s.exports=function(m,u){var w=this;return u=a.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),p.isNode&&p.isStream(m)?d.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):a.prepareContent("the loaded zip file",m,!0,u.optimizedBinaryString,u.base64).then(function(g){var N=new c(u);return N.load(g),N}).then(function(g){var N=[d.Promise.resolve(g)],y=g.files;if(u.checkCRC32)for(var S=0;S<y.length;S++)N.push(b(y[S]));return d.Promise.all(N)}).then(function(g){for(var N=g.shift(),y=N.files,S=0;S<y.length;S++){var L=y[S],E=L.fileNameStr,I=a.resolve(L.fileNameStr);w.file(I,L.decompressed,{binary:!0,optimizedBinaryString:!0,date:L.date,dir:L.dir,comment:L.fileCommentStr.length?L.fileCommentStr:null,unixPermissions:L.unixPermissions,dosPermissions:L.dosPermissions,createFolders:u.createFolders}),L.dir||(w.file(I).unsafeOriginalName=E)}return N.zipComment.length&&(w.comment=N.zipComment),w})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,s,i){var a=e("../utils"),d=e("../stream/GenericWorker");function o(c,h){d.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(h)}a.inherits(o,d),o.prototype._bindStream=function(c){var h=this;(this._stream=c).pause(),c.on("data",function(p){h.push({data:p,meta:{percent:0}})}).on("error",function(p){h.isPaused?this.generatedError=p:h.error(p)}).on("end",function(){h.isPaused?h._upstreamEnded=!0:h.end()})},o.prototype.pause=function(){return!!d.prototype.pause.call(this)&&(this._stream.pause(),!0)},o.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=o},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,s,i){var a=e("readable-stream").Readable;function d(o,c,h){a.call(this,c),this._helper=o;var p=this;o.on("data",function(b,m){p.push(b)||p._helper.pause(),h&&h(m)}).on("error",function(b){p.emit("error",b)}).on("end",function(){p.push(null)})}e("../utils").inherits(d,a),d.prototype._read=function(){this._helper.resume()},s.exports=d},{"../utils":32,"readable-stream":16}],14:[function(e,s,i){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(a,d){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(a,d);if(typeof a=="number")throw new Error('The "data" argument must not be a number');return new Buffer(a,d)},allocBuffer:function(a){if(Buffer.alloc)return Buffer.alloc(a);var d=new Buffer(a);return d.fill(0),d},isBuffer:function(a){return Buffer.isBuffer(a)},isStream:function(a){return a&&typeof a.on=="function"&&typeof a.pause=="function"&&typeof a.resume=="function"}}},{}],15:[function(e,s,i){function a(I,K,Y){var V,O=o.getTypeOf(K),Q=o.extend(Y||{},p);Q.date=Q.date||new Date,Q.compression!==null&&(Q.compression=Q.compression.toUpperCase()),typeof Q.unixPermissions=="string"&&(Q.unixPermissions=parseInt(Q.unixPermissions,8)),Q.unixPermissions&&16384&Q.unixPermissions&&(Q.dir=!0),Q.dosPermissions&&16&Q.dosPermissions&&(Q.dir=!0),Q.dir&&(I=y(I)),Q.createFolders&&(V=N(I))&&S.call(this,V,!0);var F=O==="string"&&Q.binary===!1&&Q.base64===!1;Y&&Y.binary!==void 0||(Q.binary=!F),(K instanceof b&&K.uncompressedSize===0||Q.dir||!K||K.length===0)&&(Q.base64=!1,Q.binary=!0,K="",Q.compression="STORE",O="string");var k=null;k=K instanceof b||K instanceof c?K:w.isNode&&w.isStream(K)?new g(I,K):o.prepareContent(I,K,Q.binary,Q.optimizedBinaryString,Q.base64);var M=new m(I,k,Q);this.files[I]=M}var d=e("./utf8"),o=e("./utils"),c=e("./stream/GenericWorker"),h=e("./stream/StreamHelper"),p=e("./defaults"),b=e("./compressedObject"),m=e("./zipObject"),u=e("./generate"),w=e("./nodejsUtils"),g=e("./nodejs/NodejsStreamInputAdapter"),N=function(I){I.slice(-1)==="/"&&(I=I.substring(0,I.length-1));var K=I.lastIndexOf("/");return 0<K?I.substring(0,K):""},y=function(I){return I.slice(-1)!=="/"&&(I+="/"),I},S=function(I,K){return K=K!==void 0?K:p.createFolders,I=y(I),this.files[I]||a.call(this,I,null,{dir:!0,createFolders:K}),this.files[I]};function L(I){return Object.prototype.toString.call(I)==="[object RegExp]"}var E={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(I){var K,Y,V;for(K in this.files)V=this.files[K],(Y=K.slice(this.root.length,K.length))&&K.slice(0,this.root.length)===this.root&&I(Y,V)},filter:function(I){var K=[];return this.forEach(function(Y,V){I(Y,V)&&K.push(V)}),K},file:function(I,K,Y){if(arguments.length!==1)return I=this.root+I,a.call(this,I,K,Y),this;if(L(I)){var V=I;return this.filter(function(Q,F){return!F.dir&&V.test(Q)})}var O=this.files[this.root+I];return O&&!O.dir?O:null},folder:function(I){if(!I)return this;if(L(I))return this.filter(function(O,Q){return Q.dir&&I.test(O)});var K=this.root+I,Y=S.call(this,K),V=this.clone();return V.root=Y.name,V},remove:function(I){I=this.root+I;var K=this.files[I];if(K||(I.slice(-1)!=="/"&&(I+="/"),K=this.files[I]),K&&!K.dir)delete this.files[I];else for(var Y=this.filter(function(O,Q){return Q.name.slice(0,I.length)===I}),V=0;V<Y.length;V++)delete this.files[Y[V].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(I){var K,Y={};try{if((Y=o.extend(I||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:d.utf8encode})).type=Y.type.toLowerCase(),Y.compression=Y.compression.toUpperCase(),Y.type==="binarystring"&&(Y.type="string"),!Y.type)throw new Error("No output type specified.");o.checkSupport(Y.type),Y.platform!=="darwin"&&Y.platform!=="freebsd"&&Y.platform!=="linux"&&Y.platform!=="sunos"||(Y.platform="UNIX"),Y.platform==="win32"&&(Y.platform="DOS");var V=Y.comment||this.comment||"";K=u.generateWorker(this,Y,V)}catch(O){(K=new c("error")).error(O)}return new h(K,Y.type||"string",Y.mimeType)},generateAsync:function(I,K){return this.generateInternalStream(I).accumulate(K)},generateNodeStream:function(I,K){return(I=I||{}).type||(I.type="nodebuffer"),this.generateInternalStream(I).toNodejsStream(K)}};s.exports=E},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,s,i){s.exports=e("stream")},{stream:void 0}],17:[function(e,s,i){var a=e("./DataReader");function d(o){a.call(this,o);for(var c=0;c<this.data.length;c++)o[c]=255&o[c]}e("../utils").inherits(d,a),d.prototype.byteAt=function(o){return this.data[this.zero+o]},d.prototype.lastIndexOfSignature=function(o){for(var c=o.charCodeAt(0),h=o.charCodeAt(1),p=o.charCodeAt(2),b=o.charCodeAt(3),m=this.length-4;0<=m;--m)if(this.data[m]===c&&this.data[m+1]===h&&this.data[m+2]===p&&this.data[m+3]===b)return m-this.zero;return-1},d.prototype.readAndCheckSignature=function(o){var c=o.charCodeAt(0),h=o.charCodeAt(1),p=o.charCodeAt(2),b=o.charCodeAt(3),m=this.readData(4);return c===m[0]&&h===m[1]&&p===m[2]&&b===m[3]},d.prototype.readData=function(o){if(this.checkOffset(o),o===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},s.exports=d},{"../utils":32,"./DataReader":18}],18:[function(e,s,i){var a=e("../utils");function d(o){this.data=o,this.length=o.length,this.index=0,this.zero=0}d.prototype={checkOffset:function(o){this.checkIndex(this.index+o)},checkIndex:function(o){if(this.length<this.zero+o||o<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+o+"). Corrupted zip ?")},setIndex:function(o){this.checkIndex(o),this.index=o},skip:function(o){this.setIndex(this.index+o)},byteAt:function(){},readInt:function(o){var c,h=0;for(this.checkOffset(o),c=this.index+o-1;c>=this.index;c--)h=(h<<8)+this.byteAt(c);return this.index+=o,h},readString:function(o){return a.transformTo("string",this.readData(o))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var o=this.readInt(4);return new Date(Date.UTC(1980+(o>>25&127),(o>>21&15)-1,o>>16&31,o>>11&31,o>>5&63,(31&o)<<1))}},s.exports=d},{"../utils":32}],19:[function(e,s,i){var a=e("./Uint8ArrayReader");function d(o){a.call(this,o)}e("../utils").inherits(d,a),d.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},s.exports=d},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,s,i){var a=e("./DataReader");function d(o){a.call(this,o)}e("../utils").inherits(d,a),d.prototype.byteAt=function(o){return this.data.charCodeAt(this.zero+o)},d.prototype.lastIndexOfSignature=function(o){return this.data.lastIndexOf(o)-this.zero},d.prototype.readAndCheckSignature=function(o){return o===this.readData(4)},d.prototype.readData=function(o){this.checkOffset(o);var c=this.data.slice(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},s.exports=d},{"../utils":32,"./DataReader":18}],21:[function(e,s,i){var a=e("./ArrayReader");function d(o){a.call(this,o)}e("../utils").inherits(d,a),d.prototype.readData=function(o){if(this.checkOffset(o),o===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+o);return this.index+=o,c},s.exports=d},{"../utils":32,"./ArrayReader":17}],22:[function(e,s,i){var a=e("../utils"),d=e("../support"),o=e("./ArrayReader"),c=e("./StringReader"),h=e("./NodeBufferReader"),p=e("./Uint8ArrayReader");s.exports=function(b){var m=a.getTypeOf(b);return a.checkSupport(m),m!=="string"||d.uint8array?m==="nodebuffer"?new h(b):d.uint8array?new p(a.transformTo("uint8array",b)):new o(a.transformTo("array",b)):new c(b)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,s,i){i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,s,i){var a=e("./GenericWorker"),d=e("../utils");function o(c){a.call(this,"ConvertWorker to "+c),this.destType=c}d.inherits(o,a),o.prototype.processChunk=function(c){this.push({data:d.transformTo(this.destType,c.data),meta:c.meta})},s.exports=o},{"../utils":32,"./GenericWorker":28}],25:[function(e,s,i){var a=e("./GenericWorker"),d=e("../crc32");function o(){a.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}e("../utils").inherits(o,a),o.prototype.processChunk=function(c){this.streamInfo.crc32=d(c.data,this.streamInfo.crc32||0),this.push(c)},s.exports=o},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,s,i){var a=e("../utils"),d=e("./GenericWorker");function o(c){d.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}a.inherits(o,d),o.prototype.processChunk=function(c){if(c){var h=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=h+c.data.length}d.prototype.processChunk.call(this,c)},s.exports=o},{"../utils":32,"./GenericWorker":28}],27:[function(e,s,i){var a=e("../utils"),d=e("./GenericWorker");function o(c){d.call(this,"DataWorker");var h=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(p){h.dataIsReady=!0,h.data=p,h.max=p&&p.length||0,h.type=a.getTypeOf(p),h.isPaused||h._tickAndRepeat()},function(p){h.error(p)})}a.inherits(o,d),o.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this.data=null},o.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,a.delay(this._tickAndRepeat,[],this)),!0)},o.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(a.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},o.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,h=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,h);break;case"uint8array":c=this.data.subarray(this.index,h);break;case"array":case"nodebuffer":c=this.data.slice(this.index,h)}return this.index=h,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=o},{"../utils":32,"./GenericWorker":28}],28:[function(e,s,i){function a(d){this.name=d||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}a.prototype={push:function(d){this.emit("data",d)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(d){this.emit("error",d)}return!0},error:function(d){return!this.isFinished&&(this.isPaused?this.generatedError=d:(this.isFinished=!0,this.emit("error",d),this.previous&&this.previous.error(d),this.cleanUp()),!0)},on:function(d,o){return this._listeners[d].push(o),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(d,o){if(this._listeners[d])for(var c=0;c<this._listeners[d].length;c++)this._listeners[d][c].call(this,o)},pipe:function(d){return d.registerPrevious(this)},registerPrevious:function(d){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=d.streamInfo,this.mergeStreamInfo(),this.previous=d;var o=this;return d.on("data",function(c){o.processChunk(c)}),d.on("end",function(){o.end()}),d.on("error",function(c){o.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var d=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),d=!0),this.previous&&this.previous.resume(),!d},flush:function(){},processChunk:function(d){this.push(d)},withStreamInfo:function(d,o){return this.extraStreamInfo[d]=o,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var d in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,d)&&(this.streamInfo[d]=this.extraStreamInfo[d])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var d="Worker "+this.name;return this.previous?this.previous+" -> "+d:d}},s.exports=a},{}],29:[function(e,s,i){var a=e("../utils"),d=e("./ConvertWorker"),o=e("./GenericWorker"),c=e("../base64"),h=e("../support"),p=e("../external"),b=null;if(h.nodestream)try{b=e("../nodejs/NodejsStreamOutputAdapter")}catch{}function m(w,g){return new p.Promise(function(N,y){var S=[],L=w._internalType,E=w._outputType,I=w._mimeType;w.on("data",function(K,Y){S.push(K),g&&g(Y)}).on("error",function(K){S=[],y(K)}).on("end",function(){try{var K=(function(Y,V,O){switch(Y){case"blob":return a.newBlob(a.transformTo("arraybuffer",V),O);case"base64":return c.encode(V);default:return a.transformTo(Y,V)}})(E,(function(Y,V){var O,Q=0,F=null,k=0;for(O=0;O<V.length;O++)k+=V[O].length;switch(Y){case"string":return V.join("");case"array":return Array.prototype.concat.apply([],V);case"uint8array":for(F=new Uint8Array(k),O=0;O<V.length;O++)F.set(V[O],Q),Q+=V[O].length;return F;case"nodebuffer":return Buffer.concat(V);default:throw new Error("concat : unsupported type '"+Y+"'")}})(L,S),I);N(K)}catch(Y){y(Y)}S=[]}).resume()})}function u(w,g,N){var y=g;switch(g){case"blob":case"arraybuffer":y="uint8array";break;case"base64":y="string"}try{this._internalType=y,this._outputType=g,this._mimeType=N,a.checkSupport(y),this._worker=w.pipe(new d(y)),w.lock()}catch(S){this._worker=new o("error"),this._worker.error(S)}}u.prototype={accumulate:function(w){return m(this,w)},on:function(w,g){var N=this;return w==="data"?this._worker.on(w,function(y){g.call(N,y.data,y.meta)}):this._worker.on(w,function(){a.delay(g,arguments,N)}),this},resume:function(){return a.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(w){if(a.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new b(this,{objectMode:this._outputType!=="nodebuffer"},w)}},s.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,s,i){if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",i.nodebuffer=typeof Buffer<"u",i.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")i.blob=!1;else{var a=new ArrayBuffer(0);try{i.blob=new Blob([a],{type:"application/zip"}).size===0}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);d.append(a),i.blob=d.getBlob("application/zip").size===0}catch{i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch{i.nodestream=!1}},{"readable-stream":16}],31:[function(e,s,i){for(var a=e("./utils"),d=e("./support"),o=e("./nodejsUtils"),c=e("./stream/GenericWorker"),h=new Array(256),p=0;p<256;p++)h[p]=252<=p?6:248<=p?5:240<=p?4:224<=p?3:192<=p?2:1;h[254]=h[254]=1;function b(){c.call(this,"utf-8 decode"),this.leftOver=null}function m(){c.call(this,"utf-8 encode")}i.utf8encode=function(u){return d.nodebuffer?o.newBufferFrom(u,"utf-8"):(function(w){var g,N,y,S,L,E=w.length,I=0;for(S=0;S<E;S++)(64512&(N=w.charCodeAt(S)))==55296&&S+1<E&&(64512&(y=w.charCodeAt(S+1)))==56320&&(N=65536+(N-55296<<10)+(y-56320),S++),I+=N<128?1:N<2048?2:N<65536?3:4;for(g=d.uint8array?new Uint8Array(I):new Array(I),S=L=0;L<I;S++)(64512&(N=w.charCodeAt(S)))==55296&&S+1<E&&(64512&(y=w.charCodeAt(S+1)))==56320&&(N=65536+(N-55296<<10)+(y-56320),S++),N<128?g[L++]=N:(N<2048?g[L++]=192|N>>>6:(N<65536?g[L++]=224|N>>>12:(g[L++]=240|N>>>18,g[L++]=128|N>>>12&63),g[L++]=128|N>>>6&63),g[L++]=128|63&N);return g})(u)},i.utf8decode=function(u){return d.nodebuffer?a.transformTo("nodebuffer",u).toString("utf-8"):(function(w){var g,N,y,S,L=w.length,E=new Array(2*L);for(g=N=0;g<L;)if((y=w[g++])<128)E[N++]=y;else if(4<(S=h[y]))E[N++]=65533,g+=S-1;else{for(y&=S===2?31:S===3?15:7;1<S&&g<L;)y=y<<6|63&w[g++],S--;1<S?E[N++]=65533:y<65536?E[N++]=y:(y-=65536,E[N++]=55296|y>>10&1023,E[N++]=56320|1023&y)}return E.length!==N&&(E.subarray?E=E.subarray(0,N):E.length=N),a.applyFromCharCode(E)})(u=a.transformTo(d.uint8array?"uint8array":"array",u))},a.inherits(b,c),b.prototype.processChunk=function(u){var w=a.transformTo(d.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(d.uint8array){var g=w;(w=new Uint8Array(g.length+this.leftOver.length)).set(this.leftOver,0),w.set(g,this.leftOver.length)}else w=this.leftOver.concat(w);this.leftOver=null}var N=(function(S,L){var E;for((L=L||S.length)>S.length&&(L=S.length),E=L-1;0<=E&&(192&S[E])==128;)E--;return E<0||E===0?L:E+h[S[E]]>L?E:L})(w),y=w;N!==w.length&&(d.uint8array?(y=w.subarray(0,N),this.leftOver=w.subarray(N,w.length)):(y=w.slice(0,N),this.leftOver=w.slice(N,w.length))),this.push({data:i.utf8decode(y),meta:u.meta})},b.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=b,a.inherits(m,c),m.prototype.processChunk=function(u){this.push({data:i.utf8encode(u.data),meta:u.meta})},i.Utf8EncodeWorker=m},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,s,i){var a=e("./support"),d=e("./base64"),o=e("./nodejsUtils"),c=e("./external");function h(g){return g}function p(g,N){for(var y=0;y<g.length;++y)N[y]=255&g.charCodeAt(y);return N}e("setimmediate"),i.newBlob=function(g,N){i.checkSupport("blob");try{return new Blob([g],{type:N})}catch{try{var y=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return y.append(g),y.getBlob(N)}catch{throw new Error("Bug : can't construct the Blob.")}}};var b={stringifyByChunk:function(g,N,y){var S=[],L=0,E=g.length;if(E<=y)return String.fromCharCode.apply(null,g);for(;L<E;)N==="array"||N==="nodebuffer"?S.push(String.fromCharCode.apply(null,g.slice(L,Math.min(L+y,E)))):S.push(String.fromCharCode.apply(null,g.subarray(L,Math.min(L+y,E)))),L+=y;return S.join("")},stringifyByChar:function(g){for(var N="",y=0;y<g.length;y++)N+=String.fromCharCode(g[y]);return N},applyCanBeUsed:{uint8array:(function(){try{return a.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return a.nodebuffer&&String.fromCharCode.apply(null,o.allocBuffer(1)).length===1}catch{return!1}})()}};function m(g){var N=65536,y=i.getTypeOf(g),S=!0;if(y==="uint8array"?S=b.applyCanBeUsed.uint8array:y==="nodebuffer"&&(S=b.applyCanBeUsed.nodebuffer),S)for(;1<N;)try{return b.stringifyByChunk(g,y,N)}catch{N=Math.floor(N/2)}return b.stringifyByChar(g)}function u(g,N){for(var y=0;y<g.length;y++)N[y]=g[y];return N}i.applyFromCharCode=m;var w={};w.string={string:h,array:function(g){return p(g,new Array(g.length))},arraybuffer:function(g){return w.string.uint8array(g).buffer},uint8array:function(g){return p(g,new Uint8Array(g.length))},nodebuffer:function(g){return p(g,o.allocBuffer(g.length))}},w.array={string:m,array:h,arraybuffer:function(g){return new Uint8Array(g).buffer},uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(g)}},w.arraybuffer={string:function(g){return m(new Uint8Array(g))},array:function(g){return u(new Uint8Array(g),new Array(g.byteLength))},arraybuffer:h,uint8array:function(g){return new Uint8Array(g)},nodebuffer:function(g){return o.newBufferFrom(new Uint8Array(g))}},w.uint8array={string:m,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return g.buffer},uint8array:h,nodebuffer:function(g){return o.newBufferFrom(g)}},w.nodebuffer={string:m,array:function(g){return u(g,new Array(g.length))},arraybuffer:function(g){return w.nodebuffer.uint8array(g).buffer},uint8array:function(g){return u(g,new Uint8Array(g.length))},nodebuffer:h},i.transformTo=function(g,N){if(N=N||"",!g)return N;i.checkSupport(g);var y=i.getTypeOf(N);return w[y][g](N)},i.resolve=function(g){for(var N=g.split("/"),y=[],S=0;S<N.length;S++){var L=N[S];L==="."||L===""&&S!==0&&S!==N.length-1||(L===".."?y.pop():y.push(L))}return y.join("/")},i.getTypeOf=function(g){return typeof g=="string"?"string":Object.prototype.toString.call(g)==="[object Array]"?"array":a.nodebuffer&&o.isBuffer(g)?"nodebuffer":a.uint8array&&g instanceof Uint8Array?"uint8array":a.arraybuffer&&g instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(g){if(!a[g.toLowerCase()])throw new Error(g+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(g){var N,y,S="";for(y=0;y<(g||"").length;y++)S+="\\x"+((N=g.charCodeAt(y))<16?"0":"")+N.toString(16).toUpperCase();return S},i.delay=function(g,N,y){setImmediate(function(){g.apply(y||null,N||[])})},i.inherits=function(g,N){function y(){}y.prototype=N.prototype,g.prototype=new y},i.extend=function(){var g,N,y={};for(g=0;g<arguments.length;g++)for(N in arguments[g])Object.prototype.hasOwnProperty.call(arguments[g],N)&&y[N]===void 0&&(y[N]=arguments[g][N]);return y},i.prepareContent=function(g,N,y,S,L){return c.Promise.resolve(N).then(function(E){return a.blob&&(E instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(E))!==-1)&&typeof FileReader<"u"?new c.Promise(function(I,K){var Y=new FileReader;Y.onload=function(V){I(V.target.result)},Y.onerror=function(V){K(V.target.error)},Y.readAsArrayBuffer(E)}):E}).then(function(E){var I=i.getTypeOf(E);return I?(I==="arraybuffer"?E=i.transformTo("uint8array",E):I==="string"&&(L?E=d.decode(E):y&&S!==!0&&(E=(function(K){return p(K,a.uint8array?new Uint8Array(K.length):new Array(K.length))})(E))),E):c.Promise.reject(new Error("Can't read the data of '"+g+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(e,s,i){var a=e("./reader/readerFor"),d=e("./utils"),o=e("./signature"),c=e("./zipEntry"),h=e("./support");function p(b){this.files=[],this.loadOptions=b}p.prototype={checkSignature:function(b){if(!this.reader.readAndCheckSignature(b)){this.reader.index-=4;var m=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+d.pretty(m)+", expected "+d.pretty(b)+")")}},isSignature:function(b,m){var u=this.reader.index;this.reader.setIndex(b);var w=this.reader.readString(4)===m;return this.reader.setIndex(u),w},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var b=this.reader.readData(this.zipCommentLength),m=h.uint8array?"uint8array":"array",u=d.transformTo(m,b);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var b,m,u,w=this.zip64EndOfCentralSize-44;0<w;)b=this.reader.readInt(2),m=this.reader.readInt(4),u=this.reader.readData(m),this.zip64ExtensibleData[b]={id:b,length:m,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var b,m;for(b=0;b<this.files.length;b++)m=this.files[b],this.reader.setIndex(m.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),m.readLocalPart(this.reader),m.handleUTF8(),m.processAttributes()},readCentralDir:function(){var b;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(b=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(b);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var b=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(b<0)throw this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(b);var m=b;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===d.MAX_VALUE_16BITS||this.diskWithCentralDirStart===d.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===d.MAX_VALUE_16BITS||this.centralDirRecords===d.MAX_VALUE_16BITS||this.centralDirSize===d.MAX_VALUE_32BITS||this.centralDirOffset===d.MAX_VALUE_32BITS){if(this.zip64=!0,(b=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(b),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var w=m-u;if(0<w)this.isSignature(m,o.CENTRAL_FILE_HEADER)||(this.reader.zero=w);else if(w<0)throw new Error("Corrupted zip: missing "+Math.abs(w)+" bytes.")},prepareReader:function(b){this.reader=a(b)},load:function(b){this.prepareReader(b),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=p},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(e,s,i){var a=e("./reader/readerFor"),d=e("./utils"),o=e("./compressedObject"),c=e("./crc32"),h=e("./utf8"),p=e("./compressions"),b=e("./support");function m(u,w){this.options=u,this.loadOptions=w}m.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var w,g;if(u.skip(22),this.fileNameLength=u.readInt(2),g=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(g),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((w=(function(N){for(var y in p)if(Object.prototype.hasOwnProperty.call(p,y)&&p[y].magic===N)return p[y];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+d.pretty(this.compressionMethod)+" unknown (inner file : "+d.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,w,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var w=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(w),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=a(this.extraFields[1].value);this.uncompressedSize===d.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===d.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===d.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===d.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var w,g,N,y=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<y;)w=u.readInt(2),g=u.readInt(2),N=u.readData(g),this.extraFields[w]={id:w,length:g,value:N};u.setIndex(y)},handleUTF8:function(){var u=b.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=h.utf8decode(this.fileName),this.fileCommentStr=h.utf8decode(this.fileComment);else{var w=this.findExtraFieldUnicodePath();if(w!==null)this.fileNameStr=w;else{var g=d.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(g)}var N=this.findExtraFieldUnicodeComment();if(N!==null)this.fileCommentStr=N;else{var y=d.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(y)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var w=a(u.value);return w.readInt(1)!==1||c(this.fileName)!==w.readInt(4)?null:h.utf8decode(w.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var w=a(u.value);return w.readInt(1)!==1||c(this.fileComment)!==w.readInt(4)?null:h.utf8decode(w.readData(u.length-5))}return null}},s.exports=m},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,s,i){function a(w,g,N){this.name=w,this.dir=N.dir,this.date=N.date,this.comment=N.comment,this.unixPermissions=N.unixPermissions,this.dosPermissions=N.dosPermissions,this._data=g,this._dataBinary=N.binary,this.options={compression:N.compression,compressionOptions:N.compressionOptions}}var d=e("./stream/StreamHelper"),o=e("./stream/DataWorker"),c=e("./utf8"),h=e("./compressedObject"),p=e("./stream/GenericWorker");a.prototype={internalStream:function(w){var g=null,N="string";try{if(!w)throw new Error("No output type specified.");var y=(N=w.toLowerCase())==="string"||N==="text";N!=="binarystring"&&N!=="text"||(N="string"),g=this._decompressWorker();var S=!this._dataBinary;S&&!y&&(g=g.pipe(new c.Utf8EncodeWorker)),!S&&y&&(g=g.pipe(new c.Utf8DecodeWorker))}catch(L){(g=new p("error")).error(L)}return new d(g,N,"")},async:function(w,g){return this.internalStream(w).accumulate(g)},nodeStream:function(w,g){return this.internalStream(w||"nodebuffer").toNodejsStream(g)},_compressWorker:function(w,g){if(this._data instanceof h&&this._data.compression.magic===w.magic)return this._data.getCompressedWorker();var N=this._decompressWorker();return this._dataBinary||(N=N.pipe(new c.Utf8EncodeWorker)),h.createWorkerFrom(N,w,g)},_decompressWorker:function(){return this._data instanceof h?this._data.getContentWorker():this._data instanceof p?this._data:new o(this._data)}};for(var b=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],m=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<b.length;u++)a.prototype[b[u]]=m;s.exports=a},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,s,i){(function(a){var d,o,c=a.MutationObserver||a.WebKitMutationObserver;if(c){var h=0,p=new c(w),b=a.document.createTextNode("");p.observe(b,{characterData:!0}),d=function(){b.data=h=++h%2}}else if(a.setImmediate||a.MessageChannel===void 0)d="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var g=a.document.createElement("script");g.onreadystatechange=function(){w(),g.onreadystatechange=null,g.parentNode.removeChild(g),g=null},a.document.documentElement.appendChild(g)}:function(){setTimeout(w,0)};else{var m=new a.MessageChannel;m.port1.onmessage=w,d=function(){m.port2.postMessage(0)}}var u=[];function w(){var g,N;o=!0;for(var y=u.length;y;){for(N=u,u=[],g=-1;++g<y;)N[g]();y=u.length}o=!1}s.exports=function(g){u.push(g)!==1||o||d()}}).call(this,typeof Ro<"u"?Ro:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(e,s,i){var a=e("immediate");function d(){}var o={},c=["REJECTED"],h=["FULFILLED"],p=["PENDING"];function b(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=p,this.queue=[],this.outcome=void 0,y!==d&&g(this,y)}function m(y,S,L){this.promise=y,typeof S=="function"&&(this.onFulfilled=S,this.callFulfilled=this.otherCallFulfilled),typeof L=="function"&&(this.onRejected=L,this.callRejected=this.otherCallRejected)}function u(y,S,L){a(function(){var E;try{E=S(L)}catch(I){return o.reject(y,I)}E===y?o.reject(y,new TypeError("Cannot resolve promise with itself")):o.resolve(y,E)})}function w(y){var S=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof S=="function")return function(){S.apply(y,arguments)}}function g(y,S){var L=!1;function E(Y){L||(L=!0,o.reject(y,Y))}function I(Y){L||(L=!0,o.resolve(y,Y))}var K=N(function(){S(I,E)});K.status==="error"&&E(K.value)}function N(y,S){var L={};try{L.value=y(S),L.status="success"}catch(E){L.status="error",L.value=E}return L}(s.exports=b).prototype.finally=function(y){if(typeof y!="function")return this;var S=this.constructor;return this.then(function(L){return S.resolve(y()).then(function(){return L})},function(L){return S.resolve(y()).then(function(){throw L})})},b.prototype.catch=function(y){return this.then(null,y)},b.prototype.then=function(y,S){if(typeof y!="function"&&this.state===h||typeof S!="function"&&this.state===c)return this;var L=new this.constructor(d);return this.state!==p?u(L,this.state===h?y:S,this.outcome):this.queue.push(new m(L,y,S)),L},m.prototype.callFulfilled=function(y){o.resolve(this.promise,y)},m.prototype.otherCallFulfilled=function(y){u(this.promise,this.onFulfilled,y)},m.prototype.callRejected=function(y){o.reject(this.promise,y)},m.prototype.otherCallRejected=function(y){u(this.promise,this.onRejected,y)},o.resolve=function(y,S){var L=N(w,S);if(L.status==="error")return o.reject(y,L.value);var E=L.value;if(E)g(y,E);else{y.state=h,y.outcome=S;for(var I=-1,K=y.queue.length;++I<K;)y.queue[I].callFulfilled(S)}return y},o.reject=function(y,S){y.state=c,y.outcome=S;for(var L=-1,E=y.queue.length;++L<E;)y.queue[L].callRejected(S);return y},b.resolve=function(y){return y instanceof this?y:o.resolve(new this(d),y)},b.reject=function(y){var S=new this(d);return o.reject(S,y)},b.all=function(y){var S=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=y.length,E=!1;if(!L)return this.resolve([]);for(var I=new Array(L),K=0,Y=-1,V=new this(d);++Y<L;)O(y[Y],Y);return V;function O(Q,F){S.resolve(Q).then(function(k){I[F]=k,++K!==L||E||(E=!0,o.resolve(V,I))},function(k){E||(E=!0,o.reject(V,k))})}},b.race=function(y){var S=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var L=y.length,E=!1;if(!L)return this.resolve([]);for(var I=-1,K=new this(d);++I<L;)Y=y[I],S.resolve(Y).then(function(V){E||(E=!0,o.resolve(K,V))},function(V){E||(E=!0,o.reject(K,V))});var Y;return K}},{immediate:36}],38:[function(e,s,i){var a={};(0,e("./lib/utils/common").assign)(a,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),s.exports=a},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(e,s,i){var a=e("./zlib/deflate"),d=e("./utils/common"),o=e("./utils/strings"),c=e("./zlib/messages"),h=e("./zlib/zstream"),p=Object.prototype.toString,b=0,m=-1,u=0,w=8;function g(y){if(!(this instanceof g))return new g(y);this.options=d.assign({level:m,method:w,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},y||{});var S=this.options;S.raw&&0<S.windowBits?S.windowBits=-S.windowBits:S.gzip&&0<S.windowBits&&S.windowBits<16&&(S.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var L=a.deflateInit2(this.strm,S.level,S.method,S.windowBits,S.memLevel,S.strategy);if(L!==b)throw new Error(c[L]);if(S.header&&a.deflateSetHeader(this.strm,S.header),S.dictionary){var E;if(E=typeof S.dictionary=="string"?o.string2buf(S.dictionary):p.call(S.dictionary)==="[object ArrayBuffer]"?new Uint8Array(S.dictionary):S.dictionary,(L=a.deflateSetDictionary(this.strm,E))!==b)throw new Error(c[L]);this._dict_set=!0}}function N(y,S){var L=new g(S);if(L.push(y,!0),L.err)throw L.msg||c[L.err];return L.result}g.prototype.push=function(y,S){var L,E,I=this.strm,K=this.options.chunkSize;if(this.ended)return!1;E=S===~~S?S:S===!0?4:0,typeof y=="string"?I.input=o.string2buf(y):p.call(y)==="[object ArrayBuffer]"?I.input=new Uint8Array(y):I.input=y,I.next_in=0,I.avail_in=I.input.length;do{if(I.avail_out===0&&(I.output=new d.Buf8(K),I.next_out=0,I.avail_out=K),(L=a.deflate(I,E))!==1&&L!==b)return this.onEnd(L),!(this.ended=!0);I.avail_out!==0&&(I.avail_in!==0||E!==4&&E!==2)||(this.options.to==="string"?this.onData(o.buf2binstring(d.shrinkBuf(I.output,I.next_out))):this.onData(d.shrinkBuf(I.output,I.next_out)))}while((0<I.avail_in||I.avail_out===0)&&L!==1);return E===4?(L=a.deflateEnd(this.strm),this.onEnd(L),this.ended=!0,L===b):E!==2||(this.onEnd(b),!(I.avail_out=0))},g.prototype.onData=function(y){this.chunks.push(y)},g.prototype.onEnd=function(y){y===b&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=y,this.msg=this.strm.msg},i.Deflate=g,i.deflate=N,i.deflateRaw=function(y,S){return(S=S||{}).raw=!0,N(y,S)},i.gzip=function(y,S){return(S=S||{}).gzip=!0,N(y,S)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(e,s,i){var a=e("./zlib/inflate"),d=e("./utils/common"),o=e("./utils/strings"),c=e("./zlib/constants"),h=e("./zlib/messages"),p=e("./zlib/zstream"),b=e("./zlib/gzheader"),m=Object.prototype.toString;function u(g){if(!(this instanceof u))return new u(g);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},g||{});var N=this.options;N.raw&&0<=N.windowBits&&N.windowBits<16&&(N.windowBits=-N.windowBits,N.windowBits===0&&(N.windowBits=-15)),!(0<=N.windowBits&&N.windowBits<16)||g&&g.windowBits||(N.windowBits+=32),15<N.windowBits&&N.windowBits<48&&(15&N.windowBits)==0&&(N.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new p,this.strm.avail_out=0;var y=a.inflateInit2(this.strm,N.windowBits);if(y!==c.Z_OK)throw new Error(h[y]);this.header=new b,a.inflateGetHeader(this.strm,this.header)}function w(g,N){var y=new u(N);if(y.push(g,!0),y.err)throw y.msg||h[y.err];return y.result}u.prototype.push=function(g,N){var y,S,L,E,I,K,Y=this.strm,V=this.options.chunkSize,O=this.options.dictionary,Q=!1;if(this.ended)return!1;S=N===~~N?N:N===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof g=="string"?Y.input=o.binstring2buf(g):m.call(g)==="[object ArrayBuffer]"?Y.input=new Uint8Array(g):Y.input=g,Y.next_in=0,Y.avail_in=Y.input.length;do{if(Y.avail_out===0&&(Y.output=new d.Buf8(V),Y.next_out=0,Y.avail_out=V),(y=a.inflate(Y,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&O&&(K=typeof O=="string"?o.string2buf(O):m.call(O)==="[object ArrayBuffer]"?new Uint8Array(O):O,y=a.inflateSetDictionary(this.strm,K)),y===c.Z_BUF_ERROR&&Q===!0&&(y=c.Z_OK,Q=!1),y!==c.Z_STREAM_END&&y!==c.Z_OK)return this.onEnd(y),!(this.ended=!0);Y.next_out&&(Y.avail_out!==0&&y!==c.Z_STREAM_END&&(Y.avail_in!==0||S!==c.Z_FINISH&&S!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(L=o.utf8border(Y.output,Y.next_out),E=Y.next_out-L,I=o.buf2string(Y.output,L),Y.next_out=E,Y.avail_out=V-E,E&&d.arraySet(Y.output,Y.output,L,E,0),this.onData(I)):this.onData(d.shrinkBuf(Y.output,Y.next_out)))),Y.avail_in===0&&Y.avail_out===0&&(Q=!0)}while((0<Y.avail_in||Y.avail_out===0)&&y!==c.Z_STREAM_END);return y===c.Z_STREAM_END&&(S=c.Z_FINISH),S===c.Z_FINISH?(y=a.inflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c.Z_OK):S!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(Y.avail_out=0))},u.prototype.onData=function(g){this.chunks.push(g)},u.prototype.onEnd=function(g){g===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},i.Inflate=u,i.inflate=w,i.inflateRaw=function(g,N){return(N=N||{}).raw=!0,w(g,N)},i.ungzip=w},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(e,s,i){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(c){for(var h=Array.prototype.slice.call(arguments,1);h.length;){var p=h.shift();if(p){if(typeof p!="object")throw new TypeError(p+"must be non-object");for(var b in p)p.hasOwnProperty(b)&&(c[b]=p[b])}}return c},i.shrinkBuf=function(c,h){return c.length===h?c:c.subarray?c.subarray(0,h):(c.length=h,c)};var d={arraySet:function(c,h,p,b,m){if(h.subarray&&c.subarray)c.set(h.subarray(p,p+b),m);else for(var u=0;u<b;u++)c[m+u]=h[p+u]},flattenChunks:function(c){var h,p,b,m,u,w;for(h=b=0,p=c.length;h<p;h++)b+=c[h].length;for(w=new Uint8Array(b),h=m=0,p=c.length;h<p;h++)u=c[h],w.set(u,m),m+=u.length;return w}},o={arraySet:function(c,h,p,b,m){for(var u=0;u<b;u++)c[m+u]=h[p+u]},flattenChunks:function(c){return[].concat.apply([],c)}};i.setTyped=function(c){c?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,d)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(a)},{}],42:[function(e,s,i){var a=e("./common"),d=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch{d=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{o=!1}for(var c=new a.Buf8(256),h=0;h<256;h++)c[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function p(b,m){if(m<65537&&(b.subarray&&o||!b.subarray&&d))return String.fromCharCode.apply(null,a.shrinkBuf(b,m));for(var u="",w=0;w<m;w++)u+=String.fromCharCode(b[w]);return u}c[254]=c[254]=1,i.string2buf=function(b){var m,u,w,g,N,y=b.length,S=0;for(g=0;g<y;g++)(64512&(u=b.charCodeAt(g)))==55296&&g+1<y&&(64512&(w=b.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(w-56320),g++),S+=u<128?1:u<2048?2:u<65536?3:4;for(m=new a.Buf8(S),g=N=0;N<S;g++)(64512&(u=b.charCodeAt(g)))==55296&&g+1<y&&(64512&(w=b.charCodeAt(g+1)))==56320&&(u=65536+(u-55296<<10)+(w-56320),g++),u<128?m[N++]=u:(u<2048?m[N++]=192|u>>>6:(u<65536?m[N++]=224|u>>>12:(m[N++]=240|u>>>18,m[N++]=128|u>>>12&63),m[N++]=128|u>>>6&63),m[N++]=128|63&u);return m},i.buf2binstring=function(b){return p(b,b.length)},i.binstring2buf=function(b){for(var m=new a.Buf8(b.length),u=0,w=m.length;u<w;u++)m[u]=b.charCodeAt(u);return m},i.buf2string=function(b,m){var u,w,g,N,y=m||b.length,S=new Array(2*y);for(u=w=0;u<y;)if((g=b[u++])<128)S[w++]=g;else if(4<(N=c[g]))S[w++]=65533,u+=N-1;else{for(g&=N===2?31:N===3?15:7;1<N&&u<y;)g=g<<6|63&b[u++],N--;1<N?S[w++]=65533:g<65536?S[w++]=g:(g-=65536,S[w++]=55296|g>>10&1023,S[w++]=56320|1023&g)}return p(S,w)},i.utf8border=function(b,m){var u;for((m=m||b.length)>b.length&&(m=b.length),u=m-1;0<=u&&(192&b[u])==128;)u--;return u<0||u===0?m:u+c[b[u]]>m?u:m}},{"./common":41}],43:[function(e,s,i){s.exports=function(a,d,o,c){for(var h=65535&a|0,p=a>>>16&65535|0,b=0;o!==0;){for(o-=b=2e3<o?2e3:o;p=p+(h=h+d[c++]|0)|0,--b;);h%=65521,p%=65521}return h|p<<16|0}},{}],44:[function(e,s,i){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(e,s,i){var a=(function(){for(var d,o=[],c=0;c<256;c++){d=c;for(var h=0;h<8;h++)d=1&d?3988292384^d>>>1:d>>>1;o[c]=d}return o})();s.exports=function(d,o,c,h){var p=a,b=h+c;d^=-1;for(var m=h;m<b;m++)d=d>>>8^p[255&(d^o[m])];return-1^d}},{}],46:[function(e,s,i){var a,d=e("../utils/common"),o=e("./trees"),c=e("./adler32"),h=e("./crc32"),p=e("./messages"),b=0,m=4,u=0,w=-2,g=-1,N=4,y=2,S=8,L=9,E=286,I=30,K=19,Y=2*E+1,V=15,O=3,Q=258,F=Q+O+1,k=42,M=113,_=1,te=2,ae=3,re=4;function se(j,P){return j.msg=p[P],P}function ie(j){return(j<<1)-(4<j?9:0)}function je(j){for(var P=j.length;0<=--P;)j[P]=0}function ne(j){var P=j.state,G=P.pending;G>j.avail_out&&(G=j.avail_out),G!==0&&(d.arraySet(j.output,P.pending_buf,P.pending_out,G,j.next_out),j.next_out+=G,P.pending_out+=G,j.total_out+=G,j.avail_out-=G,P.pending-=G,P.pending===0&&(P.pending_out=0))}function A(j,P){o._tr_flush_block(j,0<=j.block_start?j.block_start:-1,j.strstart-j.block_start,P),j.block_start=j.strstart,ne(j.strm)}function H(j,P){j.pending_buf[j.pending++]=P}function Z(j,P){j.pending_buf[j.pending++]=P>>>8&255,j.pending_buf[j.pending++]=255&P}function X(j,P){var G,$,z=j.max_chain_length,B=j.strstart,he=j.prev_length,me=j.nice_match,de=j.strstart>j.w_size-F?j.strstart-(j.w_size-F):0,Le=j.window,Ie=j.w_mask,Te=j.prev,Ye=j.strstart+Q,ft=Le[B+he-1],at=Le[B+he];j.prev_length>=j.good_match&&(z>>=2),me>j.lookahead&&(me=j.lookahead);do if(Le[(G=P)+he]===at&&Le[G+he-1]===ft&&Le[G]===Le[B]&&Le[++G]===Le[B+1]){B+=2,G++;do;while(Le[++B]===Le[++G]&&Le[++B]===Le[++G]&&Le[++B]===Le[++G]&&Le[++B]===Le[++G]&&Le[++B]===Le[++G]&&Le[++B]===Le[++G]&&Le[++B]===Le[++G]&&Le[++B]===Le[++G]&&B<Ye);if($=Q-(Ye-B),B=Ye-Q,he<$){if(j.match_start=P,me<=(he=$))break;ft=Le[B+he-1],at=Le[B+he]}}while((P=Te[P&Ie])>de&&--z!=0);return he<=j.lookahead?he:j.lookahead}function pe(j){var P,G,$,z,B,he,me,de,Le,Ie,Te=j.w_size;do{if(z=j.window_size-j.lookahead-j.strstart,j.strstart>=Te+(Te-F)){for(d.arraySet(j.window,j.window,Te,Te,0),j.match_start-=Te,j.strstart-=Te,j.block_start-=Te,P=G=j.hash_size;$=j.head[--P],j.head[P]=Te<=$?$-Te:0,--G;);for(P=G=Te;$=j.prev[--P],j.prev[P]=Te<=$?$-Te:0,--G;);z+=Te}if(j.strm.avail_in===0)break;if(he=j.strm,me=j.window,de=j.strstart+j.lookahead,Le=z,Ie=void 0,Ie=he.avail_in,Le<Ie&&(Ie=Le),G=Ie===0?0:(he.avail_in-=Ie,d.arraySet(me,he.input,he.next_in,Ie,de),he.state.wrap===1?he.adler=c(he.adler,me,Ie,de):he.state.wrap===2&&(he.adler=h(he.adler,me,Ie,de)),he.next_in+=Ie,he.total_in+=Ie,Ie),j.lookahead+=G,j.lookahead+j.insert>=O)for(B=j.strstart-j.insert,j.ins_h=j.window[B],j.ins_h=(j.ins_h<<j.hash_shift^j.window[B+1])&j.hash_mask;j.insert&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[B+O-1])&j.hash_mask,j.prev[B&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=B,B++,j.insert--,!(j.lookahead+j.insert<O)););}while(j.lookahead<F&&j.strm.avail_in!==0)}function ve(j,P){for(var G,$;;){if(j.lookahead<F){if(pe(j),j.lookahead<F&&P===b)return _;if(j.lookahead===0)break}if(G=0,j.lookahead>=O&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+O-1])&j.hash_mask,G=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),G!==0&&j.strstart-G<=j.w_size-F&&(j.match_length=X(j,G)),j.match_length>=O)if($=o._tr_tally(j,j.strstart-j.match_start,j.match_length-O),j.lookahead-=j.match_length,j.match_length<=j.max_lazy_match&&j.lookahead>=O){for(j.match_length--;j.strstart++,j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+O-1])&j.hash_mask,G=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart,--j.match_length!=0;);j.strstart++}else j.strstart+=j.match_length,j.match_length=0,j.ins_h=j.window[j.strstart],j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+1])&j.hash_mask;else $=o._tr_tally(j,0,j.window[j.strstart]),j.lookahead--,j.strstart++;if($&&(A(j,!1),j.strm.avail_out===0))return _}return j.insert=j.strstart<O-1?j.strstart:O-1,P===m?(A(j,!0),j.strm.avail_out===0?ae:re):j.last_lit&&(A(j,!1),j.strm.avail_out===0)?_:te}function ke(j,P){for(var G,$,z;;){if(j.lookahead<F){if(pe(j),j.lookahead<F&&P===b)return _;if(j.lookahead===0)break}if(G=0,j.lookahead>=O&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+O-1])&j.hash_mask,G=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),j.prev_length=j.match_length,j.prev_match=j.match_start,j.match_length=O-1,G!==0&&j.prev_length<j.max_lazy_match&&j.strstart-G<=j.w_size-F&&(j.match_length=X(j,G),j.match_length<=5&&(j.strategy===1||j.match_length===O&&4096<j.strstart-j.match_start)&&(j.match_length=O-1)),j.prev_length>=O&&j.match_length<=j.prev_length){for(z=j.strstart+j.lookahead-O,$=o._tr_tally(j,j.strstart-1-j.prev_match,j.prev_length-O),j.lookahead-=j.prev_length-1,j.prev_length-=2;++j.strstart<=z&&(j.ins_h=(j.ins_h<<j.hash_shift^j.window[j.strstart+O-1])&j.hash_mask,G=j.prev[j.strstart&j.w_mask]=j.head[j.ins_h],j.head[j.ins_h]=j.strstart),--j.prev_length!=0;);if(j.match_available=0,j.match_length=O-1,j.strstart++,$&&(A(j,!1),j.strm.avail_out===0))return _}else if(j.match_available){if(($=o._tr_tally(j,0,j.window[j.strstart-1]))&&A(j,!1),j.strstart++,j.lookahead--,j.strm.avail_out===0)return _}else j.match_available=1,j.strstart++,j.lookahead--}return j.match_available&&($=o._tr_tally(j,0,j.window[j.strstart-1]),j.match_available=0),j.insert=j.strstart<O-1?j.strstart:O-1,P===m?(A(j,!0),j.strm.avail_out===0?ae:re):j.last_lit&&(A(j,!1),j.strm.avail_out===0)?_:te}function Ae(j,P,G,$,z){this.good_length=j,this.max_lazy=P,this.nice_length=G,this.max_chain=$,this.func=z}function De(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new d.Buf16(2*Y),this.dyn_dtree=new d.Buf16(2*(2*I+1)),this.bl_tree=new d.Buf16(2*(2*K+1)),je(this.dyn_ltree),je(this.dyn_dtree),je(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new d.Buf16(V+1),this.heap=new d.Buf16(2*E+1),je(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new d.Buf16(2*E+1),je(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Me(j){var P;return j&&j.state?(j.total_in=j.total_out=0,j.data_type=y,(P=j.state).pending=0,P.pending_out=0,P.wrap<0&&(P.wrap=-P.wrap),P.status=P.wrap?k:M,j.adler=P.wrap===2?0:1,P.last_flush=b,o._tr_init(P),u):se(j,w)}function Ke(j){var P=Me(j);return P===u&&(function(G){G.window_size=2*G.w_size,je(G.head),G.max_lazy_match=a[G.level].max_lazy,G.good_match=a[G.level].good_length,G.nice_match=a[G.level].nice_length,G.max_chain_length=a[G.level].max_chain,G.strstart=0,G.block_start=0,G.lookahead=0,G.insert=0,G.match_length=G.prev_length=O-1,G.match_available=0,G.ins_h=0})(j.state),P}function Se(j,P,G,$,z,B){if(!j)return w;var he=1;if(P===g&&(P=6),$<0?(he=0,$=-$):15<$&&(he=2,$-=16),z<1||L<z||G!==S||$<8||15<$||P<0||9<P||B<0||N<B)return se(j,w);$===8&&($=9);var me=new De;return(j.state=me).strm=j,me.wrap=he,me.gzhead=null,me.w_bits=$,me.w_size=1<<me.w_bits,me.w_mask=me.w_size-1,me.hash_bits=z+7,me.hash_size=1<<me.hash_bits,me.hash_mask=me.hash_size-1,me.hash_shift=~~((me.hash_bits+O-1)/O),me.window=new d.Buf8(2*me.w_size),me.head=new d.Buf16(me.hash_size),me.prev=new d.Buf16(me.w_size),me.lit_bufsize=1<<z+6,me.pending_buf_size=4*me.lit_bufsize,me.pending_buf=new d.Buf8(me.pending_buf_size),me.d_buf=1*me.lit_bufsize,me.l_buf=3*me.lit_bufsize,me.level=P,me.strategy=B,me.method=G,Ke(j)}a=[new Ae(0,0,0,0,function(j,P){var G=65535;for(G>j.pending_buf_size-5&&(G=j.pending_buf_size-5);;){if(j.lookahead<=1){if(pe(j),j.lookahead===0&&P===b)return _;if(j.lookahead===0)break}j.strstart+=j.lookahead,j.lookahead=0;var $=j.block_start+G;if((j.strstart===0||j.strstart>=$)&&(j.lookahead=j.strstart-$,j.strstart=$,A(j,!1),j.strm.avail_out===0)||j.strstart-j.block_start>=j.w_size-F&&(A(j,!1),j.strm.avail_out===0))return _}return j.insert=0,P===m?(A(j,!0),j.strm.avail_out===0?ae:re):(j.strstart>j.block_start&&(A(j,!1),j.strm.avail_out),_)}),new Ae(4,4,8,4,ve),new Ae(4,5,16,8,ve),new Ae(4,6,32,32,ve),new Ae(4,4,16,16,ke),new Ae(8,16,32,32,ke),new Ae(8,16,128,128,ke),new Ae(8,32,128,256,ke),new Ae(32,128,258,1024,ke),new Ae(32,258,258,4096,ke)],i.deflateInit=function(j,P){return Se(j,P,S,15,8,0)},i.deflateInit2=Se,i.deflateReset=Ke,i.deflateResetKeep=Me,i.deflateSetHeader=function(j,P){return j&&j.state?j.state.wrap!==2?w:(j.state.gzhead=P,u):w},i.deflate=function(j,P){var G,$,z,B;if(!j||!j.state||5<P||P<0)return j?se(j,w):w;if($=j.state,!j.output||!j.input&&j.avail_in!==0||$.status===666&&P!==m)return se(j,j.avail_out===0?-5:w);if($.strm=j,G=$.last_flush,$.last_flush=P,$.status===k)if($.wrap===2)j.adler=0,H($,31),H($,139),H($,8),$.gzhead?(H($,($.gzhead.text?1:0)+($.gzhead.hcrc?2:0)+($.gzhead.extra?4:0)+($.gzhead.name?8:0)+($.gzhead.comment?16:0)),H($,255&$.gzhead.time),H($,$.gzhead.time>>8&255),H($,$.gzhead.time>>16&255),H($,$.gzhead.time>>24&255),H($,$.level===9?2:2<=$.strategy||$.level<2?4:0),H($,255&$.gzhead.os),$.gzhead.extra&&$.gzhead.extra.length&&(H($,255&$.gzhead.extra.length),H($,$.gzhead.extra.length>>8&255)),$.gzhead.hcrc&&(j.adler=h(j.adler,$.pending_buf,$.pending,0)),$.gzindex=0,$.status=69):(H($,0),H($,0),H($,0),H($,0),H($,0),H($,$.level===9?2:2<=$.strategy||$.level<2?4:0),H($,3),$.status=M);else{var he=S+($.w_bits-8<<4)<<8;he|=(2<=$.strategy||$.level<2?0:$.level<6?1:$.level===6?2:3)<<6,$.strstart!==0&&(he|=32),he+=31-he%31,$.status=M,Z($,he),$.strstart!==0&&(Z($,j.adler>>>16),Z($,65535&j.adler)),j.adler=1}if($.status===69)if($.gzhead.extra){for(z=$.pending;$.gzindex<(65535&$.gzhead.extra.length)&&($.pending!==$.pending_buf_size||($.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),ne(j),z=$.pending,$.pending!==$.pending_buf_size));)H($,255&$.gzhead.extra[$.gzindex]),$.gzindex++;$.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),$.gzindex===$.gzhead.extra.length&&($.gzindex=0,$.status=73)}else $.status=73;if($.status===73)if($.gzhead.name){z=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),ne(j),z=$.pending,$.pending===$.pending_buf_size)){B=1;break}B=$.gzindex<$.gzhead.name.length?255&$.gzhead.name.charCodeAt($.gzindex++):0,H($,B)}while(B!==0);$.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),B===0&&($.gzindex=0,$.status=91)}else $.status=91;if($.status===91)if($.gzhead.comment){z=$.pending;do{if($.pending===$.pending_buf_size&&($.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),ne(j),z=$.pending,$.pending===$.pending_buf_size)){B=1;break}B=$.gzindex<$.gzhead.comment.length?255&$.gzhead.comment.charCodeAt($.gzindex++):0,H($,B)}while(B!==0);$.gzhead.hcrc&&$.pending>z&&(j.adler=h(j.adler,$.pending_buf,$.pending-z,z)),B===0&&($.status=103)}else $.status=103;if($.status===103&&($.gzhead.hcrc?($.pending+2>$.pending_buf_size&&ne(j),$.pending+2<=$.pending_buf_size&&(H($,255&j.adler),H($,j.adler>>8&255),j.adler=0,$.status=M)):$.status=M),$.pending!==0){if(ne(j),j.avail_out===0)return $.last_flush=-1,u}else if(j.avail_in===0&&ie(P)<=ie(G)&&P!==m)return se(j,-5);if($.status===666&&j.avail_in!==0)return se(j,-5);if(j.avail_in!==0||$.lookahead!==0||P!==b&&$.status!==666){var me=$.strategy===2?(function(de,Le){for(var Ie;;){if(de.lookahead===0&&(pe(de),de.lookahead===0)){if(Le===b)return _;break}if(de.match_length=0,Ie=o._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++,Ie&&(A(de,!1),de.strm.avail_out===0))return _}return de.insert=0,Le===m?(A(de,!0),de.strm.avail_out===0?ae:re):de.last_lit&&(A(de,!1),de.strm.avail_out===0)?_:te})($,P):$.strategy===3?(function(de,Le){for(var Ie,Te,Ye,ft,at=de.window;;){if(de.lookahead<=Q){if(pe(de),de.lookahead<=Q&&Le===b)return _;if(de.lookahead===0)break}if(de.match_length=0,de.lookahead>=O&&0<de.strstart&&(Te=at[Ye=de.strstart-1])===at[++Ye]&&Te===at[++Ye]&&Te===at[++Ye]){ft=de.strstart+Q;do;while(Te===at[++Ye]&&Te===at[++Ye]&&Te===at[++Ye]&&Te===at[++Ye]&&Te===at[++Ye]&&Te===at[++Ye]&&Te===at[++Ye]&&Te===at[++Ye]&&Ye<ft);de.match_length=Q-(ft-Ye),de.match_length>de.lookahead&&(de.match_length=de.lookahead)}if(de.match_length>=O?(Ie=o._tr_tally(de,1,de.match_length-O),de.lookahead-=de.match_length,de.strstart+=de.match_length,de.match_length=0):(Ie=o._tr_tally(de,0,de.window[de.strstart]),de.lookahead--,de.strstart++),Ie&&(A(de,!1),de.strm.avail_out===0))return _}return de.insert=0,Le===m?(A(de,!0),de.strm.avail_out===0?ae:re):de.last_lit&&(A(de,!1),de.strm.avail_out===0)?_:te})($,P):a[$.level].func($,P);if(me!==ae&&me!==re||($.status=666),me===_||me===ae)return j.avail_out===0&&($.last_flush=-1),u;if(me===te&&(P===1?o._tr_align($):P!==5&&(o._tr_stored_block($,0,0,!1),P===3&&(je($.head),$.lookahead===0&&($.strstart=0,$.block_start=0,$.insert=0))),ne(j),j.avail_out===0))return $.last_flush=-1,u}return P!==m?u:$.wrap<=0?1:($.wrap===2?(H($,255&j.adler),H($,j.adler>>8&255),H($,j.adler>>16&255),H($,j.adler>>24&255),H($,255&j.total_in),H($,j.total_in>>8&255),H($,j.total_in>>16&255),H($,j.total_in>>24&255)):(Z($,j.adler>>>16),Z($,65535&j.adler)),ne(j),0<$.wrap&&($.wrap=-$.wrap),$.pending!==0?u:1)},i.deflateEnd=function(j){var P;return j&&j.state?(P=j.state.status)!==k&&P!==69&&P!==73&&P!==91&&P!==103&&P!==M&&P!==666?se(j,w):(j.state=null,P===M?se(j,-3):u):w},i.deflateSetDictionary=function(j,P){var G,$,z,B,he,me,de,Le,Ie=P.length;if(!j||!j.state||(B=(G=j.state).wrap)===2||B===1&&G.status!==k||G.lookahead)return w;for(B===1&&(j.adler=c(j.adler,P,Ie,0)),G.wrap=0,Ie>=G.w_size&&(B===0&&(je(G.head),G.strstart=0,G.block_start=0,G.insert=0),Le=new d.Buf8(G.w_size),d.arraySet(Le,P,Ie-G.w_size,G.w_size,0),P=Le,Ie=G.w_size),he=j.avail_in,me=j.next_in,de=j.input,j.avail_in=Ie,j.next_in=0,j.input=P,pe(G);G.lookahead>=O;){for($=G.strstart,z=G.lookahead-(O-1);G.ins_h=(G.ins_h<<G.hash_shift^G.window[$+O-1])&G.hash_mask,G.prev[$&G.w_mask]=G.head[G.ins_h],G.head[G.ins_h]=$,$++,--z;);G.strstart=$,G.lookahead=O-1,pe(G)}return G.strstart+=G.lookahead,G.block_start=G.strstart,G.insert=G.lookahead,G.lookahead=0,G.match_length=G.prev_length=O-1,G.match_available=0,j.next_in=me,j.input=de,j.avail_in=he,G.wrap=B,u},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(e,s,i){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(e,s,i){s.exports=function(a,d){var o,c,h,p,b,m,u,w,g,N,y,S,L,E,I,K,Y,V,O,Q,F,k,M,_,te;o=a.state,c=a.next_in,_=a.input,h=c+(a.avail_in-5),p=a.next_out,te=a.output,b=p-(d-a.avail_out),m=p+(a.avail_out-257),u=o.dmax,w=o.wsize,g=o.whave,N=o.wnext,y=o.window,S=o.hold,L=o.bits,E=o.lencode,I=o.distcode,K=(1<<o.lenbits)-1,Y=(1<<o.distbits)-1;e:do{L<15&&(S+=_[c++]<<L,L+=8,S+=_[c++]<<L,L+=8),V=E[S&K];t:for(;;){if(S>>>=O=V>>>24,L-=O,(O=V>>>16&255)===0)te[p++]=65535&V;else{if(!(16&O)){if((64&O)==0){V=E[(65535&V)+(S&(1<<O)-1)];continue t}if(32&O){o.mode=12;break e}a.msg="invalid literal/length code",o.mode=30;break e}Q=65535&V,(O&=15)&&(L<O&&(S+=_[c++]<<L,L+=8),Q+=S&(1<<O)-1,S>>>=O,L-=O),L<15&&(S+=_[c++]<<L,L+=8,S+=_[c++]<<L,L+=8),V=I[S&Y];r:for(;;){if(S>>>=O=V>>>24,L-=O,!(16&(O=V>>>16&255))){if((64&O)==0){V=I[(65535&V)+(S&(1<<O)-1)];continue r}a.msg="invalid distance code",o.mode=30;break e}if(F=65535&V,L<(O&=15)&&(S+=_[c++]<<L,(L+=8)<O&&(S+=_[c++]<<L,L+=8)),u<(F+=S&(1<<O)-1)){a.msg="invalid distance too far back",o.mode=30;break e}if(S>>>=O,L-=O,(O=p-b)<F){if(g<(O=F-O)&&o.sane){a.msg="invalid distance too far back",o.mode=30;break e}if(M=y,(k=0)===N){if(k+=w-O,O<Q){for(Q-=O;te[p++]=y[k++],--O;);k=p-F,M=te}}else if(N<O){if(k+=w+N-O,(O-=N)<Q){for(Q-=O;te[p++]=y[k++],--O;);if(k=0,N<Q){for(Q-=O=N;te[p++]=y[k++],--O;);k=p-F,M=te}}}else if(k+=N-O,O<Q){for(Q-=O;te[p++]=y[k++],--O;);k=p-F,M=te}for(;2<Q;)te[p++]=M[k++],te[p++]=M[k++],te[p++]=M[k++],Q-=3;Q&&(te[p++]=M[k++],1<Q&&(te[p++]=M[k++]))}else{for(k=p-F;te[p++]=te[k++],te[p++]=te[k++],te[p++]=te[k++],2<(Q-=3););Q&&(te[p++]=te[k++],1<Q&&(te[p++]=te[k++]))}break}}break}}while(c<h&&p<m);c-=Q=L>>3,S&=(1<<(L-=Q<<3))-1,a.next_in=c,a.next_out=p,a.avail_in=c<h?h-c+5:5-(c-h),a.avail_out=p<m?m-p+257:257-(p-m),o.hold=S,o.bits=L}},{}],49:[function(e,s,i){var a=e("../utils/common"),d=e("./adler32"),o=e("./crc32"),c=e("./inffast"),h=e("./inftrees"),p=1,b=2,m=0,u=-2,w=1,g=852,N=592;function y(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function S(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function L(k){var M;return k&&k.state?(M=k.state,k.total_in=k.total_out=M.total=0,k.msg="",M.wrap&&(k.adler=1&M.wrap),M.mode=w,M.last=0,M.havedict=0,M.dmax=32768,M.head=null,M.hold=0,M.bits=0,M.lencode=M.lendyn=new a.Buf32(g),M.distcode=M.distdyn=new a.Buf32(N),M.sane=1,M.back=-1,m):u}function E(k){var M;return k&&k.state?((M=k.state).wsize=0,M.whave=0,M.wnext=0,L(k)):u}function I(k,M){var _,te;return k&&k.state?(te=k.state,M<0?(_=0,M=-M):(_=1+(M>>4),M<48&&(M&=15)),M&&(M<8||15<M)?u:(te.window!==null&&te.wbits!==M&&(te.window=null),te.wrap=_,te.wbits=M,E(k))):u}function K(k,M){var _,te;return k?(te=new S,(k.state=te).window=null,(_=I(k,M))!==m&&(k.state=null),_):u}var Y,V,O=!0;function Q(k){if(O){var M;for(Y=new a.Buf32(512),V=new a.Buf32(32),M=0;M<144;)k.lens[M++]=8;for(;M<256;)k.lens[M++]=9;for(;M<280;)k.lens[M++]=7;for(;M<288;)k.lens[M++]=8;for(h(p,k.lens,0,288,Y,0,k.work,{bits:9}),M=0;M<32;)k.lens[M++]=5;h(b,k.lens,0,32,V,0,k.work,{bits:5}),O=!1}k.lencode=Y,k.lenbits=9,k.distcode=V,k.distbits=5}function F(k,M,_,te){var ae,re=k.state;return re.window===null&&(re.wsize=1<<re.wbits,re.wnext=0,re.whave=0,re.window=new a.Buf8(re.wsize)),te>=re.wsize?(a.arraySet(re.window,M,_-re.wsize,re.wsize,0),re.wnext=0,re.whave=re.wsize):(te<(ae=re.wsize-re.wnext)&&(ae=te),a.arraySet(re.window,M,_-te,ae,re.wnext),(te-=ae)?(a.arraySet(re.window,M,_-te,te,0),re.wnext=te,re.whave=re.wsize):(re.wnext+=ae,re.wnext===re.wsize&&(re.wnext=0),re.whave<re.wsize&&(re.whave+=ae))),0}i.inflateReset=E,i.inflateReset2=I,i.inflateResetKeep=L,i.inflateInit=function(k){return K(k,15)},i.inflateInit2=K,i.inflate=function(k,M){var _,te,ae,re,se,ie,je,ne,A,H,Z,X,pe,ve,ke,Ae,De,Me,Ke,Se,j,P,G,$,z=0,B=new a.Buf8(4),he=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return u;(_=k.state).mode===12&&(_.mode=13),se=k.next_out,ae=k.output,je=k.avail_out,re=k.next_in,te=k.input,ie=k.avail_in,ne=_.hold,A=_.bits,H=ie,Z=je,P=m;e:for(;;)switch(_.mode){case w:if(_.wrap===0){_.mode=13;break}for(;A<16;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if(2&_.wrap&&ne===35615){B[_.check=0]=255&ne,B[1]=ne>>>8&255,_.check=o(_.check,B,2,0),A=ne=0,_.mode=2;break}if(_.flags=0,_.head&&(_.head.done=!1),!(1&_.wrap)||(((255&ne)<<8)+(ne>>8))%31){k.msg="incorrect header check",_.mode=30;break}if((15&ne)!=8){k.msg="unknown compression method",_.mode=30;break}if(A-=4,j=8+(15&(ne>>>=4)),_.wbits===0)_.wbits=j;else if(j>_.wbits){k.msg="invalid window size",_.mode=30;break}_.dmax=1<<j,k.adler=_.check=1,_.mode=512&ne?10:12,A=ne=0;break;case 2:for(;A<16;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if(_.flags=ne,(255&_.flags)!=8){k.msg="unknown compression method",_.mode=30;break}if(57344&_.flags){k.msg="unknown header flags set",_.mode=30;break}_.head&&(_.head.text=ne>>8&1),512&_.flags&&(B[0]=255&ne,B[1]=ne>>>8&255,_.check=o(_.check,B,2,0)),A=ne=0,_.mode=3;case 3:for(;A<32;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}_.head&&(_.head.time=ne),512&_.flags&&(B[0]=255&ne,B[1]=ne>>>8&255,B[2]=ne>>>16&255,B[3]=ne>>>24&255,_.check=o(_.check,B,4,0)),A=ne=0,_.mode=4;case 4:for(;A<16;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}_.head&&(_.head.xflags=255&ne,_.head.os=ne>>8),512&_.flags&&(B[0]=255&ne,B[1]=ne>>>8&255,_.check=o(_.check,B,2,0)),A=ne=0,_.mode=5;case 5:if(1024&_.flags){for(;A<16;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}_.length=ne,_.head&&(_.head.extra_len=ne),512&_.flags&&(B[0]=255&ne,B[1]=ne>>>8&255,_.check=o(_.check,B,2,0)),A=ne=0}else _.head&&(_.head.extra=null);_.mode=6;case 6:if(1024&_.flags&&(ie<(X=_.length)&&(X=ie),X&&(_.head&&(j=_.head.extra_len-_.length,_.head.extra||(_.head.extra=new Array(_.head.extra_len)),a.arraySet(_.head.extra,te,re,X,j)),512&_.flags&&(_.check=o(_.check,te,X,re)),ie-=X,re+=X,_.length-=X),_.length))break e;_.length=0,_.mode=7;case 7:if(2048&_.flags){if(ie===0)break e;for(X=0;j=te[re+X++],_.head&&j&&_.length<65536&&(_.head.name+=String.fromCharCode(j)),j&&X<ie;);if(512&_.flags&&(_.check=o(_.check,te,X,re)),ie-=X,re+=X,j)break e}else _.head&&(_.head.name=null);_.length=0,_.mode=8;case 8:if(4096&_.flags){if(ie===0)break e;for(X=0;j=te[re+X++],_.head&&j&&_.length<65536&&(_.head.comment+=String.fromCharCode(j)),j&&X<ie;);if(512&_.flags&&(_.check=o(_.check,te,X,re)),ie-=X,re+=X,j)break e}else _.head&&(_.head.comment=null);_.mode=9;case 9:if(512&_.flags){for(;A<16;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if(ne!==(65535&_.check)){k.msg="header crc mismatch",_.mode=30;break}A=ne=0}_.head&&(_.head.hcrc=_.flags>>9&1,_.head.done=!0),k.adler=_.check=0,_.mode=12;break;case 10:for(;A<32;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}k.adler=_.check=y(ne),A=ne=0,_.mode=11;case 11:if(_.havedict===0)return k.next_out=se,k.avail_out=je,k.next_in=re,k.avail_in=ie,_.hold=ne,_.bits=A,2;k.adler=_.check=1,_.mode=12;case 12:if(M===5||M===6)break e;case 13:if(_.last){ne>>>=7&A,A-=7&A,_.mode=27;break}for(;A<3;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}switch(_.last=1&ne,A-=1,3&(ne>>>=1)){case 0:_.mode=14;break;case 1:if(Q(_),_.mode=20,M!==6)break;ne>>>=2,A-=2;break e;case 2:_.mode=17;break;case 3:k.msg="invalid block type",_.mode=30}ne>>>=2,A-=2;break;case 14:for(ne>>>=7&A,A-=7&A;A<32;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if((65535&ne)!=(ne>>>16^65535)){k.msg="invalid stored block lengths",_.mode=30;break}if(_.length=65535&ne,A=ne=0,_.mode=15,M===6)break e;case 15:_.mode=16;case 16:if(X=_.length){if(ie<X&&(X=ie),je<X&&(X=je),X===0)break e;a.arraySet(ae,te,re,X,se),ie-=X,re+=X,je-=X,se+=X,_.length-=X;break}_.mode=12;break;case 17:for(;A<14;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if(_.nlen=257+(31&ne),ne>>>=5,A-=5,_.ndist=1+(31&ne),ne>>>=5,A-=5,_.ncode=4+(15&ne),ne>>>=4,A-=4,286<_.nlen||30<_.ndist){k.msg="too many length or distance symbols",_.mode=30;break}_.have=0,_.mode=18;case 18:for(;_.have<_.ncode;){for(;A<3;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}_.lens[he[_.have++]]=7&ne,ne>>>=3,A-=3}for(;_.have<19;)_.lens[he[_.have++]]=0;if(_.lencode=_.lendyn,_.lenbits=7,G={bits:_.lenbits},P=h(0,_.lens,0,19,_.lencode,0,_.work,G),_.lenbits=G.bits,P){k.msg="invalid code lengths set",_.mode=30;break}_.have=0,_.mode=19;case 19:for(;_.have<_.nlen+_.ndist;){for(;Ae=(z=_.lencode[ne&(1<<_.lenbits)-1])>>>16&255,De=65535&z,!((ke=z>>>24)<=A);){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if(De<16)ne>>>=ke,A-=ke,_.lens[_.have++]=De;else{if(De===16){for($=ke+2;A<$;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if(ne>>>=ke,A-=ke,_.have===0){k.msg="invalid bit length repeat",_.mode=30;break}j=_.lens[_.have-1],X=3+(3&ne),ne>>>=2,A-=2}else if(De===17){for($=ke+3;A<$;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}A-=ke,j=0,X=3+(7&(ne>>>=ke)),ne>>>=3,A-=3}else{for($=ke+7;A<$;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}A-=ke,j=0,X=11+(127&(ne>>>=ke)),ne>>>=7,A-=7}if(_.have+X>_.nlen+_.ndist){k.msg="invalid bit length repeat",_.mode=30;break}for(;X--;)_.lens[_.have++]=j}}if(_.mode===30)break;if(_.lens[256]===0){k.msg="invalid code -- missing end-of-block",_.mode=30;break}if(_.lenbits=9,G={bits:_.lenbits},P=h(p,_.lens,0,_.nlen,_.lencode,0,_.work,G),_.lenbits=G.bits,P){k.msg="invalid literal/lengths set",_.mode=30;break}if(_.distbits=6,_.distcode=_.distdyn,G={bits:_.distbits},P=h(b,_.lens,_.nlen,_.ndist,_.distcode,0,_.work,G),_.distbits=G.bits,P){k.msg="invalid distances set",_.mode=30;break}if(_.mode=20,M===6)break e;case 20:_.mode=21;case 21:if(6<=ie&&258<=je){k.next_out=se,k.avail_out=je,k.next_in=re,k.avail_in=ie,_.hold=ne,_.bits=A,c(k,Z),se=k.next_out,ae=k.output,je=k.avail_out,re=k.next_in,te=k.input,ie=k.avail_in,ne=_.hold,A=_.bits,_.mode===12&&(_.back=-1);break}for(_.back=0;Ae=(z=_.lencode[ne&(1<<_.lenbits)-1])>>>16&255,De=65535&z,!((ke=z>>>24)<=A);){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if(Ae&&(240&Ae)==0){for(Me=ke,Ke=Ae,Se=De;Ae=(z=_.lencode[Se+((ne&(1<<Me+Ke)-1)>>Me)])>>>16&255,De=65535&z,!(Me+(ke=z>>>24)<=A);){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}ne>>>=Me,A-=Me,_.back+=Me}if(ne>>>=ke,A-=ke,_.back+=ke,_.length=De,Ae===0){_.mode=26;break}if(32&Ae){_.back=-1,_.mode=12;break}if(64&Ae){k.msg="invalid literal/length code",_.mode=30;break}_.extra=15&Ae,_.mode=22;case 22:if(_.extra){for($=_.extra;A<$;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}_.length+=ne&(1<<_.extra)-1,ne>>>=_.extra,A-=_.extra,_.back+=_.extra}_.was=_.length,_.mode=23;case 23:for(;Ae=(z=_.distcode[ne&(1<<_.distbits)-1])>>>16&255,De=65535&z,!((ke=z>>>24)<=A);){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if((240&Ae)==0){for(Me=ke,Ke=Ae,Se=De;Ae=(z=_.distcode[Se+((ne&(1<<Me+Ke)-1)>>Me)])>>>16&255,De=65535&z,!(Me+(ke=z>>>24)<=A);){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}ne>>>=Me,A-=Me,_.back+=Me}if(ne>>>=ke,A-=ke,_.back+=ke,64&Ae){k.msg="invalid distance code",_.mode=30;break}_.offset=De,_.extra=15&Ae,_.mode=24;case 24:if(_.extra){for($=_.extra;A<$;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}_.offset+=ne&(1<<_.extra)-1,ne>>>=_.extra,A-=_.extra,_.back+=_.extra}if(_.offset>_.dmax){k.msg="invalid distance too far back",_.mode=30;break}_.mode=25;case 25:if(je===0)break e;if(X=Z-je,_.offset>X){if((X=_.offset-X)>_.whave&&_.sane){k.msg="invalid distance too far back",_.mode=30;break}pe=X>_.wnext?(X-=_.wnext,_.wsize-X):_.wnext-X,X>_.length&&(X=_.length),ve=_.window}else ve=ae,pe=se-_.offset,X=_.length;for(je<X&&(X=je),je-=X,_.length-=X;ae[se++]=ve[pe++],--X;);_.length===0&&(_.mode=21);break;case 26:if(je===0)break e;ae[se++]=_.length,je--,_.mode=21;break;case 27:if(_.wrap){for(;A<32;){if(ie===0)break e;ie--,ne|=te[re++]<<A,A+=8}if(Z-=je,k.total_out+=Z,_.total+=Z,Z&&(k.adler=_.check=_.flags?o(_.check,ae,Z,se-Z):d(_.check,ae,Z,se-Z)),Z=je,(_.flags?ne:y(ne))!==_.check){k.msg="incorrect data check",_.mode=30;break}A=ne=0}_.mode=28;case 28:if(_.wrap&&_.flags){for(;A<32;){if(ie===0)break e;ie--,ne+=te[re++]<<A,A+=8}if(ne!==(4294967295&_.total)){k.msg="incorrect length check",_.mode=30;break}A=ne=0}_.mode=29;case 29:P=1;break e;case 30:P=-3;break e;case 31:return-4;case 32:default:return u}return k.next_out=se,k.avail_out=je,k.next_in=re,k.avail_in=ie,_.hold=ne,_.bits=A,(_.wsize||Z!==k.avail_out&&_.mode<30&&(_.mode<27||M!==4))&&F(k,k.output,k.next_out,Z-k.avail_out)?(_.mode=31,-4):(H-=k.avail_in,Z-=k.avail_out,k.total_in+=H,k.total_out+=Z,_.total+=Z,_.wrap&&Z&&(k.adler=_.check=_.flags?o(_.check,ae,Z,k.next_out-Z):d(_.check,ae,Z,k.next_out-Z)),k.data_type=_.bits+(_.last?64:0)+(_.mode===12?128:0)+(_.mode===20||_.mode===15?256:0),(H==0&&Z===0||M===4)&&P===m&&(P=-5),P)},i.inflateEnd=function(k){if(!k||!k.state)return u;var M=k.state;return M.window&&(M.window=null),k.state=null,m},i.inflateGetHeader=function(k,M){var _;return k&&k.state?(2&(_=k.state).wrap)==0?u:((_.head=M).done=!1,m):u},i.inflateSetDictionary=function(k,M){var _,te=M.length;return k&&k.state?(_=k.state).wrap!==0&&_.mode!==11?u:_.mode===11&&d(1,M,te,0)!==_.check?-3:F(k,M,te,te)?(_.mode=31,-4):(_.havedict=1,m):u},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(e,s,i){var a=e("../utils/common"),d=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(p,b,m,u,w,g,N,y){var S,L,E,I,K,Y,V,O,Q,F=y.bits,k=0,M=0,_=0,te=0,ae=0,re=0,se=0,ie=0,je=0,ne=0,A=null,H=0,Z=new a.Buf16(16),X=new a.Buf16(16),pe=null,ve=0;for(k=0;k<=15;k++)Z[k]=0;for(M=0;M<u;M++)Z[b[m+M]]++;for(ae=F,te=15;1<=te&&Z[te]===0;te--);if(te<ae&&(ae=te),te===0)return w[g++]=20971520,w[g++]=20971520,y.bits=1,0;for(_=1;_<te&&Z[_]===0;_++);for(ae<_&&(ae=_),k=ie=1;k<=15;k++)if(ie<<=1,(ie-=Z[k])<0)return-1;if(0<ie&&(p===0||te!==1))return-1;for(X[1]=0,k=1;k<15;k++)X[k+1]=X[k]+Z[k];for(M=0;M<u;M++)b[m+M]!==0&&(N[X[b[m+M]]++]=M);if(Y=p===0?(A=pe=N,19):p===1?(A=d,H-=257,pe=o,ve-=257,256):(A=c,pe=h,-1),k=_,K=g,se=M=ne=0,E=-1,I=(je=1<<(re=ae))-1,p===1&&852<je||p===2&&592<je)return 1;for(;;){for(V=k-se,Q=N[M]<Y?(O=0,N[M]):N[M]>Y?(O=pe[ve+N[M]],A[H+N[M]]):(O=96,0),S=1<<k-se,_=L=1<<re;w[K+(ne>>se)+(L-=S)]=V<<24|O<<16|Q|0,L!==0;);for(S=1<<k-1;ne&S;)S>>=1;if(S!==0?(ne&=S-1,ne+=S):ne=0,M++,--Z[k]==0){if(k===te)break;k=b[m+N[M]]}if(ae<k&&(ne&I)!==E){for(se===0&&(se=ae),K+=_,ie=1<<(re=k-se);re+se<te&&!((ie-=Z[re+se])<=0);)re++,ie<<=1;if(je+=1<<re,p===1&&852<je||p===2&&592<je)return 1;w[E=ne&I]=ae<<24|re<<16|K-g|0}}return ne!==0&&(w[K+ne]=k-se<<24|64<<16|0),y.bits=ae,0}},{"../utils/common":41}],51:[function(e,s,i){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(e,s,i){var a=e("../utils/common"),d=0,o=1;function c(z){for(var B=z.length;0<=--B;)z[B]=0}var h=0,p=29,b=256,m=b+1+p,u=30,w=19,g=2*m+1,N=15,y=16,S=7,L=256,E=16,I=17,K=18,Y=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],V=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],F=new Array(2*(m+2));c(F);var k=new Array(2*u);c(k);var M=new Array(512);c(M);var _=new Array(256);c(_);var te=new Array(p);c(te);var ae,re,se,ie=new Array(u);function je(z,B,he,me,de){this.static_tree=z,this.extra_bits=B,this.extra_base=he,this.elems=me,this.max_length=de,this.has_stree=z&&z.length}function ne(z,B){this.dyn_tree=z,this.max_code=0,this.stat_desc=B}function A(z){return z<256?M[z]:M[256+(z>>>7)]}function H(z,B){z.pending_buf[z.pending++]=255&B,z.pending_buf[z.pending++]=B>>>8&255}function Z(z,B,he){z.bi_valid>y-he?(z.bi_buf|=B<<z.bi_valid&65535,H(z,z.bi_buf),z.bi_buf=B>>y-z.bi_valid,z.bi_valid+=he-y):(z.bi_buf|=B<<z.bi_valid&65535,z.bi_valid+=he)}function X(z,B,he){Z(z,he[2*B],he[2*B+1])}function pe(z,B){for(var he=0;he|=1&z,z>>>=1,he<<=1,0<--B;);return he>>>1}function ve(z,B,he){var me,de,Le=new Array(N+1),Ie=0;for(me=1;me<=N;me++)Le[me]=Ie=Ie+he[me-1]<<1;for(de=0;de<=B;de++){var Te=z[2*de+1];Te!==0&&(z[2*de]=pe(Le[Te]++,Te))}}function ke(z){var B;for(B=0;B<m;B++)z.dyn_ltree[2*B]=0;for(B=0;B<u;B++)z.dyn_dtree[2*B]=0;for(B=0;B<w;B++)z.bl_tree[2*B]=0;z.dyn_ltree[2*L]=1,z.opt_len=z.static_len=0,z.last_lit=z.matches=0}function Ae(z){8<z.bi_valid?H(z,z.bi_buf):0<z.bi_valid&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0}function De(z,B,he,me){var de=2*B,Le=2*he;return z[de]<z[Le]||z[de]===z[Le]&&me[B]<=me[he]}function Me(z,B,he){for(var me=z.heap[he],de=he<<1;de<=z.heap_len&&(de<z.heap_len&&De(B,z.heap[de+1],z.heap[de],z.depth)&&de++,!De(B,me,z.heap[de],z.depth));)z.heap[he]=z.heap[de],he=de,de<<=1;z.heap[he]=me}function Ke(z,B,he){var me,de,Le,Ie,Te=0;if(z.last_lit!==0)for(;me=z.pending_buf[z.d_buf+2*Te]<<8|z.pending_buf[z.d_buf+2*Te+1],de=z.pending_buf[z.l_buf+Te],Te++,me===0?X(z,de,B):(X(z,(Le=_[de])+b+1,B),(Ie=Y[Le])!==0&&Z(z,de-=te[Le],Ie),X(z,Le=A(--me),he),(Ie=V[Le])!==0&&Z(z,me-=ie[Le],Ie)),Te<z.last_lit;);X(z,L,B)}function Se(z,B){var he,me,de,Le=B.dyn_tree,Ie=B.stat_desc.static_tree,Te=B.stat_desc.has_stree,Ye=B.stat_desc.elems,ft=-1;for(z.heap_len=0,z.heap_max=g,he=0;he<Ye;he++)Le[2*he]!==0?(z.heap[++z.heap_len]=ft=he,z.depth[he]=0):Le[2*he+1]=0;for(;z.heap_len<2;)Le[2*(de=z.heap[++z.heap_len]=ft<2?++ft:0)]=1,z.depth[de]=0,z.opt_len--,Te&&(z.static_len-=Ie[2*de+1]);for(B.max_code=ft,he=z.heap_len>>1;1<=he;he--)Me(z,Le,he);for(de=Ye;he=z.heap[1],z.heap[1]=z.heap[z.heap_len--],Me(z,Le,1),me=z.heap[1],z.heap[--z.heap_max]=he,z.heap[--z.heap_max]=me,Le[2*de]=Le[2*he]+Le[2*me],z.depth[de]=(z.depth[he]>=z.depth[me]?z.depth[he]:z.depth[me])+1,Le[2*he+1]=Le[2*me+1]=de,z.heap[1]=de++,Me(z,Le,1),2<=z.heap_len;);z.heap[--z.heap_max]=z.heap[1],(function(at,lt){var bt,ut,Yt,gt,Et,qt,Pt=lt.dyn_tree,vt=lt.max_code,Zt=lt.stat_desc.static_tree,_t=lt.stat_desc.has_stree,Ot=lt.stat_desc.extra_bits,ir=lt.stat_desc.extra_base,Rt=lt.stat_desc.max_length,yt=0;for(gt=0;gt<=N;gt++)at.bl_count[gt]=0;for(Pt[2*at.heap[at.heap_max]+1]=0,bt=at.heap_max+1;bt<g;bt++)Rt<(gt=Pt[2*Pt[2*(ut=at.heap[bt])+1]+1]+1)&&(gt=Rt,yt++),Pt[2*ut+1]=gt,vt<ut||(at.bl_count[gt]++,Et=0,ir<=ut&&(Et=Ot[ut-ir]),qt=Pt[2*ut],at.opt_len+=qt*(gt+Et),_t&&(at.static_len+=qt*(Zt[2*ut+1]+Et)));if(yt!==0){do{for(gt=Rt-1;at.bl_count[gt]===0;)gt--;at.bl_count[gt]--,at.bl_count[gt+1]+=2,at.bl_count[Rt]--,yt-=2}while(0<yt);for(gt=Rt;gt!==0;gt--)for(ut=at.bl_count[gt];ut!==0;)vt<(Yt=at.heap[--bt])||(Pt[2*Yt+1]!==gt&&(at.opt_len+=(gt-Pt[2*Yt+1])*Pt[2*Yt],Pt[2*Yt+1]=gt),ut--)}})(z,B),ve(Le,ft,z.bl_count)}function j(z,B,he){var me,de,Le=-1,Ie=B[1],Te=0,Ye=7,ft=4;for(Ie===0&&(Ye=138,ft=3),B[2*(he+1)+1]=65535,me=0;me<=he;me++)de=Ie,Ie=B[2*(me+1)+1],++Te<Ye&&de===Ie||(Te<ft?z.bl_tree[2*de]+=Te:de!==0?(de!==Le&&z.bl_tree[2*de]++,z.bl_tree[2*E]++):Te<=10?z.bl_tree[2*I]++:z.bl_tree[2*K]++,Le=de,ft=(Te=0)===Ie?(Ye=138,3):de===Ie?(Ye=6,3):(Ye=7,4))}function P(z,B,he){var me,de,Le=-1,Ie=B[1],Te=0,Ye=7,ft=4;for(Ie===0&&(Ye=138,ft=3),me=0;me<=he;me++)if(de=Ie,Ie=B[2*(me+1)+1],!(++Te<Ye&&de===Ie)){if(Te<ft)for(;X(z,de,z.bl_tree),--Te!=0;);else de!==0?(de!==Le&&(X(z,de,z.bl_tree),Te--),X(z,E,z.bl_tree),Z(z,Te-3,2)):Te<=10?(X(z,I,z.bl_tree),Z(z,Te-3,3)):(X(z,K,z.bl_tree),Z(z,Te-11,7));Le=de,ft=(Te=0)===Ie?(Ye=138,3):de===Ie?(Ye=6,3):(Ye=7,4)}}c(ie);var G=!1;function $(z,B,he,me){Z(z,(h<<1)+(me?1:0),3),(function(de,Le,Ie,Te){Ae(de),H(de,Ie),H(de,~Ie),a.arraySet(de.pending_buf,de.window,Le,Ie,de.pending),de.pending+=Ie})(z,B,he)}i._tr_init=function(z){G||((function(){var B,he,me,de,Le,Ie=new Array(N+1);for(de=me=0;de<p-1;de++)for(te[de]=me,B=0;B<1<<Y[de];B++)_[me++]=de;for(_[me-1]=de,de=Le=0;de<16;de++)for(ie[de]=Le,B=0;B<1<<V[de];B++)M[Le++]=de;for(Le>>=7;de<u;de++)for(ie[de]=Le<<7,B=0;B<1<<V[de]-7;B++)M[256+Le++]=de;for(he=0;he<=N;he++)Ie[he]=0;for(B=0;B<=143;)F[2*B+1]=8,B++,Ie[8]++;for(;B<=255;)F[2*B+1]=9,B++,Ie[9]++;for(;B<=279;)F[2*B+1]=7,B++,Ie[7]++;for(;B<=287;)F[2*B+1]=8,B++,Ie[8]++;for(ve(F,m+1,Ie),B=0;B<u;B++)k[2*B+1]=5,k[2*B]=pe(B,5);ae=new je(F,Y,b+1,m,N),re=new je(k,V,0,u,N),se=new je(new Array(0),O,0,w,S)})(),G=!0),z.l_desc=new ne(z.dyn_ltree,ae),z.d_desc=new ne(z.dyn_dtree,re),z.bl_desc=new ne(z.bl_tree,se),z.bi_buf=0,z.bi_valid=0,ke(z)},i._tr_stored_block=$,i._tr_flush_block=function(z,B,he,me){var de,Le,Ie=0;0<z.level?(z.strm.data_type===2&&(z.strm.data_type=(function(Te){var Ye,ft=4093624447;for(Ye=0;Ye<=31;Ye++,ft>>>=1)if(1&ft&&Te.dyn_ltree[2*Ye]!==0)return d;if(Te.dyn_ltree[18]!==0||Te.dyn_ltree[20]!==0||Te.dyn_ltree[26]!==0)return o;for(Ye=32;Ye<b;Ye++)if(Te.dyn_ltree[2*Ye]!==0)return o;return d})(z)),Se(z,z.l_desc),Se(z,z.d_desc),Ie=(function(Te){var Ye;for(j(Te,Te.dyn_ltree,Te.l_desc.max_code),j(Te,Te.dyn_dtree,Te.d_desc.max_code),Se(Te,Te.bl_desc),Ye=w-1;3<=Ye&&Te.bl_tree[2*Q[Ye]+1]===0;Ye--);return Te.opt_len+=3*(Ye+1)+5+5+4,Ye})(z),de=z.opt_len+3+7>>>3,(Le=z.static_len+3+7>>>3)<=de&&(de=Le)):de=Le=he+5,he+4<=de&&B!==-1?$(z,B,he,me):z.strategy===4||Le===de?(Z(z,2+(me?1:0),3),Ke(z,F,k)):(Z(z,4+(me?1:0),3),(function(Te,Ye,ft,at){var lt;for(Z(Te,Ye-257,5),Z(Te,ft-1,5),Z(Te,at-4,4),lt=0;lt<at;lt++)Z(Te,Te.bl_tree[2*Q[lt]+1],3);P(Te,Te.dyn_ltree,Ye-1),P(Te,Te.dyn_dtree,ft-1)})(z,z.l_desc.max_code+1,z.d_desc.max_code+1,Ie+1),Ke(z,z.dyn_ltree,z.dyn_dtree)),ke(z),me&&Ae(z)},i._tr_tally=function(z,B,he){return z.pending_buf[z.d_buf+2*z.last_lit]=B>>>8&255,z.pending_buf[z.d_buf+2*z.last_lit+1]=255&B,z.pending_buf[z.l_buf+z.last_lit]=255&he,z.last_lit++,B===0?z.dyn_ltree[2*he]++:(z.matches++,B--,z.dyn_ltree[2*(_[he]+b+1)]++,z.dyn_dtree[2*A(B)]++),z.last_lit===z.lit_bufsize-1},i._tr_align=function(z){Z(z,2,3),X(z,L,F),(function(B){B.bi_valid===16?(H(B,B.bi_buf),B.bi_buf=0,B.bi_valid=0):8<=B.bi_valid&&(B.pending_buf[B.pending++]=255&B.bi_buf,B.bi_buf>>=8,B.bi_valid-=8)})(z)}},{"../utils/common":41}],53:[function(e,s,i){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(e,s,i){(function(a){(function(d,o){if(!d.setImmediate){var c,h,p,b,m=1,u={},w=!1,g=d.document,N=Object.getPrototypeOf&&Object.getPrototypeOf(d);N=N&&N.setTimeout?N:d,c={}.toString.call(d.process)==="[object process]"?function(E){process.nextTick(function(){S(E)})}:(function(){if(d.postMessage&&!d.importScripts){var E=!0,I=d.onmessage;return d.onmessage=function(){E=!1},d.postMessage("","*"),d.onmessage=I,E}})()?(b="setImmediate$"+Math.random()+"$",d.addEventListener?d.addEventListener("message",L,!1):d.attachEvent("onmessage",L),function(E){d.postMessage(b+E,"*")}):d.MessageChannel?((p=new MessageChannel).port1.onmessage=function(E){S(E.data)},function(E){p.port2.postMessage(E)}):g&&"onreadystatechange"in g.createElement("script")?(h=g.documentElement,function(E){var I=g.createElement("script");I.onreadystatechange=function(){S(E),I.onreadystatechange=null,h.removeChild(I),I=null},h.appendChild(I)}):function(E){setTimeout(S,0,E)},N.setImmediate=function(E){typeof E!="function"&&(E=new Function(""+E));for(var I=new Array(arguments.length-1),K=0;K<I.length;K++)I[K]=arguments[K+1];var Y={callback:E,args:I};return u[m]=Y,c(m),m++},N.clearImmediate=y}function y(E){delete u[E]}function S(E){if(w)setTimeout(S,0,E);else{var I=u[E];if(I){w=!0;try{(function(K){var Y=K.callback,V=K.args;switch(V.length){case 0:Y();break;case 1:Y(V[0]);break;case 2:Y(V[0],V[1]);break;case 3:Y(V[0],V[1],V[2]);break;default:Y.apply(o,V)}})(I)}finally{y(E),w=!1}}}}function L(E){E.source===d&&typeof E.data=="string"&&E.data.indexOf(b)===0&&S(+E.data.slice(b.length))}})(typeof self>"u"?a===void 0?this:a:self)}).call(this,typeof Ro<"u"?Ro:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(hc)),hc.exports}var L2=A2();const Qf=p0(L2),xo=()=>new Date().toISOString().split("T")[0],ep=(r,t)=>{const e=window.URL.createObjectURL(r),s=document.createElement("a");s.href=e,s.download=t,s.click(),window.URL.revokeObjectURL(e)},tp=()=>new Promise((r,t)=>{if(window.svguitar){r();return}const e=document.createElement("script");e.src="https://omnibrain.github.io/svguitar/js/svguitar.umd.js",e.async=!0,e.onload=()=>r(),e.onerror=()=>t(new Error("Failed to load SVGuitar library")),document.body.appendChild(e)}),E2=r=>{const t=document.createElement("div");t.style.position="absolute",t.style.left="-9999px",t.style.top="-9999px",document.body.appendChild(t);try{const e=new window.svguitar.SVGuitarChord(t),s={strings:r.numStrings||6,frets:r.numFrets||5,position:r.startingFret||1,tuning:[],width:150,height:165,fretSize:1.2,fingerSize:.75,sidePadding:.2,fontFamily:"Arial, sans-serif",color:"#333333",backgroundColor:"transparent",strokeColor:"#333333",textColor:"#333333",fretLabelColor:"#333333",fingerTextColor:"#ffffff",fingerTextSize:28,title:r.title||""},d={fingers:[...(r.fingers||[]).map(h=>{const[p,b,m]=h;return m&&m!=="undefined"?[p,b,m]:[p,b]}),...(r.openStrings||[]).map(h=>[h,0]),...(r.mutedStrings||[]).map(h=>[h,"x"])],barres:r.barres||[]};e.configure(s).chord(d).draw();const o=t.querySelector("svg");if(!o)throw new Error("SVG not rendered");return new XMLSerializer().serializeToString(o)}finally{document.body.removeChild(t)}},P2=(r,t,e)=>new Promise((s,i)=>{const a=document.createElement("canvas");a.width=t,a.height=e;const d=a.getContext("2d");d.fillStyle="white",d.fillRect(0,0,t,e);const o=new Image,c=new Blob([r],{type:"image/svg+xml;charset=utf-8"}),h=URL.createObjectURL(c);o.onload=()=>{d.drawImage(o,0,0,t,e),URL.revokeObjectURL(h),s(a.toDataURL("image/png"))},o.onerror=p=>{URL.revokeObjectURL(h),i(new Error("Failed to load SVG into image"))},o.src=h}),Yc=async(r,t)=>{const e=await fetch(r);if(!e.ok)throw new Error(`Download failed: ${e.statusText}`);const s=await e.blob(),i=window.URL.createObjectURL(s),a=document.createElement("a");a.href=i;const d=e.headers.get("Content-Disposition"),o=d==null?void 0:d.match(/filename="?([^";\n]+)"?/);a.download=(o==null?void 0:o[1])??t,a.click(),window.URL.revokeObjectURL(i)},T2=async(r="json")=>Yc(`/api/user/export/items?format=${r}`,`items-${xo()}.${r}`),I2=async(r="json")=>Yc(`/api/user/export/routines?format=${r}`,`routines-${xo()}.${r}`),F2=async()=>Yc("/api/user/export/chord-charts",`chord-charts-${xo()}.json`),O2=async()=>{await tp();const r=xo(),t=await fetch("/api/user/export/all");if(!t.ok)throw new Error(`Failed to fetch export data: ${t.statusText}`);const e=await t.blob(),s=await Qf.loadAsync(e),i=await fetch("/api/user/export/chord-charts");if(!i.ok)throw new Error(`Failed to fetch chord charts: ${i.statusText}`);const a=await i.json();if(a.items&&a.items.length>0){for(const o of a.items)if(!(!o.charts||o.charts.length===0))try{const c=await np(o,r),p=`ChordChartPDFs/${rp(o.item_title||"Untitled")} - Chord Charts.pdf`;s.file(p,c)}catch(c){console.error(`Failed to generate PDF for "${o.item_title}":`,c)}}const d=await s.generateAsync({type:"blob"});ep(d,`gpra-export-${r}.zip`)},rp=r=>r.replace(/[/\\:*?"<>|]/g,"-").trim(),np=async(r,t)=>{const e=new Ut({orientation:"landscape",unit:"mm",format:"a4"}),s=e.internal.pageSize.getWidth(),i=e.internal.pageSize.getHeight(),a=10,d=s-a*2,o=5,c=d/o,h=c-6,p=h*11/10,b=p+2;let m=a;const u=()=>{e.addPage(),m=a};e.setFontSize(14),e.setFont("helvetica","bold"),e.text(r.item_title||"Untitled",a,m),m+=6,r.tuning&&(e.setFontSize(9),e.setFont("helvetica","italic"),e.text(`Tuning: ${r.tuning}`,a,m),m+=5);const w=r.charts.reduce((N,y)=>{const S=y.sectionLabel||"General";return N[S]=N[S]||[],N[S].push(y),N},{});for(const[N,y]of Object.entries(w)){m+b+8>i-a&&u(),e.setFontSize(10),e.setFont("helvetica","bold"),e.text(N,a,m),m+=5;let S=0,L=0;for(const E of y){S>=o&&(S=0,m+=L+3,L=0,m+b>i-a&&u());const I=a+S*c,K=m;try{const Y=E2(E),V=await P2(Y,300,330),O=I+(c-h)/2;e.addImage(V,"PNG",O,K,h,p)}catch(Y){console.error("Failed to render chord:",E.title,Y),e.setDrawColor(150),e.rect(I+2,K,c-6,p),e.setFontSize(9),e.setFont("helvetica","bold"),e.text(E.title||"Unknown",I+4,K+15),e.setFontSize(7),e.setFont("helvetica","normal"),e.text("(Render failed)",I+4,K+22)}L=Math.max(L,b),S++}m+=L+5}const g=e.internal.getNumberOfPages();for(let N=1;N<=g;N++)e.setPage(N),e.setFontSize(8),e.setFont("helvetica","normal"),e.setTextColor(128),e.text(`Guitar Practice Routine App - Exported ${t} - Page ${N} of ${g}`,a,i-5),e.setTextColor(0);return e.output("arraybuffer")},R2=async()=>{await tp();const r=await fetch("/api/user/export/chord-charts");if(!r.ok)throw new Error(`Failed to fetch chord charts: ${r.statusText}`);const t=await r.json();if(!t.items||t.items.length===0)throw new Error("No chord charts to export");const e=xo(),s=new Qf;for(const a of t.items){if(!a.charts||a.charts.length===0)continue;const d=await np(a,e),c=`${rp(a.item_title||"Untitled")} - Chord Charts.pdf`;s.file(c,d)}const i=await s.generateAsync({type:"blob"});ep(i,`chord-charts-${e}.zip`)},D2=()=>{var bs,Ar;const[r,t]=U.useState(""),[e,s]=U.useState(!1),[i,a]=U.useState(null),[d,o]=U.useState(!1),[c,h]=U.useState(!1),[p,b]=U.useState(!1),[m,u]=U.useState(null),[w,g]=U.useState(null),[N,y]=U.useState({username:"",email:"",tier:"free",oauth_providers:[],unplugged_mode:!1}),[S,L]=U.useState(0),[E,I]=U.useState(1),[K,Y]=U.useState(!1),[V,O]=U.useState(0),[Q,F]=U.useState(!1),[k,M]=U.useState(!1),[_,te]=U.useState(!1),[ae,re]=U.useState(!1),[se,ie]=U.useState(!1),[je,ne]=U.useState(!1),[A,H]=U.useState(null),[Z,X]=U.useState(""),[pe,ve]=U.useState(""),[ke,Ae]=U.useState(""),[De,Me]=U.useState({current:!1,new:!1,confirm:!1}),[Ke,Se]=U.useState(!1),[j,P]=U.useState(null),[G,$]=U.useState(!1),[z,B]=U.useState(!1),[he,me]=U.useState(!1),[de,Le]=U.useState(""),[Ie,Te]=U.useState(""),[Ye,ft]=U.useState(!1),[at,lt]=U.useState(!1),[bt,ut]=U.useState(null),[Yt,gt]=U.useState(null),[Et,qt]=U.useState("settings"),[Pt,vt]=U.useState(()=>{const Ve=localStorage.getItem("gpra_timer_volume");return Ve!==null?parseFloat(Ve):5.5}),[Zt,_t]=U.useState(null),[Ot,ir]=U.useState(!1),Rt=U.useRef(null),yt=U.useRef(null),Qt=U.useRef(null),[tr,Br]=U.useState(()=>{const Ve={overview:!0,timerVolume:!0,apiKey:!0,practiceData:!0,changePassword:!0,analytics:!0,guidedTour:!0,dangerZone:!0},pt=sessionStorage.getItem("accountSettingsCollapsed");return pt?{...Ve,...JSON.parse(pt)}:Ve});U.useEffect(()=>{sessionStorage.setItem("accountSettingsCollapsed",JSON.stringify(tr))},[tr]),U.useEffect(()=>{wn(),rn(),zt(),Wr();const Ve=localStorage.getItem("cookieConsent"),pt=document.cookie.split(";").some(hr=>{const Vr=hr.trim().split("=")[0];return/^ph.*phc_/.test(Vr)});$(Ve==="all"&&pt)},[]);const wn=async()=>{try{const Ve=await fetch("/api/user/api-key");if(Ve.ok){const pt=await Ve.json();s(pt.has_key),a(pt.updated_at)}}catch(Ve){console.error("Error fetching API key status:",Ve)}},rn=async()=>{try{const Ve=await fetch("/api/auth/status");if(Ve.ok){const pt=await Ve.json();y({username:pt.user||"",email:pt.email||"",tier:pt.tier||"free",oauth_providers:pt.oauth_providers||[],unplugged_mode:pt.unplugged_mode||!1}),I({free:1,basic:5,thegoods:10,moregoods:25,themost:50}[pt.tier]||1)}}catch(Ve){console.error("Error fetching user profile:",Ve)}},zt=async()=>{try{const Ve=await fetch("/api/routines");if(Ve.ok){const pt=await Ve.json();L(Array.isArray(pt)?pt.length:0)}}catch(Ve){console.error("Error fetching routine count:",Ve)}},mn=async()=>{if(!r.trim()){u({type:"error",text:"Please enter an API key"});return}b(!0),u(null),g(null);try{const pt=await(await fetch("/api/user/api-key/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:r})})).json();pt.valid?(g(!0),u({type:"success",text:"API key is valid!"})):(g(!1),u({type:"error",text:pt.error||"Invalid API key"}))}catch{g(!1),u({type:"error",text:"Error validating API key"})}finally{b(!1)}},vn=async()=>{if(!r.trim()){u({type:"error",text:"Please enter an API key"});return}h(!0),u(null);try{const Ve=await fetch("/api/user/api-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({api_key:r})}),pt=await Ve.json();Ve.ok?(u({type:"success",text:"API key saved successfully!"}),s(!0),t(""),o(!1),g(null),await wn()):u({type:"error",text:pt.error||"Failed to save API key"})}catch{u({type:"error",text:"Error saving API key"})}finally{h(!1)}},Yr=async()=>{if(confirm("Are you sure you want to delete your API key? You will need to enter it again to use autocreate.")){h(!0),u(null);try{(await fetch("/api/user/api-key",{method:"DELETE"})).ok?(u({type:"success",text:"API key deleted successfully"}),s(!1),a(null),t(""),g(null)):u({type:"error",text:"Failed to delete API key"})}catch{u({type:"error",text:"Error deleting API key"})}finally{h(!1)}}},Wr=async()=>{try{const pt=await(await fetch("/api/user/practice-data/expiration-warning")).json();pt.has_expiring_data&&pt.days_until_expiration<=7&&(Y(!0),O(pt.days_until_expiration))}catch(Ve){console.error("Error fetching expiration warning:",Ve)}},yr=async(Ve="csv")=>{F(!0);try{const hr=await(await fetch(`/api/user/practice-data/download?format=${Ve}`)).blob(),Vr=window.URL.createObjectURL(hr),zr=document.createElement("a");zr.href=Vr,zr.download=`practice-data-${new Date().toISOString().split("T")[0]}.${Ve}`,zr.click(),window.URL.revokeObjectURL(Vr),Y(!1)}catch(pt){console.error("Download failed:",pt)}finally{F(!1)}},Lr=async Ve=>{M(!0),H(null);try{await T2(Ve)}catch(pt){console.error("Download items failed:",pt),H(`Failed to download items: ${pt.message}`)}finally{M(!1)}},ur=async Ve=>{te(!0),H(null);try{await I2(Ve)}catch(pt){console.error("Download routines failed:",pt),H(`Failed to download routines: ${pt.message}`)}finally{te(!1)}},ns=async()=>{re(!0),H(null);try{await F2()}catch(Ve){console.error("Download chord charts JSON failed:",Ve),H(`Failed to download chord charts: ${Ve.message}`)}finally{re(!1)}},vr=async()=>{ie(!0),H(null);try{await R2()}catch(Ve){console.error("Generate chord charts PDF failed:",Ve),H(`Failed to generate PDF: ${Ve.message}`)}finally{ie(!1)}},kn=async()=>{ne(!0),H(null);try{await O2()}catch(Ve){console.error("Download all data failed:",Ve),H(`Failed to download data bundle: ${Ve.message}`)}finally{ne(!1)}},nn=async Ve=>{try{await fetch("/api/user/practice-data/dismiss-reminder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dismiss_duration_days:Ve})}),Y(!1)}catch(pt){console.error("Error dismissing reminder:",pt)}},Cn=async()=>{try{await fetch("/api/user/preferences/tour-reset",{method:"POST",headers:{"Content-Type":"application/json"}}),window.location.href="/?show_tour=1"}catch(Ve){console.error("Error restarting tour:",Ve),window.location.href="/?show_tour=1"}},Hr=Ve=>Ve.length<14?"Password must be at least 14 characters long":/[A-Z]/.test(Ve)?/[a-z]/.test(Ve)?/[0-9]/.test(Ve)?/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>?]/.test(Ve)?null:"Password must contain at least one symbol or punctuation character":"Password must contain at least one number":"Password must contain at least one lowercase letter":"Password must contain at least one uppercase letter",Jr=Ve=>({free:"Free",basic:"Basic",thegoods:"The Goods",moregoods:"More Goods",themost:"The Most"})[Ve]||"Free",Pn=Ve=>{const pt={free:"bg-gray-600 text-gray-200",basic:"bg-blue-600 text-blue-100",thegoods:"bg-green-600 text-green-100",moregoods:"bg-purple-600 text-purple-100",themost:"bg-orange-600 text-orange-100"};return pt[Ve]||pt.free},ct=(Ve,pt)=>{if(pt===1/0)return"text-green-400";const hr=Ve/pt*100;return hr>=100?"text-red-400":hr>=80?"text-yellow-400":"text-green-400"},Zr=Ve=>{Br(pt=>({...pt,[Ve]:!pt[Ve]}))},ye=async Ve=>{if(Ve.preventDefault(),P(null),!Z||!pe||!ke){P({type:"error",text:"All fields are required"});return}if(pe!==ke){P({type:"error",text:"New passwords do not match"});return}const pt=Hr(pe);if(pt){P({type:"error",text:pt});return}Se(!0);try{const hr=await fetch("/api/user/password-change",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({current_password:Z,new_password:pe,confirm_password:ke})}),Vr=await hr.json();hr.ok?(P({type:"success",text:"Password changed successfully!"}),X(""),ve(""),Ae("")):P({type:"error",text:Vr.error||"Failed to change password"})}catch{P({type:"error",text:"Error changing password"})}finally{Se(!1)}},qe=Ve=>{const pt=document.cookie.split(";");for(let hr=0;hr<pt.length;hr++){const Vr=pt[hr],zr=Vr.indexOf("="),Er=zr>-1?Vr.substring(0,zr).trim():Vr.trim();Ve.test(Er)&&(document.cookie=Er+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/",document.cookie=Er+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain="+window.location.hostname,document.cookie=Er+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=."+window.location.hostname)}},He=async()=>{const Ve=G?"essential":"all";localStorage.setItem("cookieConsent",Ve);try{const pt=await fetch("/api/csrf-token"),{csrf_token:hr}=await pt.json();await fetch("/api/consent",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":hr},body:JSON.stringify({consent:Ve})})}catch(pt){console.error("[AccountSettings] Failed to save consent to server:",pt)}G?(typeof posthog<"u"&&posthog.opt_out_capturing&&posthog.opt_out_capturing(),qe(/^ph_phc_/),Object.keys(localStorage).forEach(pt=>{(pt.startsWith("ph_")||pt.includes("posthog"))&&localStorage.removeItem(pt)})):typeof posthog<"u"&&posthog.opt_in_capturing&&posthog.opt_in_capturing(),window.location.reload()},et=()=>{Le(N.username),B(!0),ut(null)},it=()=>{B(!1),Le(""),ut(null)},rt=async()=>{const Ve=de.trim();if(!Ve){ut({type:"error",text:"Username is required"});return}if(Ve.length<3){ut({type:"error",text:"Username must be at least 3 characters"});return}if(Ve===N.username){B(!1);return}ft(!0),ut(null);try{const pt=await fetch("/api/user/username",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:Ve})}),hr=await pt.json();pt.ok?(y(Vr=>({...Vr,username:hr.username})),B(!1),ut({type:"success",text:"Username updated!"}),setTimeout(()=>ut(null),3e3)):ut({type:"error",text:hr.error||"Failed to update username"})}catch{ut({type:"error",text:"Error updating username"})}finally{ft(!1)}},nt=()=>{Te(N.email),me(!0),gt(null)},ot=()=>{me(!1),Te(""),gt(null)},At=async()=>{const Ve=Ie.trim().toLowerCase();if(!Ve){gt({type:"error",text:"Email is required"});return}if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(Ve)){gt({type:"error",text:"Please enter a valid email address"});return}if(Ve===N.email){me(!1);return}lt(!0),gt(null);try{const hr=await fetch("/api/user/email",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:Ve})}),Vr=await hr.json();hr.ok?(y(zr=>({...zr,email:Vr.email})),me(!1),gt({type:"success",text:"Email updated!"}),setTimeout(()=>gt(null),3e3)):gt({type:"error",text:Vr.error||"Failed to update email"})}catch{gt({type:"error",text:"Error updating email"})}finally{lt(!1)}},jt=(bs=N.oauth_providers)==null?void 0:bs.includes("tidal"),Wt=(Ar=N.oauth_providers)==null?void 0:Ar.includes("google"),Jt=!jt,xt=!Wt,Ht=()=>{if(Rt.current){try{Rt.current.stop()}catch{}Rt.current=null}ir(!1)},or=async()=>{if(Ot){Ht();return}try{yt.current||(yt.current=new(window.AudioContext||window.webkitAudioContext),Qt.current=yt.current.createGain(),Qt.current.connect(yt.current.destination)),yt.current.state==="suspended"&&await yt.current.resume(),Qt.current.gain.value=Pt/11*3;const pt=await(await fetch("/static/sound/timesUp.mp3")).arrayBuffer(),hr=await yt.current.decodeAudioData(pt);Ht(),Rt.current=yt.current.createBufferSource(),Rt.current.buffer=hr,Rt.current.connect(Qt.current),Rt.current.onended=()=>{ir(!1),Rt.current=null},Rt.current.start(),ir(!0)}catch(Ve){console.error("Error playing test sound:",Ve),ir(!1)}},Tn=()=>{Ht(),localStorage.setItem("gpra_timer_volume",Pt.toString()),_t({type:"success",text:"Volume saved!"}),setTimeout(()=>_t(null),2e3)};return U.useEffect(()=>()=>{Ht(),yt.current&&yt.current.close()},[]),U.useEffect(()=>{tr.timerVolume&&Ht()},[tr.timerVolume]),U.useEffect(()=>{Qt.current&&Ot&&(Qt.current.gain.value=Pt/11*3)},[Pt,Ot]),n.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4",children:[n.jsx("h1",{className:"text-3xl font-bold mb-6 text-gray-100",children:"Account Settings"}),n.jsxs("div",{className:"flex gap-2 mb-4 md:hidden",children:[n.jsx(Be,{variant:Et==="settings"?"default":"outline",onClick:()=>qt("settings"),className:Et==="settings"?"bg-orange-600":"bg-gray-700 border-gray-600","data-ph-capture-attribute-button":"mobile-view-settings",children:"Settings"}),n.jsx(Be,{variant:Et==="subscription"?"default":"outline",onClick:()=>qt("subscription"),className:Et==="subscription"?"bg-orange-600":"bg-gray-700 border-gray-600","data-ph-capture-attribute-button":"mobile-view-subscription",children:"Subscription"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:`space-y-6 md:block ${Et==="settings"?"":"hidden"}`,children:[n.jsxs(cn,{className:"bg-gray-800 border-gray-700",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>Zr("overview"),"data-ph-capture-attribute-toggle":"settings-overview-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(dn,{className:"text-gray-100",children:N.username||"Loading..."}),n.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-sm font-medium ${Pn(N.tier)}`,children:Jr(N.tier)}),n.jsxs("span",{className:`text-sm font-medium ${ct(S,E)}`,children:[S," / ",E===1/0?"âˆž":E," routines"]})]}),tr.overview?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!tr.overview&&n.jsx(un,{className:"pt-0",children:n.jsx("div",{className:"flex items-start gap-6 flex-wrap",children:n.jsxs("div",{className:"flex-1 min-w-[200px] space-y-3",children:[n.jsxs("div",{children:[z?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Dr,{value:de,onChange:Ve=>Le(Ve.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 text-lg font-bold h-9 max-w-[200px]",placeholder:"Username",disabled:Ye,onKeyDown:Ve=>{Ve.key==="Enter"&&!Ve.shiftKey&&rt(),Ve.key==="Escape"&&it()},autoFocus:!0}),n.jsx(Be,{size:"sm",onClick:rt,disabled:Ye,className:"bg-green-600 hover:bg-green-700 h-8 px-2",children:Ye?n.jsx(Rr,{className:"w-4 h-4 animate-spin"}):n.jsx(_n,{className:"w-4 h-4"})}),n.jsx(Be,{size:"sm",variant:"outline",onClick:it,disabled:Ye,className:"bg-gray-700 border-gray-600 h-8 px-2",children:n.jsx(Gr,{className:"w-4 h-4"})})]}):n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("h2",{className:"text-xl font-bold text-gray-100",children:N.username||"Loading..."}),Jt&&n.jsx("button",{onClick:et,className:"text-gray-400 hover:text-gray-200 p-1",title:"Edit username","aria-label":"Edit username","data-ph-capture-attribute-button":"edit-username",children:n.jsx(uo,{className:"w-4 h-4","aria-hidden":"true"})})]}),!Jt&&!z&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You log in with your Tidal account, so you can't change your username here."}),bt&&n.jsx("p",{className:`text-xs mt-1 ${bt.type==="success"?"text-green-400":"text-red-400"}`,children:bt.text})]}),n.jsxs("div",{children:[he?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Dr,{type:"email",value:Ie,onChange:Ve=>Te(Ve.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 text-sm h-8 max-w-[250px]",placeholder:"Email",disabled:at,onKeyDown:Ve=>{Ve.key==="Enter"&&!Ve.shiftKey&&At(),Ve.key==="Escape"&&ot()},autoFocus:!0}),n.jsx(Be,{size:"sm",onClick:At,disabled:at,className:"bg-green-600 hover:bg-green-700 h-8 px-2",children:at?n.jsx(Rr,{className:"w-4 h-4 animate-spin"}):n.jsx(_n,{className:"w-4 h-4"})}),n.jsx(Be,{size:"sm",variant:"outline",onClick:ot,disabled:at,className:"bg-gray-700 border-gray-600 h-8 px-2",children:n.jsx(Gr,{className:"w-4 h-4"})})]}):n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("p",{className:"text-sm text-gray-400",children:N.email||"Loading..."}),xt&&n.jsx("button",{onClick:nt,className:"text-gray-400 hover:text-gray-200 p-1",title:"Edit email","aria-label":"Edit email","data-ph-capture-attribute-button":"edit-email",children:n.jsx(uo,{className:"w-4 h-4","aria-hidden":"true"})})]}),!xt&&!he&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"You log in with your Google account, so you can't change your email address here."}),jt&&xt&&!he&&n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add your real email address to get reminders if you haven't used the account for 90 days."}),Yt&&n.jsx("p",{className:`text-xs mt-1 ${Yt.type==="success"?"text-green-400":"text-red-400"}`,children:Yt.text})]}),N.oauth_providers&&N.oauth_providers.includes("tidal")&&n.jsx("div",{className:"flex gap-2 flex-wrap",children:n.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-gray-700 text-gray-300 rounded border border-gray-600",children:[n.jsx("img",{src:"/static/images/tidal-logo.png",alt:"Tidal",className:"w-4 h-4 rounded"}),"Tidal"]})})]})})})]}),n.jsxs(cn,{className:"bg-gray-800 border-gray-700",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>Zr("timerVolume"),"data-ph-capture-attribute-toggle":"settings-timer-volume-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(dn,{className:"text-gray-100",children:"Time's up sound level"}),n.jsx(Os,{className:"text-gray-400",children:"Set the volume for the timer completion sound"})]}),tr.timerVolume?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!tr.timerVolume&&n.jsxs(un,{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs(Hn,{htmlFor:"timer-volume",className:"text-gray-200 flex items-center gap-2",children:[n.jsx(L0,{className:"w-4 h-4"}),"Volume level"]}),n.jsx("span",{className:"text-sm font-mono text-orange-400 bg-gray-900 px-2 py-1 rounded",children:Pt.toFixed(1)})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("span",{className:"text-xs text-gray-500",children:"0"}),n.jsx("input",{id:"timer-volume",type:"range",min:"0",max:"11",step:"0.1",value:Pt,onChange:Ve=>vt(parseFloat(Ve.target.value)),className:"flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-orange-500"}),n.jsx("span",{className:"text-xs text-gray-500",children:"11"})]}),n.jsx("p",{className:"text-xs text-gray-500 italic",children:"These go to eleven. ðŸŽ¸"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Be,{onClick:or,variant:"outline",size:"sm",className:`bg-gray-700 hover:bg-gray-600 border-gray-600 ${Ot?"ring-2 ring-orange-500":""}`,children:Ot?n.jsxs(n.Fragment,{children:[n.jsx(j0,{className:"w-4 h-4 mr-2"}),"Stop"]}):n.jsxs(n.Fragment,{children:[n.jsx(Od,{className:"w-4 h-4 mr-2"}),"Test sound"]})}),n.jsx("span",{className:"text-xs text-gray-400",children:Ot?"Click to stop":"Preview at current level"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs(Be,{onClick:Tn,className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"save-timer-volume",children:[n.jsx(_n,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Save"]}),Zt&&n.jsx("span",{className:`text-sm ${Zt.type==="success"?"text-green-400":"text-red-400"}`,children:Zt.text})]})]})]}),n.jsxs(cn,{className:"bg-gray-800 border-gray-700",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>Zr("apiKey"),"data-tour":"api-key-card-header","data-ph-capture-attribute-toggle":"settings-api-key-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{children:n.jsx(dn,{className:"text-gray-100",children:"Anthropic API key"})}),tr.apiKey?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!tr.apiKey&&n.jsxs(un,{className:"space-y-4",children:[n.jsxs("div",{className:"bg-blue-900/30 border border-blue-700 rounded-md p-4",children:[n.jsx("h3",{className:"text-sm font-semibold text-blue-300 mb-2",children:"About API keys"}),n.jsxs("ul",{className:"text-sm text-gray-300 space-y-1 list-disc list-inside",children:[n.jsxs("li",{children:[n.jsx("strong",{children:"Free/Basic tiers:"})," Provide your own API key to autocreate chord charts"]}),n.jsxs("li",{children:[n.jsx("strong",{children:"The Goods+ tiers:"})," Optional. Autocreated chord charts already included, but you can use your own key if you're hitting rate limits"]}),n.jsx("li",{children:"Your key is encrypted and stored securely"}),n.jsxs("li",{children:["Get your API key from"," ",n.jsxs("a",{href:"https://console.anthropic.com/",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 inline-flex items-center gap-1",children:["Anthropic Console",n.jsx(vh,{className:"w-3 h-3"})]})]})]})]}),e&&n.jsxs(ms,{className:"bg-green-900/30 border-green-700",children:[n.jsx(_n,{className:"h-4 w-4 text-green-400"}),n.jsxs(gs,{className:"text-gray-300",children:["API key configured",i&&n.jsxs("span",{className:"text-gray-400 ml-2",children:["(updated ",new Date(i).toLocaleDateString(),")"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"api-key",className:"text-gray-200",children:e?"Update API key":"Paste API key"}),n.jsxs("div",{className:"flex gap-2","data-tour":"api-key-input",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Dr,{id:"api-key",type:d?"text":"password",value:r,onChange:Ve=>{t(Ve.target.value),g(null),u(null)},placeholder:"sk-ant-api03-...",className:"bg-gray-900 border-gray-600 text-gray-100 pr-10",disabled:c||p}),n.jsx("button",{type:"button",onClick:()=>o(!d),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",disabled:c||p,"aria-label":d?"Hide API key":"Show API key","data-ph-capture-attribute-button":"toggle-api-key-visibility",children:d?n.jsx(Do,{className:"w-4 h-4","aria-hidden":"true"}):n.jsx(Bo,{className:"w-4 h-4","aria-hidden":"true"})})]}),n.jsx(Be,{onClick:mn,disabled:!r.trim()||c||p,variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"validate-api-key",children:p?n.jsx(Rr,{className:"w-4 h-4 animate-spin","aria-hidden":"true"}):"Validate"})]})]}),w!==null&&n.jsxs(ms,{className:w?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:[w?n.jsx(_n,{className:"h-4 w-4 text-green-400"}):n.jsx(Gr,{className:"h-4 w-4 text-red-400"}),n.jsx(gs,{className:"text-gray-300",children:w?"API key is valid!":(m==null?void 0:m.text)||"Invalid API key"})]}),m&&w===null&&n.jsxs(ms,{className:m.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:[m.type==="success"?n.jsx(_n,{className:"h-4 w-4 text-green-400"}):n.jsx(Gr,{className:"h-4 w-4 text-red-400"}),n.jsx(gs,{className:"text-gray-300",children:m.text})]}),n.jsxs("div",{className:"flex gap-3",children:[n.jsx(Be,{onClick:vn,disabled:!r.trim()||c||p,className:"bg-orange-600 hover:bg-orange-700 flex-1","data-ph-capture-attribute-button":"save-api-key",children:c?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin","aria-hidden":"true"}),"Saving..."]}):n.jsxs(n.Fragment,{children:[n.jsx(_n,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Save API key"]})}),e&&n.jsx(Be,{onClick:Yr,disabled:c,variant:"destructive",className:"bg-red-900 hover:bg-red-800","aria-label":"Delete API key","data-ph-capture-attribute-button":"delete-api-key",children:n.jsx(Sh,{className:"w-4 h-4","aria-hidden":"true"})})]})]})]}),n.jsxs(cn,{className:"bg-gray-800 border-gray-700",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>Zr("practiceData"),"data-ph-capture-attribute-toggle":"settings-practice-data-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(dn,{className:"text-gray-100",children:"Download your data"}),n.jsx(Os,{className:"text-gray-400",children:"Export your practice data, items, routines, and chord charts"})]}),tr.practiceData?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!tr.practiceData&&n.jsxs(un,{className:"space-y-6",children:[A&&n.jsxs(ms,{className:"bg-red-900/30 border-red-700",children:[n.jsx(Gr,{className:"h-4 w-4 text-red-400"}),n.jsx(gs,{className:"text-gray-300",children:A})]}),K&&n.jsx(ms,{className:"bg-orange-900/30 border-orange-700",children:n.jsxs(gs,{className:"text-gray-300",children:["You have practice data that will be deleted in ",V," days. Download it to keep your records!",n.jsxs("div",{className:"flex gap-2 mt-3 flex-wrap",children:[n.jsx(Be,{onClick:()=>yr("csv"),size:"sm",className:"bg-orange-600 hover:bg-orange-700",children:"Download now"}),n.jsx(Be,{onClick:()=>nn(1),variant:"outline",size:"sm",className:"border-gray-600",children:"Remind me tomorrow"}),n.jsx(Be,{onClick:()=>nn(90),variant:"outline",size:"sm",className:"border-gray-600",children:"Don't care"})]})]})}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"Practice history (last 90 days)"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs(Be,{onClick:()=>yr("csv"),disabled:Q,size:"sm",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"download-practice-csv",children:[Q?n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"CSV"]}),n.jsxs(Be,{onClick:()=>yr("json"),disabled:Q,size:"sm",variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"download-practice-json",children:[Q?n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"JSON"]})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Practice data is automatically deleted after 90 days."})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"All practice items"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs(Be,{onClick:()=>Lr("csv"),disabled:k,size:"sm",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"download-items-csv",children:[k?n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"CSV"]}),n.jsxs(Be,{onClick:()=>Lr("json"),disabled:k,size:"sm",variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"download-items-json",children:[k?n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"JSON"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"All routines"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs(Be,{onClick:()=>ur("csv"),disabled:_,size:"sm",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"download-routines-csv",children:[_?n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"CSV"]}),n.jsxs(Be,{onClick:()=>ur("json"),disabled:_,size:"sm",variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"download-routines-json",children:[_?n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"JSON"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"All chord charts"}),n.jsxs("div",{className:"flex gap-2 flex-wrap",children:[n.jsxs(Be,{onClick:vr,disabled:se,size:"sm",className:"bg-orange-600 hover:bg-orange-700","data-ph-capture-attribute-button":"download-chords-pdf",children:[se?n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"PDF"]}),n.jsxs(Be,{onClick:ns,disabled:ae,size:"sm",variant:"outline",className:"bg-gray-700 hover:bg-gray-600 border-gray-600","data-ph-capture-attribute-button":"download-chords-json",children:[ae?n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}):n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"JSON"]})]})]}),n.jsx("div",{className:"border-t border-gray-700 pt-4",children:n.jsxs("div",{className:"space-y-2",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"Download all your data"}),n.jsx("p",{className:"text-xs text-gray-400 mb-2",children:"Get everything in one ZIP file: items, routines, chord charts, and practice history."}),n.jsx(Be,{onClick:kn,disabled:je,className:"bg-orange-600 hover:bg-orange-700 w-full sm:w-auto","data-ph-capture-attribute-button":"download-all-zip",children:je?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}),"Preparing ZIP..."]}):n.jsxs(n.Fragment,{children:[n.jsx(Zs,{className:"w-4 h-4 mr-2"}),"Download ZIP"]})})]})})]})]}),n.jsxs(cn,{className:"bg-gray-800 border-gray-700",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>Zr("changePassword"),"data-ph-capture-attribute-toggle":"settings-change-password-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(dn,{className:"text-gray-100",children:"Change password"}),n.jsx(Os,{className:"text-gray-400",children:"Update your account password"})]}),tr.changePassword?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!tr.changePassword&&n.jsx(un,{children:Wt||jt?n.jsx("p",{className:"text-sm text-gray-400",children:Wt?"You log in with Google, so you have no password here to change.":"You log in with Tidal, so you have no password here to change."}):n.jsxs("form",{onSubmit:ye,className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"current-password",className:"text-gray-200",children:"Current password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{id:"current-password",type:De.current?"text":"password",value:Z,onChange:Ve=>X(Ve.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 pr-10",disabled:Ke}),n.jsx("button",{type:"button",onClick:()=>Me(Ve=>({...Ve,current:!Ve.current})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",disabled:Ke,children:De.current?n.jsx(Do,{className:"w-4 h-4"}):n.jsx(Bo,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"new-password",className:"text-gray-200",children:"New password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{id:"new-password",type:De.new?"text":"password",value:pe,onChange:Ve=>ve(Ve.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 pr-10",disabled:Ke}),n.jsx("button",{type:"button",onClick:()=>Me(Ve=>({...Ve,new:!Ve.new})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",disabled:Ke,children:De.new?n.jsx(Do,{className:"w-4 h-4"}):n.jsx(Bo,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(Hn,{htmlFor:"confirm-password",className:"text-gray-200",children:"Confirm new password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Dr,{id:"confirm-password",type:De.confirm?"text":"password",value:ke,onChange:Ve=>Ae(Ve.target.value),className:"bg-gray-900 border-gray-600 text-gray-100 pr-10",disabled:Ke}),n.jsx("button",{type:"button",onClick:()=>Me(Ve=>({...Ve,confirm:!Ve.confirm})),className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-300",disabled:Ke,children:De.confirm?n.jsx(Do,{className:"w-4 h-4"}):n.jsx(Bo,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"bg-blue-900/30 border border-blue-700 rounded-md p-3",children:[n.jsx("h4",{className:"text-sm font-semibold text-blue-300 mb-1",children:"Password requirements:"}),n.jsxs("ul",{className:"text-xs text-gray-300 space-y-0.5 list-disc list-inside",children:[n.jsx("li",{children:"At least 14 characters long"}),n.jsx("li",{children:"At least one uppercase letter"}),n.jsx("li",{children:"At least one lowercase letter"}),n.jsx("li",{children:"At least one number"}),n.jsx("li",{children:"At least one symbol or punctuation character"})]})]}),j&&n.jsxs(ms,{className:j.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700",children:[j.type==="success"?n.jsx(_n,{className:"h-4 w-4 text-green-400"}):n.jsx(Gr,{className:"h-4 w-4 text-red-400"}),n.jsx(gs,{className:"text-gray-300",children:j.text})]}),n.jsx(Be,{type:"submit",disabled:Ke||!Z||!pe||!ke,className:"bg-orange-600 hover:bg-orange-700 w-full",children:Ke?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}),"Changing password..."]}):n.jsxs(n.Fragment,{children:[n.jsx(_n,{className:"w-4 h-4 mr-2"}),"Change password"]})})]})})]}),n.jsxs(cn,{className:"bg-gray-800 border-gray-700",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>Zr("analytics"),"data-ph-capture-attribute-toggle":"settings-analytics-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(dn,{className:"text-gray-100",children:"Analytics & privacy"}),n.jsx(Os,{className:"text-gray-400",children:"Control whether we can collect analytics"})]}),tr.analytics?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!tr.analytics&&n.jsxs(un,{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-start justify-between gap-4",children:[n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[n.jsx("h3",{className:"text-sm font-medium text-gray-200",children:"Allow analytics tracking"}),n.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded ${G?"bg-green-900/50 text-green-300":"bg-red-900/50 text-red-300"}`,children:G?"Allowed":"Disallowed"})]}),n.jsx("p",{className:"text-xs text-gray-400",children:"Help us improve GPRA by allowing usage analytics via PostHog cookies. (We'll never sell or share your data.)"})]}),n.jsx("button",{onClick:He,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 ${G?"bg-green-600 focus:ring-green-500":"bg-red-600 focus:ring-red-500"}`,role:"switch","aria-checked":G,children:n.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${G?"translate-x-6":"translate-x-1"}`})})]}),n.jsx("div",{className:"text-xs text-gray-500 pt-2 border-t border-gray-700",children:n.jsxs("p",{children:["Learn more about how we handle your data in our"," ",n.jsx("a",{href:"/privacy",target:"_blank",rel:"noopener noreferrer",className:"text-orange-400 hover:underline",children:"Privacy Policy"})]})})]})]}),n.jsxs(cn,{className:"bg-gray-800 border-gray-700",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>Zr("guidedTour"),"data-ph-capture-attribute-toggle":"settings-guided-tour-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(dn,{className:"text-gray-100",children:"Guided tour"}),n.jsx(Os,{className:"text-gray-400",children:"Take the intro tour again"})]}),tr.guidedTour?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!tr.guidedTour&&n.jsx(un,{children:n.jsxs(Be,{onClick:Cn,className:"bg-orange-600 hover:bg-orange-700 w-full","data-ph-capture-attribute-button":"restart-guided-tour",children:[n.jsx(Od,{className:"w-4 h-4 mr-2","aria-hidden":"true"}),"Restart tour"]})})]}),n.jsxs(cn,{className:"bg-gray-800 border-gray-700 border-red-900/50",children:[n.jsx(jn,{className:"cursor-pointer select-none",onClick:()=>Zr("dangerZone"),"data-ph-capture-attribute-toggle":"settings-danger-zone-card",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(dn,{className:"text-red-400",children:"Danger zone"}),n.jsx(Os,{className:"text-gray-400",children:"Pause your payments, or delete your account and all your data"})]}),tr.dangerZone?n.jsx(ps,{className:"w-5 h-5 text-gray-400"}):n.jsx(Qn,{className:"w-5 h-5 text-gray-400"})]})}),!tr.dangerZone&&n.jsx(un,{className:"p-0",children:n.jsx(Dm,{userTier:N.tier,unpluggedMode:N.unplugged_mode})})]})]}),n.jsx("div",{id:"subscription-card",className:`space-y-6 md:block ${Et==="subscription"?"":"hidden"}`,children:n.jsx(Rm,{currentTier:N.tier,onSubscriptionChange:rn})})]})]})};let Ec={},sp;function fc(r={}){Ec={animate:!0,allowClose:!0,overlayClickBehavior:"close",overlayOpacity:.7,smoothScroll:!1,disableActiveInteraction:!1,showProgress:!1,stagePadding:10,stageRadius:5,popoverOffset:10,showButtons:["next","previous","close"],disableButtons:[],overlayColor:"#000",...r}}function Ct(r){return r?Ec[r]:Ec}function B2(r){sp=r}function xs(){return sp}let gl={};function Ko(r,t){gl[r]=t}function si(r){var t;(t=gl[r])==null||t.call(gl)}function M2(){gl={}}function Xo(r,t,e,s){return(r/=s/2)<1?e/2*r*r+t:-e/2*(--r*(r-2)-1)+t}function ap(r){const t='a[href]:not([disabled]), button:not([disabled]), textarea:not([disabled]), input[type="text"]:not([disabled]), input[type="radio"]:not([disabled]), input[type="checkbox"]:not([disabled]), select:not([disabled])';return r.flatMap(e=>{const s=e.matches(t),i=Array.from(e.querySelectorAll(t));return[...s?[e]:[],...i]}).filter(e=>getComputedStyle(e).pointerEvents!=="none"&&q2(e))}function ip(r){if(!r||z2(r))return;const t=Ct("smoothScroll"),e=r.offsetHeight>window.innerHeight;r.scrollIntoView({behavior:!t||U2(r)?"auto":"smooth",inline:"center",block:e?"start":"center"})}function U2(r){if(!r||!r.parentElement)return;const t=r.parentElement;return t.scrollHeight>t.clientHeight}function z2(r){const t=r.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function q2(r){return!!(r.offsetWidth||r.offsetHeight||r.getClientRects().length)}let xl={};function Nn(r,t){xl[r]=t}function Bt(r){return r?xl[r]:xl}function sh(){xl={}}function $2(r,t,e,s){let i=Bt("__activeStagePosition");const a=i||e.getBoundingClientRect(),d=s.getBoundingClientRect(),o=Xo(r,a.x,d.x-a.x,t),c=Xo(r,a.y,d.y-a.y,t),h=Xo(r,a.width,d.width-a.width,t),p=Xo(r,a.height,d.height-a.height,t);i={x:o,y:c,width:h,height:p},lp(i),Nn("__activeStagePosition",i)}function op(r){if(!r)return;const t=r.getBoundingClientRect(),e={x:t.x,y:t.y,width:t.width,height:t.height};Nn("__activeStagePosition",e),lp(e)}function W2(){const r=Bt("__activeStagePosition"),t=Bt("__overlaySvg");if(!r)return;if(!t){console.warn("No stage svg found.");return}const e=window.innerWidth,s=window.innerHeight;t.setAttribute("viewBox",`0 0 ${e} ${s}`)}function H2(r){const t=V2(r);document.body.appendChild(t),up(t,e=>{e.target.tagName==="path"&&si("overlayClick")}),Nn("__overlaySvg",t)}function lp(r){const t=Bt("__overlaySvg");if(!t){H2(r);return}const e=t.firstElementChild;if((e==null?void 0:e.tagName)!=="path")throw new Error("no path element found in stage svg");e.setAttribute("d",cp(r))}function V2(r){const t=window.innerWidth,e=window.innerHeight,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.classList.add("driver-overlay","driver-overlay-animated"),s.setAttribute("viewBox",`0 0 ${t} ${e}`),s.setAttribute("xmlSpace","preserve"),s.setAttribute("xmlnsXlink","http://www.w3.org/1999/xlink"),s.setAttribute("version","1.1"),s.setAttribute("preserveAspectRatio","xMinYMin slice"),s.style.fillRule="evenodd",s.style.clipRule="evenodd",s.style.strokeLinejoin="round",s.style.strokeMiterlimit="2",s.style.zIndex="10000",s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%";const i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",cp(r)),i.style.fill=Ct("overlayColor")||"rgb(0,0,0)",i.style.opacity=`${Ct("overlayOpacity")}`,i.style.pointerEvents="auto",i.style.cursor="auto",s.appendChild(i),s}function cp(r){const t=window.innerWidth,e=window.innerHeight,s=Ct("stagePadding")||0,i=Ct("stageRadius")||0,a=r.width+s*2,d=r.height+s*2,o=Math.min(i,a/2,d/2),c=Math.floor(Math.max(o,0)),h=r.x-s+c,p=r.y-s,b=a-c*2,m=d-c*2;return`M${t},0L0,0L0,${e}L${t},${e}L${t},0Z
    M${h},${p} h${b} a${c},${c} 0 0 1 ${c},${c} v${m} a${c},${c} 0 0 1 -${c},${c} h-${b} a${c},${c} 0 0 1 -${c},-${c} v-${m} a${c},${c} 0 0 1 ${c},-${c} z`}function G2(){const r=Bt("__overlaySvg");r&&r.remove()}function Y2(){const r=document.getElementById("driver-dummy-element");if(r)return r;let t=document.createElement("div");return t.id="driver-dummy-element",t.style.width="0",t.style.height="0",t.style.pointerEvents="none",t.style.opacity="0",t.style.position="fixed",t.style.top="50%",t.style.left="50%",document.body.appendChild(t),t}function ah(r){const{element:t}=r;let e=typeof t=="function"?t():typeof t=="string"?document.querySelector(t):t;e||(e=Y2()),Z2(e,r)}function J2(){const r=Bt("__activeElement"),t=Bt("__activeStep");r&&(op(r),W2(),fp(r,t))}function Z2(r,t){var e;const s=Date.now(),i=Bt("__activeStep"),a=Bt("__activeElement")||r,d=!a||a===r,o=r.id==="driver-dummy-element",c=a.id==="driver-dummy-element",h=Ct("animate"),p=t.onHighlightStarted||Ct("onHighlightStarted"),b=(t==null?void 0:t.onHighlighted)||Ct("onHighlighted"),m=(i==null?void 0:i.onDeselected)||Ct("onDeselected"),u=Ct(),w=Bt();!d&&m&&m(c?void 0:a,i,{config:u,state:w,driver:xs()}),p&&p(o?void 0:r,t,{config:u,state:w,driver:xs()});const g=!d&&h;let N=!1;t5(),Nn("previousStep",i),Nn("previousElement",a),Nn("activeStep",t),Nn("activeElement",r);const y=()=>{if(Bt("__transitionCallback")!==y)return;const S=Date.now()-s,L=400-S<=400/2;t.popover&&L&&!N&&g&&(ih(r,t),N=!0),Ct("animate")&&S<400?$2(S,400,a,r):(op(r),b&&b(o?void 0:r,t,{config:Ct(),state:Bt(),driver:xs()}),Nn("__transitionCallback",void 0),Nn("__previousStep",i),Nn("__previousElement",a),Nn("__activeStep",t),Nn("__activeElement",r)),window.requestAnimationFrame(y)};Nn("__transitionCallback",y),window.requestAnimationFrame(y),ip(r),!g&&t.popover&&ih(r,t),a.classList.remove("driver-active-element","driver-no-interaction"),a.removeAttribute("aria-haspopup"),a.removeAttribute("aria-expanded"),a.removeAttribute("aria-controls"),((e=t.disableActiveInteraction)!=null?e:Ct("disableActiveInteraction"))&&r.classList.add("driver-no-interaction"),r.classList.add("driver-active-element"),r.setAttribute("aria-haspopup","dialog"),r.setAttribute("aria-expanded","true"),r.setAttribute("aria-controls","driver-popover-content")}function K2(){var r;(r=document.getElementById("driver-dummy-element"))==null||r.remove(),document.querySelectorAll(".driver-active-element").forEach(t=>{t.classList.remove("driver-active-element","driver-no-interaction"),t.removeAttribute("aria-haspopup"),t.removeAttribute("aria-expanded"),t.removeAttribute("aria-controls")})}function po(){const r=Bt("__resizeTimeout");r&&window.cancelAnimationFrame(r),Nn("__resizeTimeout",window.requestAnimationFrame(J2))}function X2(r){var t;if(!Bt("isInitialized")||!(r.key==="Tab"||r.keyCode===9))return;const e=Bt("__activeElement"),s=(t=Bt("popover"))==null?void 0:t.wrapper,i=ap([...s?[s]:[],...e?[e]:[]]),a=i[0],d=i[i.length-1];if(r.preventDefault(),r.shiftKey){const o=i[i.indexOf(document.activeElement)-1]||d;o==null||o.focus()}else{const o=i[i.indexOf(document.activeElement)+1]||a;o==null||o.focus()}}function dp(r){var t;((t=Ct("allowKeyboardControl"))==null||t)&&(r.key==="Escape"?si("escapePress"):r.key==="ArrowRight"?si("arrowRightPress"):r.key==="ArrowLeft"&&si("arrowLeftPress"))}function up(r,t,e){const s=(i,a)=>{const d=i.target;r.contains(d)&&((!e||e(d))&&(i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation()),a==null||a(i))};document.addEventListener("pointerdown",s,!0),document.addEventListener("mousedown",s,!0),document.addEventListener("pointerup",s,!0),document.addEventListener("mouseup",s,!0),document.addEventListener("click",i=>{s(i,t)},!0)}function Q2(){window.addEventListener("keyup",dp,!1),window.addEventListener("keydown",X2,!1),window.addEventListener("resize",po),window.addEventListener("scroll",po)}function e5(){window.removeEventListener("keyup",dp),window.removeEventListener("resize",po),window.removeEventListener("scroll",po)}function t5(){const r=Bt("popover");r&&(r.wrapper.style.display="none")}function ih(r,t){var e,s;let i=Bt("popover");i&&document.body.removeChild(i.wrapper),i=n5(),document.body.appendChild(i.wrapper);const{title:a,description:d,showButtons:o,disableButtons:c,showProgress:h,nextBtnText:p=Ct("nextBtnText")||"Next &rarr;",prevBtnText:b=Ct("prevBtnText")||"&larr; Previous",progressText:m=Ct("progressText")||"{current} of {total}"}=t.popover||{};i.nextButton.innerHTML=p,i.previousButton.innerHTML=b,i.progress.innerHTML=m,a?(i.title.innerHTML=a,i.title.style.display="block"):i.title.style.display="none",d?(i.description.innerHTML=d,i.description.style.display="block"):i.description.style.display="none";const u=o||Ct("showButtons"),w=h||Ct("showProgress")||!1,g=(u==null?void 0:u.includes("next"))||(u==null?void 0:u.includes("previous"))||w;i.closeButton.style.display=u.includes("close")?"block":"none",g?(i.footer.style.display="flex",i.progress.style.display=w?"block":"none",i.nextButton.style.display=u.includes("next")?"block":"none",i.previousButton.style.display=u.includes("previous")?"block":"none"):i.footer.style.display="none";const N=c||Ct("disableButtons")||[];N!=null&&N.includes("next")&&(i.nextButton.disabled=!0,i.nextButton.classList.add("driver-popover-btn-disabled")),N!=null&&N.includes("previous")&&(i.previousButton.disabled=!0,i.previousButton.classList.add("driver-popover-btn-disabled")),N!=null&&N.includes("close")&&(i.closeButton.disabled=!0,i.closeButton.classList.add("driver-popover-btn-disabled"));const y=i.wrapper;y.style.display="block",y.style.left="",y.style.top="",y.style.bottom="",y.style.right="",y.id="driver-popover-content",y.setAttribute("role","dialog"),y.setAttribute("aria-labelledby","driver-popover-title"),y.setAttribute("aria-describedby","driver-popover-description");const S=i.arrow;S.className="driver-popover-arrow";const L=((e=t.popover)==null?void 0:e.popoverClass)||Ct("popoverClass")||"";y.className=`driver-popover ${L}`.trim(),up(i.wrapper,Y=>{var V,O,Q;const F=Y.target,k=((V=t.popover)==null?void 0:V.onNextClick)||Ct("onNextClick"),M=((O=t.popover)==null?void 0:O.onPrevClick)||Ct("onPrevClick"),_=((Q=t.popover)==null?void 0:Q.onCloseClick)||Ct("onCloseClick");if(F.closest(".driver-popover-next-btn"))return k?k(r,t,{config:Ct(),state:Bt(),driver:xs()}):si("nextClick");if(F.closest(".driver-popover-prev-btn"))return M?M(r,t,{config:Ct(),state:Bt(),driver:xs()}):si("prevClick");if(F.closest(".driver-popover-close-btn"))return _?_(r,t,{config:Ct(),state:Bt(),driver:xs()}):si("closeClick")},Y=>!(i!=null&&i.description.contains(Y))&&!(i!=null&&i.title.contains(Y))&&typeof Y.className=="string"&&Y.className.includes("driver-popover")),Nn("popover",i);const E=((s=t.popover)==null?void 0:s.onPopoverRender)||Ct("onPopoverRender");E&&E(i,{config:Ct(),state:Bt(),driver:xs()}),fp(r,t),ip(y);const I=r.classList.contains("driver-dummy-element"),K=ap([y,...I?[]:[r]]);K.length>0&&K[0].focus()}function hp(){const r=Bt("popover");if(!(r!=null&&r.wrapper))return;const t=r.wrapper.getBoundingClientRect(),e=Ct("stagePadding")||0,s=Ct("popoverOffset")||0;return{width:t.width+e+s,height:t.height+e+s,realWidth:t.width,realHeight:t.height}}function oh(r,t){const{elementDimensions:e,popoverDimensions:s,popoverPadding:i,popoverArrowDimensions:a}=t;return r==="start"?Math.max(Math.min(e.top-i,window.innerHeight-s.realHeight-a.width),a.width):r==="end"?Math.max(Math.min(e.top-(s==null?void 0:s.realHeight)+e.height+i,window.innerHeight-(s==null?void 0:s.realHeight)-a.width),a.width):r==="center"?Math.max(Math.min(e.top+e.height/2-(s==null?void 0:s.realHeight)/2,window.innerHeight-(s==null?void 0:s.realHeight)-a.width),a.width):0}function lh(r,t){const{elementDimensions:e,popoverDimensions:s,popoverPadding:i,popoverArrowDimensions:a}=t;return r==="start"?Math.max(Math.min(e.left-i,window.innerWidth-s.realWidth-a.width),a.width):r==="end"?Math.max(Math.min(e.left-(s==null?void 0:s.realWidth)+e.width+i,window.innerWidth-(s==null?void 0:s.realWidth)-a.width),a.width):r==="center"?Math.max(Math.min(e.left+e.width/2-(s==null?void 0:s.realWidth)/2,window.innerWidth-(s==null?void 0:s.realWidth)-a.width),a.width):0}function fp(r,t){const e=Bt("popover");if(!e)return;const{align:s="start",side:i="left"}=(t==null?void 0:t.popover)||{},a=s,d=r.id==="driver-dummy-element"?"over":i,o=Ct("stagePadding")||0,c=hp(),h=e.arrow.getBoundingClientRect(),p=r.getBoundingClientRect(),b=p.top-c.height;let m=b>=0;const u=window.innerHeight-(p.bottom+c.height);let w=u>=0;const g=p.left-c.width;let N=g>=0;const y=window.innerWidth-(p.right+c.width);let S=y>=0;const L=!m&&!w&&!N&&!S;let E=d;if(d==="top"&&m?S=N=w=!1:d==="bottom"&&w?S=N=m=!1:d==="left"&&N?S=m=w=!1:d==="right"&&S&&(N=m=w=!1),d==="over"){const I=window.innerWidth/2-c.realWidth/2,K=window.innerHeight/2-c.realHeight/2;e.wrapper.style.left=`${I}px`,e.wrapper.style.right="auto",e.wrapper.style.top=`${K}px`,e.wrapper.style.bottom="auto"}else if(L){const I=window.innerWidth/2-(c==null?void 0:c.realWidth)/2,K=10;e.wrapper.style.left=`${I}px`,e.wrapper.style.right="auto",e.wrapper.style.bottom=`${K}px`,e.wrapper.style.top="auto"}else if(N){const I=Math.min(g,window.innerWidth-(c==null?void 0:c.realWidth)-h.width),K=oh(a,{elementDimensions:p,popoverDimensions:c,popoverPadding:o,popoverArrowDimensions:h});e.wrapper.style.left=`${I}px`,e.wrapper.style.top=`${K}px`,e.wrapper.style.bottom="auto",e.wrapper.style.right="auto",E="left"}else if(S){const I=Math.min(y,window.innerWidth-(c==null?void 0:c.realWidth)-h.width),K=oh(a,{elementDimensions:p,popoverDimensions:c,popoverPadding:o,popoverArrowDimensions:h});e.wrapper.style.right=`${I}px`,e.wrapper.style.top=`${K}px`,e.wrapper.style.bottom="auto",e.wrapper.style.left="auto",E="right"}else if(m){const I=Math.min(b,window.innerHeight-c.realHeight-h.width);let K=lh(a,{elementDimensions:p,popoverDimensions:c,popoverPadding:o,popoverArrowDimensions:h});e.wrapper.style.top=`${I}px`,e.wrapper.style.left=`${K}px`,e.wrapper.style.bottom="auto",e.wrapper.style.right="auto",E="top"}else if(w){const I=Math.min(u,window.innerHeight-(c==null?void 0:c.realHeight)-h.width);let K=lh(a,{elementDimensions:p,popoverDimensions:c,popoverPadding:o,popoverArrowDimensions:h});e.wrapper.style.left=`${K}px`,e.wrapper.style.bottom=`${I}px`,e.wrapper.style.top="auto",e.wrapper.style.right="auto",E="bottom"}L?e.arrow.classList.add("driver-popover-arrow-none"):r5(a,E,r)}function r5(r,t,e){const s=Bt("popover");if(!s)return;const i=e.getBoundingClientRect(),a=hp(),d=s.arrow,o=a.width,c=window.innerWidth,h=i.width,p=i.left,b=a.height,m=window.innerHeight,u=i.top,w=i.height;d.className="driver-popover-arrow";let g=t,N=r;if(t==="top"?(p+h<=0?(g="right",N="end"):p+h-o<=0&&(g="top",N="start"),p>=c?(g="left",N="end"):p+o>=c&&(g="top",N="end")):t==="bottom"?(p+h<=0?(g="right",N="start"):p+h-o<=0&&(g="bottom",N="start"),p>=c?(g="left",N="start"):p+o>=c&&(g="bottom",N="end")):t==="left"?(u+w<=0?(g="bottom",N="end"):u+w-b<=0&&(g="left",N="start"),u>=m?(g="top",N="end"):u+b>=m&&(g="left",N="end")):t==="right"&&(u+w<=0?(g="bottom",N="start"):u+w-b<=0&&(g="right",N="start"),u>=m?(g="top",N="start"):u+b>=m&&(g="right",N="end")),!g)d.classList.add("driver-popover-arrow-none");else{d.classList.add(`driver-popover-arrow-side-${g}`),d.classList.add(`driver-popover-arrow-align-${N}`);const y=e.getBoundingClientRect(),S=d.getBoundingClientRect(),L=Ct("stagePadding")||0,E=y.left-L<window.innerWidth&&y.right+L>0&&y.top-L<window.innerHeight&&y.bottom+L>0;t==="bottom"&&E&&(S.x>y.x&&S.x+S.width<y.x+y.width?s.wrapper.style.transform="translateY(0)":(d.classList.remove(`driver-popover-arrow-align-${N}`),d.classList.add("driver-popover-arrow-none"),s.wrapper.style.transform=`translateY(-${L/2}px)`))}}function n5(){const r=document.createElement("div");r.classList.add("driver-popover");const t=document.createElement("div");t.classList.add("driver-popover-arrow");const e=document.createElement("header");e.id="driver-popover-title",e.classList.add("driver-popover-title"),e.style.display="none",e.innerText="Popover Title";const s=document.createElement("div");s.id="driver-popover-description",s.classList.add("driver-popover-description"),s.style.display="none",s.innerText="Popover description is here";const i=document.createElement("button");i.type="button",i.classList.add("driver-popover-close-btn"),i.setAttribute("aria-label","Close"),i.innerHTML="&times;";const a=document.createElement("footer");a.classList.add("driver-popover-footer");const d=document.createElement("span");d.classList.add("driver-popover-progress-text"),d.innerText="";const o=document.createElement("span");o.classList.add("driver-popover-navigation-btns");const c=document.createElement("button");c.type="button",c.classList.add("driver-popover-prev-btn"),c.innerHTML="&larr; Previous";const h=document.createElement("button");return h.type="button",h.classList.add("driver-popover-next-btn"),h.innerHTML="Next &rarr;",o.appendChild(c),o.appendChild(h),a.appendChild(d),a.appendChild(o),r.appendChild(i),r.appendChild(t),r.appendChild(e),r.appendChild(s),r.appendChild(a),{wrapper:r,arrow:t,title:e,description:s,footer:a,previousButton:c,nextButton:h,closeButton:i,footerButtons:o,progress:d}}function s5(){var r;const t=Bt("popover");t&&((r=t.wrapper.parentElement)==null||r.removeChild(t.wrapper))}function a5(r={}){fc(r);function t(){Ct("allowClose")&&p()}function e(){const m=Ct("overlayClickBehavior");if(Ct("allowClose")&&m==="close"){p();return}if(typeof m=="function"){const u=Bt("__activeStep"),w=Bt("__activeElement");m(w,u,{config:Ct(),state:Bt(),driver:xs()});return}m==="nextStep"&&s()}function s(){const m=Bt("activeIndex"),u=Ct("steps")||[];if(typeof m>"u")return;const w=m+1;u[w]?h(w):p()}function i(){const m=Bt("activeIndex"),u=Ct("steps")||[];if(typeof m>"u")return;const w=m-1;u[w]?h(w):p()}function a(m){(Ct("steps")||[])[m]?h(m):p()}function d(){var m;if(Bt("__transitionCallback"))return;const u=Bt("activeIndex"),w=Bt("__activeStep"),g=Bt("__activeElement");if(typeof u>"u"||typeof w>"u"||typeof Bt("activeIndex")>"u")return;const N=((m=w.popover)==null?void 0:m.onPrevClick)||Ct("onPrevClick");if(N)return N(g,w,{config:Ct(),state:Bt(),driver:xs()});i()}function o(){var m;if(Bt("__transitionCallback"))return;const u=Bt("activeIndex"),w=Bt("__activeStep"),g=Bt("__activeElement");if(typeof u>"u"||typeof w>"u")return;const N=((m=w.popover)==null?void 0:m.onNextClick)||Ct("onNextClick");if(N)return N(g,w,{config:Ct(),state:Bt(),driver:xs()});s()}function c(){Bt("isInitialized")||(Nn("isInitialized",!0),document.body.classList.add("driver-active",Ct("animate")?"driver-fade":"driver-simple"),Q2(),Ko("overlayClick",e),Ko("escapePress",t),Ko("arrowLeftPress",d),Ko("arrowRightPress",o))}function h(m=0){var u,w,g,N,y,S,L,E;const I=Ct("steps");if(!I){console.error("No steps to drive through"),p();return}if(!I[m]){p();return}Nn("__activeOnDestroyed",document.activeElement),Nn("activeIndex",m);const K=I[m],Y=I[m+1],V=I[m-1],O=((u=K.popover)==null?void 0:u.doneBtnText)||Ct("doneBtnText")||"Done",Q=Ct("allowClose"),F=typeof((w=K.popover)==null?void 0:w.showProgress)<"u"?(g=K.popover)==null?void 0:g.showProgress:Ct("showProgress"),k=(((N=K.popover)==null?void 0:N.progressText)||Ct("progressText")||"{{current}} of {{total}}").replace("{{current}}",`${m+1}`).replace("{{total}}",`${I.length}`),M=((y=K.popover)==null?void 0:y.showButtons)||Ct("showButtons"),_=["next","previous",...Q?["close"]:[]].filter(se=>!(M!=null&&M.length)||M.includes(se)),te=((S=K.popover)==null?void 0:S.onNextClick)||Ct("onNextClick"),ae=((L=K.popover)==null?void 0:L.onPrevClick)||Ct("onPrevClick"),re=((E=K.popover)==null?void 0:E.onCloseClick)||Ct("onCloseClick");ah({...K,popover:{showButtons:_,nextBtnText:Y?void 0:O,disableButtons:[...V?[]:["previous"]],showProgress:F,progressText:k,onNextClick:te||(()=>{Y?h(m+1):p()}),onPrevClick:ae||(()=>{h(m-1)}),onCloseClick:re||(()=>{p()}),...(K==null?void 0:K.popover)||{}}})}function p(m=!0){const u=Bt("__activeElement"),w=Bt("__activeStep"),g=Bt("__activeOnDestroyed"),N=Ct("onDestroyStarted");if(m&&N){const L=!u||(u==null?void 0:u.id)==="driver-dummy-element";N(L?void 0:u,w,{config:Ct(),state:Bt(),driver:xs()});return}const y=(w==null?void 0:w.onDeselected)||Ct("onDeselected"),S=Ct("onDestroyed");if(document.body.classList.remove("driver-active","driver-fade","driver-simple"),e5(),s5(),K2(),G2(),M2(),sh(),u&&w){const L=u.id==="driver-dummy-element";y&&y(L?void 0:u,w,{config:Ct(),state:Bt(),driver:xs()}),S&&S(L?void 0:u,w,{config:Ct(),state:Bt(),driver:xs()})}g&&g.focus()}const b={isActive:()=>Bt("isInitialized")||!1,refresh:po,drive:(m=0)=>{c(),h(m)},setConfig:fc,setSteps:m=>{sh(),fc({...Ct(),steps:m})},getConfig:Ct,getState:Bt,getActiveIndex:()=>Bt("activeIndex"),isFirstStep:()=>Bt("activeIndex")===0,isLastStep:()=>{const m=Ct("steps")||[],u=Bt("activeIndex");return u!==void 0&&u===m.length-1},getActiveStep:()=>Bt("activeStep"),getActiveElement:()=>Bt("activeElement"),getPreviousElement:()=>Bt("previousElement"),getPreviousStep:()=>Bt("previousStep"),moveNext:s,movePrevious:i,moveTo:a,hasNextStep:()=>{const m=Ct("steps")||[],u=Bt("activeIndex");return u!==void 0&&!!m[u+1]},hasPreviousStep:()=>{const m=Ct("steps")||[],u=Bt("activeIndex");return u!==void 0&&!!m[u-1]},highlight:m=>{c(),ah({...m,popover:m.popover?{showButtons:[],showProgress:!1,progressText:"",...m.popover}:void 0})},destroy:()=>{p(!1)}};return B2(b),b}const i5=()=>typeof window<"u"&&window.matchMedia("(max-width: 639px)").matches,pc=(r,t,e,s)=>i5()?"":r?`<div style="text-align: center;"><img src="/static/images/tour/${r}" style="width: ${e.width}px; height: ${e.height}px; border-radius: 4px;" alt="${s||"Tour step"}"></div>`:"",o5=()=>{const{setActivePage:r}=Mi();U.useEffect(()=>{(async()=>{try{ze("TOUR","Checking tour status...");const i=await fetch("/api/user/preferences/tour-status");if(ze("TOUR","API response status:",i.status),!i.ok){ze("TOUR","API response not OK, aborting");return}const a=await i.json();ze("TOUR","API data:",a);const o=new URLSearchParams(window.location.search).has("show_tour"),c=sessionStorage.getItem("show_tour_after_login")==="true";if(ze("TOUR","showTourParam:",o),ze("TOUR","showTourAfterLogin:",c),ze("TOUR","data.show_tour:",a.show_tour),a.show_tour||o||c){if(ze("TOUR","Starting tour!"),c&&sessionStorage.removeItem("show_tour_after_login"),o){const h=window.location.pathname;window.history.replaceState({},"",h)}setTimeout(()=>e(),500)}}catch(i){console.error("Error checking tour status:",i)}})()},[]);const t=async()=>{try{await fetch("/api/user/preferences/tour-complete",{method:"POST",headers:{"Content-Type":"application/json"}})}catch(s){console.error("Error marking tour complete:",s)}},e=()=>{const s=a5({showProgress:!0,showButtons:["next","previous"],popoverClass:"gpra-tour-popover",overlayOpacity:.55,stagePadding:15,stageRadius:8,allowClose:!1,smoothScroll:!0,steps:[{element:'[data-tour="app-title"]',popover:{title:"Welcome to Guitar Practice Routine App!",description:"You'll be tempted to skip through this tour without reading it, but since you're new here you'll get a lot more from the app (a lot more quickly) if you take the tour.<br><br> Click `Next` to get going... ðŸŽ¸<br><br><strong>Sidenote:</strong> The app works on mobile, but it's best on desktop/laptop ",popoverClass:"gpra-tour-popover gpra-tour-welcome",side:"bottom",align:"start"}},{element:'[data-tour="items-tab"]',onHighlightStarted:i=>new Promise(a=>{i.getBoundingClientRect();const d=document.querySelectorAll(".driver-popover img");if(d.length>0){let o=0;const c=()=>{o++,o===d.length&&setTimeout(a,100)};d.forEach(h=>{h.complete?c():(h.addEventListener("load",c),h.addEventListener("error",c))})}else setTimeout(a,100)}),popover:{title:"Step 1: Creating practice items",description:`Use the items page to create and manage items.<br>Items can be songs, exercises, reminders, etc.<br>${pc("CreateItem.gif","mobile-items-add.png",{width:600,height:579},"Creating a practice item")}`,side:"bottom",align:"start",onNextClick:()=>(r("Routines"),setTimeout(()=>{s.moveNext()},400),!1)}},{element:'[data-tour="new-routine-input"]',onHighlightStarted:i=>new Promise(a=>{i.getBoundingClientRect();const d=document.querySelectorAll(".driver-popover img");if(d.length>0){let o=0;const c=()=>{o++,o===d.length&&setTimeout(a,100)};d.forEach(h=>{h.complete?c():(h.addEventListener("load",c),h.addEventListener("error",c))})}else setTimeout(a,100)}),popover:{title:"Step 2: Creating routines",description:`Routines are for organizing your practice items into structured sessions.<br><br>Enter a name for a new routine, then click the \`+ Add\` button.<br><br>${pc("CreateRoutine.gif","mobile-routines-create.png",{width:600,height:495},"Creating a routine")}`,side:"bottom",align:"start",onPrevClick:()=>(r("Items"),setTimeout(()=>{s.movePrevious()},400),!1),onPopoverRender:()=>{setTimeout(()=>{const i=document.querySelector('[data-tour="new-routine-input"]');i&&i.scrollIntoView({behavior:"smooth",block:"center"})},100)},onNextClick:()=>(s.moveNext(),!1)}},{element:'[data-tour="edit-routine-icon"]',onHighlightStarted:()=>(window.scrollTo({top:0,behavior:"smooth"}),new Promise(i=>setTimeout(i,150))),popover:{title:"Step 3: Adding items to routines",description:`To add items to routines, click the âœï¸ edit icon.<br><br>Drag n' drop to reorder!<br><br>${pc("AddItemsToRoutine.gif","mobile-routine-edit.png",{width:600,height:435},"Adding items to routine")}`,side:"left",align:"start",onNextClick:()=>(r("Practice"),setTimeout(()=>{s.moveNext()},200),!1)}},{element:'[data-tour="practice-tab"]',popover:{title:"Step 4: Practice page",description:"This is where you'll spend your time when you're practicing. The Practice page shows the active routine and its items.<br><br> To change the active routine, go to the Routines page and click the `+` on a routine to make it active.",side:"bottom",align:"start",onPrevClick:()=>(r("Routines"),setTimeout(()=>{s.movePrevious()},200),!1),onNextClick:()=>{const i=document.querySelector("[data-item-header]");return i&&i.getAttribute("data-expanded")!=="true"&&i.click(),setTimeout(()=>{const a=document.querySelector('[data-tour="chord-charts"]');if(a){const d=a.closest(".cursor-pointer");if(d){const o=d.querySelector("svg");o&&!o.classList.contains("rotate-0")&&d.click()}}setTimeout(()=>{s.moveNext()},500)},400),!1}}},{element:'[data-tour="chord-charts-section"]',onHighlighted:i=>{setTimeout(()=>{const a=i.getBoundingClientRect(),o=window.innerHeight*.55,c=window.scrollY+a.top-o;window.scrollTo({top:Math.max(0,c),behavior:"smooth"})},150)},popover:{title:"Step 5: Chord charts",description:"You can view and manage chord charts from the `Practice`, `Routines`, and `Items` pages. You can create charts manually, or use the autocreate feature to build charts from PDFs, images, YouTube lesson videos, or type the names of the song sections and chords.",side:"top",align:"center",popoverClass:"gpra-tour-popover gpra-tour-chord-charts",onPrevClick:()=>(r("Practice"),setTimeout(()=>{s.movePrevious()},200),!1),onNextClick:()=>(r("Account"),setTimeout(()=>{if(!document.querySelector('[data-tour="api-key-input"]')){const a=document.querySelector('[data-tour="api-key-card-header"]');a&&a.click()}setTimeout(()=>{s.moveNext()},300)},400),!1)}},{element:'[data-tour="api-key-input"]',onHighlighted:i=>{setTimeout(()=>{i.scrollIntoView({behavior:"smooth",block:"center"})},100)},popover:{title:"Step 6: Adding your API key",description:"To use the autocreate feature on free and basic tiers, add your Anthropic API key on the account page. Then Claude can build chord charts for you.",side:"bottom",align:"start",popoverClass:"gpra-tour-popover gpra-tour-api-key",onPrevClick:()=>(r("Practice"),setTimeout(()=>{s.movePrevious()},200),!1)}},{element:'[data-tour="items-tab"]',popover:{title:"You're all set!",description:"That's it for the tour. Rock on! ðŸ¤˜<br> (or blues on, folk on, jazz on, hip hop on, country on, reggae on, get your worship on, or whatever floats your musical boat...)",popoverClass:"gpra-tour-popover gpra-tour-welcome",side:"bottom",align:"start"}}],onDestroyed:()=>{r("Items"),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},200),t()}});s.drive()};return null};function l5({isOpen:r,onClose:t,daysUntil90:e,lapseDate:s}){const[i,a]=U.useState(!1),[d,o]=U.useState(null),[c,h]=U.useState(!0);U.useEffect(()=>{r&&(h(!0),fetch("/api/billing/last-payment",{credentials:"include"}).then(m=>m.json()).then(m=>{m.amount&&m.date&&o({amount:m.amount,date:new Date(m.date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}).catch(m=>{console.error("Error fetching last payment:",m)}).finally(()=>{h(!1)}))},[r]);const p=async()=>{a(!0);try{const m=await fetch("/api/billing/resume-subscription",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!m.ok){const w=await m.text();throw console.error("Resume subscription failed:",m.status,w),new Error(`Failed to resume subscription: ${m.status}`)}const u=await m.json();if(u.url)window.location.href=u.url;else throw new Error("No portal URL returned")}catch(m){console.error("Error resuming subscription:",m),alert("Error resuming subscription. Please try again."),a(!1)}},b=async()=>{a(!0);try{const m=await fetch("/api/billing/set-unplugged",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(!m.ok){const w=await m.text();throw console.error("Set unplugged failed:",m.status,w),new Error(`Failed to set unplugged mode: ${m.status}`)}if((await m.json()).success)sessionStorage.setItem("lapsedModalDismissed","true"),window.location.reload();else throw new Error("Failed to set unplugged mode")}catch(m){console.error("Error setting unplugged mode:",m),alert("Error. Please try again."),a(!1)}};return r?(s&&new Date(s).toLocaleDateString(),n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:m=>{m.stopPropagation()},children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-lg w-full mx-4 p-6",onClick:m=>m.stopPropagation(),children:[n.jsxs("div",{className:"bg-gray-700 rounded-lg p-4 mb-6",children:[n.jsx("p",{className:"text-white text-lg font-semibold mb-2",children:"Caution, potential discomfort ahead: Money talk"}),!c&&d&&n.jsxs("p",{className:"text-gray-200 text-sm",children:["Your last payment was $",d.amount," on ",d.date]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50",children:[n.jsx("h3",{className:"font-semibold mb-2",children:"Resume with a payment"}),n.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Add or update your payment method to get your goodies back. We're keeping all your routines, items, and chord charts saved in our database for another ",e," days (counting from when you paused, canceled, or missed a payment)."]}),n.jsx("button",{onClick:p,disabled:i,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition-colors disabled:bg-gray-400",children:i?"Loading...":"Plug it in"})]}),n.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[n.jsx("h3",{className:"font-semibold mb-2",children:"Go back to freebie mode"}),n.jsxs("p",{className:"text-sm text-gray-700 mb-3",children:["Keep using your most recently active routine for free. We'll save all your other stuff in our DB for another ",e," days if you renew by then (counting from when you paused, canceled, or missed a payment)."]}),n.jsx("button",{onClick:b,disabled:i,className:"w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded transition-colors disabled:bg-gray-400",children:i?"Loading...":"Unplugged"})]})]})]})})):null}function c5({isOpen:r,onClose:t,daysRemaining:e,targetPage:s}){const[i,a]=U.useState(!1),d=async()=>{a(!0);try{const c=await(await fetch("/api/billing/resume-subscription",{method:"POST",headers:{"Content-Type":"application/json"}})).json();c.url&&(window.location.href=c.url)}catch(o){console.error("Error:",o),a(!1)}};return r?n.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-gray-900 bg-opacity-75",onClick:t,children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6",onClick:o=>o.stopPropagation(),children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Still unplugged"}),n.jsxs("p",{className:"text-gray-700 mb-6",children:["We're still saving your ",s==="routines"?"routines":"items"," for another ",e||0," days (counting from when you paused, canceled, or missed a payment)."]}),n.jsxs("div",{className:"flex flex-col gap-3",children:[n.jsx("button",{onClick:d,disabled:i,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition-colors",children:i?"Loading...":"Plug it back in"}),n.jsx("button",{onClick:t,className:"w-full bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded transition-colors",children:"Keep it unplugged"})]})]})}):null}const d5=({deletionDate:r,deletionType:t,refundAmount:e,onCancel:s})=>{const[i,a]=U.useState(!1),[d,o]=U.useState(!1),[c,h]=U.useState(null),p=async()=>{a(!0),h(null);try{const m=await fetch("/api/user/cancel-deletion",{method:"POST",headers:{"Content-Type":"application/json"}}),u=await m.json();m.ok?(h({type:"success",text:"Deletion canceled successfully! Page will reload..."}),setTimeout(()=>{window.location.reload()},1500)):h({type:"error",text:u.error||"Failed to cancel deletion"})}catch{h({type:"error",text:"Error canceling deletion"})}finally{a(!1)}};if(d)return null;const b=new Date(r).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});return n.jsx("div",{className:"bg-yellow-900/30 border-l-4 border-yellow-500 p-4 mb-4 rounded-r-md",children:n.jsxs("div",{className:"flex items-start justify-between gap-4",children:[n.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[n.jsx(Bn,{className:"w-5 h-5 text-yellow-400 mt-0.5 flex-shrink-0"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"text-yellow-100 font-semibold mb-1",children:"Account deletion scheduled"}),n.jsxs("p",{className:"text-yellow-200 text-sm mb-2",children:["Your account will be permanently deleted on ",n.jsx("strong",{children:b}),".",e>0&&n.jsxs(n.Fragment,{children:[" You'll receive a refund of ",n.jsxs("strong",{children:["$",e.toFixed(2)]}),"."]})]}),c&&n.jsx(ms,{className:`mt-2 ${c.type==="success"?"bg-green-900/30 border-green-700":"bg-red-900/30 border-red-700"}`,children:n.jsx(gs,{className:"text-gray-300 text-xs",children:c.text})})]})]}),n.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[n.jsx(Be,{onClick:p,disabled:i,size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",children:i?n.jsxs(n.Fragment,{children:[n.jsx(Rr,{className:"w-4 h-4 mr-2 animate-spin"}),"Canceling..."]}):"Cancel deletion"}),n.jsx("button",{onClick:()=>o(!0),className:"text-yellow-400 hover:text-yellow-300 p-1","aria-label":"Dismiss banner",children:n.jsx(Gr,{className:"w-5 h-5"})})]})]})})},u5=()=>{const[r,t]=U.useState([]),[e,s]=U.useState(!0),[i,a]=U.useState(null),[d,o]=U.useState(0),c=async()=>{try{const p=await fetch("/api/items");if(!p.ok)throw new Error("Failed to fetch items");const b=await p.json();t(b),a(null)}catch(p){a(p.message),console.error("Fetch error:",p)}finally{s(!1)}},h=U.useCallback(async()=>{o(p=>p+1)},[]);return U.useEffect(()=>{c()},[d]),{items:r,loading:e,error:i,refreshItems:h}},h5=()=>{const{items:r,refreshItems:t}=u5();return n.jsx(im,{items:r,onItemsChange:t})},f5=()=>{const{activePage:r}=Mi();switch(r){case"Practice":return n.jsx(pm,{});case"Routines":return n.jsx(Cm,{});case"Items":return n.jsx(h5,{});case"Imports":return n.jsx(Im,{});case"Account":return n.jsx(D2,{});case"FAQ":return window.location.href="/faq",null;default:return n.jsx("div",{children:"Page not implemented yet"})}},p5=()=>{const r=U.useRef(null),[t,e]=U.useState(160),[s,i]=U.useState(!1),[a,d]=U.useState({}),[o,c]=U.useState(null),{activePage:h,setActivePage:p}=Mi(),[b,m]=U.useState(!1),[u,w]=U.useState("");return U.useEffect(()=>{const g=()=>{if(r.current){const N=r.current.offsetHeight;e(N+20)}};return g(),window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]),U.useEffect(()=>{fetch("/api/auth/status").then(g=>g.json()).then(g=>{c(g),g.authenticated&&window.posthog&&(window.posthog.identify(g.posthog_distinct_id,{email:g.email,username:g.user,subscription_tier:g.tier,billing_period:g.billing_period,oauth_providers:g.oauth_providers||[]}),y0(g));const N=sessionStorage.getItem("lapsedModalDismissed")==="true";g.is_lapsed&&!N&&(d({daysUntil90:g.days_until_90,lapseDate:g.lapse_date}),i(!0))}).catch(g=>console.error("Error checking auth status:",g))},[]),n.jsxs("div",{className:"min-h-screen",children:[n.jsx(o5,{}),n.jsx(x0,{}),n.jsx(l5,{isOpen:s,onClose:()=>i(!1),daysUntil90:a.daysUntil90,lapseDate:a.lapseDate}),n.jsx(c5,{isOpen:b,onClose:()=>m(!1),daysRemaining:o==null?void 0:o.days_remaining,targetPage:u}),n.jsx("div",{ref:r,className:"fixed top-0 left-0 right-0 z-50 bg-gray-900",children:n.jsxs("div",{className:"container mx-auto px-4 pt-4 pb-1",children:[n.jsx("h1",{className:"text-2xl sm:text-4xl font-bold text-orange-500 mb-2","data-tour":"app-title",children:"Guitar Practice Routine App"}),n.jsx(wm,{className:"mb-0",userStatus:o,onUnpluggedAttempt:g=>{w(g.toLowerCase()),m(!0)}})]})}),n.jsxs("div",{className:"pb-4 px-4 container mx-auto",style:{paddingTop:`${t}px`},children:[(o==null?void 0:o.deletion_scheduled_for)&&n.jsx(d5,{deletionDate:o.deletion_scheduled_for,deletionType:o.deletion_type,refundAmount:o.prorated_refund_amount||0}),n.jsx(f5,{})]}),n.jsx("footer",{className:"bg-gray-800 border-t border-gray-700 mt-8 py-6",children:n.jsx("div",{className:"container mx-auto px-4 text-center text-sm text-gray-400",children:n.jsxs("div",{className:"space-x-4",children:[n.jsx("a",{href:"/about",className:"hover:text-orange-400 transition-colors",children:"About"}),n.jsx("span",{children:"Â·"}),n.jsx("a",{href:"/faq",className:"hover:text-orange-400 transition-colors",children:"FAQ"}),n.jsx("span",{children:"Â·"}),n.jsx("a",{href:"/terms",className:"hover:text-orange-400 transition-colors",children:"Terms"}),n.jsx("span",{children:"Â·"}),n.jsx("a",{href:"/privacy",className:"hover:text-orange-400 transition-colors",children:"Privacy"})]})})})]})};g0.createRoot(document.getElementById("root")).render(n.jsx(Bi.StrictMode,{children:n.jsx(w0,{children:n.jsx(p5,{})})}));export{Cr as _};
//# sourceMappingURL=main.js.map
